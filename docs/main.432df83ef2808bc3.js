(self.webpackChunkmap_project=self.webpackChunkmap_project||[]).push([[179],{781:(gg,Yu,Ku)=>{"use strict";function Rn(e){return"function"==typeof e}function Od(e){const n=e(i=>{Error.call(i),i.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const _g=Od(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((i,o)=>`${o+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function p(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class Ue{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const a of n)a.remove(this);else n.remove(this);const{initialTeardown:i}=this;if(Rn(i))try{i()}catch(a){t=a instanceof _g?a.errors:[a]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const a of o)try{Kt(a)}catch(u){t=t??[],u instanceof _g?t=[...t,...u.errors]:t.push(u)}}if(t)throw new _g(t)}}add(t){var n;if(t&&t!==this)if(this.closed)Kt(t);else{if(t instanceof Ue){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&p(n,t)}remove(t){const{_finalizers:n}=this;n&&p(n,t),t instanceof Ue&&t._removeParent(this)}}Ue.EMPTY=(()=>{const e=new Ue;return e.closed=!0,e})();const Ds=Ue.EMPTY;function Lo(e){return e instanceof Ue||e&&"closed"in e&&Rn(e.remove)&&Rn(e.add)&&Rn(e.unsubscribe)}function Kt(e){Rn(e)?e():e.unsubscribe()}const Xt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Zi={setTimeout(e,t,...n){const{delegate:i}=Zi;return i?.setTimeout?i.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=Zi;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function Ur(e){Zi.setTimeout(()=>{const{onUnhandledError:t}=Xt;if(!t)throw e;t(e)})}function ns(){}const Zs=vo("C",void 0,void 0);function vo(e,t,n){return{kind:e,value:t,error:n}}let Fo=null;function ro(e){if(Xt.useDeprecatedSynchronousErrorHandling){const t=!Fo;if(t&&(Fo={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:i}=Fo;if(Fo=null,n)throw i}}else e()}class Xs extends Ue{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Lo(t)&&t.add(this)):this.destination=Ju}static create(t,n,i){return new ll(t,n,i)}next(t){this.isStopped?Wc(function Jl(e){return vo("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Wc(function Gc(e){return vo("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Wc(Zs,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const is=Function.prototype.bind;function at(e,t){return is.call(e,t)}class Ld{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(i){an(i)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(i){an(i)}else an(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){an(n)}}}class ll extends Xs{constructor(t,n,i){let o;if(super(),Rn(t)||!t)o={next:t??void 0,error:n??void 0,complete:i??void 0};else{let a;this&&Xt.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=()=>this.unsubscribe(),o={next:t.next&&at(t.next,a),error:t.error&&at(t.error,a),complete:t.complete&&at(t.complete,a)}):o=t}this.destination=new Ld(o)}}function an(e){Xt.useDeprecatedSynchronousErrorHandling?function al(e){Xt.useDeprecatedSynchronousErrorHandling&&Fo&&(Fo.errorThrown=!0,Fo.error=e)}(e):Ur(e)}function Wc(e,t){const{onStoppedNotification:n}=Xt;n&&Zi.setTimeout(()=>n(e,t))}const Ju={closed:!0,next:ns,error:function sr(e){throw e},complete:ns},cl="function"==typeof Symbol&&Symbol.observable||"@@observable";function rs(e){return e}function ul(e){return 0===e.length?rs:1===e.length?e[0]:function(n){return e.reduce((i,o)=>o(i),n)}}let fn=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const i=new e;return i.source=this,i.operator=n,i}subscribe(n,i,o){const a=function ki(e){return e&&e instanceof Xs||function Ca(e){return e&&Rn(e.next)&&Rn(e.error)&&Rn(e.complete)}(e)&&Lo(e)}(n)?n:new ll(n,i,o);return ro(()=>{const{operator:u,source:m}=this;a.add(u?u.call(a,m):m?this._subscribe(a):this._trySubscribe(a))}),a}_trySubscribe(n){try{return this._subscribe(n)}catch(i){n.error(i)}}forEach(n,i){return new(i=Xi(i))((o,a)=>{const u=new ll({next:m=>{try{n(m)}catch(y){a(y),u.unsubscribe()}},error:a,complete:o});this.subscribe(u)})}_subscribe(n){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(n)}[cl](){return this}pipe(...n){return ul(n)(this)}toPromise(n){return new(n=Xi(n))((i,o)=>{let a;this.subscribe(u=>a=u,u=>o(u),()=>i(a))})}}return e.create=t=>new e(t),e})();function Xi(e){var t;return null!==(t=e??Xt.Promise)&&void 0!==t?t:Promise}const Ea=Od(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let oo=(()=>{class e extends fn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const i=new Ys(this,this);return i.operator=n,i}_throwIfClosed(){if(this.closed)throw new Ea}next(n){ro(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(n)}})}error(n){ro(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:i}=this;for(;i.length;)i.shift().error(n)}})}complete(){ro(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:i,isStopped:o,observers:a}=this;return i||o?Ds:(this.currentObservers=null,a.push(n),new Ue(()=>{this.currentObservers=null,p(a,n)}))}_checkFinalizedStatuses(n){const{hasError:i,thrownError:o,isStopped:a}=this;i?n.error(o):a&&n.complete()}asObservable(){const n=new fn;return n.source=this,n}}return e.create=(t,n)=>new Ys(t,n),e})();class Ys extends oo{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===i||i.call(n,t)}error(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===i||i.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,i;return null!==(i=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==i?i:Ds}}function Ts(e){return Rn(e?.lift)}function gi(e){return t=>{if(Ts(t))return t.lift(function(n){try{return e(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Yn(e,t,n,i,o){return new Ql(e,t,n,i,o)}class Ql extends Xs{constructor(t,n,i,o,a,u){super(t),this.onFinalize=a,this.shouldUnsubscribe=u,this._next=n?function(m){try{n(m)}catch(y){t.error(y)}}:super._next,this._error=o?function(m){try{o(m)}catch(y){t.error(y)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(m){t.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function dt(e,t){return gi((n,i)=>{let o=0;n.subscribe(Yn(i,a=>{i.next(e.call(t,a,o++))}))})}function Bo(e){return this instanceof Bo?(this.v=e,this):new Bo(e)}function Ia(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function so(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(a){n[a]=e[a]&&function(u){return new Promise(function(m,y){!function o(a,u,m,y){Promise.resolve(y).then(function(C){a({value:C,done:m})},u)}(m,y,(u=e[a](u)).done,u.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const _e=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function ke(e){return Rn(e?.then)}function tt(e){return Rn(e[cl])}function it(e){return Symbol.asyncIterator&&Rn(e?.[Symbol.asyncIterator])}function Je(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const en=function Gt(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Ut(e){return Rn(e?.[en])}function tn(e){return function Sa(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,i=n.apply(e,t||[]),a=[];return o={},u("next"),u("throw"),u("return"),o[Symbol.asyncIterator]=function(){return this},o;function u(z){i[z]&&(o[z]=function(V){return new Promise(function(H,X){a.push([z,V,H,X])>1||m(z,V)})})}function m(z,V){try{!function y(z){z.value instanceof Bo?Promise.resolve(z.value.v).then(C,T):A(a[0][2],z)}(i[z](V))}catch(H){A(a[0][3],H)}}function C(z){m("next",z)}function T(z){m("throw",z)}function A(z,V){z(V),a.shift(),a.length&&m(a[0][0],a[0][1])}}(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:i,done:o}=yield Bo(n.read());if(o)return yield Bo(void 0);yield yield Bo(i)}}finally{n.releaseLock()}})}function pn(e){return Rn(e?.getReader)}function xn(e){if(e instanceof fn)return e;if(null!=e){if(tt(e))return function Ri(e){return new fn(t=>{const n=e[cl]();if(Rn(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(_e(e))return function Tr(e){return new fn(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(ke(e))return function ji(e){return new fn(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,Ur)})}(e);if(it(e))return Yi(e);if(Ut(e))return function Ss(e){return new fn(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(pn(e))return function $r(e){return Yi(tn(e))}(e)}throw Je(e)}function Yi(e){return new fn(t=>{(function rc(e,t){var n,i,o,a;return function Ks(e,t,n,i){return new(n||(n=Promise))(function(a,u){function m(T){try{C(i.next(T))}catch(A){u(A)}}function y(T){try{C(i.throw(T))}catch(A){u(A)}}function C(T){T.done?a(T.value):function o(a){return a instanceof n?a:new n(function(u){u(a)})}(T.value).then(m,y)}C((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Ia(e);!(i=yield n.next()).done;)if(t.next(i.value),t.closed)return}catch(u){o={error:u}}finally{try{i&&!i.done&&(a=n.return)&&(yield a.call(n))}finally{if(o)throw o.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function Qs(e,t,n,i=0,o=!1){const a=t.schedule(function(){n(),o?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(a),!o)return a}function Lt(e,t,n=1/0){return Rn(t)?Lt((i,o)=>dt((a,u)=>t(i,a,o,u))(xn(e(i,o))),n):("number"==typeof t&&(n=t),gi((i,o)=>function wp(e,t,n,i,o,a,u,m){const y=[];let C=0,T=0,A=!1;const z=()=>{A&&!y.length&&!C&&t.complete()},V=X=>C<i?H(X):y.push(X),H=X=>{a&&t.next(X),C++;let oe=!1;xn(n(X,T++)).subscribe(Yn(t,le=>{o?.(le),a?V(le):t.next(le)},()=>{oe=!0},void 0,()=>{if(oe)try{for(C--;y.length&&C<i;){const le=y.shift();u?Qs(t,u,()=>H(le)):H(le)}z()}catch(le){t.error(le)}}))};return e.subscribe(Yn(t,V,()=>{A=!0,z()})),()=>{m?.()}}(i,o,e,n)))}function Aa(e=1/0){return Lt(rs,e)}const ao=new fn(e=>e.complete());function os(e){return e&&Rn(e.schedule)}function ss(e){return e[e.length-1]}function rh(e){return Rn(ss(e))?e.pop():void 0}function pl(e){return os(ss(e))?e.pop():void 0}function Ms(e,t=0){return gi((n,i)=>{n.subscribe(Yn(i,o=>Qs(i,e,()=>i.next(o),t),()=>Qs(i,e,()=>i.complete(),t),o=>Qs(i,e,()=>i.error(o),t)))})}function oc(e,t=0){return gi((n,i)=>{i.add(e.schedule(()=>n.subscribe(i),t))})}function Fd(e,t){if(!e)throw new Error("Iterable cannot be null");return new fn(n=>{Qs(n,t,()=>{const i=e[Symbol.asyncIterator]();Qs(n,t,()=>{i.next().then(o=>{o.done?n.complete():n.next(o.value)})},0,!0)})})}function Li(e,t){return t?function zd(e,t){if(null!=e){if(tt(e))return function ze(e,t){return xn(e).pipe(oc(t),Ms(t))}(e,t);if(_e(e))return function Oi(e,t){return new fn(n=>{let i=0;return t.schedule(function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())})})}(e,t);if(ke(e))return function ea(e,t){return xn(e).pipe(oc(t),Ms(t))}(e,t);if(it(e))return Fd(e,t);if(Ut(e))return function ar(e,t){return new fn(n=>{let i;return Qs(n,t,()=>{i=e[en](),Qs(n,t,()=>{let o,a;try{({value:o,done:a}=i.next())}catch(u){return void n.error(u)}a?n.complete():n.next(o)},0,!0)}),()=>Rn(i?.return)&&i.return()})}(e,t);if(pn(e))return function Is(e,t){return Fd(tn(e),t)}(e,t)}throw Je(e)}(e,t):xn(e)}function ln(e,t,...n){if(!0===t)return void e();if(!1===t)return;const i=new ll({next:()=>{i.unsubscribe(),e()}});return xn(t(...n)).subscribe(i)}function yt(e){for(let t in e)if(e[t]===yt)return t;throw Error("Could not find renamed property on target object.")}function Hr(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function Tn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Tn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function nn(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const bo=yt({__forward_ref__:yt});function Hn(e){return e.__forward_ref__=Hn,e.toString=function(){return Tn(this())},e}function Pt(e){return lo(e)?e():e}function lo(e){return"function"==typeof e&&e.hasOwnProperty(bo)&&e.__forward_ref__===Hn}function ii(e){return e&&!!e.\u0275providers}const As="https://g.co/ng/security#xss";class nt extends Error{constructor(t,n){super(Pa(t,n)),this.code=t}}function Pa(e,t){return`NG0${Math.abs(e)}${t?": "+t.trim():""}`}function Jt(e){return"string"==typeof e?e:null==e?"":String(e)}function ta(e,t){throw new nt(-201,!1)}function co(e,t){null==e&&function On(e,t,n,i){throw new Error(`ASSERTION ERROR: ${e}`+(null==i?"":` [Expected=> ${n} ${i} ${t} <=Actual]`))}(t,e,null,"!=")}function At(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ui(e){return{providers:e.providers||[],imports:e.imports||[]}}function wo(e){return Ra(e,Vo)||Ra(e,yl)}function Ra(e,t){return e.hasOwnProperty(t)?e[t]:null}function ac(e){return e&&(e.hasOwnProperty(lc)||e.hasOwnProperty(Jc))?e[lc]:null}const Vo=yt({\u0275prov:yt}),lc=yt({\u0275inj:yt}),yl=yt({ngInjectableDef:yt}),Jc=yt({ngInjectorDef:yt});var Nt=(()=>((Nt=Nt||{})[Nt.Default=0]="Default",Nt[Nt.Host=1]="Host",Nt[Nt.Self=2]="Self",Nt[Nt.SkipSelf=4]="SkipSelf",Nt[Nt.Optional=8]="Optional",Nt))();let cc;function uo(e){const t=cc;return cc=e,t}function vl(e,t,n){const i=wo(e);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:n&Nt.Optional?null:void 0!==t?t:void ta(Tn(e))}const hi=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),uc={},Qc="__NG_DI_FLAG__",ia="ngTempTokenPath",lh="ngTokenPath",hc=/\n/gm,ra="\u0275",Oa="__source";let La;function xl(e){const t=La;return La=e,t}function eu(e,t=Nt.Default){if(void 0===La)throw new nt(-203,!1);return null===La?vl(e,void 0,t):La.get(e,t&Nt.Optional?null:void 0,t)}function Dt(e,t=Nt.Default){return(function jd(){return cc}()||eu)(Pt(e),t)}function cn(e,t=Nt.Default){return Dt(e,bl(t))}function bl(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function tu(e){const t=[];for(let n=0;n<e.length;n++){const i=Pt(e[n]);if(Array.isArray(i)){if(0===i.length)throw new nt(900,!1);let o,a=Nt.Default;for(let u=0;u<i.length;u++){const m=i[u],y=nu(m);"number"==typeof y?-1===y?o=m.token:a|=y:o=m}t.push(Dt(o,a))}else t.push(Dt(i))}return t}function mn(e,t){return e[Qc]=t,e.prototype[Qc]=t,e}function nu(e){return e[Qc]}function Ps(e){return{toString:e}.toString()}var Mr=(()=>((Mr=Mr||{})[Mr.OnPush=0]="OnPush",Mr[Mr.Default=1]="Default",Mr))(),jo=(()=>{return(e=jo||(jo={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",jo;var e})();const oa={},Vn=[],uh=yt({\u0275cmp:yt}),iu=yt({\u0275dir:yt}),ru=yt({\u0275pipe:yt}),hh=yt({\u0275mod:yt}),Uo=yt({\u0275fac:yt}),dc=yt({__NG_ELEMENT_ID__:yt});let Ap=0;function ks(e){return Ps(()=>{const t=su(e),n={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Mr.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,data:e.data||{},encapsulation:e.encapsulation||jo.Emulated,id:"c"+Ap++,styles:e.styles||Vn,_:null,schemas:e.schemas||null,tView:null};mc(n);const i=e.dependencies;return n.directiveDefs=au(i,!1),n.pipeDefs=au(i,!0),n})}function fc(e){return An(e)||mr(e)}function $d(e){return null!==e}function lr(e){return Ps(()=>({type:e.type,bootstrap:e.bootstrap||Vn,declarations:e.declarations||Vn,imports:e.imports||Vn,exports:e.exports||Vn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function ls(e,t){if(null==e)return oa;const n={};for(const i in e)if(e.hasOwnProperty(i)){let o=e[i],a=o;Array.isArray(o)&&(a=o[1],o=o[0]),n[o]=i,t&&(t[o]=a)}return n}function Ft(e){return Ps(()=>{const t=su(e);return mc(t),t})}function Ir(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function An(e){return e[uh]||null}function mr(e){return e[iu]||null}function Ar(e){return e[ru]||null}function Gr(e,t){const n=e[hh]||null;if(!n&&!0===t)throw new Error(`Type ${Tn(e)} does not have '\u0275mod' property.`);return n}function su(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,exportAs:e.exportAs||null,standalone:!0===e.standalone,selectors:e.selectors||Vn,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:ls(e.inputs,t),outputs:ls(e.outputs)}}function mc(e){e.features?.forEach(t=>t(e))}function au(e,t){if(!e)return null;const n=t?Ar:fc;return()=>("function"==typeof e?e():e).map(i=>n(i)).filter($d)}const cs=0,wt=1,un=2,bi=3,Wr=4,Fa=5,Ki=6,wl=7,li=8,dh=9,fh=10,_n=11,Gd=12,lu=13,Wd=14,sa=15,Ni=16,gc=17,Cl=18,cr=19,za=20,Co=21,Kn=22,aa=1,El=2,Dl=7,Tl=8,gn=9,Ji=10;function Pr(e){return Array.isArray(e)&&"object"==typeof e[aa]}function kr(e){return Array.isArray(e)&&!0===e[aa]}function ph(e){return 0!=(4&e.flags)}function Na(e){return e.componentOffset>-1}function $o(e){return 1==(1&e.flags)}function Ho(e){return!!e.template}function mh(e){return 0!=(256&e[un])}function la(e,t){return e.hasOwnProperty(Uo)?e[Uo]:null}class Dg{constructor(t,n,i){this.previousValue=t,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}}function qr(){return Sl}function Sl(e){return e.type.prototype.ngOnChanges&&(e.setInput=Qd),Jd}function Jd(){const e=du(this),t=e?.current;if(t){const n=e.previous;if(n===oa)e.previous=t;else for(let i in t)n[i]=t[i];e.current=null,this.ngOnChanges(t)}}function Qd(e,t,n,i){const o=this.declaredInputs[n],a=du(e)||function fu(e,t){return e[wh]=t}(e,{previous:oa,current:null}),u=a.current||(a.current={}),m=a.previous,y=m[o];u[o]=new Dg(y&&y.currentValue,t,m===oa),e[i]=t}qr.ngInherit=!0;const wh="__ngSimpleChanges__";function du(e){return e[wh]||null}const Eo=function(e,t,n){};function _i(e){for(;Array.isArray(e);)e=e[cs];return e}function pu(e,t){return _i(t[e])}function Do(e,t){return _i(t[e.index])}function Eh(e,t){return e.data[t]}function Il(e,t){return e[t]}function Zr(e,t){const n=t[e];return Pr(n)?n:n[cs]}function Dh(e){return 64==(64&e[un])}function Ba(e,t){return null==t?null:e[t]}function Op(e){e[Cl]=0}function ho(e,t){e[Fa]+=t;let n=e,i=e[bi];for(;null!==i&&(1===t&&1===n[Fa]||-1===t&&0===n[Fa]);)i[Fa]+=t,n=i,i=i[bi]}const rn={lFrame:J(null),bindingsEnabled:!0};function pt(){return rn.bindingsEnabled}function Ze(){return rn.lFrame.lView}function yn(){return rn.lFrame.tView}function ot(e){return rn.lFrame.contextLView=e,e[li]}function Fs(e){return rn.lFrame.contextLView=null,e}function _r(){let e=sf();for(;null!==e&&64===e.type;)e=e.parent;return e}function sf(){return rn.lFrame.currentTNode}function us(e,t){const n=rn.lFrame;n.currentTNode=e,n.isParent=t}function Sh(){return rn.lFrame.isParent}function af(){rn.lFrame.isParent=!1}function yr(){const e=rn.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function c(){return rn.lFrame.bindingIndex++}function E(e,t){const n=rn.lFrame;n.bindingIndex=n.bindingRootIndex=e,I(t)}function I(e){rn.lFrame.currentDirectiveIndex=e}function L(e){rn.lFrame.currentQueryIndex=e}function j(e){const t=e[wt];return 2===t.type?t.declTNode:1===t.type?e[Ki]:null}function q(e,t,n){if(n&Nt.SkipSelf){let o=t,a=e;for(;!(o=o.parent,null!==o||n&Nt.Host||(o=j(a),null===o||(a=a[sa],10&o.type))););if(null===o)return!1;t=o,e=a}const i=rn.lFrame=Q();return i.currentTNode=t,i.lView=e,!0}function K(e){const t=Q(),n=e[wt];rn.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function Q(){const e=rn.lFrame,t=null===e?null:e.child;return null===t?J(e):t}function J(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function ee(){const e=rn.lFrame;return rn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const U=ee;function Y(){const e=ee();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function fe(){return rn.lFrame.selectedIndex}function ge(e){rn.lFrame.selectedIndex=e}function de(){const e=rn.lFrame;return Eh(e.tView,e.selectedIndex)}function Pe(e,t){for(let n=t.directiveStart,i=t.directiveEnd;n<i;n++){const a=e.data[n].type.prototype,{ngAfterContentInit:u,ngAfterContentChecked:m,ngAfterViewInit:y,ngAfterViewChecked:C,ngOnDestroy:T}=a;u&&(e.contentHooks??(e.contentHooks=[])).push(-n,u),m&&((e.contentHooks??(e.contentHooks=[])).push(n,m),(e.contentCheckHooks??(e.contentCheckHooks=[])).push(n,m)),y&&(e.viewHooks??(e.viewHooks=[])).push(-n,y),C&&((e.viewHooks??(e.viewHooks=[])).push(n,C),(e.viewCheckHooks??(e.viewCheckHooks=[])).push(n,C)),null!=T&&(e.destroyHooks??(e.destroyHooks=[])).push(n,T)}}function We(e,t,n){Ye(e,t,3,n)}function Se(e,t,n,i){(3&e[un])===n&&Ye(e,t,n,i)}function Ne(e,t){let n=e[un];(3&n)===t&&(n&=2047,n+=1,e[un]=n)}function Ye(e,t,n,i){const a=i??-1,u=t.length-1;let m=0;for(let y=void 0!==i?65535&e[Cl]:0;y<u;y++)if("number"==typeof t[y+1]){if(m=t[y],null!=i&&m>=i)break}else t[y]<0&&(e[Cl]+=65536),(m<a||-1==a)&&($e(e,n,t,y),e[Cl]=(4294901760&e[Cl])+y+2),y++}function $e(e,t,n,i){const o=n[i]<0,a=n[i+1],m=e[o?-n[i]:n[i]];if(o){if(e[un]>>11<e[Cl]>>16&&(3&e[un])===t){e[un]+=2048,Eo(4,m,a);try{a.call(m)}finally{Eo(5,m,a)}}}else{Eo(4,m,a);try{a.call(m)}finally{Eo(5,m,a)}}}const qe=-1;class _t{constructor(t,n,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=i}}function Fn(e,t,n){let i=0;for(;i<n.length;){const o=n[i];if("number"==typeof o){if(0!==o)break;i++;const a=n[i++],u=n[i++],m=n[i++];e.setAttribute(t,u,m,a)}else{const a=o,u=n[++i];vr(a)?e.setProperty(t,a,u):e.setAttribute(t,a,u),i++}}return i}function jn(e){return 3===e||4===e||6===e}function vr(e){return 64===e.charCodeAt(0)}function Si(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let i=0;i<t.length;i++){const o=t[i];"number"==typeof o?n=o:0===n||To(e,n,o,null,-1===n||2===n?t[++i]:null)}}return e}function To(e,t,n,i,o){let a=0,u=e.length;if(-1===t)u=-1;else for(;a<e.length;){const m=e[a++];if("number"==typeof m){if(m===t){u=-1;break}if(m>t){u=a-1;break}}}for(;a<e.length;){const m=e[a];if("number"==typeof m)break;if(m===n){if(null===i)return void(null!==o&&(e[a+1]=o));if(i===e[a+1])return void(e[a+2]=o)}a++,null!==i&&a++,null!==o&&a++}-1!==u&&(e.splice(u,0,t),a=u+1),e.splice(a++,0,n),null!==i&&e.splice(a++,0,i),null!==o&&e.splice(a++,0,o)}function hs(e){return e!==qe}function Qn(e){return 32767&e}function bn(e,t){let n=function Gn(e){return e>>16}(e),i=t;for(;n>0;)i=i[sa],n--;return i}let wi=!0;function ur(e){const t=wi;return wi=e,t}const Xr=255,mu=5;let kl=0;const po={};function ds(e,t){const n=gu(e,t);if(-1!==n)return n;const i=t[wt];i.firstCreatePass&&(e.injectorIndex=t.length,ua(i.data,e),ua(t,null),ua(i.blueprint,null));const o=Rl(e,t),a=e.injectorIndex;if(hs(o)){const u=Qn(o),m=bn(o,t),y=m[wt].data;for(let C=0;C<8;C++)t[a+C]=m[u+C]|y[u+C]}return t[a+8]=o,a}function ua(e,t){e.push(0,0,0,0,0,0,0,0,t)}function gu(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function Rl(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,i=null,o=t;for(;null!==o;){if(i=Ah(o),null===i)return qe;if(n++,o=o[sa],-1!==i.injectorIndex)return i.injectorIndex|n<<16}return qe}function _u(e,t,n){!function ca(e,t,n){let i;"string"==typeof n?i=n.charCodeAt(0)||0:n.hasOwnProperty(dc)&&(i=n[dc]),null==i&&(i=n[dc]=kl++);const o=i&Xr;t.data[e+(o>>mu)]|=1<<o}(e,t,n)}function Sg(e,t,n){if(n&Nt.Optional||void 0!==e)return e;ta()}function ov(e,t,n,i){if(n&Nt.Optional&&void 0===i&&(i=null),!(n&(Nt.Self|Nt.Host))){const o=e[dh],a=uo(void 0);try{return o?o.get(t,i,n&Nt.Optional):vl(t,i,n&Nt.Optional)}finally{uo(a)}}return Sg(i,0,n)}function zp(e,t,n,i=Nt.Default,o){if(null!==e){if(1024&t[un]){const u=function Ag(e,t,n,i,o){let a=e,u=t;for(;null!==a&&null!==u&&1024&u[un]&&!(256&u[un]);){const m=lf(a,u,n,i|Nt.Self,po);if(m!==po)return m;let y=a.parent;if(!y){const C=u[Co];if(C){const T=C.get(n,po,i);if(T!==po)return T}y=Ah(u),u=u[sa]}a=y}return o}(e,t,n,i,po);if(u!==po)return u}const a=lf(e,t,n,i,po);if(a!==po)return a}return ov(t,n,i,o)}function lf(e,t,n,i,o){const a=function Ol(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(dc)?e[dc]:void 0;return"number"==typeof t?t>=0?t&Xr:l1:t}(n);if("function"==typeof a){if(!q(t,e,i))return i&Nt.Host?Sg(o,0,i):ov(t,n,i,o);try{const u=a(i);if(null!=u||i&Nt.Optional)return u;ta()}finally{U()}}else if("number"==typeof a){let u=null,m=gu(e,t),y=qe,C=i&Nt.Host?t[Ni][Ki]:null;for((-1===m||i&Nt.SkipSelf)&&(y=-1===m?Rl(e,t):t[m+8],y!==qe&&Mg(i,!1)?(u=t[wt],m=Qn(y),t=bn(y,t)):m=-1);-1!==m;){const T=t[wt];if(cf(a,m,T.data)){const A=sv(m,t,n,u,i,C);if(A!==po)return A}y=t[m+8],y!==qe&&Mg(i,t[wt].data[m+8]===C)&&cf(a,m,t)?(u=T,m=Qn(y),t=bn(y,t)):m=-1}}return o}function sv(e,t,n,i,o,a){const u=t[wt],m=u.data[e+8],T=function Ih(e,t,n,i,o){const a=e.providerIndexes,u=t.data,m=1048575&a,y=e.directiveStart,T=a>>20,z=o?m+T:e.directiveEnd;for(let V=i?m:m+T;V<z;V++){const H=u[V];if(V<y&&n===H||V>=y&&H.type===n)return V}if(o){const V=u[y];if(V&&Ho(V)&&V.type===n)return y}return null}(m,u,n,null==i?Na(m)&&wi:i!=u&&0!=(3&m.type),o&Nt.Host&&a===m);return null!==T?Va(t,u,T,m):po}function Va(e,t,n,i){let o=e[n];const a=t.data;if(function zt(e){return e instanceof _t}(o)){const u=o;u.resolving&&function Yc(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new nt(-200,`Circular dependency in DI detected for ${e}${n}`)}(function Bn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Jt(e)}(a[n]));const m=ur(u.canSeeViewProviders);u.resolving=!0;const y=u.injectImpl?uo(u.injectImpl):null;q(e,i,Nt.Default);try{o=e[n]=u.factory(void 0,a,e,i),t.firstCreatePass&&n>=i.directiveStart&&function je(e,t,n){const{ngOnChanges:i,ngOnInit:o,ngDoCheck:a}=t.type.prototype;if(i){const u=Sl(t);(n.preOrderHooks??(n.preOrderHooks=[])).push(e,u),(n.preOrderCheckHooks??(n.preOrderCheckHooks=[])).push(e,u)}o&&(n.preOrderHooks??(n.preOrderHooks=[])).push(0-e,o),a&&((n.preOrderHooks??(n.preOrderHooks=[])).push(e,a),(n.preOrderCheckHooks??(n.preOrderCheckHooks=[])).push(e,a))}(n,a[n],t)}finally{null!==y&&uo(y),ur(m),u.resolving=!1,U()}}return o}function cf(e,t,n){return!!(n[t+(e>>mu)]&1<<e)}function Mg(e,t){return!(e&Nt.Self||e&Nt.Host&&t)}class yu{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,i){return zp(this._tNode,this._lView,t,bl(i),n)}}function l1(){return new yu(_r(),Ze())}function Yr(e){return Ps(()=>{const t=e.prototype.constructor,n=t[Uo]||Ig(t),i=Object.prototype;let o=Object.getPrototypeOf(e.prototype).constructor;for(;o&&o!==i;){const a=o[Uo]||Ig(o);if(a&&a!==n)return a;o=Object.getPrototypeOf(o)}return a=>new a})}function Ig(e){return lo(e)?()=>{const t=Ig(Pt(e));return t&&t()}:la(e)}function Ah(e){const t=e[wt],n=t.type;return 2===n?t.declTNode:1===n?e[Ki]:null}const mo="__parameters__";function Ph(e,t,n){return Ps(()=>{const i=function zl(e){return function(...n){if(e){const i=e(...n);for(const o in i)this[o]=i[o]}}}(t);function o(...a){if(this instanceof o)return i.apply(this,a),this;const u=new o(...a);return m.annotation=u,m;function m(y,C,T){const A=y.hasOwnProperty(mo)?y[mo]:Object.defineProperty(y,mo,{value:[]})[mo];for(;A.length<=T;)A.push(null);return(A[T]=A[T]||[]).push(u),y}}return n&&(o.prototype=Object.create(n.prototype)),o.prototype.ngMetadataName=e,o.annotationCls=o,o})}class Mt{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=At({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function ha(e,t){e.forEach(n=>Array.isArray(n)?ha(n,t):t(n))}function yc(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function kh(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function Wo(e,t,n){let i=da(e,t);return i>=0?e[1|i]=n:(i=~i,function f1(e,t,n,i){let o=e.length;if(o==t)e.push(n,i);else if(1===o)e.push(i,e[0]),e[0]=n;else{for(o--,e.push(e[o-1],e[o]);o>t;)e[o]=e[o-2],o--;e[t]=n,e[t+1]=i}}(e,i,t,n)),i}function vu(e,t){const n=da(e,t);if(n>=0)return e[1|n]}function da(e,t){return function Bp(e,t,n){let i=0,o=e.length>>n;for(;o!==i;){const a=i+(o-i>>1),u=e[a<<n];if(t===u)return a<<n;u>t?o=a:i=a+1}return~(o<<n)}(e,t,1)}const Oh=mn(Ph("Optional"),8),Mo=mn(Ph("SkipSelf"),4);var Kr=(()=>((Kr=Kr||{})[Kr.Important=1]="Important",Kr[Kr.DashCase=2]="DashCase",Kr))();const Cc=new Map;let _v=0;const yf="__ngContext__";function Ci(e,t){Pr(t)?(e[yf]=t[za],function yv(e){Cc.set(e[za],e)}(t)):e[yf]=t}let Wg;function vf(e,t){return Wg(e,t)}function xf(e){const t=e[bi];return kr(t)?t[bi]:t}function jh(e){return Hp(e[lu])}function Uh(e){return Hp(e[Wr])}function Hp(e){for(;null!==e&&!kr(e);)e=e[Wr];return e}function Eu(e,t,n,i,o){if(null!=i){let a,u=!1;kr(i)?a=i:Pr(i)&&(u=!0,i=i[cs]);const m=_i(i);0===e&&null!==n?null==o?Kg(t,n,m):Tu(t,n,m,o||null,!0):1===e&&null!==n?Tu(t,n,m,o||null,!0):2===e?function $h(e,t,n){const i=Cf(e,t);i&&function E1(e,t,n,i){e.removeChild(t,n,i)}(e,i,t,n)}(t,m,u):3===e&&t.destroyNode(m),null!=a&&function T1(e,t,n,i,o){const a=n[Dl];a!==_i(n)&&Eu(t,e,i,a,o);for(let m=Ji;m<n.length;m++){const y=n[m];pa(y[wt],y,e,t,i,a)}}(t,e,a,n,o)}}function bf(e,t,n){return e.createElement(t,n)}function Dv(e,t){const n=e[gn],i=n.indexOf(t),o=t[bi];512&t[un]&&(t[un]&=-513,ho(o,-1)),n.splice(i,1)}function Ec(e,t){if(e.length<=Ji)return;const n=Ji+t,i=e[n];if(i){const o=i[gc];null!==o&&o!==e&&Dv(o,i),t>0&&(e[n-1][Wr]=i[Wr]);const a=kh(e,Ji+t);!function w1(e,t){pa(e,t,t[_n],2,null,null),t[cs]=null,t[Ki]=null}(i[wt],i);const u=a[cr];null!==u&&u.detachView(a[wt]),i[bi]=null,i[Wr]=null,i[un]&=-65}return i}function wf(e,t){if(!(128&t[un])){const n=t[_n];n.destroyNode&&pa(e,t,n,3,null,null),function Cv(e){let t=e[lu];if(!t)return Gp(e[wt],e);for(;t;){let n=null;if(Pr(t))n=t[lu];else{const i=t[Ji];i&&(n=i)}if(!n){for(;t&&!t[Wr]&&t!==e;)Pr(t)&&Gp(t[wt],t),t=t[bi];null===t&&(t=e),Pr(t)&&Gp(t[wt],t),n=t&&t[Wr]}t=n}}(t)}}function Gp(e,t){if(!(128&t[un])){t[un]&=-65,t[un]|=128,function C1(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let i=0;i<n.length;i+=2){const o=t[n[i]];if(!(o instanceof _t)){const a=n[i+1];if(Array.isArray(a))for(let u=0;u<a.length;u+=2){const m=o[a[u]],y=a[u+1];Eo(4,m,y);try{y.call(m)}finally{Eo(5,m,y)}}else{Eo(4,o,a);try{a.call(o)}finally{Eo(5,o,a)}}}}}(e,t),function Tv(e,t){const n=e.cleanup,i=t[wl];let o=-1;if(null!==n)for(let a=0;a<n.length-1;a+=2)if("string"==typeof n[a]){const u=n[a+3];u>=0?i[o=u]():i[o=-u].unsubscribe(),a+=2}else{const u=i[o=n[a+1]];n[a].call(u)}if(null!==i){for(let a=o+1;a<i.length;a++)(0,i[a])();t[wl]=null}}(e,t),1===t[wt].type&&t[_n].destroy();const n=t[gc];if(null!==n&&kr(t[bi])){n!==t[bi]&&Dv(n,t);const i=t[cr];null!==i&&i.detachView(e)}!function x1(e){Cc.delete(e[za])}(t)}}function Sv(e,t,n){return function Yg(e,t,n){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return n[cs];{const{componentOffset:o}=i;if(o>-1){const{encapsulation:a}=e.data[i.directiveStart+o];if(a===jo.None||a===jo.Emulated)return null}return Do(i,n)}}(e,t.parent,n)}function Tu(e,t,n,i,o){e.insertBefore(t,n,i,o)}function Kg(e,t,n){e.appendChild(t,n)}function Mv(e,t,n,i,o){null!==i?Tu(e,t,n,i,o):Kg(e,t,n)}function Cf(e,t){return e.parentNode(t)}let Jg,Qp,Dc,Ao=function $a(e,t,n){return 40&e.type?Do(e,n):null};function Zp(e,t,n,i){const o=Sv(e,i,t),a=t[_n],m=function Wp(e,t,n){return Ao(e,t,n)}(i.parent||t[Ki],i,t);if(null!=o)if(Array.isArray(n))for(let y=0;y<n.length;y++)Mv(a,o,n[y],m,!1);else Mv(a,o,n,m,!1);void 0!==Jg&&Jg(a,i,t,n,o)}function Xp(e,t){if(null!==t){const n=t.type;if(3&n)return Do(t,e);if(4&n)return Ef(-1,e[t.index]);if(8&n){const i=t.child;if(null!==i)return Xp(e,i);{const o=e[t.index];return kr(o)?Ef(-1,o):_i(o)}}if(32&n)return vf(t,e)()||_i(e[t.index]);{const i=Av(e,t);return null!==i?Array.isArray(i)?i[0]:Xp(xf(e[Ni]),i):Xp(e,t.next)}}return null}function Av(e,t){return null!==t?e[Ni][Ki].projection[t.projection]:null}function Ef(e,t){const n=Ji+e+1;if(n<t.length){const i=t[n],o=i[wt].firstChild;if(null!==o)return Xp(i,o)}return t[Dl]}function Yp(e,t,n,i,o,a,u){for(;null!=n;){const m=i[n.index],y=n.type;if(u&&0===t&&(m&&Ci(_i(m),i),n.flags|=2),32!=(32&n.flags))if(8&y)Yp(e,t,n.child,i,o,a,!1),Eu(t,e,o,m,a);else if(32&y){const C=vf(n,i);let T;for(;T=C();)Eu(t,e,o,T,a);Eu(t,e,o,m,a)}else 16&y?Pv(e,t,i,n,o,a):Eu(t,e,o,m,a);n=u?n.projectionNext:n.next}}function pa(e,t,n,i,o,a){Yp(n,i,e.firstChild,t,o,a,!1)}function Pv(e,t,n,i,o,a){const u=n[Ni],y=u[Ki].projection[i.projection];if(Array.isArray(y))for(let C=0;C<y.length;C++)Eu(t,e,o,y[C],a);else Yp(e,t,y,u[bi],o,a,!0)}function kv(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function Rv(e,t,n){const{mergedAttrs:i,classes:o,styles:a}=n;null!==i&&Fn(e,t,i),null!==o&&kv(e,t,o),null!==a&&function M1(e,t,n){e.setAttribute(t,"style",n)}(e,t,a)}function nm(e){return function tm(){if(void 0===Dc&&(Dc=null,hi.trustedTypes))try{Dc=hi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Dc}()?.createScriptURL(e)||e}class im{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${As})`}}function Ha(e){return e instanceof im?e.changingThisBreaksApplicationSecurity:e}function If(e,t){const n=function t_(e){return e instanceof im&&e.getTypeName()||null}(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see ${As})`)}return n===t}const O1=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Qi=(()=>((Qi=Qi||{})[Qi.NONE=0]="NONE",Qi[Qi.HTML=1]="HTML",Qi[Qi.STYLE=2]="STYLE",Qi[Qi.SCRIPT=3]="SCRIPT",Qi[Qi.URL=4]="URL",Qi[Qi.RESOURCE_URL=5]="RESOURCE_URL",Qi))();function Zh(e){const t=Vl();return t?t.sanitize(Qi.URL,e)||"":If(e,"URL")?Ha(e):function om(e){return(e=String(e)).match(O1)?e:"unsafe:"+e}(Jt(e))}function Hv(e){const t=Vl();if(t)return nm(t.sanitize(Qi.RESOURCE_URL,e)||"");if(If(e,"ResourceURL"))return nm(Ha(e));throw new nt(904,!1)}function Vl(){const e=Ze();return e&&e[Gd]}const Ff=new Mt("ENVIRONMENT_INITIALIZER"),a_=new Mt("INJECTOR",-1),qv=new Mt("INJECTOR_DEF_TYPES");class Zv{get(t,n=uc){if(n===uc){const i=new Error(`NullInjectorError: No provider for ${Tn(t)}!`);throw i.name="NullInjectorError",i}return n}}function V1(...e){return{\u0275providers:Xv(0,e),\u0275fromNgModule:!0}}function Xv(e,...t){const n=[],i=new Set;let o;return ha(t,a=>{const u=a;Xh(u,n,[],i)&&(o||(o=[]),o.push(u))}),void 0!==o&&Yv(o,n),n}function Yv(e,t){for(let n=0;n<e.length;n++){const{providers:o}=e[n];cm(o,a=>{t.push(a)})}}function Xh(e,t,n,i){if(!(e=Pt(e)))return!1;let o=null,a=ac(e);const u=!a&&An(e);if(a||u){if(u&&!u.standalone)return!1;o=e}else{const y=e.ngModule;if(a=ac(y),!a)return!1;o=y}const m=i.has(o);if(u){if(m)return!1;if(i.add(o),u.dependencies){const y="function"==typeof u.dependencies?u.dependencies():u.dependencies;for(const C of y)Xh(C,t,n,i)}}else{if(!a)return!1;{if(null!=a.imports&&!m){let C;i.add(o);try{ha(a.imports,T=>{Xh(T,t,n,i)&&(C||(C=[]),C.push(T))})}finally{}void 0!==C&&Yv(C,t)}if(!m){const C=la(o)||(()=>new o);t.push({provide:o,useFactory:C,deps:Vn},{provide:qv,useValue:o,multi:!0},{provide:Ff,useValue:()=>Dt(o),multi:!0})}const y=a.providers;null==y||m||cm(y,T=>{t.push(T)})}}return o!==e&&void 0!==e.providers}function cm(e,t){for(let n of e)ii(n)&&(n=n.\u0275providers),Array.isArray(n)?cm(n,t):t(n)}const Kv=yt({provide:String,useValue:yt});function um(e){return null!==e&&"object"==typeof e&&Kv in e}function Su(e){return"function"==typeof e}const l_=new Mt("Set Injector scope."),zf={},U1={};let er;function Ko(){return void 0===er&&(er=new Zv),er}class js{}class Nf extends js{get destroyed(){return this._destroyed}constructor(t,n,i,o){super(),this.parent=n,this.source=i,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,hm(t,u=>this.processProvider(u)),this.records.set(a_,Kh(void 0,this)),o.has("environment")&&this.records.set(js,Kh(void 0,this));const a=this.records.get(l_);null!=a&&"string"==typeof a.value&&this.scopes.add(a.value),this.injectorDefTypes=new Set(this.get(qv.multi,Vn,Nt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const n=xl(this),i=uo(void 0);try{return t()}finally{xl(n),uo(i)}}get(t,n=uc,i=Nt.Default){this.assertNotDestroyed(),i=bl(i);const o=xl(this),a=uo(void 0);try{if(!(i&Nt.SkipSelf)){let m=this.records.get(t);if(void 0===m){const y=function t0(e){return"function"==typeof e||"object"==typeof e&&e instanceof Mt}(t)&&wo(t);m=y&&this.injectableDefInScope(y)?Kh(Tc(t),zf):null,this.records.set(t,m)}if(null!=m)return this.hydrate(t,m)}return(i&Nt.Self?Ko():this.parent).get(t,n=i&Nt.Optional&&n===uc?null:n)}catch(u){if("NullInjectorError"===u.name){if((u[ia]=u[ia]||[]).unshift(Tn(t)),o)throw u;return function Ip(e,t,n,i){const o=e[ia];throw t[Oa]&&o.unshift(t[Oa]),e.message=function Ud(e,t,n,i=null){e=e&&"\n"===e.charAt(0)&&e.charAt(1)==ra?e.slice(2):e;let o=Tn(t);if(Array.isArray(t))o=t.map(Tn).join(" -> ");else if("object"==typeof t){let a=[];for(let u in t)if(t.hasOwnProperty(u)){let m=t[u];a.push(u+":"+("string"==typeof m?JSON.stringify(m):Tn(m)))}o=`{${a.join(", ")}}`}return`${n}${i?"("+i+")":""}[${o}]: ${e.replace(hc,"\n  ")}`}("\n"+e.message,o,n,i),e[lh]=o,e[ia]=null,e}(u,t,"R3InjectorError",this.source)}throw u}finally{uo(a),xl(o)}}resolveInjectorInitializers(){const t=xl(this),n=uo(void 0);try{const i=this.get(Ff.multi,Vn,Nt.Self);for(const o of i)o()}finally{xl(t),uo(n)}}toString(){const t=[],n=this.records;for(const i of n.keys())t.push(Tn(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new nt(205,!1)}processProvider(t){let n=Su(t=Pt(t))?t:Pt(t&&t.provide);const i=function H1(e){return um(e)?Kh(void 0,e.useValue):Kh(Yh(e),zf)}(t);if(Su(t)||!0!==t.multi)this.records.get(n);else{let o=this.records.get(n);o||(o=Kh(void 0,zf,!0),o.factory=()=>tu(o.multi),this.records.set(n,o)),n=t,o.multi.push(t)}this.records.set(n,i)}hydrate(t,n){return n.value===zf&&(n.value=U1,n.value=n.factory()),"object"==typeof n.value&&n.value&&function e0(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=Pt(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}}function Tc(e){const t=wo(e),n=null!==t?t.factory:la(e);if(null!==n)return n;if(e instanceof Mt)throw new nt(204,!1);if(e instanceof Function)return function $1(e){const t=e.length;if(t>0)throw function vc(e,t){const n=[];for(let i=0;i<e;i++)n.push(t);return n}(t,"?"),new nt(204,!1);const n=function na(e){return e&&(e[Vo]||e[yl])||null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new nt(204,!1)}function Yh(e,t,n){let i;if(Su(e)){const o=Pt(e);return la(o)||Tc(o)}if(um(e))i=()=>Pt(e.useValue);else if(function Qv(e){return!(!e||!e.useFactory)}(e))i=()=>e.useFactory(...tu(e.deps||[]));else if(function Jv(e){return!(!e||!e.useExisting)}(e))i=()=>Dt(Pt(e.useExisting));else{const o=Pt(e&&(e.useClass||e.provide));if(!function G1(e){return!!e.deps}(e))return la(o)||Tc(o);i=()=>new o(...tu(e.deps))}return i}function Kh(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function hm(e,t){for(const n of e)Array.isArray(n)?hm(n,t):n&&ii(n)?hm(n.\u0275providers,t):t(n)}class ei{}class dm{}class Jh{resolveComponentFactory(t){throw function n0(e){const t=Error(`No component factory found for ${Tn(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let Qh=(()=>{class e{}return e.NULL=new Jh,e})();function W1(){return ed(_r(),Ze())}function ed(e,t){return new Po(Do(e,t))}let Po=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=W1,e})();class u_{}let jl=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>function Z1(){const e=Ze(),n=Zr(_r().index,e);return(Pr(n)?n:e)[_n]}(),e})(),X1=(()=>{class e{}return e.\u0275prov=At({token:e,providedIn:"root",factory:()=>null}),e})();class Bf{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const fm=new Bf("15.2.10"),Mc={},pm="ngOriginalError";function Vf(e){return e[pm]}class td{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&Vf(t);for(;n&&Vf(n);)n=Vf(n);return n||null}}function Ga(e){return e instanceof Function?e():e}function p_(e,t,n){let i=e.length;for(;;){const o=e.indexOf(t,n);if(-1===o)return o;if(0===o||e.charCodeAt(o-1)<=32){const a=t.length;if(o+a===i||e.charCodeAt(o+a)<=32)return o}n=o+1}}const l0="ng-template";function c0(e,t,n){let i=0,o=!0;for(;i<e.length;){let a=e[i++];if("string"==typeof a&&o){const u=e[i++];if(n&&"class"===a&&-1!==p_(u.toLowerCase(),t,0))return!0}else{if(1===a){for(;i<e.length&&"string"==typeof(a=e[i++]);)if(a.toLowerCase()===t)return!0;return!1}"number"==typeof a&&(o=!1)}}return!1}function m_(e){return 4===e.type&&e.value!==l0}function g_(e,t,n){return t===(4!==e.type||n?e.value:l0)}function u0(e,t,n){let i=4;const o=e.attrs||[],a=function f0(e){for(let t=0;t<e.length;t++)if(jn(e[t]))return t;return e.length}(o);let u=!1;for(let m=0;m<t.length;m++){const y=t[m];if("number"!=typeof y){if(!u)if(4&i){if(i=2|1&i,""!==y&&!g_(e,y,n)||""===y&&1===t.length){if(ma(i))return!1;u=!0}}else{const C=8&i?y:t[++m];if(8&i&&null!==e.attrs){if(!c0(e.attrs,C,n)){if(ma(i))return!1;u=!0}continue}const A=h0(8&i?"class":y,o,m_(e),n);if(-1===A){if(ma(i))return!1;u=!0;continue}if(""!==C){let z;z=A>a?"":o[A+1].toLowerCase();const V=8&i?z:null;if(V&&-1!==p_(V,C,0)||2&i&&C!==z){if(ma(i))return!1;u=!0}}}}else{if(!u&&!ma(i)&&!ma(y))return!1;if(u&&ma(y))continue;u=!1,i=y|1&i}}return ma(i)||u}function ma(e){return 0==(1&e)}function h0(e,t,n,i){if(null===t)return-1;let o=0;if(i||!n){let a=!1;for(;o<t.length;){const u=t[o];if(u===e)return o;if(3===u||6===u)a=!0;else{if(1===u||2===u){let m=t[++o];for(;"string"==typeof m;)m=t[++o];continue}if(4===u)break;if(0===u){o+=4;continue}}o+=a?1:2}return-1}return function p0(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const i=e[n];if("number"==typeof i)return-1;if(i===t)return n;n++}return-1}(t,e)}function Wa(e,t,n=!1){for(let i=0;i<t.length;i++)if(u0(e,t[i],n))return!0;return!1}function g0(e,t){return e?":not("+t.trim()+")":t}function Q1(e){let t=e[0],n=1,i=2,o="",a=!1;for(;n<e.length;){let u=e[n];if("string"==typeof u)if(2&i){const m=e[++n];o+="["+u+(m.length>0?'="'+m+'"':"")+"]"}else 8&i?o+="."+u:4&i&&(o+=" "+u);else""!==o&&!ma(u)&&(t+=g0(a,o),o=""),i=u,a=a||!ma(i);n++}return""!==o&&(t+=g0(a,o)),t}const Qt={};function kt(e){__(yn(),Ze(),fe()+e,!1)}function __(e,t,n,i){if(!i)if(3==(3&t[un])){const a=e.preOrderCheckHooks;null!==a&&We(t,a,n)}else{const a=e.preOrderHooks;null!==a&&Se(t,a,0,n)}ge(n)}function b0(e,t=null,n=null,i){const o=w0(e,t,n,i);return o.resolveInjectorInitializers(),o}function w0(e,t=null,n=null,i,o=new Set){const a=[n||Vn,V1(e)];return i=i||("object"==typeof e?void 0:Tn(e)),new Nf(a,t||Ko(),i||null,o)}let qa=(()=>{class e{static create(n,i){if(Array.isArray(n))return b0({name:""},i,n,"");{const o=n.name??"";return b0({name:o},n.parent,n.providers,o)}}}return e.THROW_IF_NOT_FOUND=uc,e.NULL=new Zv,e.\u0275prov=At({token:e,providedIn:"any",factory:()=>Dt(a_)}),e.__NG_ELEMENT_ID__=-1,e})();function Qe(e,t=Nt.Default){const n=Ze();return null===n?Dt(e,t):zp(_r(),n,Pt(e),t)}function M0(e,t){const n=e.contentQueries;if(null!==n)for(let i=0;i<n.length;i+=2){const a=n[i+1];if(-1!==a){const u=e.data[a];L(n[i]),u.contentQueries(2,t[a],a)}}}function Gf(e,t,n,i,o,a,u,m,y,C,T){const A=t.blueprint.slice();return A[cs]=o,A[un]=76|i,(null!==T||e&&1024&e[un])&&(A[un]|=1024),Op(A),A[bi]=A[sa]=e,A[li]=n,A[fh]=u||e&&e[fh],A[_n]=m||e&&e[_n],A[Gd]=y||e&&e[Gd]||null,A[dh]=C||e&&e[dh]||null,A[Ki]=a,A[za]=function Ug(){return _v++}(),A[Co]=T,A[Ni]=2==t.type?e[Ni]:A,A}function ud(e,t,n,i,o){let a=e.data[t];if(null===a)a=function ym(e,t,n,i,o){const a=sf(),u=Sh(),y=e.data[t]=function xm(e,t,n,i,o,a){return{type:n,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:a,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,u?a:a&&a.parent,n,t,i,o);return null===e.firstChild&&(e.firstChild=y),null!==a&&(u?null==a.child&&null!==y.parent&&(a.child=y):null===a.next&&(a.next=y,y.prev=a)),y}(e,t,n,i,o),function v(){return rn.lFrame.inI18n}()&&(a.flags|=32);else if(64&a.type){a.type=n,a.value=i,a.attrs=o;const u=function Pl(){const e=rn.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();a.injectorIndex=null===u?-1:u.injectorIndex}return us(a,!0),a}function Wf(e,t,n,i){if(0===n)return-1;const o=t.length;for(let a=0;a<n;a++)t.push(i),e.blueprint.push(i),e.data.push(null);return o}function T_(e,t,n){K(t);try{const i=e.viewQuery;null!==i&&Kf(1,i,n);const o=e.template;null!==o&&qf(e,t,o,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&M0(e,t),e.staticViewQueries&&Kf(2,e.viewQuery,n);const a=e.components;null!==a&&function ow(e,t){for(let n=0;n<t.length;n++)j0(e,t[n])}(t,a)}catch(i){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),i}finally{t[un]&=-5,Y()}}function Pu(e,t,n,i){const o=t[un];if(128!=(128&o)){K(t);try{Op(t),function g(e){return rn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&qf(e,t,n,2,i);const u=3==(3&o);if(u){const C=e.preOrderCheckHooks;null!==C&&We(t,C,null)}else{const C=e.preOrderHooks;null!==C&&Se(t,C,0,null),Ne(t,0)}if(function B0(e){for(let t=jh(e);null!==t;t=Uh(t)){if(!t[El])continue;const n=t[gn];for(let i=0;i<n.length;i++){const o=n[i];512&o[un]||ho(o[bi],1),o[un]|=512}}}(t),function N0(e){for(let t=jh(e);null!==t;t=Uh(t))for(let n=Ji;n<t.length;n++){const i=t[n],o=i[wt];Dh(i)&&Pu(o,i,o.template,i[li])}}(t),null!==e.contentQueries&&M0(e,t),u){const C=e.contentCheckHooks;null!==C&&We(t,C)}else{const C=e.contentHooks;null!==C&&Se(t,C,1),Ne(t,1)}!function S0(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let i=0;i<n.length;i++){const o=n[i];if(o<0)ge(~o);else{const a=o,u=n[++i],m=n[++i];E(u,a),m(2,t[a])}}}finally{ge(-1)}}(e,t);const m=e.components;null!==m&&function I0(e,t){for(let n=0;n<t.length;n++)V0(e,t[n])}(t,m);const y=e.viewQuery;if(null!==y&&Kf(2,y,i),u){const C=e.viewCheckHooks;null!==C&&We(t,C)}else{const C=e.viewHooks;null!==C&&Se(t,C,2),Ne(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[un]&=-41,512&t[un]&&(t[un]&=-513,ho(t[bi],-1))}finally{Y()}}}function qf(e,t,n,i,o){const a=fe(),u=2&i;try{ge(-1),u&&t.length>Kn&&__(e,t,Kn,!1),Eo(u?2:0,o),n(i,o)}finally{ge(a),Eo(u?3:1,o)}}function hd(e,t,n){if(ph(t)){const o=t.directiveEnd;for(let a=t.directiveStart;a<o;a++){const u=e.data[a];u.contentQueries&&u.contentQueries(1,n[a],a)}}}function S_(e,t,n){pt()&&(function $s(e,t,n,i){const o=n.directiveStart,a=n.directiveEnd;Na(n)&&function k_(e,t,n){const i=Do(t,e),o=vm(n),a=e[fh],u=Cm(e,Gf(e,o,null,n.onPush?32:16,i,t,a,a.createRenderer(i,n),null,null,null));e[t.index]=u}(t,n,e.data[o+n.componentOffset]),e.firstCreatePass||ds(n,t),Ci(i,t);const u=n.initialInputs;for(let m=o;m<a;m++){const y=e.data[m],C=Va(t,e,m,n);Ci(C,t),null!==u&&F0(0,m-o,C,y,0,u),Ho(y)&&(Zr(n.index,t)[li]=Va(t,e,m,n))}}(e,t,n,Do(n,t)),64==(64&n.flags)&&ga(e,t,n))}function Zf(e,t,n=Do){const i=t.localNames;if(null!==i){let o=t.index+1;for(let a=0;a<i.length;a+=2){const u=i[a+1],m=-1===u?n(t,e):e[u];e[o++]=m}}}function vm(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Za(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Za(e,t,n,i,o,a,u,m,y,C){const T=Kn+i,A=T+o,z=function sw(e,t){const n=[];for(let i=0;i<t;i++)n.push(i<e?null:Qt);return n}(T,A),V="function"==typeof C?C():C;return z[wt]={type:e,blueprint:z,template:n,queries:null,viewQuery:m,declTNode:t,data:z.slice().fill(null,T),bindingStartIndex:T,expandoStartIndex:A,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof a?a():a,pipeRegistry:"function"==typeof u?u():u,firstChild:null,schemas:y,consts:V,incompleteFirstPass:!1}}function A0(e,t,n,i){for(let o in e)if(e.hasOwnProperty(o)){n=null===n?{}:n;const a=e[o];null===i?P0(n,t,o,a):i.hasOwnProperty(o)&&P0(n,t,i[o],a)}return n}function P0(e,t,n,i){e.hasOwnProperty(n)?e[n].push(t,i):e[n]=[t,i]}function A_(e,t,n,i){if(pt()){const o=null===i?null:{"":-1},a=function Xa(e,t){const n=e.directiveRegistry;let i=null,o=null;if(n)for(let a=0;a<n.length;a++){const u=n[a];if(Wa(t,u.selectors,!1))if(i||(i=[]),Ho(u))if(null!==u.findHostDirectiveDefs){const m=[];o=o||new Map,u.findHostDirectiveDefs(u,m,o),i.unshift(...m,u),Ya(e,t,m.length)}else i.unshift(u),Ya(e,t,0);else o=o||new Map,u.findHostDirectiveDefs?.(u,i,o),i.push(u)}return null===i?null:[i,o]}(e,n);let u,m;null===a?u=m=null:[u,m]=a,null!==u&&P_(e,t,n,u,o,m),o&&function bm(e,t,n){if(t){const i=e.localNames=[];for(let o=0;o<t.length;o+=2){const a=n[t[o+1]];if(null==a)throw new nt(-301,!1);i.push(t[o],a)}}}(n,i,o)}n.mergedAttrs=Si(n.mergedAttrs,n.attrs)}function P_(e,t,n,i,o,a){for(let C=0;C<i.length;C++)_u(ds(n,t),e,i[C].type);!function O0(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,i.length);for(let C=0;C<i.length;C++){const T=i[C];T.providersResolver&&T.providersResolver(T)}let u=!1,m=!1,y=Wf(e,t,i.length,null);for(let C=0;C<i.length;C++){const T=i[C];n.mergedAttrs=Si(n.mergedAttrs,T.hostAttrs),L0(e,n,t,y,T),R0(y,T,o),null!==T.contentQueries&&(n.flags|=4),(null!==T.hostBindings||null!==T.hostAttrs||0!==T.hostVars)&&(n.flags|=64);const A=T.type.prototype;!u&&(A.ngOnChanges||A.ngOnInit||A.ngDoCheck)&&((e.preOrderHooks??(e.preOrderHooks=[])).push(n.index),u=!0),!m&&(A.ngOnChanges||A.ngDoCheck)&&((e.preOrderCheckHooks??(e.preOrderCheckHooks=[])).push(n.index),m=!0),y++}!function aw(e,t,n){const o=t.directiveEnd,a=e.data,u=t.attrs,m=[];let y=null,C=null;for(let T=t.directiveStart;T<o;T++){const A=a[T],z=n?n.get(A):null,H=z?z.outputs:null;y=A0(A.inputs,T,y,z?z.inputs:null),C=A0(A.outputs,T,C,H);const X=null===y||null===u||m_(t)?null:z0(y,T,u);m.push(X)}null!==y&&(y.hasOwnProperty("class")&&(t.flags|=8),y.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=m,t.inputs=y,t.outputs=C}(e,n,a)}function ga(e,t,n){const i=n.directiveStart,o=n.directiveEnd,a=n.index,u=function M(){return rn.lFrame.currentDirectiveIndex}();try{ge(a);for(let m=i;m<o;m++){const y=e.data[m],C=t[m];I(m),(null!==y.hostBindings||0!==y.hostVars||null!==y.hostAttrs)&&Pc(y,C)}}finally{ge(-1),I(u)}}function Pc(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Ya(e,t,n){t.componentOffset=n,(e.components??(e.components=[])).push(t.index)}function R0(e,t,n){if(n){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)n[t.exportAs[i]]=e;Ho(t)&&(n[""]=e)}}function L0(e,t,n,i,o){e.data[i]=o;const a=o.factory||(o.factory=la(o.type)),u=new _t(a,Ho(o),Qe);e.blueprint[i]=u,n[i]=u,function uw(e,t,n,i,o){const a=o.hostBindings;if(a){let u=e.hostBindingOpCodes;null===u&&(u=e.hostBindingOpCodes=[]);const m=~t.index;(function k0(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(u)!=m&&u.push(m),u.push(n,i,a)}}(e,t,i,Wf(e,n,o.hostVars,Qt),o)}function Ka(e,t,n,i,o,a){const u=Do(e,t);!function wm(e,t,n,i,o,a,u){if(null==a)e.removeAttribute(t,o,n);else{const m=null==u?Jt(a):u(a,i||"",o);e.setAttribute(t,o,m,n)}}(t[_n],u,a,e.value,n,i,o)}function F0(e,t,n,i,o,a){const u=a[t];if(null!==u){const m=i.setInput;for(let y=0;y<u.length;){const C=u[y++],T=u[y++],A=u[y++];null!==m?i.setInput(n,A,C,T):n[T]=A}}}function z0(e,t,n){let i=null,o=0;for(;o<n.length;){const a=n[o];if(0!==a)if(5!==a){if("number"==typeof a)break;if(e.hasOwnProperty(a)){null===i&&(i=[]);const u=e[a];for(let m=0;m<u.length;m+=2)if(u[m]===t){i.push(a,u[m+1],n[o+1]);break}}o+=2}else o+=2;else o+=4}return i}function R_(e,t,n,i){return[e,!0,!1,t,null,0,i,n,null,null]}function V0(e,t){const n=Zr(t,e);if(Dh(n)){const i=n[wt];48&n[un]?Pu(i,n,i.template,n[li]):n[Fa]>0&&Ja(n)}}function Ja(e){for(let i=jh(e);null!==i;i=Uh(i))for(let o=Ji;o<i.length;o++){const a=i[o];if(Dh(a))if(512&a[un]){const u=a[wt];Pu(u,a,u.template,a[li])}else a[Fa]>0&&Ja(a)}const n=e[wt].components;if(null!==n)for(let i=0;i<n.length;i++){const o=Zr(n[i],e);Dh(o)&&o[Fa]>0&&Ja(o)}}function j0(e,t){const n=Zr(t,e),i=n[wt];(function hw(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(i,n),T_(i,n,n[li])}function Cm(e,t){return e[lu]?e[Wd][Wr]=t:e[lu]=t,e[Wd]=t,t}function ku(e){for(;e;){e[un]|=32;const t=xf(e);if(mh(e)&&!t)return e;e=t}return null}function Em(e,t,n,i=!0){const o=t[fh];o.begin&&o.begin();try{Pu(e,t,e.template,n)}catch(u){throw i&&Hs(t,u),u}finally{o.end&&o.end()}}function Kf(e,t,n){L(0),t(e,n)}function _a(e){return e[wl]||(e[wl]=[])}function Dm(e){return e.cleanup||(e.cleanup=[])}function Hs(e,t){const n=e[dh],i=n?n.get(td,null):null;i&&i.handleError(t)}function Ul(e,t,n,i,o){for(let a=0;a<n.length;){const u=n[a++],m=n[a++],y=t[u],C=e.data[u];null!==C.setInput?C.setInput(y,o,i,m):y[m]=o}}function Jf(e,t,n){let i=n?e.styles:null,o=n?e.classes:null,a=0;if(null!==t)for(let u=0;u<t.length;u++){const m=t[u];"number"==typeof m?a=m:1==a?o=nn(o,m):2==a&&(i=nn(i,m+": "+t[++u]+";"))}n?e.styles=i:e.stylesWithoutHost=i,n?e.classes=o:e.classesWithoutHost=o}function kc(e,t,n,i,o=!1){for(;null!==n;){const a=t[n.index];if(null!==a&&i.push(_i(a)),kr(a))for(let m=Ji;m<a.length;m++){const y=a[m],C=y[wt].firstChild;null!==C&&kc(y[wt],y,C,i)}const u=n.type;if(8&u)kc(e,t,n.child,i);else if(32&u){const m=vf(n,t);let y;for(;y=m();)i.push(y)}else if(16&u){const m=Av(t,n);if(Array.isArray(m))i.push(...m);else{const y=xf(t[Ni]);kc(y[wt],y,m,i,!0)}}n=o?n.projectionNext:n.next}return i}class Rc{get rootNodes(){const t=this._lView,n=t[wt];return kc(n,t,n.firstChild,[])}constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[li]}set context(t){this._lView[li]=t}get destroyed(){return 128==(128&this._lView[un])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[bi];if(kr(t)){const n=t[Tl],i=n?n.indexOf(this):-1;i>-1&&(Ec(t,i),kh(n,i))}this._attachedToViewContainer=!1}wf(this._lView[wt],this._lView)}onDestroy(t){!function I_(e,t,n,i){const o=_a(t);null===n?o.push(i):(o.push(n),e.firstCreatePass&&Dm(e).push(i,o.length-1))}(this._lView[wt],this._lView,null,t)}markForCheck(){ku(this._cdRefInjectingView||this._lView)}detach(){this._lView[un]&=-65}reattach(){this._lView[un]|=64}detectChanges(){Em(this._lView[wt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new nt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function wv(e,t){pa(e,t,t[_n],2,null,null)}(this._lView[wt],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new nt(902,!1);this._appRef=t}}class $0 extends Rc{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;Em(t[wt],t,t[li],!1)}checkNoChanges(){}get context(){return null}}class O_ extends Qh{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=An(t);return new dd(n,this.ngModule)}}function H0(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class W0{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,i){i=bl(i);const o=this.injector.get(t,Mc,i);return o!==Mc||n===Mc?o:this.parentInjector.get(t,n,i)}}class dd extends dm{get inputs(){return H0(this.componentDef.inputs)}get outputs(){return H0(this.componentDef.outputs)}constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function _0(e){return e.map(Q1).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}create(t,n,i,o){let a=(o=o||this.ngModule)instanceof js?o:o?.injector;a&&null!==this.componentDef.getStandaloneInjector&&(a=this.componentDef.getStandaloneInjector(a)||a);const u=a?new W0(t,a):t,m=u.get(u_,null);if(null===m)throw new nt(407,!1);const y=u.get(X1,null),C=m.createRenderer(null,this.componentDef),T=this.componentDef.selectors[0][0]||"div",A=i?function M_(e,t,n){return e.selectRootElement(t,n===jo.ShadowDom)}(C,i,this.componentDef.encapsulation):bf(C,T,function G0(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(T)),z=this.componentDef.onPush?288:272,V=Za(0,null,null,1,0,null,null,null,null,null),H=Gf(null,V,null,z,null,null,m,C,y,u,null);let X,oe;K(H);try{const le=this.componentDef;let we,ve=null;le.findHostDirectiveDefs?(we=[],ve=new Map,le.findHostDirectiveDefs(le,we,ve),we.push(le)):we=[le];const Re=function Z0(e,t){const n=e[wt],i=Kn;return e[i]=t,ud(n,i,2,"#host",null)}(H,A),Fe=function X0(e,t,n,i,o,a,u,m){const y=o[wt];!function Y0(e,t,n,i){for(const o of e)t.mergedAttrs=Si(t.mergedAttrs,o.hostAttrs);null!==t.mergedAttrs&&(Jf(t,t.mergedAttrs,!0),null!==n&&Rv(i,n,t))}(i,e,t,u);const C=a.createRenderer(t,n),T=Gf(o,vm(n),null,n.onPush?32:16,o[e.index],e,a,C,m||null,null,null);return y.firstCreatePass&&Ya(y,e,i.length-1),Cm(o,T),o[e.index]=T}(Re,A,le,we,H,m,C);oe=Eh(V,Kn),A&&function F_(e,t,n,i){if(i)Fn(e,n,["ng-version",fm.full]);else{const{attrs:o,classes:a}=function y0(e){const t=[],n=[];let i=1,o=2;for(;i<e.length;){let a=e[i];if("string"==typeof a)2===o?""!==a&&t.push(a,e[++i]):8===o&&n.push(a);else{if(!ma(o))break;o=a}i++}return{attrs:t,classes:n}}(t.selectors[0]);o&&Fn(e,n,o),a&&a.length>0&&kv(e,n,a.join(" "))}}(C,le,A,i),void 0!==n&&function K0(e,t,n){const i=e.projection=[];for(let o=0;o<t.length;o++){const a=n[o];i.push(null!=a?Array.from(a):null)}}(oe,this.ngContentSelectors,n),X=function L_(e,t,n,i,o,a){const u=_r(),m=o[wt],y=Do(u,o);P_(m,o,u,n,null,i);for(let T=0;T<n.length;T++)Ci(Va(o,m,u.directiveStart+T,u),o);ga(m,o,u),y&&Ci(y,o);const C=Va(o,m,u.directiveStart+u.componentOffset,u);if(e[li]=o[li]=C,null!==a)for(const T of a)T(C,t);return hd(m,u,e),C}(Fe,le,we,ve,H,[Qf]),T_(V,H,null)}finally{Y()}return new dw(this.componentType,X,ed(oe,H),H,oe)}}class dw extends ei{constructor(t,n,i,o,a){super(),this.location=i,this._rootLView=o,this._tNode=a,this.instance=n,this.hostView=this.changeDetectorRef=new $0(o),this.componentType=t}setInput(t,n){const i=this._tNode.inputs;let o;if(null!==i&&(o=i[t])){const a=this._rootLView;Ul(a[wt],a,o,t,n),ku(Zr(this._tNode.index,a))}}get injector(){return new yu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function Qf(){const e=_r();Pe(Ze()[wt],e)}function ri(e){let t=function Sm(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const i=[e];for(;t;){let o;if(Ho(e))o=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new nt(903,!1);o=t.\u0275dir}if(o){if(n){i.push(o);const u=e;u.inputs=r(e.inputs),u.declaredInputs=r(e.declaredInputs),u.outputs=r(e.outputs);const m=o.hostBindings;m&&f(e,m);const y=o.viewQuery,C=o.contentQueries;if(y&&l(e,y),C&&h(e,C),Hr(e.inputs,o.inputs),Hr(e.declaredInputs,o.declaredInputs),Hr(e.outputs,o.outputs),Ho(o)&&o.data.animation){const T=e.data;T.animation=(T.animation||[]).concat(o.data.animation)}}const a=o.features;if(a)for(let u=0;u<a.length;u++){const m=a[u];m&&m.ngInherit&&m(e),m===ri&&(n=!1)}}t=Object.getPrototypeOf(t)}!function s(e){let t=0,n=null;for(let i=e.length-1;i>=0;i--){const o=e[i];o.hostVars=t+=o.hostVars,o.hostAttrs=Si(o.hostAttrs,n=Si(n,o.hostAttrs))}}(i)}function r(e){return e===oa?{}:e===Vn?[]:e}function l(e,t){const n=e.viewQuery;e.viewQuery=n?(i,o)=>{t(i,o),n(i,o)}:t}function h(e,t){const n=e.contentQueries;e.contentQueries=n?(i,o,a)=>{t(i,o,a),n(i,o,a)}:t}function f(e,t){const n=e.hostBindings;e.hostBindings=n?(i,o)=>{t(i,o),n(i,o)}:t}function $(e){return!!function ce(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function he(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function Ge(e,t,n,i){const o=Ze();return he(o,c(),t)&&(yn(),Ka(de(),o,e,t,n,i)),Ge}function qt(e,t,n,i,o,a,u,m){const y=Ze(),C=yn(),T=e+Kn,A=C.firstCreatePass?function Wn(e,t,n,i,o,a,u,m,y){const C=t.consts,T=ud(t,e,4,u||null,Ba(C,m));A_(t,n,T,Ba(C,y)),Pe(t,T);const A=T.tView=Za(2,T,i,o,a,t.directiveRegistry,t.pipeRegistry,null,t.schemas,C);return null!==t.queries&&(t.queries.template(t,T),A.queries=t.queries.embeddedTView(T)),T}(T,C,y,t,n,i,o,a,u):C.data[T];us(A,!1);const z=y[_n].createComment("");Zp(C,y,z,A),Ci(z,y),Cm(y,y[T]=R_(z,y,z,A)),$o(A)&&S_(C,y,A),null!=u&&Zf(y,A,m)}function zn(e){return Il(function Tg(){return rn.lFrame.contextLView}(),Kn+e)}function xt(e,t,n){const i=Ze();return he(i,c(),t)&&function Ro(e,t,n,i,o,a,u,m){const y=Do(t,n);let T,C=t.inputs;!m&&null!=C&&(T=C[i])?(Ul(e,n,T,i,o),Na(t)&&function cw(e,t){const n=Zr(t,e);16&n[un]||(n[un]|=32)}(n,t.index)):3&t.type&&(i=function lw(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(i),o=null!=u?u(o,t.value||"",i):o,a.setProperty(y,i,o))}(yn(),de(),i,e,t,i[_n],n,!1),xt}function di(e,t,n,i,o){const u=o?"class":"style";Ul(e,n,t.inputs[u],u,i)}function ht(e,t,n,i){const o=Ze(),a=yn(),u=Kn+e,m=o[_n],y=a.firstCreatePass?function Bi(e,t,n,i,o,a){const u=t.consts,y=ud(t,e,2,i,Ba(u,o));return A_(t,n,y,Ba(u,a)),null!==y.attrs&&Jf(y,y.attrs,!1),null!==y.mergedAttrs&&Jf(y,y.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,y),y}(u,a,o,t,n,i):a.data[u],C=o[u]=bf(m,t,function Te(){return rn.lFrame.currentNamespace}()),T=$o(y);return us(y,!0),Rv(m,C,y),32!=(32&y.flags)&&Zp(a,o,C,y),0===function Ls(){return rn.lFrame.elementDepthCount}()&&Ci(C,o),function Al(){rn.lFrame.elementDepthCount++}(),T&&(S_(a,o,y),hd(a,y,o)),null!==i&&Zf(o,y),ht}function gt(){let e=_r();Sh()?af():(e=e.parent,us(e,!1));const t=e;!function Th(){rn.lFrame.elementDepthCount--}();const n=yn();return n.firstCreatePass&&(Pe(n,e),ph(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function sn(e){return 0!=(8&e.flags)}(t)&&di(n,t,Ze(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function vt(e){return 0!=(16&e.flags)}(t)&&di(n,t,Ze(),t.stylesWithoutHost,!1),gt}function Zt(e,t,n,i){return ht(e,t,n,i),gt(),Zt}function wn(e,t,n){const i=Ze(),o=yn(),a=e+Kn,u=o.firstCreatePass?function vi(e,t,n,i,o){const a=t.consts,u=Ba(a,i),m=ud(t,e,8,"ng-container",u);return null!==u&&Jf(m,u,!0),A_(t,n,m,Ba(a,o)),null!==t.queries&&t.queries.elementStart(t,m),m}(a,o,i,t,n):o.data[a];us(u,!0);const m=i[a]=i[_n].createComment("");return Zp(o,i,m,u),Ci(m,i),$o(u)&&(S_(o,i,u),hd(o,u,i)),null!=n&&Zf(i,u),wn}function xi(){let e=_r();const t=yn();return Sh()?af():(e=e.parent,us(e,!1)),t.firstCreatePass&&(Pe(t,e),ph(e)&&t.queries.elementEnd(e)),xi}function tr(){return Ze()}function fi(e){return!!e&&"function"==typeof e.then}function dr(e){return!!e&&"function"==typeof e.subscribe}const Gi=dr;function Mn(e,t,n,i){const o=Ze(),a=yn(),u=_r();return function Ru(e,t,n,i,o,a,u){const m=$o(i),C=e.firstCreatePass&&Dm(e),T=t[li],A=_a(t);let z=!0;if(3&i.type||u){const X=Do(i,t),oe=u?u(X):X,le=A.length,we=u?Re=>u(_i(Re[i.index])):i.index;let ve=null;if(!u&&m&&(ve=function ya(e,t,n,i){const o=e.cleanup;if(null!=o)for(let a=0;a<o.length-1;a+=2){const u=o[a];if(u===n&&o[a+1]===i){const m=t[wl],y=o[a+2];return m.length>y?m[y]:null}"string"==typeof u&&(a+=2)}return null}(e,t,o,i.index)),null!==ve)(ve.__ngLastListenerFn__||ve).__ngNextListenerFn__=a,ve.__ngLastListenerFn__=a,z=!1;else{a=pd(i,t,T,a,!1);const Re=n.listen(oe,o,a);A.push(a,Re),C&&C.push(o,we,le,le+1)}}else a=pd(i,t,T,a,!1);const V=i.outputs;let H;if(z&&null!==V&&(H=V[o])){const X=H.length;if(X)for(let oe=0;oe<X;oe+=2){const Fe=t[H[oe]][H[oe+1]].subscribe(a),lt=A.length;A.push(a,Fe),C&&C.push(o,i.index,lt,-(lt+1))}}}(a,o,o[_n],u,e,t,i),Mn}function fd(e,t,n,i){try{return Eo(6,t,n),!1!==n(i)}catch(o){return Hs(e,o),!1}finally{Eo(7,t,n)}}function pd(e,t,n,i,o){return function a(u){if(u===Function)return i;ku(e.componentOffset>-1?Zr(e.index,t):t);let y=fd(t,n,i,u),C=a.__ngNextListenerFn__;for(;C;)y=fd(t,n,C,u)&&y,C=C.__ngNextListenerFn__;return o&&!1===y&&(u.preventDefault(),u.returnValue=!1),y}}function br(e=1){return function ie(e){return(rn.lFrame.contextLView=function re(e,t){for(;e>0;)t=t[sa],e--;return t}(e,rn.lFrame.contextLView))[li]}(e)}function Qr(e,t){return e<<17|t<<2}function ir(e){return e>>17&32767}function km(e){return 2|e}function _s(e){return(131068&e)>>2}function fw(e,t){return-131069&e|t<<2}function pw(e){return 1|e}function qD(e,t,n,i,o){const a=e[n+1],u=null===t;let m=i?ir(a):_s(a),y=!1;for(;0!==m&&(!1===y||u);){const T=e[m+1];sO(e[m],t)&&(y=!0,e[m+1]=i?pw(T):km(T)),m=i?ir(T):_s(T)}y&&(e[n+1]=i?km(a):pw(a))}function sO(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&da(e,t)>=0}function nx(e,t,n){return Hl(e,t,n,!1),nx}function ix(e,t){return Hl(e,t,null,!0),ix}function Hl(e,t,n,i){const o=Ze(),a=yn(),u=function d(e){const t=rn.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}(2);a.firstUpdatePass&&function tT(e,t,n,i){const o=e.data;if(null===o[n+1]){const a=o[fe()],u=function eT(e,t){return t>=e.expandoStartIndex}(e,n);(function oT(e,t){return 0!=(e.flags&(t?8:16))})(a,i)&&null===t&&!u&&(t=!1),t=function mO(e,t,n,i){const o=function k(e){const t=rn.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let a=i?t.residualClasses:t.residualStyles;if(null===o)0===(i?t.classBindings:t.styleBindings)&&(n=B_(n=mw(null,e,t,n,i),t.attrs,i),a=null);else{const u=t.directiveStylingLast;if(-1===u||e[u]!==o)if(n=mw(o,e,t,n,i),null===a){let y=function gO(e,t,n){const i=n?t.classBindings:t.styleBindings;if(0!==_s(i))return e[ir(i)]}(e,t,i);void 0!==y&&Array.isArray(y)&&(y=mw(null,e,t,y[1],i),y=B_(y,t.attrs,i),function _O(e,t,n,i){e[ir(n?t.classBindings:t.styleBindings)]=i}(e,t,i,y))}else a=function yO(e,t,n){let i;const o=t.directiveEnd;for(let a=1+t.directiveStylingLast;a<o;a++)i=B_(i,e[a].hostAttrs,n);return B_(i,t.attrs,n)}(e,t,i)}return void 0!==a&&(i?t.residualClasses=a:t.residualStyles=a),n}(o,a,t,i),function rO(e,t,n,i,o,a){let u=a?t.classBindings:t.styleBindings,m=ir(u),y=_s(u);e[i]=n;let T,C=!1;if(Array.isArray(n)?(T=n[1],(null===T||da(n,T)>0)&&(C=!0)):T=n,o)if(0!==y){const z=ir(e[m+1]);e[i+1]=Qr(z,m),0!==z&&(e[z+1]=fw(e[z+1],i)),e[m+1]=function N_(e,t){return 131071&e|t<<17}(e[m+1],i)}else e[i+1]=Qr(m,0),0!==m&&(e[m+1]=fw(e[m+1],i)),m=i;else e[i+1]=Qr(y,0),0===m?m=i:e[y+1]=fw(e[y+1],i),y=i;C&&(e[i+1]=km(e[i+1])),qD(e,T,i,!0),qD(e,T,i,!1),function oO(e,t,n,i,o){const a=o?e.residualClasses:e.residualStyles;null!=a&&"string"==typeof t&&da(a,t)>=0&&(n[i+1]=pw(n[i+1]))}(t,T,e,i,a),u=Qr(m,y),a?t.classBindings=u:t.styleBindings=u}(o,a,t,n,u,i)}}(a,e,u,i),t!==Qt&&he(o,u,t)&&function iT(e,t,n,i,o,a,u,m){if(!(3&t.type))return;const y=e.data,C=y[m+1],T=function iO(e){return 1==(1&e)}(C)?rT(y,t,n,o,_s(C),u):void 0;rx(T)||(rx(a)||function tp(e){return 2==(2&e)}(C)&&(a=rT(y,null,n,o,m,u)),function S1(e,t,n,i,o){if(t)o?e.addClass(n,i):e.removeClass(n,i);else{let a=-1===i.indexOf("-")?void 0:Kr.DashCase;null==o?e.removeStyle(n,i,a):("string"==typeof o&&o.endsWith("!important")&&(o=o.slice(0,-10),a|=Kr.Important),e.setStyle(n,i,o,a))}}(i,u,pu(fe(),n),o,a))}(a,a.data[fe()],o,o[_n],e,o[u+1]=function wO(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=Tn(Ha(e)))),e}(t,n),i,u)}function mw(e,t,n,i,o){let a=null;const u=n.directiveEnd;let m=n.directiveStylingLast;for(-1===m?m=n.directiveStart:m++;m<u&&(a=t[m],i=B_(i,a.hostAttrs,o),a!==e);)m++;return null!==e&&(n.directiveStylingLast=m),i}function B_(e,t,n){const i=n?1:2;let o=-1;if(null!==t)for(let a=0;a<t.length;a++){const u=t[a];"number"==typeof u?o=u:o===i&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Wo(e,u,!!n||t[++a]))}return void 0===e?null:e}function rT(e,t,n,i,o,a){const u=null===t;let m;for(;o>0;){const y=e[o],C=Array.isArray(y),T=C?y[1]:y,A=null===T;let z=n[o+1];z===Qt&&(z=A?Vn:void 0);let V=A?vu(z,i):T===i?z:void 0;if(C&&!rx(V)&&(V=vu(y,i)),rx(V)&&(m=V,u))return m;const H=e[o+1];o=u?ir(H):_s(H)}if(null!==t){let y=a?t.residualClasses:t.residualStyles;null!=y&&(m=vu(y,i))}return m}function rx(e){return void 0!==e}function si(e,t=""){const n=Ze(),i=yn(),o=e+Kn,a=i.firstCreatePass?ud(i,o,1,t,null):i.data[o],u=n[o]=function qg(e,t){return e.createText(t)}(n[_n],t);Zp(i,n,u,a),us(a,!1)}function _o(e){return zc("",e,""),_o}function zc(e,t,n){const i=Ze(),o=function Be(e,t,n,i){return he(e,c(),n)?t+Jt(n)+i:Qt}(i,e,t,n);return o!==Qt&&function Qa(e,t,n){const i=pu(t,e);!function Zg(e,t,n){e.setValue(t,n)}(e[_n],i,n)}(i,fe(),o),zc}const Lm="en-US";let ST=Lm;function yw(e,t,n,i,o){if(e=Pt(e),Array.isArray(e))for(let a=0;a<e.length;a++)yw(e[a],t,n,i,o);else{const a=yn(),u=Ze();let m=Su(e)?e:Pt(e.provide),y=Yh(e);const C=_r(),T=1048575&C.providerIndexes,A=C.directiveStart,z=C.providerIndexes>>20;if(Su(e)||!e.multi){const V=new _t(y,o,Qe),H=xw(m,t,o?T:T+z,A);-1===H?(_u(ds(C,u),a,m),vw(a,e,t.length),t.push(m),C.directiveStart++,C.directiveEnd++,o&&(C.providerIndexes+=1048576),n.push(V),u.push(V)):(n[H]=V,u[H]=V)}else{const V=xw(m,t,T+z,A),H=xw(m,t,T,T+z),oe=H>=0&&n[H];if(o&&!oe||!o&&!(V>=0&&n[V])){_u(ds(C,u),a,m);const le=function VL(e,t,n,i,o){const a=new _t(e,n,Qe);return a.multi=[],a.index=t,a.componentProviders=0,JT(a,o,i&&!n),a}(o?BL:NL,n.length,o,i,y);!o&&oe&&(n[H].providerFactory=le),vw(a,e,t.length,0),t.push(m),C.directiveStart++,C.directiveEnd++,o&&(C.providerIndexes+=1048576),n.push(le),u.push(le)}else vw(a,e,V>-1?V:H,JT(n[o?H:V],y,!o&&i));!o&&i&&oe&&n[H].componentProviders++}}}function vw(e,t,n,i){const o=Su(t),a=function j1(e){return!!e.useClass}(t);if(o||a){const y=(a?Pt(t.useClass):t).prototype.ngOnDestroy;if(y){const C=e.destroyHooks||(e.destroyHooks=[]);if(!o&&t.multi){const T=C.indexOf(n);-1===T?C.push(n,[i,y]):C[T+1].push(i,y)}else C.push(n,y)}}}function JT(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function xw(e,t,n,i){for(let o=n;o<i;o++)if(t[o]===e)return o;return-1}function NL(e,t,n,i){return bw(this.multi,[])}function BL(e,t,n,i){const o=this.multi;let a;if(this.providerFactory){const u=this.providerFactory.componentProviders,m=Va(n,n[wt],this.providerFactory.index,i);a=m.slice(0,u),bw(o,a);for(let y=u;y<m.length;y++)a.push(m[y])}else a=[],bw(o,a);return a}function bw(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function Wi(e,t=[]){return n=>{n.providersResolver=(i,o)=>function zL(e,t,n){const i=yn();if(i.firstCreatePass){const o=Ho(e);yw(n,i.data,i.blueprint,o,!0),yw(t,i.data,i.blueprint,o,!1)}}(i,o?o(e):e,t)}}class Fm{}class QT{}class eS extends Fm{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new O_(this);const i=Gr(t);this._bootstrapComponents=Ga(i.bootstrap),this._r3Injector=w0(t,n,[{provide:Fm,useValue:this},{provide:Qh,useValue:this.componentFactoryResolver}],Tn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class ww extends QT{constructor(t){super(),this.moduleType=t}create(t){return new eS(this.moduleType,t)}}class UL extends Fm{constructor(t,n,i){super(),this.componentFactoryResolver=new O_(this),this.instance=null;const o=new Nf([...t,{provide:Fm,useValue:this},{provide:Qh,useValue:this.componentFactoryResolver}],n||Ko(),i,new Set(["environment"]));this.injector=o,o.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function cx(e,t,n=null){return new UL(e,t,n).injector}let $L=(()=>{class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n.id)){const i=Xv(0,n.type),o=i.length>0?cx([i],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n.id,o)}return this.cachedInjectors.get(n.id)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=At({token:e,providedIn:"environment",factory:()=>new e(Dt(js))}),e})();function tS(e){e.getStandaloneInjector=t=>t.get($L).getOrCreateStandaloneInjector(e)}function cS(e,t,n,i,o,a){const u=t+n;return he(e,u,o)?function ae(e,t,n){return e[t]=n}(e,u+1,a?i.call(a,o):i(o)):function G_(e,t){const n=e[t];return n===Qt?void 0:n}(e,u+1)}function mS(e,t,n){const i=e+Kn,o=Ze(),a=Il(o,i);return function W_(e,t){return e[wt].data[t].pure}(o,i)?cS(o,yr(),t,a.transform,n,a):a.transform(n)}function Ew(e){return t=>{setTimeout(e,void 0,t)}}const Mi=class dF extends oo{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,i){let o=t,a=n||(()=>null),u=i;if(t&&"object"==typeof t){const y=t;o=y.next?.bind(y),a=y.error?.bind(y),u=y.complete?.bind(y)}this.__isAsync&&(a=Ew(a),o&&(o=Ew(o)),u&&(u=Ew(u)));const m=super.subscribe({next:o,error:a,complete:u});return t instanceof Ue&&t.add(m),m}};let Ou=(()=>{class e{}return e.__NG_ELEMENT_ID__=gF,e})();const pF=Ou,mF=class extends pF{constructor(t,n,i){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=i}createEmbeddedView(t,n){const i=this._declarationTContainer.tView,o=Gf(this._declarationLView,i,t,16,null,i.declTNode,null,null,null,null,n||null);o[gc]=this._declarationLView[this._declarationTContainer.index];const u=this._declarationLView[cr];return null!==u&&(o[cr]=u.createEmbeddedView(i)),T_(i,o,t),new Rc(o)}};function gF(){return function ux(e,t){return 4&e.type?new mF(t,e,ed(e,t)):null}(_r(),Ze())}let Wl=(()=>{class e{}return e.__NG_ELEMENT_ID__=_F,e})();function _F(){return function yS(e,t){let n;const i=t[e.index];if(kr(i))n=i;else{let o;if(8&e.type)o=_i(i);else{const a=t[_n];o=a.createComment("");const u=Do(e,t);Tu(a,Cf(a,u),o,function Iv(e,t){return e.nextSibling(t)}(a,u),!1)}t[e.index]=n=R_(i,t,o,e),Cm(t,n)}return new gS(n,e,t)}(_r(),Ze())}const yF=Wl,gS=class extends yF{constructor(t,n,i){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=i}get element(){return ed(this._hostTNode,this._hostLView)}get injector(){return new yu(this._hostTNode,this._hostLView)}get parentInjector(){const t=Rl(this._hostTNode,this._hostLView);if(hs(t)){const n=bn(t,this._hostLView),i=Qn(t);return new yu(n[wt].data[i+8],n)}return new yu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=_S(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-Ji}createEmbeddedView(t,n,i){let o,a;"number"==typeof i?o=i:null!=i&&(o=i.index,a=i.injector);const u=t.createEmbeddedView(n||{},a);return this.insert(u,o),u}createComponent(t,n,i,o,a){const u=t&&!function So(e){return"function"==typeof e}(t);let m;if(u)m=n;else{const A=n||{};m=A.index,i=A.injector,o=A.projectableNodes,a=A.environmentInjector||A.ngModuleRef}const y=u?t:new dd(An(t)),C=i||this.parentInjector;if(!a&&null==y.ngModule){const z=(u?C:this.parentInjector).get(js,null);z&&(a=z)}const T=y.create(C,o,void 0,a);return this.insert(T.hostView,m),T}insert(t,n){const i=t._lView,o=i[wt];if(function Rp(e){return kr(e[bi])}(i)){const T=this.indexOf(t);if(-1!==T)this.detach(T);else{const A=i[bi],z=new gS(A,A[Ki],A[bi]);z.detach(z.indexOf(t))}}const a=this._adjustIndex(n),u=this._lContainer;!function Du(e,t,n,i){const o=Ji+i,a=n.length;i>0&&(n[o-1][Wr]=t),i<a-Ji?(t[Wr]=n[o],yc(n,Ji+i,t)):(n.push(t),t[Wr]=null),t[bi]=n;const u=t[gc];null!==u&&n!==u&&function Ev(e,t){const n=e[gn];t[Ni]!==t[bi][bi][Ni]&&(e[El]=!0),null===n?e[gn]=[t]:n.push(t)}(u,t);const m=t[cr];null!==m&&m.insertView(e),t[un]|=64}(o,i,u,a);const m=Ef(a,u),y=i[_n],C=Cf(y,u[Dl]);return null!==C&&function Xg(e,t,n,i,o,a){i[cs]=o,i[Ki]=t,pa(e,i,n,1,o,a)}(o,u[Ki],y,i,C,m),t.attachToViewContainerRef(),yc(Tw(u),a,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=_S(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),i=Ec(this._lContainer,n);i&&(kh(Tw(this._lContainer),n),wf(i[wt],i))}detach(t){const n=this._adjustIndex(t,-1),i=Ec(this._lContainer,n);return i&&null!=kh(Tw(this._lContainer),n)?new Rc(i):null}_adjustIndex(t,n=0){return t??this.length+n}};function _S(e){return e[Tl]}function Tw(e){return e[Tl]||(e[Tl]=[])}function dx(...e){}const fx=new Mt("Application Initializer");let px=(()=>{class e{constructor(n){this.appInits=n,this.resolve=dx,this.reject=dx,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,o)=>{this.resolve=i,this.reject=o})}runInitializers(){if(this.initialized)return;const n=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let o=0;o<this.appInits.length;o++){const a=this.appInits[o]();if(fi(a))n.push(a);else if(Gi(a)){const u=new Promise((m,y)=>{a.subscribe({complete:m,error:y})});n.push(u)}}Promise.all(n).then(()=>{i()}).catch(o=>{this.reject(o)}),0===n.length&&i(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(Dt(fx,8))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Z_=new Mt("AppId",{providedIn:"root",factory:function HS(){return`${zw()}${zw()}${zw()}`}});function zw(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const GS=new Mt("Platform Initializer"),Nw=new Mt("Platform ID",{providedIn:"platform",factory:()=>"unknown"});let WF=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Lu=new Mt("LocaleId",{providedIn:"root",factory:()=>cn(Lu,Nt.Optional|Nt.SkipSelf)||function qF(){return typeof $localize<"u"&&$localize.locale||Lm}()});class XF{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let WS=(()=>{class e{compileModuleSync(n){return new ww(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const i=this.compileModuleSync(n),a=Ga(Gr(n).declarations).reduce((u,m)=>{const y=An(m);return y&&u.push(new dd(y)),u},[]);return new XF(i,a)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const JF=(()=>Promise.resolve(0))();function Bw(e){typeof Zone>"u"?JF.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class rr{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Mi(!1),this.onMicrotaskEmpty=new Mi(!1),this.onStable=new Mi(!1),this.onError=new Mi(!1),typeof Zone>"u")throw new nt(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!i&&n,o.shouldCoalesceRunChangeDetection=i,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function QF(){let e=hi.requestAnimationFrame,t=hi.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function nz(e){const t=()=>{!function tz(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(hi,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,jw(e),e.isCheckStableRunning=!0,Vw(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),jw(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,i,o,a,u,m)=>{try{return XS(e),n.invokeTask(o,a,u,m)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===a.type||e.shouldCoalesceRunChangeDetection)&&t(),YS(e)}},onInvoke:(n,i,o,a,u,m,y)=>{try{return XS(e),n.invoke(o,a,u,m,y)}finally{e.shouldCoalesceRunChangeDetection&&t(),YS(e)}},onHasTask:(n,i,o,a)=>{n.hasTask(o,a),i===o&&("microTask"==a.change?(e._hasPendingMicrotasks=a.microTask,jw(e),Vw(e)):"macroTask"==a.change&&(e.hasPendingMacrotasks=a.macroTask))},onHandleError:(n,i,o,a)=>(n.handleError(o,a),e.runOutsideAngular(()=>e.onError.emit(a)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!rr.isInAngularZone())throw new nt(909,!1)}static assertNotInAngularZone(){if(rr.isInAngularZone())throw new nt(909,!1)}run(t,n,i){return this._inner.run(t,n,i)}runTask(t,n,i,o){const a=this._inner,u=a.scheduleEventTask("NgZoneEvent: "+o,t,ez,dx,dx);try{return a.runTask(u,n,i)}finally{a.cancelTask(u)}}runGuarded(t,n,i){return this._inner.runGuarded(t,n,i)}runOutsideAngular(t){return this._outer.run(t)}}const ez={};function Vw(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function jw(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function XS(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function YS(e){e._nesting--,Vw(e)}class iz{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Mi,this.onMicrotaskEmpty=new Mi,this.onStable=new Mi,this.onError=new Mi}run(t,n,i){return t.apply(n,i)}runGuarded(t,n,i){return t.apply(n,i)}runOutsideAngular(t){return t()}runTask(t,n,i,o){return t.apply(n,i)}}const KS=new Mt(""),mx=new Mt("");let Hw,Uw=(()=>{class e{constructor(n,i,o){this._ngZone=n,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Hw||(function rz(e){Hw=e}(o),o.addToWindow(i)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{rr.assertNotInAngularZone(),Bw(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Bw(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(n)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,i,o){let a=-1;i&&i>0&&(a=setTimeout(()=>{this._callbacks=this._callbacks.filter(u=>u.timeoutId!==a),n(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:n,timeoutId:a,updateCb:o})}whenStable(n,i,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,i,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,i,o){return[]}}return e.\u0275fac=function(n){return new(n||e)(Dt(rr),Dt($w),Dt(mx))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})(),$w=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,i){this._applications.set(n,i)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,i=!0){return Hw?.findTestabilityInTree(this,n,i)??null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Fu=!1;let md=null;const JS=new Mt("AllowMultipleToken"),Gw=new Mt("PlatformDestroyListeners"),QS=new Mt("appBootstrapListener");class eM{constructor(t,n){this.name=t,this.token=n}}function nM(e,t,n=[]){const i=`Platform: ${t}`,o=new Mt(i);return(a=[])=>{let u=Ww();if(!u||u.injector.get(JS,!1)){const m=[...n,...a,{provide:o,useValue:!0}];e?e(m):function az(e){if(md&&!md.get(JS,!1))throw new nt(400,!1);md=e;const t=e.get(rM);(function tM(e){const t=e.get(GS,null);t&&t.forEach(n=>n())})(e)}(function iM(e=[],t){return qa.create({name:t,providers:[{provide:l_,useValue:"platform"},{provide:Gw,useValue:new Set([()=>md=null])},...e]})}(m,i))}return function cz(e){const t=Ww();if(!t)throw new nt(401,!1);return t}()}}function Ww(){return md?.get(rM)??null}let rM=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,i){const o=function sM(e,t){let n;return n="noop"===e?new iz:("zone.js"===e?void 0:e)||new rr(t),n}(i?.ngZone,function oM(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!e||!e.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!e||!e.ngZoneRunCoalescing)||!1}}(i)),a=[{provide:rr,useValue:o}];return o.run(()=>{const u=qa.create({providers:a,parent:this.injector,name:n.moduleType.name}),m=n.create(u),y=m.injector.get(td,null);if(!y)throw new nt(402,!1);return o.runOutsideAngular(()=>{const C=o.onError.subscribe({next:T=>{y.handleError(T)}});m.onDestroy(()=>{_x(this._modules,m),C.unsubscribe()})}),function aM(e,t,n){try{const i=n();return fi(i)?i.catch(o=>{throw t.runOutsideAngular(()=>e.handleError(o)),o}):i}catch(i){throw t.runOutsideAngular(()=>e.handleError(i)),i}}(y,o,()=>{const C=m.injector.get(px);return C.runInitializers(),C.donePromise.then(()=>(function MT(e){co(e,"Expected localeId to be defined"),"string"==typeof e&&(ST=e.toLowerCase().replace(/_/g,"-"))}(m.injector.get(Lu,Lm)||Lm),this._moduleDoBootstrap(m),m))})})}bootstrapModule(n,i=[]){const o=lM({},i);return function oz(e,t,n){const i=new ww(n);return Promise.resolve(i)}(0,0,n).then(a=>this.bootstrapModuleFactory(a,o))}_moduleDoBootstrap(n){const i=n.injector.get(gx);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(o=>i.bootstrap(o));else{if(!n.instance.ngDoBootstrap)throw new nt(-403,!1);n.instance.ngDoBootstrap(i)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new nt(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const n=this._injector.get(Gw,null);n&&(n.forEach(i=>i()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(Dt(qa))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function lM(e,t){return Array.isArray(t)?t.reduce(lM,e):{...e,...t}}let gx=(()=>{class e{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(n,i,o){this._zone=n,this._injector=i,this._exceptionHandler=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const a=new fn(m=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{m.next(this._stable),m.complete()})}),u=new fn(m=>{let y;this._zone.runOutsideAngular(()=>{y=this._zone.onStable.subscribe(()=>{rr.assertNotInAngularZone(),Bw(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,m.next(!0))})})});const C=this._zone.onUnstable.subscribe(()=>{rr.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{m.next(!1)}))});return()=>{y.unsubscribe(),C.unsubscribe()}});this.isStable=function sc(...e){const t=pl(e),n=function ml(e,t){return"number"==typeof ss(e)?e.pop():t}(e,1/0),i=e;return i.length?1===i.length?xn(i[0]):Aa(n)(Li(i,t)):ao}(a,u.pipe(function ct(e={}){const{connector:t=(()=>new oo),resetOnError:n=!0,resetOnComplete:i=!0,resetOnRefCountZero:o=!0}=e;return a=>{let u,m,y,C=0,T=!1,A=!1;const z=()=>{m?.unsubscribe(),m=void 0},V=()=>{z(),u=y=void 0,T=A=!1},H=()=>{const X=u;V(),X?.unsubscribe()};return gi((X,oe)=>{C++,!A&&!T&&z();const le=y=y??t();oe.add(()=>{C--,0===C&&!A&&!T&&(m=ln(H,o))}),le.subscribe(oe),!u&&C>0&&(u=new ll({next:we=>le.next(we),error:we=>{A=!0,z(),m=ln(V,n,we),le.error(we)},complete:()=>{T=!0,z(),m=ln(V,i),le.complete()}}),xn(X).subscribe(u))})(a)}}()))}bootstrap(n,i){const o=n instanceof dm;if(!this._injector.get(px).done){!o&&function pc(e){const t=An(e)||mr(e)||Ar(e);return null!==t&&t.standalone}(n);throw new nt(405,Fu)}let u;u=o?n:this._injector.get(Qh).resolveComponentFactory(n),this.componentTypes.push(u.componentType);const m=function sz(e){return e.isBoundToModule}(u)?void 0:this._injector.get(Fm),C=u.create(qa.NULL,[],i||u.selector,m),T=C.location.nativeElement,A=C.injector.get(KS,null);return A?.registerApplication(T),C.onDestroy(()=>{this.detachView(C.hostView),_x(this.components,C),A?.unregisterApplication(T)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new nt(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){const i=n;_x(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const i=this._injector.get(QS,[]);i.push(...this._bootstrapListeners),i.forEach(o=>o(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>_x(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new nt(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(n){return new(n||e)(Dt(rr),Dt(js),Dt(td))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function _x(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let yx=(()=>{class e{}return e.__NG_ELEMENT_ID__=hz,e})();function hz(e){return function dz(e,t,n){if(Na(e)&&!n){const i=Zr(e.index,t);return new Rc(i,i)}return 47&e.type?new Rc(t[Ni],t):null}(_r(),Ze(),16==(16&e))}class fM{constructor(){}supports(t){return $(t)}create(t){return new yz(t)}}const _z=(e,t)=>t;class yz{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||_z}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,i=this._removalsHead,o=0,a=null;for(;n||i;){const u=!i||n&&n.currentIndex<mM(i,o,a)?n:i,m=mM(u,o,a),y=u.currentIndex;if(u===i)o--,i=i._nextRemoved;else if(n=n._next,null==u.previousIndex)o++;else{a||(a=[]);const C=m-o,T=y-o;if(C!=T){for(let z=0;z<C;z++){const V=z<a.length?a[z]:a[z]=0,H=V+z;T<=H&&H<C&&(a[z]=V+1)}a[u.previousIndex]=T-C}}m!==y&&t(u,m,y)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!$(t))throw new nt(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let o,a,u,n=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let m=0;m<this.length;m++)a=t[m],u=this._trackByFn(m,a),null!==n&&Object.is(n.trackById,u)?(i&&(n=this._verifyReinsertion(n,a,u,m)),Object.is(n.item,a)||this._addIdentityChange(n,a)):(n=this._mismatch(n,a,u,m),i=!0),n=n._next}else o=0,function te(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Symbol.iterator]();let i;for(;!(i=n.next()).done;)t(i.value)}}(t,m=>{u=this._trackByFn(o,m),null!==n&&Object.is(n.trackById,u)?(i&&(n=this._verifyReinsertion(n,m,u,o)),Object.is(n.item,m)||this._addIdentityChange(n,m)):(n=this._mismatch(n,m,u,o),i=!0),n=n._next,o++}),this.length=o;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,i,o){let a;return null===t?a=this._itTail:(a=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,a,o)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,o))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,a,o)):t=this._addAfter(new vz(n,i),a,o),t}_verifyReinsertion(t,n,i,o){let a=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==a?t=this._reinsertAfter(a,t._prev,o):t.currentIndex!=o&&(t.currentIndex=o,this._addToMoves(t,o)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const o=t._prevRemoved,a=t._nextRemoved;return null===o?this._removalsHead=a:o._nextRemoved=a,null===a?this._removalsTail=o:a._prevRemoved=o,this._insertAfter(t,n,i),this._addToMoves(t,i),t}_moveAfter(t,n,i){return this._unlink(t),this._insertAfter(t,n,i),this._addToMoves(t,i),t}_addAfter(t,n,i){return this._insertAfter(t,n,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,i){const o=null===n?this._itHead:n._next;return t._next=o,t._prev=n,null===o?this._itTail=t:o._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new pM),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,i=t._next;return null===n?this._itHead=i:n._next=i,null===i?this._itTail=n:i._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new pM),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class vz{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class xz{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===n||n<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const n=t._prevDup,i=t._nextDup;return null===n?this._head=i:n._nextDup=i,null===i?this._tail=n:i._prevDup=n,null===this._head}}class pM{constructor(){this.map=new Map}put(t){const n=t.trackById;let i=this.map.get(n);i||(i=new xz,this.map.set(n,i)),i.add(t)}get(t,n){const o=this.map.get(t);return o?o.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function mM(e,t,n){const i=e.previousIndex;if(null===i)return i;let o=0;return n&&i<n.length&&(o=n[i]),i+t+o}function _M(){return new bx([new fM])}let bx=(()=>{class e{constructor(n){this.factories=n}static create(n,i){if(null!=i){const o=i.factories.slice();n=n.concat(o)}return new e(n)}static extend(n){return{provide:e,useFactory:i=>e.create(n,i||_M()),deps:[[e,new Mo,new Oh]]}}find(n){const i=this.factories.find(o=>o.supports(n));if(null!=i)return i;throw new nt(901,!1)}}return e.\u0275prov=At({token:e,providedIn:"root",factory:_M}),e})();const Dz=nM(null,"core",[]);let Tz=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(Dt(gx))},e.\u0275mod=lr({type:e}),e.\u0275inj=Ui({}),e})();function Bm(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let Kw=null;function zu(){return Kw}class Iz{}const xs=new Mt("DocumentToken");let Jw=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:function(){return function Az(){return Dt(vM)}()},providedIn:"platform"}),e})();const Pz=new Mt("Location Initialized");let vM=(()=>{class e extends Jw{constructor(n){super(),this._doc=n,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return zu().getBaseHref(this._doc)}onPopState(n){const i=zu().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",n,!1),()=>i.removeEventListener("popstate",n)}onHashChange(n){const i=zu().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",n,!1),()=>i.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,i,o){xM()?this._history.pushState(n,i,o):this._location.hash=o}replaceState(n,i,o){xM()?this._history.replaceState(n,i,o):this._location.hash=o}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(Dt(xs))},e.\u0275prov=At({token:e,factory:function(){return function kz(){return new vM(Dt(xs))}()},providedIn:"platform"}),e})();function xM(){return!!window.history.pushState}function Qw(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function bM(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Nu(e){return e&&"?"!==e[0]?"?"+e:e}let rp=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:function(){return cn(CM)},providedIn:"root"}),e})();const wM=new Mt("appBaseHref");let CM=(()=>{class e extends rp{constructor(n,i){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??cn(xs).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return Qw(this._baseHref,n)}path(n=!1){const i=this._platformLocation.pathname+Nu(this._platformLocation.search),o=this._platformLocation.hash;return o&&n?`${i}${o}`:i}pushState(n,i,o,a){const u=this.prepareExternalUrl(o+Nu(a));this._platformLocation.pushState(n,i,u)}replaceState(n,i,o,a){const u=this.prepareExternalUrl(o+Nu(a));this._platformLocation.replaceState(n,i,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Dt(Jw),Dt(wM,8))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Rz=(()=>{class e extends rp{constructor(n,i){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(n){const i=Qw(this._baseHref,n);return i.length>0?"#"+i:i}pushState(n,i,o,a){let u=this.prepareExternalUrl(o+Nu(a));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.pushState(n,i,u)}replaceState(n,i,o,a){let u=this.prepareExternalUrl(o+Nu(a));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.replaceState(n,i,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Dt(Jw),Dt(wM,8))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})(),eC=(()=>{class e{constructor(n){this._subject=new Mi,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const i=this._locationStrategy.getBaseHref();this._basePath=function Fz(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}(bM(EM(i))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,i=""){return this.path()==this.normalize(n+Nu(i))}normalize(n){return e.stripTrailingSlash(function Lz(e,t){if(!e||!t.startsWith(e))return t;const n=t.substring(e.length);return""===n||["/",";","?","#"].includes(n[0])?n:t}(this._basePath,EM(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,i="",o=null){this._locationStrategy.pushState(o,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Nu(i)),o)}replaceState(n,i="",o=null){this._locationStrategy.replaceState(o,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Nu(i)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",i){this._urlChangeListeners.forEach(o=>o(n,i))}subscribe(n,i,o){return this._subject.subscribe({next:n,error:i,complete:o})}}return e.normalizeQueryParams=Nu,e.joinWithSlash=Qw,e.stripTrailingSlash=bM,e.\u0275fac=function(n){return new(n||e)(Dt(rp))},e.\u0275prov=At({token:e,factory:function(){return function Oz(){return new eC(Dt(rp))}()},providedIn:"root"}),e})();function EM(e){return e.replace(/\/index.html$/,"")}function RM(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const i=n.indexOf("="),[o,a]=-1==i?[n,""]:[n.slice(0,i),n.slice(i+1)];if(o.trim()===t)return decodeURIComponent(a)}return null}class bN{constructor(t,n,i,o){this.$implicit=t,this.ngForOf=n,this.index=i,this.count=o}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Vm=(()=>{class e{set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}constructor(n,i,o){this._viewContainer=n,this._template=i,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const i=this._viewContainer;n.forEachOperation((o,a,u)=>{if(null==o.previousIndex)i.createEmbeddedView(this._template,new bN(o.item,this._ngForOf,-1,-1),null===u?void 0:u);else if(null==u)i.remove(null===a?void 0:a);else if(null!==a){const m=i.get(a);i.move(m,u),zM(m,o)}});for(let o=0,a=i.length;o<a;o++){const m=i.get(o).context;m.index=o,m.count=a,m.ngForOf=this._ngForOf}n.forEachIdentityChange(o=>{zM(i.get(o.currentIndex),o)})}static ngTemplateContextGuard(n,i){return!0}}return e.\u0275fac=function(n){return new(n||e)(Qe(Wl),Qe(Ou),Qe(bx))},e.\u0275dir=Ft({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),e})();function zM(e,t){e.context.$implicit=t.item}let J_=(()=>{class e{constructor(n,i){this._viewContainer=n,this._context=new CN,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){NM("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){NM("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,i){return!0}}return e.\u0275fac=function(n){return new(n||e)(Qe(Wl),Qe(Ou))},e.\u0275dir=Ft({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),e})();class CN{constructor(){this.$implicit=null,this.ngIf=null}}function NM(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${Tn(t)}'.`)}class TN{createSubscription(t,n){return t.subscribe({next:n,error:i=>{throw i}})}dispose(t){t.unsubscribe()}}class SN{createSubscription(t,n){return t.then(n,i=>{throw i})}dispose(t){}}const MN=new SN,IN=new TN;let VM=(()=>{class e{constructor(n){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=n}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(n){return this._obj?n!==this._obj?(this._dispose(),this.transform(n)):this._latestValue:(n&&this._subscribe(n),this._latestValue)}_subscribe(n){this._obj=n,this._strategy=this._selectStrategy(n),this._subscription=this._strategy.createSubscription(n,i=>this._updateLatestValue(n,i))}_selectStrategy(n){if(fi(n))return MN;if(dr(n))return IN;throw function Xl(e,t){return new nt(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(n,i){n===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return e.\u0275fac=function(n){return new(n||e)(Qe(yx,16))},e.\u0275pipe=Ir({name:"async",type:e,pure:!1,standalone:!0}),e})(),UM=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=lr({type:e}),e.\u0275inj=Ui({}),e})();let YN=(()=>{class e{}return e.\u0275prov=At({token:e,providedIn:"root",factory:()=>new KN(Dt(xs),window)}),e})();class KN{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function JN(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const i=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let o=i.currentNode;for(;o;){const a=o.shadowRoot;if(a){const u=a.getElementById(t)||a.querySelector(`[name="${t}"]`);if(u)return u}o=i.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),i=n.left+this.window.pageXOffset,o=n.top+this.window.pageYOffset,a=this.offset();this.window.scrollTo(i-a[0],o-a[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=HM(this.window.history)||HM(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function HM(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class GM{}class DB extends Iz{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class _C extends DB{static makeCurrent(){!function Mz(e){Kw||(Kw=e)}(new _C)}onAndCancel(t,n,i){return t.addEventListener(n,i,!1),()=>{t.removeEventListener(n,i,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function TB(){return ey=ey||document.querySelector("base"),ey?ey.getAttribute("href"):null}();return null==n?null:function SB(e){Rx=Rx||document.createElement("a"),Rx.setAttribute("href",e);const t=Rx.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){ey=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return RM(document.cookie,t)}}let Rx,ey=null;const YM=new Mt("TRANSITION_ID"),IB=[{provide:fx,useFactory:function MB(e,t,n){return()=>{n.get(px).donePromise.then(()=>{const i=zu(),o=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let a=0;a<o.length;a++)i.remove(o[a])})}},deps:[YM,xs,qa],multi:!0}];let PB=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();const Ox=new Mt("EventManagerPlugins");let Lx=(()=>{class e{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(o=>{o.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,i,o){return this._findPluginFor(i).addEventListener(n,i,o)}addGlobalEventListener(n,i,o){return this._findPluginFor(i).addGlobalEventListener(n,i,o)}getZone(){return this._zone}_findPluginFor(n){const i=this._eventNameToPlugin.get(n);if(i)return i;const o=this._plugins;for(let a=0;a<o.length;a++){const u=o[a];if(u.supports(n))return this._eventNameToPlugin.set(n,u),u}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(Dt(Ox),Dt(rr))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();class KM{constructor(t){this._doc=t}addGlobalEventListener(t,n,i){const o=zu().getGlobalEventTarget(this._doc,t);if(!o)throw new Error(`Unsupported event target ${o} for event ${n}`);return this.addEventListener(o,n,i)}}let JM=(()=>{class e{constructor(){this.usageCount=new Map}addStyles(n){for(const i of n)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(n){for(const i of n)0===this.changeUsageCount(i,-1)&&this.onStyleRemoved(i)}onStyleRemoved(n){}onStyleAdded(n){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(n,i){const o=this.usageCount;let a=o.get(n)??0;return a+=i,a>0?o.set(n,a):o.delete(n),a}ngOnDestroy(){for(const n of this.getAllStyles())this.onStyleRemoved(n);this.usageCount.clear()}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})(),ty=(()=>{class e extends JM{constructor(n){super(),this.doc=n,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(n){for(const i of this.hostNodes)this.addStyleToHost(i,n)}onStyleRemoved(n){const i=this.styleRef;i.get(n)?.forEach(a=>a.remove()),i.delete(n)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const i of this.getAllStyles())this.addStyleToHost(n,i)}removeHost(n){this.hostNodes.delete(n)}addStyleToHost(n,i){const o=this.doc.createElement("style");o.textContent=i,n.appendChild(o);const a=this.styleRef.get(i);a?a.push(o):this.styleRef.set(i,[o])}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}}return e.\u0275fac=function(n){return new(n||e)(Dt(xs))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();const yC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},vC=/%COMP%/g,tI=new Mt("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function nI(e,t){return t.flat(100).map(n=>n.replace(vC,e))}function iI(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let xC=(()=>{class e{constructor(n,i,o,a){this.eventManager=n,this.sharedStylesHost=i,this.appId=o,this.removeStylesOnCompDestory=a,this.rendererByCompId=new Map,this.defaultRenderer=new bC(n)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;const o=this.getOrCreateRenderer(n,i);return o instanceof sI?o.applyToHost(n):o instanceof wC&&o.applyStyles(),o}getOrCreateRenderer(n,i){const o=this.rendererByCompId;let a=o.get(i.id);if(!a){const u=this.eventManager,m=this.sharedStylesHost,y=this.removeStylesOnCompDestory;switch(i.encapsulation){case jo.Emulated:a=new sI(u,m,i,this.appId,y);break;case jo.ShadowDom:return new NB(u,m,n,i);default:a=new wC(u,m,i,y)}a.onDestroy=()=>o.delete(i.id),o.set(i.id,a)}return a}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(Dt(Lx),Dt(ty),Dt(Z_),Dt(tI))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();class bC{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(yC[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){(oI(t)?t.content:t).appendChild(n)}insertBefore(t,n,i){t&&(oI(t)?t.content:t).insertBefore(n,i)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return n||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,i,o){if(o){n=o+":"+n;const a=yC[o];a?t.setAttributeNS(a,n,i):t.setAttribute(n,i)}else t.setAttribute(n,i)}removeAttribute(t,n,i){if(i){const o=yC[i];o?t.removeAttributeNS(o,n):t.removeAttribute(`${i}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,i,o){o&(Kr.DashCase|Kr.Important)?t.style.setProperty(n,i,o&Kr.Important?"important":""):t.style[n]=i}removeStyle(t,n,i){i&Kr.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,i){t[n]=i}setValue(t,n){t.nodeValue=n}listen(t,n,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,iI(i)):this.eventManager.addEventListener(t,n,iI(i))}}function oI(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class NB extends bC{constructor(t,n,i,o){super(t),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const a=nI(o.id,o.styles);for(const u of a){const m=document.createElement("style");m.textContent=u,this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,i){return super.insertBefore(this.nodeOrShadowRoot(t),n,i)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class wC extends bC{constructor(t,n,i,o,a=i.id){super(t),this.sharedStylesHost=n,this.removeStylesOnCompDestory=o,this.rendererUsageCount=0,this.styles=nI(a,i.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class sI extends wC{constructor(t,n,i,o,a){const u=o+"-"+i.id;super(t,n,i,a,u),this.contentAttr=function LB(e){return"_ngcontent-%COMP%".replace(vC,e)}(u),this.hostAttr=function FB(e){return"_nghost-%COMP%".replace(vC,e)}(u)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,n){const i=super.createElement(t,n);return super.setAttribute(i,this.contentAttr,""),i}}let BB=(()=>{class e extends KM{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,o){return n.addEventListener(i,o,!1),()=>this.removeEventListener(n,i,o)}removeEventListener(n,i,o){return n.removeEventListener(i,o)}}return e.\u0275fac=function(n){return new(n||e)(Dt(xs))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();const aI=["alt","control","meta","shift"],VB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},jB={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let UB=(()=>{class e extends KM{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,i,o){const a=e.parseEventName(i),u=e.eventCallback(a.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>zu().onAndCancel(n,a.domEventName,u))}static parseEventName(n){const i=n.toLowerCase().split("."),o=i.shift();if(0===i.length||"keydown"!==o&&"keyup"!==o)return null;const a=e._normalizeKey(i.pop());let u="",m=i.indexOf("code");if(m>-1&&(i.splice(m,1),u="code."),aI.forEach(C=>{const T=i.indexOf(C);T>-1&&(i.splice(T,1),u+=C+".")}),u+=a,0!=i.length||0===a.length)return null;const y={};return y.domEventName=o,y.fullKey=u,y}static matchEventFullKeyCode(n,i){let o=VB[n.key]||n.key,a="";return i.indexOf("code.")>-1&&(o=n.code,a="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),aI.forEach(u=>{u!==o&&(0,jB[u])(n)&&(a+=u+".")}),a+=o,a===i)}static eventCallback(n,i,o){return a=>{e.matchEventFullKeyCode(a,n)&&o.runGuarded(()=>i(a))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(Dt(xs))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();const cI=[{provide:Nw,useValue:"browser"},{provide:GS,useValue:function $B(){_C.makeCurrent()},multi:!0},{provide:xs,useFactory:function GB(){return function em(e){Qp=e}(document),document},deps:[]}],WB=nM(Dz,"browser",cI),uI=new Mt(""),hI=[{provide:mx,useClass:class AB{addToWindow(t){hi.getAngularTestability=(i,o=!0)=>{const a=t.findTestabilityInTree(i,o);if(null==a)throw new Error("Could not find testability for element.");return a},hi.getAllAngularTestabilities=()=>t.getAllTestabilities(),hi.getAllAngularRootElements=()=>t.getAllRootElements(),hi.frameworkStabilizers||(hi.frameworkStabilizers=[]),hi.frameworkStabilizers.push(i=>{const o=hi.getAllAngularTestabilities();let a=o.length,u=!1;const m=function(y){u=u||y,a--,0==a&&i(u)};o.forEach(function(y){y.whenStable(m)})})}findTestabilityInTree(t,n,i){return null==n?null:t.getTestability(n)??(i?zu().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:KS,useClass:Uw,deps:[rr,$w,mx]},{provide:Uw,useClass:Uw,deps:[rr,$w,mx]}],dI=[{provide:l_,useValue:"root"},{provide:td,useFactory:function HB(){return new td},deps:[]},{provide:Ox,useClass:BB,multi:!0,deps:[xs,rr,Nw]},{provide:Ox,useClass:UB,multi:!0,deps:[xs]},{provide:xC,useClass:xC,deps:[Lx,ty,Z_,tI]},{provide:u_,useExisting:xC},{provide:JM,useExisting:ty},{provide:ty,useClass:ty,deps:[xs]},{provide:Lx,useClass:Lx,deps:[Ox,rr]},{provide:GM,useClass:PB,deps:[]},[]];let qB=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:Z_,useValue:n.appId},{provide:YM,useExisting:Z_},IB]}}}return e.\u0275fac=function(n){return new(n||e)(Dt(uI,12))},e.\u0275mod=lr({type:e}),e.\u0275inj=Ui({providers:[...dI,...hI],imports:[UM,Tz]}),e})(),fI=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return e.\u0275fac=function(n){return new(n||e)(Dt(xs))},e.\u0275prov=At({token:e,factory:function(n){let i=null;return i=n?new n:function XB(){return new fI(Dt(xs))}(),i},providedIn:"root"}),e})();function Ht(...e){return Li(e,pl(e))}typeof window<"u"&&window;class xa extends oo{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:i}=this;if(t)throw n;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}const Fx=Od(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:t3}=Array,{getPrototypeOf:n3,prototype:i3,keys:r3}=Object;function gI(e){if(1===e.length){const t=e[0];if(t3(t))return{args:t,keys:null};if(function o3(e){return e&&"object"==typeof e&&n3(e)===i3}(t)){const n=r3(t);return{args:n.map(i=>t[i]),keys:n}}}return{args:e,keys:null}}const{isArray:s3}=Array;function DC(e){return dt(t=>function a3(e,t){return s3(t)?e(...t):e(t)}(e,t))}function _I(e,t){return e.reduce((n,i,o)=>(n[i]=t[o],n),{})}function yI(...e){const t=pl(e),n=rh(e),{args:i,keys:o}=gI(e);if(0===i.length)return Li([],t);const a=new fn(function l3(e,t,n=rs){return i=>{vI(t,()=>{const{length:o}=e,a=new Array(o);let u=o,m=o;for(let y=0;y<o;y++)vI(t,()=>{const C=Li(e[y],t);let T=!1;C.subscribe(Yn(i,A=>{a[y]=A,T||(T=!0,m--),m||i.next(n(a.slice()))},()=>{--u||i.complete()}))},i)},i)}}(i,t,o?u=>_I(o,u):rs));return n?a.pipe(DC(n)):a}function vI(e,t,n){e?Qs(n,e,t):t()}function TC(...e){return function c3(){return Aa(1)}()(Li(e,pl(e)))}function xI(e){return new fn(t=>{xn(e()).subscribe(t)})}function ny(e,t){const n=Rn(e)?e:()=>e,i=o=>o.error(n());return new fn(t?o=>t.schedule(i,0,o):i)}function SC(){return gi((e,t)=>{let n=null;e._refCount++;const i=Yn(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const o=e._connection,a=n;n=null,o&&(!a||o===a)&&o.unsubscribe(),t.unsubscribe()});e.subscribe(i),i.closed||(n=e.connect())})}class bI extends fn{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Ts(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Ue;const n=this.getSubject();t.add(this.source.subscribe(Yn(n,void 0,()=>{this._teardown(),n.complete()},i=>{this._teardown(),n.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Ue.EMPTY)}return t}refCount(){return SC()(this)}}function Nc(e,t){return gi((n,i)=>{let o=null,a=0,u=!1;const m=()=>u&&!o&&i.complete();n.subscribe(Yn(i,y=>{o?.unsubscribe();let C=0;const T=a++;xn(e(y,T)).subscribe(o=Yn(i,A=>i.next(t?t(y,A,T,C++):A),()=>{o=null,m()}))},()=>{u=!0,m()}))})}function jm(e){return e<=0?()=>ao:gi((t,n)=>{let i=0;t.subscribe(Yn(n,o=>{++i<=e&&(n.next(o),e<=i&&n.complete())}))})}function Bc(e,t){return gi((n,i)=>{let o=0;n.subscribe(Yn(i,a=>e.call(t,a,o++)&&i.next(a)))})}function zx(e){return gi((t,n)=>{let i=!1;t.subscribe(Yn(n,o=>{i=!0,n.next(o)},()=>{i||n.next(e),n.complete()}))})}function wI(e=h3){return gi((t,n)=>{let i=!1;t.subscribe(Yn(n,o=>{i=!0,n.next(o)},()=>i?n.complete():n.error(e())))})}function h3(){return new Fx}function _d(e,t){const n=arguments.length>=2;return i=>i.pipe(e?Bc((o,a)=>e(o,a,i)):rs,jm(1),n?zx(t):wI(()=>new Fx))}function yd(e,t){return Rn(t)?Lt(e,t,1):Lt(e,1)}function no(e,t,n){const i=Rn(e)||t||n?{next:e,error:t,complete:n}:e;return i?gi((o,a)=>{var u;null===(u=i.subscribe)||void 0===u||u.call(i);let m=!0;o.subscribe(Yn(a,y=>{var C;null===(C=i.next)||void 0===C||C.call(i,y),a.next(y)},()=>{var y;m=!1,null===(y=i.complete)||void 0===y||y.call(i),a.complete()},y=>{var C;m=!1,null===(C=i.error)||void 0===C||C.call(i,y),a.error(y)},()=>{var y,C;m&&(null===(y=i.unsubscribe)||void 0===y||y.call(i)),null===(C=i.finalize)||void 0===C||C.call(i)}))}):rs}function vd(e){return gi((t,n)=>{let a,i=null,o=!1;i=t.subscribe(Yn(n,void 0,void 0,u=>{a=xn(e(u,vd(e)(t))),i?(i.unsubscribe(),i=null,a.subscribe(n)):o=!0})),o&&(i.unsubscribe(),i=null,a.subscribe(n))})}function CI(e,t){return gi(function d3(e,t,n,i,o){return(a,u)=>{let m=n,y=t,C=0;a.subscribe(Yn(u,T=>{const A=C++;y=m?e(y,T,A):(m=!0,T),i&&u.next(y)},o&&(()=>{m&&u.next(y),u.complete()})))}}(e,t,arguments.length>=2,!0))}function MC(e){return e<=0?()=>ao:gi((t,n)=>{let i=[];t.subscribe(Yn(n,o=>{i.push(o),e<i.length&&i.shift()},()=>{for(const o of i)n.next(o);n.complete()},void 0,()=>{i=null}))})}function EI(e,t){const n=arguments.length>=2;return i=>i.pipe(e?Bc((o,a)=>e(o,a,i)):rs,MC(1),n?zx(t):wI(()=>new Fx))}function IC(e){return gi((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}const vn="primary",iy=Symbol("RouteTitle");class m3{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function Um(e){return new m3(e)}function g3(e,t,n){const i=n.path.split("/");if(i.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||i.length<e.length))return null;const o={};for(let a=0;a<i.length;a++){const u=i[a],m=e[a];if(u.startsWith(":"))o[u.substring(1)]=m;else if(u!==m.path)return null}return{consumed:e.slice(0,i.length),posParams:o}}function Vc(e,t){const n=e?Object.keys(e):void 0,i=t?Object.keys(t):void 0;if(!n||!i||n.length!=i.length)return!1;let o;for(let a=0;a<n.length;a++)if(o=n[a],!DI(e[o],t[o]))return!1;return!0}function DI(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),i=[...t].sort();return n.every((o,a)=>i[a]===o)}return e===t}function TI(e){return Array.prototype.concat.apply([],e)}function SI(e){return e.length>0?e[e.length-1]:null}function Oo(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function xd(e){return Gi(e)?e:fi(e)?Li(Promise.resolve(e)):Ht(e)}const Nx=!1,y3={exact:function AI(e,t,n){if(!op(e.segments,t.segments)||!Bx(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!e.children[i]||!AI(e.children[i],t.children[i],n))return!1;return!0},subset:PI},MI={exact:function v3(e,t){return Vc(e,t)},subset:function x3(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>DI(e[n],t[n]))},ignored:()=>!0};function II(e,t,n){return y3[n.paths](e.root,t.root,n.matrixParams)&&MI[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function PI(e,t,n){return kI(e,t,t.segments,n)}function kI(e,t,n,i){if(e.segments.length>n.length){const o=e.segments.slice(0,n.length);return!(!op(o,n)||t.hasChildren()||!Bx(o,n,i))}if(e.segments.length===n.length){if(!op(e.segments,n)||!Bx(e.segments,n,i))return!1;for(const o in t.children)if(!e.children[o]||!PI(e.children[o],t.children[o],i))return!1;return!0}{const o=n.slice(0,e.segments.length),a=n.slice(e.segments.length);return!!(op(e.segments,o)&&Bx(e.segments,o,i)&&e.children[vn])&&kI(e.children[vn],t,a,i)}}function Bx(e,t,n){return t.every((i,o)=>MI[n](e[o].parameters,i.parameters))}class bd{constructor(t=new Sn([],{}),n={},i=null){this.root=t,this.queryParams=n,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Um(this.queryParams)),this._queryParamMap}toString(){return C3.serialize(this)}}class Sn{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Oo(n,(i,o)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Vx(this)}}class ry{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=Um(this.parameters)),this._parameterMap}toString(){return LI(this)}}function op(e,t){return e.length===t.length&&e.every((n,i)=>n.path===t[i].path)}let oy=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:function(){return new AC},providedIn:"root"}),e})();class AC{parse(t){const n=new k3(t);return new bd(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${sy(t.root,!0)}`,i=function T3(e){const t=Object.keys(e).map(n=>{const i=e[n];return Array.isArray(i)?i.map(o=>`${jx(n)}=${jx(o)}`).join("&"):`${jx(n)}=${jx(i)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${i}${"string"==typeof t.fragment?`#${function E3(e){return encodeURI(e)}(t.fragment)}`:""}`}}const C3=new AC;function Vx(e){return e.segments.map(t=>LI(t)).join("/")}function sy(e,t){if(!e.hasChildren())return Vx(e);if(t){const n=e.children[vn]?sy(e.children[vn],!1):"",i=[];return Oo(e.children,(o,a)=>{a!==vn&&i.push(`${a}:${sy(o,!1)}`)}),i.length>0?`${n}(${i.join("//")})`:n}{const n=function w3(e,t){let n=[];return Oo(e.children,(i,o)=>{o===vn&&(n=n.concat(t(i,o)))}),Oo(e.children,(i,o)=>{o!==vn&&(n=n.concat(t(i,o)))}),n}(e,(i,o)=>o===vn?[sy(e.children[vn],!1)]:[`${o}:${sy(i,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[vn]?`${Vx(e)}/${n[0]}`:`${Vx(e)}/(${n.join("//")})`}}function RI(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function jx(e){return RI(e).replace(/%3B/gi,";")}function PC(e){return RI(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ux(e){return decodeURIComponent(e)}function OI(e){return Ux(e.replace(/\+/g,"%20"))}function LI(e){return`${PC(e.path)}${function D3(e){return Object.keys(e).map(t=>`;${PC(t)}=${PC(e[t])}`).join("")}(e.parameters)}`}const S3=/^[^\/()?;=#]+/;function $x(e){const t=e.match(S3);return t?t[0]:""}const M3=/^[^=?&#]+/,A3=/^[^&#]+/;class k3{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Sn([],{}):new Sn([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(i[vn]=new Sn(t,n)),i}parseSegment(){const t=$x(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new nt(4009,Nx);return this.capture(t),new ry(Ux(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=$x(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const o=$x(this.remaining);o&&(i=o,this.capture(i))}t[Ux(n)]=Ux(i)}parseQueryParam(t){const n=function I3(e){const t=e.match(M3);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const u=function P3(e){const t=e.match(A3);return t?t[0]:""}(this.remaining);u&&(i=u,this.capture(i))}const o=OI(n),a=OI(i);if(t.hasOwnProperty(o)){let u=t[o];Array.isArray(u)||(u=[u],t[o]=u),u.push(a)}else t[o]=a}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=$x(this.remaining),o=this.remaining[i.length];if("/"!==o&&")"!==o&&";"!==o)throw new nt(4010,Nx);let a;i.indexOf(":")>-1?(a=i.slice(0,i.indexOf(":")),this.capture(a),this.capture(":")):t&&(a=vn);const u=this.parseChildren();n[a]=1===Object.keys(u).length?u[vn]:new Sn([],u),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new nt(4011,Nx)}}function kC(e){return e.segments.length>0?new Sn([],{[vn]:e}):e}function Hx(e){const t={};for(const i of Object.keys(e.children)){const a=Hx(e.children[i]);(a.segments.length>0||a.hasChildren())&&(t[i]=a)}return function R3(e){if(1===e.numberOfChildren&&e.children[vn]){const t=e.children[vn];return new Sn(e.segments.concat(t.segments),t.children)}return e}(new Sn(e.segments,t))}function sp(e){return e instanceof bd}const RC=!1;function O3(e,t,n,i,o){if(0===n.length)return $m(t.root,t.root,t.root,i,o);const a=function VI(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new BI(!0,0,e);let t=0,n=!1;const i=e.reduce((o,a,u)=>{if("object"==typeof a&&null!=a){if(a.outlets){const m={};return Oo(a.outlets,(y,C)=>{m[C]="string"==typeof y?y.split("/"):y}),[...o,{outlets:m}]}if(a.segmentPath)return[...o,a.segmentPath]}return"string"!=typeof a?[...o,a]:0===u?(a.split("/").forEach((m,y)=>{0==y&&"."===m||(0==y&&""===m?n=!0:".."===m?t++:""!=m&&o.push(m))}),o):[...o,a]},[]);return new BI(n,t,i)}(n);return a.toRoot()?$m(t.root,t.root,new Sn([],{}),i,o):function u(y){const C=function F3(e,t,n,i){if(e.isAbsolute)return new Hm(t.root,!0,0);if(-1===i)return new Hm(n,n===t.root,0);return function jI(e,t,n){let i=e,o=t,a=n;for(;a>o;){if(a-=o,i=i.parent,!i)throw new nt(4005,RC&&"Invalid number of '../'");o=i.segments.length}return new Hm(i,!1,o-a)}(n,i+(ay(e.commands[0])?0:1),e.numberOfDoubleDots)}(a,t,e.snapshot?._urlSegment,y),T=C.processChildren?Gm(C.segmentGroup,C.index,a.commands):OC(C.segmentGroup,C.index,a.commands);return $m(t.root,C.segmentGroup,T,i,o)}(e.snapshot?._lastPathIndex)}function ay(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function ly(e){return"object"==typeof e&&null!=e&&e.outlets}function $m(e,t,n,i,o){let u,a={};i&&Oo(i,(y,C)=>{a[C]=Array.isArray(y)?y.map(T=>`${T}`):`${y}`}),u=e===t?n:NI(e,t,n);const m=kC(Hx(u));return new bd(m,a,o)}function NI(e,t,n){const i={};return Oo(e.children,(o,a)=>{i[a]=o===t?n:NI(o,t,n)}),new Sn(e.segments,i)}class BI{constructor(t,n,i){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=i,t&&i.length>0&&ay(i[0]))throw new nt(4003,RC&&"Root segment cannot have matrix parameters");const o=i.find(ly);if(o&&o!==SI(i))throw new nt(4004,RC&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Hm{constructor(t,n,i){this.segmentGroup=t,this.processChildren=n,this.index=i}}function OC(e,t,n){if(e||(e=new Sn([],{})),0===e.segments.length&&e.hasChildren())return Gm(e,t,n);const i=function N3(e,t,n){let i=0,o=t;const a={match:!1,pathIndex:0,commandIndex:0};for(;o<e.segments.length;){if(i>=n.length)return a;const u=e.segments[o],m=n[i];if(ly(m))break;const y=`${m}`,C=i<n.length-1?n[i+1]:null;if(o>0&&void 0===y)break;if(y&&C&&"object"==typeof C&&void 0===C.outlets){if(!$I(y,C,u))return a;i+=2}else{if(!$I(y,{},u))return a;i++}o++}return{match:!0,pathIndex:o,commandIndex:i}}(e,t,n),o=n.slice(i.commandIndex);if(i.match&&i.pathIndex<e.segments.length){const a=new Sn(e.segments.slice(0,i.pathIndex),{});return a.children[vn]=new Sn(e.segments.slice(i.pathIndex),e.children),Gm(a,0,o)}return i.match&&0===o.length?new Sn(e.segments,{}):i.match&&!e.hasChildren()?LC(e,t,n):i.match?Gm(e,0,o):LC(e,t,n)}function Gm(e,t,n){if(0===n.length)return new Sn(e.segments,{});{const i=function z3(e){return ly(e[0])?e[0].outlets:{[vn]:e}}(n),o={};if(!i[vn]&&e.children[vn]&&1===e.numberOfChildren&&0===e.children[vn].segments.length){const a=Gm(e.children[vn],t,n);return new Sn(e.segments,a.children)}return Oo(i,(a,u)=>{"string"==typeof a&&(a=[a]),null!==a&&(o[u]=OC(e.children[u],t,a))}),Oo(e.children,(a,u)=>{void 0===i[u]&&(o[u]=a)}),new Sn(e.segments,o)}}function LC(e,t,n){const i=e.segments.slice(0,t);let o=0;for(;o<n.length;){const a=n[o];if(ly(a)){const y=B3(a.outlets);return new Sn(i,y)}if(0===o&&ay(n[0])){i.push(new ry(e.segments[t].path,UI(n[0]))),o++;continue}const u=ly(a)?a.outlets[vn]:`${a}`,m=o<n.length-1?n[o+1]:null;u&&m&&ay(m)?(i.push(new ry(u,UI(m))),o+=2):(i.push(new ry(u,{})),o++)}return new Sn(i,{})}function B3(e){const t={};return Oo(e,(n,i)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[i]=LC(new Sn([],{}),0,n))}),t}function UI(e){const t={};return Oo(e,(n,i)=>t[i]=`${n}`),t}function $I(e,t,n){return e==n.path&&Vc(t,n.parameters)}const cy="imperative";class jc{constructor(t,n){this.id=t,this.url=n}}class FC extends jc{constructor(t,n,i="imperative",o=null){super(t,n),this.type=0,this.navigationTrigger=i,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ap extends jc{constructor(t,n,i){super(t,n),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Gx extends jc{constructor(t,n,i,o){super(t,n),this.reason=i,this.code=o,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Wx extends jc{constructor(t,n,i,o){super(t,n),this.reason=i,this.code=o,this.type=16}}class zC extends jc{constructor(t,n,i,o){super(t,n),this.error=i,this.target=o,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class V3 extends jc{constructor(t,n,i,o){super(t,n),this.urlAfterRedirects=i,this.state=o,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class j3 extends jc{constructor(t,n,i,o){super(t,n),this.urlAfterRedirects=i,this.state=o,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class U3 extends jc{constructor(t,n,i,o,a){super(t,n),this.urlAfterRedirects=i,this.state=o,this.shouldActivate=a,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class $3 extends jc{constructor(t,n,i,o){super(t,n),this.urlAfterRedirects=i,this.state=o,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class H3 extends jc{constructor(t,n,i,o){super(t,n),this.urlAfterRedirects=i,this.state=o,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class G3{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class W3{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class q3{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Z3{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class X3{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Y3{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class HI{constructor(t,n,i){this.routerEvent=t,this.position=n,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let Q3=(()=>{class e{createUrlTree(n,i,o,a,u,m){return O3(n||i.root,o,a,u,m)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})(),tV=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:function(t){return Q3.\u0275fac(t)},providedIn:"root"}),e})();class GI{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=NC(t,this._root);return n?n.children.map(i=>i.value):[]}firstChild(t){const n=NC(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=BC(t,this._root);return n.length<2?[]:n[n.length-2].children.map(o=>o.value).filter(o=>o!==t)}pathFromRoot(t){return BC(t,this._root).map(n=>n.value)}}function NC(e,t){if(e===t.value)return t;for(const n of t.children){const i=NC(e,n);if(i)return i}return null}function BC(e,t){if(e===t.value)return[t];for(const n of t.children){const i=BC(e,n);if(i.length)return i.unshift(t),i}return[]}class Vu{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function Wm(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class WI extends GI{constructor(t,n){super(t),this.snapshot=n,VC(this,t)}toString(){return this.snapshot.toString()}}function qI(e,t){const n=function nV(e,t){const u=new qx([],{},{},"",{},vn,t,null,e.root,-1,{});return new XI("",new Vu(u,[]))}(e,t),i=new xa([new ry("",{})]),o=new xa({}),a=new xa({}),u=new xa({}),m=new xa(""),y=new qm(i,o,u,m,a,vn,t,n.root);return y.snapshot=n.root,new WI(new Vu(y,[]),n)}class qm{constructor(t,n,i,o,a,u,m,y){this.url=t,this.params=n,this.queryParams=i,this.fragment=o,this.data=a,this.outlet=u,this.component=m,this.title=this.data?.pipe(dt(C=>C[iy]))??Ht(void 0),this._futureSnapshot=y}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(dt(t=>Um(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(dt(t=>Um(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function ZI(e,t="emptyOnly"){const n=e.pathFromRoot;let i=0;if("always"!==t)for(i=n.length-1;i>=1;){const o=n[i],a=n[i-1];if(o.routeConfig&&""===o.routeConfig.path)i--;else{if(a.component)break;i--}}return function iV(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(i))}class qx{get title(){return this.data?.[iy]}constructor(t,n,i,o,a,u,m,y,C,T,A){this.url=t,this.params=n,this.queryParams=i,this.fragment=o,this.data=a,this.outlet=u,this.component=m,this.routeConfig=y,this._urlSegment=C,this._lastPathIndex=T,this._resolve=A}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Um(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Um(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class XI extends GI{constructor(t,n){super(n),this.url=t,VC(this,n)}toString(){return YI(this._root)}}function VC(e,t){t.value._routerState=e,t.children.forEach(n=>VC(e,n))}function YI(e){const t=e.children.length>0?` { ${e.children.map(YI).join(", ")} } `:"";return`${e.value}${t}`}function jC(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Vc(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Vc(t.params,n.params)||e.params.next(n.params),function _3(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Vc(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Vc(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function UC(e,t){const n=Vc(e.params,t.params)&&function b3(e,t){return op(e,t)&&e.every((n,i)=>Vc(n.parameters,t[i].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||UC(e.parent,t.parent))}function uy(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=t.value;const o=function oV(e,t,n){return t.children.map(i=>{for(const o of n.children)if(e.shouldReuseRoute(i.value,o.value.snapshot))return uy(e,i,o);return uy(e,i)})}(e,t,n);return new Vu(i,o)}{if(e.shouldAttach(t.value)){const a=e.retrieve(t.value);if(null!==a){const u=a.route;return u.value._futureSnapshot=t.value,u.children=t.children.map(m=>uy(e,m)),u}}const i=function sV(e){return new qm(new xa(e.url),new xa(e.params),new xa(e.queryParams),new xa(e.fragment),new xa(e.data),e.outlet,e.component,e)}(t.value),o=t.children.map(a=>uy(e,a));return new Vu(i,o)}}const $C="ngNavigationCancelingError";function KI(e,t){const{redirectTo:n,navigationBehaviorOptions:i}=sp(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,o=JI(!1,0,t);return o.url=n,o.navigationBehaviorOptions=i,o}function JI(e,t,n){const i=new Error("NavigationCancelingError: "+(e||""));return i[$C]=!0,i.cancellationCode=t,n&&(i.url=n),i}function QI(e){return eA(e)&&sp(e.url)}function eA(e){return e&&e[$C]}class aV{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new hy,this.attachRef=null}}let hy=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,i){const o=this.getOrCreateContext(n);o.outlet=i,this.contexts.set(n,o)}onChildOutletDestroyed(n){const i=this.getContext(n);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let i=this.getContext(n);return i||(i=new aV,this.contexts.set(n,i)),i}getContext(n){return this.contexts.get(n)||null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Zx=!1;let HC=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=vn,this.activateEvents=new Mi,this.deactivateEvents=new Mi,this.attachEvents=new Mi,this.detachEvents=new Mi,this.parentContexts=cn(hy),this.location=cn(Wl),this.changeDetector=cn(yx),this.environmentInjector=cn(js)}ngOnChanges(n){if(n.name){const{firstChange:i,previousValue:o}=n.name;if(i)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new nt(4012,Zx);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new nt(4012,Zx);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new nt(4012,Zx);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new nt(4013,Zx);this._activatedRoute=n;const o=this.location,u=n.snapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,y=new lV(n,m,o.injector);if(i&&function cV(e){return!!e.resolveComponentFactory}(i)){const C=i.resolveComponentFactory(u);this.activated=o.createComponent(C,o.length,y)}else this.activated=o.createComponent(u,{index:o.length,injector:y,environmentInjector:i??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Ft({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[qr]}),e})();class lV{constructor(t,n,i){this.route=t,this.childContexts=n,this.parent=i}get(t,n){return t===qm?this.route:t===hy?this.childContexts:this.parent.get(t,n)}}let GC=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ks({type:e,selectors:[["ng-component"]],standalone:!0,features:[tS],decls:1,vars:0,template:function(n,i){1&n&&Zt(0,"router-outlet")},dependencies:[HC],encapsulation:2}),e})();function tA(e,t){return e.providers&&!e._injector&&(e._injector=cx(e.providers,t,`Route: ${e.path}`)),e._injector??t}function qC(e){const t=e.children&&e.children.map(qC),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==vn&&(n.component=GC),n}function nl(e){return e.outlet||vn}function nA(e,t){const n=e.filter(i=>nl(i)===t);return n.push(...e.filter(i=>nl(i)!==t)),n}function dy(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class pV{constructor(t,n,i,o){this.routeReuseStrategy=t,this.futureState=n,this.currState=i,this.forwardEvent=o}activate(t){const n=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,i,t),jC(this.futureState.root),this.activateChildRoutes(n,i,t)}deactivateChildRoutes(t,n,i){const o=Wm(n);t.children.forEach(a=>{const u=a.value.outlet;this.deactivateRoutes(a,o[u],i),delete o[u]}),Oo(o,(a,u)=>{this.deactivateRouteAndItsChildren(a,i)})}deactivateRoutes(t,n,i){const o=t.value,a=n?n.value:null;if(o===a)if(o.component){const u=i.getContext(o.outlet);u&&this.deactivateChildRoutes(t,n,u.children)}else this.deactivateChildRoutes(t,n,i);else a&&this.deactivateRouteAndItsChildren(n,i)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const i=n.getContext(t.value.outlet),o=i&&t.value.component?i.children:n,a=Wm(t);for(const u of Object.keys(a))this.deactivateRouteAndItsChildren(a[u],o);if(i&&i.outlet){const u=i.outlet.detach(),m=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:u,route:t,contexts:m})}}deactivateRouteAndOutlet(t,n){const i=n.getContext(t.value.outlet),o=i&&t.value.component?i.children:n,a=Wm(t);for(const u of Object.keys(a))this.deactivateRouteAndItsChildren(a[u],o);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,n,i){const o=Wm(n);t.children.forEach(a=>{this.activateRoutes(a,o[a.value.outlet],i),this.forwardEvent(new Y3(a.value.snapshot))}),t.children.length&&this.forwardEvent(new Z3(t.value.snapshot))}activateRoutes(t,n,i){const o=t.value,a=n?n.value:null;if(jC(o),o===a)if(o.component){const u=i.getOrCreateContext(o.outlet);this.activateChildRoutes(t,n,u.children)}else this.activateChildRoutes(t,n,i);else if(o.component){const u=i.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const m=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),u.children.onOutletReAttached(m.contexts),u.attachRef=m.componentRef,u.route=m.route.value,u.outlet&&u.outlet.attach(m.componentRef,m.route.value),jC(m.route.value),this.activateChildRoutes(t,null,u.children)}else{const m=dy(o.snapshot),y=m?.get(Qh)??null;u.attachRef=null,u.route=o,u.resolver=y,u.injector=m,u.outlet&&u.outlet.activateWith(o,u.injector),this.activateChildRoutes(t,null,u.children)}}else this.activateChildRoutes(t,null,i)}}class iA{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Xx{constructor(t,n){this.component=t,this.route=n}}function mV(e,t,n){const i=e._root;return fy(i,t?t._root:null,n,[i.value])}function Zm(e,t){const n=Symbol(),i=t.get(e,n);return i===n?"function"!=typeof e||function Vd(e){return null!==wo(e)}(e)?t.get(e):e:i}function fy(e,t,n,i,o={canDeactivateChecks:[],canActivateChecks:[]}){const a=Wm(t);return e.children.forEach(u=>{(function _V(e,t,n,i,o={canDeactivateChecks:[],canActivateChecks:[]}){const a=e.value,u=t?t.value:null,m=n?n.getContext(e.value.outlet):null;if(u&&a.routeConfig===u.routeConfig){const y=function yV(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!op(e.url,t.url);case"pathParamsOrQueryParamsChange":return!op(e.url,t.url)||!Vc(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!UC(e,t)||!Vc(e.queryParams,t.queryParams);default:return!UC(e,t)}}(u,a,a.routeConfig.runGuardsAndResolvers);y?o.canActivateChecks.push(new iA(i)):(a.data=u.data,a._resolvedData=u._resolvedData),fy(e,t,a.component?m?m.children:null:n,i,o),y&&m&&m.outlet&&m.outlet.isActivated&&o.canDeactivateChecks.push(new Xx(m.outlet.component,u))}else u&&py(t,m,o),o.canActivateChecks.push(new iA(i)),fy(e,null,a.component?m?m.children:null:n,i,o)})(u,a[u.value.outlet],n,i.concat([u.value]),o),delete a[u.value.outlet]}),Oo(a,(u,m)=>py(u,n.getContext(m),o)),o}function py(e,t,n){const i=Wm(e),o=e.value;Oo(i,(a,u)=>{py(a,o.component?t?t.children.getContext(u):null:t,n)}),n.canDeactivateChecks.push(new Xx(o.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,o))}function my(e){return"function"==typeof e}function ZC(e){return e instanceof Fx||"EmptyError"===e?.name}const Yx=Symbol("INITIAL_VALUE");function Xm(){return Nc(e=>yI(e.map(t=>t.pipe(jm(1),function u3(...e){const t=pl(e);return gi((n,i)=>{(t?TC(e,n,t):TC(e,n)).subscribe(i)})}(Yx)))).pipe(dt(t=>{for(const n of t)if(!0!==n){if(n===Yx)return Yx;if(!1===n||n instanceof bd)return n}return!0}),Bc(t=>t!==Yx),jm(1)))}function rA(e){return function hn(...e){return ul(e)}(no(t=>{if(sp(t))throw KI(0,t)}),dt(t=>!0===t))}const XC={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function oA(e,t,n,i,o){const a=YC(e,t,n);return a.matched?function LV(e,t,n,i){const o=t.canMatch;return o&&0!==o.length?Ht(o.map(u=>{const m=Zm(u,e);return xd(function EV(e){return e&&my(e.canMatch)}(m)?m.canMatch(t,n):e.runInContext(()=>m(t,n)))})).pipe(Xm(),rA()):Ht(!0)}(i=tA(t,i),t,n).pipe(dt(u=>!0===u?a:{...XC})):Ht(a)}function YC(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...XC}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const o=(t.matcher||g3)(n,e,t);if(!o)return{...XC};const a={};Oo(o.posParams,(m,y)=>{a[y]=m.path});const u=o.consumed.length>0?{...a,...o.consumed[o.consumed.length-1].parameters}:a;return{matched:!0,consumedSegments:o.consumed,remainingSegments:n.slice(o.consumed.length),parameters:u,positionalParamSegments:o.posParams??{}}}function Kx(e,t,n,i){if(n.length>0&&function NV(e,t,n){return n.some(i=>Jx(e,t,i)&&nl(i)!==vn)}(e,n,i)){const a=new Sn(t,function zV(e,t,n,i){const o={};o[vn]=i,i._sourceSegment=e,i._segmentIndexShift=t.length;for(const a of n)if(""===a.path&&nl(a)!==vn){const u=new Sn([],{});u._sourceSegment=e,u._segmentIndexShift=t.length,o[nl(a)]=u}return o}(e,t,i,new Sn(n,e.children)));return a._sourceSegment=e,a._segmentIndexShift=t.length,{segmentGroup:a,slicedSegments:[]}}if(0===n.length&&function BV(e,t,n){return n.some(i=>Jx(e,t,i))}(e,n,i)){const a=new Sn(e.segments,function FV(e,t,n,i,o){const a={};for(const u of i)if(Jx(e,n,u)&&!o[nl(u)]){const m=new Sn([],{});m._sourceSegment=e,m._segmentIndexShift=t.length,a[nl(u)]=m}return{...o,...a}}(e,t,n,i,e.children));return a._sourceSegment=e,a._segmentIndexShift=t.length,{segmentGroup:a,slicedSegments:n}}const o=new Sn(e.segments,e.children);return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:n}}function Jx(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function sA(e,t,n,i){return!!(nl(e)===i||i!==vn&&Jx(t,n,e))&&("**"===e.path||YC(t,e,n).matched)}function aA(e,t,n){return 0===t.length&&!e.children[n]}const Qx=!1;class eb{constructor(t){this.segmentGroup=t||null}}class lA{constructor(t){this.urlTree=t}}function gy(e){return ny(new eb(e))}function cA(e){return ny(new lA(e))}class $V{constructor(t,n,i,o,a){this.injector=t,this.configLoader=n,this.urlSerializer=i,this.urlTree=o,this.config=a,this.allowRedirects=!0}apply(){const t=Kx(this.urlTree.root,[],[],this.config).segmentGroup,n=new Sn(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,n,vn).pipe(dt(a=>this.createUrlTree(Hx(a),this.urlTree.queryParams,this.urlTree.fragment))).pipe(vd(a=>{if(a instanceof lA)return this.allowRedirects=!1,this.match(a.urlTree);throw a instanceof eb?this.noMatchError(a):a}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,vn).pipe(dt(o=>this.createUrlTree(Hx(o),t.queryParams,t.fragment))).pipe(vd(o=>{throw o instanceof eb?this.noMatchError(o):o}))}noMatchError(t){return new nt(4002,Qx)}createUrlTree(t,n,i){const o=kC(t);return new bd(o,n,i)}expandSegmentGroup(t,n,i,o){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,n,i).pipe(dt(a=>new Sn([],a))):this.expandSegment(t,i,n,i.segments,o,!0)}expandChildren(t,n,i){const o=[];for(const a of Object.keys(i.children))"primary"===a?o.unshift(a):o.push(a);return Li(o).pipe(yd(a=>{const u=i.children[a],m=nA(n,a);return this.expandSegmentGroup(t,m,u,a).pipe(dt(y=>({segment:y,outlet:a})))}),CI((a,u)=>(a[u.outlet]=u.segment,a),{}),EI())}expandSegment(t,n,i,o,a,u){return Li(i).pipe(yd(m=>this.expandSegmentAgainstRoute(t,n,i,m,o,a,u).pipe(vd(C=>{if(C instanceof eb)return Ht(null);throw C}))),_d(m=>!!m),vd((m,y)=>{if(ZC(m))return aA(n,o,a)?Ht(new Sn([],{})):gy(n);throw m}))}expandSegmentAgainstRoute(t,n,i,o,a,u,m){return sA(o,n,a,u)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(t,n,o,a,u):m&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,i,o,a,u):gy(n):gy(n)}expandSegmentAgainstRouteUsingRedirect(t,n,i,o,a,u){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,o,u):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,i,o,a,u)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,i,o){const a=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?cA(a):this.lineralizeSegments(i,a).pipe(Lt(u=>{const m=new Sn(u,{});return this.expandSegment(t,m,n,u,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,i,o,a,u){const{matched:m,consumedSegments:y,remainingSegments:C,positionalParamSegments:T}=YC(n,o,a);if(!m)return gy(n);const A=this.applyRedirectCommands(y,o.redirectTo,T);return o.redirectTo.startsWith("/")?cA(A):this.lineralizeSegments(o,A).pipe(Lt(z=>this.expandSegment(t,n,i,z.concat(C),u,!1)))}matchSegmentAgainstRoute(t,n,i,o,a){return"**"===i.path?(t=tA(i,t),i.loadChildren?(i._loadedRoutes?Ht({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(t,i)).pipe(dt(m=>(i._loadedRoutes=m.routes,i._loadedInjector=m.injector,new Sn(o,{})))):Ht(new Sn(o,{}))):oA(n,i,o,t).pipe(Nc(({matched:u,consumedSegments:m,remainingSegments:y})=>u?this.getChildConfig(t=i._injector??t,i,o).pipe(Lt(T=>{const A=T.injector??t,z=T.routes,{segmentGroup:V,slicedSegments:H}=Kx(n,m,y,z),X=new Sn(V.segments,V.children);if(0===H.length&&X.hasChildren())return this.expandChildren(A,z,X).pipe(dt(ve=>new Sn(m,ve)));if(0===z.length&&0===H.length)return Ht(new Sn(m,{}));const oe=nl(i)===a;return this.expandSegment(A,X,z,H,oe?vn:a,!0).pipe(dt(we=>new Sn(m.concat(we.segments),we.children)))})):gy(n)))}getChildConfig(t,n,i){return n.children?Ht({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?Ht({routes:n._loadedRoutes,injector:n._loadedInjector}):function OV(e,t,n,i){const o=t.canLoad;return void 0===o||0===o.length?Ht(!0):Ht(o.map(u=>{const m=Zm(u,e);return xd(function xV(e){return e&&my(e.canLoad)}(m)?m.canLoad(t,n):e.runInContext(()=>m(t,n)))})).pipe(Xm(),rA())}(t,n,i).pipe(Lt(o=>o?this.configLoader.loadChildren(t,n).pipe(no(a=>{n._loadedRoutes=a.routes,n._loadedInjector=a.injector})):function jV(e){return ny(JI(Qx,3))}())):Ht({routes:[],injector:t})}lineralizeSegments(t,n){let i=[],o=n.root;for(;;){if(i=i.concat(o.segments),0===o.numberOfChildren)return Ht(i);if(o.numberOfChildren>1||!o.children[vn])return t.redirectTo,ny(new nt(4e3,Qx));o=o.children[vn]}}applyRedirectCommands(t,n,i){return this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,i)}applyRedirectCreateUrlTree(t,n,i,o){const a=this.createSegmentGroup(t,n.root,i,o);return new bd(a,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const i={};return Oo(t,(o,a)=>{if("string"==typeof o&&o.startsWith(":")){const m=o.substring(1);i[a]=n[m]}else i[a]=o}),i}createSegmentGroup(t,n,i,o){const a=this.createSegments(t,n.segments,i,o);let u={};return Oo(n.children,(m,y)=>{u[y]=this.createSegmentGroup(t,m,i,o)}),new Sn(a,u)}createSegments(t,n,i,o){return n.map(a=>a.path.startsWith(":")?this.findPosParam(t,a,o):this.findOrReturn(a,i))}findPosParam(t,n,i){const o=i[n.path.substring(1)];if(!o)throw new nt(4001,Qx);return o}findOrReturn(t,n){let i=0;for(const o of n){if(o.path===t.path)return n.splice(i),o;i++}return t}}class GV{}class ZV{constructor(t,n,i,o,a,u,m){this.injector=t,this.rootComponentType=n,this.config=i,this.urlTree=o,this.url=a,this.paramsInheritanceStrategy=u,this.urlSerializer=m}recognize(){const t=Kx(this.urlTree.root,[],[],this.config.filter(n=>void 0===n.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,vn).pipe(dt(n=>{if(null===n)return null;const i=new qx([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},vn,this.rootComponentType,null,this.urlTree.root,-1,{}),o=new Vu(i,n),a=new XI(this.url,o);return this.inheritParamsAndData(a._root),a}))}inheritParamsAndData(t){const n=t.value,i=ZI(n,this.paramsInheritanceStrategy);n.params=Object.freeze(i.params),n.data=Object.freeze(i.data),t.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(t,n,i,o){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,n,i):this.processSegment(t,n,i,i.segments,o)}processChildren(t,n,i){return Li(Object.keys(i.children)).pipe(yd(o=>{const a=i.children[o],u=nA(n,o);return this.processSegmentGroup(t,u,a,o)}),CI((o,a)=>o&&a?(o.push(...a),o):null),function f3(e,t=!1){return gi((n,i)=>{let o=0;n.subscribe(Yn(i,a=>{const u=e(a,o++);(u||t)&&i.next(a),!u&&i.complete()}))})}(o=>null!==o),zx(null),EI(),dt(o=>{if(null===o)return null;const a=hA(o);return function XV(e){e.sort((t,n)=>t.value.outlet===vn?-1:n.value.outlet===vn?1:t.value.outlet.localeCompare(n.value.outlet))}(a),a}))}processSegment(t,n,i,o,a){return Li(n).pipe(yd(u=>this.processSegmentAgainstRoute(u._injector??t,u,i,o,a)),_d(u=>!!u),vd(u=>{if(ZC(u))return aA(i,o,a)?Ht([]):Ht(null);throw u}))}processSegmentAgainstRoute(t,n,i,o,a){if(n.redirectTo||!sA(n,i,o,a))return Ht(null);let u;if("**"===n.path){const m=o.length>0?SI(o).parameters:{},y=fA(i)+o.length;u=Ht({snapshot:new qx(o,m,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,pA(n),nl(n),n.component??n._loadedComponent??null,n,dA(i),y,mA(n)),consumedSegments:[],remainingSegments:[]})}else u=oA(i,n,o,t).pipe(dt(({matched:m,consumedSegments:y,remainingSegments:C,parameters:T})=>{if(!m)return null;const A=fA(i)+y.length;return{snapshot:new qx(y,T,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,pA(n),nl(n),n.component??n._loadedComponent??null,n,dA(i),A,mA(n)),consumedSegments:y,remainingSegments:C}}));return u.pipe(Nc(m=>{if(null===m)return Ht(null);const{snapshot:y,consumedSegments:C,remainingSegments:T}=m;t=n._injector??t;const A=n._loadedInjector??t,z=function YV(e){return e.children?e.children:e.loadChildren?e._loadedRoutes:[]}(n),{segmentGroup:V,slicedSegments:H}=Kx(i,C,T,z.filter(oe=>void 0===oe.redirectTo));if(0===H.length&&V.hasChildren())return this.processChildren(A,z,V).pipe(dt(oe=>null===oe?null:[new Vu(y,oe)]));if(0===z.length&&0===H.length)return Ht([new Vu(y,[])]);const X=nl(n)===a;return this.processSegment(A,z,V,H,X?vn:a).pipe(dt(oe=>null===oe?null:[new Vu(y,oe)]))}))}}function KV(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function hA(e){const t=[],n=new Set;for(const i of e){if(!KV(i)){t.push(i);continue}const o=t.find(a=>i.value.routeConfig===a.value.routeConfig);void 0!==o?(o.children.push(...i.children),n.add(o)):t.push(i)}for(const i of n){const o=hA(i.children);t.push(new Vu(i.value,o))}return t.filter(i=>!n.has(i))}function dA(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function fA(e){let t=e,n=t._segmentIndexShift??0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift??0;return n-1}function pA(e){return e.data||{}}function mA(e){return e.resolve||{}}function gA(e){return"string"==typeof e.title||null===e.title}function KC(e){return Nc(t=>{const n=e(t);return n?Li(n).pipe(dt(()=>t)):Ht(t)})}const Ym=new Mt("ROUTES");let JC=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=cn(WS)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Ht(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const i=xd(n.loadComponent()).pipe(dt(yA),no(a=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=a}),IC(()=>{this.componentLoaders.delete(n)})),o=new bI(i,()=>new oo).pipe(SC());return this.componentLoaders.set(n,o),o}loadChildren(n,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Ht({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const a=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(dt(m=>{this.onLoadEndListener&&this.onLoadEndListener(i);let y,C,T=!1;Array.isArray(m)?C=m:(y=m.create(n).injector,C=TI(y.get(Ym,[],Nt.Self|Nt.Optional)));return{routes:C.map(qC),injector:y}}),IC(()=>{this.childrenLoaders.delete(i)})),u=new bI(a,()=>new oo).pipe(SC());return this.childrenLoaders.set(i,u),u}loadModuleFactoryOrRoutes(n){return xd(n()).pipe(dt(yA),Lt(i=>i instanceof QT||Array.isArray(i)?Ht(i):Li(this.compiler.compileModuleAsync(i))))}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function yA(e){return function oj(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let nb=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new oo,this.configLoader=cn(JC),this.environmentInjector=cn(js),this.urlSerializer=cn(oy),this.rootContexts=cn(hy),this.navigationId=0,this.afterPreactivation=()=>Ht(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=o=>this.events.next(new W3(o)),this.configLoader.onLoadStartListener=o=>this.events.next(new G3(o))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const i=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:i})}setupNavigations(n){return this.transitions=new xa({id:0,targetPageId:0,currentUrlTree:n.currentUrlTree,currentRawUrl:n.currentUrlTree,extractedUrl:n.urlHandlingStrategy.extract(n.currentUrlTree),urlAfterRedirects:n.urlHandlingStrategy.extract(n.currentUrlTree),rawUrl:n.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:cy,restoredState:null,currentSnapshot:n.routerState.snapshot,targetSnapshot:null,currentRouterState:n.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Bc(i=>0!==i.id),dt(i=>({...i,extractedUrl:n.urlHandlingStrategy.extract(i.rawUrl)})),Nc(i=>{let o=!1,a=!1;return Ht(i).pipe(no(u=>{this.currentNavigation={id:u.id,initialUrl:u.rawUrl,extractedUrl:u.extractedUrl,trigger:u.source,extras:u.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Nc(u=>{const m=n.browserUrlTree.toString(),y=!n.navigated||u.extractedUrl.toString()!==m||m!==n.currentUrlTree.toString();if(!y&&"reload"!==(u.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const T="";return this.events.next(new Wx(u.id,n.serializeUrl(i.rawUrl),T,0)),n.rawUrlTree=u.rawUrl,u.resolve(null),ao}if(n.urlHandlingStrategy.shouldProcessUrl(u.rawUrl))return vA(u.source)&&(n.browserUrlTree=u.extractedUrl),Ht(u).pipe(Nc(T=>{const A=this.transitions?.getValue();return this.events.next(new FC(T.id,this.urlSerializer.serialize(T.extractedUrl),T.source,T.restoredState)),A!==this.transitions?.getValue()?ao:Promise.resolve(T)}),function HV(e,t,n,i){return Nc(o=>function UV(e,t,n,i,o){return new $V(e,t,n,i,o).apply()}(e,t,n,o.extractedUrl,i).pipe(dt(a=>({...o,urlAfterRedirects:a}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,n.config),no(T=>{this.currentNavigation={...this.currentNavigation,finalUrl:T.urlAfterRedirects},i.urlAfterRedirects=T.urlAfterRedirects}),function QV(e,t,n,i,o){return Lt(a=>function qV(e,t,n,i,o,a,u="emptyOnly"){return new ZV(e,t,n,i,o,u,a).recognize().pipe(Nc(m=>null===m?function WV(e){return new fn(t=>t.error(e))}(new GV):Ht(m)))}(e,t,n,a.urlAfterRedirects,i.serialize(a.urlAfterRedirects),i,o).pipe(dt(u=>({...a,targetSnapshot:u}))))}(this.environmentInjector,this.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),no(T=>{if(i.targetSnapshot=T.targetSnapshot,"eager"===n.urlUpdateStrategy){if(!T.extras.skipLocationChange){const z=n.urlHandlingStrategy.merge(T.urlAfterRedirects,T.rawUrl);n.setBrowserUrl(z,T)}n.browserUrlTree=T.urlAfterRedirects}const A=new V3(T.id,this.urlSerializer.serialize(T.extractedUrl),this.urlSerializer.serialize(T.urlAfterRedirects),T.targetSnapshot);this.events.next(A)}));if(y&&n.urlHandlingStrategy.shouldProcessUrl(n.rawUrlTree)){const{id:T,extractedUrl:A,source:z,restoredState:V,extras:H}=u,X=new FC(T,this.urlSerializer.serialize(A),z,V);this.events.next(X);const oe=qI(A,this.rootComponentType).snapshot;return Ht(i={...u,targetSnapshot:oe,urlAfterRedirects:A,extras:{...H,skipLocationChange:!1,replaceUrl:!1}})}{const T="";return this.events.next(new Wx(u.id,n.serializeUrl(i.extractedUrl),T,1)),n.rawUrlTree=u.rawUrl,u.resolve(null),ao}}),no(u=>{const m=new j3(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(m)}),dt(u=>i={...u,guards:mV(u.targetSnapshot,u.currentSnapshot,this.rootContexts)}),function TV(e,t){return Lt(n=>{const{targetSnapshot:i,currentSnapshot:o,guards:{canActivateChecks:a,canDeactivateChecks:u}}=n;return 0===u.length&&0===a.length?Ht({...n,guardsResult:!0}):function SV(e,t,n,i){return Li(e).pipe(Lt(o=>function RV(e,t,n,i,o){const a=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return a&&0!==a.length?Ht(a.map(m=>{const y=dy(t)??o,C=Zm(m,y);return xd(function CV(e){return e&&my(e.canDeactivate)}(C)?C.canDeactivate(e,t,n,i):y.runInContext(()=>C(e,t,n,i))).pipe(_d())})).pipe(Xm()):Ht(!0)}(o.component,o.route,n,t,i)),_d(o=>!0!==o,!0))}(u,i,o,e).pipe(Lt(m=>m&&function vV(e){return"boolean"==typeof e}(m)?function MV(e,t,n,i){return Li(t).pipe(yd(o=>TC(function AV(e,t){return null!==e&&t&&t(new q3(e)),Ht(!0)}(o.route.parent,i),function IV(e,t){return null!==e&&t&&t(new X3(e)),Ht(!0)}(o.route,i),function kV(e,t,n){const i=t[t.length-1],a=t.slice(0,t.length-1).reverse().map(u=>function gV(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(u)).filter(u=>null!==u).map(u=>xI(()=>Ht(u.guards.map(y=>{const C=dy(u.node)??n,T=Zm(y,C);return xd(function wV(e){return e&&my(e.canActivateChild)}(T)?T.canActivateChild(i,e):C.runInContext(()=>T(i,e))).pipe(_d())})).pipe(Xm())));return Ht(a).pipe(Xm())}(e,o.path,n),function PV(e,t,n){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return Ht(!0);const o=i.map(a=>xI(()=>{const u=dy(t)??n,m=Zm(a,u);return xd(function bV(e){return e&&my(e.canActivate)}(m)?m.canActivate(t,e):u.runInContext(()=>m(t,e))).pipe(_d())}));return Ht(o).pipe(Xm())}(e,o.route,n))),_d(o=>!0!==o,!0))}(i,a,e,t):Ht(m)),dt(m=>({...n,guardsResult:m})))})}(this.environmentInjector,u=>this.events.next(u)),no(u=>{if(i.guardsResult=u.guardsResult,sp(u.guardsResult))throw KI(0,u.guardsResult);const m=new U3(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot,!!u.guardsResult);this.events.next(m)}),Bc(u=>!!u.guardsResult||(n.restoreHistory(u),this.cancelNavigationTransition(u,"",3),!1)),KC(u=>{if(u.guards.canActivateChecks.length)return Ht(u).pipe(no(m=>{const y=new $3(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(y)}),Nc(m=>{let y=!1;return Ht(m).pipe(function ej(e,t){return Lt(n=>{const{targetSnapshot:i,guards:{canActivateChecks:o}}=n;if(!o.length)return Ht(n);let a=0;return Li(o).pipe(yd(u=>function tj(e,t,n,i){const o=e.routeConfig,a=e._resolve;return void 0!==o?.title&&!gA(o)&&(a[iy]=o.title),function nj(e,t,n,i){const o=function ij(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===o.length)return Ht({});const a={};return Li(o).pipe(Lt(u=>function rj(e,t,n,i){const o=dy(t)??i,a=Zm(e,o);return xd(a.resolve?a.resolve(t,n):o.runInContext(()=>a(t,n)))}(e[u],t,n,i).pipe(_d(),no(m=>{a[u]=m}))),MC(1),function p3(e){return dt(()=>e)}(a),vd(u=>ZC(u)?ao:ny(u)))}(a,e,t,i).pipe(dt(u=>(e._resolvedData=u,e.data=ZI(e,n).resolve,o&&gA(o)&&(e.data[iy]=o.title),null)))}(u.route,i,e,t)),no(()=>a++),MC(1),Lt(u=>a===o.length?Ht(n):ao))})}(n.paramsInheritanceStrategy,this.environmentInjector),no({next:()=>y=!0,complete:()=>{y||(n.restoreHistory(m),this.cancelNavigationTransition(m,"",2))}}))}),no(m=>{const y=new H3(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(y)}))}),KC(u=>{const m=y=>{const C=[];y.routeConfig?.loadComponent&&!y.routeConfig._loadedComponent&&C.push(this.configLoader.loadComponent(y.routeConfig).pipe(no(T=>{y.component=T}),dt(()=>{})));for(const T of y.children)C.push(...m(T));return C};return yI(m(u.targetSnapshot.root)).pipe(zx(),jm(1))}),KC(()=>this.afterPreactivation()),dt(u=>{const m=function rV(e,t,n){const i=uy(e,t._root,n?n._root:void 0);return new WI(i,t)}(n.routeReuseStrategy,u.targetSnapshot,u.currentRouterState);return i={...u,targetRouterState:m}}),no(u=>{n.currentUrlTree=u.urlAfterRedirects,n.rawUrlTree=n.urlHandlingStrategy.merge(u.urlAfterRedirects,u.rawUrl),n.routerState=u.targetRouterState,"deferred"===n.urlUpdateStrategy&&(u.extras.skipLocationChange||n.setBrowserUrl(n.rawUrlTree,u),n.browserUrlTree=u.urlAfterRedirects)}),((e,t,n)=>dt(i=>(new pV(t,i.targetRouterState,i.currentRouterState,n).activate(e),i)))(this.rootContexts,n.routeReuseStrategy,u=>this.events.next(u)),jm(1),no({next:u=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,n.navigated=!0,this.events.next(new ap(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(n.currentUrlTree))),n.titleStrategy?.updateTitle(u.targetRouterState.snapshot),u.resolve(!0)},complete:()=>{o=!0}}),IC(()=>{o||a||this.cancelNavigationTransition(i,"",1),this.currentNavigation?.id===i.id&&(this.currentNavigation=null)}),vd(u=>{if(a=!0,eA(u)){QI(u)||(n.navigated=!0,n.restoreHistory(i,!0));const m=new Gx(i.id,this.urlSerializer.serialize(i.extractedUrl),u.message,u.cancellationCode);if(this.events.next(m),QI(u)){const y=n.urlHandlingStrategy.merge(u.url,n.rawUrlTree),C={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===n.urlUpdateStrategy||vA(i.source)};n.scheduleNavigation(y,cy,null,C,{resolve:i.resolve,reject:i.reject,promise:i.promise})}else i.resolve(!1)}else{n.restoreHistory(i,!0);const m=new zC(i.id,this.urlSerializer.serialize(i.extractedUrl),u,i.targetSnapshot??void 0);this.events.next(m);try{i.resolve(n.errorHandler(u))}catch(y){i.reject(y)}}return ao}))}))}cancelNavigationTransition(n,i,o){const a=new Gx(n.id,this.urlSerializer.serialize(n.extractedUrl),i,o);this.events.next(a),n.resolve(!1)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function vA(e){return e!==cy}let xA=(()=>{class e{buildTitle(n){let i,o=n.root;for(;void 0!==o;)i=this.getResolvedTitleForRoute(o)??i,o=o.children.find(a=>a.outlet===vn);return i}getResolvedTitleForRoute(n){return n.data[iy]}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:function(){return cn(sj)},providedIn:"root"}),e})(),sj=(()=>{class e extends xA{constructor(n){super(),this.title=n}updateTitle(n){const i=this.buildTitle(n);void 0!==i&&this.title.setTitle(i)}}return e.\u0275fac=function(n){return new(n||e)(Dt(fI))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),aj=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:function(){return cn(cj)},providedIn:"root"}),e})();class lj{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}let cj=(()=>{class e extends lj{}return e.\u0275fac=function(){let t;return function(i){return(t||(t=Yr(e)))(i||e)}}(),e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const ib=new Mt("",{providedIn:"root",factory:()=>({})});let hj=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:function(){return cn(dj)},providedIn:"root"}),e})(),dj=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,i){return n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function fj(e){throw e}function pj(e,t,n){return t.parse("/")}const mj={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},gj={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ws=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=cn(WF),this.isNgZoneEnabled=!1,this.options=cn(ib,{optional:!0})||{},this.errorHandler=this.options.errorHandler||fj,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||pj,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=cn(hj),this.routeReuseStrategy=cn(aj),this.urlCreationStrategy=cn(tV),this.titleStrategy=cn(xA),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=TI(cn(Ym,{optional:!0})??[]),this.navigationTransitions=cn(nb),this.urlSerializer=cn(oy),this.location=cn(eC),this.isNgZoneEnabled=cn(rr)instanceof rr&&rr.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new bd,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=qI(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId??0},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const n=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),cy,n)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const i="popstate"===n.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{this.navigateToSyncWithBrowser(n.url,i,n.state)},0)}))}navigateToSyncWithBrowser(n,i,o){const a={replaceUrl:!0},u=o?.navigationId?o:null;if(o){const y={...o};delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(a.state=y)}const m=this.parseUrl(n);this.scheduleNavigation(m,i,u,a)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(n){this.config=n.map(qC),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,i={}){const{relativeTo:o,queryParams:a,fragment:u,queryParamsHandling:m,preserveFragment:y}=i,C=y?this.currentUrlTree.fragment:u;let T=null;switch(m){case"merge":T={...this.currentUrlTree.queryParams,...a};break;case"preserve":T=this.currentUrlTree.queryParams;break;default:T=a||null}return null!==T&&(T=this.removeEmptyProps(T)),this.urlCreationStrategy.createUrlTree(o,this.routerState,this.currentUrlTree,n,T,C??null)}navigateByUrl(n,i={skipLocationChange:!1}){const o=sp(n)?n:this.parseUrl(n),a=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(a,cy,null,i)}navigate(n,i={skipLocationChange:!1}){return function _j(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new nt(4008,false)}}(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let i;try{i=this.urlSerializer.parse(n)}catch(o){i=this.malformedUriErrorHandler(o,this.urlSerializer,n)}return i}isActive(n,i){let o;if(o=!0===i?{...mj}:!1===i?{...gj}:i,sp(n))return II(this.currentUrlTree,n,o);const a=this.parseUrl(n);return II(this.currentUrlTree,a,o)}removeEmptyProps(n){return Object.keys(n).reduce((i,o)=>{const a=n[o];return null!=a&&(i[o]=a),i},{})}scheduleNavigation(n,i,o,a,u){if(this.disposed)return Promise.resolve(!1);let m,y,C,T;return u?(m=u.resolve,y=u.reject,C=u.promise):C=new Promise((A,z)=>{m=A,y=z}),T="computed"===this.canceledNavigationResolution?o&&o.\u0275routerPageId?o.\u0275routerPageId:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:T,source:i,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:a,resolve:m,reject:y,promise:C,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),C.catch(A=>Promise.reject(A))}setBrowserUrl(n,i){const o=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(o)||i.extras.replaceUrl){const u={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId)};this.location.replaceState(o,"",u)}else{const a={...i.extras.state,...this.generateNgRouterState(i.id,i.targetPageId)};this.location.go(o,"",a)}}restoreHistory(n,i=!1){if("computed"===this.canceledNavigationResolution){const a=this.currentPageId-(this.browserPageId??this.currentPageId);0!==a?this.location.historyGo(a):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===a&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,i){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Km=(()=>{class e{constructor(n,i,o,a,u,m){this.router=n,this.route=i,this.tabIndexAttribute=o,this.renderer=a,this.el=u,this.locationStrategy=m,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new oo;const y=u.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===y||"area"===y,this.isAnchorElement?this.subscription=n.events.subscribe(C=>{C instanceof ap&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(n){this._preserveFragment=Bm(n)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(n){this._skipLocationChange=Bm(n)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(n){this._replaceUrl=Bm(n)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(n){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(n,i,o,a,u){return!!(null===this.urlTree||this.isAnchorElement&&(0!==n||i||o||a||u||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const n=null===this.href?null:function Jr(e,t,n){return function Wv(e,t){return"src"===t&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===t&&("base"===e||"link"===e)?Hv:Zh}(t,n)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",n)}applyAttributeValue(n,i){const o=this.renderer,a=this.el.nativeElement;null!==i?o.setAttribute(a,n,i):o.removeAttribute(a,n)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return e.\u0275fac=function(n){return new(n||e)(Qe(Ws),Qe(qm),function Ll(e){return function rv(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const i=n.length;let o=0;for(;o<i;){const a=n[o];if(jn(a))break;if(0===a)o+=2;else if("number"==typeof a)for(o++;o<i&&"string"==typeof n[o];)o++;else{if(a===t)return n[o+1];o+=2}}}return null}(_r(),e)}("tabindex"),Qe(jl),Qe(Po),Qe(rp))},e.\u0275dir=Ft({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(n,i){1&n&&Mn("click",function(a){return i.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),2&n&&Ge("target",i.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[qr]}),e})();class bA{}let xj=(()=>{class e{constructor(n,i,o,a,u){this.router=n,this.injector=o,this.preloadingStrategy=a,this.loader=u}setUpPreloading(){this.subscription=this.router.events.pipe(Bc(n=>n instanceof ap),yd(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,i){const o=[];for(const a of i){a.providers&&!a._injector&&(a._injector=cx(a.providers,n,`Route: ${a.path}`));const u=a._injector??n,m=a._loadedInjector??u;(a.loadChildren&&!a._loadedRoutes&&void 0===a.canLoad||a.loadComponent&&!a._loadedComponent)&&o.push(this.preloadConfig(u,a)),(a.children||a._loadedRoutes)&&o.push(this.processRoutes(m,a.children??a._loadedRoutes))}return Li(o).pipe(Aa())}preloadConfig(n,i){return this.preloadingStrategy.preload(i,()=>{let o;o=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(n,i):Ht(null);const a=o.pipe(Lt(u=>null===u?Ht(void 0):(i._loadedRoutes=u.routes,i._loadedInjector=u.injector,this.processRoutes(u.injector??n,u.routes))));return i.loadComponent&&!i._loadedComponent?Li([a,this.loader.loadComponent(i)]).pipe(Aa()):a})}}return e.\u0275fac=function(n){return new(n||e)(Dt(Ws),Dt(WS),Dt(js),Dt(bA),Dt(JC))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const eE=new Mt("");let wA=(()=>{class e{constructor(n,i,o,a,u={}){this.urlSerializer=n,this.transitions=i,this.viewportScroller=o,this.zone=a,this.options=u,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},u.scrollPositionRestoration=u.scrollPositionRestoration||"disabled",u.anchorScrolling=u.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof FC?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof ap&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof HI&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new HI(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return e.\u0275fac=function(n){!function D_(){throw new Error("invalid")}()},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();var ba=(()=>((ba=ba||{})[ba.COMPLETE=0]="COMPLETE",ba[ba.FAILED=1]="FAILED",ba[ba.REDIRECTING=2]="REDIRECTING",ba))();const Jm=!1;function wd(e,t){return{\u0275kind:e,\u0275providers:t}}const tE=new Mt("",{providedIn:"root",factory:()=>!1});function EA(){const e=cn(qa);return t=>{const n=e.get(gx);if(t!==n.components[0])return;const i=e.get(Ws),o=e.get(DA);1===e.get(nE)&&i.initialNavigation(),e.get(TA,null,Nt.Optional)?.setUpPreloading(),e.get(eE,null,Nt.Optional)?.init(),i.resetRootComponentType(n.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}const DA=new Mt(Jm?"bootstrap done indicator":"",{factory:()=>new oo}),nE=new Mt(Jm?"initial navigation":"",{providedIn:"root",factory:()=>1});function Dj(){let e=[];return e=Jm?[{provide:Ff,multi:!0,useFactory:()=>{const t=cn(Ws);return()=>t.events.subscribe(n=>{console.group?.(`Router Event: ${n.constructor.name}`),console.log(function K3(e){if(!("type"in e))return`Unknown Router Event: ${e.constructor.name}`;switch(e.type){case 14:return`ActivationEnd(path: '${e.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${e.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${e.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${e.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state}, shouldActivate: ${e.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 2:return`NavigationCancel(id: ${e.id}, url: '${e.url}')`;case 16:return`NavigationSkipped(id: ${e.id}, url: '${e.url}')`;case 1:return`NavigationEnd(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${e.id}, url: '${e.url}', error: ${e.error})`;case 0:return`NavigationStart(id: ${e.id}, url: '${e.url}')`;case 6:return`ResolveEnd(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 5:return`ResolveStart(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 10:return`RouteConfigLoadEnd(path: ${e.route.path})`;case 9:return`RouteConfigLoadStart(path: ${e.route.path})`;case 4:return`RoutesRecognized(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 15:return`Scroll(anchor: '${e.anchor}', position: '${e.position?`${e.position[0]}, ${e.position[1]}`:null}')`}}(n)),console.log(n),console.groupEnd?.()})}}]:[],wd(1,e)}const TA=new Mt(Jm?"router preloader":"");function Tj(e){return wd(0,[{provide:TA,useExisting:xj},{provide:bA,useExisting:e}])}const _y=!1,SA=new Mt(_y?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),Sj=[eC,{provide:oy,useClass:AC},Ws,hy,{provide:qm,useFactory:function CA(e){return e.routerState.root},deps:[Ws]},JC,_y?{provide:tE,useValue:!0}:[]];function Mj(){return new eM("Router",Ws)}let MA=(()=>{class e{constructor(n){}static forRoot(n,i){return{ngModule:e,providers:[Sj,_y&&i?.enableTracing?Dj().\u0275providers:[],{provide:Ym,multi:!0,useValue:n},{provide:SA,useFactory:kj,deps:[[Ws,new Oh,new Mo]]},{provide:ib,useValue:i||{}},i?.useHash?{provide:rp,useClass:Rz}:{provide:rp,useClass:CM},{provide:eE,useFactory:()=>{const e=cn(YN),t=cn(rr),n=cn(ib),i=cn(nb),o=cn(oy);return n.scrollOffset&&e.setOffset(n.scrollOffset),new wA(o,i,e,t,n)}},i?.preloadingStrategy?Tj(i.preloadingStrategy).\u0275providers:[],{provide:eM,multi:!0,useFactory:Mj},i?.initialNavigation?Rj(i):[],[{provide:IA,useFactory:EA},{provide:QS,multi:!0,useExisting:IA}]]}}static forChild(n){return{ngModule:e,providers:[{provide:Ym,multi:!0,useValue:n}]}}}return e.\u0275fac=function(n){return new(n||e)(Dt(SA,8))},e.\u0275mod=lr({type:e}),e.\u0275inj=Ui({imports:[GC]}),e})();function kj(e){if(_y&&e)throw new nt(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Rj(e){return["disabled"===e.initialNavigation?wd(3,[{provide:fx,multi:!0,useFactory:()=>{const t=cn(Ws);return()=>{t.setUpLocationChangeListener()}}},{provide:nE,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?wd(2,[{provide:nE,useValue:0},{provide:fx,multi:!0,deps:[qa],useFactory:t=>{const n=t.get(Pz,Promise.resolve());return()=>n.then(()=>new Promise(i=>{const o=t.get(Ws),a=t.get(DA);(function bj(e,t){e.events.pipe(Bc(n=>n instanceof ap||n instanceof Gx||n instanceof zC||n instanceof Wx),dt(n=>n instanceof ap||n instanceof Wx?ba.COMPLETE:n instanceof Gx&&(0===n.code||1===n.code)?ba.REDIRECTING:ba.FAILED),Bc(n=>n!==ba.REDIRECTING),jm(1)).subscribe(()=>{t()})})(o,()=>{i(!0)}),t.get(nb).afterPreactivation=()=>(i(!0),a.closed?Ht(void 0):a),o.initialNavigation()}))}}]).\u0275providers:[]]}const IA=new Mt(_y?"Router Initializer":"");function AA(e,t,n,i,o,a,u){try{var m=e[a](u),y=m.value}catch(C){return void n(C)}m.done?t(y):Promise.resolve(y).then(i,o)}class rb{}class iE{}class ju{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(n=>{const i=n.indexOf(":");if(i>0){const o=n.slice(0,i),a=o.toLowerCase(),u=n.slice(i+1).trim();this.maybeSetNormalizedName(o,a),this.headers.has(a)?this.headers.get(a).push(u):this.headers.set(a,[u])}})}:()=>{this.headers=new Map,Object.entries(t).forEach(([n,i])=>{let o;if(o="string"==typeof i?[i]:"number"==typeof i?[i.toString()]:i.map(a=>a.toString()),o.length>0){const a=n.toLowerCase();this.headers.set(a,o),this.maybeSetNormalizedName(n,a)}})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof ju?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){const n=new ju;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof ju?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){const n=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,n);const o=("a"===t.op?this.headers.get(n):void 0)||[];o.push(...i),this.headers.set(n,o);break;case"d":const a=t.value;if(a){let u=this.headers.get(n);if(!u)return;u=u.filter(m=>-1===a.indexOf(m)),0===u.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,u)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}}class Fj{encodeKey(t){return PA(t)}encodeValue(t){return PA(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const Nj=/%(\d[a-f0-9])/gi,Bj={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function PA(e){return encodeURIComponent(e).replace(Nj,(t,n)=>Bj[n]??t)}function ob(e){return`${e}`}class Cd{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new Fj,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function zj(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(o=>{const a=o.indexOf("="),[u,m]=-1==a?[t.decodeKey(o),""]:[t.decodeKey(o.slice(0,a)),t.decodeValue(o.slice(a+1))],y=n.get(u)||[];y.push(m),n.set(u,y)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{const i=t.fromObject[n],o=Array.isArray(i)?i.map(ob):[ob(i)];this.map.set(n,o)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){const n=[];return Object.keys(t).forEach(i=>{const o=t[i];Array.isArray(o)?o.forEach(a=>{n.push({param:i,value:a,op:"a"})}):n.push({param:i,value:o,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const n=this.encoder.encodeKey(t);return this.map.get(t).map(i=>n+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const n=new Cd({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const n=("a"===t.op?this.map.get(t.param):void 0)||[];n.push(ob(t.value)),this.map.set(t.param,n);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const o=i.indexOf(ob(t.value));-1!==o&&i.splice(o,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class Vj{constructor(){this.map=new Map}set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function kA(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function RA(e){return typeof Blob<"u"&&e instanceof Blob}function OA(e){return typeof FormData<"u"&&e instanceof FormData}class yy{constructor(t,n,i,o){let a;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function jj(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==i?i:null,a=o):a=i,a&&(this.reportProgress=!!a.reportProgress,this.withCredentials=!!a.withCredentials,a.responseType&&(this.responseType=a.responseType),a.headers&&(this.headers=a.headers),a.context&&(this.context=a.context),a.params&&(this.params=a.params)),this.headers||(this.headers=new ju),this.context||(this.context=new Vj),this.params){const u=this.params.toString();if(0===u.length)this.urlWithParams=n;else{const m=n.indexOf("?");this.urlWithParams=n+(-1===m?"?":m<n.length-1?"&":"")+u}}else this.params=new Cd,this.urlWithParams=n}serializeBody(){return null===this.body?null:kA(this.body)||RA(this.body)||OA(this.body)||function Uj(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Cd?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||OA(this.body)?null:RA(this.body)?this.body.type||null:kA(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Cd?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const n=t.method||this.method,i=t.url||this.url,o=t.responseType||this.responseType,a=void 0!==t.body?t.body:this.body,u=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,m=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let y=t.headers||this.headers,C=t.params||this.params;const T=t.context??this.context;return void 0!==t.setHeaders&&(y=Object.keys(t.setHeaders).reduce((A,z)=>A.set(z,t.setHeaders[z]),y)),t.setParams&&(C=Object.keys(t.setParams).reduce((A,z)=>A.set(z,t.setParams[z]),C)),new yy(n,i,a,{params:C,headers:y,context:T,reportProgress:m,responseType:o,withCredentials:u})}}var Vr=(()=>((Vr=Vr||{})[Vr.Sent=0]="Sent",Vr[Vr.UploadProgress=1]="UploadProgress",Vr[Vr.ResponseHeader=2]="ResponseHeader",Vr[Vr.DownloadProgress=3]="DownloadProgress",Vr[Vr.Response=4]="Response",Vr[Vr.User=5]="User",Vr))();class rE{constructor(t,n=200,i="OK"){this.headers=t.headers||new ju,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class oE extends rE{constructor(t={}){super(t),this.type=Vr.ResponseHeader}clone(t={}){return new oE({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class sb extends rE{constructor(t={}){super(t),this.type=Vr.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new sb({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class LA extends rE{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function sE(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let FA=(()=>{class e{constructor(n){this.handler=n}request(n,i,o={}){let a;if(n instanceof yy)a=n;else{let y,C;y=o.headers instanceof ju?o.headers:new ju(o.headers),o.params&&(C=o.params instanceof Cd?o.params:new Cd({fromObject:o.params})),a=new yy(n,i,void 0!==o.body?o.body:null,{headers:y,context:o.context,params:C,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials})}const u=Ht(a).pipe(yd(y=>this.handler.handle(y)));if(n instanceof yy||"events"===o.observe)return u;const m=u.pipe(Bc(y=>y instanceof sb));switch(o.observe||"body"){case"body":switch(a.responseType){case"arraybuffer":return m.pipe(dt(y=>{if(null!==y.body&&!(y.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return y.body}));case"blob":return m.pipe(dt(y=>{if(null!==y.body&&!(y.body instanceof Blob))throw new Error("Response is not a Blob.");return y.body}));case"text":return m.pipe(dt(y=>{if(null!==y.body&&"string"!=typeof y.body)throw new Error("Response is not a string.");return y.body}));default:return m.pipe(dt(y=>y.body))}case"response":return m;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(n,i={}){return this.request("DELETE",n,i)}get(n,i={}){return this.request("GET",n,i)}head(n,i={}){return this.request("HEAD",n,i)}jsonp(n,i){return this.request("JSONP",n,{params:(new Cd).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,i={}){return this.request("OPTIONS",n,i)}patch(n,i,o={}){return this.request("PATCH",n,sE(o,i))}post(n,i,o={}){return this.request("POST",n,sE(o,i))}put(n,i,o={}){return this.request("PUT",n,sE(o,i))}}return e.\u0275fac=function(n){return new(n||e)(Dt(rb))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();function zA(e,t){return t(e)}function $j(e,t){return(n,i)=>t.intercept(n,{handle:o=>e(o,i)})}const Gj=new Mt("HTTP_INTERCEPTORS"),vy=new Mt("HTTP_INTERCEPTOR_FNS");function Wj(){let e=null;return(t,n)=>(null===e&&(e=(cn(Gj,{optional:!0})??[]).reduceRight($j,zA)),e(t,n))}let NA=(()=>{class e extends rb{constructor(n,i){super(),this.backend=n,this.injector=i,this.chain=null}handle(n){if(null===this.chain){const i=Array.from(new Set(this.injector.get(vy)));this.chain=i.reduceRight((o,a)=>function Hj(e,t,n){return(i,o)=>n.runInContext(()=>t(i,a=>e(a,o)))}(o,a,this.injector),zA)}return this.chain(n,i=>this.backend.handle(i))}}return e.\u0275fac=function(n){return new(n||e)(Dt(iE),Dt(js))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();const Yj=/^\)\]\}',?\n/;let VA=(()=>{class e{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new fn(i=>{const o=this.xhrFactory.build();if(o.open(n.method,n.urlWithParams),n.withCredentials&&(o.withCredentials=!0),n.headers.forEach((V,H)=>o.setRequestHeader(V,H.join(","))),n.headers.has("Accept")||o.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const V=n.detectContentTypeHeader();null!==V&&o.setRequestHeader("Content-Type",V)}if(n.responseType){const V=n.responseType.toLowerCase();o.responseType="json"!==V?V:"text"}const a=n.serializeBody();let u=null;const m=()=>{if(null!==u)return u;const V=o.statusText||"OK",H=new ju(o.getAllResponseHeaders()),X=function Kj(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(o)||n.url;return u=new oE({headers:H,status:o.status,statusText:V,url:X}),u},y=()=>{let{headers:V,status:H,statusText:X,url:oe}=m(),le=null;204!==H&&(le=typeof o.response>"u"?o.responseText:o.response),0===H&&(H=le?200:0);let we=H>=200&&H<300;if("json"===n.responseType&&"string"==typeof le){const ve=le;le=le.replace(Yj,"");try{le=""!==le?JSON.parse(le):null}catch(Re){le=ve,we&&(we=!1,le={error:Re,text:le})}}we?(i.next(new sb({body:le,headers:V,status:H,statusText:X,url:oe||void 0})),i.complete()):i.error(new LA({error:le,headers:V,status:H,statusText:X,url:oe||void 0}))},C=V=>{const{url:H}=m(),X=new LA({error:V,status:o.status||0,statusText:o.statusText||"Unknown Error",url:H||void 0});i.error(X)};let T=!1;const A=V=>{T||(i.next(m()),T=!0);let H={type:Vr.DownloadProgress,loaded:V.loaded};V.lengthComputable&&(H.total=V.total),"text"===n.responseType&&o.responseText&&(H.partialText=o.responseText),i.next(H)},z=V=>{let H={type:Vr.UploadProgress,loaded:V.loaded};V.lengthComputable&&(H.total=V.total),i.next(H)};return o.addEventListener("load",y),o.addEventListener("error",C),o.addEventListener("timeout",C),o.addEventListener("abort",C),n.reportProgress&&(o.addEventListener("progress",A),null!==a&&o.upload&&o.upload.addEventListener("progress",z)),o.send(a),i.next({type:Vr.Sent}),()=>{o.removeEventListener("error",C),o.removeEventListener("abort",C),o.removeEventListener("load",y),o.removeEventListener("timeout",C),n.reportProgress&&(o.removeEventListener("progress",A),null!==a&&o.upload&&o.upload.removeEventListener("progress",z)),o.readyState!==o.DONE&&o.abort()}})}}return e.\u0275fac=function(n){return new(n||e)(Dt(GM))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();const aE=new Mt("XSRF_ENABLED"),jA=new Mt("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),UA=new Mt("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class $A{}let e5=(()=>{class e{constructor(n,i,o){this.doc=n,this.platform=i,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=RM(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return e.\u0275fac=function(n){return new(n||e)(Dt(xs),Dt(Nw),Dt(jA))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();function t5(e,t){const n=e.url.toLowerCase();if(!cn(aE)||"GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t(e);const i=cn($A).getToken(),o=cn(UA);return null!=i&&!e.headers.has(o)&&(e=e.clone({headers:e.headers.set(o,i)})),t(e)}var Er=(()=>((Er=Er||{})[Er.Interceptors=0]="Interceptors",Er[Er.LegacyInterceptors=1]="LegacyInterceptors",Er[Er.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",Er[Er.NoXsrfProtection=3]="NoXsrfProtection",Er[Er.JsonpSupport=4]="JsonpSupport",Er[Er.RequestsMadeViaParent=5]="RequestsMadeViaParent",Er))();function Qm(e,t){return{\u0275kind:e,\u0275providers:t}}function n5(...e){const t=[FA,VA,NA,{provide:rb,useExisting:NA},{provide:iE,useExisting:VA},{provide:vy,useValue:t5,multi:!0},{provide:aE,useValue:!0},{provide:$A,useClass:e5}];for(const n of e)t.push(...n.\u0275providers);return function B1(e){return{\u0275providers:e}}(t)}const HA=new Mt("LEGACY_INTERCEPTOR_FN");let r5=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=lr({type:e}),e.\u0275inj=Ui({providers:[n5(Qm(Er.LegacyInterceptors,[{provide:HA,useFactory:Wj},{provide:vy,useExisting:HA,multi:!0}]))]}),e})(),eg=(()=>{class e{constructor(n){this.http=n,this.dataUrl="./assets/data/",this.cards=[]}getmenu(n){return this.http.get(this.dataUrl+n)}getsetting(n){return this.http.get(this.dataUrl+n)}getfooter(n){return this.http.get(this.dataUrl+n)}getist(n){return this.http.get(this.dataUrl+n)}getuser(n){return this.http.get(this.dataUrl+n)}getcard(n){return this.http.get(this.dataUrl+n)}getform(n){return this.http.get(this.dataUrl+n)}getpie(n){return this.http.get(this.dataUrl+n)}static#e=this.\u0275fac=function(i){return new(i||e)(Dt(FA))};static#t=this.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const o5=["addListener","removeListener"],s5=["addEventListener","removeEventListener"],a5=["on","off"];function lE(e,t,n,i){if(Rn(n)&&(i=n,n=void 0),i)return lE(e,t,n).pipe(DC(i));const[o,a]=function u5(e){return Rn(e.addEventListener)&&Rn(e.removeEventListener)}(e)?s5.map(u=>m=>e[u](t,m,n)):function l5(e){return Rn(e.addListener)&&Rn(e.removeListener)}(e)?o5.map(GA(e,t)):function c5(e){return Rn(e.on)&&Rn(e.off)}(e)?a5.map(GA(e,t)):[];if(!o&&_e(e))return Lt(u=>lE(u,t,n))(xn(e));if(!o)throw new TypeError("Invalid event target");return new fn(u=>{const m=(...y)=>u.next(1<y.length?y:y[0]);return o(m),()=>a(m)})}function GA(e,t){return n=>i=>e[n](t,i)}class d5 extends Ue{constructor(t,n){super()}schedule(t,n=0){return this}}const ab={setInterval(e,t,...n){const{delegate:i}=ab;return i?.setInterval?i.setInterval(e,t,...n):setInterval(e,t,...n)},clearInterval(e){const{delegate:t}=ab;return(t?.clearInterval||clearInterval)(e)},delegate:void 0},WA={now:()=>(WA.delegate||Date).now(),delegate:void 0};class xy{constructor(t,n=xy.now){this.schedulerActionCtor=t,this.now=n}schedule(t,n=0,i){return new this.schedulerActionCtor(this,t).schedule(i,n)}}xy.now=WA.now;const cE=new class p5 extends xy{constructor(t,n=xy.now){super(t,n),this.actions=[],this._active=!1}flush(t){const{actions:n}=this;if(this._active)return void n.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=n.shift());if(this._active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}}}(class f5 extends d5{constructor(t,n){super(t,n),this.scheduler=t,this.work=n,this.pending=!1}schedule(t,n=0){var i;if(this.closed)return this;this.state=t;const o=this.id,a=this.scheduler;return null!=o&&(this.id=this.recycleAsyncId(a,o,n)),this.pending=!0,this.delay=n,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(a,this.id,n),this}requestAsyncId(t,n,i=0){return ab.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,n,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return n;null!=n&&ab.clearInterval(n)}execute(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,n);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,n){let o,i=!1;try{this.work(t)}catch(a){i=!0,o=a||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){const{id:t,scheduler:n}=this,{actions:i}=n;this.work=this.state=this.scheduler=null,this.pending=!1,p(i,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,super.unsubscribe()}}}),m5=cE;function x5(e,t=cE){return function g5(e){return gi((t,n)=>{let i=!1,o=null;t.subscribe(Yn(n,a=>{i=!0,o=a})),xn(e).subscribe(Yn(n,()=>{if(i){i=!1;const a=o;o=null,n.next(a)}},ns))})}(function v5(e=0,t=cE){return e<0&&(e=0),function y5(e=0,t,n=m5){let i=-1;return null!=t&&(os(t)?n=t:i=t),new fn(o=>{let a=function _5(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;a<0&&(a=0);let u=0;return n.schedule(function(){o.closed||(o.next(u++),0<=i?this.schedule(void 0,i):o.complete())},a)})}(e,e,t)}(e,t))}function b5(e,t,n,i){const o=window&&!!window.document&&window.document.documentElement;let a=o&&t?window:n;if(e&&(a=e&&o&&"string"==typeof e?function w5(e,t,n){return(n?window.document:t).querySelector(e)}(e,n.nativeElement,i):e,!a))throw new Error("ngx-infinite-scroll {resolveContainerElement()}: selector for");return a}function uE(e){return e&&!e.firstChange}const E5={clientHeight:"clientHeight",offsetHeight:"offsetHeight",scrollHeight:"scrollHeight",pageYOffset:"pageYOffset",offsetTop:"offsetTop",scrollTop:"scrollTop",top:"top"},D5={clientHeight:"clientWidth",offsetHeight:"offsetWidth",scrollHeight:"scrollWidth",pageYOffset:"pageXOffset",offsetTop:"offsetLeft",scrollTop:"scrollLeft",top:"left"};class T5{constructor(t=!0){this.vertical=t,this.propsMap=t?E5:D5}clientHeightKey(){return this.propsMap.clientHeight}offsetHeightKey(){return this.propsMap.offsetHeight}scrollHeightKey(){return this.propsMap.scrollHeight}pageYOffsetKey(){return this.propsMap.pageYOffset}offsetTopKey(){return this.propsMap.offsetTop}scrollTopKey(){return this.propsMap.scrollTop}topKey(){return this.propsMap.top}}function A5(e){return["Window","global"].some(n=>Object.prototype.toString.call(e).includes(n))}function hE(e,t){return e?t.document.documentElement:null}function qA(e,t){const n=function R5({container:e,isWindow:t,axis:n}){const{offsetHeightKey:i,clientHeightKey:o}=ZA(n);return XA(e,t,i,o)}(t);return t.isWindow?function P5(e,t,n){const{axis:i,container:o,isWindow:a}=n,{offsetHeightKey:u,clientHeightKey:m}=ZA(i),y=e+YA(hE(a,o),i,a),C=XA(t.nativeElement,a,u,m),T=function O5(e,t,n){const i=t.topKey();if(e.getBoundingClientRect)return e.getBoundingClientRect()[i]+YA(e,t,n)}(t.nativeElement,i,a)+C;return{height:e,scrolled:y,totalToScroll:T}}(n,e,t):function k5(e,t,n){const{axis:i,container:o}=n;return{height:e,scrolled:o[i.scrollTopKey()],totalToScroll:o[i.scrollHeightKey()]}}(n,0,t)}function ZA(e){return{offsetHeightKey:e.offsetHeightKey(),clientHeightKey:e.clientHeightKey()}}function XA(e,t,n,i){if(isNaN(e[n])){const o=hE(t,e);return o?o[i]:0}return e[n]}function YA(e,t,n){const i=t.pageYOffsetKey(),o=t.scrollTopKey(),a=t.offsetTopKey();return isNaN(window[i])?hE(n,e)[o]:e.ownerDocument?e.ownerDocument.defaultView[i]:e[a]}function L5(e,t,n){let i,o;if(e.totalToScroll<=0)return!1;const a=e.height+e.scrolled;return n?(i=(e.totalToScroll-a)/e.totalToScroll,o=t.down/10):(i=e.scrolled/(e.scrolled+(e.totalToScroll-a)),o=t.up/10),i<=o}function $5(e){const{scrollContainer:t,scrollWindow:n,element:i,fromRoot:o}=e,a=function M5({windowElement:e,axis:t}){return function I5(e,t){return Object.assign({},e,{container:e.isWindow||t&&!t.nativeElement?t:t.nativeElement})}({axis:t,isWindow:A5(e)},e)}({axis:new T5(!e.horizontal),windowElement:b5(t,n,i,o)}),{totalToScroll:u}=qA(i,a),m={lastScrollPosition:0,lastTotalToScroll:0,totalToScroll:u,triggered:{down:0,up:0}},C={up:e.upDistance,down:e.downDistance};return function H5(e){let t=lE(e.container,"scroll");return e.throttle&&(t=t.pipe(x5(e.throttle))),t}({container:a.container,throttle:e.throttle}).pipe(dt(({target:T})=>({contentHeight:T.scrollHeight,scrolledFromTop:T.scrollTop,viewportHeight:T.clientHeight})),function h5(){return gi((e,t)=>{let n,i=!1;e.subscribe(Yn(t,o=>{const a=n;n=o,i&&t.next([a,o]),i=!0}))})}(),no(T=>console.log(T)),Lt(T=>Ht(qA(i,a))),dt(T=>function G5(e,t,n){const{scrollDown:i,fire:o}=function z5(e,t,n){const i=function F5(e,t){return e<t.scrolled}(e,t);return{fire:L5(t,n,i),scrollDown:i}}(e,t,n);return{scrollDown:i,fire:o,stats:t}}(m.lastScrollPosition,T,C)),no(({stats:T})=>function U5(e,t,n){(function N5(e,t){t.lastScrollPosition=e})(t,e),function B5(e,t){t.lastTotalToScroll!==e&&(t.lastTotalToScroll=t.totalToScroll,t.totalToScroll=e)}(n,e)}(m,T.scrolled,T.totalToScroll)),Bc(({fire:T,scrollDown:A,stats:{totalToScroll:z}})=>function S5(e,t,n){return(e||t)&&!n}(e.alwaysCallback,T,function j5(e,t,n){return n?t.triggered.down===e:t.triggered.up===e}(z,m,A))),no(({scrollDown:T,stats:{totalToScroll:A}})=>{!function V5(e,t,n,i){i?t.triggered.down=e:t.triggered.up=e}(A,m,0,T)}),dt(W5))}const lb={DOWN:"[NGX_ISE] DOWN",UP:"[NGX_ISE] UP"};function W5(e){const{scrollDown:t,stats:{scrolled:n}}=e;return{type:t?lb.DOWN:lb.UP,payload:{currentScrollPosition:n}}}let q5=(()=>{class e{constructor(n,i){this.element=n,this.zone=i,this.scrolled=new Mi,this.scrolledUp=new Mi,this.infiniteScrollDistance=2,this.infiniteScrollUpDistance=1.5,this.infiniteScrollThrottle=150,this.infiniteScrollDisabled=!1,this.infiniteScrollContainer=null,this.scrollWindow=!0,this.immediateCheck=!1,this.horizontal=!1,this.alwaysCallback=!1,this.fromRoot=!1}ngAfterViewInit(){this.infiniteScrollDisabled||this.setup()}ngOnChanges({infiniteScrollContainer:n,infiniteScrollDisabled:i,infiniteScrollDistance:o}){const a=uE(n),u=uE(i),m=uE(o),y=!u&&!this.infiniteScrollDisabled||u&&!i.currentValue||m;(a||u||m)&&(this.destroyScroller(),y&&this.setup())}setup(){(function C5(){return typeof window<"u"})()&&this.zone.runOutsideAngular(()=>{this.disposeScroller=$5({fromRoot:this.fromRoot,alwaysCallback:this.alwaysCallback,disable:this.infiniteScrollDisabled,downDistance:this.infiniteScrollDistance,element:this.element,horizontal:this.horizontal,scrollContainer:this.infiniteScrollContainer,scrollWindow:this.scrollWindow,throttle:this.infiniteScrollThrottle,upDistance:this.infiniteScrollUpDistance}).subscribe(n=>this.zone.run(()=>this.handleOnScroll(n)))})}handleOnScroll({type:n,payload:i}){switch(n){case lb.DOWN:return this.scrolled.emit(i);case lb.UP:return this.scrolledUp.emit(i);default:return}}ngOnDestroy(){this.destroyScroller()}destroyScroller(){this.disposeScroller&&this.disposeScroller.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)(Qe(Po),Qe(rr))},e.\u0275dir=Ft({type:e,selectors:[["","infiniteScroll",""],["","infinite-scroll",""],["","data-infinite-scroll",""]],inputs:{infiniteScrollDistance:"infiniteScrollDistance",infiniteScrollUpDistance:"infiniteScrollUpDistance",infiniteScrollThrottle:"infiniteScrollThrottle",infiniteScrollDisabled:"infiniteScrollDisabled",infiniteScrollContainer:"infiniteScrollContainer",scrollWindow:"scrollWindow",immediateCheck:"immediateCheck",horizontal:"horizontal",alwaysCallback:"alwaysCallback",fromRoot:"fromRoot"},outputs:{scrolled:"scrolled",scrolledUp:"scrolledUp"},features:[qr]}),e})(),Z5=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=lr({type:e}),e.\u0275inj=Ui({}),e})();const X5=function(e){return{id:e}};function Y5(e,t){if(1&e&&(ht(0,"div",6),Zt(1,"img",7),ht(2,"div",8)(3,"span"),si(4,"Vote: 32131"),gt()(),ht(5,"div",9)(6,"div",10)(7,"div",11),si(8),gt(),ht(9,"div",12),si(10),gt()(),ht(11,"div",13),Zt(12,"i",14)(13,"i",15)(14,"i",16),gt()()()),2&e){const n=t.$implicit;xt("routerLink","/detail")("queryParams",function lS(e,t,n,i){return cS(Ze(),yr(),e,t,n,i)}(5,X5,n.id)),kt(1),xt("src",n.img,Zh),kt(7),_o(n.title),kt(2),zc("",null==n||null==n.subtitle?null:n.subtitle.substring(0,30),"...")}}let K5=(()=>{class e{constructor(n){this.data=n,this.cards=[],this.page=1,this.pagesize=24}ngOnInit(){this.getSettings()}getSettings(){var n=this;return function Lj(e){return function(){var t=this,n=arguments;return new Promise(function(i,o){var a=e.apply(t,n);function u(y){AA(a,i,o,u,m,"next",y)}function m(y){AA(a,i,o,u,m,"throw",y)}u(void 0)})}}(function*(){n.data.getcard("1-main-page/card_json.json").subscribe(i=>{n.cards=n.data.cards.concat(i),n.tempCard=n.cards.slice(n.page-1,n.pagesize)})})()}onScroll(){this.cards.length/24<=this.page||(this.page++,this.cards.length-this.tempCard.length>=24?this.tempCard=this.tempCard.concat(this.cards.slice((this.page-1)*this.pagesize,this.page*this.pagesize)):(this.tempCard=this.tempCard.concat(this.cards.slice((this.page-1)*this.pagesize,this.cards.length)),this.page++))}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(eg))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-home"]],decls:6,vars:4,consts:[["infiniteScroll","",1,"home",3,"infiniteScrollDistance","scrollWindow","scrolled"],[1,"cards"],[1,"card",3,"routerLink"],["src","./assets/plus.png","alt","",1,"card-img"],["class","card",3,"routerLink","queryParams",4,"ngFor","ngForOf"],[1,"pagination"],[1,"card",3,"routerLink","queryParams"],["alt","",1,"card-img",3,"src"],[1,"card-top"],[1,"card-desc"],[1,"leftside"],[2,"font-size","10px","font-weight","700"],[2,"font-size","9px","margin-top","4px"],[1,"rightside"],[1,"fa","fa-bell","icon",2,"color","red"],[1,"fa","fa-bell","icon"],[1,"fa","fa-bell","icon",2,"color","rgb(0, 162, 255)"]],template:function(i,o){1&i&&(ht(0,"div",0),Mn("scrolled",function(){return o.onScroll()}),ht(1,"div",1)(2,"div",2),Zt(3,"img",3),gt(),qt(4,Y5,15,7,"div",4),gt()(),Zt(5,"div",5)),2&i&&(xt("infiniteScrollDistance",1)("scrollWindow",!1),kt(2),xt("routerLink","/new"),kt(2),xt("ngForOf",o.tempCard))},dependencies:[Vm,Km,q5],styles:[".home[_ngcontent-%COMP%]{padding:0 40px;position:relative;height:100%;overflow-y:scroll}.cards[_ngcontent-%COMP%]{display:flex;justify-content:space-around;height:100%;padding-top:30px;flex-wrap:wrap;margin-bottom:50px}.card[_ngcontent-%COMP%]{width:230px;height:135px;margin:19px;position:relative;border-radius:8px;border:1px solid rgb(31,151,255)}.card[_ngcontent-%COMP%]:hover{cursor:pointer}.card-img[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;border-radius:8px}.card-desc[_ngcontent-%COMP%]{position:absolute;width:100%;height:30%;background-color:#0009;bottom:0;border-radius:8px;display:flex;justify-content:space-between}.leftside[_ngcontent-%COMP%]{width:60%;flex-direction:column;justify-content:center;color:#b3b3b3;padding-left:3px}.rightside[_ngcontent-%COMP%]{width:40%;display:flex;align-items:end;justify-content:end}.icon[_ngcontent-%COMP%]{font-size:11px;padding:4px;margin:4px;background-color:#848484;color:#1fff1f;border-radius:5px;width:11px}.card-top[_ngcontent-%COMP%]{position:absolute;width:30%;height:11%;background-color:#0009;top:1px;right:1px;border-radius:3px;display:flex;justify-content:center;align-items:center}.card-top[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:8px;color:#b3b3b3}.pagination[_ngcontent-%COMP%]{width:100%;height:55px;position:absolute;bottom:50px}.home[_ngcontent-%COMP%]::-webkit-scrollbar{width:10px}.home[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#101213}.home[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#3f3e3e}.home[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}"]})}return e})();const KA=typeof window>"u"?function(e){return e()}:window.requestAnimationFrame;function JA(e,t,n){const i=n||(u=>Array.prototype.slice.call(u));let o=!1,a=[];return function(...u){a=i(u),o||(o=!0,KA.call(window,()=>{o=!1,e.apply(t,a)}))}}const dE=e=>"start"===e?"left":"end"===e?"right":"center",Jo=(e,t,n)=>"start"===e?t:"end"===e?n:(t+n)/2;function Uu(){}const eU=function(){let e=0;return function(){return e++}}();function oi(e){return null===e||typeof e>"u"}function Ai(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return"[object"===t.slice(0,7)&&"Array]"===t.slice(-6)}function $n(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}const Dr=e=>("number"==typeof e||e instanceof Number)&&isFinite(+e);function il(e,t){return Dr(e)?e:t}function Dn(e,t){return typeof e>"u"?t:e}const QA=(e,t)=>"string"==typeof e&&e.endsWith("%")?parseFloat(e)/100*t:+e;function Pi(e,t,n){if(e&&"function"==typeof e.call)return e.apply(n,t)}function pi(e,t,n,i){let o,a,u;if(Ai(e))if(a=e.length,i)for(o=a-1;o>=0;o--)t.call(n,e[o],o);else for(o=0;o<a;o++)t.call(n,e[o],o);else if($n(e))for(u=Object.keys(e),a=u.length,o=0;o<a;o++)t.call(n,e[u[o]],u[o])}function cb(e,t){let n,i,o,a;if(!e||!t||e.length!==t.length)return!1;for(n=0,i=e.length;n<i;++n)if(o=e[n],a=t[n],o.datasetIndex!==a.datasetIndex||o.index!==a.index)return!1;return!0}function ub(e){if(Ai(e))return e.map(ub);if($n(e)){const t=Object.create(null),n=Object.keys(e),i=n.length;let o=0;for(;o<i;++o)t[n[o]]=ub(e[n[o]]);return t}return e}function e2(e){return-1===["__proto__","prototype","constructor"].indexOf(e)}function nU(e,t,n,i){if(!e2(e))return;const o=t[e],a=n[e];$n(o)&&$n(a)?by(o,a,i):t[e]=ub(a)}function by(e,t,n){const i=Ai(t)?t:[t],o=i.length;if(!$n(e))return e;const a=(n=n||{}).merger||nU;for(let u=0;u<o;++u){if(!$n(t=i[u]))continue;const m=Object.keys(t);for(let y=0,C=m.length;y<C;++y)a(m[y],e,t,n)}return e}function wy(e,t){return by(e,t,{merger:iU})}function iU(e,t,n){if(!e2(e))return;const i=t[e],o=n[e];$n(i)&&$n(o)?wy(i,o):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=ub(o))}const rU="",oU=".";function t2(e,t){const n=e.indexOf(oU,t);return-1===n?e.length:n}function Ed(e,t){if(t===rU)return e;let n=0,i=t2(t,n);for(;e&&i>n;)e=e[t.slice(n,i)],n=i+1,i=t2(t,n);return e}function fE(e){return e.charAt(0).toUpperCase()+e.slice(1)}const rl=e=>typeof e<"u",Dd=e=>"function"==typeof e,n2=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0},qi=Math.PI,Ei=2*qi,aU=Ei+qi,hb=Number.POSITIVE_INFINITY,lU=qi/180,pr=qi/2,Cy=qi/4,i2=2*qi/3,ol=Math.log10,Uc=Math.sign;function r2(e){const t=Math.round(e);e=Dy(e,t,e/1e3)?t:e;const n=Math.pow(10,Math.floor(ol(e))),i=e/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function Ey(e){return!isNaN(parseFloat(e))&&isFinite(e)}function Dy(e,t,n){return Math.abs(e-t)<n}function o2(e,t,n){let i,o,a;for(i=0,o=e.length;i<o;i++)a=e[i][n],isNaN(a)||(t.min=Math.min(t.min,a),t.max=Math.max(t.max,a))}function Yl(e){return e*(qi/180)}function pE(e){return e*(180/qi)}function s2(e){if(!Dr(e))return;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n}function a2(e,t){const n=t.x-e.x,i=t.y-e.y,o=Math.sqrt(n*n+i*i);let a=Math.atan2(i,n);return a<-.5*qi&&(a+=Ei),{angle:a,distance:o}}function mE(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function hU(e,t){return(e-t+aU)%Ei-qi}function wa(e){return(e%Ei+Ei)%Ei}function Ty(e,t,n,i){const o=wa(e),a=wa(t),u=wa(n),m=wa(a-o),y=wa(u-o),C=wa(o-a),T=wa(o-u);return o===a||o===u||i&&a===u||m>y&&C<T}function yo(e,t,n){return Math.max(t,Math.min(n,e))}function $u(e,t,n,i=1e-6){return e>=Math.min(t,n)-i&&e<=Math.max(t,n)+i}const db=e=>0===e||1===e,l2=(e,t,n)=>-Math.pow(2,10*(e-=1))*Math.sin((e-t)*Ei/n),c2=(e,t,n)=>Math.pow(2,-10*e)*Math.sin((e-t)*Ei/n)+1,Sy={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>1-Math.cos(e*pr),easeOutSine:e=>Math.sin(e*pr),easeInOutSine:e=>-.5*(Math.cos(qi*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>db(e)?e:e<.5?.5*Math.pow(2,10*(2*e-1)):.5*(2-Math.pow(2,-10*(2*e-1))),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>db(e)?e:l2(e,.075,.3),easeOutElastic:e=>db(e)?e:c2(e,.075,.3),easeInOutElastic:e=>db(e)?e:e<.5?.5*l2(2*e,.1125,.45):.5+.5*c2(2*e-1,.1125,.45),easeInBack:e=>e*e*(2.70158*e-1.70158),easeOutBack:e=>(e-=1)*e*(2.70158*e+1.70158)+1,easeInOutBack(e){let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},easeInBounce:e=>1-Sy.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?.5*Sy.easeInBounce(2*e):.5*Sy.easeOutBounce(2*e-1)+.5};function My(e){return e+.5|0}const Td=(e,t,n)=>Math.max(Math.min(e,n),t);function Iy(e){return Td(My(2.55*e),0,255)}function Sd(e){return Td(My(255*e),0,255)}function Hu(e){return Td(My(e/2.55)/100,0,1)}function u2(e){return Td(My(100*e),0,100)}const sl={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},gE=[..."0123456789ABCDEF"],fU=e=>gE[15&e],pU=e=>gE[(240&e)>>4]+gE[15&e],fb=e=>(240&e)>>4==(15&e),vU=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function h2(e,t,n){const i=t*Math.min(n,1-n),o=(a,u=(a+e/30)%12)=>n-i*Math.max(Math.min(u-3,9-u,1),-1);return[o(0),o(8),o(4)]}function xU(e,t,n){const i=(o,a=(o+e/60)%6)=>n-n*t*Math.max(Math.min(a,4-a,1),0);return[i(5),i(3),i(1)]}function bU(e,t,n){const i=h2(e,1,.5);let o;for(t+n>1&&(o=1/(t+n),t*=o,n*=o),o=0;o<3;o++)i[o]*=1-t-n,i[o]+=t;return i}function _E(e){const n=e.r/255,i=e.g/255,o=e.b/255,a=Math.max(n,i,o),u=Math.min(n,i,o),m=(a+u)/2;let y,C,T;return a!==u&&(T=a-u,C=m>.5?T/(2-a-u):T/(a+u),y=function wU(e,t,n,i,o){return e===o?(t-n)/i+(t<n?6:0):t===o?(n-e)/i+2:(e-t)/i+4}(n,i,o,T,a),y=60*y+.5),[0|y,C||0,m]}function yE(e,t,n,i){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,n,i)).map(Sd)}function vE(e,t,n){return yE(h2,e,t,n)}function d2(e){return(e%360+360)%360}const f2={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},p2={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let pb;const AU=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,xE=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,tg=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function mb(e,t,n){if(e){let i=_E(e);i[t]=Math.max(0,Math.min(i[t]+i[t]*n,0===t?360:1)),i=vE(i),e.r=i[0],e.g=i[1],e.b=i[2]}}function m2(e,t){return e&&Object.assign(t||{},e)}function g2(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=Sd(e[3]))):(t=m2(e,{r:0,g:0,b:0,a:1})).a=Sd(t.a),t}function OU(e){return"r"===e.charAt(0)?function PU(e){const t=AU.exec(e);let i,o,a,n=255;if(t){if(t[7]!==i){const u=+t[7];n=t[8]?Iy(u):Td(255*u,0,255)}return i=+t[1],o=+t[3],a=+t[5],i=255&(t[2]?Iy(i):Td(i,0,255)),o=255&(t[4]?Iy(o):Td(o,0,255)),a=255&(t[6]?Iy(a):Td(a,0,255)),{r:i,g:o,b:a,a:n}}}(e):function DU(e){const t=vU.exec(e);let i,n=255;if(!t)return;t[5]!==i&&(n=t[6]?Iy(+t[5]):Sd(+t[5]));const o=d2(+t[2]),a=+t[3]/100,u=+t[4]/100;return i="hwb"===t[1]?function CU(e,t,n){return yE(bU,e,t,n)}(o,a,u):"hsv"===t[1]?function EU(e,t,n){return yE(xU,e,t,n)}(o,a,u):vE(o,a,u),{r:i[0],g:i[1],b:i[2],a:n}}(e)}class gb{constructor(t){if(t instanceof gb)return t;const n=typeof t;let i;"object"===n?i=g2(t):"string"===n&&(i=function gU(e){var n,t=e.length;return"#"===e[0]&&(4===t||5===t?n={r:255&17*sl[e[1]],g:255&17*sl[e[2]],b:255&17*sl[e[3]],a:5===t?17*sl[e[4]]:255}:(7===t||9===t)&&(n={r:sl[e[1]]<<4|sl[e[2]],g:sl[e[3]]<<4|sl[e[4]],b:sl[e[5]]<<4|sl[e[6]],a:9===t?sl[e[7]]<<4|sl[e[8]]:255})),n}(t)||function IU(e){pb||(pb=function MU(){const e={},t=Object.keys(p2),n=Object.keys(f2);let i,o,a,u,m;for(i=0;i<t.length;i++){for(u=m=t[i],o=0;o<n.length;o++)a=n[o],m=m.replace(a,f2[a]);a=parseInt(p2[u],16),e[m]=[a>>16&255,a>>8&255,255&a]}return e}(),pb.transparent=[0,0,0,0]);const t=pb[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:4===t.length?t[3]:255}}(t)||OU(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=m2(this._rgb);return t&&(t.a=Hu(t.a)),t}set rgb(t){this._rgb=g2(t)}rgbString(){return this._valid?function kU(e){return e&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${Hu(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`)}(this._rgb):void 0}hexString(){return this._valid?function yU(e){var t=(e=>fb(e.r)&&fb(e.g)&&fb(e.b)&&fb(e.a))(e)?fU:pU;return e?"#"+t(e.r)+t(e.g)+t(e.b)+((e,t)=>e<255?t(e):"")(e.a,t):void 0}(this._rgb):void 0}hslString(){return this._valid?function SU(e){if(!e)return;const t=_E(e),n=t[0],i=u2(t[1]),o=u2(t[2]);return e.a<255?`hsla(${n}, ${i}%, ${o}%, ${Hu(e.a)})`:`hsl(${n}, ${i}%, ${o}%)`}(this._rgb):void 0}mix(t,n){if(t){const i=this.rgb,o=t.rgb;let a;const u=n===a?.5:n,m=2*u-1,y=i.a-o.a,C=((m*y==-1?m:(m+y)/(1+m*y))+1)/2;a=1-C,i.r=255&C*i.r+a*o.r+.5,i.g=255&C*i.g+a*o.g+.5,i.b=255&C*i.b+a*o.b+.5,i.a=u*i.a+(1-u)*o.a,this.rgb=i}return this}interpolate(t,n){return t&&(this._rgb=function RU(e,t,n){const i=tg(Hu(e.r)),o=tg(Hu(e.g)),a=tg(Hu(e.b));return{r:Sd(xE(i+n*(tg(Hu(t.r))-i))),g:Sd(xE(o+n*(tg(Hu(t.g))-o))),b:Sd(xE(a+n*(tg(Hu(t.b))-a))),a:e.a+n*(t.a-e.a)}}(this._rgb,t._rgb,n)),this}clone(){return new gb(this.rgb)}alpha(t){return this._rgb.a=Sd(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,n=My(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=n,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return mb(this._rgb,2,t),this}darken(t){return mb(this._rgb,2,-t),this}saturate(t){return mb(this._rgb,1,t),this}desaturate(t){return mb(this._rgb,1,-t),this}rotate(t){return function TU(e,t){var n=_E(e);n[0]=d2(n[0]+t),n=vE(n),e.r=n[0],e.g=n[1],e.b=n[2]}(this._rgb,t),this}}function _2(e){return new gb(e)}function y2(e){if(e&&"object"==typeof e){const t=e.toString();return"[object CanvasPattern]"===t||"[object CanvasGradient]"===t}return!1}function v2(e){return y2(e)?e:_2(e)}function bE(e){return y2(e)?e:_2(e).saturate(.5).darken(.1).hexString()}const lp=Object.create(null),wE=Object.create(null);function Ay(e,t){if(!t)return e;const n=t.split(".");for(let i=0,o=n.length;i<o;++i){const a=n[i];e=e[a]||(e[a]=Object.create(null))}return e}function CE(e,t,n){return"string"==typeof t?by(Ay(e,t),n):by(Ay(e,""),t)}var Nn=new class LU{constructor(t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,i)=>bE(i.backgroundColor),this.hoverBorderColor=(n,i)=>bE(i.borderColor),this.hoverColor=(n,i)=>bE(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t)}set(t,n){return CE(this,t,n)}get(t){return Ay(this,t)}describe(t,n){return CE(wE,t,n)}override(t,n){return CE(lp,t,n)}route(t,n,i,o){const a=Ay(this,t),u=Ay(this,i),m="_"+n;Object.defineProperties(a,{[m]:{value:a[n],writable:!0},[n]:{enumerable:!0,get(){const y=this[m],C=u[o];return $n(y)?Object.assign({},C,y):Dn(y,C)},set(y){this[m]=y}}})}}({_scriptable:e=>!e.startsWith("on"),_indexable:e=>"events"!==e,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function _b(e,t,n,i,o){let a=t[o];return a||(a=t[o]=e.measureText(o).width,n.push(o)),a>i&&(i=a),i}function zU(e,t,n,i){let o=(i=i||{}).data=i.data||{},a=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(o=i.data={},a=i.garbageCollect=[],i.font=t),e.save(),e.font=t;let u=0;const m=n.length;let y,C,T,A,z;for(y=0;y<m;y++)if(A=n[y],null!=A&&!0!==Ai(A))u=_b(e,o,a,u,A);else if(Ai(A))for(C=0,T=A.length;C<T;C++)z=A[C],null!=z&&!Ai(z)&&(u=_b(e,o,a,u,z));e.restore();const V=a.length/2;if(V>n.length){for(y=0;y<V;y++)delete o[a[y]];a.splice(0,V)}return u}function cp(e,t,n){const i=e.currentDevicePixelRatio,o=0!==n?Math.max(n/2,.5):0;return Math.round((t-o)*i)/i+o}function x2(e,t){(t=t||e.getContext("2d")).save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore()}function yb(e,t,n,i){let o,a,u,m,y;const C=t.pointStyle,T=t.rotation,A=t.radius;let z=(T||0)*lU;if(C&&"object"==typeof C&&(o=C.toString(),"[object HTMLImageElement]"===o||"[object HTMLCanvasElement]"===o))return e.save(),e.translate(n,i),e.rotate(z),e.drawImage(C,-C.width/2,-C.height/2,C.width,C.height),void e.restore();if(!(isNaN(A)||A<=0)){switch(e.beginPath(),C){default:e.arc(n,i,A,0,Ei),e.closePath();break;case"triangle":e.moveTo(n+Math.sin(z)*A,i-Math.cos(z)*A),z+=i2,e.lineTo(n+Math.sin(z)*A,i-Math.cos(z)*A),z+=i2,e.lineTo(n+Math.sin(z)*A,i-Math.cos(z)*A),e.closePath();break;case"rectRounded":y=.516*A,m=A-y,a=Math.cos(z+Cy)*m,u=Math.sin(z+Cy)*m,e.arc(n-a,i-u,y,z-qi,z-pr),e.arc(n+u,i-a,y,z-pr,z),e.arc(n+a,i+u,y,z,z+pr),e.arc(n-u,i+a,y,z+pr,z+qi),e.closePath();break;case"rect":if(!T){m=Math.SQRT1_2*A,e.rect(n-m,i-m,2*m,2*m);break}z+=Cy;case"rectRot":a=Math.cos(z)*A,u=Math.sin(z)*A,e.moveTo(n-a,i-u),e.lineTo(n+u,i-a),e.lineTo(n+a,i+u),e.lineTo(n-u,i+a),e.closePath();break;case"crossRot":z+=Cy;case"cross":a=Math.cos(z)*A,u=Math.sin(z)*A,e.moveTo(n-a,i-u),e.lineTo(n+a,i+u),e.moveTo(n+u,i-a),e.lineTo(n-u,i+a);break;case"star":a=Math.cos(z)*A,u=Math.sin(z)*A,e.moveTo(n-a,i-u),e.lineTo(n+a,i+u),e.moveTo(n+u,i-a),e.lineTo(n-u,i+a),z+=Cy,a=Math.cos(z)*A,u=Math.sin(z)*A,e.moveTo(n-a,i-u),e.lineTo(n+a,i+u),e.moveTo(n+u,i-a),e.lineTo(n-u,i+a);break;case"line":a=Math.cos(z)*A,u=Math.sin(z)*A,e.moveTo(n-a,i-u),e.lineTo(n+a,i+u);break;case"dash":e.moveTo(n,i),e.lineTo(n+Math.cos(z)*A,i+Math.sin(z)*A)}e.fill(),t.borderWidth>0&&e.stroke()}}function Py(e,t,n){return n=n||.5,!t||e&&e.x>t.left-n&&e.x<t.right+n&&e.y>t.top-n&&e.y<t.bottom+n}function vb(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function xb(e){e.restore()}function NU(e,t,n,i,o){if(!t)return e.lineTo(n.x,n.y);if("middle"===o){const a=(t.x+n.x)/2;e.lineTo(a,t.y),e.lineTo(a,n.y)}else"after"===o!=!!i?e.lineTo(t.x,n.y):e.lineTo(n.x,t.y);e.lineTo(n.x,n.y)}function BU(e,t,n,i){if(!t)return e.lineTo(n.x,n.y);e.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function up(e,t,n,i,o,a={}){const u=Ai(t)?t:[t],m=a.strokeWidth>0&&""!==a.strokeColor;let y,C;for(e.save(),e.font=o.string,function VU(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),oi(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}(e,a),y=0;y<u.length;++y)C=u[y],m&&(a.strokeColor&&(e.strokeStyle=a.strokeColor),oi(a.strokeWidth)||(e.lineWidth=a.strokeWidth),e.strokeText(C,n,i,a.maxWidth)),e.fillText(C,n,i,a.maxWidth),jU(e,n,i,C,a),i+=o.lineHeight;e.restore()}function jU(e,t,n,i,o){if(o.strikethrough||o.underline){const a=e.measureText(i),u=t-a.actualBoundingBoxLeft,m=t+a.actualBoundingBoxRight,C=n+a.actualBoundingBoxDescent,T=o.strikethrough?(n-a.actualBoundingBoxAscent+C)/2:C;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=o.decorationWidth||2,e.moveTo(u,T),e.lineTo(m,T),e.stroke()}}function ky(e,t){const{x:n,y:i,w:o,h:a,radius:u}=t;e.arc(n+u.topLeft,i+u.topLeft,u.topLeft,-pr,qi,!0),e.lineTo(n,i+a-u.bottomLeft),e.arc(n+u.bottomLeft,i+a-u.bottomLeft,u.bottomLeft,qi,pr,!0),e.lineTo(n+o-u.bottomRight,i+a),e.arc(n+o-u.bottomRight,i+a-u.bottomRight,u.bottomRight,pr,0,!0),e.lineTo(n+o,i+u.topRight),e.arc(n+o-u.topRight,i+u.topRight,u.topRight,0,-pr,!0),e.lineTo(n+u.topLeft,i)}const UU=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),$U=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function HU(e,t){const n=(""+e).match(UU);if(!n||"normal"===n[1])return 1.2*t;switch(e=+n[2],n[3]){case"px":return e;case"%":e/=100}return t*e}const GU=e=>+e||0;function EE(e,t){const n={},i=$n(t),o=i?Object.keys(t):t,a=$n(e)?i?u=>Dn(e[u],e[t[u]]):u=>e[u]:()=>e;for(const u of o)n[u]=GU(a(u));return n}function b2(e){return EE(e,{top:"y",right:"x",bottom:"y",left:"x"})}function hp(e){return EE(e,["topLeft","topRight","bottomLeft","bottomRight"])}function Qo(e){const t=b2(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function io(e,t){let n=Dn((e=e||{}).size,(t=t||Nn.font).size);"string"==typeof n&&(n=parseInt(n,10));let i=Dn(e.style,t.style);i&&!(""+i).match($U)&&(console.warn('Invalid font style specified: "'+i+'"'),i="");const o={family:Dn(e.family,t.family),lineHeight:HU(Dn(e.lineHeight,t.lineHeight),n),size:n,style:i,weight:Dn(e.weight,t.weight),string:""};return o.string=function FU(e){return!e||oi(e.size)||oi(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}(o),o}function Ry(e,t,n,i){let a,u,m,o=!0;for(a=0,u=e.length;a<u;++a)if(m=e[a],void 0!==m&&(void 0!==t&&"function"==typeof m&&(m=m(t),o=!1),void 0!==n&&Ai(m)&&(m=m[n%m.length],o=!1),void 0!==m))return i&&!o&&(i.cacheable=!1),m}function Md(e,t){return Object.assign(Object.create(e),t)}function DE(e,t,n){n=n||(u=>e[u]<t);let a,i=e.length-1,o=0;for(;i-o>1;)a=o+i>>1,n(a)?o=a:i=a;return{lo:o,hi:i}}const Gu=(e,t,n)=>DE(e,n,i=>e[i][t]<n),qU=(e,t,n)=>DE(e,n,i=>e[i][t]>=n),w2=["push","pop","shift","splice","unshift"];function C2(e,t){const n=e._chartjs;if(!n)return;const i=n.listeners,o=i.indexOf(t);-1!==o&&i.splice(o,1),!(i.length>0)&&(w2.forEach(a=>{delete e[a]}),delete e._chartjs)}function E2(e){const t=new Set;let n,i;for(n=0,i=e.length;n<i;++n)t.add(e[n]);return t.size===i?e:Array.from(t)}function TE(e,t=[""],n=e,i,o=(()=>e[0])){rl(i)||(i=I2("_fallback",e));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:n,_fallback:i,_getTarget:o,override:u=>TE([u,...e],t,n,i)};return new Proxy(a,{deleteProperty:(u,m)=>(delete u[m],delete u._keys,delete e[0][m],!0),get:(u,m)=>T2(u,m,()=>function i4(e,t,n,i){let o;for(const a of t)if(o=I2(YU(a,e),n),rl(o))return SE(e,o)?ME(n,i,e,o):o}(m,t,e,u)),getOwnPropertyDescriptor:(u,m)=>Reflect.getOwnPropertyDescriptor(u._scopes[0],m),getPrototypeOf:()=>Reflect.getPrototypeOf(e[0]),has:(u,m)=>A2(u).includes(m),ownKeys:u=>A2(u),set(u,m,y){const C=u._storage||(u._storage=o());return u[m]=C[m]=y,delete u._keys,!0}})}function ng(e,t,n,i){const o={_cacheable:!1,_proxy:e,_context:t,_subProxy:n,_stack:new Set,_descriptors:D2(e,i),setContext:a=>ng(e,a,n,i),override:a=>ng(e.override(a),t,n,i)};return new Proxy(o,{deleteProperty:(a,u)=>(delete a[u],delete e[u],!0),get:(a,u,m)=>T2(a,u,()=>function KU(e,t,n){const{_proxy:i,_context:o,_subProxy:a,_descriptors:u}=e;let m=i[t];return Dd(m)&&u.isScriptable(t)&&(m=function JU(e,t,n,i){const{_proxy:o,_context:a,_subProxy:u,_stack:m}=n;if(m.has(e))throw new Error("Recursion detected: "+Array.from(m).join("->")+"->"+e);return m.add(e),t=t(a,u||i),m.delete(e),SE(e,t)&&(t=ME(o._scopes,o,e,t)),t}(t,m,e,n)),Ai(m)&&m.length&&(m=function QU(e,t,n,i){const{_proxy:o,_context:a,_subProxy:u,_descriptors:m}=n;if(rl(a.index)&&i(e))t=t[a.index%t.length];else if($n(t[0])){const y=t,C=o._scopes.filter(T=>T!==y);t=[];for(const T of y){const A=ME(C,o,e,T);t.push(ng(A,a,u&&u[e],m))}}return t}(t,m,e,u.isIndexable)),SE(t,m)&&(m=ng(m,o,a&&a[t],u)),m}(a,u,m)),getOwnPropertyDescriptor:(a,u)=>a._descriptors.allKeys?Reflect.has(e,u)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,u),getPrototypeOf:()=>Reflect.getPrototypeOf(e),has:(a,u)=>Reflect.has(e,u),ownKeys:()=>Reflect.ownKeys(e),set:(a,u,m)=>(e[u]=m,delete a[u],!0)})}function D2(e,t={scriptable:!0,indexable:!0}){const{_scriptable:n=t.scriptable,_indexable:i=t.indexable,_allKeys:o=t.allKeys}=e;return{allKeys:o,scriptable:n,indexable:i,isScriptable:Dd(n)?n:()=>n,isIndexable:Dd(i)?i:()=>i}}const YU=(e,t)=>e?e+fE(t):t,SE=(e,t)=>$n(t)&&"adapters"!==e&&(null===Object.getPrototypeOf(t)||t.constructor===Object);function T2(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t))return e[t];const i=n();return e[t]=i,i}function S2(e,t,n){return Dd(e)?e(t,n):e}const e4=(e,t)=>!0===e?t:"string"==typeof e?Ed(t,e):void 0;function t4(e,t,n,i,o){for(const a of t){const u=e4(n,a);if(u){e.add(u);const m=S2(u._fallback,n,o);if(rl(m)&&m!==n&&m!==i)return m}else if(!1===u&&rl(i)&&n!==i)return null}return!1}function ME(e,t,n,i){const o=t._rootScopes,a=S2(t._fallback,n,i),u=[...e,...o],m=new Set;m.add(i);let y=M2(m,u,n,a||n,i);return!(null===y||rl(a)&&a!==n&&(y=M2(m,u,a,y,i),null===y))&&TE(Array.from(m),[""],o,a,()=>function n4(e,t,n){const i=e._getTarget();t in i||(i[t]={});const o=i[t];return Ai(o)&&$n(n)?n:o}(t,n,i))}function M2(e,t,n,i,o){for(;n;)n=t4(e,t,n,i,o);return n}function I2(e,t){for(const n of t){if(!n)continue;const i=n[e];if(rl(i))return i}}function A2(e){let t=e._keys;return t||(t=e._keys=function r4(e){const t=new Set;for(const n of e)for(const i of Object.keys(n).filter(o=>!o.startsWith("_")))t.add(i);return Array.from(t)}(e._scopes)),t}function P2(e,t,n,i){const{iScale:o}=e,{key:a="r"}=this._parsing,u=new Array(i);let m,y,C,T;for(m=0,y=i;m<y;++m)C=m+n,T=t[C],u[m]={r:o.parse(Ed(T,a),C)};return u}const o4=Number.EPSILON||1e-14,ig=(e,t)=>t<e.length&&!e[t].skip&&e[t],k2=e=>"x"===e?"y":"x";function s4(e,t,n,i){const o=e.skip?t:e,a=t,u=n.skip?t:n,m=mE(a,o),y=mE(u,a);let C=m/(m+y),T=y/(m+y);C=isNaN(C)?0:C,T=isNaN(T)?0:T;const A=i*C,z=i*T;return{previous:{x:a.x-A*(u.x-o.x),y:a.y-A*(u.y-o.y)},next:{x:a.x+z*(u.x-o.x),y:a.y+z*(u.y-o.y)}}}function bb(e,t,n){return Math.max(Math.min(e,n),t)}function h4(e,t,n,i,o){let a,u,m,y;if(t.spanGaps&&(e=e.filter(C=>!C.skip)),"monotone"===t.cubicInterpolationMode)!function c4(e,t="x"){const n=k2(t),i=e.length,o=Array(i).fill(0),a=Array(i);let u,m,y,C=ig(e,0);for(u=0;u<i;++u)if(m=y,y=C,C=ig(e,u+1),y){if(C){const T=C[t]-y[t];o[u]=0!==T?(C[n]-y[n])/T:0}a[u]=m?C?Uc(o[u-1])!==Uc(o[u])?0:(o[u-1]+o[u])/2:o[u-1]:o[u]}(function a4(e,t,n){const i=e.length;let o,a,u,m,y,C=ig(e,0);for(let T=0;T<i-1;++T)if(y=C,C=ig(e,T+1),y&&C){if(Dy(t[T],0,o4)){n[T]=n[T+1]=0;continue}o=n[T]/t[T],a=n[T+1]/t[T],m=Math.pow(o,2)+Math.pow(a,2),!(m<=9)&&(u=3/Math.sqrt(m),n[T]=o*u*t[T],n[T+1]=a*u*t[T])}})(e,o,a),function l4(e,t,n="x"){const i=k2(n),o=e.length;let a,u,m,y=ig(e,0);for(let C=0;C<o;++C){if(u=m,m=y,y=ig(e,C+1),!m)continue;const T=m[n],A=m[i];u&&(a=(T-u[n])/3,m[`cp1${n}`]=T-a,m[`cp1${i}`]=A-a*t[C]),y&&(a=(y[n]-T)/3,m[`cp2${n}`]=T+a,m[`cp2${i}`]=A+a*t[C])}}(e,a,t)}(e,o);else{let C=i?e[e.length-1]:e[0];for(a=0,u=e.length;a<u;++a)m=e[a],y=s4(C,m,e[Math.min(a+1,u-(i?0:1))%u],t.tension),m.cp1x=y.previous.x,m.cp1y=y.previous.y,m.cp2x=y.next.x,m.cp2y=y.next.y,C=m}t.capBezierPoints&&function u4(e,t){let n,i,o,a,u,m=Py(e[0],t);for(n=0,i=e.length;n<i;++n)u=a,a=m,m=n<i-1&&Py(e[n+1],t),a&&(o=e[n],u&&(o.cp1x=bb(o.cp1x,t.left,t.right),o.cp1y=bb(o.cp1y,t.top,t.bottom)),m&&(o.cp2x=bb(o.cp2x,t.left,t.right),o.cp2y=bb(o.cp2y,t.top,t.bottom)))}(e,n)}function R2(){return typeof window<"u"&&typeof document<"u"}function IE(e){let t=e.parentNode;return t&&"[object ShadowRoot]"===t.toString()&&(t=t.host),t}function wb(e,t,n){let i;return"string"==typeof e?(i=parseInt(e,10),-1!==e.indexOf("%")&&(i=i/100*t.parentNode[n])):i=e,i}const Cb=e=>window.getComputedStyle(e,null),f4=["top","right","bottom","left"];function dp(e,t,n){const i={};n=n?"-"+n:"";for(let o=0;o<4;o++){const a=f4[o];i[a]=parseFloat(e[t+"-"+a+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const p4=(e,t,n)=>(e>0||t>0)&&(!n||!n.shadowRoot);function fp(e,t){if("native"in e)return e;const{canvas:n,currentDevicePixelRatio:i}=t,o=Cb(n),a="border-box"===o.boxSizing,u=dp(o,"padding"),m=dp(o,"border","width"),{x:y,y:C,box:T}=function m4(e,t){const n=e.touches,i=n&&n.length?n[0]:e,{offsetX:o,offsetY:a}=i;let m,y,u=!1;if(p4(o,a,e.target))m=o,y=a;else{const C=t.getBoundingClientRect();m=i.clientX-C.left,y=i.clientY-C.top,u=!0}return{x:m,y,box:u}}(e,n),A=u.left+(T&&m.left),z=u.top+(T&&m.top);let{width:V,height:H}=t;return a&&(V-=u.width+m.width,H-=u.height+m.height),{x:Math.round((y-A)/V*n.width/i),y:Math.round((C-z)/H*n.height/i)}}const AE=e=>Math.round(10*e)/10;function O2(e,t,n){const i=t||1,o=Math.floor(e.height*i),a=Math.floor(e.width*i);e.height=o/i,e.width=a/i;const u=e.canvas;return u.style&&(n||!u.style.height&&!u.style.width)&&(u.style.height=`${e.height}px`,u.style.width=`${e.width}px`),(e.currentDevicePixelRatio!==i||u.height!==o||u.width!==a)&&(e.currentDevicePixelRatio=i,u.height=o,u.width=a,e.ctx.setTransform(i,0,0,i,0,0),!0)}const y4=function(){let e=!1;try{const t={get passive(){return e=!0,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch{}return e}();function L2(e,t){const n=function d4(e,t){return Cb(e).getPropertyValue(t)}(e,t),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function pp(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}function v4(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:"middle"===i?n<.5?e.y:t.y:"after"===i?n<1?e.y:t.y:n>0?t.y:e.y}}function x4(e,t,n,i){const o={x:e.cp2x,y:e.cp2y},a={x:t.cp1x,y:t.cp1y},u=pp(e,o,n),m=pp(o,a,n),y=pp(a,t,n),C=pp(u,m,n),T=pp(m,y,n);return pp(C,T,n)}const F2=new Map;function Oy(e,t,n){return function b4(e,t){t=t||{};const n=e+JSON.stringify(t);let i=F2.get(n);return i||(i=new Intl.NumberFormat(e,t),F2.set(n,i)),i}(t,n).format(e)}const w4=function(e,t){return{x:n=>e+e+t-n,setWidth(n){t=n},textAlign:n=>"center"===n?n:"right"===n?"left":"right",xPlus:(n,i)=>n-i,leftForLtr:(n,i)=>n-i}},C4=function(){return{x:e=>e,setWidth(e){},textAlign:e=>e,xPlus:(e,t)=>e+t,leftForLtr:(e,t)=>e}};function rg(e,t,n){return e?w4(t,n):C4()}function z2(e,t){let n,i;("ltr"===t||"rtl"===t)&&(n=e.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",t,"important"),e.prevTextDirection=i)}function N2(e,t){void 0!==t&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function B2(e){return"angle"===e?{between:Ty,compare:hU,normalize:wa}:{between:$u,compare:(t,n)=>t-n,normalize:t=>t}}function V2({start:e,end:t,count:n,loop:i,style:o}){return{start:e%n,end:t%n,loop:i&&(t-e+1)%n==0,style:o}}function j2(e,t,n){if(!n)return[e];const{property:i,start:o,end:a}=n,u=t.length,{compare:m,between:y,normalize:C}=B2(i),{start:T,end:A,loop:z,style:V}=function E4(e,t,n){const{property:i,start:o,end:a}=n,{between:u,normalize:m}=B2(i),y=t.length;let z,V,{start:C,end:T,loop:A}=e;if(A){for(C+=y,T+=y,z=0,V=y;z<V&&u(m(t[C%y][i]),o,a);++z)C--,T--;C%=y,T%=y}return T<C&&(T+=y),{start:C,end:T,loop:A,style:e.style}}(e,t,n),H=[];let le,we,ve,X=!1,oe=null;for(let Rt=T,Ot=T;Rt<=A;++Rt)we=t[Rt%u],!we.skip&&(le=C(we[i]),le!==ve&&(X=y(le,o,a),null===oe&&(X||y(o,ve,le)&&0!==m(o,ve))&&(oe=0===m(le,o)?Rt:Ot),null!==oe&&(!X||0===m(a,le)||y(a,ve,le))&&(H.push(V2({start:oe,end:Rt,loop:z,count:u,style:V})),oe=null),Ot=Rt,ve=le));return null!==oe&&H.push(V2({start:oe,end:A,loop:z,count:u,style:V})),H}function U2(e,t){const n=[],i=e.segments;for(let o=0;o<i.length;o++){const a=j2(i[o],e.points,t);a.length&&n.push(...a)}return n}function H2(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function I4(e,t){return t&&JSON.stringify(e)!==JSON.stringify(t)}var Wu=new class A4{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,n,i,o){const u=n.duration;n.listeners[o].forEach(m=>m({chart:t,initial:n.initial,numSteps:u,currentStep:Math.min(i-n.start,u)}))}_refresh(){this._request||(this._running=!0,this._request=KA.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let n=0;this._charts.forEach((i,o)=>{if(!i.running||!i.items.length)return;const a=i.items;let y,u=a.length-1,m=!1;for(;u>=0;--u)y=a[u],y._active?(y._total>i.duration&&(i.duration=y._total),y.tick(t),m=!0):(a[u]=a[a.length-1],a.pop());m&&(o.draw(),this._notify(o,i,t,"progress")),a.length||(i.running=!1,this._notify(o,i,t,"complete"),i.initial=!1),n+=a.length}),this._lastDate=t,0===n&&(this._running=!1)}_getAnims(t){const n=this._charts;let i=n.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(t,i)),i}listen(t,n,i){this._getAnims(t).listeners[n].push(i)}add(t,n){!n||!n.length||this._getAnims(t).items.push(...n)}has(t){return this._getAnims(t).items.length>0}start(t){const n=this._charts.get(t);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((i,o)=>Math.max(i,o._duration),0),this._refresh())}running(t){if(!this._running)return!1;const n=this._charts.get(t);return!(!n||!n.running||!n.items.length)}stop(t){const n=this._charts.get(t);if(!n||!n.items.length)return;const i=n.items;let o=i.length-1;for(;o>=0;--o)i[o].cancel();n.items=[],this._notify(t,n,Date.now(),"complete")}remove(t){return this._charts.delete(t)}};const G2="transparent",P4={boolean:(e,t,n)=>n>.5?t:e,color(e,t,n){const i=v2(e||G2),o=i.valid&&v2(t||G2);return o&&o.valid?o.mix(i,n).hexString():t},number:(e,t,n)=>e+(t-e)*n};class k4{constructor(t,n,i,o){const a=n[i];o=Ry([t.to,o,a,t.from]);const u=Ry([t.from,a,o]);this._active=!0,this._fn=t.fn||P4[t.type||typeof u],this._easing=Sy[t.easing]||Sy.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=n,this._prop=i,this._from=u,this._to=o,this._promises=void 0}active(){return this._active}update(t,n,i){if(this._active){this._notify(!1);const o=this._target[this._prop],a=i-this._start,u=this._duration-a;this._start=i,this._duration=Math.floor(Math.max(u,t.duration)),this._total+=a,this._loop=!!t.loop,this._to=Ry([t.to,n,o,t.from]),this._from=Ry([t.from,o,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const n=t-this._start,i=this._duration,o=this._prop,a=this._from,u=this._loop,m=this._to;let y;if(this._active=a!==m&&(u||n<i),!this._active)return this._target[o]=m,void this._notify(!0);n<0?this._target[o]=a:(y=n/i%2,y=u&&y>1?2-y:y,y=this._easing(Math.min(1,Math.max(0,y))),this._target[o]=this._fn(a,m,y))}wait(){const t=this._promises||(this._promises=[]);return new Promise((n,i)=>{t.push({res:n,rej:i})})}_notify(t){const n=t?"res":"rej",i=this._promises||[];for(let o=0;o<i.length;o++)i[o][n]()}}Nn.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const L4=Object.keys(Nn.animation);Nn.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>"onProgress"!==e&&"onComplete"!==e&&"fn"!==e}),Nn.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),Nn.describe("animations",{_fallback:"animation"}),Nn.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>0|e}}}});class W2{constructor(t,n){this._chart=t,this._properties=new Map,this.configure(n)}configure(t){if(!$n(t))return;const n=this._properties;Object.getOwnPropertyNames(t).forEach(i=>{const o=t[i];if(!$n(o))return;const a={};for(const u of L4)a[u]=o[u];(Ai(o.properties)&&o.properties||[i]).forEach(u=>{(u===i||!n.has(u))&&n.set(u,a)})})}_animateOptions(t,n){const i=n.options,o=function z4(e,t){if(!t)return;let n=e.options;if(n)return n.$shared&&(e.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n;e.options=t}(t,i);if(!o)return[];const a=this._createAnimations(o,i);return i.$shared&&function F4(e,t){const n=[],i=Object.keys(t);for(let o=0;o<i.length;o++){const a=e[i[o]];a&&a.active()&&n.push(a.wait())}return Promise.all(n)}(t.options.$animations,i).then(()=>{t.options=i},()=>{}),a}_createAnimations(t,n){const i=this._properties,o=[],a=t.$animations||(t.$animations={}),u=Object.keys(n),m=Date.now();let y;for(y=u.length-1;y>=0;--y){const C=u[y];if("$"===C.charAt(0))continue;if("options"===C){o.push(...this._animateOptions(t,n));continue}const T=n[C];let A=a[C];const z=i.get(C);if(A){if(z&&A.active()){A.update(z,T,m);continue}A.cancel()}z&&z.duration?(a[C]=A=new k4(z,t,C,T),o.push(A)):t[C]=T}return o}update(t,n){if(0===this._properties.size)return void Object.assign(t,n);const i=this._createAnimations(t,n);return i.length?(Wu.add(this._chart,i),!0):void 0}}function q2(e,t){const n=e&&e.options||{},i=n.reverse,o=void 0===n.min?t:0,a=void 0===n.max?t:0;return{start:i?a:o,end:i?o:a}}function Z2(e,t){const n=[],i=e._getSortedDatasetMetas(t);let o,a;for(o=0,a=i.length;o<a;++o)n.push(i[o].index);return n}function X2(e,t,n,i={}){const o=e.keys,a="single"===i.mode;let u,m,y,C;if(null!==t){for(u=0,m=o.length;u<m;++u){if(y=+o[u],y===n){if(i.all)continue;break}C=e.values[y],Dr(C)&&(a||0===t||Uc(t)===Uc(C))&&(t+=C)}return t}}function Y2(e,t){const n=e&&e.options.stacked;return n||void 0===n&&void 0!==t.stack}function $4(e,t,n){const i=e[t]||(e[t]={});return i[n]||(i[n]={})}function K2(e,t,n,i){for(const o of t.getMatchingVisibleMetas(i).reverse()){const a=e[o.index];if(n&&a>0||!n&&a<0)return o.index}return null}function J2(e,t){const{chart:n,_cachedMeta:i}=e,o=n._stacks||(n._stacks={}),{iScale:a,vScale:u,index:m}=i,y=a.axis,C=u.axis,T=function j4(e,t,n){return`${e.id}.${t.id}.${n.stack||n.type}`}(a,u,i),A=t.length;let z;for(let V=0;V<A;++V){const H=t[V],{[y]:X,[C]:oe}=H;z=(H._stacks||(H._stacks={}))[C]=$4(o,T,X),z[m]=oe,z._top=K2(z,u,!0,i.type),z._bottom=K2(z,u,!1,i.type)}}function PE(e,t){const n=e.scales;return Object.keys(n).filter(i=>n[i].axis===t).shift()}function Ly(e,t){const n=e.controller.index,i=e.vScale&&e.vScale.axis;if(i){t=t||e._parsed;for(const o of t){const a=o._stacks;if(!a||void 0===a[i]||void 0===a[i][n])return;delete a[i][n]}}}const kE=e=>"reset"===e||"none"===e,Q2=(e,t)=>t?e:Object.assign({},e);let qu=(()=>{class e{constructor(n,i){this.chart=n,this._ctx=n.ctx,this.index=i,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const n=this._cachedMeta;this.configure(),this.linkScales(),n._stacked=Y2(n.vScale,n),this.addElements()}updateIndex(n){this.index!==n&&Ly(this._cachedMeta),this.index=n}linkScales(){const n=this.chart,i=this._cachedMeta,o=this.getDataset(),a=(z,V,H,X)=>"x"===z?V:"r"===z?X:H,u=i.xAxisID=Dn(o.xAxisID,PE(n,"x")),m=i.yAxisID=Dn(o.yAxisID,PE(n,"y")),y=i.rAxisID=Dn(o.rAxisID,PE(n,"r")),C=i.indexAxis,T=i.iAxisID=a(C,u,m,y),A=i.vAxisID=a(C,m,u,y);i.xScale=this.getScaleForId(u),i.yScale=this.getScaleForId(m),i.rScale=this.getScaleForId(y),i.iScale=this.getScaleForId(T),i.vScale=this.getScaleForId(A)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(n){return this.chart.scales[n]}_getOtherScale(n){const i=this._cachedMeta;return n===i.iScale?i.vScale:i.iScale}reset(){this._update("reset")}_destroy(){const n=this._cachedMeta;this._data&&C2(this._data,this),n._stacked&&Ly(n)}_dataCheck(){const n=this.getDataset(),i=n.data||(n.data=[]),o=this._data;if($n(i))this._data=function V4(e){const t=Object.keys(e),n=new Array(t.length);let i,o,a;for(i=0,o=t.length;i<o;++i)a=t[i],n[i]={x:a,y:e[a]};return n}(i);else if(o!==i){if(o){C2(o,this);const a=this._cachedMeta;Ly(a),a._parsed=[]}i&&Object.isExtensible(i)&&function XU(e,t){e._chartjs?e._chartjs.listeners.push(t):(Object.defineProperty(e,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),w2.forEach(n=>{const i="_onData"+fE(n),o=e[n];Object.defineProperty(e,n,{configurable:!0,enumerable:!1,value(...a){const u=o.apply(this,a);return e._chartjs.listeners.forEach(m=>{"function"==typeof m[i]&&m[i](...a)}),u}})}))}(i,this),this._syncList=[],this._data=i}}addElements(){const n=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(n.dataset=new this.datasetElementType)}buildOrUpdateElements(n){const i=this._cachedMeta,o=this.getDataset();let a=!1;this._dataCheck();const u=i._stacked;i._stacked=Y2(i.vScale,i),i.stack!==o.stack&&(a=!0,Ly(i),i.stack=o.stack),this._resyncElements(n),(a||u!==i._stacked)&&J2(this,i._parsed)}configure(){const n=this.chart.config,i=n.datasetScopeKeys(this._type),o=n.getOptionScopes(this.getDataset(),i,!0);this.options=n.createResolver(o,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(n,i){const{_cachedMeta:o,_data:a}=this,{iScale:u,_stacked:m}=o,y=u.axis;let A,z,V,C=0===n&&i===a.length||o._sorted,T=n>0&&o._parsed[n-1];if(!1===this._parsing)o._parsed=a,o._sorted=!0,V=a;else{V=Ai(a[n])?this.parseArrayData(o,a,n,i):$n(a[n])?this.parseObjectData(o,a,n,i):this.parsePrimitiveData(o,a,n,i);const H=()=>null===z[y]||T&&z[y]<T[y];for(A=0;A<i;++A)o._parsed[A+n]=z=V[A],C&&(H()&&(C=!1),T=z);o._sorted=C}m&&J2(this,V)}parsePrimitiveData(n,i,o,a){const{iScale:u,vScale:m}=n,y=u.axis,C=m.axis,T=u.getLabels(),A=u===m,z=new Array(a);let V,H,X;for(V=0,H=a;V<H;++V)X=V+o,z[V]={[y]:A||u.parse(T[X],X),[C]:m.parse(i[X],X)};return z}parseArrayData(n,i,o,a){const{xScale:u,yScale:m}=n,y=new Array(a);let C,T,A,z;for(C=0,T=a;C<T;++C)A=C+o,z=i[A],y[C]={x:u.parse(z[0],A),y:m.parse(z[1],A)};return y}parseObjectData(n,i,o,a){const{xScale:u,yScale:m}=n,{xAxisKey:y="x",yAxisKey:C="y"}=this._parsing,T=new Array(a);let A,z,V,H;for(A=0,z=a;A<z;++A)V=A+o,H=i[V],T[A]={x:u.parse(Ed(H,y),V),y:m.parse(Ed(H,C),V)};return T}getParsed(n){return this._cachedMeta._parsed[n]}getDataElement(n){return this._cachedMeta.data[n]}applyStack(n,i,o){const u=this._cachedMeta,m=i[n.axis];return X2({keys:Z2(this.chart,!0),values:i._stacks[n.axis]},m,u.index,{mode:o})}updateRangeFromParsed(n,i,o,a){const u=o[i.axis];let m=null===u?NaN:u;const y=a&&o._stacks[i.axis];a&&y&&(a.values=y,m=X2(a,u,this._cachedMeta.index)),n.min=Math.min(n.min,m),n.max=Math.max(n.max,m)}getMinMax(n,i){const o=this._cachedMeta,a=o._parsed,u=o._sorted&&n===o.iScale,m=a.length,y=this._getOtherScale(n),C=((e,t,n)=>e&&!t.hidden&&t._stacked&&{keys:Z2(this.chart,!0),values:null})(i,o),T={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:A,max:z}=function U4(e){const{min:t,max:n,minDefined:i,maxDefined:o}=e.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:o?n:Number.POSITIVE_INFINITY}}(y);let V,H;function X(){H=a[V];const oe=H[y.axis];return!Dr(H[n.axis])||A>oe||z<oe}for(V=0;V<m&&(X()||(this.updateRangeFromParsed(T,n,H,C),!u));++V);if(u)for(V=m-1;V>=0;--V)if(!X()){this.updateRangeFromParsed(T,n,H,C);break}return T}getAllParsedValues(n){const i=this._cachedMeta._parsed,o=[];let a,u,m;for(a=0,u=i.length;a<u;++a)m=i[a][n.axis],Dr(m)&&o.push(m);return o}getMaxOverflow(){return!1}getLabelAndValue(n){const i=this._cachedMeta,o=i.iScale,a=i.vScale,u=this.getParsed(n);return{label:o?""+o.getLabelForValue(u[o.axis]):"",value:a?""+a.getLabelForValue(u[a.axis]):""}}_update(n){const i=this._cachedMeta;this.update(n||"default"),i._clip=function B4(e){let t,n,i,o;return $n(e)?(t=e.top,n=e.right,i=e.bottom,o=e.left):t=n=i=o=e,{top:t,right:n,bottom:i,left:o,disabled:!1===e}}(Dn(this.options.clip,function N4(e,t,n){if(!1===n)return!1;const i=q2(e,n),o=q2(t,n);return{top:o.end,right:i.end,bottom:o.start,left:i.start}}(i.xScale,i.yScale,this.getMaxOverflow())))}update(n){}draw(){const n=this._ctx,o=this._cachedMeta,a=o.data||[],u=this.chart.chartArea,m=[],y=this._drawStart||0,C=this._drawCount||a.length-y,T=this.options.drawActiveElementsOnTop;let A;for(o.dataset&&o.dataset.draw(n,u,y,C),A=y;A<y+C;++A){const z=a[A];z.hidden||(z.active&&T?m.push(z):z.draw(n,u))}for(A=0;A<m.length;++A)m[A].draw(n,u)}getStyle(n,i){const o=i?"active":"default";return void 0===n&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(o):this.resolveDataElementOptions(n||0,o)}getContext(n,i,o){const a=this.getDataset();let u;if(n>=0&&n<this._cachedMeta.data.length){const m=this._cachedMeta.data[n];u=m.$context||(m.$context=function G4(e,t,n){return Md(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:n,index:t,mode:"default",type:"data"})}(this.getContext(),n,m)),u.parsed=this.getParsed(n),u.raw=a.data[n],u.index=u.dataIndex=n}else u=this.$context||(this.$context=function H4(e,t){return Md(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),u.dataset=a,u.index=u.datasetIndex=this.index;return u.active=!!i,u.mode=o,u}resolveDatasetElementOptions(n){return this._resolveElementOptions(this.datasetElementType.id,n)}resolveDataElementOptions(n,i){return this._resolveElementOptions(this.dataElementType.id,i,n)}_resolveElementOptions(n,i="default",o){const a="active"===i,u=this._cachedDataOpts,m=n+"-"+i,y=u[m],C=this.enableOptionSharing&&rl(o);if(y)return Q2(y,C);const T=this.chart.config,A=T.datasetElementScopeKeys(this._type,n),z=a?[`${n}Hover`,"hover",n,""]:[n,""],V=T.getOptionScopes(this.getDataset(),A),H=Object.keys(Nn.elements[n]),oe=T.resolveNamedOptions(V,H,()=>this.getContext(o,a),z);return oe.$shared&&(oe.$shared=C,u[m]=Object.freeze(Q2(oe,C))),oe}_resolveAnimations(n,i,o){const a=this.chart,u=this._cachedDataOpts,m=`animation-${i}`,y=u[m];if(y)return y;let C;if(!1!==a.options.animation){const A=this.chart.config,z=A.datasetAnimationScopeKeys(this._type,i),V=A.getOptionScopes(this.getDataset(),z);C=A.createResolver(V,this.getContext(n,o,i))}const T=new W2(a,C&&C.animations);return C&&C._cacheable&&(u[m]=Object.freeze(T)),T}getSharedOptions(n){if(n.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},n))}includeOptions(n,i){return!i||kE(n)||this.chart._animationsDisabled}updateElement(n,i,o,a){kE(a)?Object.assign(n,o):this._resolveAnimations(i,a).update(n,o)}updateSharedOptions(n,i,o){n&&!kE(i)&&this._resolveAnimations(void 0,i).update(n,o)}_setStyle(n,i,o,a){n.active=a;const u=this.getStyle(i,a);this._resolveAnimations(i,o,a).update(n,{options:!a&&this.getSharedOptions(u)||u})}removeHoverStyle(n,i,o){this._setStyle(n,o,"active",!1)}setHoverStyle(n,i,o){this._setStyle(n,o,"active",!0)}_removeDatasetHoverStyle(){const n=this._cachedMeta.dataset;n&&this._setStyle(n,void 0,"active",!1)}_setDatasetHoverStyle(){const n=this._cachedMeta.dataset;n&&this._setStyle(n,void 0,"active",!0)}_resyncElements(n){const i=this._data,o=this._cachedMeta.data;for(const[y,C,T]of this._syncList)this[y](C,T);this._syncList=[];const a=o.length,u=i.length,m=Math.min(u,a);m&&this.parse(0,m),u>a?this._insertElements(a,u-a,n):u<a&&this._removeElements(u,a-u)}_insertElements(n,i,o=!0){const a=this._cachedMeta,u=a.data,m=n+i;let y;const C=T=>{for(T.length+=i,y=T.length-1;y>=m;y--)T[y]=T[y-i]};for(C(u),y=n;y<m;++y)u[y]=new this.dataElementType;this._parsing&&C(a._parsed),this.parse(n,i),o&&this.updateElements(u,n,i,"reset")}updateElements(n,i,o,a){}_removeElements(n,i){const o=this._cachedMeta;if(this._parsing){const a=o._parsed.splice(n,i);o._stacked&&Ly(o,a)}o.data.splice(n,i)}_sync(n){if(this._parsing)this._syncList.push(n);else{const[i,o,a]=n;this[i](o,a)}this.chart._dataChanges.push([this.index,...n])}_onDataPush(){const n=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-n,n])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(n,i){i&&this._sync(["_removeElements",n,i]);const o=arguments.length-2;o&&this._sync(["_insertElements",n,o])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return e.defaults={},e})();function Z4(e){const t=e.iScale,n=function q4(e,t){if(!e._cache.$bar){const n=e.getMatchingVisibleMetas(t);let i=[];for(let o=0,a=n.length;o<a;o++)i=i.concat(n[o].controller.getAllParsedValues(e));e._cache.$bar=E2(i.sort((o,a)=>o-a))}return e._cache.$bar}(t,e.type);let o,a,u,m,i=t._length;const y=()=>{32767===u||-32768===u||(rl(m)&&(i=Math.min(i,Math.abs(u-m)||i)),m=u)};for(o=0,a=n.length;o<a;++o)u=t.getPixelForValue(n[o]),y();for(m=void 0,o=0,a=t.ticks.length;o<a;++o)u=t.getPixelForTick(o),y();return i}function eP(e,t,n,i){return Ai(e)?function K4(e,t,n,i){const o=n.parse(e[0],i),a=n.parse(e[1],i),u=Math.min(o,a),m=Math.max(o,a);let y=u,C=m;Math.abs(u)>Math.abs(m)&&(y=m,C=u),t[n.axis]=C,t._custom={barStart:y,barEnd:C,start:o,end:a,min:u,max:m}}(e,t,n,i):t[n.axis]=n.parse(e,i),t}function tP(e,t,n,i){const o=e.iScale,a=e.vScale,u=o.getLabels(),m=o===a,y=[];let C,T,A,z;for(C=n,T=n+i;C<T;++C)z=t[C],A={},A[o.axis]=m||o.parse(u[C],C),y.push(eP(z,A,a,C));return y}function RE(e){return e&&void 0!==e.barStart&&void 0!==e.barEnd}function e$(e,t,n,i){let o=t.borderSkipped;const a={};if(!o)return void(e.borderSkipped=a);const{start:u,end:m,reverse:y,top:C,bottom:T}=function Q4(e){let t,n,i,o,a;return e.horizontal?(t=e.base>e.x,n="left",i="right"):(t=e.base<e.y,n="bottom",i="top"),t?(o="end",a="start"):(o="start",a="end"),{start:n,end:i,reverse:t,top:o,bottom:a}}(e);"middle"===o&&n&&(e.enableBorderRadius=!0,(n._top||0)===i?o=C:(n._bottom||0)===i?o=T:(a[nP(T,u,m,y)]=!0,o=C)),a[nP(o,u,m,y)]=!0,e.borderSkipped=a}function nP(e,t,n,i){return i?(e=function t$(e,t,n){return e===t?n:e===n?t:e}(e,t,n),e=iP(e,n,t)):e=iP(e,t,n),e}function iP(e,t,n){return"start"===e?t:"end"===e?n:e}function n$(e,{inflateAmount:t},n){e.inflateAmount="auto"===t?1===n?.33:0:t}qu.prototype.datasetElementType=null,qu.prototype.dataElementType=null;let i$=(()=>{class e extends qu{parsePrimitiveData(n,i,o,a){return tP(n,i,o,a)}parseArrayData(n,i,o,a){return tP(n,i,o,a)}parseObjectData(n,i,o,a){const{iScale:u,vScale:m}=n,{xAxisKey:y="x",yAxisKey:C="y"}=this._parsing,T="x"===u.axis?y:C,A="x"===m.axis?y:C,z=[];let V,H,X,oe;for(V=o,H=o+a;V<H;++V)oe=i[V],X={},X[u.axis]=u.parse(Ed(oe,T),V),z.push(eP(Ed(oe,A),X,m,V));return z}updateRangeFromParsed(n,i,o,a){super.updateRangeFromParsed(n,i,o,a);const u=o._custom;u&&i===this._cachedMeta.vScale&&(n.min=Math.min(n.min,u.min),n.max=Math.max(n.max,u.max))}getMaxOverflow(){return 0}getLabelAndValue(n){const i=this._cachedMeta,{iScale:o,vScale:a}=i,u=this.getParsed(n),m=u._custom,y=RE(m)?"["+m.start+", "+m.end+"]":""+a.getLabelForValue(u[a.axis]);return{label:""+o.getLabelForValue(u[o.axis]),value:y}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(n){const i=this._cachedMeta;this.updateElements(i.data,0,i.data.length,n)}updateElements(n,i,o,a){const u="reset"===a,{index:m,_cachedMeta:{vScale:y}}=this,C=y.getBasePixel(),T=y.isHorizontal(),A=this._getRuler(),z=this.resolveDataElementOptions(i,a),V=this.getSharedOptions(z),H=this.includeOptions(a,V);this.updateSharedOptions(V,a,z);for(let X=i;X<i+o;X++){const oe=this.getParsed(X),le=u||oi(oe[y.axis])?{base:C,head:C}:this._calculateBarValuePixels(X),we=this._calculateBarIndexPixels(X,A),ve=(oe._stacks||{})[y.axis],Re={horizontal:T,base:le.base,enableBorderRadius:!ve||RE(oe._custom)||m===ve._top||m===ve._bottom,x:T?le.head:we.center,y:T?we.center:le.head,height:T?we.size:Math.abs(le.size),width:T?Math.abs(le.size):we.size};H&&(Re.options=V||this.resolveDataElementOptions(X,n[X].active?"active":a));const Fe=Re.options||n[X].options;e$(Re,Fe,ve,m),n$(Re,Fe,A.ratio),this.updateElement(n[X],X,Re,a)}}_getStacks(n,i){const a=this._cachedMeta.iScale,u=a.getMatchingVisibleMetas(this._type),m=a.options.stacked,y=u.length,C=[];let T,A;for(T=0;T<y;++T)if(A=u[T],A.controller.options.grouped){if(typeof i<"u"){const z=A.controller.getParsed(i)[A.controller._cachedMeta.vScale.axis];if(oi(z)||isNaN(z))continue}if((!1===m||-1===C.indexOf(A.stack)||void 0===m&&void 0===A.stack)&&C.push(A.stack),A.index===n)break}return C.length||C.push(void 0),C}_getStackCount(n){return this._getStacks(void 0,n).length}_getStackIndex(n,i,o){const a=this._getStacks(n,o),u=void 0!==i?a.indexOf(i):-1;return-1===u?a.length-1:u}_getRuler(){const n=this.options,i=this._cachedMeta,o=i.iScale,a=[];let u,m;for(u=0,m=i.data.length;u<m;++u)a.push(o.getPixelForValue(this.getParsed(u)[o.axis],u));const y=n.barThickness;return{min:y||Z4(i),pixels:a,start:o._startPixel,end:o._endPixel,stackCount:this._getStackCount(),scale:o,grouped:n.grouped,ratio:y?1:n.categoryPercentage*n.barPercentage}}_calculateBarValuePixels(n){const{_cachedMeta:{vScale:i,_stacked:o},options:{base:a,minBarLength:u}}=this,m=a||0,y=this.getParsed(n),C=y._custom,T=RE(C);let H,X,A=y[i.axis],z=0,V=o?this.applyStack(i,y,o):A;V!==A&&(z=V-A,V=A),T&&(A=C.barStart,V=C.barEnd-C.barStart,0!==A&&Uc(A)!==Uc(C.barEnd)&&(z=0),z+=A);const oe=oi(a)||T?z:a;let le=i.getPixelForValue(oe);if(H=this.chart.getDataVisibility(n)?i.getPixelForValue(z+V):le,X=H-le,Math.abs(X)<u){X=function J4(e,t,n){return 0!==e?Uc(e):(t.isHorizontal()?1:-1)*(t.min>=n?1:-1)}(X,i,m)*u,A===m&&(le-=X/2);const we=i.getPixelForDecimal(0),ve=i.getPixelForDecimal(1),Re=Math.min(we,ve),Fe=Math.max(we,ve);le=Math.max(Math.min(le,Fe),Re),H=le+X}if(le===i.getPixelForValue(m)){const we=Uc(X)*i.getLineWidthForValue(m)/2;le+=we,X-=we}return{size:X,base:le,head:H,center:H+X/2}}_calculateBarIndexPixels(n,i){const o=i.scale,a=this.options,u=a.skipNull,m=Dn(a.maxBarThickness,1/0);let y,C;if(i.grouped){const T=u?this._getStackCount(n):i.stackCount,A="flex"===a.barThickness?function Y4(e,t,n,i){const o=t.pixels,a=o[e];let u=e>0?o[e-1]:null,m=e<o.length-1?o[e+1]:null;const y=n.categoryPercentage;null===u&&(u=a-(null===m?t.end-t.start:m-a)),null===m&&(m=a+a-u);const C=a-(a-Math.min(u,m))/2*y;return{chunk:Math.abs(m-u)/2*y/i,ratio:n.barPercentage,start:C}}(n,i,a,T):function X4(e,t,n,i){const o=n.barThickness;let a,u;return oi(o)?(a=t.min*n.categoryPercentage,u=n.barPercentage):(a=o*i,u=1),{chunk:a/i,ratio:u,start:t.pixels[e]-a/2}}(n,i,a,T),z=this._getStackIndex(this.index,this._cachedMeta.stack,u?n:void 0);y=A.start+A.chunk*z+A.chunk/2,C=Math.min(m,A.chunk*A.ratio)}else y=o.getPixelForValue(this.getParsed(n)[o.axis],n),C=Math.min(m,i.min*i.ratio);return{base:y-C/2,head:y+C/2,center:y,size:C}}draw(){const n=this._cachedMeta,i=n.vScale,o=n.data,a=o.length;let u=0;for(;u<a;++u)null!==this.getParsed(u)[i.axis]&&o[u].draw(this._ctx)}}return e.id="bar",e.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},e.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}},e})(),r$=(()=>{class e extends qu{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(n,i,o,a){const u=super.parsePrimitiveData(n,i,o,a);for(let m=0;m<u.length;m++)u[m]._custom=this.resolveDataElementOptions(m+o).radius;return u}parseArrayData(n,i,o,a){const u=super.parseArrayData(n,i,o,a);for(let m=0;m<u.length;m++)u[m]._custom=Dn(i[o+m][2],this.resolveDataElementOptions(m+o).radius);return u}parseObjectData(n,i,o,a){const u=super.parseObjectData(n,i,o,a);for(let m=0;m<u.length;m++){const y=i[o+m];u[m]._custom=Dn(y&&y.r&&+y.r,this.resolveDataElementOptions(m+o).radius)}return u}getMaxOverflow(){const n=this._cachedMeta.data;let i=0;for(let o=n.length-1;o>=0;--o)i=Math.max(i,n[o].size(this.resolveDataElementOptions(o))/2);return i>0&&i}getLabelAndValue(n){const i=this._cachedMeta,{xScale:o,yScale:a}=i,u=this.getParsed(n),m=o.getLabelForValue(u.x),y=a.getLabelForValue(u.y),C=u._custom;return{label:i.label,value:"("+m+", "+y+(C?", "+C:"")+")"}}update(n){const i=this._cachedMeta.data;this.updateElements(i,0,i.length,n)}updateElements(n,i,o,a){const u="reset"===a,{iScale:m,vScale:y}=this._cachedMeta,C=this.resolveDataElementOptions(i,a),T=this.getSharedOptions(C),A=this.includeOptions(a,T),z=m.axis,V=y.axis;for(let H=i;H<i+o;H++){const X=n[H],oe=!u&&this.getParsed(H),le={},we=le[z]=u?m.getPixelForDecimal(.5):m.getPixelForValue(oe[z]),ve=le[V]=u?y.getBasePixel():y.getPixelForValue(oe[V]);le.skip=isNaN(we)||isNaN(ve),A&&(le.options=this.resolveDataElementOptions(H,X.active?"active":a),u&&(le.options.radius=0)),this.updateElement(X,H,le,a)}this.updateSharedOptions(T,a,C)}resolveDataElementOptions(n,i){const o=this.getParsed(n);let a=super.resolveDataElementOptions(n,i);a.$shared&&(a=Object.assign({},a,{$shared:!1}));const u=a.radius;return"active"!==i&&(a.radius=0),a.radius+=Dn(o&&o._custom,u),a}}return e.id="bubble",e.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},e.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}},e})(),rP=(()=>{class e extends qu{constructor(n,i){super(n,i),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(n,i){const o=this.getDataset().data,a=this._cachedMeta;if(!1===this._parsing)a._parsed=o;else{let m,y,u=C=>+o[C];if($n(o[n])){const{key:C="value"}=this._parsing;u=T=>+Ed(o[T],C)}for(m=n,y=n+i;m<y;++m)a._parsed[m]=u(m)}}_getRotation(){return Yl(this.options.rotation-90)}_getCircumference(){return Yl(this.options.circumference)}_getRotationExtents(){let n=Ei,i=-Ei;for(let o=0;o<this.chart.data.datasets.length;++o)if(this.chart.isDatasetVisible(o)){const a=this.chart.getDatasetMeta(o).controller,u=a._getRotation(),m=a._getCircumference();n=Math.min(n,u),i=Math.max(i,u+m)}return{rotation:n,circumference:i-n}}update(n){const i=this.chart,{chartArea:o}=i,a=this._cachedMeta,u=a.data,m=this.getMaxBorderWidth()+this.getMaxOffset(u)+this.options.spacing,y=Math.max((Math.min(o.width,o.height)-m)/2,0),C=Math.min(((e,t)=>"string"==typeof e&&e.endsWith("%")?parseFloat(e)/100:e/t)(this.options.cutout,y),1),T=this._getRingWeight(this.index),{circumference:A,rotation:z}=this._getRotationExtents(),{ratioX:V,ratioY:H,offsetX:X,offsetY:oe}=function o$(e,t,n){let i=1,o=1,a=0,u=0;if(t<Ei){const m=e,y=m+t,C=Math.cos(m),T=Math.sin(m),A=Math.cos(y),z=Math.sin(y),V=(ve,Re,Fe)=>Ty(ve,m,y,!0)?1:Math.max(Re,Re*n,Fe,Fe*n),H=(ve,Re,Fe)=>Ty(ve,m,y,!0)?-1:Math.min(Re,Re*n,Fe,Fe*n),X=V(0,C,A),oe=V(pr,T,z),le=H(qi,C,A),we=H(qi+pr,T,z);i=(X-le)/2,o=(oe-we)/2,a=-(X+le)/2,u=-(oe+we)/2}return{ratioX:i,ratioY:o,offsetX:a,offsetY:u}}(z,A,C),ve=Math.max(Math.min((o.width-m)/V,(o.height-m)/H)/2,0),Re=QA(this.options.radius,ve),lt=(Re-Math.max(Re*C,0))/this._getVisibleDatasetWeightTotal();this.offsetX=X*Re,this.offsetY=oe*Re,a.total=this.calculateTotal(),this.outerRadius=Re-lt*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-lt*T,0),this.updateElements(u,0,u.length,n)}_circumference(n,i){const o=this.options,a=this._cachedMeta,u=this._getCircumference();return i&&o.animation.animateRotate||!this.chart.getDataVisibility(n)||null===a._parsed[n]||a.data[n].hidden?0:this.calculateCircumference(a._parsed[n]*u/Ei)}updateElements(n,i,o,a){const u="reset"===a,m=this.chart,y=m.chartArea,A=(y.left+y.right)/2,z=(y.top+y.bottom)/2,V=u&&m.options.animation.animateScale,H=V?0:this.innerRadius,X=V?0:this.outerRadius,oe=this.resolveDataElementOptions(i,a),le=this.getSharedOptions(oe),we=this.includeOptions(a,le);let Re,ve=this._getRotation();for(Re=0;Re<i;++Re)ve+=this._circumference(Re,u);for(Re=i;Re<i+o;++Re){const Fe=this._circumference(Re,u),lt=n[Re],bt={x:A+this.offsetX,y:z+this.offsetY,startAngle:ve,endAngle:ve+Fe,circumference:Fe,outerRadius:X,innerRadius:H};we&&(bt.options=le||this.resolveDataElementOptions(Re,lt.active?"active":a)),ve+=Fe,this.updateElement(lt,Re,bt,a)}this.updateSharedOptions(le,a,oe)}calculateTotal(){const n=this._cachedMeta,i=n.data;let a,o=0;for(a=0;a<i.length;a++){const u=n._parsed[a];null!==u&&!isNaN(u)&&this.chart.getDataVisibility(a)&&!i[a].hidden&&(o+=Math.abs(u))}return o}calculateCircumference(n){const i=this._cachedMeta.total;return i>0&&!isNaN(n)?Ei*(Math.abs(n)/i):0}getLabelAndValue(n){const o=this.chart,a=o.data.labels||[],u=Oy(this._cachedMeta._parsed[n],o.options.locale);return{label:a[n]||"",value:u}}getMaxBorderWidth(n){let i=0;const o=this.chart;let a,u,m,y,C;if(!n)for(a=0,u=o.data.datasets.length;a<u;++a)if(o.isDatasetVisible(a)){m=o.getDatasetMeta(a),n=m.data,y=m.controller;break}if(!n)return 0;for(a=0,u=n.length;a<u;++a)C=y.resolveDataElementOptions(a),"inner"!==C.borderAlign&&(i=Math.max(i,C.borderWidth||0,C.hoverBorderWidth||0));return i}getMaxOffset(n){let i=0;for(let o=0,a=n.length;o<a;++o){const u=this.resolveDataElementOptions(o);i=Math.max(i,u.offset||0,u.hoverOffset||0)}return i}_getRingWeightOffset(n){let i=0;for(let o=0;o<n;++o)this.chart.isDatasetVisible(o)&&(i+=this._getRingWeight(o));return i}_getRingWeight(n){return Math.max(Dn(this.chart.data.datasets[n].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return e.id="doughnut",e.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},e.descriptors={_scriptable:t=>"spacing"!==t,_indexable:t=>"spacing"!==t},e.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:i}}=t.legend.options;return n.labels.map((o,a)=>{const m=t.getDatasetMeta(0).controller.getStyle(a);return{text:o,fillStyle:m.backgroundColor,strokeStyle:m.borderColor,lineWidth:m.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(a),index:a}})}return[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label(t){let n=t.label;const i=": "+t.formattedValue;return Ai(n)?(n=n.slice(),n[0]+=i):n+=i,n}}}}},e})(),oP=(()=>{class e extends qu{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(n){const i=this._cachedMeta,{dataset:o,data:a=[],_dataset:u}=i,m=this.chart._animationsDisabled;let{start:y,count:C}=function s$(e,t,n){const i=t.length;let o=0,a=i;if(e._sorted){const{iScale:u,_parsed:m}=e,y=u.axis,{min:C,max:T,minDefined:A,maxDefined:z}=u.getUserBounds();A&&(o=yo(Math.min(Gu(m,u.axis,C).lo,n?i:Gu(t,y,u.getPixelForValue(C)).lo),0,i-1)),a=z?yo(Math.max(Gu(m,u.axis,T).hi+1,n?0:Gu(t,y,u.getPixelForValue(T)).hi+1),o,i)-o:i-o}return{start:o,count:a}}(i,a,m);this._drawStart=y,this._drawCount=C,function a$(e){const{xScale:t,yScale:n,_scaleRanges:i}=e,o={xmin:t.min,xmax:t.max,ymin:n.min,ymax:n.max};if(!i)return e._scaleRanges=o,!0;const a=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,o),a}(i)&&(y=0,C=a.length),o._chart=this.chart,o._datasetIndex=this.index,o._decimated=!!u._decimated,o.points=a;const T=this.resolveDatasetElementOptions(n);this.options.showLine||(T.borderWidth=0),T.segment=this.options.segment,this.updateElement(o,void 0,{animated:!m,options:T},n),this.updateElements(a,y,C,n)}updateElements(n,i,o,a){const u="reset"===a,{iScale:m,vScale:y,_stacked:C,_dataset:T}=this._cachedMeta,A=this.resolveDataElementOptions(i,a),z=this.getSharedOptions(A),V=this.includeOptions(a,z),H=m.axis,X=y.axis,{spanGaps:oe,segment:le}=this.options,we=Ey(oe)?oe:Number.POSITIVE_INFINITY,ve=this.chart._animationsDisabled||u||"none"===a;let Re=i>0&&this.getParsed(i-1);for(let Fe=i;Fe<i+o;++Fe){const lt=n[Fe],bt=this.getParsed(Fe),Rt=ve?lt:{},Ot=oi(bt[X]),mi=Rt[H]=m.getPixelForValue(bt[H],Fe),Zn=Rt[X]=u||Ot?y.getBasePixel():y.getPixelForValue(C?this.applyStack(y,bt,C):bt[X],Fe);Rt.skip=isNaN(mi)||isNaN(Zn)||Ot,Rt.stop=Fe>0&&Math.abs(bt[H]-Re[H])>we,le&&(Rt.parsed=bt,Rt.raw=T.data[Fe]),V&&(Rt.options=z||this.resolveDataElementOptions(Fe,lt.active?"active":a)),ve||this.updateElement(lt,Fe,Rt,a),Re=bt}this.updateSharedOptions(z,a,A)}getMaxOverflow(){const n=this._cachedMeta,i=n.dataset,o=i.options&&i.options.borderWidth||0,a=n.data||[];if(!a.length)return o;const u=a[0].size(this.resolveDataElementOptions(0)),m=a[a.length-1].size(this.resolveDataElementOptions(a.length-1));return Math.max(o,u,m)/2}draw(){const n=this._cachedMeta;n.dataset.updateControlPoints(this.chart.chartArea,n.iScale.axis),super.draw()}}return e.id="line",e.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},e.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}},e})();var l$=Object.freeze({__proto__:null,BarController:i$,BubbleController:r$,DoughnutController:rP,LineController:oP,PolarAreaController:(()=>{class e extends qu{constructor(n,i){super(n,i),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(n){const o=this.chart,a=o.data.labels||[],u=Oy(this._cachedMeta._parsed[n].r,o.options.locale);return{label:a[n]||"",value:u}}parseObjectData(n,i,o,a){return P2.bind(this)(n,i,o,a)}update(n){const i=this._cachedMeta.data;this._updateRadius(),this.updateElements(i,0,i.length,n)}getMinMax(){const i={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return this._cachedMeta.data.forEach((o,a)=>{const u=this.getParsed(a).r;!isNaN(u)&&this.chart.getDataVisibility(a)&&(u<i.min&&(i.min=u),u>i.max&&(i.max=u))}),i}_updateRadius(){const n=this.chart,i=n.chartArea,o=n.options,a=Math.min(i.right-i.left,i.bottom-i.top),u=Math.max(a/2,0),y=(u-Math.max(o.cutoutPercentage?u/100*o.cutoutPercentage:1,0))/n.getVisibleDatasetCount();this.outerRadius=u-y*this.index,this.innerRadius=this.outerRadius-y}updateElements(n,i,o,a){const u="reset"===a,m=this.chart,C=m.options.animation,T=this._cachedMeta.rScale,A=T.xCenter,z=T.yCenter,V=T.getIndexAngle(0)-.5*qi;let X,H=V;const oe=360/this.countVisibleElements();for(X=0;X<i;++X)H+=this._computeAngle(X,a,oe);for(X=i;X<i+o;X++){const le=n[X];let we=H,ve=H+this._computeAngle(X,a,oe),Re=m.getDataVisibility(X)?T.getDistanceFromCenterForValue(this.getParsed(X).r):0;H=ve,u&&(C.animateScale&&(Re=0),C.animateRotate&&(we=ve=V));const Fe={x:A,y:z,innerRadius:0,outerRadius:Re,startAngle:we,endAngle:ve,options:this.resolveDataElementOptions(X,le.active?"active":a)};this.updateElement(le,X,Fe,a)}}countVisibleElements(){let i=0;return this._cachedMeta.data.forEach((o,a)=>{!isNaN(this.getParsed(a).r)&&this.chart.getDataVisibility(a)&&i++}),i}_computeAngle(n,i,o){return this.chart.getDataVisibility(n)?Yl(this.resolveDataElementOptions(n,i).angle||o):0}}return e.id="polarArea",e.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},e.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:i}}=t.legend.options;return n.labels.map((o,a)=>{const m=t.getDatasetMeta(0).controller.getStyle(a);return{text:o,fillStyle:m.backgroundColor,strokeStyle:m.borderColor,lineWidth:m.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(a),index:a}})}return[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label:t=>t.chart.data.labels[t.dataIndex]+": "+t.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}},e})(),PieController:(()=>{class e extends rP{}return e.id="pie",e.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"},e})(),RadarController:(()=>{class e extends qu{getLabelAndValue(n){const i=this._cachedMeta.vScale,o=this.getParsed(n);return{label:i.getLabels()[n],value:""+i.getLabelForValue(o[i.axis])}}parseObjectData(n,i,o,a){return P2.bind(this)(n,i,o,a)}update(n){const i=this._cachedMeta,o=i.dataset,a=i.data||[],u=i.iScale.getLabels();if(o.points=a,"resize"!==n){const m=this.resolveDatasetElementOptions(n);this.options.showLine||(m.borderWidth=0),this.updateElement(o,void 0,{_loop:!0,_fullLoop:u.length===a.length,options:m},n)}this.updateElements(a,0,a.length,n)}updateElements(n,i,o,a){const u=this._cachedMeta.rScale,m="reset"===a;for(let y=i;y<i+o;y++){const C=n[y],T=this.resolveDataElementOptions(y,C.active?"active":a),A=u.getPointPositionForValue(y,this.getParsed(y).r),z=m?u.xCenter:A.x,V=m?u.yCenter:A.y,H={x:z,y:V,angle:A.angle,skip:isNaN(z)||isNaN(V),options:T};this.updateElement(C,y,H,a)}}}return e.id="radar",e.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},e.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}},e})(),ScatterController:(()=>{class e extends oP{}return e.id="scatter",e.defaults={showLine:!1,fill:!1},e.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:t=>"("+t.label+", "+t.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}},e})()});function mp(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var c$={_date:(()=>{class e{constructor(n){this.options=n||{}}formats(){return mp()}parse(n,i){return mp()}format(n,i){return mp()}add(n,i,o){return mp()}diff(n,i,o){return mp()}startOf(n,i,o){return mp()}endOf(n,i){return mp()}}return e.override=function(t){Object.assign(e.prototype,t)},e})()};function u$(e,t,n,i){const{controller:o,data:a,_sorted:u}=e,m=o._cachedMeta.iScale;if(m&&t===m.axis&&"r"!==t&&u&&a.length){const y=m._reversePixels?qU:Gu;if(!i)return y(a,t,n);if(o._sharedOptions){const C=a[0],T="function"==typeof C.getRange&&C.getRange(t);if(T){const A=y(a,t,n-T),z=y(a,t,n+T);return{lo:A.lo,hi:z.hi}}}}return{lo:0,hi:a.length-1}}function Fy(e,t,n,i,o){const a=e.getSortedVisibleDatasetMetas(),u=n[t];for(let m=0,y=a.length;m<y;++m){const{index:C,data:T}=a[m],{lo:A,hi:z}=u$(a[m],t,u,o);for(let V=A;V<=z;++V){const H=T[V];H.skip||i(H,C,V)}}}function OE(e,t,n,i,o){const a=[];return!o&&!e.isPointInArea(t)||Fy(e,n,t,function(m,y,C){!o&&!Py(m,e.chartArea,0)||m.inRange(t.x,t.y,i)&&a.push({element:m,datasetIndex:y,index:C})},!0),a}function LE(e,t,n,i,o,a){return a||e.isPointInArea(t)?"r"!==n||i?function f$(e,t,n,i,o,a){let u=[];const m=function h$(e){const t=-1!==e.indexOf("x"),n=-1!==e.indexOf("y");return function(i,o){const a=t?Math.abs(i.x-o.x):0,u=n?Math.abs(i.y-o.y):0;return Math.sqrt(Math.pow(a,2)+Math.pow(u,2))}}(n);let y=Number.POSITIVE_INFINITY;return Fy(e,n,t,function C(T,A,z){const V=T.inRange(t.x,t.y,o);if(i&&!V)return;const H=T.getCenterPoint(o);if(!a&&!e.isPointInArea(H)&&!V)return;const oe=m(t,H);oe<y?(u=[{element:T,datasetIndex:A,index:z}],y=oe):oe===y&&u.push({element:T,datasetIndex:A,index:z})}),u}(e,t,n,i,o,a):function d$(e,t,n,i){let o=[];return Fy(e,n,t,function a(u,m,y){const{startAngle:C,endAngle:T}=u.getProps(["startAngle","endAngle"],i),{angle:A}=a2(u,{x:t.x,y:t.y});Ty(A,C,T)&&o.push({element:u,datasetIndex:m,index:y})}),o}(e,t,n,o):[]}function sP(e,t,n,i,o){const a=[],u="x"===n?"inXRange":"inYRange";let m=!1;return Fy(e,n,t,(y,C,T)=>{y[u](t[n],o)&&(a.push({element:y,datasetIndex:C,index:T}),m=m||y.inRange(t.x,t.y,o))}),i&&!m?[]:a}var p$={evaluateInteractionItems:Fy,modes:{index(e,t,n,i){const o=fp(t,e),a=n.axis||"x",u=n.includeInvisible||!1,m=n.intersect?OE(e,o,a,i,u):LE(e,o,a,!1,i,u),y=[];return m.length?(e.getSortedVisibleDatasetMetas().forEach(C=>{const T=m[0].index,A=C.data[T];A&&!A.skip&&y.push({element:A,datasetIndex:C.index,index:T})}),y):[]},dataset(e,t,n,i){const o=fp(t,e),a=n.axis||"xy",u=n.includeInvisible||!1;let m=n.intersect?OE(e,o,a,i,u):LE(e,o,a,!1,i,u);if(m.length>0){const y=m[0].datasetIndex,C=e.getDatasetMeta(y).data;m=[];for(let T=0;T<C.length;++T)m.push({element:C[T],datasetIndex:y,index:T})}return m},point:(e,t,n,i)=>OE(e,fp(t,e),n.axis||"xy",i,n.includeInvisible||!1),nearest:(e,t,n,i)=>LE(e,fp(t,e),n.axis||"xy",n.intersect,i,n.includeInvisible||!1),x:(e,t,n,i)=>sP(e,fp(t,e),"x",n.intersect,i),y:(e,t,n,i)=>sP(e,fp(t,e),"y",n.intersect,i)}};const aP=["left","top","right","bottom"];function zy(e,t){return e.filter(n=>n.pos===t)}function lP(e,t){return e.filter(n=>-1===aP.indexOf(n.pos)&&n.box.axis===t)}function Ny(e,t){return e.sort((n,i)=>{const o=t?i:n,a=t?n:i;return o.weight===a.weight?o.index-a.index:o.weight-a.weight})}function cP(e,t,n,i){return Math.max(e[n],t[n])+Math.max(e[i],t[i])}function uP(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function v$(e,t,n,i){const{pos:o,box:a}=n,u=e.maxPadding;if(!$n(o)){n.size&&(e[o]-=n.size);const A=i[n.stack]||{size:0,count:1};A.size=Math.max(A.size,n.horizontal?a.height:a.width),n.size=A.size/A.count,e[o]+=n.size}a.getPadding&&uP(u,a.getPadding());const m=Math.max(0,t.outerWidth-cP(u,e,"left","right")),y=Math.max(0,t.outerHeight-cP(u,e,"top","bottom")),C=m!==e.w,T=y!==e.h;return e.w=m,e.h=y,n.horizontal?{same:C,other:T}:{same:T,other:C}}function b$(e,t){const n=t.maxPadding;return function i(o){const a={left:0,top:0,right:0,bottom:0};return o.forEach(u=>{a[u]=Math.max(t[u],n[u])}),a}(e?["left","right"]:["top","bottom"])}function By(e,t,n,i){const o=[];let a,u,m,y,C,T;for(a=0,u=e.length,C=0;a<u;++a){m=e[a],y=m.box,y.update(m.width||t.w,m.height||t.h,b$(m.horizontal,t));const{same:A,other:z}=v$(t,n,m,i);C|=A&&o.length,T=T||z,y.fullSize||o.push(m)}return C&&By(o,t,n,i)||T}function Eb(e,t,n,i,o){e.top=n,e.left=t,e.right=t+i,e.bottom=n+o,e.width=i,e.height=o}function hP(e,t,n,i){const o=n.padding;let{x:a,y:u}=t;for(const m of e){const y=m.box,C=i[m.stack]||{count:1,placed:0,weight:1},T=m.stackWeight/C.weight||1;if(m.horizontal){const A=t.w*T,z=C.size||y.height;rl(C.start)&&(u=C.start),y.fullSize?Eb(y,o.left,u,n.outerWidth-o.right-o.left,z):Eb(y,t.left+C.placed,u,A,z),C.start=u,C.placed+=A,u=y.bottom}else{const A=t.h*T,z=C.size||y.width;rl(C.start)&&(a=C.start),y.fullSize?Eb(y,a,o.top,z,n.outerHeight-o.bottom-o.top):Eb(y,a,t.top+C.placed,z,A),C.start=a,C.placed+=A,a=y.right}}t.x=a,t.y=u}Nn.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var es={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(n){t.draw(n)}}]},e.boxes.push(t)},removeBox(e,t){const n=e.boxes?e.boxes.indexOf(t):-1;-1!==n&&e.boxes.splice(n,1)},configure(e,t,n){t.fullSize=n.fullSize,t.position=n.position,t.weight=n.weight},update(e,t,n,i){if(!e)return;const o=Qo(e.options.layout.padding),a=Math.max(t-o.width,0),u=Math.max(n-o.height,0),m=function y$(e){const t=function m$(e){const t=[];let n,i,o,a,u,m;for(n=0,i=(e||[]).length;n<i;++n)o=e[n],({position:a,options:{stack:u,stackWeight:m=1}}=o),t.push({index:n,box:o,pos:a,horizontal:o.isHorizontal(),weight:o.weight,stack:u&&a+u,stackWeight:m});return t}(e),n=Ny(t.filter(C=>C.box.fullSize),!0),i=Ny(zy(t,"left"),!0),o=Ny(zy(t,"right")),a=Ny(zy(t,"top"),!0),u=Ny(zy(t,"bottom")),m=lP(t,"x"),y=lP(t,"y");return{fullSize:n,leftAndTop:i.concat(a),rightAndBottom:o.concat(y).concat(u).concat(m),chartArea:zy(t,"chartArea"),vertical:i.concat(o).concat(y),horizontal:a.concat(u).concat(m)}}(e.boxes),y=m.vertical,C=m.horizontal;pi(e.boxes,X=>{"function"==typeof X.beforeLayout&&X.beforeLayout()});const T=y.reduce((X,oe)=>oe.box.options&&!1===oe.box.options.display?X:X+1,0)||1,A=Object.freeze({outerWidth:t,outerHeight:n,padding:o,availableWidth:a,availableHeight:u,vBoxMaxWidth:a/2/T,hBoxMaxHeight:u/2}),z=Object.assign({},o);uP(z,Qo(i));const V=Object.assign({maxPadding:z,w:a,h:u,x:o.left,y:o.top},o),H=function _$(e,t){const n=function g$(e){const t={};for(const n of e){const{stack:i,pos:o,stackWeight:a}=n;if(!i||!aP.includes(o))continue;const u=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});u.count++,u.weight+=a}return t}(e),{vBoxMaxWidth:i,hBoxMaxHeight:o}=t;let a,u,m;for(a=0,u=e.length;a<u;++a){m=e[a];const{fullSize:y}=m.box,C=n[m.stack],T=C&&m.stackWeight/C.weight;m.horizontal?(m.width=T?T*i:y&&t.availableWidth,m.height=o):(m.width=i,m.height=T?T*o:y&&t.availableHeight)}return n}(y.concat(C),A);By(m.fullSize,V,A,H),By(y,V,A,H),By(C,V,A,H)&&By(y,V,A,H),function x$(e){const t=e.maxPadding;function n(i){const o=Math.max(t[i]-e[i],0);return e[i]+=o,o}e.y+=n("top"),e.x+=n("left"),n("right"),n("bottom")}(V),hP(m.leftAndTop,V,A,H),V.x+=V.w,V.y+=V.h,hP(m.rightAndBottom,V,A,H),e.chartArea={left:V.left,top:V.top,right:V.left+V.w,bottom:V.top+V.h,height:V.h,width:V.w},pi(m.chartArea,X=>{const oe=X.box;Object.assign(oe,e.chartArea),oe.update(V.w,V.h,{left:0,top:0,right:0,bottom:0})})}};class dP{acquireContext(t,n){}releaseContext(t){return!1}addEventListener(t,n,i){}removeEventListener(t,n,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,n,i,o){return n=Math.max(0,n||t.width),i=i||t.height,{width:n,height:Math.max(0,o?Math.floor(n/o):i)}}isAttached(t){return!0}updateConfig(t){}}class w$ extends dP{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Db="$chartjs",C$={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},fP=e=>null===e||""===e,pP=!!y4&&{passive:!0};function T$(e,t,n){e.canvas.removeEventListener(t,n,pP)}function Tb(e,t){for(const n of e)if(n===t||n.contains(t))return!0}function M$(e,t,n){const i=e.canvas,o=new MutationObserver(a=>{let u=!1;for(const m of a)u=u||Tb(m.addedNodes,i),u=u&&!Tb(m.removedNodes,i);u&&n()});return o.observe(document,{childList:!0,subtree:!0}),o}function I$(e,t,n){const i=e.canvas,o=new MutationObserver(a=>{let u=!1;for(const m of a)u=u||Tb(m.removedNodes,i),u=u&&!Tb(m.addedNodes,i);u&&n()});return o.observe(document,{childList:!0,subtree:!0}),o}const Vy=new Map;let mP=0;function gP(){const e=window.devicePixelRatio;e!==mP&&(mP=e,Vy.forEach((t,n)=>{n.currentDevicePixelRatio!==e&&t()}))}function k$(e,t,n){const i=e.canvas,o=i&&IE(i);if(!o)return;const a=JA((m,y)=>{const C=o.clientWidth;n(m,y),C<o.clientWidth&&n()},window),u=new ResizeObserver(m=>{const y=m[0],C=y.contentRect.width,T=y.contentRect.height;0===C&&0===T||a(C,T)});return u.observe(o),function A$(e,t){Vy.size||window.addEventListener("resize",gP),Vy.set(e,t)}(e,a),u}function FE(e,t,n){n&&n.disconnect(),"resize"===t&&function P$(e){Vy.delete(e),Vy.size||window.removeEventListener("resize",gP)}(e)}function R$(e,t,n){const i=e.canvas,o=JA(a=>{null!==e.ctx&&n(function S$(e,t){const n=C$[e.type]||e.type,{x:i,y:o}=fp(e,t);return{type:n,chart:t,native:e,x:void 0!==i?i:null,y:void 0!==o?o:null}}(a,e))},e,a=>{const u=a[0];return[u,u.offsetX,u.offsetY]});return function D$(e,t,n){e.addEventListener(t,n,pP)}(i,t,o),o}class O$ extends dP{acquireContext(t,n){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(function E$(e,t){const n=e.style,i=e.getAttribute("height"),o=e.getAttribute("width");if(e[Db]={initial:{height:i,width:o,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",fP(o)){const a=L2(e,"width");void 0!==a&&(e.width=a)}if(fP(i))if(""===e.style.height)e.height=e.width/(t||2);else{const a=L2(e,"height");void 0!==a&&(e.height=a)}}(t,n),i):null}releaseContext(t){const n=t.canvas;if(!n[Db])return!1;const i=n[Db].initial;["height","width"].forEach(a=>{const u=i[a];oi(u)?n.removeAttribute(a):n.setAttribute(a,u)});const o=i.style||{};return Object.keys(o).forEach(a=>{n.style[a]=o[a]}),n.width=n.width,delete n[Db],!0}addEventListener(t,n,i){this.removeEventListener(t,n),(t.$proxies||(t.$proxies={}))[n]=({attach:M$,detach:I$,resize:k$}[n]||R$)(t,n,i)}removeEventListener(t,n){const i=t.$proxies||(t.$proxies={}),o=i[n];o&&(({attach:FE,detach:FE,resize:FE}[n]||T$)(t,n,o),i[n]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,n,i,o){return function _4(e,t,n,i){const o=Cb(e),a=dp(o,"margin"),u=wb(o.maxWidth,e,"clientWidth")||hb,m=wb(o.maxHeight,e,"clientHeight")||hb,y=function g4(e,t,n){let i,o;if(void 0===t||void 0===n){const a=IE(e);if(a){const u=a.getBoundingClientRect(),m=Cb(a),y=dp(m,"border","width"),C=dp(m,"padding");t=u.width-C.width-y.width,n=u.height-C.height-y.height,i=wb(m.maxWidth,a,"clientWidth"),o=wb(m.maxHeight,a,"clientHeight")}else t=e.clientWidth,n=e.clientHeight}return{width:t,height:n,maxWidth:i||hb,maxHeight:o||hb}}(e,t,n);let{width:C,height:T}=y;if("content-box"===o.boxSizing){const A=dp(o,"border","width"),z=dp(o,"padding");C-=z.width+A.width,T-=z.height+A.height}return C=Math.max(0,C-a.width),T=Math.max(0,i?Math.floor(C/i):T-a.height),C=AE(Math.min(C,u,y.maxWidth)),T=AE(Math.min(T,m,y.maxHeight)),C&&!T&&(T=AE(C/2)),{width:C,height:T}}(t,n,i,o)}isAttached(t){const n=IE(t);return!(!n||!n.isConnected)}}class Kl{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(t){const{x:n,y:i}=this.getProps(["x","y"],t);return{x:n,y:i}}hasValue(){return Ey(this.x)&&Ey(this.y)}getProps(t,n){const i=this.$animations;if(!n||!i)return this;const o={};return t.forEach(a=>{o[a]=i[a]&&i[a].active()?i[a]._to:this[a]}),o}}Kl.defaults={},Kl.defaultRoutes=void 0;const _P={values:e=>Ai(e)?e:""+e,numeric(e,t,n){if(0===e)return"0";const i=this.chart.options.locale;let o,a=e;if(n.length>1){const C=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(C<1e-4||C>1e15)&&(o="scientific"),a=function F$(e,t){let n=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(n)>=1&&e!==Math.floor(e)&&(n=e-Math.floor(e)),n}(e,n)}const u=ol(Math.abs(a)),m=Math.max(Math.min(-1*Math.floor(u),20),0),y={notation:o,minimumFractionDigits:m,maximumFractionDigits:m};return Object.assign(y,this.options.ticks.format),Oy(e,i,y)},logarithmic(e,t,n){if(0===e)return"0";const i=e/Math.pow(10,Math.floor(ol(e)));return 1===i||2===i||5===i?_P.numeric.call(this,e,t,n):""}};var Sb={formatters:_P};function Mb(e,t,n,i,o){const a=Dn(i,0),u=Math.min(Dn(o,e.length),e.length);let y,C,T,m=0;for(n=Math.ceil(n),o&&(y=o-i,n=y/Math.floor(y/n)),T=a;T<0;)m++,T=Math.round(a+m*n);for(C=Math.max(a,0);C<u;C++)C===T&&(t.push(e[C]),m++,T=Math.round(a+m*n))}Nn.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Sb.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),Nn.route("scale.ticks","color","","color"),Nn.route("scale.grid","color","","borderColor"),Nn.route("scale.grid","borderColor","","borderColor"),Nn.route("scale.title","color","","color"),Nn.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&"callback"!==e&&"parser"!==e,_indexable:e=>"borderDash"!==e&&"tickBorderDash"!==e}),Nn.describe("scales",{_fallback:"scale"}),Nn.describe("scale.ticks",{_scriptable:e=>"backdropPadding"!==e&&"callback"!==e,_indexable:e=>"backdropPadding"!==e});const $$=e=>"left"===e?"right":"right"===e?"left":e,yP=(e,t,n)=>"top"===t||"left"===t?e[t]+n:e[t]-n;function vP(e,t){const n=[],i=e.length/t,o=e.length;let a=0;for(;a<o;a+=i)n.push(e[Math.floor(a)]);return n}function H$(e,t,n){const i=e.ticks.length,o=Math.min(t,i-1),a=e._startPixel,u=e._endPixel,m=1e-6;let C,y=e.getPixelForTick(o);if(!(n&&(C=1===i?Math.max(y-a,u-y):0===t?(e.getPixelForTick(1)-y)/2:(y-e.getPixelForTick(o-1))/2,y+=o<t?C:-C,y<a-m||y>u+m)))return y}function jy(e){return e.drawTicks?e.tickLength:0}function xP(e,t){if(!e.display)return 0;const n=io(e.font,t),i=Qo(e.padding);return(Ai(e.text)?e.text.length:1)*n.lineHeight+i.height}function Z$(e,t,n){let i=dE(e);return(n&&"right"!==t||!n&&"right"===t)&&(i=$$(i)),i}class gp extends Kl{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,n){return t}getUserBounds(){let{_userMin:t,_userMax:n,_suggestedMin:i,_suggestedMax:o}=this;return t=il(t,Number.POSITIVE_INFINITY),n=il(n,Number.NEGATIVE_INFINITY),i=il(i,Number.POSITIVE_INFINITY),o=il(o,Number.NEGATIVE_INFINITY),{min:il(t,i),max:il(n,o),minDefined:Dr(t),maxDefined:Dr(n)}}getMinMax(t){let u,{min:n,max:i,minDefined:o,maxDefined:a}=this.getUserBounds();if(o&&a)return{min:n,max:i};const m=this.getMatchingVisibleMetas();for(let y=0,C=m.length;y<C;++y)u=m[y].controller.getMinMax(this,t),o||(n=Math.min(n,u.min)),a||(i=Math.max(i,u.max));return n=a&&n>i?i:n,i=o&&n>i?n:i,{min:il(n,il(i,n)),max:il(i,il(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Pi(this.options.beforeUpdate,[this])}update(t,n,i){const{beginAtZero:o,grace:a,ticks:u}=this.options,m=u.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=n,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function WU(e,t,n){const{min:i,max:o}=e,a=QA(t,(o-i)/2),u=(m,y)=>n&&0===m?0:m+y;return{min:u(i,-Math.abs(a)),max:u(o,a)}}(this,a,o),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const y=m<this.ticks.length;this._convertTicksToLabels(y?vP(this.ticks,m):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),u.display&&(u.autoSkip||"auto"===u.source)&&(this.ticks=function z$(e,t){const n=e.options.ticks,i=n.maxTicksLimit||function N$(e){const t=e.options.offset,n=e._tickSize();return Math.floor(Math.min(e._length/n+(t?0:1),e._maxLength/n))}(e),o=n.major.enabled?function V$(e){const t=[];let n,i;for(n=0,i=e.length;n<i;n++)e[n].major&&t.push(n);return t}(t):[],a=o.length,u=o[0],m=o[a-1],y=[];if(a>i)return function j$(e,t,n,i){let u,o=0,a=n[0];for(i=Math.ceil(i),u=0;u<e.length;u++)u===a&&(t.push(e[u]),o++,a=n[o*i])}(t,y,o,a/i),y;const C=function B$(e,t,n){const i=function U$(e){const t=e.length;let n,i;if(t<2)return!1;for(i=e[0],n=1;n<t;++n)if(e[n]-e[n-1]!==i)return!1;return i}(e),o=t.length/n;if(!i)return Math.max(o,1);const a=function cU(e){const t=[],n=Math.sqrt(e);let i;for(i=1;i<n;i++)e%i==0&&(t.push(i),t.push(e/i));return n===(0|n)&&t.push(n),t.sort((o,a)=>o-a).pop(),t}(i);for(let u=0,m=a.length-1;u<m;u++){const y=a[u];if(y>o)return y}return Math.max(o,1)}(o,t,i);if(a>0){let T,A;const z=a>1?Math.round((m-u)/(a-1)):null;for(Mb(t,y,C,oi(z)?0:u-z,u),T=0,A=a-1;T<A;T++)Mb(t,y,C,o[T],o[T+1]);return Mb(t,y,C,m,oi(z)?t.length:m+z),y}return Mb(t,y,C),y}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),y&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let n,i,t=this.options.reverse;this.isHorizontal()?(n=this.left,i=this.right):(n=this.top,i=this.bottom,t=!t),this._startPixel=n,this._endPixel=i,this._reversePixels=t,this._length=i-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Pi(this.options.afterUpdate,[this])}beforeSetDimensions(){Pi(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Pi(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),Pi(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Pi(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const n=this.options.ticks;let i,o,a;for(i=0,o=t.length;i<o;i++)a=t[i],a.label=Pi(n.callback,[a.value,i,t],this)}afterTickToLabelConversion(){Pi(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Pi(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,n=t.ticks,i=this.ticks.length,o=n.minRotation||0,a=n.maxRotation;let m,y,C,u=o;if(!this._isVisible()||!n.display||o>=a||i<=1||!this.isHorizontal())return void(this.labelRotation=o);const T=this._getLabelSizes(),A=T.widest.width,z=T.highest.height,V=yo(this.chart.width-A,0,this.maxWidth);m=t.offset?this.maxWidth/i:V/(i-1),A+6>m&&(m=V/(i-(t.offset?.5:1)),y=this.maxHeight-jy(t.grid)-n.padding-xP(t.title,this.chart.options.font),C=Math.sqrt(A*A+z*z),u=pE(Math.min(Math.asin(yo((T.highest.height+6)/m,-1,1)),Math.asin(yo(y/C,-1,1))-Math.asin(yo(z/C,-1,1)))),u=Math.max(o,Math.min(a,u))),this.labelRotation=u}afterCalculateLabelRotation(){Pi(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Pi(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:n,options:{ticks:i,title:o,grid:a}}=this,u=this._isVisible(),m=this.isHorizontal();if(u){const y=xP(o,n.options.font);if(m?(t.width=this.maxWidth,t.height=jy(a)+y):(t.height=this.maxHeight,t.width=jy(a)+y),i.display&&this.ticks.length){const{first:C,last:T,widest:A,highest:z}=this._getLabelSizes(),V=2*i.padding,H=Yl(this.labelRotation),X=Math.cos(H),oe=Math.sin(H);m?t.height=Math.min(this.maxHeight,t.height+(i.mirror?0:oe*A.width+X*z.height)+V):t.width=Math.min(this.maxWidth,t.width+(i.mirror?0:X*A.width+oe*z.height)+V),this._calculatePadding(C,T,oe,X)}}this._handleMargins(),m?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,n,i,o){const{ticks:{align:a,padding:u},position:m}=this.options,y=0!==this.labelRotation,C="top"!==m&&"x"===this.axis;if(this.isHorizontal()){const T=this.getPixelForTick(0)-this.left,A=this.right-this.getPixelForTick(this.ticks.length-1);let z=0,V=0;y?C?(z=o*t.width,V=i*n.height):(z=i*t.height,V=o*n.width):"start"===a?V=n.width:"end"===a?z=t.width:"inner"!==a&&(z=t.width/2,V=n.width/2),this.paddingLeft=Math.max((z-T+u)*this.width/(this.width-T),0),this.paddingRight=Math.max((V-A+u)*this.width/(this.width-A),0)}else{let T=n.height/2,A=t.height/2;"start"===a?(T=0,A=t.height):"end"===a&&(T=n.height,A=0),this.paddingTop=T+u,this.paddingBottom=A+u}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Pi(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:n}=this.options;return"top"===n||"bottom"===n||"x"===t}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){let n,i;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),n=0,i=t.length;n<i;n++)oi(t[n].label)&&(t.splice(n,1),i--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const n=this.options.ticks.sampleSize;let i=this.ticks;n<i.length&&(i=vP(i,n)),this._labelSizes=t=this._computeLabelSizes(i,i.length)}return t}_computeLabelSizes(t,n){const{ctx:i,_longestTextCache:o}=this,a=[],u=[];let C,T,A,z,V,H,X,oe,le,we,ve,m=0,y=0;for(C=0;C<n;++C){if(z=t[C].label,V=this._resolveTickFontOptions(C),i.font=H=V.string,X=o[H]=o[H]||{data:{},gc:[]},oe=V.lineHeight,le=we=0,oi(z)||Ai(z)){if(Ai(z))for(T=0,A=z.length;T<A;++T)ve=z[T],!oi(ve)&&!Ai(ve)&&(le=_b(i,X.data,X.gc,le,ve),we+=oe)}else le=_b(i,X.data,X.gc,le,z),we=oe;a.push(le),u.push(we),m=Math.max(le,m),y=Math.max(we,y)}!function G$(e,t){pi(e,n=>{const i=n.gc,o=i.length/2;let a;if(o>t){for(a=0;a<o;++a)delete n.data[i[a]];i.splice(0,o)}})}(o,n);const Re=a.indexOf(m),Fe=u.indexOf(y),lt=bt=>({width:a[bt]||0,height:u[bt]||0});return{first:lt(0),last:lt(n-1),widest:lt(Re),highest:lt(Fe),widths:a,heights:u}}getLabelForValue(t){return t}getPixelForValue(t,n){return NaN}getValueForPixel(t){}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const n=this._startPixel+t*this._length;return function dU(e){return yo(e,-32768,32767)}(this._alignToPixels?cp(this.chart,n,0):n)}getDecimalForPixel(t){const n=(t-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:n}=this;return t<0&&n<0?n:t>0&&n>0?t:0}getContext(t){const n=this.ticks||[];if(t>=0&&t<n.length){const i=n[t];return i.$context||(i.$context=function q$(e,t,n){return Md(e,{tick:n,index:t,type:"tick"})}(this.getContext(),t,i))}return this.$context||(this.$context=function W$(e,t){return Md(e,{scale:t,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,n=Yl(this.labelRotation),i=Math.abs(Math.cos(n)),o=Math.abs(Math.sin(n)),a=this._getLabelSizes(),u=t.autoSkipPadding||0,m=a?a.widest.width+u:0,y=a?a.highest.height+u:0;return this.isHorizontal()?y*i>m*o?m/i:y/o:y*o<m*i?y/i:m/o}_isVisible(){const t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const n=this.axis,i=this.chart,o=this.options,{grid:a,position:u}=o,m=a.offset,y=this.isHorizontal(),T=this.ticks.length+(m?1:0),A=jy(a),z=[],V=a.setContext(this.getContext()),H=V.drawBorder?V.borderWidth:0,X=H/2,oe=function(kn){return cp(i,kn,H)};let le,we,ve,Re,Fe,lt,bt,Rt,Ot,mi,Zn,Xn;if("top"===u)le=oe(this.bottom),lt=this.bottom-A,Rt=le-X,mi=oe(t.top)+X,Xn=t.bottom;else if("bottom"===u)le=oe(this.top),mi=t.top,Xn=oe(t.bottom)-X,lt=le+X,Rt=this.top+A;else if("left"===u)le=oe(this.right),Fe=this.right-A,bt=le-X,Ot=oe(t.left)+X,Zn=t.right;else if("right"===u)le=oe(this.left),Ot=t.left,Zn=oe(t.right)-X,Fe=le+X,bt=this.left+A;else if("x"===n){if("center"===u)le=oe((t.top+t.bottom)/2+.5);else if($n(u)){const kn=Object.keys(u)[0];le=oe(this.chart.scales[kn].getPixelForValue(u[kn]))}mi=t.top,Xn=t.bottom,lt=le+X,Rt=lt+A}else if("y"===n){if("center"===u)le=oe((t.left+t.right)/2);else if($n(u)){const kn=Object.keys(u)[0];le=oe(this.chart.scales[kn].getPixelForValue(u[kn]))}Fe=le-X,bt=Fe-A,Ot=t.left,Zn=t.right}const jr=Dn(o.ticks.maxTicksLimit,T),Es=Math.max(1,Math.ceil(T/jr));for(we=0;we<T;we+=Es){const kn=a.setContext(this.getContext(we)),Di=kn.lineWidth,tv=kn.color,bp=a.borderDash||[],nv=kn.borderDashOffset,pg=kn.tickWidth,a1=kn.tickColor,mg=kn.tickBorderDash||[],iv=kn.tickBorderDashOffset;ve=H$(this,we,m),void 0!==ve&&(Re=cp(i,ve,Di),y?Fe=bt=Ot=Zn=Re:lt=Rt=mi=Xn=Re,z.push({tx1:Fe,ty1:lt,tx2:bt,ty2:Rt,x1:Ot,y1:mi,x2:Zn,y2:Xn,width:Di,color:tv,borderDash:bp,borderDashOffset:nv,tickWidth:pg,tickColor:a1,tickBorderDash:mg,tickBorderDashOffset:iv}))}return this._ticksLength=T,this._borderValue=le,z}_computeLabelItems(t){const n=this.axis,i=this.options,{position:o,ticks:a}=i,u=this.isHorizontal(),m=this.ticks,{align:y,crossAlign:C,padding:T,mirror:A}=a,z=jy(i.grid),V=z+T,H=A?-T:V,X=-Yl(this.labelRotation),oe=[];let le,we,ve,Re,Fe,lt,bt,Rt,Ot,mi,Zn,Xn,jr="middle";if("top"===o)lt=this.bottom-H,bt=this._getXAxisLabelAlignment();else if("bottom"===o)lt=this.top+H,bt=this._getXAxisLabelAlignment();else if("left"===o){const kn=this._getYAxisLabelAlignment(z);bt=kn.textAlign,Fe=kn.x}else if("right"===o){const kn=this._getYAxisLabelAlignment(z);bt=kn.textAlign,Fe=kn.x}else if("x"===n){if("center"===o)lt=(t.top+t.bottom)/2+V;else if($n(o)){const kn=Object.keys(o)[0];lt=this.chart.scales[kn].getPixelForValue(o[kn])+V}bt=this._getXAxisLabelAlignment()}else if("y"===n){if("center"===o)Fe=(t.left+t.right)/2-V;else if($n(o)){const kn=Object.keys(o)[0];Fe=this.chart.scales[kn].getPixelForValue(o[kn])}bt=this._getYAxisLabelAlignment(z).textAlign}"y"===n&&("start"===y?jr="top":"end"===y&&(jr="bottom"));const Es=this._getLabelSizes();for(le=0,we=m.length;le<we;++le){ve=m[le],Re=ve.label;const kn=a.setContext(this.getContext(le));Rt=this.getPixelForTick(le)+a.labelOffset,Ot=this._resolveTickFontOptions(le),mi=Ot.lineHeight,Zn=Ai(Re)?Re.length:1;const Di=Zn/2,tv=kn.color,bp=kn.textStrokeColor,nv=kn.textStrokeWidth;let a1,pg=bt;if(u?(Fe=Rt,"inner"===bt&&(pg=le===we-1?this.options.reverse?"left":"right":0===le?this.options.reverse?"right":"left":"center"),Xn="top"===o?"near"===C||0!==X?-Zn*mi+mi/2:"center"===C?-Es.highest.height/2-Di*mi+mi:mi/2-Es.highest.height:"near"===C||0!==X?mi/2:"center"===C?Es.highest.height/2-Di*mi:Es.highest.height-Zn*mi,A&&(Xn*=-1)):(lt=Rt,Xn=(1-Zn)*mi/2),kn.showLabelBackdrop){const mg=Qo(kn.backdropPadding),iv=Es.heights[le],ID=Es.widths[le];let AD=lt+Xn-mg.top,PD=Fe-mg.left;switch(jr){case"middle":AD-=iv/2;break;case"bottom":AD-=iv}switch(bt){case"center":PD-=ID/2;break;case"right":PD-=ID}a1={left:PD,top:AD,width:ID+mg.width,height:iv+mg.height,color:kn.backdropColor}}oe.push({rotation:X,label:Re,font:Ot,color:tv,strokeColor:bp,strokeWidth:nv,textOffset:Xn,textAlign:pg,textBaseline:jr,translation:[Fe,lt],backdrop:a1})}return oe}_getXAxisLabelAlignment(){const{position:t,ticks:n}=this.options;if(-Yl(this.labelRotation))return"top"===t?"left":"right";let o="center";return"start"===n.align?o="left":"end"===n.align?o="right":"inner"===n.align&&(o="inner"),o}_getYAxisLabelAlignment(t){const{position:n,ticks:{crossAlign:i,mirror:o,padding:a}}=this.options,m=t+a,y=this._getLabelSizes().widest.width;let C,T;return"left"===n?o?(T=this.right+a,"near"===i?C="left":"center"===i?(C="center",T+=y/2):(C="right",T+=y)):(T=this.right-m,"near"===i?C="right":"center"===i?(C="center",T-=y/2):(C="left",T=this.left)):"right"===n?o?(T=this.left+a,"near"===i?C="right":"center"===i?(C="center",T-=y/2):(C="left",T-=y)):(T=this.left+m,"near"===i?C="left":"center"===i?(C="center",T+=y/2):(C="right",T=this.right)):C="right",{textAlign:C,x:T}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,n=this.options.position;return"left"===n||"right"===n?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===n||"bottom"===n?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}drawBackground(){const{ctx:t,options:{backgroundColor:n},left:i,top:o,width:a,height:u}=this;n&&(t.save(),t.fillStyle=n,t.fillRect(i,o,a,u),t.restore())}getLineWidthForValue(t){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const o=this.ticks.findIndex(a=>a.value===t);return o>=0?n.setContext(this.getContext(o)).lineWidth:0}drawGrid(t){const n=this.options.grid,i=this.ctx,o=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let a,u;const m=(y,C,T)=>{!T.width||!T.color||(i.save(),i.lineWidth=T.width,i.strokeStyle=T.color,i.setLineDash(T.borderDash||[]),i.lineDashOffset=T.borderDashOffset,i.beginPath(),i.moveTo(y.x,y.y),i.lineTo(C.x,C.y),i.stroke(),i.restore())};if(n.display)for(a=0,u=o.length;a<u;++a){const y=o[a];n.drawOnChartArea&&m({x:y.x1,y:y.y1},{x:y.x2,y:y.y2},y),n.drawTicks&&m({x:y.tx1,y:y.ty1},{x:y.tx2,y:y.ty2},{color:y.tickColor,width:y.tickWidth,borderDash:y.tickBorderDash,borderDashOffset:y.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:n,options:{grid:i}}=this,o=i.setContext(this.getContext()),a=i.drawBorder?o.borderWidth:0;if(!a)return;const u=i.setContext(this.getContext(0)).lineWidth,m=this._borderValue;let y,C,T,A;this.isHorizontal()?(y=cp(t,this.left,a)-a/2,C=cp(t,this.right,u)+u/2,T=A=m):(T=cp(t,this.top,a)-a/2,A=cp(t,this.bottom,u)+u/2,y=C=m),n.save(),n.lineWidth=o.borderWidth,n.strokeStyle=o.borderColor,n.beginPath(),n.moveTo(y,T),n.lineTo(C,A),n.stroke(),n.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,o=this._computeLabelArea();o&&vb(i,o);const a=this._labelItems||(this._labelItems=this._computeLabelItems(t));let u,m;for(u=0,m=a.length;u<m;++u){const y=a[u],C=y.font,T=y.label;y.backdrop&&(i.fillStyle=y.backdrop.color,i.fillRect(y.backdrop.left,y.backdrop.top,y.backdrop.width,y.backdrop.height)),up(i,T,0,y.textOffset,C,y)}o&&xb(i)}drawTitle(){const{ctx:t,options:{position:n,title:i,reverse:o}}=this;if(!i.display)return;const a=io(i.font),u=Qo(i.padding),m=i.align;let y=a.lineHeight/2;"bottom"===n||"center"===n||$n(n)?(y+=u.bottom,Ai(i.text)&&(y+=a.lineHeight*(i.text.length-1))):y+=u.top;const{titleX:C,titleY:T,maxWidth:A,rotation:z}=function X$(e,t,n,i){const{top:o,left:a,bottom:u,right:m,chart:y}=e,{chartArea:C,scales:T}=y;let z,V,H,A=0;const X=u-o,oe=m-a;if(e.isHorizontal()){if(V=Jo(i,a,m),$n(n)){const le=Object.keys(n)[0];H=T[le].getPixelForValue(n[le])+X-t}else H="center"===n?(C.bottom+C.top)/2+X-t:yP(e,n,t);z=m-a}else{if($n(n)){const le=Object.keys(n)[0];V=T[le].getPixelForValue(n[le])-oe+t}else V="center"===n?(C.left+C.right)/2-oe+t:yP(e,n,t);H=Jo(i,u,o),A="left"===n?-pr:pr}return{titleX:V,titleY:H,maxWidth:z,rotation:A}}(this,y,n,m);up(t,i.text,0,0,a,{color:i.color,maxWidth:A,rotation:z,textAlign:Z$(m,n,o),textBaseline:"middle",translation:[C,T]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,n=t.ticks&&t.ticks.z||0,i=Dn(t.grid&&t.grid.z,-1);return this._isVisible()&&this.draw===gp.prototype.draw?[{z:i,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:i+1,draw:()=>{this.drawBorder()}},{z:n,draw:o=>{this.drawLabels(o)}}]:[{z:n,draw:o=>{this.draw(o)}}]}getMatchingVisibleMetas(t){const n=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",o=[];let a,u;for(a=0,u=n.length;a<u;++a){const m=n[a];m[i]===this.id&&(!t||m.type===t)&&o.push(m)}return o}_resolveTickFontOptions(t){return io(this.options.ticks.setContext(this.getContext(t)).font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Ib{constructor(t,n,i){this.type=t,this.scope=n,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const n=Object.getPrototypeOf(t);let i;(function J$(e){return"id"in e&&"defaults"in e})(n)&&(i=this.register(n));const o=this.items,a=t.id,u=this.scope+"."+a;if(!a)throw new Error("class does not have id: "+t);return a in o||(o[a]=t,function Y$(e,t,n){const i=by(Object.create(null),[n?Nn.get(n):{},Nn.get(t),e.defaults]);Nn.set(t,i),e.defaultRoutes&&function K$(e,t){Object.keys(t).forEach(n=>{const i=n.split("."),o=i.pop(),a=[e].concat(i).join("."),u=t[n].split("."),m=u.pop(),y=u.join(".");Nn.route(a,o,y,m)})}(t,e.defaultRoutes),e.descriptors&&Nn.describe(t,e.descriptors)}(t,u,i),this.override&&Nn.override(t.id,t.overrides)),u}get(t){return this.items[t]}unregister(t){const n=this.items,i=t.id,o=this.scope;i in n&&delete n[i],o&&i in Nn[o]&&(delete Nn[o][i],this.override&&delete lp[i])}}var Zu=new class Q${constructor(){this.controllers=new Ib(qu,"datasets",!0),this.elements=new Ib(Kl,"elements"),this.plugins=new Ib(Object,"plugins"),this.scales=new Ib(gp,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,n,i){[...n].forEach(o=>{const a=i||this._getRegistryForType(o);i||a.isForType(o)||a===this.plugins&&o.id?this._exec(t,a,o):pi(o,u=>{const m=i||this._getRegistryForType(u);this._exec(t,m,u)})})}_exec(t,n,i){const o=fE(t);Pi(i["before"+o],[],i),n[t](i),Pi(i["after"+o],[],i)}_getRegistryForType(t){for(let n=0;n<this._typedRegistries.length;n++){const i=this._typedRegistries[n];if(i.isForType(t))return i}return this.plugins}_get(t,n,i){const o=n.get(t);if(void 0===o)throw new Error('"'+t+'" is not a registered '+i+".");return o}};class e6{constructor(){this._init=[]}notify(t,n,i,o){"beforeInit"===n&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const a=o?this._descriptors(t).filter(o):this._descriptors(t),u=this._notify(a,t,n,i);return"afterDestroy"===n&&(this._notify(a,t,"stop"),this._notify(this._init,t,"uninstall")),u}_notify(t,n,i,o){o=o||{};for(const a of t){const u=a.plugin;if(!1===Pi(u[i],[n,o,a.options],u)&&o.cancelable)return!1}return!0}invalidate(){oi(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),n}_createDescriptors(t,n){const i=t&&t.config,o=Dn(i.options&&i.options.plugins,{}),a=function t6(e){const t=[],n=Object.keys(Zu.plugins.items);for(let o=0;o<n.length;o++)t.push(Zu.getPlugin(n[o]));const i=e.plugins||[];for(let o=0;o<i.length;o++){const a=i[o];-1===t.indexOf(a)&&t.push(a)}return t}(i);return!1!==o||n?function i6(e,t,n,i){const o=[],a=e.getContext();for(let u=0;u<t.length;u++){const m=t[u],C=n6(n[m.id],i);null!==C&&o.push({plugin:m,options:r6(e.config,m,C,a)})}return o}(t,a,o,n):[]}_notifyStateChanges(t){const n=this._oldCache||[],i=this._cache,o=(a,u)=>a.filter(m=>!u.some(y=>m.plugin.id===y.plugin.id));this._notify(o(n,i),t,"stop"),this._notify(o(i,n),t,"start")}}function n6(e,t){return t||!1!==e?!0===e?{}:e:null}function r6(e,t,n,i){const o=e.pluginScopeKeys(t),a=e.getOptionScopes(n,o);return e.createResolver(a,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function zE(e,t){return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||(Nn.datasets[e]||{}).indexAxis||"x"}function NE(e,t){return"x"===e||"y"===e?e:t.axis||function a6(e){return"top"===e||"bottom"===e?"x":"left"===e||"right"===e?"y":void 0}(t.position)||e.charAt(0).toLowerCase()}function bP(e){const t=e.options||(e.options={});t.plugins=Dn(t.plugins,{}),t.scales=function l6(e,t){const n=lp[e.type]||{scales:{}},i=t.scales||{},o=zE(e.type,t),a=Object.create(null),u=Object.create(null);return Object.keys(i).forEach(m=>{const y=i[m];if(!$n(y))return console.error(`Invalid scale configuration for scale: ${m}`);if(y._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${m}`);const C=NE(m,y),T=function s6(e,t){return e===t?"_index_":"_value_"}(C,o),A=n.scales||{};a[C]=a[C]||m,u[m]=wy(Object.create(null),[{axis:C},y,A[C],A[T]])}),e.data.datasets.forEach(m=>{const y=m.type||e.type,C=m.indexAxis||zE(y,t),A=(lp[y]||{}).scales||{};Object.keys(A).forEach(z=>{const V=function o6(e,t){let n=e;return"_index_"===e?n=t:"_value_"===e&&(n="x"===t?"y":"x"),n}(z,C),H=m[V+"AxisID"]||a[V]||V;u[H]=u[H]||Object.create(null),wy(u[H],[{axis:V},i[H],A[z]])})}),Object.keys(u).forEach(m=>{const y=u[m];wy(y,[Nn.scales[y.type],Nn.scale])}),u}(e,t)}function wP(e){return(e=e||{}).datasets=e.datasets||[],e.labels=e.labels||[],e}const CP=new Map,EP=new Set;function Ab(e,t){let n=CP.get(e);return n||(n=t(),CP.set(e,n),EP.add(n)),n}const Uy=(e,t,n)=>{const i=Ed(t,n);void 0!==i&&e.add(i)};class u6{constructor(t){this._config=function c6(e){return(e=e||{}).data=wP(e.data),bP(e),e}(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=wP(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),bP(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Ab(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,n){return Ab(`${t}.transition.${n}`,()=>[[`datasets.${t}.transitions.${n}`,`transitions.${n}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,n){return Ab(`${t}-${n}`,()=>[[`datasets.${t}.elements.${n}`,`datasets.${t}`,`elements.${n}`,""]])}pluginScopeKeys(t){const n=t.id;return Ab(`${this.type}-plugin-${n}`,()=>[[`plugins.${n}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,n){const i=this._scopeCache;let o=i.get(t);return(!o||n)&&(o=new Map,i.set(t,o)),o}getOptionScopes(t,n,i){const{options:o,type:a}=this,u=this._cachedScopes(t,i),m=u.get(n);if(m)return m;const y=new Set;n.forEach(T=>{t&&(y.add(t),T.forEach(A=>Uy(y,t,A))),T.forEach(A=>Uy(y,o,A)),T.forEach(A=>Uy(y,lp[a]||{},A)),T.forEach(A=>Uy(y,Nn,A)),T.forEach(A=>Uy(y,wE,A))});const C=Array.from(y);return 0===C.length&&C.push(Object.create(null)),EP.has(n)&&u.set(n,C),C}chartOptionScopes(){const{options:t,type:n}=this;return[t,lp[n]||{},Nn.datasets[n]||{},{type:n},Nn,wE]}resolveNamedOptions(t,n,i,o=[""]){const a={$shared:!0},{resolver:u,subPrefixes:m}=DP(this._resolverCache,t,o);let y=u;(function d6(e,t){const{isScriptable:n,isIndexable:i}=D2(e);for(const o of t){const a=n(o),u=i(o),m=(u||a)&&e[o];if(a&&(Dd(m)||h6(m))||u&&Ai(m))return!0}return!1})(u,n)&&(a.$shared=!1,y=ng(u,i=Dd(i)?i():i,this.createResolver(t,i,m)));for(const C of n)a[C]=y[C];return a}createResolver(t,n,i=[""],o){const{resolver:a}=DP(this._resolverCache,t,i);return $n(n)?ng(a,n,void 0,o):a}}function DP(e,t,n){let i=e.get(t);i||(i=new Map,e.set(t,i));const o=n.join();let a=i.get(o);return a||(a={resolver:TE(t,n),subPrefixes:n.filter(m=>!m.toLowerCase().includes("hover"))},i.set(o,a)),a}const h6=e=>$n(e)&&Object.getOwnPropertyNames(e).reduce((t,n)=>t||Dd(e[n]),!1),p6=["top","bottom","left","right","chartArea"];function TP(e,t){return"top"===e||"bottom"===e||-1===p6.indexOf(e)&&"x"===t}function SP(e,t){return function(n,i){return n[e]===i[e]?n[t]-i[t]:n[e]-i[e]}}function MP(e){const t=e.chart,n=t.options.animation;t.notifyPlugins("afterRender"),Pi(n&&n.onComplete,[e],t)}function m6(e){const t=e.chart,n=t.options.animation;Pi(n&&n.onProgress,[e],t)}function IP(e){return R2()&&"string"==typeof e?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const Pb={},AP=e=>{const t=IP(e);return Object.values(Pb).filter(n=>n.canvas===t).pop()};function g6(e,t,n){const i=Object.keys(e);for(const o of i){const a=+o;if(a>=t){const u=e[o];delete e[o],(n>0||a>t)&&(e[a+n]=u)}}}class og{constructor(t,n){const i=this.config=new u6(n),o=IP(t),a=AP(o);if(a)throw new Error("Canvas is already in use. Chart with ID '"+a.id+"' must be destroyed before the canvas can be reused.");const u=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||function L$(e){return!R2()||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas?w$:O$}(o)),this.platform.updateConfig(i);const m=this.platform.acquireContext(o,u.aspectRatio),y=m&&m.canvas,C=y&&y.height,T=y&&y.width;this.id=eU(),this.ctx=m,this.canvas=y,this.width=T,this.height=C,this._options=u,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new e6,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function J5(e,t){let n;return function(...i){return t?(clearTimeout(n),n=setTimeout(e,t,i)):e.apply(this,i),t}}(A=>this.update(A),u.resizeDelay||0),this._dataChanges=[],Pb[this.id]=this,m&&y?(Wu.listen(this,"complete",MP),Wu.listen(this,"progress",m6),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:n},width:i,height:o,_aspectRatio:a}=this;return oi(t)?n&&a?a:o?i/o:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():O2(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return x2(this.canvas,this.ctx),this}stop(){return Wu.stop(this),this}resize(t,n){Wu.running(this)?this._resizeBeforeDraw={width:t,height:n}:this._resize(t,n)}_resize(t,n){const i=this.options,u=this.platform.getMaximumSize(this.canvas,t,n,i.maintainAspectRatio&&this.aspectRatio),m=i.devicePixelRatio||this.platform.getDevicePixelRatio(),y=this.width?"resize":"attach";this.width=u.width,this.height=u.height,this._aspectRatio=this.aspectRatio,O2(this,m,!0)&&(this.notifyPlugins("resize",{size:u}),Pi(i.onResize,[this,u],this),this.attached&&this._doResize(y)&&this.render())}ensureScalesHaveIDs(){pi(this.options.scales||{},(i,o)=>{i.id=o})}buildOrUpdateScales(){const t=this.options,n=t.scales,i=this.scales,o=Object.keys(i).reduce((u,m)=>(u[m]=!1,u),{});let a=[];n&&(a=a.concat(Object.keys(n).map(u=>{const m=n[u],y=NE(u,m),C="r"===y,T="x"===y;return{options:m,dposition:C?"chartArea":T?"bottom":"left",dtype:C?"radialLinear":T?"category":"linear"}}))),pi(a,u=>{const m=u.options,y=m.id,C=NE(y,m),T=Dn(m.type,u.dtype);(void 0===m.position||TP(m.position,C)!==TP(u.dposition))&&(m.position=u.dposition),o[y]=!0;let A=null;y in i&&i[y].type===T?A=i[y]:(A=new(Zu.getScale(T))({id:y,type:T,ctx:this.ctx,chart:this}),i[A.id]=A),A.init(m,t)}),pi(o,(u,m)=>{u||delete i[m]}),pi(i,u=>{es.configure(this,u,u.options),es.addBox(this,u)})}_updateMetasets(){const t=this._metasets,n=this.data.datasets.length,i=t.length;if(t.sort((o,a)=>o.index-a.index),i>n){for(let o=n;o<i;++o)this._destroyDatasetMeta(o);t.splice(n,i-n)}this._sortedMetasets=t.slice(0).sort(SP("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:n}}=this;t.length>n.length&&delete this._stacks,t.forEach((i,o)=>{0===n.filter(a=>a===i._dataset).length&&this._destroyDatasetMeta(o)})}buildOrUpdateControllers(){const t=[],n=this.data.datasets;let i,o;for(this._removeUnreferencedMetasets(),i=0,o=n.length;i<o;i++){const a=n[i];let u=this.getDatasetMeta(i);const m=a.type||this.config.type;if(u.type&&u.type!==m&&(this._destroyDatasetMeta(i),u=this.getDatasetMeta(i)),u.type=m,u.indexAxis=a.indexAxis||zE(m,this.options),u.order=a.order||0,u.index=i,u.label=""+a.label,u.visible=this.isDatasetVisible(i),u.controller)u.controller.updateIndex(i),u.controller.linkScales();else{const y=Zu.getController(m),{datasetElementType:C,dataElementType:T}=Nn.datasets[m];Object.assign(y.prototype,{dataElementType:Zu.getElement(T),datasetElementType:C&&Zu.getElement(C)}),u.controller=new y(this,i),t.push(u.controller)}}return this._updateMetasets(),t}_resetElements(){pi(this.data.datasets,(t,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const n=this.config;n.update();const i=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),o=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0}))return;const a=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let u=0;for(let C=0,T=this.data.datasets.length;C<T;C++){const{controller:A}=this.getDatasetMeta(C),z=!o&&-1===a.indexOf(A);A.buildOrUpdateElements(z),u=Math.max(+A.getMaxOverflow(),u)}u=this._minPadding=i.layout.autoPadding?u:0,this._updateLayout(u),o||pi(a,C=>{C.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(SP("z","_idx"));const{_active:m,_lastEvent:y}=this;y?this._eventHandler(y,!0):m.length&&this._updateHoverStyles(m,m,!0),this.render()}_updateScales(){pi(this.scales,t=>{es.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,n=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!n2(n,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,n=this._getUniformDataChanges()||[];for(const{method:i,start:o,count:a}of n)g6(t,o,"_removeElements"===i?-a:a)}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const n=this.data.datasets.length,i=a=>new Set(t.filter(u=>u[0]===a).map((u,m)=>m+","+u.splice(1).join(","))),o=i(0);for(let a=1;a<n;a++)if(!n2(o,i(a)))return;return Array.from(o).map(a=>a.split(",")).map(a=>({method:a[1],start:+a[2],count:+a[3]}))}_updateLayout(t){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;es.update(this,this.width,this.height,t);const n=this.chartArea,i=n.width<=0||n.height<=0;this._layers=[],pi(this.boxes,o=>{i&&"chartArea"===o.position||(o.configure&&o.configure(),this._layers.push(...o._layers()))},this),this._layers.forEach((o,a)=>{o._idx=a}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(let n=0,i=this.data.datasets.length;n<i;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,i=this.data.datasets.length;n<i;++n)this._updateDataset(n,Dd(t)?t({datasetIndex:n}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,n){const i=this.getDatasetMeta(t),o={meta:i,index:t,mode:n,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",o)&&(i.controller._update(n),o.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",o))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(Wu.has(this)?this.attached&&!Wu.running(this)&&Wu.start(this):(this.draw(),MP({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:o}=this._resizeBeforeDraw;this._resize(i,o),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const n=this._layers;for(t=0;t<n.length&&n[t].z<=0;++t)n[t].draw(this.chartArea);for(this._drawDatasets();t<n.length;++t)n[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const n=this._sortedMetasets,i=[];let o,a;for(o=0,a=n.length;o<a;++o){const u=n[o];(!t||u.visible)&&i.push(u)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const t=this.getSortedVisibleDatasetMetas();for(let n=t.length-1;n>=0;--n)this._drawDataset(t[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const n=this.ctx,i=t._clip,o=!i.disabled,a=this.chartArea,u={meta:t,index:t.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",u)&&(o&&vb(n,{left:!1===i.left?0:a.left-i.left,right:!1===i.right?this.width:a.right+i.right,top:!1===i.top?0:a.top-i.top,bottom:!1===i.bottom?this.height:a.bottom+i.bottom}),t.controller.draw(),o&&xb(n),u.cancelable=!1,this.notifyPlugins("afterDatasetDraw",u))}isPointInArea(t){return Py(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,n,i,o){const a=p$.modes[n];return"function"==typeof a?a(this,t,i,o):[]}getDatasetMeta(t){const n=this.data.datasets[t],i=this._metasets;let o=i.filter(a=>a&&a._dataset===n).pop();return o||(o={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:t,_dataset:n,_parsed:[],_sorted:!1},i.push(o)),o}getContext(){return this.$context||(this.$context=Md(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const n=this.data.datasets[t];if(!n)return!1;const i=this.getDatasetMeta(t);return"boolean"==typeof i.hidden?!i.hidden:!n.hidden}setDatasetVisibility(t,n){this.getDatasetMeta(t).hidden=!n}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,n,i){const o=i?"show":"hide",a=this.getDatasetMeta(t),u=a.controller._resolveAnimations(void 0,o);rl(n)?(a.data[n].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),u.update(a,{visible:i}),this.update(m=>m.datasetIndex===t?o:void 0))}hide(t,n){this._updateVisibility(t,n,!1)}show(t,n){this._updateVisibility(t,n,!0)}_destroyDatasetMeta(t){const n=this._metasets[t];n&&n.controller&&n.controller._destroy(),delete this._metasets[t]}_stop(){let t,n;for(this.stop(),Wu.remove(this),t=0,n=this.data.datasets.length;t<n;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:n}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),x2(t,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete Pb[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,n=this.platform,i=(a,u)=>{n.addEventListener(this,a,u),t[a]=u},o=(a,u,m)=>{a.offsetX=u,a.offsetY=m,this._eventHandler(a)};pi(this.options.events,a=>i(a,o))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,n=this.platform,i=(y,C)=>{n.addEventListener(this,y,C),t[y]=C},o=(y,C)=>{t[y]&&(n.removeEventListener(this,y,C),delete t[y])},a=(y,C)=>{this.canvas&&this.resize(y,C)};let u;const m=()=>{o("attach",m),this.attached=!0,this.resize(),i("resize",a),i("detach",u)};u=()=>{this.attached=!1,o("resize",a),this._stop(),this._resize(0,0),i("attach",m)},n.isAttached(this.canvas)?m():u()}unbindEvents(){pi(this._listeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._listeners={},pi(this._responsiveListeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,n,i){const o=i?"set":"remove";let a,u,m,y;for("dataset"===n&&(a=this.getDatasetMeta(t[0].datasetIndex),a.controller["_"+o+"DatasetHoverStyle"]()),m=0,y=t.length;m<y;++m){u=t[m];const C=u&&this.getDatasetMeta(u.datasetIndex).controller;C&&C[o+"HoverStyle"](u.element,u.datasetIndex,u.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const n=this._active||[],i=t.map(({datasetIndex:a,index:u})=>{const m=this.getDatasetMeta(a);if(!m)throw new Error("No dataset found at index "+a);return{datasetIndex:a,element:m.data[u],index:u}});!cb(i,n)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,n))}notifyPlugins(t,n,i){return this._plugins.notify(this,t,n,i)}_updateHoverStyles(t,n,i){const o=this.options.hover,a=(y,C)=>y.filter(T=>!C.some(A=>T.datasetIndex===A.datasetIndex&&T.index===A.index)),u=a(n,t),m=i?t:a(t,n);u.length&&this.updateHoverStyle(u,o.mode,!1),m.length&&o.mode&&this.updateHoverStyle(m,o.mode,!0)}_eventHandler(t,n){const i={event:t,replay:n,cancelable:!0,inChartArea:this.isPointInArea(t)},o=u=>(u.options.events||this.options.events).includes(t.native.type);if(!1===this.notifyPlugins("beforeEvent",i,o))return;const a=this._handleEvent(t,n,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,o),(a||i.changed)&&this.render(),this}_handleEvent(t,n,i){const{_active:o=[],options:a}=this,m=this._getActiveElements(t,o,i,n),y=function sU(e){return"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type}(t),C=function _6(e,t,n,i){return n&&"mouseout"!==e.type?i?t:e:null}(t,this._lastEvent,i,y);i&&(this._lastEvent=null,Pi(a.onHover,[t,m,this],this),y&&Pi(a.onClick,[t,m,this],this));const T=!cb(m,o);return(T||n)&&(this._active=m,this._updateHoverStyles(m,o,n)),this._lastEvent=C,T}_getActiveElements(t,n,i,o){if("mouseout"===t.type)return[];if(!i)return n;const a=this.options.hover;return this.getElementsAtEventForMode(t,a.mode,a,o)}}const PP=()=>pi(og.instances,e=>e._plugins.invalidate()),Id=!0;function kP(e,t,n){const{startAngle:i,pixelMargin:o,x:a,y:u,outerRadius:m,innerRadius:y}=t;let C=o/m;e.beginPath(),e.arc(a,u,m,i-C,n+C),y>o?(C=o/y,e.arc(a,u,y,n+C,i-C,!0)):e.arc(a,u,o,n+pr,i-pr),e.closePath(),e.clip()}function sg(e,t,n,i){return{x:n+e*Math.cos(t),y:i+e*Math.sin(t)}}function BE(e,t,n,i,o){const{x:a,y:u,startAngle:m,pixelMargin:y,innerRadius:C}=t,T=Math.max(t.outerRadius+i+n-y,0),A=C>0?C+i+n+y:0;let z=0;const V=o-m;if(i){const bp=((C>0?C-i:0)+(T>0?T-i:0))/2;z=(V-(0!==bp?V*bp/(bp+i):V))/2}const X=(V-Math.max(.001,V*T-n/qi)/T)/2,oe=m+X+z,le=o-X-z,{outerStart:we,outerEnd:ve,innerStart:Re,innerEnd:Fe}=function v6(e,t,n,i){const o=function y6(e){return EE(e,["outerStart","outerEnd","innerStart","innerEnd"])}(e.options.borderRadius),a=(n-t)/2,u=Math.min(a,i*t/2),m=y=>{const C=(n-Math.min(a,y))*i/2;return yo(y,0,Math.min(a,C))};return{outerStart:m(o.outerStart),outerEnd:m(o.outerEnd),innerStart:yo(o.innerStart,0,u),innerEnd:yo(o.innerEnd,0,u)}}(t,A,T,le-oe),lt=T-we,bt=T-ve,Rt=oe+we/lt,Ot=le-ve/bt,mi=A+Re,Zn=A+Fe,Xn=oe+Re/mi,jr=le-Fe/Zn;if(e.beginPath(),e.arc(a,u,T,Rt,Ot),ve>0){const Di=sg(bt,Ot,a,u);e.arc(Di.x,Di.y,ve,Ot,le+pr)}const Es=sg(Zn,le,a,u);if(e.lineTo(Es.x,Es.y),Fe>0){const Di=sg(Zn,jr,a,u);e.arc(Di.x,Di.y,Fe,le+pr,jr+Math.PI)}if(e.arc(a,u,A,le-Fe/A,oe+Re/A,!0),Re>0){const Di=sg(mi,Xn,a,u);e.arc(Di.x,Di.y,Re,Xn+Math.PI,oe-pr)}const kn=sg(lt,oe,a,u);if(e.lineTo(kn.x,kn.y),we>0){const Di=sg(lt,Rt,a,u);e.arc(Di.x,Di.y,we,oe-pr,Rt)}e.closePath()}Object.defineProperties(og,{defaults:{enumerable:Id,value:Nn},instances:{enumerable:Id,value:Pb},overrides:{enumerable:Id,value:lp},registry:{enumerable:Id,value:Zu},version:{enumerable:Id,value:"3.8.0"},getChart:{enumerable:Id,value:AP},register:{enumerable:Id,value:(...e)=>{Zu.add(...e),PP()}},unregister:{enumerable:Id,value:(...e)=>{Zu.remove(...e),PP()}}});class kb extends Kl{constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,n,i){const o=this.getProps(["x","y"],i),{angle:a,distance:u}=a2(o,{x:t,y:n}),{startAngle:m,endAngle:y,innerRadius:C,outerRadius:T,circumference:A}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),z=this.options.spacing/2,H=Dn(A,y-m)>=Ei||Ty(a,m,y),X=$u(u,C+z,T+z);return H&&X}getCenterPoint(t){const{x:n,y:i,startAngle:o,endAngle:a,innerRadius:u,outerRadius:m}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],t),{offset:y,spacing:C}=this.options,T=(o+a)/2,A=(u+m+C+y)/2;return{x:n+Math.cos(T)*A,y:i+Math.sin(T)*A}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:n,circumference:i}=this,o=(n.offset||0)/2,a=(n.spacing||0)/2;if(this.pixelMargin="inner"===n.borderAlign?.33:0,this.fullCircles=i>Ei?Math.floor(i/Ei):0,0===i||this.innerRadius<0||this.outerRadius<0)return;t.save();let u=0;if(o){u=o/2;const y=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(y)*u,Math.sin(y)*u),this.circumference>=qi&&(u=o)}t.fillStyle=n.backgroundColor,t.strokeStyle=n.borderColor;const m=function x6(e,t,n,i){const{fullCircles:o,startAngle:a,circumference:u}=t;let m=t.endAngle;if(o){BE(e,t,n,i,a+Ei);for(let y=0;y<o;++y)e.fill();isNaN(u)||(m=a+u%Ei,u%Ei==0&&(m+=Ei))}return BE(e,t,n,i,m),e.fill(),m}(t,this,u,a);(function w6(e,t,n,i,o){const{options:a}=t,{borderWidth:u,borderJoinStyle:m}=a,y="inner"===a.borderAlign;u&&(y?(e.lineWidth=2*u,e.lineJoin=m||"round"):(e.lineWidth=u,e.lineJoin=m||"bevel"),t.fullCircles&&function b6(e,t,n){const{x:i,y:o,startAngle:a,pixelMargin:u,fullCircles:m}=t,y=Math.max(t.outerRadius-u,0),C=t.innerRadius+u;let T;for(n&&kP(e,t,a+Ei),e.beginPath(),e.arc(i,o,C,a+Ei,a,!0),T=0;T<m;++T)e.stroke();for(e.beginPath(),e.arc(i,o,y,a,a+Ei),T=0;T<m;++T)e.stroke()}(e,t,y),y&&kP(e,t,o),BE(e,t,n,i,o),e.stroke())})(t,this,u,a,m),t.restore()}}function RP(e,t,n=t){e.lineCap=Dn(n.borderCapStyle,t.borderCapStyle),e.setLineDash(Dn(n.borderDash,t.borderDash)),e.lineDashOffset=Dn(n.borderDashOffset,t.borderDashOffset),e.lineJoin=Dn(n.borderJoinStyle,t.borderJoinStyle),e.lineWidth=Dn(n.borderWidth,t.borderWidth),e.strokeStyle=Dn(n.borderColor,t.borderColor)}function C6(e,t,n){e.lineTo(n.x,n.y)}function OP(e,t,n={}){const i=e.length,{start:o=0,end:a=i-1}=n,{start:u,end:m}=t,y=Math.max(o,u),C=Math.min(a,m);return{count:i,start:y,loop:t.loop,ilen:C<y&&!(o<u&&a<u||o>m&&a>m)?i+C-y:C-y}}function D6(e,t,n,i){const{points:o,options:a}=t,{count:u,start:m,loop:y,ilen:C}=OP(o,n,i),T=function E6(e){return e.stepped?NU:e.tension||"monotone"===e.cubicInterpolationMode?BU:C6}(a);let V,H,X,{move:A=!0,reverse:z}=i||{};for(V=0;V<=C;++V)H=o[(m+(z?C-V:V))%u],!H.skip&&(A?(e.moveTo(H.x,H.y),A=!1):T(e,X,H,z,a.stepped),X=H);return y&&(H=o[(m+(z?C:0))%u],T(e,X,H,z,a.stepped)),!!y}function T6(e,t,n,i){const o=t.points,{count:a,start:u,ilen:m}=OP(o,n,i),{move:y=!0,reverse:C}=i||{};let z,V,H,X,oe,le,T=0,A=0;const we=Re=>(u+(C?m-Re:Re))%a,ve=()=>{X!==oe&&(e.lineTo(T,oe),e.lineTo(T,X),e.lineTo(T,le))};for(y&&(V=o[we(0)],e.moveTo(V.x,V.y)),z=0;z<=m;++z){if(V=o[we(z)],V.skip)continue;const Re=V.x,Fe=V.y,lt=0|Re;lt===H?(Fe<X?X=Fe:Fe>oe&&(oe=Fe),T=(A*T+Re)/++A):(ve(),e.lineTo(Re,Fe),H=lt,A=0,X=oe=Fe),le=Fe}ve()}function VE(e){const t=e.options;return e._decimated||e._loop||t.tension||"monotone"===t.cubicInterpolationMode||t.stepped||t.borderDash&&t.borderDash.length?D6:T6}kb.id="arc",kb.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0},kb.defaultRoutes={backgroundColor:"backgroundColor"};const A6="function"==typeof Path2D;let Rb=(()=>{class e extends Kl{constructor(n){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,n&&Object.assign(this,n)}updateControlPoints(n,i){const o=this.options;!o.tension&&"monotone"!==o.cubicInterpolationMode||o.stepped||this._pointsUpdated||(h4(this._points,o,n,o.spanGaps?this._loop:this._fullLoop,i),this._pointsUpdated=!0)}set points(n){this._points=n,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function S4(e,t){const n=e.points,i=e.options.spanGaps,o=n.length;if(!o)return[];const a=!!e._loop,{start:u,end:m}=function D4(e,t,n,i){let o=0,a=t-1;if(n&&!i)for(;o<t&&!e[o].skip;)o++;for(;o<t&&e[o].skip;)o++;for(o%=t,n&&(a+=o);a>o&&e[a%t].skip;)a--;return a%=t,{start:o,end:a}}(n,o,a,i);return function $2(e,t,n,i){return i&&i.setContext&&n?function M4(e,t,n,i){const o=e._chart.getContext(),a=H2(e.options),{_datasetIndex:u,options:{spanGaps:m}}=e,y=n.length,C=[];let T=a,A=t[0].start,z=A;function V(H,X,oe,le){const we=m?-1:1;if(H!==X){for(H+=y;n[H%y].skip;)H-=we;for(;n[X%y].skip;)X+=we;H%y!=X%y&&(C.push({start:H%y,end:X%y,loop:oe,style:le}),T=le,A=X%y)}}for(const H of t){A=m?A:H.start;let oe,X=n[A%y];for(z=A+1;z<=H.end;z++){const le=n[z%y];oe=H2(i.setContext(Md(o,{type:"segment",p0:X,p1:le,p0DataIndex:(z-1)%y,p1DataIndex:z%y,datasetIndex:u}))),I4(oe,T)&&V(A,z-1,H.loop,T),X=le,T=oe}A<z-1&&V(A,z-1,H.loop,T)}return C}(e,t,n,i):t}(e,!0===i?[{start:u,end:m,loop:a}]:function T4(e,t,n,i){const o=e.length,a=[];let y,u=t,m=e[t];for(y=t+1;y<=n;++y){const C=e[y%o];C.skip||C.stop?m.skip||(a.push({start:t%o,end:(y-1)%o,loop:i=!1}),t=u=C.stop?y:null):(u=y,m.skip&&(t=y)),m=C}return null!==u&&a.push({start:t%o,end:u%o,loop:i}),a}(n,u,m<u?m+o:m,!!e._fullLoop&&0===u&&m===o-1),n,t)}(this,this.options.segment))}first(){const n=this.segments;return n.length&&this.points[n[0].start]}last(){const n=this.segments,o=n.length;return o&&this.points[n[o-1].end]}interpolate(n,i){const o=this.options,a=n[i],u=this.points,m=U2(this,{property:i,start:a,end:a});if(!m.length)return;const y=[],C=function S6(e){return e.stepped?v4:e.tension||"monotone"===e.cubicInterpolationMode?x4:pp}(o);let T,A;for(T=0,A=m.length;T<A;++T){const{start:z,end:V}=m[T],H=u[z],X=u[V];if(H===X){y.push(H);continue}const le=C(H,X,Math.abs((a-H[i])/(X[i]-H[i])),o.stepped);le[i]=n[i],y.push(le)}return 1===y.length?y[0]:y}pathSegment(n,i,o){return VE(this)(n,this,i,o)}path(n,i,o){const a=this.segments,u=VE(this);let m=this._loop;i=i||0,o=o||this.points.length-i;for(const y of a)m&=u(n,this,y,{start:i,end:i+o-1});return!!m}draw(n,i,o,a){(this.points||[]).length&&(this.options||{}).borderWidth&&(n.save(),function P6(e,t,n,i){A6&&!t.options.segment?function M6(e,t,n,i){let o=t._path;o||(o=t._path=new Path2D,t.path(o,n,i)&&o.closePath()),RP(e,t.options),e.stroke(o)}(e,t,n,i):function I6(e,t,n,i){const{segments:o,options:a}=t,u=VE(t);for(const m of o)RP(e,a,m.style),e.beginPath(),u(e,t,m,{start:n,end:n+i-1})&&e.closePath(),e.stroke()}(e,t,n,i)}(n,this,o,a),n.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return e.id="line",e.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},e.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},e.descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t&&"fill"!==t},e})();function LP(e,t,n,i){const o=e.options,{[n]:a}=e.getProps([n],i);return Math.abs(t-a)<o.radius+o.hitRadius}let k6=(()=>{class e extends Kl{constructor(n){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,n&&Object.assign(this,n)}inRange(n,i,o){const a=this.options,{x:u,y:m}=this.getProps(["x","y"],o);return Math.pow(n-u,2)+Math.pow(i-m,2)<Math.pow(a.hitRadius+a.radius,2)}inXRange(n,i){return LP(this,n,"x",i)}inYRange(n,i){return LP(this,n,"y",i)}getCenterPoint(n){const{x:i,y:o}=this.getProps(["x","y"],n);return{x:i,y:o}}size(n){let i=(n=n||this.options||{}).radius||0;return i=Math.max(i,i&&n.hoverRadius||0),2*(i+(i&&n.borderWidth||0))}draw(n,i){const o=this.options;this.skip||o.radius<.1||!Py(this,i,this.size(o)/2)||(n.strokeStyle=o.borderColor,n.lineWidth=o.borderWidth,n.fillStyle=o.backgroundColor,yb(n,o,this.x,this.y))}getRange(){const n=this.options||{};return n.radius+n.hitRadius}}return e.id="point",e.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},e.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},e})();function FP(e,t){const{x:n,y:i,base:o,width:a,height:u}=e.getProps(["x","y","base","width","height"],t);let m,y,C,T,A;return e.horizontal?(A=u/2,m=Math.min(n,o),y=Math.max(n,o),C=i-A,T=i+A):(A=a/2,m=n-A,y=n+A,C=Math.min(i,o),T=Math.max(i,o)),{left:m,top:C,right:y,bottom:T}}function Ad(e,t,n,i){return e?0:yo(t,n,i)}function jE(e,t,n,i){const o=null===t,a=null===n,m=e&&!(o&&a)&&FP(e,i);return m&&(o||$u(t,m.left,m.right))&&(a||$u(n,m.top,m.bottom))}function z6(e,t){e.rect(t.x,t.y,t.w,t.h)}function UE(e,t,n={}){const i=e.x!==n.x?-t:0,o=e.y!==n.y?-t:0;return{x:e.x+i,y:e.y+o,w:e.w+((e.x+e.w!==n.x+n.w?t:0)-i),h:e.h+((e.y+e.h!==n.y+n.h?t:0)-o),radius:e.radius}}class Ob extends Kl{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:n,options:{borderColor:i,backgroundColor:o}}=this,{inner:a,outer:u}=function L6(e){const t=FP(e),n=t.right-t.left,i=t.bottom-t.top,o=function R6(e,t,n){const o=e.borderSkipped,a=b2(e.options.borderWidth);return{t:Ad(o.top,a.top,0,n),r:Ad(o.right,a.right,0,t),b:Ad(o.bottom,a.bottom,0,n),l:Ad(o.left,a.left,0,t)}}(e,n/2,i/2),a=function O6(e,t,n){const{enableBorderRadius:i}=e.getProps(["enableBorderRadius"]),o=e.options.borderRadius,a=hp(o),u=Math.min(t,n),m=e.borderSkipped,y=i||$n(o);return{topLeft:Ad(!y||m.top||m.left,a.topLeft,0,u),topRight:Ad(!y||m.top||m.right,a.topRight,0,u),bottomLeft:Ad(!y||m.bottom||m.left,a.bottomLeft,0,u),bottomRight:Ad(!y||m.bottom||m.right,a.bottomRight,0,u)}}(e,n/2,i/2);return{outer:{x:t.left,y:t.top,w:n,h:i,radius:a},inner:{x:t.left+o.l,y:t.top+o.t,w:n-o.l-o.r,h:i-o.t-o.b,radius:{topLeft:Math.max(0,a.topLeft-Math.max(o.t,o.l)),topRight:Math.max(0,a.topRight-Math.max(o.t,o.r)),bottomLeft:Math.max(0,a.bottomLeft-Math.max(o.b,o.l)),bottomRight:Math.max(0,a.bottomRight-Math.max(o.b,o.r))}}}}(this),m=function F6(e){return e.topLeft||e.topRight||e.bottomLeft||e.bottomRight}(u.radius)?ky:z6;t.save(),(u.w!==a.w||u.h!==a.h)&&(t.beginPath(),m(t,UE(u,n,a)),t.clip(),m(t,UE(a,-n,u)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),m(t,UE(a,n)),t.fillStyle=o,t.fill(),t.restore()}inRange(t,n,i){return jE(this,t,n,i)}inXRange(t,n){return jE(this,t,null,n)}inYRange(t,n){return jE(this,null,t,n)}getCenterPoint(t){const{x:n,y:i,base:o,horizontal:a}=this.getProps(["x","y","base","horizontal"],t);return{x:a?(n+o)/2:n,y:a?i:(i+o)/2}}getRange(t){return"x"===t?this.width/2:this.height/2}}Ob.id="bar",Ob.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},Ob.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var N6=Object.freeze({__proto__:null,ArcElement:kb,LineElement:Rb,PointElement:k6,BarElement:Ob});function zP(e){if(e._decimated){const t=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{value:t})}}function NP(e){e.data.datasets.forEach(t=>{zP(t)})}var U6={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,t,n)=>{if(!n.enabled)return void NP(e);const i=e.width;e.data.datasets.forEach((o,a)=>{const{_data:u,indexAxis:m}=o,y=e.getDatasetMeta(a),C=u||o.data;if("y"===Ry([m,e.options.indexAxis])||!y.controller.supportsDecimation)return;const T=e.scales[y.xAxisID];if("linear"!==T.type&&"time"!==T.type||e.options.parsing)return;let H,{start:A,count:z}=function j6(e,t){const n=t.length;let o,i=0;const{iScale:a}=e,{min:u,max:m,minDefined:y,maxDefined:C}=a.getUserBounds();return y&&(i=yo(Gu(t,a.axis,u).lo,0,n-1)),o=C?yo(Gu(t,a.axis,m).hi+1,i,n)-i:n-i,{start:i,count:o}}(y,C);if(z<=(n.threshold||4*i))zP(o);else{switch(oi(u)&&(o._data=C,delete o.data,Object.defineProperty(o,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(X){this._data=X}})),n.algorithm){case"lttb":H=function B6(e,t,n,i,o){const a=o.samples||i;if(a>=n)return e.slice(t,t+n);const u=[],m=(n-2)/(a-2);let y=0;const C=t+n-1;let A,z,V,H,X,T=t;for(u[y++]=e[T],A=0;A<a-2;A++){let we,oe=0,le=0;const ve=Math.floor((A+1)*m)+1+t,Re=Math.min(Math.floor((A+2)*m)+1,n)+t,Fe=Re-ve;for(we=ve;we<Re;we++)oe+=e[we].x,le+=e[we].y;oe/=Fe,le/=Fe;const lt=Math.floor(A*m)+1+t,bt=Math.min(Math.floor((A+1)*m)+1,n)+t,{x:Rt,y:Ot}=e[T];for(V=H=-1,we=lt;we<bt;we++)H=.5*Math.abs((Rt-oe)*(e[we].y-Ot)-(Rt-e[we].x)*(le-Ot)),H>V&&(V=H,z=e[we],X=we);u[y++]=z,T=X}return u[y++]=e[C],u}(C,A,z,i,n);break;case"min-max":H=function V6(e,t,n,i){let u,m,y,C,T,A,z,V,H,X,o=0,a=0;const oe=[],we=e[t].x,Re=e[t+n-1].x-we;for(u=t;u<t+n;++u){m=e[u],y=(m.x-we)/Re*i,C=m.y;const Fe=0|y;if(Fe===T)C<H?(H=C,A=u):C>X&&(X=C,z=u),o=(a*o+m.x)/++a;else{const lt=u-1;if(!oi(A)&&!oi(z)){const bt=Math.min(A,z),Rt=Math.max(A,z);bt!==V&&bt!==lt&&oe.push({...e[bt],x:o}),Rt!==V&&Rt!==lt&&oe.push({...e[Rt],x:o})}u>0&&lt!==V&&oe.push(e[lt]),oe.push(m),T=Fe,a=0,H=X=C,A=z=V=u}}return oe}(C,A,z,i);break;default:throw new Error(`Unsupported decimation algorithm '${n.algorithm}'`)}o._decimated=H}})},destroy(e){NP(e)}};function $E(e,t,n,i){if(i)return;let o=t[e],a=n[e];return"angle"===e&&(o=wa(o),a=wa(a)),{property:e,start:o,end:a}}function HE(e,t,n){for(;t>e;t--){const i=n[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function BP(e,t,n,i){return e&&t?i(e[n],t[n]):e?e[n]:t?t[n]:0}function VP(e,t){let n=[],i=!1;return Ai(e)?(i=!0,n=e):n=function H6(e,t){const{x:n=null,y:i=null}=e||{},o=t.points,a=[];return t.segments.forEach(({start:u,end:m})=>{m=HE(u,m,o);const y=o[u],C=o[m];null!==i?(a.push({x:y.x,y:i}),a.push({x:C.x,y:i})):null!==n&&(a.push({x:n,y:y.y}),a.push({x:n,y:C.y}))}),a}(e,t),n.length?new Rb({points:n,options:{tension:0},_loop:i,_fullLoop:i}):null}function G6(e,t,n){let o=e[t].fill;const a=[t];let u;if(!n)return o;for(;!1!==o&&-1===a.indexOf(o);){if(!Dr(o))return o;if(u=e[o],!u)return!1;if(u.visible)return o;a.push(o),o=u.fill}return!1}function W6(e,t,n){const i=function Y6(e){const t=e.options,n=t.fill;let i=Dn(n&&n.target,n);return void 0===i&&(i=!!t.backgroundColor),!1!==i&&null!==i&&(!0===i?"origin":i)}(e);if($n(i))return!isNaN(i.value)&&i;let o=parseFloat(i);return Dr(o)&&Math.floor(o)===o?function q6(e,t,n,i){return("-"===e||"+"===e)&&(n=t+n),!(n===t||n<0||n>=i)&&n}(i[0],t,o,n):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Q6(e,t,n){const i=[];for(let o=0;o<n.length;o++){const a=n[o],{first:u,last:m,point:y}=eH(a,t,"x");if(!(!y||u&&m))if(u)i.unshift(y);else if(e.push(y),!m)break}e.push(...i)}function eH(e,t,n){const i=e.interpolate(t,n);if(!i)return{};const o=i[n],a=e.segments,u=e.points;let m=!1,y=!1;for(let C=0;C<a.length;C++){const T=a[C],A=u[T.start][n],z=u[T.end][n];if($u(o,A,z)){m=o===A,y=o===z;break}}return{first:m,last:y,point:i}}class jP{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,n,i){const{x:o,y:a,radius:u}=this;return t.arc(o,a,u,(n=n||{start:0,end:Ei}).end,n.start,!0),!i.bounds}interpolate(t){const{x:n,y:i,radius:o}=this,a=t.angle;return{x:n+Math.cos(a)*o,y:i+Math.sin(a)*o,angle:a}}}function GE(e,t,n){const i=function tH(e){const{chart:t,fill:n,line:i}=e;if(Dr(n))return function nH(e,t){const n=e.getDatasetMeta(t);return n&&e.isDatasetVisible(t)?n.dataset:null}(t,n);if("stack"===n)return function K6(e){const{scale:t,index:n,line:i}=e,o=[],a=i.segments,u=i.points,m=function J6(e,t){const n=[],i=e.getMatchingVisibleMetas("line");for(let o=0;o<i.length;o++){const a=i[o];if(a.index===t)break;a.hidden||n.unshift(a.dataset)}return n}(t,n);m.push(VP({x:null,y:t.bottom},i));for(let y=0;y<a.length;y++){const C=a[y];for(let T=C.start;T<=C.end;T++)Q6(o,u[T],m)}return new Rb({points:o,options:{}})}(e);if("shape"===n)return!0;const o=function iH(e){return(e.scale||{}).getPointPositionForValue?function oH(e){const{scale:t,fill:n}=e,i=t.options,o=t.getLabels().length,a=i.reverse?t.max:t.min,u=function X6(e,t,n){let i;return i="start"===e?n:"end"===e?t.options.reverse?t.min:t.max:$n(e)?e.value:t.getBaseValue(),i}(n,t,a),m=[];if(i.grid.circular){const y=t.getPointPositionForValue(0,a);return new jP({x:y.x,y:y.y,radius:t.getDistanceFromCenterForValue(u)})}for(let y=0;y<o;++y)m.push(t.getPointPositionForValue(y,u));return m}(e):function rH(e){const{scale:t={},fill:n}=e,i=function Z6(e,t){let n=null;return"start"===e?n=t.bottom:"end"===e?n=t.top:$n(e)?n=t.getPixelForValue(e.value):t.getBasePixel&&(n=t.getBasePixel()),n}(n,t);if(Dr(i)){const o=t.isHorizontal();return{x:o?i:null,y:o?null:i}}return null}(e)}(e);return o instanceof jP?o:VP(o,i)}(t),{line:o,scale:a,axis:u}=t,m=o.options,y=m.fill,C=m.backgroundColor,{above:T=C,below:A=C}=y||{};i&&o.points.length&&(vb(e,n),function sH(e,t){const{line:n,target:i,above:o,below:a,area:u,scale:m}=t,y=n._loop?"angle":t.axis;e.save(),"x"===y&&a!==o&&(UP(e,i,u.top),$P(e,{line:n,target:i,color:o,scale:m,property:y}),e.restore(),e.save(),UP(e,i,u.bottom)),$P(e,{line:n,target:i,color:a,scale:m,property:y}),e.restore()}(e,{line:o,target:i,above:T,below:A,area:n,scale:a,axis:u}),xb(e))}function UP(e,t,n){const{segments:i,points:o}=t;let a=!0,u=!1;e.beginPath();for(const m of i){const{start:y,end:C}=m,T=o[y],A=o[HE(y,C,o)];a?(e.moveTo(T.x,T.y),a=!1):(e.lineTo(T.x,n),e.lineTo(T.x,T.y)),u=!!t.pathSegment(e,m,{move:u}),u?e.closePath():e.lineTo(A.x,n)}e.lineTo(t.first().x,n),e.closePath(),e.clip()}function $P(e,t){const{line:n,target:i,property:o,color:a,scale:u}=t,m=function $6(e,t,n){const i=e.segments,o=e.points,a=t.points,u=[];for(const m of i){let{start:y,end:C}=m;C=HE(y,C,o);const T=$E(n,o[y],o[C],m.loop);if(!t.segments){u.push({source:m,target:T,start:o[y],end:o[C]});continue}const A=U2(t,T);for(const z of A){const V=$E(n,a[z.start],a[z.end],z.loop),H=j2(m,o,V);for(const X of H)u.push({source:X,target:z,start:{[n]:BP(T,V,"start",Math.max)},end:{[n]:BP(T,V,"end",Math.min)}})}}return u}(n,i,o);for(const{source:y,target:C,start:T,end:A}of m){const{style:{backgroundColor:z=a}={}}=y,V=!0!==i;e.save(),e.fillStyle=z,aH(e,u,V&&$E(o,T,A)),e.beginPath();const H=!!n.pathSegment(e,y);let X;if(V){H?e.closePath():HP(e,i,A,o);const oe=!!i.pathSegment(e,C,{move:H,reverse:!0});X=H&&oe,X||HP(e,i,T,o)}e.closePath(),e.fill(X?"evenodd":"nonzero"),e.restore()}}function aH(e,t,n){const{top:i,bottom:o}=t.chart.chartArea,{property:a,start:u,end:m}=n||{};"x"===a&&(e.beginPath(),e.rect(u,i,m-u,o-i),e.clip())}function HP(e,t,n,i){const o=t.interpolate(n,i);o&&e.lineTo(o.x,o.y)}var lH={id:"filler",afterDatasetsUpdate(e,t,n){const i=(e.data.datasets||[]).length,o=[];let a,u,m,y;for(u=0;u<i;++u)a=e.getDatasetMeta(u),m=a.dataset,y=null,m&&m.options&&m instanceof Rb&&(y={visible:e.isDatasetVisible(u),index:u,fill:W6(m,u,i),chart:e,axis:a.controller.options.indexAxis,scale:a.vScale,line:m}),a.$filler=y,o.push(y);for(u=0;u<i;++u)y=o[u],y&&!1!==y.fill&&(y.fill=G6(o,u,n.propagate))},beforeDraw(e,t,n){const i="beforeDraw"===n.drawTime,o=e.getSortedVisibleDatasetMetas(),a=e.chartArea;for(let u=o.length-1;u>=0;--u){const m=o[u].$filler;m&&(m.line.updateControlPoints(a,m.axis),i&&GE(e.ctx,m,a))}},beforeDatasetsDraw(e,t,n){if("beforeDatasetsDraw"!==n.drawTime)return;const i=e.getSortedVisibleDatasetMetas();for(let o=i.length-1;o>=0;--o){const a=i[o].$filler;a&&GE(e.ctx,a,e.chartArea)}},beforeDatasetDraw(e,t,n){const i=t.meta.$filler;!i||!1===i.fill||"beforeDatasetDraw"!==n.drawTime||GE(e.ctx,i,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const GP=(e,t)=>{let{boxHeight:n=t,boxWidth:i=t}=e;return e.usePointStyle&&(n=Math.min(n,t),i=Math.min(i,t)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(t,n)}};class WP extends Kl{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n,i){this.maxWidth=t,this.maxHeight=n,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let n=Pi(t.generateLabels,[this.chart],this)||[];t.filter&&(n=n.filter(i=>t.filter(i,this.chart.data))),t.sort&&(n=n.sort((i,o)=>t.sort(i,o,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:t,ctx:n}=this;if(!t.display)return void(this.width=this.height=0);const i=t.labels,o=io(i.font),a=o.size,u=this._computeTitleHeight(),{boxWidth:m,itemHeight:y}=GP(i,a);let C,T;n.font=o.string,this.isHorizontal()?(C=this.maxWidth,T=this._fitRows(u,a,m,y)+10):(T=this.maxHeight,C=this._fitCols(u,a,m,y)+10),this.width=Math.min(C,t.maxWidth||this.maxWidth),this.height=Math.min(T,t.maxHeight||this.maxHeight)}_fitRows(t,n,i,o){const{ctx:a,maxWidth:u,options:{labels:{padding:m}}}=this,y=this.legendHitBoxes=[],C=this.lineWidths=[0],T=o+m;let A=t;a.textAlign="left",a.textBaseline="middle";let z=-1,V=-T;return this.legendItems.forEach((H,X)=>{const oe=i+n/2+a.measureText(H.text).width;(0===X||C[C.length-1]+oe+2*m>u)&&(A+=T,C[C.length-(X>0?0:1)]=0,V+=T,z++),y[X]={left:0,top:V,row:z,width:oe,height:o},C[C.length-1]+=oe+m}),A}_fitCols(t,n,i,o){const{ctx:a,maxHeight:u,options:{labels:{padding:m}}}=this,y=this.legendHitBoxes=[],C=this.columnSizes=[],T=u-t;let A=m,z=0,V=0,H=0,X=0;return this.legendItems.forEach((oe,le)=>{const we=i+n/2+a.measureText(oe.text).width;le>0&&V+o+2*m>T&&(A+=z+m,C.push({width:z,height:V}),H+=z+m,X++,z=V=0),y[le]={left:H,top:V,col:X,width:we,height:o},z=Math.max(z,we),V+=o+m}),A+=z,C.push({width:z,height:V}),A}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:i,labels:{padding:o},rtl:a}}=this,u=rg(a,this.left,this.width);if(this.isHorizontal()){let m=0,y=Jo(i,this.left+o,this.right-this.lineWidths[m]);for(const C of n)m!==C.row&&(m=C.row,y=Jo(i,this.left+o,this.right-this.lineWidths[m])),C.top+=this.top+t+o,C.left=u.leftForLtr(u.x(y),C.width),y+=C.width+o}else{let m=0,y=Jo(i,this.top+t+o,this.bottom-this.columnSizes[m].height);for(const C of n)C.col!==m&&(m=C.col,y=Jo(i,this.top+t+o,this.bottom-this.columnSizes[m].height)),C.top=y,C.left+=this.left+o,C.left=u.leftForLtr(u.x(C.left),C.width),y+=C.height+o}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const t=this.ctx;vb(t,this),this._draw(),xb(t)}}_draw(){const{options:t,columnSizes:n,lineWidths:i,ctx:o}=this,{align:a,labels:u}=t,m=Nn.color,y=rg(t.rtl,this.left,this.width),C=io(u.font),{color:T,padding:A}=u,z=C.size,V=z/2;let H;this.drawTitle(),o.textAlign=y.textAlign("left"),o.textBaseline="middle",o.lineWidth=.5,o.font=C.string;const{boxWidth:X,boxHeight:oe,itemHeight:le}=GP(u,z),Re=this.isHorizontal(),Fe=this._computeTitleHeight();H=Re?{x:Jo(a,this.left+A,this.right-i[0]),y:this.top+A+Fe,line:0}:{x:this.left+A,y:Jo(a,this.top+Fe+A,this.bottom-n[0].height),line:0},z2(this.ctx,t.textDirection);const lt=le+A;this.legendItems.forEach((bt,Rt)=>{o.strokeStyle=bt.fontColor||T,o.fillStyle=bt.fontColor||T;const Ot=o.measureText(bt.text).width,mi=y.textAlign(bt.textAlign||(bt.textAlign=u.textAlign)),Zn=X+V+Ot;let Xn=H.x,jr=H.y;y.setWidth(this.width),Re?Rt>0&&Xn+Zn+A>this.right&&(jr=H.y+=lt,H.line++,Xn=H.x=Jo(a,this.left+A,this.right-i[H.line])):Rt>0&&jr+lt>this.bottom&&(Xn=H.x=Xn+n[H.line].width+A,H.line++,jr=H.y=Jo(a,this.top+Fe+A,this.bottom-n[H.line].height)),function(bt,Rt,Ot){if(isNaN(X)||X<=0||isNaN(oe)||oe<0)return;o.save();const mi=Dn(Ot.lineWidth,1);if(o.fillStyle=Dn(Ot.fillStyle,m),o.lineCap=Dn(Ot.lineCap,"butt"),o.lineDashOffset=Dn(Ot.lineDashOffset,0),o.lineJoin=Dn(Ot.lineJoin,"miter"),o.lineWidth=mi,o.strokeStyle=Dn(Ot.strokeStyle,m),o.setLineDash(Dn(Ot.lineDash,[])),u.usePointStyle){const Zn={radius:X*Math.SQRT2/2,pointStyle:Ot.pointStyle,rotation:Ot.rotation,borderWidth:mi},Xn=y.xPlus(bt,X/2);yb(o,Zn,Xn,Rt+V)}else{const Zn=Rt+Math.max((z-oe)/2,0),Xn=y.leftForLtr(bt,X),jr=hp(Ot.borderRadius);o.beginPath(),Object.values(jr).some(Es=>0!==Es)?ky(o,{x:Xn,y:Zn,w:X,h:oe,radius:jr}):o.rect(Xn,Zn,X,oe),o.fill(),0!==mi&&o.stroke()}o.restore()}(y.x(Xn),jr,bt),Xn=((e,t,n,i)=>e===(i?"left":"right")?n:"center"===e?(t+n)/2:t)(mi,Xn+X+V,Re?Xn+Zn:this.right,t.rtl),function(bt,Rt,Ot){up(o,Ot.text,bt,Rt+le/2,C,{strikethrough:Ot.hidden,textAlign:y.textAlign(Ot.textAlign)})}(y.x(Xn),jr,bt),Re?H.x+=Zn+A:H.y+=lt}),N2(this.ctx,t.textDirection)}drawTitle(){const t=this.options,n=t.title,i=io(n.font),o=Qo(n.padding);if(!n.display)return;const a=rg(t.rtl,this.left,this.width),u=this.ctx,m=n.position,C=o.top+i.size/2;let T,A=this.left,z=this.width;if(this.isHorizontal())z=Math.max(...this.lineWidths),T=this.top+C,A=Jo(t.align,A,this.right-z);else{const H=this.columnSizes.reduce((X,oe)=>Math.max(X,oe.height),0);T=C+Jo(t.align,this.top,this.bottom-H-t.labels.padding-this._computeTitleHeight())}const V=Jo(m,A,A+z);u.textAlign=a.textAlign(dE(m)),u.textBaseline="middle",u.strokeStyle=n.color,u.fillStyle=n.color,u.font=i.string,up(u,n.text,V,T,i)}_computeTitleHeight(){const t=this.options.title,n=io(t.font),i=Qo(t.padding);return t.display?n.lineHeight+i.height:0}_getLegendItemAt(t,n){let i,o,a;if($u(t,this.left,this.right)&&$u(n,this.top,this.bottom))for(a=this.legendHitBoxes,i=0;i<a.length;++i)if(o=a[i],$u(t,o.left,o.left+o.width)&&$u(n,o.top,o.top+o.height))return this.legendItems[i];return null}handleEvent(t){const n=this.options;if(!function uH(e,t){return!(("mousemove"!==e&&"mouseout"!==e||!t.onHover&&!t.onLeave)&&(!t.onClick||"click"!==e&&"mouseup"!==e))}(t.type,n))return;const i=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type||"mouseout"===t.type){const o=this._hoveredItem,a=((e,t)=>null!==e&&null!==t&&e.datasetIndex===t.datasetIndex&&e.index===t.index)(o,i);o&&!a&&Pi(n.onLeave,[t,o,this],this),this._hoveredItem=i,i&&!a&&Pi(n.onHover,[t,i,this],this)}else i&&Pi(n.onClick,[t,i,this],this)}}var hH={id:"legend",_element:WP,start(e,t,n){const i=e.legend=new WP({ctx:e.ctx,options:n,chart:e});es.configure(e,i,n),es.addBox(e,i)},stop(e){es.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,n){const i=e.legend;es.configure(e,i,n),i.options=n},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,n){const i=t.datasetIndex,o=n.chart;o.isDatasetVisible(i)?(o.hide(i),t.hidden=!0):(o.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:o,color:a}}=e.legend.options;return e._getSortedDatasetMetas().map(u=>{const m=u.controller.getStyle(n?0:void 0),y=Qo(m.borderWidth);return{text:t[u.index].label,fillStyle:m.backgroundColor,fontColor:a,hidden:!u.visible,lineCap:m.borderCapStyle,lineDash:m.borderDash,lineDashOffset:m.borderDashOffset,lineJoin:m.borderJoinStyle,lineWidth:(y.width+y.height)/4,strokeStyle:m.borderColor,pointStyle:i||m.pointStyle,rotation:m.rotation,textAlign:o||m.textAlign,borderRadius:0,datasetIndex:u.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class WE extends Kl{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n){const i=this.options;if(this.left=0,this.top=0,!i.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=t,this.height=this.bottom=n;const o=Ai(i.text)?i.text.length:1;this._padding=Qo(i.padding);const a=o*io(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=a:this.width=a}isHorizontal(){const t=this.options.position;return"top"===t||"bottom"===t}_drawArgs(t){const{top:n,left:i,bottom:o,right:a,options:u}=this,m=u.align;let C,T,A,y=0;return this.isHorizontal()?(T=Jo(m,i,a),A=n+t,C=a-i):("left"===u.position?(T=i+t,A=Jo(m,o,n),y=-.5*qi):(T=a-t,A=Jo(m,n,o),y=.5*qi),C=o-n),{titleX:T,titleY:A,maxWidth:C,rotation:y}}draw(){const t=this.ctx,n=this.options;if(!n.display)return;const i=io(n.font),a=i.lineHeight/2+this._padding.top,{titleX:u,titleY:m,maxWidth:y,rotation:C}=this._drawArgs(a);up(t,n.text,0,0,i,{color:n.color,maxWidth:y,rotation:C,textAlign:dE(n.align),textBaseline:"middle",translation:[u,m]})}}var fH={id:"title",_element:WE,start(e,t,n){!function dH(e,t){const n=new WE({ctx:e.ctx,options:t,chart:e});es.configure(e,n,t),es.addBox(e,n),e.titleBlock=n}(e,n)},stop(e){es.removeBox(e,e.titleBlock),delete e.titleBlock},beforeUpdate(e,t,n){const i=e.titleBlock;es.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Lb=new WeakMap;var pH={id:"subtitle",start(e,t,n){const i=new WE({ctx:e.ctx,options:n,chart:e});es.configure(e,i,n),es.addBox(e,i),Lb.set(e,i)},stop(e){es.removeBox(e,Lb.get(e)),Lb.delete(e)},beforeUpdate(e,t,n){const i=Lb.get(e);es.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const $y={average(e){if(!e.length)return!1;let t,n,i=0,o=0,a=0;for(t=0,n=e.length;t<n;++t){const u=e[t].element;if(u&&u.hasValue()){const m=u.tooltipPosition();i+=m.x,o+=m.y,++a}}return{x:i/a,y:o/a}},nearest(e,t){if(!e.length)return!1;let a,u,m,n=t.x,i=t.y,o=Number.POSITIVE_INFINITY;for(a=0,u=e.length;a<u;++a){const y=e[a].element;if(y&&y.hasValue()){const T=mE(t,y.getCenterPoint());T<o&&(o=T,m=y)}}if(m){const y=m.tooltipPosition();n=y.x,i=y.y}return{x:n,y:i}}};function $c(e,t){return t&&(Ai(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function Xu(e){return("string"==typeof e||e instanceof String)&&e.indexOf("\n")>-1?e.split("\n"):e}function mH(e,t){const{element:n,datasetIndex:i,index:o}=t,a=e.getDatasetMeta(i).controller,{label:u,value:m}=a.getLabelAndValue(o);return{chart:e,label:u,parsed:a.getParsed(o),raw:e.data.datasets[i].data[o],formattedValue:m,dataset:a.getDataset(),dataIndex:o,datasetIndex:i,element:n}}function qP(e,t){const n=e.chart.ctx,{body:i,footer:o,title:a}=e,{boxWidth:u,boxHeight:m}=t,y=io(t.bodyFont),C=io(t.titleFont),T=io(t.footerFont),A=a.length,z=o.length,V=i.length,H=Qo(t.padding);let X=H.height,oe=0,le=i.reduce((Re,Fe)=>Re+Fe.before.length+Fe.lines.length+Fe.after.length,0);le+=e.beforeBody.length+e.afterBody.length,A&&(X+=A*C.lineHeight+(A-1)*t.titleSpacing+t.titleMarginBottom),le&&(X+=V*(t.displayColors?Math.max(m,y.lineHeight):y.lineHeight)+(le-V)*y.lineHeight+(le-1)*t.bodySpacing),z&&(X+=t.footerMarginTop+z*T.lineHeight+(z-1)*t.footerSpacing);let we=0;const ve=function(Re){oe=Math.max(oe,n.measureText(Re).width+we)};return n.save(),n.font=C.string,pi(e.title,ve),n.font=y.string,pi(e.beforeBody.concat(e.afterBody),ve),we=t.displayColors?u+2+t.boxPadding:0,pi(i,Re=>{pi(Re.before,ve),pi(Re.lines,ve),pi(Re.after,ve)}),we=0,n.font=T.string,pi(e.footer,ve),n.restore(),oe+=H.width,{width:oe,height:X}}function yH(e,t,n,i){const{x:o,width:a}=n,{width:u,chartArea:{left:m,right:y}}=e;let C="center";return"center"===i?C=o<=(m+y)/2?"left":"right":o<=a/2?C="left":o>=u-a/2&&(C="right"),function _H(e,t,n,i){const{x:o,width:a}=i,u=n.caretSize+n.caretPadding;if("left"===e&&o+a+u>t.width||"right"===e&&o-a-u<0)return!0}(C,e,t,n)&&(C="center"),C}function ZP(e,t,n){const i=n.yAlign||t.yAlign||function gH(e,t){const{y:n,height:i}=t;return n<i/2?"top":n>e.height-i/2?"bottom":"center"}(e,n);return{xAlign:n.xAlign||t.xAlign||yH(e,t,n,i),yAlign:i}}function XP(e,t,n,i){const{caretSize:o,caretPadding:a,cornerRadius:u}=e,{xAlign:m,yAlign:y}=n,C=o+a,{topLeft:T,topRight:A,bottomLeft:z,bottomRight:V}=hp(u);let H=function vH(e,t){let{x:n,width:i}=e;return"right"===t?n-=i:"center"===t&&(n-=i/2),n}(t,m);const X=function xH(e,t,n){let{y:i,height:o}=e;return"top"===t?i+=n:i-="bottom"===t?o+n:o/2,i}(t,y,C);return"center"===y?"left"===m?H+=C:"right"===m&&(H-=C):"left"===m?H-=Math.max(T,z)+o:"right"===m&&(H+=Math.max(A,V)+o),{x:yo(H,0,i.width-t.width),y:yo(X,0,i.height-t.height)}}function Fb(e,t,n){const i=Qo(n.padding);return"center"===t?e.x+e.width/2:"right"===t?e.x+e.width-i.right:e.x+i.left}function YP(e){return $c([],Xu(e))}function KP(e,t){const n=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return n?e.override(n):e}let JP=(()=>{class e extends Kl{constructor(n){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=n.chart||n._chart,this._chart=this.chart,this.options=n.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(n){this.options=n,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const n=this._cachedAnimations;if(n)return n;const i=this.chart,o=this.options.setContext(this.getContext()),a=o.enabled&&i.options.animation&&o.animations,u=new W2(this.chart,a);return a._cacheable&&(this._cachedAnimations=Object.freeze(u)),u}getContext(){return this.$context||(this.$context=function bH(e,t,n){return Md(e,{tooltip:t,tooltipItems:n,type:"tooltip"})}(this.chart.getContext(),this,this._tooltipItems))}getTitle(n,i){const{callbacks:o}=i,a=o.beforeTitle.apply(this,[n]),u=o.title.apply(this,[n]),m=o.afterTitle.apply(this,[n]);let y=[];return y=$c(y,Xu(a)),y=$c(y,Xu(u)),y=$c(y,Xu(m)),y}getBeforeBody(n,i){return YP(i.callbacks.beforeBody.apply(this,[n]))}getBody(n,i){const{callbacks:o}=i,a=[];return pi(n,u=>{const m={before:[],lines:[],after:[]},y=KP(o,u);$c(m.before,Xu(y.beforeLabel.call(this,u))),$c(m.lines,y.label.call(this,u)),$c(m.after,Xu(y.afterLabel.call(this,u))),a.push(m)}),a}getAfterBody(n,i){return YP(i.callbacks.afterBody.apply(this,[n]))}getFooter(n,i){const{callbacks:o}=i,a=o.beforeFooter.apply(this,[n]),u=o.footer.apply(this,[n]),m=o.afterFooter.apply(this,[n]);let y=[];return y=$c(y,Xu(a)),y=$c(y,Xu(u)),y=$c(y,Xu(m)),y}_createItems(n){const i=this._active,o=this.chart.data,a=[],u=[],m=[];let C,T,y=[];for(C=0,T=i.length;C<T;++C)y.push(mH(this.chart,i[C]));return n.filter&&(y=y.filter((A,z,V)=>n.filter(A,z,V,o))),n.itemSort&&(y=y.sort((A,z)=>n.itemSort(A,z,o))),pi(y,A=>{const z=KP(n.callbacks,A);a.push(z.labelColor.call(this,A)),u.push(z.labelPointStyle.call(this,A)),m.push(z.labelTextColor.call(this,A))}),this.labelColors=a,this.labelPointStyles=u,this.labelTextColors=m,this.dataPoints=y,y}update(n,i){const o=this.options.setContext(this.getContext()),a=this._active;let u,m=[];if(a.length){const y=$y[o.position].call(this,a,this._eventPosition);m=this._createItems(o),this.title=this.getTitle(m,o),this.beforeBody=this.getBeforeBody(m,o),this.body=this.getBody(m,o),this.afterBody=this.getAfterBody(m,o),this.footer=this.getFooter(m,o);const C=this._size=qP(this,o),T=Object.assign({},y,C),A=ZP(this.chart,o,T),z=XP(o,T,A,this.chart);this.xAlign=A.xAlign,this.yAlign=A.yAlign,u={opacity:1,x:z.x,y:z.y,width:C.width,height:C.height,caretX:y.x,caretY:y.y}}else 0!==this.opacity&&(u={opacity:0});this._tooltipItems=m,this.$context=void 0,u&&this._resolveAnimations().update(this,u),n&&o.external&&o.external.call(this,{chart:this.chart,tooltip:this,replay:i})}drawCaret(n,i,o,a){const u=this.getCaretPosition(n,o,a);i.lineTo(u.x1,u.y1),i.lineTo(u.x2,u.y2),i.lineTo(u.x3,u.y3)}getCaretPosition(n,i,o){const{xAlign:a,yAlign:u}=this,{caretSize:m,cornerRadius:y}=o,{topLeft:C,topRight:T,bottomLeft:A,bottomRight:z}=hp(y),{x:V,y:H}=n,{width:X,height:oe}=i;let le,we,ve,Re,Fe,lt;return"center"===u?(Fe=H+oe/2,"left"===a?(le=V,we=le-m,Re=Fe+m,lt=Fe-m):(le=V+X,we=le+m,Re=Fe-m,lt=Fe+m),ve=le):(we="left"===a?V+Math.max(C,A)+m:"right"===a?V+X-Math.max(T,z)-m:this.caretX,"top"===u?(Re=H,Fe=Re-m,le=we-m,ve=we+m):(Re=H+oe,Fe=Re+m,le=we+m,ve=we-m),lt=Re),{x1:le,x2:we,x3:ve,y1:Re,y2:Fe,y3:lt}}drawTitle(n,i,o){const a=this.title,u=a.length;let m,y,C;if(u){const T=rg(o.rtl,this.x,this.width);for(n.x=Fb(this,o.titleAlign,o),i.textAlign=T.textAlign(o.titleAlign),i.textBaseline="middle",m=io(o.titleFont),y=o.titleSpacing,i.fillStyle=o.titleColor,i.font=m.string,C=0;C<u;++C)i.fillText(a[C],T.x(n.x),n.y+m.lineHeight/2),n.y+=m.lineHeight+y,C+1===u&&(n.y+=o.titleMarginBottom-y)}}_drawColorBox(n,i,o,a,u){const m=this.labelColors[o],y=this.labelPointStyles[o],{boxHeight:C,boxWidth:T,boxPadding:A}=u,z=io(u.bodyFont),V=Fb(this,"left",u),H=a.x(V),oe=i.y+(C<z.lineHeight?(z.lineHeight-C)/2:0);if(u.usePointStyle){const le={radius:Math.min(T,C)/2,pointStyle:y.pointStyle,rotation:y.rotation,borderWidth:1},we=a.leftForLtr(H,T)+T/2,ve=oe+C/2;n.strokeStyle=u.multiKeyBackground,n.fillStyle=u.multiKeyBackground,yb(n,le,we,ve),n.strokeStyle=m.borderColor,n.fillStyle=m.backgroundColor,yb(n,le,we,ve)}else{n.lineWidth=m.borderWidth||1,n.strokeStyle=m.borderColor,n.setLineDash(m.borderDash||[]),n.lineDashOffset=m.borderDashOffset||0;const le=a.leftForLtr(H,T-A),we=a.leftForLtr(a.xPlus(H,1),T-A-2),ve=hp(m.borderRadius);Object.values(ve).some(Re=>0!==Re)?(n.beginPath(),n.fillStyle=u.multiKeyBackground,ky(n,{x:le,y:oe,w:T,h:C,radius:ve}),n.fill(),n.stroke(),n.fillStyle=m.backgroundColor,n.beginPath(),ky(n,{x:we,y:oe+1,w:T-2,h:C-2,radius:ve}),n.fill()):(n.fillStyle=u.multiKeyBackground,n.fillRect(le,oe,T,C),n.strokeRect(le,oe,T,C),n.fillStyle=m.backgroundColor,n.fillRect(we,oe+1,T-2,C-2))}n.fillStyle=this.labelTextColors[o]}drawBody(n,i,o){const{body:a}=this,{bodySpacing:u,bodyAlign:m,displayColors:y,boxHeight:C,boxWidth:T,boxPadding:A}=o,z=io(o.bodyFont);let V=z.lineHeight,H=0;const X=rg(o.rtl,this.x,this.width),oe=function(Ot){i.fillText(Ot,X.x(n.x+H),n.y+V/2),n.y+=V+u},le=X.textAlign(m);let we,ve,Re,Fe,lt,bt,Rt;for(i.textAlign=m,i.textBaseline="middle",i.font=z.string,n.x=Fb(this,le,o),i.fillStyle=o.bodyColor,pi(this.beforeBody,oe),H=y&&"right"!==le?"center"===m?T/2+A:T+2+A:0,Fe=0,bt=a.length;Fe<bt;++Fe){for(we=a[Fe],ve=this.labelTextColors[Fe],i.fillStyle=ve,pi(we.before,oe),Re=we.lines,y&&Re.length&&(this._drawColorBox(i,n,Fe,X,o),V=Math.max(z.lineHeight,C)),lt=0,Rt=Re.length;lt<Rt;++lt)oe(Re[lt]),V=z.lineHeight;pi(we.after,oe)}H=0,V=z.lineHeight,pi(this.afterBody,oe),n.y-=u}drawFooter(n,i,o){const a=this.footer,u=a.length;let m,y;if(u){const C=rg(o.rtl,this.x,this.width);for(n.x=Fb(this,o.footerAlign,o),n.y+=o.footerMarginTop,i.textAlign=C.textAlign(o.footerAlign),i.textBaseline="middle",m=io(o.footerFont),i.fillStyle=o.footerColor,i.font=m.string,y=0;y<u;++y)i.fillText(a[y],C.x(n.x),n.y+m.lineHeight/2),n.y+=m.lineHeight+o.footerSpacing}}drawBackground(n,i,o,a){const{xAlign:u,yAlign:m}=this,{x:y,y:C}=n,{width:T,height:A}=o,{topLeft:z,topRight:V,bottomLeft:H,bottomRight:X}=hp(a.cornerRadius);i.fillStyle=a.backgroundColor,i.strokeStyle=a.borderColor,i.lineWidth=a.borderWidth,i.beginPath(),i.moveTo(y+z,C),"top"===m&&this.drawCaret(n,i,o,a),i.lineTo(y+T-V,C),i.quadraticCurveTo(y+T,C,y+T,C+V),"center"===m&&"right"===u&&this.drawCaret(n,i,o,a),i.lineTo(y+T,C+A-X),i.quadraticCurveTo(y+T,C+A,y+T-X,C+A),"bottom"===m&&this.drawCaret(n,i,o,a),i.lineTo(y+H,C+A),i.quadraticCurveTo(y,C+A,y,C+A-H),"center"===m&&"left"===u&&this.drawCaret(n,i,o,a),i.lineTo(y,C+z),i.quadraticCurveTo(y,C,y+z,C),i.closePath(),i.fill(),a.borderWidth>0&&i.stroke()}_updateAnimationTarget(n){const i=this.chart,o=this.$animations,a=o&&o.x,u=o&&o.y;if(a||u){const m=$y[n.position].call(this,this._active,this._eventPosition);if(!m)return;const y=this._size=qP(this,n),C=Object.assign({},m,this._size),T=ZP(i,n,C),A=XP(n,C,T,i);(a._to!==A.x||u._to!==A.y)&&(this.xAlign=T.xAlign,this.yAlign=T.yAlign,this.width=y.width,this.height=y.height,this.caretX=m.x,this.caretY=m.y,this._resolveAnimations().update(this,A))}}_willRender(){return!!this.opacity}draw(n){const i=this.options.setContext(this.getContext());let o=this.opacity;if(!o)return;this._updateAnimationTarget(i);const a={width:this.width,height:this.height},u={x:this.x,y:this.y};o=Math.abs(o)<.001?0:o;const m=Qo(i.padding);i.enabled&&(this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length)&&(n.save(),n.globalAlpha=o,this.drawBackground(u,n,a,i),z2(n,i.textDirection),u.y+=m.top,this.drawTitle(u,n,i),this.drawBody(u,n,i),this.drawFooter(u,n,i),N2(n,i.textDirection),n.restore())}getActiveElements(){return this._active||[]}setActiveElements(n,i){const o=this._active,a=n.map(({datasetIndex:y,index:C})=>{const T=this.chart.getDatasetMeta(y);if(!T)throw new Error("Cannot find a dataset at index "+y);return{datasetIndex:y,element:T.data[C],index:C}}),u=!cb(o,a),m=this._positionChanged(a,i);(u||m)&&(this._active=a,this._eventPosition=i,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(n,i,o=!0){if(i&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const a=this.options,u=this._active||[],m=this._getActiveElements(n,u,i,o),y=this._positionChanged(m,n),C=i||!cb(m,u)||y;return C&&(this._active=m,(a.enabled||a.external)&&(this._eventPosition={x:n.x,y:n.y},this.update(!0,i))),C}_getActiveElements(n,i,o,a){const u=this.options;if("mouseout"===n.type)return[];if(!a)return i;const m=this.chart.getElementsAtEventForMode(n,u.mode,u,o);return u.reverse&&m.reverse(),m}_positionChanged(n,i){const{caretX:o,caretY:a,options:u}=this,m=$y[u.position].call(this,n,i);return!1!==m&&(o!==m.x||a!==m.y)}}return e.positioners=$y,e})();var wH={id:"tooltip",_element:JP,positioners:$y,afterInit(e,t,n){n&&(e.tooltip=new JP({chart:e,options:n}))},beforeUpdate(e,t,n){e.tooltip&&e.tooltip.initialize(n)},reset(e,t,n){e.tooltip&&e.tooltip.initialize(n)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const n={tooltip:t};if(!1===e.notifyPlugins("beforeTooltipDraw",n))return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",n)}},afterEvent(e,t){e.tooltip&&e.tooltip.handleEvent(t.event,t.replay,t.inChartArea)&&(t.changed=!0)},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:Uu,title(e){if(e.length>0){const t=e[0],n=t.chart.data.labels,i=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return n[t.dataIndex]}return""},afterTitle:Uu,beforeBody:Uu,beforeLabel:Uu,label(e){if(this&&this.options&&"dataset"===this.options.mode)return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const n=e.formattedValue;return oi(n)||(t+=n),t},labelColor(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:Uu,afterBody:Uu,beforeFooter:Uu,footer:Uu,afterFooter:Uu}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>"filter"!==e&&"itemSort"!==e&&"external"!==e,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},CH=Object.freeze({__proto__:null,Decimation:U6,Filler:lH,Legend:hH,SubTitle:pH,Title:fH,Tooltip:wH});class zb extends gp{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const n=this._addedLabels;if(n.length){const i=this.getLabels();for(const{index:o,label:a}of n)i[o]===a&&i.splice(o,1);this._addedLabels=[]}super.init(t)}parse(t,n){if(oi(t))return null;const i=this.getLabels();return n=isFinite(n)&&i[n]===t?n:function DH(e,t,n,i){const o=e.indexOf(t);return-1===o?((e,t,n,i)=>("string"==typeof t?(n=e.push(t)-1,i.unshift({index:n,label:t})):isNaN(t)&&(n=null),n))(e,t,n,i):o!==e.lastIndexOf(t)?n:o}(i,t,Dn(n,t),this._addedLabels),((e,t)=>null===e?null:yo(Math.round(e),0,t))(n,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:i,max:o}=this.getMinMax(!0);"ticks"===this.options.bounds&&(t||(i=0),n||(o=this.getLabels().length-1)),this.min=i,this.max=o}buildTicks(){const t=this.min,n=this.max,i=this.options.offset,o=[];let a=this.getLabels();a=0===t&&n===a.length-1?a:a.slice(t,n+1),this._valueRange=Math.max(a.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let u=t;u<=n;u++)o.push({value:u});return o}getLabelForValue(t){const n=this.getLabels();return t>=0&&t<n.length?n[t]:t}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return"number"!=typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function QP(e,t,{horizontal:n,minRotation:i}){const o=Yl(i),a=(n?Math.sin(o):Math.cos(o))||.001;return Math.min(t/a,.75*t*(""+e).length)}zb.id="category",zb.defaults={ticks:{callback:zb.prototype.getLabelForValue}};class Nb extends gp{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,n){return oi(t)||("number"==typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:n,maxDefined:i}=this.getUserBounds();let{min:o,max:a}=this;const u=y=>o=n?o:y,m=y=>a=i?a:y;if(t){const y=Uc(o),C=Uc(a);y<0&&C<0?m(0):y>0&&C>0&&u(0)}if(o===a){let y=1;(a>=Number.MAX_SAFE_INTEGER||o<=Number.MIN_SAFE_INTEGER)&&(y=Math.abs(.05*a)),m(a+y),t||u(o-y)}this.min=o,this.max=a}getTickLimit(){const t=this.options.ticks;let o,{maxTicksLimit:n,stepSize:i}=t;return i?(o=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,o>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${o} ticks. Limiting to 1000.`),o=1e3)):(o=this.computeTickLimit(),n=n||11),n&&(o=Math.min(n,o)),o}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,n=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const u=function SH(e,t){const n=[],{bounds:o,step:a,min:u,max:m,precision:y,count:C,maxTicks:T,maxDigits:A,includeBounds:z}=e,V=a||1,H=T-1,{min:X,max:oe}=t,le=!oi(u),we=!oi(m),ve=!oi(C),Re=(oe-X)/(A+1);let lt,bt,Rt,Ot,Fe=r2((oe-X)/H/V)*V;if(Fe<1e-14&&!le&&!we)return[{value:X},{value:oe}];Ot=Math.ceil(oe/Fe)-Math.floor(X/Fe),Ot>H&&(Fe=r2(Ot*Fe/H/V)*V),oi(y)||(lt=Math.pow(10,y),Fe=Math.ceil(Fe*lt)/lt),"ticks"===o?(bt=Math.floor(X/Fe)*Fe,Rt=Math.ceil(oe/Fe)*Fe):(bt=X,Rt=oe),le&&we&&a&&function uU(e,t){const n=Math.round(e);return n-t<=e&&n+t>=e}((m-u)/a,Fe/1e3)?(Ot=Math.round(Math.min((m-u)/Fe,T)),Fe=(m-u)/Ot,bt=u,Rt=m):ve?(bt=le?u:bt,Rt=we?m:Rt,Ot=C-1,Fe=(Rt-bt)/Ot):(Ot=(Rt-bt)/Fe,Ot=Dy(Ot,Math.round(Ot),Fe/1e3)?Math.round(Ot):Math.ceil(Ot));const mi=Math.max(s2(Fe),s2(bt));lt=Math.pow(10,oi(y)?mi:y),bt=Math.round(bt*lt)/lt,Rt=Math.round(Rt*lt)/lt;let Zn=0;for(le&&(z&&bt!==u?(n.push({value:u}),bt<u&&Zn++,Dy(Math.round((bt+Zn*Fe)*lt)/lt,u,QP(u,Re,e))&&Zn++):bt<u&&Zn++);Zn<Ot;++Zn)n.push({value:Math.round((bt+Zn*Fe)*lt)/lt});return we&&z&&Rt!==m?n.length&&Dy(n[n.length-1].value,m,QP(m,Re,e))?n[n.length-1].value=m:n.push({value:m}):(!we||Rt===m)&&n.push({value:Rt}),n}({maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:!1!==n.includeBounds},this._range||this);return"ticks"===t.bounds&&o2(u,this,"value"),t.reverse?(u.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),u}configure(){const t=this.ticks;let n=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const o=(i-n)/Math.max(t.length-1,1)/2;n-=o,i+=o}this._startValue=n,this._endValue=i,this._valueRange=i-n}getLabelForValue(t){return Oy(t,this.chart.options.locale,this.options.ticks.format)}}class qE extends Nb{determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=Dr(t)?t:0,this.max=Dr(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),n=t?this.width:this.height,i=Yl(this.options.ticks.minRotation),o=(t?Math.sin(i):Math.cos(i))||.001,a=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,a.lineHeight/o))}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}function ek(e){return e/Math.pow(10,Math.floor(ol(e)))==1}qE.id="linear",qE.defaults={ticks:{callback:Sb.formatters.numeric}};class ZE extends gp{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,n){const i=Nb.prototype.parse.apply(this,[t,n]);if(0!==i)return Dr(i)&&i>0?i:null;this._zero=!0}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=Dr(t)?Math.max(0,t):null,this.max=Dr(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let i=this.min,o=this.max;const a=y=>i=t?i:y,u=y=>o=n?o:y,m=(y,C)=>Math.pow(10,Math.floor(ol(y))+C);i===o&&(i<=0?(a(1),u(10)):(a(m(i,-1)),u(m(o,1)))),i<=0&&a(m(o,-1)),o<=0&&u(m(i,1)),this._zero&&this.min!==this._suggestedMin&&i===m(this.min,0)&&a(m(i,-1)),this.min=i,this.max=o}buildTicks(){const t=this.options,i=function MH(e,t){const n=Math.floor(ol(t.max)),i=Math.ceil(t.max/Math.pow(10,n)),o=[];let a=il(e.min,Math.pow(10,Math.floor(ol(t.min)))),u=Math.floor(ol(a)),m=Math.floor(a/Math.pow(10,u)),y=u<0?Math.pow(10,Math.abs(u)):1;do{o.push({value:a,major:ek(a)}),++m,10===m&&(m=1,++u,y=u>=0?1:y),a=Math.round(m*Math.pow(10,u)*y)/y}while(u<n||u===n&&m<i);const C=il(e.max,a);return o.push({value:C,major:ek(a)}),o}({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&o2(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return void 0===t?"0":Oy(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=ol(t),this._valueRange=ol(this.max)-ol(t)}getPixelForValue(t){return(void 0===t||0===t)&&(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(ol(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const n=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+n*this._valueRange)}}function XE(e){const t=e.ticks;if(t.display&&e.display){const n=Qo(t.backdropPadding);return Dn(t.font&&t.font.size,Nn.font.size)+n.height}return 0}function IH(e,t,n){return n=Ai(n)?n:[n],{w:zU(e,t.string,n),h:n.length*t.lineHeight}}function tk(e,t,n,i,o){return e===i||e===o?{start:t-n/2,end:t+n/2}:e<i||e>o?{start:t-n,end:t}:{start:t,end:t+n}}function PH(e,t,n,i,o){const a=Math.abs(Math.sin(n)),u=Math.abs(Math.cos(n));let m=0,y=0;i.start<t.l?(m=(t.l-i.start)/a,e.l=Math.min(e.l,t.l-m)):i.end>t.r&&(m=(i.end-t.r)/a,e.r=Math.max(e.r,t.r+m)),o.start<t.t?(y=(t.t-o.start)/u,e.t=Math.min(e.t,t.t-y)):o.end>t.b&&(y=(o.end-t.b)/u,e.b=Math.max(e.b,t.b+y))}function RH(e){return 0===e||180===e?"center":e<180?"left":"right"}function OH(e,t,n){return"right"===n?e-=t:"center"===n&&(e-=t/2),e}function LH(e,t,n){return 90===n||270===n?e-=t/2:(n>270||n<90)&&(e-=t),e}function nk(e,t,n,i){const{ctx:o}=e;if(n)o.arc(e.xCenter,e.yCenter,t,0,Ei);else{let a=e.getPointPosition(0,t);o.moveTo(a.x,a.y);for(let u=1;u<i;u++)a=e.getPointPosition(u,t),o.lineTo(a.x,a.y)}}ZE.id="logarithmic",ZE.defaults={ticks:{callback:Sb.formatters.logarithmic,major:{enabled:!0}}};class Hy extends Nb{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=Qo(XE(this.options)/2),n=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+n/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(n,i)/2)}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!1);this.min=Dr(t)&&!isNaN(t)?t:0,this.max=Dr(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/XE(this.options))}generateTickLabels(t){Nb.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((n,i)=>{const o=Pi(this.options.pointLabels.callback,[n,i],this);return o||0===o?o:""}).filter((n,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?function AH(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},n=Object.assign({},t),i=[],o=[],a=e._pointLabels.length,u=e.options.pointLabels,m=u.centerPointLabels?qi/a:0;for(let y=0;y<a;y++){const C=u.setContext(e.getPointLabelContext(y));o[y]=C.padding;const T=e.getPointPosition(y,e.drawingArea+o[y],m),A=io(C.font),z=IH(e.ctx,A,e._pointLabels[y]);i[y]=z;const V=wa(e.getIndexAngle(y)+m),H=Math.round(pE(V));PH(n,t,V,tk(H,T.x,z.w,0,180),tk(H,T.y,z.h,90,270))}e.setCenterPoint(t.l-n.l,n.r-t.r,t.t-n.t,n.b-t.b),e._pointLabelItems=function kH(e,t,n){const i=[],o=e._pointLabels.length,a=e.options,u=XE(a)/2,m=e.drawingArea,y=a.pointLabels.centerPointLabels?qi/o:0;for(let C=0;C<o;C++){const T=e.getPointPosition(C,m+u+n[C],y),A=Math.round(pE(wa(T.angle+pr))),z=t[C],V=LH(T.y,z.h,A),H=RH(A),X=OH(T.x,z.w,H);i.push({x:T.x,y:V,textAlign:H,left:X,top:V,right:X+z.w,bottom:V+z.h})}return i}(e,i,o)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,n,i,o){this.xCenter+=Math.floor((t-n)/2),this.yCenter+=Math.floor((i-o)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,n,i,o))}getIndexAngle(t){return wa(t*(Ei/(this._pointLabels.length||1))+Yl(this.options.startAngle||0))}getDistanceFromCenterForValue(t){if(oi(t))return NaN;const n=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*n:(t-this.min)*n}getValueForDistanceFromCenter(t){if(oi(t))return NaN;const n=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-n:this.min+n}getPointLabelContext(t){const n=this._pointLabels||[];if(t>=0&&t<n.length){const i=n[t];return function NH(e,t,n){return Md(e,{label:n,index:t,type:"pointLabel"})}(this.getContext(),t,i)}}getPointPosition(t,n,i=0){const o=this.getIndexAngle(t)-pr+i;return{x:Math.cos(o)*n+this.xCenter,y:Math.sin(o)*n+this.yCenter,angle:o}}getPointPositionForValue(t,n){return this.getPointPosition(t,this.getDistanceFromCenterForValue(n))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:n,top:i,right:o,bottom:a}=this._pointLabelItems[t];return{left:n,top:i,right:o,bottom:a}}drawBackground(){const{backgroundColor:t,grid:{circular:n}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),nk(this,this.getDistanceFromCenterForValue(this._endValue),n,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,n=this.options,{angleLines:i,grid:o}=n,a=this._pointLabels.length;let u,m,y;if(n.pointLabels.display&&function FH(e,t){const{ctx:n,options:{pointLabels:i}}=e;for(let o=t-1;o>=0;o--){const a=i.setContext(e.getPointLabelContext(o)),u=io(a.font),{x:m,y,textAlign:C,left:T,top:A,right:z,bottom:V}=e._pointLabelItems[o],{backdropColor:H}=a;if(!oi(H)){const X=hp(a.borderRadius),oe=Qo(a.backdropPadding);n.fillStyle=H;const le=T-oe.left,we=A-oe.top,ve=z-T+oe.width,Re=V-A+oe.height;Object.values(X).some(Fe=>0!==Fe)?(n.beginPath(),ky(n,{x:le,y:we,w:ve,h:Re,radius:X}),n.fill()):n.fillRect(le,we,ve,Re)}up(n,e._pointLabels[o],m,y+u.lineHeight/2,u,{color:a.color,textAlign:C,textBaseline:"middle"})}}(this,a),o.display&&this.ticks.forEach((C,T)=>{0!==T&&(m=this.getDistanceFromCenterForValue(C.value),function zH(e,t,n,i){const o=e.ctx,a=t.circular,{color:u,lineWidth:m}=t;!a&&!i||!u||!m||n<0||(o.save(),o.strokeStyle=u,o.lineWidth=m,o.setLineDash(t.borderDash),o.lineDashOffset=t.borderDashOffset,o.beginPath(),nk(e,n,a,i),o.closePath(),o.stroke(),o.restore())}(this,o.setContext(this.getContext(T-1)),m,a))}),i.display){for(t.save(),u=a-1;u>=0;u--){const C=i.setContext(this.getPointLabelContext(u)),{color:T,lineWidth:A}=C;!A||!T||(t.lineWidth=A,t.strokeStyle=T,t.setLineDash(C.borderDash),t.lineDashOffset=C.borderDashOffset,m=this.getDistanceFromCenterForValue(n.ticks.reverse?this.min:this.max),y=this.getPointPosition(u,m),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(y.x,y.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,n=this.options,i=n.ticks;if(!i.display)return;const o=this.getIndexAngle(0);let a,u;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(o),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((m,y)=>{if(0===y&&!n.reverse)return;const C=i.setContext(this.getContext(y)),T=io(C.font);if(a=this.getDistanceFromCenterForValue(this.ticks[y].value),C.showLabelBackdrop){t.font=T.string,u=t.measureText(m.label).width,t.fillStyle=C.backdropColor;const A=Qo(C.backdropPadding);t.fillRect(-u/2-A.left,-a-T.size/2-A.top,u+A.width,T.size+A.height)}up(t,m.label,0,-a,T,{color:C.color})}),t.restore()}drawTitle(){}}Hy.id="radialLinear",Hy.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Sb.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:e=>e,padding:5,centerPointLabels:!1}},Hy.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},Hy.descriptors={angleLines:{_fallback:"grid"}};const Bb={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},qs=Object.keys(Bb);function BH(e,t){return e-t}function ik(e,t){if(oi(t))return null;const n=e._adapter,{parser:i,round:o,isoWeekday:a}=e._parseOpts;let u=t;return"function"==typeof i&&(u=i(u)),Dr(u)||(u="string"==typeof i?n.parse(u,i):n.parse(u)),null===u?null:(o&&(u="week"!==o||!Ey(a)&&!0!==a?n.startOf(u,o):n.startOf(u,"isoWeek",a)),+u)}function rk(e,t,n,i){const o=qs.length;for(let a=qs.indexOf(e);a<o-1;++a){const u=Bb[qs[a]];if(u.common&&Math.ceil((n-t)/((u.steps?u.steps:Number.MAX_SAFE_INTEGER)*u.size))<=i)return qs[a]}return qs[o-1]}function ok(e,t,n){if(n){if(n.length){const{lo:i,hi:o}=DE(n,t);e[n[i]>=t?n[i]:n[o]]=!0}}else e[t]=!0}function sk(e,t,n){const i=[],o={},a=t.length;let u,m;for(u=0;u<a;++u)m=t[u],o[m]=u,i.push({value:m,major:!1});return 0!==a&&n?function UH(e,t,n,i){const o=e._adapter,a=+o.startOf(t[0].value,i),u=t[t.length-1].value;let m,y;for(m=a;m<=u;m=+o.add(m,1,i))y=n[m],y>=0&&(t[y].major=!0);return t}(e,i,o,n):i}let YE=(()=>{class e extends gp{constructor(n){super(n),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(n,i){const o=n.time||(n.time={}),a=this._adapter=new c$._date(n.adapters.date);wy(o.displayFormats,a.formats()),this._parseOpts={parser:o.parser,round:o.round,isoWeekday:o.isoWeekday},super.init(n),this._normalized=i.normalized}parse(n,i){return void 0===n?null:ik(this,n)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const n=this.options,i=this._adapter,o=n.time.unit||"day";let{min:a,max:u,minDefined:m,maxDefined:y}=this.getUserBounds();function C(T){!m&&!isNaN(T.min)&&(a=Math.min(a,T.min)),!y&&!isNaN(T.max)&&(u=Math.max(u,T.max))}(!m||!y)&&(C(this._getLabelBounds()),("ticks"!==n.bounds||"labels"!==n.ticks.source)&&C(this.getMinMax(!1))),a=Dr(a)&&!isNaN(a)?a:+i.startOf(Date.now(),o),u=Dr(u)&&!isNaN(u)?u:+i.endOf(Date.now(),o)+1,this.min=Math.min(a,u-1),this.max=Math.max(a+1,u)}_getLabelBounds(){const n=this.getLabelTimestamps();let i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;return n.length&&(i=n[0],o=n[n.length-1]),{min:i,max:o}}buildTicks(){const n=this.options,i=n.time,o=n.ticks,a="labels"===o.source?this.getLabelTimestamps():this._generate();"ticks"===n.bounds&&a.length&&(this.min=this._userMin||a[0],this.max=this._userMax||a[a.length-1]);const u=this.min,y=function ZU(e,t,n){let i=0,o=e.length;for(;i<o&&e[i]<t;)i++;for(;o>i&&e[o-1]>n;)o--;return i>0||o<e.length?e.slice(i,o):e}(a,u,this.max);return this._unit=i.unit||(o.autoSkip?rk(i.minUnit,this.min,this.max,this._getLabelCapacity(u)):function VH(e,t,n,i,o){for(let a=qs.length-1;a>=qs.indexOf(n);a--){const u=qs[a];if(Bb[u].common&&e._adapter.diff(o,i,u)>=t-1)return u}return qs[n?qs.indexOf(n):0]}(this,y.length,i.minUnit,this.min,this.max)),this._majorUnit=o.major.enabled&&"year"!==this._unit?function jH(e){for(let t=qs.indexOf(e)+1,n=qs.length;t<n;++t)if(Bb[qs[t]].common)return qs[t]}(this._unit):void 0,this.initOffsets(a),n.reverse&&y.reverse(),sk(this,y,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(n=>+n.value))}initOffsets(n){let a,u,i=0,o=0;this.options.offset&&n.length&&(a=this.getDecimalForValue(n[0]),i=1===n.length?1-a:(this.getDecimalForValue(n[1])-a)/2,u=this.getDecimalForValue(n[n.length-1]),o=1===n.length?u:(u-this.getDecimalForValue(n[n.length-2]))/2);const m=n.length<3?.5:.25;i=yo(i,0,m),o=yo(o,0,m),this._offsets={start:i,end:o,factor:1/(i+1+o)}}_generate(){const n=this._adapter,i=this.min,o=this.max,a=this.options,u=a.time,m=u.unit||rk(u.minUnit,i,o,this._getLabelCapacity(i)),y=Dn(u.stepSize,1),C="week"===m&&u.isoWeekday,T=Ey(C)||!0===C,A={};let V,H,z=i;if(T&&(z=+n.startOf(z,"isoWeek",C)),z=+n.startOf(z,T?"day":m),n.diff(o,i,m)>1e5*y)throw new Error(i+" and "+o+" are too far apart with stepSize of "+y+" "+m);const X="data"===a.ticks.source&&this.getDataTimestamps();for(V=z,H=0;V<o;V=+n.add(V,y,m),H++)ok(A,V,X);return(V===o||"ticks"===a.bounds||1===H)&&ok(A,V,X),Object.keys(A).sort((oe,le)=>oe-le).map(oe=>+oe)}getLabelForValue(n){const o=this.options.time;return this._adapter.format(n,o.tooltipFormat?o.tooltipFormat:o.displayFormats.datetime)}_tickFormatFunction(n,i,o,a){const u=this.options,m=u.time.displayFormats,y=this._unit,C=this._majorUnit,A=C&&m[C],z=o[i],H=this._adapter.format(n,a||(C&&A&&z&&z.major?A:y&&m[y])),X=u.ticks.callback;return X?Pi(X,[H,i,o],this):H}generateTickLabels(n){let i,o,a;for(i=0,o=n.length;i<o;++i)a=n[i],a.label=this._tickFormatFunction(a.value,i,n)}getDecimalForValue(n){return null===n?NaN:(n-this.min)/(this.max-this.min)}getPixelForValue(n){const i=this._offsets,o=this.getDecimalForValue(n);return this.getPixelForDecimal((i.start+o)*i.factor)}getValueForPixel(n){const i=this._offsets,o=this.getDecimalForPixel(n)/i.factor-i.end;return this.min+o*(this.max-this.min)}_getLabelSize(n){const i=this.options.ticks,o=this.ctx.measureText(n).width,a=Yl(this.isHorizontal()?i.maxRotation:i.minRotation),u=Math.cos(a),m=Math.sin(a),y=this._resolveTickFontOptions(0).size;return{w:o*u+y*m,h:o*m+y*u}}_getLabelCapacity(n){const i=this.options.time,o=i.displayFormats,a=o[i.unit]||o.millisecond,u=this._tickFormatFunction(n,0,sk(this,[n],this._majorUnit),a),m=this._getLabelSize(u),y=Math.floor(this.isHorizontal()?this.width/m.w:this.height/m.h)-1;return y>0?y:1}getDataTimestamps(){let i,o,n=this._cache.data||[];if(n.length)return n;const a=this.getMatchingVisibleMetas();if(this._normalized&&a.length)return this._cache.data=a[0].controller.getAllParsedValues(this);for(i=0,o=a.length;i<o;++i)n=n.concat(a[i].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const n=this._cache.labels||[];let i,o;if(n.length)return n;const a=this.getLabels();for(i=0,o=a.length;i<o;++i)n.push(ik(this,a[i]));return this._cache.labels=this._normalized?n:this.normalize(n)}normalize(n){return E2(n.sort(BH))}}return e.id="time",e.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}},e})();function Vb(e,t,n){let a,u,m,y,i=0,o=e.length-1;n?(t>=e[i].pos&&t<=e[o].pos&&({lo:i,hi:o}=Gu(e,"pos",t)),({pos:a,time:m}=e[i]),({pos:u,time:y}=e[o])):(t>=e[i].time&&t<=e[o].time&&({lo:i,hi:o}=Gu(e,"time",t)),({time:a,pos:m}=e[i]),({time:u,pos:y}=e[o]));const C=u-a;return C?m+(y-m)*(t-a)/C:m}class KE extends YE{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(t);this._minPos=Vb(n,this.min),this._tableRange=Vb(n,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:n,max:i}=this,o=[],a=[];let u,m,y,C,T;for(u=0,m=t.length;u<m;++u)C=t[u],C>=n&&C<=i&&o.push(C);if(o.length<2)return[{time:n,pos:0},{time:i,pos:1}];for(u=0,m=o.length;u<m;++u)T=o[u+1],y=o[u-1],C=o[u],Math.round((T+y)/2)!==C&&a.push({time:C,pos:u/(m-1)});return a}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const n=this.getDataTimestamps(),i=this.getLabelTimestamps();return t=n.length&&i.length?this.normalize(n.concat(i)):n.length?n:i,t=this._cache.all=t,t}getDecimalForValue(t){return(Vb(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return Vb(this._table,i*this._tableRange+this._minPos,!0)}}KE.id="timeseries",KE.defaults=YE.defaults;const HH=[l$,N6,CH,Object.freeze({__proto__:null,CategoryScale:zb,LinearScale:qE,LogarithmicScale:ZE,RadialLinearScale:Hy,TimeScale:YE,TimeSeriesScale:KE})];function ak(e,t=rs){return e=e??GH,gi((n,i)=>{let o,a=!0;n.subscribe(Yn(i,u=>{const m=t(u);(a||!e(o,m))&&(a=!1,o=m,i.next(u))}))})}function GH(e,t){return e===t}const jb=function ZH(e,t){return e===t||e!=e&&t!=t},Ub=function XH(e,t){for(var n=e.length;n--;)if(jb(e[n][0],t))return n;return-1};var KH=Array.prototype.splice;function ag(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}ag.prototype.clear=function WH(){this.__data__=[],this.size=0},ag.prototype.delete=function JH(e){var t=this.__data__,n=Ub(t,e);return!(n<0||(n==t.length-1?t.pop():KH.call(t,n,1),--this.size,0))},ag.prototype.get=function e8(e){var t=this.__data__,n=Ub(t,e);return n<0?void 0:t[n][1]},ag.prototype.has=function n8(e){return Ub(this.__data__,e)>-1},ag.prototype.set=function r8(e,t){var n=this.__data__,i=Ub(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this};const $b=ag,lk="object"==typeof global&&global&&global.Object===Object&&global;var m8="object"==typeof self&&self&&self.Object===Object&&self;const lg=lk||m8||Function("return this")();var _8=lg.Symbol,ck=Object.prototype,y8=ck.hasOwnProperty,v8=ck.toString,Gy=_8?_8.toStringTag:void 0;var C8=Object.prototype.toString;var uk=_8?_8.toStringTag:void 0;const Gb=function M8(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":uk&&uk in Object(e)?function x8(e){var t=y8.call(e,Gy),n=e[Gy];try{e[Gy]=void 0;var i=!0}catch{}var o=v8.call(e);return i&&(t?e[Gy]=n:delete e[Gy]),o}(e):function E8(e){return C8.call(e)}(e)},_p=function I8(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const JE=function O8(e){if(!_p(e))return!1;var t=Gb(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};var e,L8=lg["__core-js_shared__"],hk=(e=/[^.]+$/.exec(L8&&L8.keys&&L8.keys.IE_PROTO||""))?"Symbol(src)_1."+e:"";var B8=Function.prototype.toString;var $8=/^\[object .+?Constructor\]$/,Z8=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Y8=function X8(e){return!(!_p(e)||function F8(e){return!!hk&&hk in e}(e))&&(JE(e)?Z8:$8).test(function V8(e){if(null!=e){try{return B8.call(e)}catch{}try{return e+""}catch{}}return""}(e))},eD=function Q8(e,t){var n=function K8(e,t){return e?.[t]}(e,t);return Y8(n)?n:void 0},dk=eD(lg,"Map"),Wy=eD(Object,"create");var lG=Object.prototype.hasOwnProperty;var dG=Object.prototype.hasOwnProperty;function cg(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}cg.prototype.clear=function nG(){this.__data__=Wy?Wy(null):{},this.size=0},cg.prototype.delete=function rG(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},cg.prototype.get=function cG(e){var t=this.__data__;if(Wy){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return lG.call(t,e)?t[e]:void 0},cg.prototype.has=function fG(e){var t=this.__data__;return Wy?void 0!==t[e]:dG.call(t,e)},cg.prototype.set=function gG(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Wy&&void 0===t?"__lodash_hash_undefined__":t,this};const fk=cg,Wb=function wG(e,t){var n=e.__data__;return function xG(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map};function ug(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}ug.prototype.clear=function yG(){this.size=0,this.__data__={hash:new fk,map:new(dk||$b),string:new fk}},ug.prototype.delete=function CG(e){var t=Wb(this,e).delete(e);return this.size-=t?1:0,t},ug.prototype.get=function DG(e){return Wb(this,e).get(e)},ug.prototype.has=function SG(e){return Wb(this,e).has(e)},ug.prototype.set=function IG(e,t){var n=Wb(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this};const PG=ug;function hg(e){var t=this.__data__=new $b(e);this.size=t.size}hg.prototype.clear=function s8(){this.__data__=new $b,this.size=0},hg.prototype.delete=function l8(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},hg.prototype.get=function u8(e){return this.__data__.get(e)},hg.prototype.has=function d8(e){return this.__data__.has(e)},hg.prototype.set=function RG(e,t){var n=this.__data__;if(n instanceof $b){var i=n.__data__;if(!dk||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new PG(i)}return n.set(e,t),this.size=n.size,this};const LG=hg;var FG=function(){try{var e=eD(Object,"defineProperty");return e({},"",{}),e}catch{}}();const qb=FG,tD=function zG(e,t,n){"__proto__"==t&&qb?qb(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},nD=function NG(e,t,n){(void 0!==n&&!jb(e[t],n)||void 0===n&&!(t in e))&&tD(e,t,n)};var VG=function BG(e){return function(t,n,i){for(var o=-1,a=Object(t),u=i(t),m=u.length;m--;){var y=u[e?m:++o];if(!1===n(a[y],y,a))break}return t}}();const jG=VG;var pk="object"==typeof exports&&exports&&!exports.nodeType&&exports,mk=pk&&"object"==typeof module&&module&&!module.nodeType&&module,gk=mk&&mk.exports===pk?lg.Buffer:void 0,_k=gk?gk.allocUnsafe:void 0;const yk=lg.Uint8Array,XG=function ZG(e,t){var n=t?function WG(e){var t=new e.constructor(e.byteLength);return new yk(t).set(new yk(e)),t}(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};var vk=Object.create,JG=function(){function e(){}return function(t){if(!_p(t))return{};if(vk)return vk(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const QG=JG;var tW=function eW(e,t){return function(n){return e(t(n))}}(Object.getPrototypeOf,Object);const xk=tW;var nW=Object.prototype;const bk=function iW(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||nW)},qy=function sW(e){return null!=e&&"object"==typeof e};const wk=function lW(e){return qy(e)&&"[object Arguments]"==Gb(e)};var Ck=Object.prototype,cW=Ck.hasOwnProperty,uW=Ck.propertyIsEnumerable,hW=wk(function(){return arguments}())?wk:function(e){return qy(e)&&cW.call(e,"callee")&&!uW.call(e,"callee")};const iD=hW,rD=Array.isArray;const Ek=function pW(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},oD=function mW(e){return null!=e&&Ek(e.length)&&!JE(e)};var Dk="object"==typeof exports&&exports&&!exports.nodeType&&exports,Tk=Dk&&"object"==typeof module&&module&&!module.nodeType&&module,Sk=Tk&&Tk.exports===Dk?lg.Buffer:void 0;const Mk=(Sk?Sk.isBuffer:void 0)||function yW(){return!1};var Ik=Function.prototype.toString,TW=Object.prototype.hasOwnProperty,SW=Ik.call(Object);var Vi={};Vi["[object Float32Array]"]=Vi["[object Float64Array]"]=Vi["[object Int8Array]"]=Vi["[object Int16Array]"]=Vi["[object Int32Array]"]=Vi["[object Uint8Array]"]=Vi["[object Uint8ClampedArray]"]=Vi["[object Uint16Array]"]=Vi["[object Uint32Array]"]=!0,Vi["[object Arguments]"]=Vi["[object Array]"]=Vi["[object ArrayBuffer]"]=Vi["[object Boolean]"]=Vi["[object DataView]"]=Vi["[object Date]"]=Vi["[object Error]"]=Vi["[object Function]"]=Vi["[object Map]"]=Vi["[object Number]"]=Vi["[object Object]"]=Vi["[object RegExp]"]=Vi["[object Set]"]=Vi["[object String]"]=Vi["[object WeakMap]"]=!1;var Ak="object"==typeof exports&&exports&&!exports.nodeType&&exports,Zy=Ak&&"object"==typeof module&&module&&!module.nodeType&&module,sD=Zy&&Zy.exports===Ak&&lk.process,oq=function(){try{return Zy&&Zy.require&&Zy.require("util").types||sD&&sD.binding&&sD.binding("util")}catch{}}(),kk=oq&&oq.isTypedArray;const Rk=kk?function nq(e){return function(t){return e(t)}}(kk):function eq(e){return qy(e)&&Ek(e.length)&&!!Vi[Gb(e)]},aD=function aq(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]};var cq=Object.prototype.hasOwnProperty;const hq=function uq(e,t,n){var i=e[t];(!cq.call(e,t)||!jb(i,n)||void 0===n&&!(t in e))&&tD(e,t,n)};var _q=/^(?:0|[1-9]\d*)$/;const Ok=function yq(e,t){var n=typeof e;return!!(t=t??9007199254740991)&&("number"==n||"symbol"!=n&&_q.test(e))&&e>-1&&e%1==0&&e<t};var xq=Object.prototype.hasOwnProperty;const wq=function bq(e,t){var n=rD(e),i=!n&&iD(e),o=!n&&!i&&Mk(e),a=!n&&!i&&!o&&Rk(e),u=n||i||o||a,m=u?function pq(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}(e.length,String):[],y=m.length;for(var C in e)(t||xq.call(e,C))&&(!u||!("length"==C||o&&("offset"==C||"parent"==C)||a&&("buffer"==C||"byteLength"==C||"byteOffset"==C)||Ok(C,y)))&&m.push(C);return m};var Tq=Object.prototype.hasOwnProperty;const Mq=function Sq(e){if(!_p(e))return function Cq(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=bk(e),n=[];for(var i in e)"constructor"==i&&(t||!Tq.call(e,i))||n.push(i);return n},Lk=function Iq(e){return oD(e)?wq(e,!0):Mq(e)},Pq=function Aq(e){return function dq(e,t,n,i){var o=!n;n||(n={});for(var a=-1,u=t.length;++a<u;){var m=t[a],y=i?i(n[m],e[m],m,n,e):void 0;void 0===y&&(y=e[m]),o?tD(n,m,y):hq(n,m,y)}return n}(e,Lk(e))},Rq=function kq(e,t,n,i,o,a,u){var m=aD(e,n),y=aD(t,n),C=u.get(y);if(C)nD(e,n,C);else{var T=a?a(m,y,n+"",e,t,u):void 0,A=void 0===T;if(A){var z=rD(y),V=!z&&Mk(y),H=!z&&!V&&Rk(y);T=y,z||V||H?rD(m)?T=m:function gW(e){return qy(e)&&oD(e)}(m)?T=function YG(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}(m):V?(A=!1,T=function $G(e,t){if(t)return e.slice();var n=e.length,i=_k?_k(n):new e.constructor(n);return e.copy(i),i}(y,!0)):H?(A=!1,T=XG(y,!0)):T=[]:function MW(e){if(!qy(e)||"[object Object]"!=Gb(e))return!1;var t=xk(e);if(null===t)return!0;var n=TW.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Ik.call(n)==SW}(y)||iD(y)?(T=m,iD(m)?T=Pq(m):(!_p(m)||JE(m))&&(T=function rW(e){return"function"!=typeof e.constructor||bk(e)?{}:QG(xk(e))}(y))):A=!1}A&&(u.set(y,T),o(T,y,i,a,u),u.delete(y)),nD(e,n,T)}},Oq=function Fk(e,t,n,i,o){e!==t&&jG(t,function(a,u){if(o||(o=new LG),_p(a))Rq(e,t,u,n,Fk,i,o);else{var m=i?i(aD(e,u),a,u+"",e,t,o):void 0;void 0===m&&(m=a),nD(e,u,m)}},Lk)},zk=function Lq(e){return e},zq=function Fq(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)};var Nk=Math.max;const jq=function Vq(e){return function(){return e}};var Uq=qb?function(e,t){return qb(e,"toString",{configurable:!0,enumerable:!1,value:jq(t),writable:!0})}:zk,Hq=800,Gq=16,Wq=Date.now,Zq=function qq(e){var t=0,n=0;return function(){var i=Wq(),o=Gq-(i-n);if(n=i,o>0){if(++t>=Hq)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Uq);const Xq=Zq,Kq=function Yq(e,t){return Xq(function Nq(e,t,n){return t=Nk(void 0===t?e.length-1:t,0),function(){for(var i=arguments,o=-1,a=Nk(i.length-t,0),u=Array(a);++o<a;)u[o]=i[t+o];o=-1;for(var m=Array(t+1);++o<t;)m[o]=i[o];return m[t]=n(u),zq(e,this,m)}}(e,t,zk),e+"")};var t9=function e9(e){return Kq(function(t,n){var i=-1,o=n.length,a=o>1?n[o-1]:void 0,u=o>2?n[2]:void 0;for(a=e.length>3&&"function"==typeof a?(o--,a):void 0,u&&function Jq(e,t,n){if(!_p(n))return!1;var i=typeof t;return!!("number"==i?oD(n)&&Ok(t,n.length):"string"==i&&t in n)&&jb(n[t],e)}(n[0],n[1],u)&&(a=o<3?void 0:a,o=1),t=Object(t);++i<o;){var m=n[i];m&&e(t,m,i,a)}return t})}(function(e,t,n){Oq(e,t,n)});const Bk=t9;let n9=(()=>{class e{constructor(){this.colorschemesOptions=new xa(void 0)}setColorschemesOptions(n){this.pColorschemesOptions=n,this.colorschemesOptions.next(n)}getColorschemesOptions(){return this.pColorschemesOptions}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),i9=(()=>{class e{constructor(n,i,o){this.zone=i,this.themeService=o,this.type="bar",this.plugins=[],this.chartClick=new Mi,this.chartHover=new Mi,this.subs=[],this.ctx=n.nativeElement.getContext("2d"),this.subs.push(this.themeService.colorschemesOptions.pipe(ak()).subscribe(a=>this.themeChanged(a)))}ngOnChanges(n){const i=["type"],o=Object.getOwnPropertyNames(n);if(o.some(a=>i.includes(a))||o.every(a=>n[a].isFirstChange()))this.render();else{const a=this.getChartConfiguration();this.chart&&(Object.assign(this.chart.config.data,a.data),this.chart.config.plugins&&Object.assign(this.chart.config.plugins,a.plugins),this.chart.config.options&&Object.assign(this.chart.config.options,a.options)),this.update()}}ngOnDestroy(){this.chart&&(this.chart.destroy(),this.chart=void 0),this.subs.forEach(n=>n.unsubscribe())}render(){return this.chart&&this.chart.destroy(),og.register(...this.plugins),this.zone.runOutsideAngular(()=>this.chart=new og(this.ctx,this.getChartConfiguration()))}update(n){this.chart&&this.zone.runOutsideAngular(()=>this.chart?.update(n))}hideDataset(n,i){this.chart&&(this.chart.getDatasetMeta(n).hidden=i,this.update())}isDatasetHidden(n){return this.chart?.getDatasetMeta(n)?.hidden}toBase64Image(){return this.chart?.toBase64Image()}themeChanged(n){this.themeOverrides=n,this.chart&&(this.chart.config.options&&Object.assign(this.chart.config.options,this.getChartOptions()),this.update())}getChartOptions(){return Bk({onHover:(n,i)=>{!this.chartHover.observed&&!this.chartHover.observers?.length||this.zone.run(()=>this.chartHover.emit({event:n,active:i}))},onClick:(n,i)=>{!this.chartClick.observed&&!this.chartClick.observers?.length||this.zone.run(()=>this.chartClick.emit({event:n,active:i}))}},this.themeOverrides,this.options,{plugins:{legend:{display:this.legend}}})}getChartConfiguration(){return{type:this.type,data:this.getChartData(),options:this.getChartOptions()}}getChartData(){return this.data?this.data:{labels:this.labels||[],datasets:this.datasets||[]}}}return e.\u0275fac=function(n){return new(n||e)(Qe(Po),Qe(rr),Qe(n9))},e.\u0275dir=Ft({type:e,selectors:[["canvas","baseChart",""]],inputs:{type:"type",legend:"legend",data:"data",options:"options",plugins:"plugins",labels:"labels",datasets:"datasets"},outputs:{chartClick:"chartClick",chartHover:"chartHover"},exportAs:["base-chart"],features:[qr]}),e})();const r9=[[255,99,132],[54,162,235],[255,206,86],[231,233,237],[75,192,192],[151,187,205],[220,220,220],[247,70,74],[70,191,189],[253,180,92],[148,159,177],[77,83,96]],o9={datasets:{line:{backgroundColor:e=>bs(ws(e.datasetIndex),.4),borderColor:e=>bs(ws(e.datasetIndex),1),pointBackgroundColor:e=>bs(ws(e.datasetIndex),1),pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:e=>bs(ws(e.datasetIndex),.8)},bar:{backgroundColor:e=>bs(ws(e.datasetIndex),.6),borderColor:e=>bs(ws(e.datasetIndex),1),hoverBackgroundColor:e=>bs(ws(e.datasetIndex),.8),hoverBorderColor:e=>bs(ws(e.datasetIndex),1)},get radar(){return this.line},doughnut:{backgroundColor:e=>bs(ws(e.dataIndex),.6),borderColor:"#fff",hoverBackgroundColor:e=>bs(ws(e.dataIndex),1),hoverBorderColor:e=>bs(ws(e.dataIndex),1)},get pie(){return this.doughnut},polarArea:{backgroundColor:e=>bs(ws(e.dataIndex),.6),borderColor:e=>bs(ws(e.dataIndex),1),hoverBackgroundColor:e=>bs(ws(e.dataIndex),.8),hoverBorderColor:e=>bs(ws(e.dataIndex),1)},get bubble(){return this.doughnut},get scatter(){return this.doughnut},get area(){return this.polarArea}}};function bs(e,t){return"rgba("+e.concat(t).join(",")+")"}function lD(e,t){return Math.floor(Math.random()*(t-e+1))+e}function ws(e=0){return r9[e]||function s9(){return[lD(0,255),lD(0,255),lD(0,255)]}()}let Vk=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();og.register(...HH);let a9=(()=>{class e{constructor(n){n?.plugins&&og.register(...n?.plugins);const i=Bk(o9,n?.defaults||{});Nn.set(i)}static forRoot(n){return{ngModule:e,providers:[{provide:Vk,useValue:n}]}}}return e.\u0275fac=function(n){return new(n||e)(Dt(Vk,8))},e.\u0275mod=lr({type:e}),e.\u0275inj=Ui({imports:[[]]}),e})();var jk=Ku(898);let Uk=(()=>{class e{constructor(n){this.data=n}ngOnInit(){this.getSettings(),this.map=new jk.Map({accessToken:"pk.eyJ1IjoidnVxYXJhaG1hZGxpIiwiYSI6ImNsbnFzbjhvbzEwc2Uya29jbHZjZjl4MTcifQ.34q-bkR2bTN0BHb2FXAIzQ",container:"map",style:"mapbox://styles/mapbox/satellite-streets-v12",center:[28.858942999999787,41.11145899999985],zoom:8.5});let n=!1;this.map.on("load",()=>{this.json.features.forEach((i,o)=>{n=!n,this.map.addSource("maine"+o,{type:"geojson",data:i}),this.map.addLayer({id:"maine"+o,type:"fill",source:"maine"+o,layout:{},paint:{"fill-color":n?"#e69d00":"#e1ff00","fill-opacity":.7}})})})}getSettings(){this.data.getist("istanbul-nufus-geojson.geojson").subscribe(n=>{this.json=n})}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(eg))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-map"]],decls:1,vars:0,consts:[["id","map",1,"match-parent"]],template:function(i,o){1&i&&Zt(0,"div",0)},styles:[".match-parent[_ngcontent-%COMP%]{width:100%;height:100%}"]})}return e})();function l9(e,t){if(1&e&&(ht(0,"div",6)(1,"div"),si(2),gt(),Zt(3,"canvas",9),gt()),2&e){const n=br();kt(2),zc(" ",n.bardsc.title," "),kt(1),xt("data",n.barChartDataD)("options",n.barChartOptions)("plugins",n.barChartPlugins)("legend",n.barChartLegend)("type","bar")}}function c9(e,t){if(1&e&&(ht(0,"div",6)(1,"div"),si(2),gt(),Zt(3,"canvas",9),gt()),2&e){const n=br();kt(2),zc(" ",n.barasc.title," "),kt(1),xt("data",n.barChartData)("options",n.barChartOptions)("plugins",n.barChartPlugins)("legend",n.barChartLegend)("type","bar")}}function u9(e,t){if(1&e&&(ht(0,"div",6)(1,"div"),si(2),gt(),Zt(3,"canvas",10),gt()),2&e){const n=br();kt(2),zc(" ",n.pie.title," "),kt(1),xt("type","pie")("datasets",n.pieChartDatasets)("labels",n.pieChartLabels)("options",n.pieChartOptions)("plugins",n.pieChartPlugins)("legend",n.pieChartLegend)}}function h9(e,t){if(1&e&&(ht(0,"div"),si(1),gt()),2&e){const n=br();kt(1),zc(" ",n.AllData.title," ")}}function d9(e,t){if(1&e&&(ht(0,"th"),si(1),gt()),2&e){const n=t.$implicit;nx("width","answer"==n.field?"300px":""),kt(1),_o(n.title)}}function f9(e,t){if(1&e&&(ht(0,"tr")(1,"td"),si(2),gt(),ht(3,"td"),si(4),gt(),ht(5,"td"),si(6),gt()()),2&e){const n=t.$implicit;kt(2),_o(n.id),kt(2),_o(n.label),kt(2),_o(n.answer)}}let p9=(()=>{class e{ngAfterViewInit(){}constructor(n){this.data=n,this.pieChartOptions={responsive:!1},this.pieChartLegend=!0,this.pieChartPlugins=[],this.barChartLegend=!0,this.barChartPlugins=[],this.barChartOptions={responsive:!1}}ngOnInit(){this.getpie(),this.getbarasc(),this.getbardsc(),this.gettable()}getpie(){this.data.getpie("3-item-view/all-pie-chart.json").subscribe(n=>{this.pie=n,this.pieChartLabels=this.pie.data.map(i=>i.label),this.pieChartDatasets=[{data:this.pie.data.map(i=>i.vote)}]})}gettable(){this.data.getpie("3-item-view/list-of-results.json").subscribe(n=>{this.AllData=n})}getbarasc(){this.data.getpie("3-item-view/top-10-ascending.json").subscribe(n=>{this.barasc=n,this.barChartData={labels:this.barasc.data.map(i=>i.label),datasets:[{data:this.barasc.data.map(i=>i.vote),label:"",backgroundColor:["green","green"]}]}})}getbardsc(){this.data.getpie("3-item-view/top-10-desc.json").subscribe(n=>{this.bardsc=n,this.barChartDataD={labels:this.bardsc.data.map(i=>i.label),datasets:[{data:this.bardsc.data.map(i=>i.vote),label:"",backgroundColor:["red","red"]}]}})}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(eg))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-item-details"]],decls:13,vars:6,consts:[[1,"detail"],[1,"left"],[2,"width","100%","height","100%"],[1,"right"],["class","title",4,"ngIf"],[4,"ngIf"],[1,"title"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["baseChart","",1,"c2",3,"data","options","plugins","legend","type"],["baseChart","",1,"c1",3,"type","datasets","labels","options","plugins","legend"]],template:function(i,o){1&i&&(ht(0,"div",0)(1,"div",1),Zt(2,"app-map",2),gt(),ht(3,"div",3),qt(4,l9,4,6,"div",4),qt(5,c9,4,6,"div",4),qt(6,u9,4,7,"div",4),qt(7,h9,2,1,"div",5),ht(8,"div",6)(9,"table")(10,"tr"),qt(11,d9,2,3,"th",7),gt(),qt(12,f9,7,3,"tr",8),gt()()()()),2&i&&(kt(4),xt("ngIf",o.bardsc),kt(1),xt("ngIf",o.barasc),kt(1),xt("ngIf",o.pie),kt(1),xt("ngIf",o.AllData),kt(4),xt("ngForOf",null==o.AllData?null:o.AllData.columns),kt(1),xt("ngForOf",null==o.AllData?null:o.AllData.data))},dependencies:[Vm,J_,i9,Uk],styles:[".detail[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;width:100%;height:100%;display:flex;justify-content:space-between;padding:10px}.right[_ngcontent-%COMP%], .left[_ngcontent-%COMP%]{box-sizing:border-box;height:calc(100% - 20px);border-radius:8px}.right[_ngcontent-%COMP%]{width:calc(30% - 10px);height:100%;padding:15px;display:flex;flex-direction:column;overflow-y:scroll}.left[_ngcontent-%COMP%]{width:calc(70% - 10px);height:100%;border:3px solid rgb(22,22,22)}.map-container[_ngcontent-%COMP%]{width:100%;height:100%}.c1[_ngcontent-%COMP%]{margin-top:4px;padding:20px;width:100%;height:100%;border-radius:5px}.c2[_ngcontent-%COMP%]{margin-top:4px;padding:5px;width:100%;border-radius:5px}.title[_ngcontent-%COMP%]{margin-bottom:5px}.right[_ngcontent-%COMP%]::-webkit-scrollbar{width:10px}.right[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#101213}.right[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#3f3e3e}.right[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:13px;padding-left:10px}@media screen and (max-width: 881px){.detail[_ngcontent-%COMP%]{flex-wrap:wrap;overflow-y:scroll}.left[_ngcontent-%COMP%]{height:50%}.right[_ngcontent-%COMP%], .left[_ngcontent-%COMP%]{width:100%}.right[_ngcontent-%COMP%]{align-items:center}}"]})}return e})(),$k=(()=>{class e{constructor(n,i){this._renderer=n,this._elementRef=i,this.onChange=o=>{},this.onTouched=()=>{}}setProperty(n,i){this._renderer.setProperty(this._elementRef.nativeElement,n,i)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}}return e.\u0275fac=function(n){return new(n||e)(Qe(jl),Qe(Po))},e.\u0275dir=Ft({type:e}),e})(),yp=(()=>{class e extends $k{}return e.\u0275fac=function(){let t;return function(i){return(t||(t=Yr(e)))(i||e)}}(),e.\u0275dir=Ft({type:e,features:[ri]}),e})();const Hc=new Mt("NgValueAccessor"),_9={provide:Hc,useExisting:Hn(()=>Zb),multi:!0},v9=new Mt("CompositionEventMode");let Zb=(()=>{class e extends $k{constructor(n,i,o){super(n,i),this._compositionMode=o,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function y9(){const e=zu()?zu().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(n){this.setProperty("value",n??"")}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}}return e.\u0275fac=function(n){return new(n||e)(Qe(jl),Qe(Po),Qe(v9,8))},e.\u0275dir=Ft({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,i){1&n&&Mn("input",function(a){return i._handleInput(a.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(a){return i._compositionEnd(a.target.value)})},features:[Wi([_9]),ri]}),e})();const x9=!1;function Pd(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function Gk(e){return null!=e&&"number"==typeof e.length}const ts=new Mt("NgValidators"),kd=new Mt("NgAsyncValidators"),b9=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Wk{static min(t){return function qk(e){return t=>{if(Pd(t.value)||Pd(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n<e?{min:{min:e,actual:t.value}}:null}}(t)}static max(t){return function Zk(e){return t=>{if(Pd(t.value)||Pd(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n>e?{max:{max:e,actual:t.value}}:null}}(t)}static required(t){return function Xk(e){return Pd(e.value)?{required:!0}:null}(t)}static requiredTrue(t){return function Yk(e){return!0===e.value?null:{required:!0}}(t)}static email(t){return function Kk(e){return Pd(e.value)||b9.test(e.value)?null:{email:!0}}(t)}static minLength(t){return function Jk(e){return t=>Pd(t.value)||!Gk(t.value)?null:t.value.length<e?{minlength:{requiredLength:e,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function Qk(e){return t=>Gk(t.value)&&t.value.length>e?{maxlength:{requiredLength:e,actualLength:t.value.length}}:null}(t)}static pattern(t){return function eR(e){if(!e)return Xb;let t,n;return"string"==typeof e?(n="","^"!==e.charAt(0)&&(n+="^"),n+=e,"$"!==e.charAt(e.length-1)&&(n+="$"),t=new RegExp(n)):(n=e.toString(),t=e),i=>{if(Pd(i.value))return null;const o=i.value;return t.test(o)?null:{pattern:{requiredPattern:n,actualValue:o}}}}(t)}static nullValidator(t){return null}static compose(t){return sR(t)}static composeAsync(t){return aR(t)}}function Xb(e){return null}function tR(e){return null!=e}function nR(e){const t=fi(e)?Li(e):e;if(x9&&!Gi(t)){let n="Expected async validator to return Promise or Observable.";throw"object"==typeof e&&(n+=" Are you using a synchronous validator where an async validator is expected?"),new nt(-1101,n)}return t}function iR(e){let t={};return e.forEach(n=>{t=null!=n?{...t,...n}:t}),0===Object.keys(t).length?null:t}function rR(e,t){return t.map(n=>n(e))}function oR(e){return e.map(t=>function w9(e){return!e.validate}(t)?t:n=>t.validate(n))}function sR(e){if(!e)return null;const t=e.filter(tR);return 0==t.length?null:function(n){return iR(rR(n,t))}}function cD(e){return null!=e?sR(oR(e)):null}function aR(e){if(!e)return null;const t=e.filter(tR);return 0==t.length?null:function(n){return function m9(...e){const t=rh(e),{args:n,keys:i}=gI(e),o=new fn(a=>{const{length:u}=n;if(!u)return void a.complete();const m=new Array(u);let y=u,C=u;for(let T=0;T<u;T++){let A=!1;xn(n[T]).subscribe(Yn(a,z=>{A||(A=!0,C--),m[T]=z},()=>y--,void 0,()=>{(!y||!A)&&(C||a.next(i?_I(i,m):m),a.complete())}))}});return t?o.pipe(DC(t)):o}(rR(n,t).map(nR)).pipe(dt(iR))}}function uD(e){return null!=e?aR(oR(e)):null}function lR(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function cR(e){return e._rawValidators}function uR(e){return e._rawAsyncValidators}function hD(e){return e?Array.isArray(e)?e:[e]:[]}function Yb(e,t){return Array.isArray(e)?e.includes(t):e===t}function hR(e,t){const n=hD(t);return hD(e).forEach(o=>{Yb(n,o)||n.push(o)}),n}function dR(e,t){return hD(t).filter(n=>!Yb(e,n))}class fR{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=cD(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=uD(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,n){return!!this.control&&this.control.hasError(t,n)}getError(t,n){return this.control?this.control.getError(t,n):null}}class Cs extends fR{get formDirective(){return null}get path(){return null}}class Rd extends fR{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class pR{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let mR=(()=>{class e extends pR{constructor(n){super(n)}}return e.\u0275fac=function(n){return new(n||e)(Qe(Rd,2))},e.\u0275dir=Ft({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,i){2&n&&ix("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[ri]}),e})(),gR=(()=>{class e extends pR{constructor(n){super(n)}}return e.\u0275fac=function(n){return new(n||e)(Qe(Cs,10))},e.\u0275dir=Ft({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,i){2&n&&ix("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[ri]}),e})();function _R(e,t){return e?`with name: '${t}'`:`at index: ${t}`}const pD=!1,Xy="VALID",Jb="INVALID",dg="PENDING",Yy="DISABLED";function mD(e){return(Qb(e)?e.validators:e)||null}function gD(e,t){return(Qb(t)?t.asyncValidators:e)||null}function Qb(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function yR(e,t,n){const i=e.controls;if(!(t?Object.keys(i):i).length)throw new nt(1e3,pD?function T9(e){return`\n    There are no form controls registered with this ${e?"group":"array"} yet. If you're using ngModel,\n    you may want to check next tick (e.g. use setTimeout).\n  `}(t):"");if(!i[n])throw new nt(1001,pD?function S9(e,t){return`Cannot find form control ${_R(e,t)}`}(t,n):"")}function vR(e,t,n){e._forEachChild((i,o)=>{if(void 0===n[o])throw new nt(1002,pD?function M9(e,t){return`Must supply a value for form control ${_R(e,t)}`}(t,o):"")})}class e1{constructor(t,n){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(n)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===Xy}get invalid(){return this.status===Jb}get pending(){return this.status==dg}get disabled(){return this.status===Yy}get enabled(){return this.status!==Yy}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(hR(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(hR(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(dR(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(dR(t,this._rawAsyncValidators))}hasValidator(t){return Yb(this._rawValidators,t)}hasAsyncValidator(t){return Yb(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(n=>{n.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=dg,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=Yy,this.errors=null,this._forEachChild(i=>{i.disable({...t,onlySelf:!0})}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:n}),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=Xy,this._forEachChild(i=>{i.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:n}),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Xy||this.status===dg)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Yy:Xy}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=dg,this._hasOwnPendingAsyncValidator=!0;const n=nR(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,n={}){this.errors=t,this._updateControlsErrors(!1!==n.emitEvent)}get(t){let n=t;return null==n||(Array.isArray(n)||(n=n.split(".")),0===n.length)?null:n.reduce((i,o)=>i&&i._find(o),this)}getError(t,n){const i=n?this.get(n):this;return i&&i.errors?i.errors[t]:null}hasError(t,n){return!!this.getError(t,n)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Mi,this.statusChanges=new Mi}_calculateStatus(){return this._allControlsDisabled()?Yy:this.errors?Jb:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(dg)?dg:this._anyControlsHaveStatus(Jb)?Jb:Xy}_anyControlsHaveStatus(t){return this._anyControls(n=>n.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){Qb(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=function I9(e){return Array.isArray(e)?cD(e):e||null}(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=function A9(e){return Array.isArray(e)?uD(e):e||null}(this._rawAsyncValidators)}}class Ky extends e1{constructor(t,n,i){super(mD(n),gD(i,n)),this.controls=t,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,n){return this.controls[t]?this.controls[t]:(this.controls[t]=n,n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange),n)}addControl(t,n,i={}){this.registerControl(t,n),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,n={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}setControl(t,n,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],n&&this.registerControl(t,n),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,n={}){vR(this,!0,t),Object.keys(t).forEach(i=>{yR(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(t,n={}){null!=t&&(Object.keys(t).forEach(i=>{const o=this.controls[i];o&&o.patchValue(t[i],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(t={},n={}){this._forEachChild((i,o)=>{i.reset(t[o],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this._reduceChildren({},(t,n,i)=>(t[i]=n.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(n,i)=>!!i._syncPendingControls()||n);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(n=>{const i=this.controls[n];i&&t(i,n)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[n,i]of Object.entries(this.controls))if(this.contains(n)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(n,i,o)=>((i.enabled||this.disabled)&&(n[o]=i.value),n))}_reduceChildren(t,n){let i=t;return this._forEachChild((o,a)=>{i=n(i,o,a)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}class xR extends Ky{}const vp=new Mt("CallSetDisabledState",{providedIn:"root",factory:()=>Jy}),Jy="always";function Qy(e,t,n=Jy){_D(e,t),t.valueAccessor.writeValue(e.value),(e.disabled||"always"===n)&&t.valueAccessor.setDisabledState?.(e.disabled),function k9(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&bR(e,t)})}(e,t),function O9(e,t){const n=(i,o)=>{t.valueAccessor.writeValue(i),o&&t.viewToModelUpdate(i)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function R9(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&bR(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function P9(e,t){if(t.valueAccessor.setDisabledState){const n=i=>{t.valueAccessor.setDisabledState(i)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}function n1(e,t,n=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),r1(e,t),e&&(t._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function i1(e,t){e.forEach(n=>{n.registerOnValidatorChange&&n.registerOnValidatorChange(t)})}function _D(e,t){const n=cR(e);null!==t.validator?e.setValidators(lR(n,t.validator)):"function"==typeof n&&e.setValidators([n]);const i=uR(e);null!==t.asyncValidator?e.setAsyncValidators(lR(i,t.asyncValidator)):"function"==typeof i&&e.setAsyncValidators([i]);const o=()=>e.updateValueAndValidity();i1(t._rawValidators,o),i1(t._rawAsyncValidators,o)}function r1(e,t){let n=!1;if(null!==e){if(null!==t.validator){const o=cR(e);if(Array.isArray(o)&&o.length>0){const a=o.filter(u=>u!==t.validator);a.length!==o.length&&(n=!0,e.setValidators(a))}}if(null!==t.asyncValidator){const o=uR(e);if(Array.isArray(o)&&o.length>0){const a=o.filter(u=>u!==t.asyncValidator);a.length!==o.length&&(n=!0,e.setAsyncValidators(a))}}}const i=()=>{};return i1(t._rawValidators,i),i1(t._rawAsyncValidators,i),n}function bR(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function ER(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function DR(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const fg=class extends e1{constructor(t=null,n,i){super(mD(n),gD(i,n)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Qb(n)&&(n.nonNullable||n.initialValueIsDefault)&&(this.defaultValue=DR(t)?t.value:t)}setValue(t,n={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==n.emitViewToModelChange)),this.updateValueAndValidity(n)}patchValue(t,n={}){this.setValue(t,n)}reset(t=this.defaultValue,n={}){this._applyFormState(t),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){ER(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){ER(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){DR(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};let PR=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=lr({type:e}),e.\u0275inj=Ui({}),e})();const wD=new Mt("NgModelWithFormControlWarning"),X9={provide:Cs,useExisting:Hn(()=>o1)};let o1=(()=>{class e extends Cs{constructor(n,i,o){super(),this.callSetDisabledState=o,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Mi,this._setValidators(n),this._setAsyncValidators(i)}ngOnChanges(n){this._checkFormPresent(),n.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(r1(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(n){const i=this.form.get(n.path);return Qy(i,n,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(n),i}getControl(n){return this.form.get(n.path)}removeControl(n){n1(n.control||null,n,!1),function N9(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}(this.directives,n)}addFormGroup(n){this._setUpFormContainer(n)}removeFormGroup(n){this._cleanUpFormContainer(n)}getFormGroup(n){return this.form.get(n.path)}addFormArray(n){this._setUpFormContainer(n)}removeFormArray(n){this._cleanUpFormContainer(n)}getFormArray(n){return this.form.get(n.path)}updateModel(n,i){this.form.get(n.path).setValue(i)}onSubmit(n){return this.submitted=!0,function CR(e,t){e._syncPendingControls(),t.forEach(n=>{const i=n.control;"submit"===i.updateOn&&i._pendingChange&&(n.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(n),"dialog"===n?.target?.method}onReset(){this.resetForm()}resetForm(n){this.form.reset(n),this.submitted=!1}_updateDomValue(){this.directives.forEach(n=>{const i=n.control,o=this.form.get(n.path);i!==o&&(n1(i||null,n),(e=>e instanceof fg)(o)&&(Qy(o,n,this.callSetDisabledState),n.control=o))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(n){const i=this.form.get(n.path);(function wR(e,t){_D(e,t)})(i,n),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(n){if(this.form){const i=this.form.get(n.path);i&&function L9(e,t){return r1(e,t)}(i,n)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){_D(this.form,this),this._oldForm&&r1(this._oldForm,this)}_checkFormPresent(){}}return e.\u0275fac=function(n){return new(n||e)(Qe(ts,10),Qe(kd,10),Qe(vp,8))},e.\u0275dir=Ft({type:e,selectors:[["","formGroup",""]],hostBindings:function(n,i){1&n&&Mn("submit",function(a){return i.onSubmit(a)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Wi([X9]),ri,qr]}),e})();const J9={provide:Rd,useExisting:Hn(()=>DD)};let DD=(()=>{class e extends Rd{set isDisabled(n){}constructor(n,i,o,a,u){super(),this._ngModelWarningConfig=u,this._added=!1,this.update=new Mi,this._ngModelWarningSent=!1,this._parent=n,this._setValidators(i),this._setAsyncValidators(o),this.valueAccessor=function xD(e,t){if(!t)return null;let n,i,o;return Array.isArray(t),t.forEach(a=>{a.constructor===Zb?n=a:function z9(e){return Object.getPrototypeOf(e.constructor)===yp}(a)?i=a:o=a}),o||i||n||null}(0,a)}ngOnChanges(n){this._added||this._setUpControl(),function vD(e,t){if(!e.hasOwnProperty("model"))return!1;const n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)}(n,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}get path(){return function t1(e,t){return[...t.path,e]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return e._ngModelWarningSentOnce=!1,e.\u0275fac=function(n){return new(n||e)(Qe(Cs,13),Qe(ts,10),Qe(kd,10),Qe(Hc,10),Qe(wD,8))},e.\u0275dir=Ft({type:e,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Wi([J9]),ri,qr]}),e})();const Q9={provide:Hc,useExisting:Hn(()=>s1),multi:!0};function FR(e,t){return null==e?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let s1=(()=>{class e extends yp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){this.value=n;const o=FR(this._getOptionId(n),n);this.setProperty("value",o)}registerOnChange(n){this.onChange=i=>{this.value=this._getOptionValue(i),n(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(n){for(const i of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(i),n))return i;return null}_getOptionValue(n){const i=function eZ(e){return e.split(":")[0]}(n);return this._optionMap.has(i)?this._optionMap.get(i):n}}return e.\u0275fac=function(){let t;return function(i){return(t||(t=Yr(e)))(i||e)}}(),e.\u0275dir=Ft({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(n,i){1&n&&Mn("change",function(a){return i.onChange(a.target.value)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[Wi([Q9]),ri]}),e})(),zR=(()=>{class e{constructor(n,i,o){this._element=n,this._renderer=i,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(n){null!=this._select&&(this._select._optionMap.set(this.id,n),this._setElementValue(FR(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._setElementValue(n),this._select&&this._select.writeValue(this._select.value)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(n){return new(n||e)(Qe(Po),Qe(jl),Qe(s1,9))},e.\u0275dir=Ft({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const tZ={provide:Hc,useExisting:Hn(()=>TD),multi:!0};function NR(e,t){return null==e?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let TD=(()=>{class e extends yp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){let i;if(this.value=n,Array.isArray(n)){const o=n.map(a=>this._getOptionId(a));i=(a,u)=>{a._setSelected(o.indexOf(u.toString())>-1)}}else i=(o,a)=>{o._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(n){this.onChange=i=>{const o=[],a=i.selectedOptions;if(void 0!==a){const u=a;for(let m=0;m<u.length;m++){const C=this._getOptionValue(u[m].value);o.push(C)}}else{const u=i.options;for(let m=0;m<u.length;m++){const y=u[m];if(y.selected){const C=this._getOptionValue(y.value);o.push(C)}}}this.value=o,n(o)}}_registerOption(n){const i=(this._idCounter++).toString();return this._optionMap.set(i,n),i}_getOptionId(n){for(const i of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(i)._value,n))return i;return null}_getOptionValue(n){const i=function nZ(e){return e.split(":")[0]}(n);return this._optionMap.has(i)?this._optionMap.get(i)._value:n}}return e.\u0275fac=function(){let t;return function(i){return(t||(t=Yr(e)))(i||e)}}(),e.\u0275dir=Ft({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(n,i){1&n&&Mn("change",function(a){return i.onChange(a.target)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[Wi([tZ]),ri]}),e})(),BR=(()=>{class e{constructor(n,i,o){this._element=n,this._renderer=i,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(n){null!=this._select&&(this._value=n,this._setElementValue(NR(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._select?(this._value=n,this._setElementValue(NR(this.id,n)),this._select.writeValue(this._select.value)):this._setElementValue(n)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}_setSelected(n){this._renderer.setProperty(this._element.nativeElement,"selected",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(n){return new(n||e)(Qe(Po),Qe(jl),Qe(TD,9))},e.\u0275dir=Ft({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})(),XR=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=lr({type:e}),e.\u0275inj=Ui({imports:[PR]}),e})();class YR extends e1{constructor(t,n,i){super(mD(n),gD(i,n)),this.controls=t,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(t){return this.controls[this._adjustIndex(t)]}push(t,n={}){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}insert(t,n,i={}){this.controls.splice(t,0,n),this._registerControl(n),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(t,n={}){let i=this._adjustIndex(t);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),this.updateValueAndValidity({emitEvent:n.emitEvent})}setControl(t,n,i={}){let o=this._adjustIndex(t);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),n&&(this.controls.splice(o,0,n),this._registerControl(n)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,n={}){vR(this,!1,t),t.forEach((i,o)=>{yR(this,!1,o),this.at(o).setValue(i,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(t,n={}){null!=t&&(t.forEach((i,o)=>{this.at(o)&&this.at(o).patchValue(i,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(t=[],n={}){this._forEachChild((i,o)=>{i.reset(t[o],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this.controls.map(t=>t.getRawValue())}clear(t={}){this.controls.length<1||(this._forEachChild(n=>n._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_adjustIndex(t){return t<0?t+this.length:t}_syncPendingControls(){let t=this.controls.reduce((n,i)=>!!i._syncPendingControls()||n,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((n,i)=>{t(n,i)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(n=>n.enabled&&t(n))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}_find(t){return this.at(t)??null}}function KR(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let hZ=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const n=new e;return n.useNonNullable=!0,n}group(n,i=null){const o=this._reduceControls(n);let a={};return KR(i)?a=i:null!==i&&(a.validators=i.validator,a.asyncValidators=i.asyncValidator),new Ky(o,a)}record(n,i=null){const o=this._reduceControls(n);return new xR(o,i)}control(n,i,o){let a={};return this.useNonNullable?(KR(i)?a=i:(a.validators=i,a.asyncValidators=o),new fg(n,{...a,nonNullable:!0})):new fg(n,i,o)}array(n,i,o){const a=n.map(u=>this._createControl(u));return new YR(a,i,o)}_reduceControls(n){const i={};return Object.keys(n).forEach(o=>{i[o]=this._createControl(n[o])}),i}_createControl(n){return n instanceof fg||n instanceof e1?n:Array.isArray(n)?this.control(n[0],n.length>1?n[1]:null,n.length>2?n[2]:null):this.control(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),dZ=(()=>{class e{static withConfig(n){return{ngModule:e,providers:[{provide:vp,useValue:n.callSetDisabledState??Jy}]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=lr({type:e}),e.\u0275inj=Ui({imports:[XR]}),e})(),fZ=(()=>{class e{static withConfig(n){return{ngModule:e,providers:[{provide:wD,useValue:n.warnOnNgModelWithFormControl??"always"},{provide:vp,useValue:n.callSetDisabledState??Jy}]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=lr({type:e}),e.\u0275inj=Ui({imports:[XR]}),e})();function pZ(e,t){if(1&e&&Zt(0,"input",17),2&e){const n=br().$implicit;xt("formControlName",n.field)("placeholder",n.placeholder)("type","text")}}function mZ(e,t){if(1&e&&Zt(0,"textarea",18),2&e){const n=br().$implicit;xt("formControlName",n.field)("placeholder",n.placeholder)}}function gZ(e,t){if(1&e&&(ht(0,"option",22),si(1),gt()),2&e){const n=t.$implicit;xt("value",n.value),kt(1),_o(n.label)}}function _Z(e,t){if(1&e&&(ht(0,"select",19)(1,"option",20),si(2,"Option List"),gt(),qt(3,gZ,2,2,"option",21),gt()),2&e){const n=br().$implicit;xt("formControlName",n.field),kt(3),xt("ngForOf",n.data)}}function yZ(e,t){if(1&e){const n=tr();ht(0,"div",23),Zt(1,"input",24)(2,"input",25,26),ht(4,"button",27),Mn("click",function(){return ot(n),Fs(zn(3).click())}),si(5,"color"),gt(),ht(6,"button",28),Mn("click",function(){return ot(n),Fs(br(3).add())}),si(7),gt()()}if(2&e){const n=br().$implicit,i=br(2);kt(1),xt("formControlName",n.field)("type","text"),kt(1),xt("type","color"),kt(4),xt("disabled",i.addForm.invalid),kt(1),_o(0==i.isEdit?"Add list":"Update")}}function vZ(e,t){if(1&e&&(wn(0),ht(1,"label",12),si(2),gt(),qt(3,pZ,1,3,"input",13),qt(4,mZ,1,2,"textarea",14),qt(5,_Z,4,2,"select",15),qt(6,yZ,8,5,"div",16),xi()),2&e){const n=t.$implicit;kt(2),_o(n.label),kt(1),xt("ngIf","input-text"==n.type),kt(1),xt("ngIf","textarea"==n.type),kt(1),xt("ngIf","select"==n.type),kt(1),xt("ngIf","SpecialComponent1"==n.type)}}function xZ(e,t){if(1&e){const n=tr();ht(0,"tr")(1,"td"),si(2),gt(),ht(3,"td"),si(4),gt(),ht(5,"td")(6,"button",29),Mn("click",function(){const a=ot(n).$implicit;return Fs(br(2).edit(a.id))}),Zt(7,"img",30),gt(),ht(8,"button",29),Mn("click",function(){const a=ot(n).$implicit;return Fs(br(2).delete(a.id))}),Zt(9,"img",31),gt()()()}if(2&e){const n=t.$implicit;kt(1),nx("color",n.color),kt(1),_o(n.color),kt(2),_o(n.answers)}}function bZ(e,t){if(1&e){const n=tr();ht(0,"div",1)(1,"div",2)(2,"div",3),si(3),gt(),qt(4,vZ,7,5,"ng-container",4),ht(5,"table",5)(6,"tr")(7,"th",6),si(8,"color"),gt(),ht(9,"th",7),si(10,"Answers"),gt(),ht(11,"th",6),si(12,"Operation"),gt()(),qt(13,xZ,10,4,"tr",4),gt(),ht(14,"div",8)(15,"button",9),Mn("click",function(){return ot(n),Fs(br().pushData())}),si(16,"Save"),gt()()(),ht(17,"div",10),Zt(18,"app-map",11),gt()()}if(2&e){const n=br();kt(1),xt("formGroup",n.addForm),kt(2),zc(" ",n.form.title,""),kt(1),xt("ngForOf",null==n.form?null:n.form.fields),kt(3),xt("width","20%"),kt(2),xt("width","60%"),kt(2),xt("width","20%"),kt(2),xt("ngForOf",n.dataSouce),kt(2),xt("disabled",0==n.dataSouce.length)}}const wZ=[{path:"",component:K5},{path:"detail",component:p9},{path:"new",component:(()=>{class e{constructor(n,i,o){this.data=n,this.fb=i,this.router=o,this.id=1,this.dataSouce=[],this.isEdit=!1,this.addForm=this.fb.group({id:[this.id],color:[,Wk.required]}),this.getForm()}ngOnInit(){}add(){console.log(this.isEdit,this.addForm.value.id),1==this.isEdit&&(console.log(this.addForm.value.id),this.dataSouce=this.dataSouce.filter(n=>n.id!=this.addForm.value.id)),this.dataSouce.push(this.addForm.value),this.addForm.reset(),this.id++,this.addForm.get("id").setValue(this.id),this.isEdit=!1}getForm(){this.data.getform("/2-create-form/form-settings.json").subscribe(n=>{this.form=n,this.form?.fields.forEach(i=>{this.addForm.addControl(i.field,new fg("",Wk.required))})})}pushData(){this.data.cards.unshift({id:1,img:"./assets/Screenshot 2023-10-15 081136.png",subtitle:this.addForm.value.title,title:this.addForm.value.desc,url:"/survey/how-many-car-you-have-in-your-family"}),this.router.navigate(["/"])}delete(n){console.log(n),this.dataSouce=this.dataSouce.filter(i=>i.id!=n)}edit(n){this.isEdit=!0;let i=this.dataSouce.find(o=>o.id==n);this.addForm.get("color").setValue(i.color),this.addForm.get("title").setValue(i.title),this.addForm.get("select2").setValue(i.select2),this.addForm.get("select1").setValue(i.select1),this.addForm.get("desc").setValue(i.desc),this.addForm.get("answers").setValue(i.answers),this.addForm.get("id").setValue(i.id)}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(eg),Qe(hZ),Qe(Ws))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-new-item"]],decls:1,vars:1,consts:[["class","new",4,"ngIf"],[1,"new"],[1,"left",3,"formGroup"],[1,"title"],[4,"ngFor","ngForOf"],["cellspacing","0","cellpadding","0"],[3,"width"],[2,"text-align","start",3,"width"],[2,"position","relative"],[2,"width","50px","position","absolute","top","5px","right","5px",3,"disabled","click"],[1,"right"],[2,"width","100%","height","100%"],["for",""],[3,"formControlName","placeholder","type",4,"ngIf"],["style","height: 40px;","name","","id","","cols","30","rows","5",3,"formControlName","placeholder",4,"ngIf"],["name","","id","",3,"formControlName",4,"ngIf"],["style","display: flex; justify-content: space-between",4,"ngIf"],[3,"formControlName","placeholder","type"],["name","","id","","cols","30","rows","5",2,"height","40px",3,"formControlName","placeholder"],["name","","id","",3,"formControlName"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[2,"display","flex","justify-content","space-between"],["placeholder","Write Answers",2,"width","56%",3,"formControlName","type"],["formControlName","color",2,"opacity","0",";width","0",3,"type"],["color",""],[1,"color",2,"width","20%",3,"click"],[2,"width","20%",3,"disabled","click"],[2,"width","17px","margin","0 2px","height","20px","background-color","rgb(27, 27, 27)",3,"click"],["src","./assets/pencil_orange.svg","alt","",2,"width","9px","margin-left","-2px"],["src","./assets/red-bin.svg","alt","",2,"width","9px","margin-left","-2px"]],template:function(i,o){1&i&&qt(0,bZ,19,8,"div",0),2&i&&xt("ngIf",o.form)},dependencies:[Vm,J_,zR,BR,Zb,s1,mR,gR,o1,DD,Uk],styles:[".new[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;width:100%;height:100%;display:flex;justify-content:space-between;padding:10px}.right[_ngcontent-%COMP%], .left[_ngcontent-%COMP%]{box-sizing:border-box;height:calc(100% - 20px);background-color:#191c1d;border-radius:8px}.left[_ngcontent-%COMP%]{width:calc(25% - 30px);height:100%;padding:15px;display:flex;flex-direction:column}.left[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .left[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .left[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:#2d3436;border-radius:5px;height:25px}.right[_ngcontent-%COMP%]{width:calc(75% - 20px);height:100%;border:3px solid rgb(22,22,22)}.title[_ngcontent-%COMP%]{font-size:25px;font-weight:700;margin-bottom:20px}label[_ngcontent-%COMP%]{margin:10px 0 3px;font-size:12px}button[_ngcontent-%COMP%]{border:#2d3436;border-radius:5px;height:25px;font-size:13px}.color[_ngcontent-%COMP%]{background-color:#ff0}table[_ngcontent-%COMP%]{margin-top:5px;width:100%;border:none!important;font-size:9px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border:none!important;padding:5px 0;height:30px!important}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border:none!important}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#565e61;border:none!important}@media screen and (max-width: 881px){.new[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:wrap;overflow-y:scroll}.right[_ngcontent-%COMP%]{margin-top:15px;width:100%;height:50%}.left[_ngcontent-%COMP%]{width:100%}.left[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:99%;margin-left:-4px;box-shadow:none}}"]})}return e})()}];let CZ=(()=>{class e{static#e=this.\u0275fac=function(i){return new(i||e)};static#t=this.\u0275mod=lr({type:e});static#n=this.\u0275inj=Ui({imports:[MA.forRoot(wZ),MA]})}return e})();function EZ(e,t){if(1&e&&(ht(0,"a",6),si(1),gt()),2&e){const n=t.$implicit;xt("routerLink",n.path),kt(1),_o(n.label)}}function DZ(e,t){if(1&e&&(ht(0,"div",1)(1,"div",2),si(2),gt(),ht(3,"div",3),qt(4,EZ,2,2,"a",4),gt(),ht(5,"div",5),si(6),gt()()),2&e){const n=br();kt(2),zc(" Mail ",n.setting.mail," "),kt(2),xt("ngForOf",n.menu),kt(2),_o(n.setting.copyright)}}let TZ=(()=>{class e{constructor(n){this.data=n}ngOnInit(){this.getSettings(),this.getMenu()}getSettings(){this.data.getsetting("settings.json").subscribe(n=>{this.setting=n})}getMenu(){this.data.getfooter("footer-menu.json").subscribe(n=>{this.menu=n})}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(eg))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-footer"]],decls:1,vars:1,consts:[["class","footer",4,"ngIf"],[1,"footer"],[1,"email"],[1,"menu"],[3,"routerLink",4,"ngFor","ngForOf"],[1,"copy"],[3,"routerLink"]],template:function(i,o){1&i&&qt(0,DZ,7,3,"div",0),2&i&&xt("ngIf",o.setting)},dependencies:[Vm,J_,Km],styles:[".footer[_ngcontent-%COMP%]{height:50px;display:flex;justify-content:space-between;margin-bottom:-30px!important}.footer[_ngcontent-%COMP%]   .email[_ngcontent-%COMP%]{width:20%;display:flex;align-items:center}.footer[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{width:23%}.footer[_ngcontent-%COMP%]   .copy[_ngcontent-%COMP%]{width:20%;display:flex;align-items:center}.footer[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.footer[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}@media screen and (max-width: 881px){.footer[_ngcontent-%COMP%]   .copy[_ngcontent-%COMP%], .footer[_ngcontent-%COMP%]   .email[_ngcontent-%COMP%], .footer[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{font-size:9px}}"]})}return e})();function SZ(e,t){return{type:7,name:e,definitions:t,options:{}}}function JR(e,t=null){return{type:4,styles:t,timings:e}}function MD(e){return{type:6,styles:e,offset:null}}function QR(e,t,n){return{type:0,name:e,styles:t,options:n}}function eO(e,t,n=null){return{type:1,expr:e,animation:t,options:n}}const MZ=new Mt("DARK_MODE_OPTIONS"),IZ={darkModeClass:"dark-mode",lightModeClass:"light-mode",preloadingClass:"dark-mode-preloading",storageKey:"dark-mode",element:document.body};let kZ=(()=>{class e{matchMedia(n){return window.matchMedia(n)}prefersDarkMode(){return this.matchMedia("(prefers-color-scheme: dark)").matches}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),RZ=(()=>{class e{constructor(n,i,o){this.rendererFactory=n,this.mediaQueryService=i,this.providedOptions=o,this.options={...IZ,...this.providedOptions||{}},this.renderer=this.rendererFactory.createRenderer(null,null),this.darkModeSubject$=new xa(this.getInitialDarkModeValue()),this.darkModeSubject$.getValue()?this.enable():this.disable(),this.removePreloadingClass()}get darkMode$(){return this.darkModeSubject$.asObservable().pipe(ak())}toggle(){this.darkModeSubject$.getValue()?this.disable():this.enable()}enable(){const{element:n,darkModeClass:i,lightModeClass:o}=this.options;this.renderer.removeClass(n,o),this.renderer.addClass(n,i),this.saveDarkModeToStorage(!0),this.darkModeSubject$.next(!0)}disable(){const{element:n,darkModeClass:i,lightModeClass:o}=this.options;this.renderer.removeClass(n,i),this.renderer.addClass(n,o),this.saveDarkModeToStorage(!1),this.darkModeSubject$.next(!1)}getInitialDarkModeValue(){const n=this.getDarkModeFromStorage();return function AZ(e){return null==e}(n)?this.mediaQueryService.prefersDarkMode():n}saveDarkModeToStorage(n){localStorage.setItem(this.options.storageKey,JSON.stringify({darkMode:n}))}getDarkModeFromStorage(){const n=localStorage.getItem(this.options.storageKey);if(n)try{return JSON.parse(n)?.darkMode}catch{console.error("Invalid darkMode localStorage item:",n,"falling back to color scheme media query")}return null}removePreloadingClass(){setTimeout(()=>{this.renderer.removeClass(this.options.element,this.options.preloadingClass)})}}return e.\u0275fac=function(n){return new(n||e)(Dt(u_),Dt(kZ),Dt(MZ,8))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),OZ=(()=>{class e{constructor(n){this.darkModeService=n,this.darkMode$=this.darkModeService.darkMode$}onToggle(){this.darkModeService.toggle()}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(RZ))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-dark-mode-toggle"]],decls:5,vars:3,consts:[[1,"icon",3,"click"],["type","checkbox",2,"display","none",3,"checked","change"],["t",""],[1,"fa","fa-moon-o",2,"font-size","14px","padding","5px"]],template:function(i,o){if(1&i){const a=tr();ht(0,"div",0),Mn("click",function(){return ot(a),Fs(zn(2).click())}),ht(1,"input",1,2),Mn("change",function(){return o.onToggle()}),function pS(e,t){const n=yn();let i;const o=e+Kn;n.firstCreatePass?(i=function aF(e,t){if(t)for(let n=t.length-1;n>=0;n--){const i=t[n];if(e===i.name)return i}}(t,n.pipeRegistry),n.data[o]=i,i.onDestroy&&(n.destroyHooks??(n.destroyHooks=[])).push(o,i.onDestroy)):i=n.data[o];const a=i.factory||(i.factory=la(i.type)),u=uo(Qe);try{const m=ur(!1),y=a();return ur(m),function ni(e,t,n,i){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=i}(n,Ze(),o,y),y}finally{uo(u)}}(3,"async"),gt(),Zt(4,"i",3),gt()}2&i&&(kt(1),xt("checked",mS(3,1,o.darkMode$)))},dependencies:[VM],encapsulation:2})}return e})();function LZ(e,t){if(1&e&&(ht(0,"a",20),si(1),gt()),2&e){const n=t.$implicit;xt("routerLink","/"),kt(1),_o(n.label)}}function FZ(e,t){if(1&e){const n=tr();ht(0,"div",1)(1,"a",2),Mn("click",function(){return ot(n),Fs(br().myFunction())}),Zt(2,"i",3),gt(),ht(3,"div",4)(4,"div",5),Zt(5,"img",6),ht(6,"span",7),si(7),gt()(),ht(8,"div",8),qt(9,LZ,2,2,"a",9),gt(),ht(10,"div",10)(11,"div",11)(12,"div",12),Zt(13,"i",13),gt(),ht(14,"div",12),Zt(15,"i",13),gt(),Zt(16,"app-dark-mode-toggle"),gt(),ht(17,"div",14)(18,"div",15)(19,"span",16),si(20),gt(),ht(21,"span",17),si(22),gt()(),ht(23,"div",18),Zt(24,"i",19)(25,"img",6),gt()()()()()}if(2&e){const n=br();kt(5),xt("src",n.setting.logo,Zh),kt(2),_o(n.setting.logo_title),kt(2),xt("ngForOf",n.menu),kt(11),_o(n.user.name),kt(2),_o("Vote:"+n.user.vote+" Survey:"+n.user.survey),kt(3),xt("src",n.user.img,Zh)}}let zZ=(()=>{class e{constructor(n){this.data=n}ngOnInit(){this.getSettings(),this.getMenu(),this.getUser()}getSettings(){this.data.getsetting("settings.json").subscribe(n=>{this.setting=n})}getMenu(){this.data.getmenu("menu.json").subscribe(n=>{this.menu=n})}getUser(){this.data.getuser("user.json").subscribe(n=>{this.user=n})}myFunction(){var n=document.getElementById("myTopnav");n.className.includes("responsive")?n.className="topnav":n.className+=" responsive"}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(eg))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-header"]],decls:1,vars:1,consts:[["class","  header-container",4,"ngIf"],[1,"header-container"],["href","javascript:void(0);",1,"iconss",2,"font-size","16px!important",3,"click"],[1,"fa","fa-bars"],["id","myTopnav",1,"topnav"],["routerLink","/",1,"logo"],["alt","",3,"src"],[1,"logo-text"],[1,"menu-list"],[3,"routerLink",4,"ngFor","ngForOf"],[1,"user"],[1,"icons"],[1,"icon"],[1,"fa","fa-bell",2,"font-size","14px","padding","5px"],[1,"detail"],[1,"names"],[2,"font-weight","400"],[2,"font-size","15px"],[1,"img"],[1,"fa","fa-angle-down",2,"padding-right","5px"],[3,"routerLink"]],template:function(i,o){1&i&&qt(0,FZ,26,6,"div",0),2&i&&xt("ngIf",o.setting&&o.user)},dependencies:[Vm,J_,Km,OZ],styles:[".header-container[_ngcontent-%COMP%]{height:50px}.header-container[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:200px;display:flex;align-items:center;padding:10px}.header-container[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]:hover{cursor:pointer}.header-container[_ngcontent-%COMP%]   .logo-text[_ngcontent-%COMP%]{margin-left:10px}.header-container[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{justify-content:space-between;display:flex;align-items:center;width:350px}.header-container[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]{display:flex;justify-content:start}.menu-list[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:500px}.menu-list[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.detail[_ngcontent-%COMP%]{display:flex;justify-content:end}.detail[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]{display:flex;align-items:end;flex-direction:column;padding-right:5px}.detail[_ngcontent-%COMP%]   .img[_ngcontent-%COMP%]{width:50px;height:40px;display:flex;align-items:center}.detail[_ngcontent-%COMP%]   .img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:15px;width:30px;height:30px}.topnav[_ngcontent-%COMP%]{display:flex;justify-content:space-between;height:50px}.header-container[_ngcontent-%COMP%]   .iconss[_ngcontent-%COMP%]{display:none}@media screen and (max-width: 881px){.topnav[_ngcontent-%COMP%]{display:none}.header-container[_ngcontent-%COMP%]   .iconss[_ngcontent-%COMP%]{float:right;display:block;position:absolute;right:10px;top:10px}.topnav[_ngcontent-%COMP%]{transition:all .3s}.responsive[_ngcontent-%COMP%]{position:relative!important}.iconss[_ngcontent-%COMP%]{float:none;display:block!important;position:absolute;right:0;top:0;z-index:2}.responsive[_ngcontent-%COMP%]{float:none;display:flex!important;flex-direction:column;z-index:1;text-align:left;position:absolute;padding-right:5px;font-size:11px;background-color:#353839;height:100px}.responsive[_ngcontent-%COMP%]   .menu-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:end;width:97%;padding-right:15px}.responsive[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{position:absolute;top:0}.responsive[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;top:50px;left:0;align-items:end;width:75%}.responsive[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]{margin-top:20px}.responsive[_ngcontent-%COMP%]{padding-top:40px}}"],data:{animation:[SZ("openClose",[QR("false",MD({height:"0px",display:"none"})),QR("true",MD({height:"*"})),eO("false => true",[MD({display:"block"}),JR("300ms ease-in")]),eO("true => false",[JR("300ms ease-in")])])]}})}return e})(),NZ=(()=>{class e{constructor(){this.title="map-project"}static#e=this.\u0275fac=function(i){return new(i||e)};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-root"]],decls:4,vars:0,consts:[[1,"main"]],template:function(i,o){1&i&&(Zt(0,"app-header"),ht(1,"div",0),Zt(2,"router-outlet"),gt(),Zt(3,"app-footer"))},dependencies:[HC,TZ,zZ],styles:[".main[_ngcontent-%COMP%]{height:calc(100vh - 100px)!important;overflow-y:hidden}"]})}return e})(),BZ=(()=>{class e{static#e=this.\u0275fac=function(i){return new(i||e)};static#t=this.\u0275mod=lr({type:e,bootstrap:[NZ]});static#n=this.\u0275inj=Ui({imports:[qB,UM,CZ,r5,dZ,fZ,a9,Z5]})}return e})();WB().bootstrapModule(BZ).catch(e=>console.error(e))},898:function(gg){gg.exports=function(){"use strict";var Yu,Ku,Rn;function Od(p,Ue){if(Yu)if(Ku){var Ds="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Yu+")(sharedChunk); ("+Ku+")(sharedChunk); self.onerror = null;",Lo={};Yu(Lo),Rn=Ue(Lo),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Rn.workerUrl=window.URL.createObjectURL(new Blob([Ds],{type:"text/javascript"})))}else Ku=Ue;else Yu=Ue}return Od(0,function(p){var Ue=typeof self<"u"?self:{},Ds="2.15.0";let Lo;const Kt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Lo){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Lo=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch{Lo=s}}return Lo},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Kt.API_URL)return null;try{const s=new URL(Kt.API_URL);return"api.mapbox.cn"===s.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===s.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Xt={supported:!1,testSupport:function(s){!ns&&Ur&&(Zs?Gc(s):Zi=s)}};let Zi,Ur,ns=!1,Zs=!1;function Gc(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Ur),s.isContextLost())return;Xt.supported=!0}catch{}s.deleteTexture(r),ns=!0}Ue.document&&(Ur=Ue.document.createElement("img"),Ur.onload=function(){Zi&&Gc(Zi),Zi=null,Zs=!0},Ur.onerror=function(){ns=!0,Zi=null},Ur.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Jl="01";function vo(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Fo=ro;function ro(s,r,l,h){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=r,this.p2x=l,this.p2y=h}ro.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,r){if(void 0===r&&(r=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,h=0;h<8;h++){var f=this.sampleCurveX(l)-s;if(Math.abs(f)<r)return l;var _=this.sampleCurveDerivativeX(l);if(Math.abs(_)<1e-6)break;l-=f/_}var x=0,w=1;for(l=s,h=0;h<20&&(f=this.sampleCurveX(l),!(Math.abs(f-s)<r));h++)s>f?x=l:w=l,l=.5*(w-x)+x;return l},solve:function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))}};var al=vo(Fo),Xs=is;function is(s,r){this.x=s,this.y=r}is.prototype={clone:function(){return new is(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,l=s.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),l=Math.sin(s),h=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=h,this},_rotateAround:function(s,r){var l=Math.cos(s),h=Math.sin(s),f=r.y+h*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-h*(this.y-r.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},is.convert=function(s){return s instanceof is?s:Array.isArray(s)?new is(s[0],s[1]):s};var at=vo(Xs);const Ld=Math.PI/180,ll=180/Math.PI;function an(s){return s*Ld}function sr(s){return s*ll}const Wc=[[0,0],[1,0],[1,1],[0,1]];function Ju(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,l=r*s;return 4*(s<.5?l:3*(s-r)+l-.75)}function cl(s,r,l,h){const f=new al(s,r,l,h);return function(_){return f.solve(_)}}const rs=cl(.25,.1,.25,1);function hn(s,r,l){return Math.min(l,Math.max(r,s))}function ul(s,r,l){return(l=hn((l-s)/(r-s),0,1))*l*(3-2*l)}function fn(s,r,l){const h=l-r,f=((s-r)%h+h)%h+r;return f===r?l:f}function Xi(s,r,l){if(!s.length)return l(null,[]);let h=s.length;const f=new Array(s.length);let _=null;s.forEach((x,w)=>{r(x,(D,S)=>{D&&(_=D),f[w]=S,0==--h&&l(_,f)})})}function Ca(s){const r=[];for(const l in s)r.push(s[l]);return r}function ki(s,...r){for(const l of r)for(const h in l)s[h]=l[h];return s}let Ea=1;function oo(){return Ea++}function Ys(){return function s(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function Ts(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function gi(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Yn(s,r){s.forEach(l=>{r[l]&&(r[l]=r[l].bind(r))})}function Ql(s,r){return-1!==s.indexOf(r,s.length-r.length)}function dt(s,r,l){const h={};for(const f in s)h[f]=r.call(l||this,s[f],f,s);return h}function Da(s,r,l){const h={};for(const f in s)r.call(l||this,s[f],f,s)&&(h[f]=s[f]);return h}function xo(s){return Array.isArray(s)?s.map(xo):"object"==typeof s&&s?dt(s,xo):s}const hl={};function ui(s){hl[s]||(typeof console<"u"&&console.warn(s),hl[s]=!0)}function zo(s,r,l){return(l.y-s.y)*(r.x-s.x)>(r.y-s.y)*(l.x-s.x)}function Qu(s){let r=0;for(let l,h,f=0,_=s.length,x=_-1;f<_;x=f++)l=s[f],h=s[x],r+=(h.x-l.x)*(l.y+h.y);return r}function Ta(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function No(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,f,_)=>{const x=f||_;return r[h]=!x||x.toLowerCase(),""}),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r}let eh=null;function qc(s){if(null==eh){const r=s.navigator?s.navigator.userAgent:null;eh=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return eh}function Zc(s){try{const r=Ue[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ks(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]}const ec="mapbox-tiles";let so,Js,tc=500,th=50;function Xc(){try{return Ue.caches}catch{}}function dl(){Xc()&&!so&&(so=Ue.caches.open(ec))}function nc(s){const r=s.indexOf("?");if(r<0)return s;const h=function(f){const _=f.indexOf("?");return _>0?f.slice(_+1).split("&"):[]}(s).filter(f=>{const _=f.split("=");return"language"===_[0]||"worldview"===_[0]});return h.length?`${s.slice(0,r)}?${h.join("&")}`:s.slice(0,r)}let Bo=1/0;const Sa={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Sa);class Ma extends Error{constructor(r,l,h){401===l&&De(h)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ia=Ta()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ue.location.protocol?Ue.parent:Ue).location.href,fl=function(s,r){if(!(/^file:/.test(l=s.url)||/^file:/.test(Ia())&&!/^\w+:/.test(l))){if(Ue.fetch&&Ue.Request&&Ue.AbortController&&Ue.Request.prototype.hasOwnProperty("signal"))return function(h,f){const _=new Ue.AbortController,x=new Ue.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Ia(),referrerPolicy:h.referrerPolicy,signal:_.signal});let w=!1,D=!1;const S=(P=x.url).indexOf("sku=")>0&&De(P);var P;"json"===h.type&&x.headers.set("Accept","application/json");const R=(N,B,$)=>{if(D)return;if(N&&"SecurityError"!==N.message&&ui(N.toString()),B&&$)return O(B);const Z=Date.now();Ue.fetch(x).then(te=>{if(te.ok){const ce=S?te.clone():null;return O(te,ce,Z)}return f(new Ma(te.statusText,te.status,h.url))}).catch(te=>{"AbortError"!==te.name&&f(new Error(`${te.message} ${h.url}`))})},O=(N,B,$)=>{("arrayBuffer"===h.type?N.arrayBuffer():"json"===h.type?N.json():N.text()).then(Z=>{D||(B&&$&&function(te,ce,ne){if(dl(),!so)return;const ae={status:ce.status,statusText:ce.statusText,headers:new Ue.Headers};ce.headers.forEach((Me,Ee)=>ae.headers.set(Ee,Me));const pe=No(ce.headers.get("Cache-Control")||"");if(pe["no-store"])return;pe["max-age"]&&ae.headers.set("Expires",new Date(ne+1e3*pe["max-age"]).toUTCString());const he=ae.headers.get("Expires");he&&(new Date(he).getTime()-ne<42e4||function(Me,Ee){if(void 0===Js)try{new Response(new ReadableStream),Js=!0}catch{Js=!1}Js?Ee(Me.body):Me.blob().then(Ee)}(ce,Me=>{const Ee=new Ue.Response(Me,ae);dl(),so&&so.then(Oe=>Oe.put(nc(te.url),Ee)).catch(Oe=>ui(Oe.message))}))}(x,B,$),w=!0,f(null,Z,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(Z=>{D||f(new Error(Z.message))})};return S?function(N,B){if(dl(),!so)return B(null);const $=nc(N.url);so.then(Z=>{Z.match($).then(te=>{const ce=function(ne){if(!ne)return!1;const ae=new Date(ne.headers.get("Expires")||0),pe=No(ne.headers.get("Cache-Control")||"");return ae>Date.now()&&!pe["no-cache"]}(te);Z.delete($),ce&&Z.put($,te.clone()),B(null,te,ce)}).catch(B)}).catch(B)}(x,R):R(null,null),{cancel:()=>{D=!0,w||_.abort()}}}(s,r);if(Ta()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var l;return function(h,f){const _=new Ue.XMLHttpRequest;_.open(h.method||"GET",h.url,!0),"arrayBuffer"===h.type&&(_.responseType="arraybuffer");for(const x in h.headers)_.setRequestHeader(x,h.headers[x]);return"json"===h.type&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials="include"===h.credentials,_.onerror=()=>{f(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||0===_.status)&&null!==_.response){let x=_.response;if("json"===h.type)try{x=JSON.parse(_.response)}catch(w){return f(w)}f(null,x,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else f(new Ma(_.statusText,_.status,h.url))},_.send(h.body),{cancel:()=>_.abort()}}(s,r)},ic=function(s,r){return fl(ki(s,{type:"arrayBuffer"}),r)};function nh(s){const r=Ue.document.createElement("a");return r.href=s,r.protocol===Ue.document.location.protocol&&r.host===Ue.document.location.host}const ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let G,W;G=[],W=0;const se=function(s,r){if(Xt.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),W>=Kt.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return G.push(_),_}W++;let l=!1;const h=()=>{if(!l)for(l=!0,W--;G.length&&W<Kt.MAX_PARALLEL_IMAGE_REQUESTS;){const _=G.shift(),{requestParameters:x,callback:w,cancelled:D}=_;D||(_.cancel=se(x,w).cancel)}},f=ic(s,(_,x,w,D)=>{h(),_?r(_):x&&(Ue.createImageBitmap?function(S,P){const R=new Ue.Blob([new Uint8Array(S)],{type:"image/png"});Ue.createImageBitmap(R).then(O=>{P(null,O)}).catch(O=>{P(new Error(`Could not load image because of ${O.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(S,P)=>r(S,P,w,D)):function(S,P){const R=new Ue.Image,O=Ue.URL;R.onload=()=>{P(null,R),O.revokeObjectURL(R.src),R.onload=null,Ue.requestAnimationFrame(()=>{R.src=ue})},R.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new Ue.Blob([new Uint8Array(S)],{type:"image/png"});R.src=S.byteLength?O.createObjectURL(N):ue}(x,(S,P)=>r(S,P,w,D)))});return{cancel:()=>{f.cancel(),h()}}},me="NO_ACCESS_TOKEN";function ye(s){return 0===s.indexOf("mapbox:")}function De(s){return Kt.API_URL_REGEX.test(s)}function Ce(s){return Kt.API_CDN_URL_REGEX.test(s)}function _e(s){return Kt.API_STYLE_REGEX.test(s)&&!ke(s)}function ke(s){return Kt.API_SPRITE_REGEX.test(s)}const tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function it(s){const r=s.match(tt);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Je(s){const r=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${r}`}const Gt="mapbox.eventData";function en(s){if(!s)return null;const r=s.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(Ue.atob(r[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ut{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=en(Kt.ACCESS_TOKEN);let h="";return h=l&&l.u?Ue.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,_)=>String.fromCharCode(Number("0x"+_)))):Kt.ACCESS_TOKEN||"",r?`${Gt}.${r}:${h}`:`${Gt}:${h}`}fetchEventData(){const r=Zc("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{const f=Ue.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const _=Ue.localStorage.getItem(h);_&&(this.anonId=_)}catch{ui("Unable to read from LocalStorage")}}saveEventData(){const r=Zc("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{Ue.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&Ue.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{ui("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,h,f){if(!Kt.EVENTS_URL)return;const _=it(Kt.EVENTS_URL);_.params.push(`access_token=${f||Kt.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(r).toISOString()},w=l?ki(x,l):x,D={url:Je(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};var P;this.pendingRequest=(P=S=>{this.pendingRequest=null,h(S),this.saveEventData(),this.processRequests(f)},fl(ki(D,{method:"POST"}),P))}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const tn=new class extends Ut{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,r){Kt.EVENTS_URL&&Kt.ACCESS_TOKEN&&Array.isArray(s)&&s.some(l=>ye(l)||De(l))&&this.queueRequest(Date.now(),r)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=en(Kt.ACCESS_TOKEN),l=r?r.u:Kt.ACCESS_TOKEN;let h=l!==this.eventData.tokenU;gi(this.anonId)||(this.anonId=Ys(),h=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),x=new Date(f),w=(f-this.eventData.lastSuccess)/864e5;h=h||w>=1||w<-1||_.getDate()!==x.getDate()}else h=!0;h?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ds,skuId:Jl,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},s):this.processRequests()}},pn=tn.postTurnstileEvent.bind(tn),xn=new class extends Ut{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,r,l,h){this.skuToken=r,this.errorCb=h,Kt.EVENTS_URL&&(l||Kt.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(me)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),gi(this.anonId)||(this.anonId=Ys()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ds,skuId:Jl,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):r&&(this.success[r]=!0)},s))}},Ri=xn.postMapLoadEvent.bind(xn),Tr=new class extends Ut{constructor(){super("gljs.performance")}postPerformanceEvent(s,r){Kt.EVENTS_URL&&(s||Kt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},s)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,performanceData:l}=this.queue.shift(),h=function(f){const _=Ue.performance.getEntriesByType("resource"),x=Ue.performance.getEntriesByType("mark"),w=function(O){const N={};if(O)for(const B in O)if("other"!==B)for(const $ of O[B]){const Z=`${B}ResolveRangeMin`,te=`${B}ResolveRangeMax`,ce=`${B}RequestCount`,ne=`${B}RequestCachedCount`;N[Z]=Math.min(N[Z]||1/0,$.startTime),N[te]=Math.max(N[te]||-1/0,$.responseEnd);const ae=pe=>{void 0===N[pe]&&(N[pe]=0),++N[pe]};void 0!==$.transferSize&&0===$.transferSize&&ae(ne),ae(ce)}return N}(function(O,N){const B={};if(O)for(const $ of O){const Z=N($);void 0===B[Z]&&(B[Z]=[]),B[Z].push($)}return B}(_,wp)),D=Ue.devicePixelRatio,S=Ue.navigator.connection||Ue.navigator.mozConnection||Ue.navigator.webkitConnection,P={counters:[],metadata:[],attributes:[]},R=(O,N,B)=>{null!=B&&O.push({name:N,value:B.toString()})};for(const O in w)R(P.counters,O,w[O]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(R(P.counters,"interactionRangeMin",f.interactionRange[0]),R(P.counters,"interactionRangeMax",f.interactionRange[1])),x)for(const O of Object.keys(rc)){const N=rc[O],B=x.find($=>$.name===N);B&&R(P.counters,N,B.startTime)}return R(P.counters,"visibilityHidden",f.visibilityHidden),R(P.attributes,"style",function(O){if(O)for(const N of O){const B=N.name.split("?")[0];if(_e(B)){const $=B.split("/").slice(-2);if(2===$.length)return`mapbox://styles/${$[0]}/${$[1]}`}}}(_)),R(P.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),R(P.attributes,"fogEnabled",f.fogEnabled?"true":"false"),R(P.attributes,"projection",f.projection),R(P.attributes,"zoom",f.zoom),R(P.metadata,"devicePixelRatio",D),R(P.metadata,"connectionEffectiveType",S?S.effectiveType:void 0),R(P.metadata,"navigatorUserAgent",Ue.navigator.userAgent),R(P.metadata,"screenWidth",Ue.screen.width),R(P.metadata,"screenHeight",Ue.screen.height),R(P.metadata,"windowWidth",Ue.innerWidth),R(P.metadata,"windowHeight",Ue.innerHeight),R(P.metadata,"mapWidth",f.width/D),R(P.metadata,"mapHeight",f.height/D),R(P.metadata,"webglRenderer",f.renderer),R(P.metadata,"webglVendor",f.vendor),R(P.metadata,"sdkVersion",Ds),R(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(l);for(const f of h.metadata);for(const f of h.counters);for(const f of h.attributes);this.postEvent(r,h,()=>{},s)}},ji=Tr.postPerformanceEvent.bind(Tr),Ss=new class extends Ut{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,r,l,h){if(!Kt.API_URL||!Kt.SESSION_PATH)return;const f=it(Kt.API_URL+Kt.SESSION_PATH);f.params.push(`sku=${r||""}`),f.params.push(`access_token=${h||Kt.ACCESS_TOKEN||""}`);const _={url:Je(f),headers:{"Content-Type":"text/plain"}};var w;this.pendingRequest=(w=x=>{this.pendingRequest=null,l(x),this.saveEventData(),this.processRequests(h)},fl(ki(_,{method:"GET"}),w))}getSessionAPI(s,r,l,h){this.skuToken=r,this.errorCb=h,Kt.SESSION_PATH&&Kt.API_URL&&(l||Kt.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(me)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,h=>{h?this.errorCb(h):r&&(this.success[r]=!0)},s)}},Yi=Ss.getSessionAPI.bind(Ss),$r=new Set,rc={create:"create",load:"load",fullLoad:"fullLoad"},Qs={mark(s){Ue.performance.mark(s)},measure(s,r,l){Ue.performance.measure(s,r,l)}};function wp(s){const r=s.name.split("?")[0];return Ce(r)&&r.includes("mapbox-gl.js")?"javascript":Ce(r)&&r.includes("mapbox-gl.css")?"css":Kt.API_FONTS_REGEX.test(r)?"fontRange":ke(r)?"sprite":_e(r)?"style":Kt.API_TILEJSON_REGEX.test(r)?"tilejson":"other"}const Lt=Ue.performance;function Aa(s){const r=s?s.url.toString():void 0;return Lt.getEntriesByName(r)}let ao,Cp,ih,os;const ss={now:()=>void 0!==ih?ih:Ue.performance.now(),setNow(s){ih=s},restoreNow(){ih=void 0},frame(s){const r=Ue.requestAnimationFrame(s);return{cancel:()=>Ue.cancelAnimationFrame(r)}},getImageData(s,r=0){const{width:l,height:h}=s;os||(os=Ue.document.createElement("canvas"));const f=os.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(l>os.width||h>os.height)&&(os.width=l,os.height=h),f.clearRect(-r,-r,l+2*r,h+2*r),f.drawImage(s,0,0,l,h),f.getImageData(-r,-r,l+2*r,h+2*r)},resolveURL:s=>(ao||(ao=Ue.document.createElement("a")),ao.href=s,ao.href),get devicePixelRatio(){return Ue.devicePixelRatio},get prefersReducedMotion(){return!!Ue.matchMedia&&(null==Cp&&(Cp=Ue.matchMedia("(prefers-reduced-motion: reduce)")),Cp.matches)}};function rh(s,r,l){l[s]&&-1!==l[s].indexOf(r)||(l[s]=l[s]||[],l[s].push(r))}function pl(s,r,l){if(l&&l[s]){const h=l[s].indexOf(r);-1!==h&&l[s].splice(h,1)}}class ml{constructor(r,l={}){ki(this,l),this.type=r}}class Ms extends ml{constructor(r,l={}){super("error",ki({error:r},l))}}class oc{on(r,l){return this._listeners=this._listeners||{},rh(r,l,this._listeners),this}off(r,l){return pl(r,l,this._listeners),pl(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},rh(r,l,this._oneTimeListeners),this):new Promise(h=>this.once(r,h))}fire(r,l){"string"==typeof r&&(r=new ml(r,l||{}));const h=r.type;if(this.listens(h)){r.target=this;const f=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const w of f)w.call(this,r);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const w of _)pl(h,w,this._oneTimeListeners),w.call(this,r);const x=this._eventedParent;x&&(ki(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),x.fire(r))}else r instanceof Ms&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var ze=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ea(s,...r){for(const l of r)for(const h in l)s[h]=l[h];return s}function Oi(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function ar(s){if(Array.isArray(s))return s.map(ar);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const l in s)r[l]=ar(s[l]);return r}return Oi(s)}class Fd extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}var Is=Fd;class zd{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[h,f]of l)this.bindings[h]=f}concat(r){return new zd(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var Li=zd;const sc={kind:"null"},ct={kind:"number"},ln={kind:"string"},yt={kind:"boolean"},Hr={kind:"color"},Tn={kind:"object"},nn={kind:"value"},bo={kind:"collator"},Hn={kind:"formatted"},Pt={kind:"resolvedImage"};function lo(s,r){return{kind:"array",itemType:s,N:r}}function ii(s){if("array"===s.kind){const r=ii(s.itemType);return"number"==typeof s.N?`array<${r}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${r}>`}return s.kind}const yg=[sc,ct,ln,yt,Hr,Hn,Tn,lo(nn),Pt];function As(s,r){if("error"===r.kind)return null;if("array"===s.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!As(s.itemType,r.itemType))&&("number"!=typeof s.N||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if("value"===s.kind)for(const l of yg)if(!As(l,r))return null}return`Expected ${ii(s)} but found ${ii(r)} instead.`}function nt(s,r){return r.some(l=>l.kind===s.kind)}function Pa(s,r){return r.some(l=>"null"===l?null===s:"array"===l?Array.isArray(s):"object"===l?s&&!Array.isArray(s)&&"object"==typeof s:l===typeof s)}var Jt,Bn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Yc(s){return(s=Math.round(s))<0?0:s>255?255:s}function oh(s){return Yc("%"===s[s.length-1]?parseFloat(s)/100*255:parseInt(s))}function sh(s){return(r="%"===s[s.length-1]?parseFloat(s)/100:parseFloat(s))<0?0:r>1?1:r;var r}function ta(s,r,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?s+(r-s)*l*6:2*l<1?r:3*l<2?s+(r-s)*(2/3-l)*6:s}try{Jt={}.parseCSSColor=function(s){var r,l=s.replace(/ /g,"").toLowerCase();if(l in Bn)return Bn[l].slice();if("#"===l[0])return 4===l.length?(r=parseInt(l.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:7===l.length&&(r=parseInt(l.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var h=l.indexOf("("),f=l.indexOf(")");if(-1!==h&&f+1===l.length){var _=l.substr(0,h),x=l.substr(h+1,f-(h+1)).split(","),w=1;switch(_){case"rgba":if(4!==x.length)return null;w=sh(x.pop());case"rgb":return 3!==x.length?null:[oh(x[0]),oh(x[1]),oh(x[2]),w];case"hsla":if(4!==x.length)return null;w=sh(x.pop());case"hsl":if(3!==x.length)return null;var D=(parseFloat(x[0])%360+360)%360/360,S=sh(x[1]),P=sh(x[2]),R=P<=.5?P*(S+1):P+S-P*S,O=2*P-R;return[Yc(255*ta(O,R,D+1/3)),Yc(255*ta(O,R,D)),Yc(255*ta(O,R,D-1/3)),w];default:return null}}return null}}catch{}class ai{constructor(r,l,h,f=1){this.r=r,this.g=l,this.b=h,this.a=f}static parse(r){if(!r)return;if(r instanceof ai)return r;if("string"!=typeof r)return;const l=Jt(r);return l?new ai(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[r,l,h,f]=this.toArray();return`rgba(${Math.round(r)},${Math.round(l)},${Math.round(h)},${f})`}toArray(){const{r,g:l,b:h,a:f}=this;return 0===f?[0,0,0,0]:[255*r/f,255*l/f,255*h/f,f]}toArray01(){const{r,g:l,b:h,a:f}=this;return 0===f?[0,0,0,0]:[r/f,l/f,h/f,f]}toArray01PremultipliedAlpha(){const{r,g:l,b:h,a:f}=this;return[r,l,h,f]}}ai.black=new ai(0,0,0,1),ai.white=new ai(1,1,1,1),ai.transparent=new ai(0,0,0,0),ai.red=new ai(1,0,0,1),ai.blue=new ai(0,0,1,1);var Fi=ai;class Nd{constructor(r,l,h){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ep{constructor(r,l,h,f,_){this.text=r.normalize?r.normalize():r,this.image=l,this.scale=h,this.fontStack=f,this.textColor=_}}class zi{constructor(r){this.sections=r}static fromString(r){return new zi([new Ep(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof zi?r:zi.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const l of this.sections){if(l.image){r.push(["image",l.image.name]);continue}r.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toArray())),r.push(h)}return r}}class as{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new as({name:r,available:!1}):null}serialize(){return["image",this.name]}}function vg(s,r,l,h){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid rgba value [${[s,r,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof h?[s,r,l,h]:[s,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ah(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof Fi||s instanceof Nd||s instanceof zi||s instanceof as)return!0;if(Array.isArray(s)){for(const r of s)if(!ah(r))return!1;return!0}if("object"==typeof s){for(const r in s)if(!ah(s[r]))return!1;return!0}return!1}function Ti(s){if(null===s)return sc;if("string"==typeof s)return ln;if("boolean"==typeof s)return yt;if("number"==typeof s)return ct;if(s instanceof Fi)return Hr;if(s instanceof Nd)return bo;if(s instanceof zi)return Hn;if(s instanceof as)return Pt;if(Array.isArray(s)){const r=s.length;let l;for(const h of s){const f=Ti(h);if(l){if(l===f)continue;l=nn;break}l=f}return lo(l||nn,r)}return Tn}function Kc(s){const r=typeof s;return null===s?"":"string"===r||"number"===r||"boolean"===r?String(s):s instanceof Fi||s instanceof zi||s instanceof as?s.toString():JSON.stringify(s)}class Dp{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(2!==r.length)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!ah(r[1]))return l.error("invalid value");const h=r[1];let f=Ti(h);const _=l.expectedType;return"array"!==f.kind||0!==f.N||!_||"array"!==_.kind||"number"==typeof _.N&&0!==_.N||(f=_),new Dp(f,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Fi?["rgba"].concat(this.value.toArray()):this.value instanceof zi?this.value.serialize():this.value}}var gl=Dp,Sr=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const co={string:ln,number:ct,boolean:yt,object:Tn};class On{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let h,f=1;const _=r[0];if("array"===_){let w,D;if(r.length>2){const S=r[1];if("string"!=typeof S||!(S in co)||"object"===S)return l.error('The item type argument of "array" must be one of string, number, boolean',1);w=co[S],f++}else w=nn;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);D=r[2],f++}h=lo(w,D)}else h=co[_];const x=[];for(;f<r.length;f++){const w=l.parse(r[f],f,nn);if(!w)return null;x.push(w)}return new On(h,x)}evaluate(r){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(r);if(!As(this.type,Ti(h)))return h;if(l===this.args.length-1)throw new Sr(`Expected value to be of type ${ii(this.type)}, but found ${ii(Ti(h))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,l=[r.kind];if("array"===r.kind){const h=r.itemType;if("string"===h.kind||"number"===h.kind||"boolean"===h.kind){l.push(h.kind);const f=r.N;("number"==typeof f||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(h=>h.serialize()))}}var ka=On;class _l{constructor(r){this.type=Hn,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&"object"==typeof h)return l.error("First argument must be an image or text section.");const f=[];let _=!1;for(let x=1;x<=r.length-1;++x){const w=r[x];if(_&&"object"==typeof w&&!Array.isArray(w)){_=!1;let D=null;if(w["font-scale"]&&(D=l.parse(w["font-scale"],1,ct),!D))return null;let S=null;if(w["text-font"]&&(S=l.parse(w["text-font"],1,lo(ln)),!S))return null;let P=null;if(w["text-color"]&&(P=l.parse(w["text-color"],1,Hr),!P))return null;const R=f[f.length-1];R.scale=D,R.font=S,R.textColor=P}else{const D=l.parse(r[x],1,nn);if(!D)return null;const S=D.type.kind;if("string"!==S&&"value"!==S&&"null"!==S&&"resolvedImage"!==S)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,f.push({content:D,scale:null,font:null,textColor:null})}}return new _l(f)}evaluate(r){return new zi(this.sections.map(l=>{const h=l.content.evaluate(r);return Ti(h)===Pt?new Ep("",h,null,null,null):new Ep(Kc(h),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)}))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const l of this.sections){r.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),r.push(h)}return r}}class Bd{constructor(r){this.type=Pt,this.input=r}static parse(r,l){if(2!==r.length)return l.error("Expected two arguments.");const h=l.parse(r[1],1,ln);return h?new Bd(h):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),h=as.fromString(l);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(l)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const At={"to-boolean":yt,"to-color":Hr,"to-number":ct,"to-string":ln};class Tp{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[0];if(("to-boolean"===h||"to-string"===h)&&2!==r.length)return l.error("Expected one argument.");const f=At[h],_=[];for(let x=1;x<r.length;x++){const w=l.parse(r[x],x,nn);if(!w)return null;_.push(w)}return new Tp(f,_)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let l,h;for(const f of this.args){if(l=f.evaluate(r),h=null,l instanceof Fi)return l;if("string"==typeof l){const _=r.parseColor(l);if(_)return _}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:vg(l[0],l[1],l[2],l[3]),!h))return new Fi(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Sr(h||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const h of this.args){if(l=h.evaluate(r),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new Sr(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?zi.fromString(Kc(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?as.fromString(Kc(this.args[0].evaluate(r))):Kc(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new _l([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Bd(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(l=>{r.push(l.serialize())}),r}}var Ui=Tp;const wo=["Unknown","Point","LineString","Polygon"];var Vd=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?wo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-s[0])+this.featureDistanceData.bearing[1]*(h*r-s[1])}return 0}parseColor(s){let r=this._parseColorCache[s];return r||(r=this._parseColorCache[s]=Fi.parse(s)),r}};class Ra{constructor(r,l,h,f){this.name=r,this.type=l,this._evaluate=h,this.args=f}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,l){const h=r[0],f=Ra.definitions[h];if(!f)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(f)?f[0]:f.type,x=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=x.filter(([S])=>!Array.isArray(S)||S.length===r.length-1);let D=null;for(const[S,P]of w){D=new Dt(l.registry,l.path,null,l.scope);const R=[];let O=!1;for(let N=1;N<r.length;N++){const B=r[N],$=Array.isArray(S)?S[N-1]:S.type,Z=D.parse(B,1+R.length,$);if(!Z){O=!0;break}R.push(Z)}if(!O)if(Array.isArray(S)&&S.length!==R.length)D.error(`Expected ${S.length} arguments, but found ${R.length} instead.`);else{for(let N=0;N<R.length;N++){const B=Array.isArray(S)?S[N]:S.type,$=R[N];D.concat(N+1).checkSubtype(B,$.type)}if(0===D.errors.length)return new Ra(h,_,P,R)}}if(1===w.length)l.errors.push(...D.errors);else{const S=(w.length?w:x).map(([R])=>{return O=R,Array.isArray(O)?`(${O.map(ii).join(", ")})`:`(${ii(O.type)}...)`;var O}).join(" | "),P=[];for(let R=1;R<r.length;R++){const O=l.parse(r[R],1+P.length);if(!O)return null;P.push(ii(O.type))}l.error(`Expected arguments of type ${S}, but found (${P.join(", ")}) instead.`)}return null}static register(r,l){Ra.definitions=l;for(const h in l)r[h]=Ra}}var na=Ra;class ac{constructor(r,l,h){this.type=bo,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(2!==r.length)return l.error("Expected one argument.");const h=r[1];if("object"!=typeof h||Array.isArray(h))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==h["case-sensitive"]&&h["case-sensitive"],1,yt);if(!f)return null;const _=l.parse(void 0!==h["diacritic-sensitive"]&&h["diacritic-sensitive"],1,yt);if(!_)return null;let x=null;return h.locale&&(x=l.parse(h.locale,1,ln),!x)?null:new ac(f,_,x)}evaluate(r){return new Nd(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const Vo=8192;function lc(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function yl(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function Jc(s,r){const l=(180+s[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,f=Math.pow(2,r.z);return[Math.round(l*f*Vo),Math.round(h*f*Vo)]}function Nt(s,r,l){const h=s[0]-r[0],f=s[1]-r[1],_=s[0]-l[0],x=s[1]-l[1];return h*x-_*f==0&&h*_<=0&&f*x<=0}function cc(s,r){let l=!1;for(let x=0,w=r.length;x<w;x++){const D=r[x];for(let S=0,P=D.length;S<P-1;S++){if(Nt(s,D[S],D[S+1]))return!1;(f=D[S])[1]>(h=s)[1]!=(_=D[S+1])[1]>h[1]&&h[0]<(_[0]-f[0])*(h[1]-f[1])/(_[1]-f[1])+f[0]&&(l=!l)}}var h,f,_;return l}function jd(s,r){for(let l=0;l<r.length;l++)if(cc(s,r[l]))return!0;return!1}function uo(s,r,l,h){const f=h[0]-l[0],_=h[1]-l[1],x=(s[0]-l[0])*_-f*(s[1]-l[1]),w=(r[0]-l[0])*_-f*(r[1]-l[1]);return x>0&&w<0||x<0&&w>0}function vl(s,r,l){for(const S of l)for(let P=0;P<S.length-1;++P)if((w=[(x=S[P+1])[0]-(_=S[P])[0],x[1]-_[1]])[0]*(D=[(f=r)[0]-(h=s)[0],f[1]-h[1]])[1]-w[1]*D[0]!=0&&uo(h,f,_,x)&&uo(_,x,h,f))return!0;var h,f,_,x,w,D;return!1}function In(s,r){for(let l=0;l<s.length;++l)if(!cc(s[l],r))return!1;for(let l=0;l<s.length-1;++l)if(vl(s[l],s[l+1],r))return!1;return!0}function hi(s,r){for(let l=0;l<r.length;l++)if(In(s,r[l]))return!0;return!1}function Sp(s,r,l){const h=[];for(let f=0;f<s.length;f++){const _=[];for(let x=0;x<s[f].length;x++){const w=Jc(s[f][x],l);lc(r,w),_.push(w)}h.push(_)}return h}function xg(s,r,l){const h=[];for(let f=0;f<s.length;f++){const _=Sp(s[f],r,l);h.push(_)}return h}function Mp(s,r,l,h){if(s[0]<l[0]||s[0]>l[2]){const f=.5*h;let _=s[0]-l[0]>f?-h:l[0]-s[0]>f?h:0;0===_&&(_=s[0]-l[2]>f?-h:l[2]-s[0]>f?h:0),s[0]+=_}lc(r,s)}function uc(s,r,l,h){const f=Math.pow(2,h.z)*Vo,_=[h.x*Vo,h.y*Vo],x=[];if(!s)return x;for(const w of s)for(const D of w){const S=[D.x+_[0],D.y+_[1]];Mp(S,r,l,f),x.push(S)}return x}function Qc(s,r,l,h){const f=Math.pow(2,h.z)*Vo,_=[h.x*Vo,h.y*Vo],x=[];if(!s)return x;for(const D of s){const S=[];for(const P of D){const R=[P.x+_[0],P.y+_[1]];lc(r,R),S.push(R)}x.push(S)}if(r[2]-r[0]<=f/2){(w=r)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const D of x)for(const S of D)Mp(S,r,l,f)}var w;return x}class ia{constructor(r,l){this.type=yt,this.geojson=r,this.geometries=l}static parse(r,l){if(2!==r.length)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ah(r[1])){const h=r[1];if("FeatureCollection"===h.type)for(let f=0;f<h.features.length;++f){const _=h.features[f].geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new ia(h,h.features[f].geometry)}else if("Feature"===h.type){const f=h.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new ia(h,h.geometry)}else if("Polygon"===h.type||"MultiPolygon"===h.type)return new ia(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(l,h){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(!x)return!1;if("Polygon"===h.type){const w=Sp(h.coordinates,_,x),D=uc(l.geometry(),f,_,x);if(!yl(f,_))return!1;for(const S of D)if(!cc(S,w))return!1}if("MultiPolygon"===h.type){const w=xg(h.coordinates,_,x),D=uc(l.geometry(),f,_,x);if(!yl(f,_))return!1;for(const S of D)if(!jd(S,w))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(l,h){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(!x)return!1;if("Polygon"===h.type){const w=Sp(h.coordinates,_,x),D=Qc(l.geometry(),f,_,x);if(!yl(f,_))return!1;for(const S of D)if(!In(S,w))return!1}if("MultiPolygon"===h.type){const w=xg(h.coordinates,_,x),D=Qc(l.geometry(),f,_,x);if(!yl(f,_))return!1;for(const S of D)if(!hi(S,w))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var lh=ia;function hc(s){if(s instanceof na&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof lh)return!1;let r=!0;return s.eachChild(l=>{r&&!hc(l)&&(r=!1)}),r}function ra(s){if(s instanceof na&&"feature-state"===s.name)return!1;let r=!0;return s.eachChild(l=>{r&&!ra(l)&&(r=!1)}),r}function Oa(s,r){if(s instanceof na&&r.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(h=>{l&&!Oa(h,r)&&(l=!1)}),l}class La{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(2!==r.length||"string"!=typeof r[1])return l.error("'var' expression requires exactly one string literal argument.");const h=r[1];return l.scope.has(h)?new La(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var xl=La;class eu{constructor(r,l=[],h,f=new Li,_=[]){this.registry=r,this.path=l,this.key=l.map(x=>`[${x}]`).join(""),this.scope=f,this.errors=_,this.expectedType=h}parse(r,l,h,f,_={}){return l?this.concat(l,h,f)._parse(r,_):this._parse(r,_)}_parse(r,l){function h(f,_,x){return"assert"===x?new ka(_,[f]):"coerce"===x?new Ui(_,[f]):f}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=r[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[f];if(_){let x=_.parse(r,this);if(!x)return null;if(this.expectedType){const w=this.expectedType,D=x.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==D.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==D.kind&&"string"!==D.kind){if(this.checkSubtype(w,D))return null}else x=h(x,w,l.typeAnnotation||"coerce");else x=h(x,w,l.typeAnnotation||"assert")}if(!(x instanceof gl)&&"resolvedImage"!==x.type.kind&&ch(x)){const w=new Vd;try{x=new gl(x.type,x.evaluate(w))}catch(D){return this.error(D.message),null}}return x}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,h){const f="number"==typeof r?this.path.concat(r):this.path,_=h?this.scope.concat(h):this.scope;return new eu(this.registry,f,l||null,_,this.errors)}error(r,...l){const h=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new Is(h,r))}checkSubtype(r,l){const h=As(r,l);return h&&this.error(h),h}}var Dt=eu;function ch(s){if(s instanceof xl)return ch(s.boundExpression);if(s instanceof na&&"error"===s.name||s instanceof ac||s instanceof lh)return!1;const r=s instanceof Ui||s instanceof ka;let l=!0;return s.eachChild(h=>{l=r?l&&ch(h):l&&h instanceof gl}),!!l&&hc(s)&&Oa(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function cn(s,r){const l=s.length-1;let h,f,_=0,x=l,w=0;for(;_<=x;)if(w=Math.floor((_+x)/2),h=s[w],f=s[w+1],h<=r){if(w===l||r<f)return w;_=w+1}else{if(!(h>r))throw new Sr("Input is not a number.");x=w-1}return 0}class bl{constructor(r,l,h){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[f,_]of h)this.labels.push(f),this.outputs.push(_)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(r[1],1,ct);if(!h)return null;const f=[];let _=null;l.expectedType&&"value"!==l.expectedType.kind&&(_=l.expectedType);for(let x=1;x<r.length;x+=2){const w=1===x?-1/0:r[x],D=r[x+1],S=x,P=x+1;if("number"!=typeof w)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(f.length&&f[f.length-1][0]>=w)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const R=l.parse(D,P,_);if(!R)return null;_=_||R.type,f.push([w,R])}return new bl(_,h,f)}evaluate(r){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(r);const f=this.input.evaluate(r);if(f<=l[0])return h[0].evaluate(r);const _=l.length;return f>=l[_-1]?h[_-1].evaluate(r):h[cn(l,f)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&r.push(this.labels[l]),r.push(this.outputs[l].serialize());return r}}var tu=bl;function mn(s,r,l){return s*(1-l)+r*l}var nu=Object.freeze({__proto__:null,array:function(s,r,l){return s.map((h,f)=>mn(h,r[f],l))},color:function(s,r,l){return new Fi(mn(s.r,r.r,l),mn(s.g,r.g,l),mn(s.b,r.b,l),mn(s.a,r.a,l))},number:mn});const Ip=.95047,Ud=1.08883,Ps=4/29,Mr=6/29,jo=3*Mr*Mr,oa=Mr*Mr*Mr,Vn=Math.PI/180,uh=180/Math.PI;function iu(s){return s>oa?Math.pow(s,1/3):s/jo+Ps}function ru(s){return s>Mr?s*s*s:jo*(s-Ps)}function hh(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Uo(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function dc(s){const r=Uo(s.r),l=Uo(s.g),h=Uo(s.b),f=iu((.4124564*r+.3575761*l+.1804375*h)/Ip),_=iu((.2126729*r+.7151522*l+.072175*h)/1);return{l:116*_-16,a:500*(f-_),b:200*(_-iu((.0193339*r+.119192*l+.9503041*h)/Ud)),alpha:s.a}}function Ap(s){let r=(s.l+16)/116,l=isNaN(s.a)?r:r+s.a/500,h=isNaN(s.b)?r:r-s.b/200;return r=1*ru(r),l=Ip*ru(l),h=Ud*ru(h),new Fi(hh(3.2404542*l-1.5371385*r-.4985314*h),hh(-.969266*l+1.8760108*r+.041556*h),hh(.0556434*l-.2040259*r+1.0572252*h),s.alpha)}function ks(s,r,l){const h=r-s;return s+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const ou={forward:dc,reverse:Ap,interpolate:function(s,r,l){return{l:mn(s.l,r.l,l),a:mn(s.a,r.a,l),b:mn(s.b,r.b,l),alpha:mn(s.alpha,r.alpha,l)}}},fc={forward:function(s){const{l:r,a:l,b:h}=dc(s),f=Math.atan2(h,l)*uh;return{h:f<0?f+360:f,c:Math.sqrt(l*l+h*h),l:r,alpha:s.a}},reverse:function(s){const r=s.h*Vn,l=s.c;return Ap({l:s.l,a:Math.cos(r)*l,b:Math.sin(r)*l,alpha:s.alpha})},interpolate:function(s,r,l){return{h:ks(s.h,r.h,l),c:mn(s.c,r.c,l),l:mn(s.l,r.l,l),alpha:mn(s.alpha,r.alpha,l)}}};var $d=Object.freeze({__proto__:null,hcl:fc,lab:ou});class lr{constructor(r,l,h,f,_){this.type=r,this.operator=l,this.interpolation=h,this.input=f,this.labels=[],this.outputs=[];for(const[x,w]of _)this.labels.push(x),this.outputs.push(w)}static interpolationFactor(r,l,h,f){let _=0;if("exponential"===r.name)_=Hd(l,r.base,h,f);else if("linear"===r.name)_=Hd(l,1,h,f);else if("cubic-bezier"===r.name){const x=r.controlPoints;_=new al(x[0],x[1],x[2],x[3]).solve(Hd(l,1,h,f))}return _}static parse(r,l){let[h,f,_,...x]=r;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const S=f[1];if("number"!=typeof S)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:S}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const S=f.slice(1);if(4!==S.length||S.some(P=>"number"!=typeof P||P<0||P>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:S}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(_=l.parse(_,2,ct),!_)return null;const w=[];let D=null;"interpolate-hcl"===h||"interpolate-lab"===h?D=Hr:l.expectedType&&"value"!==l.expectedType.kind&&(D=l.expectedType);for(let S=0;S<x.length;S+=2){const P=x[S],R=x[S+1],O=S+3,N=S+4;if("number"!=typeof P)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(w.length&&w[w.length-1][0]>=P)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const B=l.parse(R,N,D);if(!B)return null;D=D||B.type,w.push([P,B])}return"number"===D.kind||"color"===D.kind||"array"===D.kind&&"number"===D.itemType.kind&&"number"==typeof D.N?new lr(D,h,f,_,w):l.error(`Type ${ii(D)} is not interpolatable.`)}evaluate(r){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(r);const f=this.input.evaluate(r);if(f<=l[0])return h[0].evaluate(r);const _=l.length;if(f>=l[_-1])return h[_-1].evaluate(r);const x=cn(l,f),w=lr.interpolationFactor(this.interpolation,f,l[x],l[x+1]),D=h[x].evaluate(r),S=h[x+1].evaluate(r);return"interpolate"===this.operator?nu[this.type.kind.toLowerCase()](D,S,w):"interpolate-hcl"===this.operator?fc.reverse(fc.interpolate(fc.forward(D),fc.forward(S),w)):ou.reverse(ou.interpolate(ou.forward(D),ou.forward(S),w))}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,r,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function Hd(s,r,l,h){const f=h-l,_=s-l;return 0===f?0:1===r?_/f:(Math.pow(r,_)-1)/(Math.pow(r,f)-1)}var ls=lr;class Ft{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let h=null;const f=l.expectedType;f&&"value"!==f.kind&&(h=f);const _=[];for(const w of r.slice(1)){const D=l.parse(w,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!D)return null;h=h||D.type,_.push(D)}const x=f&&_.some(w=>As(f,w.type));return new Ft(x?nn:h,_)}evaluate(r){let l,h=null,f=0;for(const _ of this.args){if(f++,h=_.evaluate(r),h&&h instanceof as&&!h.available&&(l||(l=h),h=null,f===this.args.length))return l;if(null!==h)break}return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(l=>{r.push(l.serialize())}),r}}var Ir=Ft;class An{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let _=1;_<r.length-1;_+=2){const x=r[_];if("string"!=typeof x)return l.error(`Expected string, but found ${typeof x} instead.`,_);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=l.parse(r[_+1],_+1);if(!w)return null;h.push([x,w])}const f=l.parse(r[r.length-1],r.length-1,l.expectedType,h);return f?new An(h,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[l,h]of this.bindings)r.push(l,h.serialize());return r.push(this.result.serialize()),r}}var mr=An;class Ar{constructor(r,l,h){this.type=r,this.index=l,this.input=h}static parse(r,l){if(3!==r.length)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,ct),f=l.parse(r[2],2,lo(l.expectedType||nn));return h&&f?new Ar(f.type.itemType,h,f):null}evaluate(r){const l=this.index.evaluate(r),h=this.input.evaluate(r);if(l<0)throw new Sr(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new Sr(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new Sr(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var pc=Ar;class Gr{constructor(r,l){this.type=yt,this.needle=r,this.haystack=l}static parse(r,l){if(3!==r.length)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,nn),f=l.parse(r[2],2,nn);return h&&f?nt(h.type,[yt,ln,ct,sc,nn])?new Gr(h,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(h.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(null==h)return!1;if(!Pa(l,["boolean","string","number","null"]))throw new Sr(`Expected first argument to be of type boolean, string, number or null, but found ${ii(Ti(l))} instead.`);if(!Pa(h,["string","array"]))throw new Sr(`Expected second argument to be of type array or string, but found ${ii(Ti(h))} instead.`);return h.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var su=Gr;class mc{constructor(r,l,h){this.type=ct,this.needle=r,this.haystack=l,this.fromIndex=h}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,nn),f=l.parse(r[2],2,nn);if(!h||!f)return null;if(!nt(h.type,[yt,ln,ct,sc,nn]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(h.type)} instead`);if(4===r.length){const _=l.parse(r[3],3,ct);return _?new mc(h,f,_):null}return new mc(h,f)}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!Pa(l,["boolean","string","number","null"]))throw new Sr(`Expected first argument to be of type boolean, string, number or null, but found ${ii(Ti(l))} instead.`);if(!Pa(h,["string","array"]))throw new Sr(`Expected second argument to be of type array or string, but found ${ii(Ti(h))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(r);return h.indexOf(l,f)}return h.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var au=mc;class cs{constructor(r,l,h,f,_,x){this.inputType=r,this.type=l,this.input=h,this.cases=f,this.outputs=_,this.otherwise=x}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let h,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const _={},x=[];for(let S=2;S<r.length-1;S+=2){let P=r[S];const R=r[S+1];Array.isArray(P)||(P=[P]);const O=l.concat(S);if(0===P.length)return O.error("Expected at least one branch label.");for(const B of P){if("number"!=typeof B&&"string"!=typeof B)return O.error("Branch labels must be numbers or strings.");if("number"==typeof B&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof B&&Math.floor(B)!==B)return O.error("Numeric branch labels must be integer values.");if(h){if(O.checkSubtype(h,Ti(B)))return null}else h=Ti(B);if(void 0!==_[String(B)])return O.error("Branch labels must be unique.");_[String(B)]=x.length}const N=l.parse(R,S,f);if(!N)return null;f=f||N.type,x.push(N)}const w=l.parse(r[1],1,nn);if(!w)return null;const D=l.parse(r[r.length-1],r.length-1,f);return D?"value"!==w.type.kind&&l.concat(1).checkSubtype(h,w.type)?null:new cs(h,f,w,_,x,D):null}evaluate(r){const l=this.input.evaluate(r);return(Ti(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],f={};for(const x of l){const w=f[this.cases[x]];void 0===w?(f[this.cases[x]]=h.length,h.push([this.cases[x],[x]])):h[w][1].push(x)}const _=x=>"number"===this.inputType.kind?Number(x):x;for(const[x,w]of h)r.push(1===w.length?_(w[0]):w.map(_)),r.push(this.outputs[x].serialize());return r.push(this.otherwise.serialize()),r}}var wt=cs;class un{constructor(r,l,h){this.type=r,this.branches=l,this.otherwise=h}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&"value"!==l.expectedType.kind&&(h=l.expectedType);const f=[];for(let x=1;x<r.length-1;x+=2){const w=l.parse(r[x],x,yt);if(!w)return null;const D=l.parse(r[x+1],x+1,h);if(!D)return null;f.push([w,D]),h=h||D.type}const _=l.parse(r[r.length-1],r.length-1,h);return _?new un(h,f,_):null}evaluate(r){for(const[l,h]of this.branches)if(l.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,h]of this.branches)r(l),r(h);r(this.otherwise)}outputDefined(){return this.branches.every(([r,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(l=>{r.push(l.serialize())}),r}}var bi=un;class Wr{constructor(r,l,h,f){this.type=r,this.input=l,this.beginIndex=h,this.endIndex=f}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,nn),f=l.parse(r[2],2,ct);if(!h||!f)return null;if(!nt(h.type,[lo(nn),ln,nn]))return l.error(`Expected first argument to be of type array or string, but found ${ii(h.type)} instead`);if(4===r.length){const _=l.parse(r[3],3,ct);return _?new Wr(h.type,h,f,_):null}return new Wr(h.type,h,f)}evaluate(r){const l=this.input.evaluate(r),h=this.beginIndex.evaluate(r);if(!Pa(l,["string","array"]))throw new Sr(`Expected first argument to be of type array or string, but found ${ii(Ti(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(r);return l.slice(h,f)}return l.slice(h)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Fa=Wr;function Ki(s,r){return"=="===s||"!="===s?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function wl(s,r,l,h){return 0===h.compare(r,l)}function li(s,r,l){const h="=="!==s&&"!="!==s;return class nO{constructor(_,x,w){this.type=yt,this.lhs=_,this.rhs=x,this.collator=w,this.hasUntypedArgument="value"===_.type.kind||"value"===x.type.kind}static parse(_,x){if(3!==_.length&&4!==_.length)return x.error("Expected two or three arguments.");const w=_[0];let D=x.parse(_[1],1,nn);if(!D)return null;if(!Ki(w,D.type))return x.concat(1).error(`"${w}" comparisons are not supported for type '${ii(D.type)}'.`);let S=x.parse(_[2],2,nn);if(!S)return null;if(!Ki(w,S.type))return x.concat(2).error(`"${w}" comparisons are not supported for type '${ii(S.type)}'.`);if(D.type.kind!==S.type.kind&&"value"!==D.type.kind&&"value"!==S.type.kind)return x.error(`Cannot compare types '${ii(D.type)}' and '${ii(S.type)}'.`);h&&("value"===D.type.kind&&"value"!==S.type.kind?D=new ka(S.type,[D]):"value"!==D.type.kind&&"value"===S.type.kind&&(S=new ka(D.type,[S])));let P=null;if(4===_.length){if("string"!==D.type.kind&&"string"!==S.type.kind&&"value"!==D.type.kind&&"value"!==S.type.kind)return x.error("Cannot use collator to compare non-string types.");if(P=x.parse(_[3],3,bo),!P)return null}return new nO(D,S,P)}evaluate(_){const x=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const D=Ti(x),S=Ti(w);if(D.kind!==S.kind||"string"!==D.kind&&"number"!==D.kind)throw new Sr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${D.kind}, ${S.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const D=Ti(x),S=Ti(w);if("string"!==D.kind||"string"!==S.kind)return r(_,x,w)}return this.collator?l(_,x,w,this.collator.evaluate(_)):r(_,x,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[s];return this.eachChild(x=>{_.push(x.serialize())}),_}}}const dh=li("==",function(s,r,l){return r===l},wl),fh=li("!=",function(s,r,l){return r!==l},function(s,r,l,h){return!wl(0,r,l,h)}),_n=li("<",function(s,r,l){return r<l},function(s,r,l,h){return h.compare(r,l)<0}),Gd=li(">",function(s,r,l){return r>l},function(s,r,l,h){return h.compare(r,l)>0}),lu=li("<=",function(s,r,l){return r<=l},function(s,r,l,h){return h.compare(r,l)<=0}),Wd=li(">=",function(s,r,l){return r>=l},function(s,r,l,h){return h.compare(r,l)>=0});class sa{constructor(r,l,h,f,_,x){this.type=ln,this.number=r,this.locale=l,this.currency=h,this.unit=f,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(r,l){if(3!==r.length)return l.error("Expected two arguments.");const h=l.parse(r[1],1,ct);if(!h)return null;const f=r[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let _=null;if(f.locale&&(_=l.parse(f.locale,1,ln),!_))return null;let x=null;if(f.currency&&(x=l.parse(f.currency,1,ln),!x))return null;let w=null;if(f.unit&&(w=l.parse(f.unit,1,ln),!w))return null;let D=null;if(f["min-fraction-digits"]&&(D=l.parse(f["min-fraction-digits"],1,ct),!D))return null;let S=null;return f["max-fraction-digits"]&&(S=l.parse(f["max-fraction-digits"],1,ct),!S)?null:new sa(h,_,x,w,D,S)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Ni{constructor(r){this.type=ct,this.input=r}static parse(r,l){if(2!==r.length)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=l.parse(r[1],1);return h?"array"!==h.type.kind&&"string"!==h.type.kind&&"value"!==h.type.kind?l.error(`Expected argument of type string or array, but found ${ii(h.type)} instead.`):new Ni(h):null}evaluate(r){const l=this.input.evaluate(r);if("string"==typeof l||Array.isArray(l))return l.length;throw new Sr(`Expected value to be of type string or array, but found ${ii(Ti(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(l=>{r.push(l.serialize())}),r}}const gc={"==":dh,"!=":fh,">":Gd,"<":_n,">=":Wd,"<=":lu,array:ka,at:pc,boolean:ka,case:bi,coalesce:Ir,collator:ac,format:_l,image:Bd,in:su,"index-of":au,interpolate:ls,"interpolate-hcl":ls,"interpolate-lab":ls,length:Ni,let:mr,literal:gl,match:wt,number:ka,"number-format":sa,object:ka,slice:Fa,step:tu,string:ka,"to-boolean":Ui,"to-color":Ui,"to-number":Ui,"to-string":Ui,var:xl,within:lh};function Cl(s,[r,l,h,f]){r=r.evaluate(s),l=l.evaluate(s),h=h.evaluate(s);const _=f?f.evaluate(s):1,x=vg(r,l,h,_);if(x)throw new Sr(x);return new Fi(r/255*_,l/255*_,h/255*_,_)}function cr(s,r){return s in r}function za(s,r){const l=r[s];return void 0===l?null:l}function Co(s){return{type:s}}na.register(gc,{error:[{kind:"error"},[ln],(s,[r])=>{throw new Sr(r.evaluate(s))}],typeof:[ln,[nn],(s,[r])=>ii(Ti(r.evaluate(s)))],"to-rgba":[lo(ct,4),[Hr],(s,[r])=>r.evaluate(s).toArray()],rgb:[Hr,[ct,ct,ct],Cl],rgba:[Hr,[ct,ct,ct,ct],Cl],has:{type:yt,overloads:[[[ln],(s,[r])=>cr(r.evaluate(s),s.properties())],[[ln,Tn],(s,[r,l])=>cr(r.evaluate(s),l.evaluate(s))]]},get:{type:nn,overloads:[[[ln],(s,[r])=>za(r.evaluate(s),s.properties())],[[ln,Tn],(s,[r,l])=>za(r.evaluate(s),l.evaluate(s))]]},"feature-state":[nn,[ln],(s,[r])=>za(r.evaluate(s),s.featureState||{})],properties:[Tn,[],s=>s.properties()],"geometry-type":[ln,[],s=>s.geometryType()],id:[nn,[],s=>s.id()],zoom:[ct,[],s=>s.globals.zoom],pitch:[ct,[],s=>s.globals.pitch||0],"distance-from-center":[ct,[],s=>s.distanceFromCenter()],"heatmap-density":[ct,[],s=>s.globals.heatmapDensity||0],"line-progress":[ct,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[ct,[],s=>s.globals.skyRadialProgress||0],accumulated:[nn,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[ct,Co(ct),(s,r)=>{let l=0;for(const h of r)l+=h.evaluate(s);return l}],"*":[ct,Co(ct),(s,r)=>{let l=1;for(const h of r)l*=h.evaluate(s);return l}],"-":{type:ct,overloads:[[[ct,ct],(s,[r,l])=>r.evaluate(s)-l.evaluate(s)],[[ct],(s,[r])=>-r.evaluate(s)]]},"/":[ct,[ct,ct],(s,[r,l])=>r.evaluate(s)/l.evaluate(s)],"%":[ct,[ct,ct],(s,[r,l])=>r.evaluate(s)%l.evaluate(s)],ln2:[ct,[],()=>Math.LN2],pi:[ct,[],()=>Math.PI],e:[ct,[],()=>Math.E],"^":[ct,[ct,ct],(s,[r,l])=>Math.pow(r.evaluate(s),l.evaluate(s))],sqrt:[ct,[ct],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[ct,[ct],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[ct,[ct],(s,[r])=>Math.log(r.evaluate(s))],log2:[ct,[ct],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[ct,[ct],(s,[r])=>Math.sin(r.evaluate(s))],cos:[ct,[ct],(s,[r])=>Math.cos(r.evaluate(s))],tan:[ct,[ct],(s,[r])=>Math.tan(r.evaluate(s))],asin:[ct,[ct],(s,[r])=>Math.asin(r.evaluate(s))],acos:[ct,[ct],(s,[r])=>Math.acos(r.evaluate(s))],atan:[ct,[ct],(s,[r])=>Math.atan(r.evaluate(s))],min:[ct,Co(ct),(s,r)=>Math.min(...r.map(l=>l.evaluate(s)))],max:[ct,Co(ct),(s,r)=>Math.max(...r.map(l=>l.evaluate(s)))],abs:[ct,[ct],(s,[r])=>Math.abs(r.evaluate(s))],round:[ct,[ct],(s,[r])=>{const l=r.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[ct,[ct],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[ct,[ct],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[yt,[ln,nn],(s,[r,l])=>s.properties()[r.value]===l.value],"filter-id-==":[yt,[nn],(s,[r])=>s.id()===r.value],"filter-type-==":[yt,[ln],(s,[r])=>s.geometryType()===r.value],"filter-<":[yt,[ln,nn],(s,[r,l])=>{const h=s.properties()[r.value],f=l.value;return typeof h==typeof f&&h<f}],"filter-id-<":[yt,[nn],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l<h}],"filter->":[yt,[ln,nn],(s,[r,l])=>{const h=s.properties()[r.value],f=l.value;return typeof h==typeof f&&h>f}],"filter-id->":[yt,[nn],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l>h}],"filter-<=":[yt,[ln,nn],(s,[r,l])=>{const h=s.properties()[r.value],f=l.value;return typeof h==typeof f&&h<=f}],"filter-id-<=":[yt,[nn],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l<=h}],"filter->=":[yt,[ln,nn],(s,[r,l])=>{const h=s.properties()[r.value],f=l.value;return typeof h==typeof f&&h>=f}],"filter-id->=":[yt,[nn],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l>=h}],"filter-has":[yt,[nn],(s,[r])=>r.value in s.properties()],"filter-has-id":[yt,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[yt,[lo(ln)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[yt,[lo(nn)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[yt,[ln,lo(nn)],(s,[r,l])=>l.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[yt,[ln,lo(nn)],(s,[r,l])=>function(h,f,_,x){for(;_<=x;){const w=_+x>>1;if(f[w]===h)return!0;f[w]>h?x=w-1:_=w+1}return!1}(s.properties()[r.value],l.value,0,l.value.length-1)],all:{type:yt,overloads:[[[yt,yt],(s,[r,l])=>r.evaluate(s)&&l.evaluate(s)],[Co(yt),(s,r)=>{for(const l of r)if(!l.evaluate(s))return!1;return!0}]]},any:{type:yt,overloads:[[[yt,yt],(s,[r,l])=>r.evaluate(s)||l.evaluate(s)],[Co(yt),(s,r)=>{for(const l of r)if(l.evaluate(s))return!0;return!1}]]},"!":[yt,[yt],(s,[r])=>!r.evaluate(s)],"is-supported-script":[yt,[ln],(s,[r])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(r.evaluate(s))}],upcase:[ln,[ln],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[ln,[ln],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[ln,Co(nn),(s,r)=>r.map(l=>Kc(l.evaluate(s))).join("")],"resolved-locale":[ln,[bo],(s,[r])=>r.evaluate(s).resolvedLocale()]});var Kn=gc;function bg(s){return{result:"success",value:s}}function aa(s){return{result:"error",value:s}}function El(s){return"data-driven"===s["property-type"]}function Dl(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Tl(s){return!!s.expression&&s.expression.interpolated}function gn(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function Ji(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function wg(s){return s}function Pr(s,r){const l="color"===r.type,h=s.stops&&"object"==typeof s.stops[0][0],f=h||!(h||void 0!==s.property),_=s.type||(Tl(r)?"exponential":"interval");if(l&&((s=ea({},s)).stops&&(s.stops=s.stops.map(S=>[S[0],Fi.parse(S[1])])),s.default=Fi.parse(s.default?s.default:r.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!$d[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let x,w,D;if("exponential"===_)x=$o;else if("interval"===_)x=Na;else if("categorical"===_){x=ph,w=Object.create(null);for(const S of s.stops)w[S[0]]=S[1];D=typeof s.stops[0][0]}else{if("identity"!==_)throw new Error(`Unknown function type "${_}"`);x=Ho}if(h){const S={},P=[];for(let N=0;N<s.stops.length;N++){const B=s.stops[N],$=B[0].zoom;void 0===S[$]&&(S[$]={zoom:$,type:s.type,property:s.property,default:s.default,stops:[]},P.push($)),S[$].stops.push([B[0].value,B[1]])}const R=[];for(const N of P)R.push([S[N].zoom,Pr(S[N],r)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:ls.interpolationFactor.bind(void 0,O),zoomStops:R.map(N=>N[0]),evaluate:({zoom:N},B)=>$o({stops:R,base:s.base},r,N).evaluate(N,B)}}if(f){const S="exponential"===_?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:ls.interpolationFactor.bind(void 0,S),zoomStops:s.stops.map(P=>P[0]),evaluate:({zoom:P})=>x(s,r,P,w,D)}}return{kind:"source",evaluate(S,P){const R=P&&P.properties?P.properties[s.property]:void 0;return void 0===R?kr(s.default,r.default):x(s,r,R,w,D)}}}function kr(s,r,l){return void 0!==s?s:void 0!==r?r:void 0!==l?l:void 0}function ph(s,r,l,h,f){return kr(typeof l===f?h[l]:void 0,s.default,r.default)}function Na(s,r,l){if("number"!==gn(l))return kr(s.default,r.default);const h=s.stops.length;if(1===h||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[h-1][0])return s.stops[h-1][1];const f=cn(s.stops.map(_=>_[0]),l);return s.stops[f][1]}function $o(s,r,l){const h=void 0!==s.base?s.base:1;if("number"!==gn(l))return kr(s.default,r.default);const f=s.stops.length;if(1===f||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[f-1][0])return s.stops[f-1][1];const _=cn(s.stops.map(P=>P[0]),l),x=function(P,R,O,N){const B=N-O,$=P-O;return 0===B?0:1===R?$/B:(Math.pow(R,$)-1)/(Math.pow(R,B)-1)}(l,h,s.stops[_][0],s.stops[_+1][0]),w=s.stops[_][1],D=s.stops[_+1][1];let S=nu[r.type]||wg;if(s.colorSpace&&"rgb"!==s.colorSpace){const P=$d[s.colorSpace];S=(R,O)=>P.reverse(P.interpolate(P.forward(R),P.forward(O),x))}return"function"==typeof w.evaluate?{evaluate(...P){const R=w.evaluate.apply(void 0,P),O=D.evaluate.apply(void 0,P);if(void 0!==R&&void 0!==O)return S(R,O,x)}}:S(w,D,x)}function Ho(s,r,l){return"color"===r.type?l=Fi.parse(l):"formatted"===r.type?l=zi.fromString(l.toString()):"resolvedImage"===r.type?l=as.fromString(l.toString()):gn(l)===r.type||"enum"===r.type&&r.values[l]||(l=void 0),kr(l,s.default,r.default)}class mh{constructor(r,l){var h;this.expression=r,this._warningHistory={},this._evaluator=new Vd,this._defaultValue=l?"color"===(h=l).type&&(Ji(h.default)||Array.isArray(h.default))?new Fi(0,0,0,0):"color"===h.type?Fi.parse(h.default)||null:void 0===h.default?null:h.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(r,l,h,f,_,x,w,D){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=f||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(r,l,h,f,_,x,w,D){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=D||null;try{const S=this.expression.evaluate(this._evaluator);if(null==S||"number"==typeof S&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Sr(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function cu(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in Kn}function _c(s,r){const l=new Dt(Kn,[],r?function(f){const _={color:Hr,string:ln,number:ct,enum:ln,boolean:yt,formatted:Hn,resolvedImage:Pt};return"array"===f.type?lo(_[f.value]||nn,f.length):_[f.type]}(r):void 0),h=l.parse(s,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return h?bg(new mh(h,r)):aa(l.errors)}class qd{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent="constant"!==r&&!ra(l.expression)}evaluateWithoutErrorHandling(r,l,h,f,_,x){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,f,_,x)}evaluate(r,l,h,f,_,x){return this._styleExpression.evaluate(r,l,h,f,_,x)}}class gh{constructor(r,l,h,f){this.kind=r,this.zoomStops=h,this._styleExpression=l,this.isStateDependent="camera"!==r&&!ra(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(r,l,h,f,_,x){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,f,_,x)}evaluate(r,l,h,f,_,x){return this._styleExpression.evaluate(r,l,h,f,_,x)}interpolationFactor(r,l,h){return this.interpolationType?ls.interpolationFactor(this.interpolationType,r,l,h):0}}function _h(s,r){if("error"===(s=_c(s,r)).result)return s;const l=s.value.expression,h=hc(l);if(!h&&!El(r))return aa([new Is("","data expressions not supported")]);const f=Oa(l,["zoom","pitch","distance-from-center"]);if(!f&&!Dl(r))return aa([new Is("","zoom expressions not supported")]);const _=Xd(l);return _||f?_ instanceof Is?aa([_]):_ instanceof ls&&!Tl(r)?aa([new Is("",'"interpolate" expressions cannot be used with this property')]):bg(_?new gh(h?"camera":"composite",s.value,_.labels,_ instanceof ls?_.interpolation:void 0):new qd(h?"constant":"source",s.value)):aa([new Is("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Zd{constructor(r,l){this._parameters=r,this._specification=l,ea(this,Pr(this._parameters,this._specification))}static deserialize(r){return new Zd(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Xd(s){let r=null;if(s instanceof mr)r=Xd(s.result);else if(s instanceof Ir){for(const l of s.args)if(r=Xd(l),r)break}else(s instanceof tu||s instanceof ls)&&s.input instanceof na&&"zoom"===s.input.name&&(r=s);return r instanceof Is||s.eachChild(l=>{const h=Xd(l);h instanceof Is?r=h:!r&&h?r=new Is("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new Is("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class ut{constructor(r,l,h,f){this.message=(r?`${r}: `:"")+h,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function Rs(s){const r=s.key,l=s.value,h=s.valueSpec||{},f=s.objectElementValidators||{},_=s.style,x=s.styleSpec;let w=[];const D=gn(l);if("object"!==D)return[new ut(r,l,`object expected, ${D} found`)];for(const S in l){const P=S.split(".")[0];let R;f[P]?R=f[P]:h[P]?R=Rr:f["*"]?R=f["*"]:h["*"]&&(R=Rr),R?w=w.concat(R({key:(r&&`${r}.`)+S,value:l[S],valueSpec:h[P]||h["*"],style:_,styleSpec:x,object:l,objectKey:S},l)):w.push(new ut(r,l[S],`unknown property "${S}"`))}for(const S in h)f[S]||h[S].required&&void 0===h[S].default&&void 0===l[S]&&w.push(new ut(r,l,`missing required property "${S}"`));return w}function Cg(s){const r=s.value,l=s.valueSpec,h=s.style,f=s.styleSpec,_=s.key,x=s.arrayElementValidator||Rr;if("array"!==gn(r))return[new ut(_,r,`array expected, ${gn(r)} found`)];if(l.length&&r.length!==l.length)return[new ut(_,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new ut(_,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let w={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};f.$version<7&&(w.function=l.function),"object"===gn(l.value)&&(w=l.value);let D=[];for(let S=0;S<r.length;S++)D=D.concat(x({array:r,arrayIndex:S,value:r[S],valueSpec:w,style:h,styleSpec:f,key:`${_}[${S}]`}));return D}function yh(s){const r=s.key,l=s.value,h=s.valueSpec;let f=gn(l);if("number"===f&&l!=l&&(f="NaN"),"number"!==f)return[new ut(r,l,`number expected, ${f} found`)];if("minimum"in h){let _=h.minimum;if("array"===gn(h.minimum)&&(_=h.minimum[s.arrayIndex]),l<_)return[new ut(r,l,`${l} is less than the minimum value ${_}`)]}if("maximum"in h){let _=h.maximum;if("array"===gn(h.maximum)&&(_=h.maximum[s.arrayIndex]),l>_)return[new ut(r,l,`${l} is greater than the maximum value ${_}`)]}return[]}function vh(s){const r=s.valueSpec,l=Oi(s.value.type);let h,f,_,x={};const w="categorical"!==l&&void 0===s.value.property,D=!w,S="array"===gn(s.value.stops)&&"array"===gn(s.value.stops[0])&&"object"===gn(s.value.stops[0][0]),P=Rs({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(N){if("identity"===l)return[new ut(N.key,N.value,'identity function may not have a "stops" property')];let B=[];const $=N.value;return B=B.concat(Cg({key:N.key,value:$,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:R})),"array"===gn($)&&0===$.length&&B.push(new ut(N.key,$,"array must have at least one stop")),B},default:function(N){return Rr({key:N.key,value:N.value,valueSpec:r,style:N.style,styleSpec:N.styleSpec})}}});return"identity"===l&&w&&P.push(new ut(s.key,s.value,'missing required property "property"')),"identity"===l||s.value.stops||P.push(new ut(s.key,s.value,'missing required property "stops"')),"exponential"===l&&s.valueSpec.expression&&!Tl(s.valueSpec)&&P.push(new ut(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(D&&!El(s.valueSpec)?P.push(new ut(s.key,s.value,"property functions not supported")):w&&!Dl(s.valueSpec)&&P.push(new ut(s.key,s.value,"zoom functions not supported"))),"categorical"!==l&&!S||void 0!==s.value.property||P.push(new ut(s.key,s.value,'"property" property is required')),P;function R(N){let B=[];const $=N.value,Z=N.key;if("array"!==gn($))return[new ut(Z,$,`array expected, ${gn($)} found`)];if(2!==$.length)return[new ut(Z,$,`array length 2 expected, length ${$.length} found`)];if(S){if("object"!==gn($[0]))return[new ut(Z,$,`object expected, ${gn($[0])} found`)];if(void 0===$[0].zoom)return[new ut(Z,$,"object stop key must have zoom")];if(void 0===$[0].value)return[new ut(Z,$,"object stop key must have value")];const te=Oi($[0].zoom);if("number"!=typeof te)return[new ut(Z,$[0].zoom,"stop zoom values must be numbers")];if(_&&_>te)return[new ut(Z,$[0].zoom,"stop zoom values must appear in ascending order")];te!==_&&(_=te,f=void 0,x={}),B=B.concat(Rs({key:`${Z}[0]`,value:$[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:yh,value:O}}))}else B=B.concat(O({key:`${Z}[0]`,value:$[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},$));return cu(ar($[1]))?B.concat([new ut(`${Z}[1]`,$[1],"expressions are not allowed in function stops.")]):B.concat(Rr({key:`${Z}[1]`,value:$[1],valueSpec:r,style:N.style,styleSpec:N.styleSpec}))}function O(N,B){const $=gn(N.value),Z=Oi(N.value),te=null!==N.value?N.value:B;if(h){if($!==h)return[new ut(N.key,te,`${$} stop domain type must match previous stop domain type ${h}`)]}else h=$;if("number"!==$&&"string"!==$&&"boolean"!==$&&"number"!=typeof Z&&"string"!=typeof Z&&"boolean"!=typeof Z)return[new ut(N.key,te,"stop domain value must be a number, string, or boolean")];if("number"!==$&&"categorical"!==l){let ce=`number expected, ${$} found`;return El(r)&&void 0===l&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ut(N.key,te,ce)]}return"categorical"!==l||"number"!==$||"number"==typeof Z&&isFinite(Z)&&Math.floor(Z)===Z?"categorical"!==l&&"number"===$&&"number"==typeof Z&&"number"==typeof f&&void 0!==f&&Z<f?[new ut(N.key,te,"stop domain values must appear in ascending order")]:(f=Z,"categorical"===l&&Z in x?[new ut(N.key,te,"stop domain values must be unique")]:(x[Z]=!0,[])):[new ut(N.key,te,`integer expected, found ${String(Z)}`)]}}function gr(s){const r=("property"===s.expressionContext?_h:_c)(ar(s.value),s.valueSpec);if("error"===r.result)return r.value.map(h=>new ut(`${s.key}${h.key}`,s.value,h.message));const l=r.value.expression||r.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!l.outputDefined())return[new ut(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!ra(l))return[new ut(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext)return xh(l,s);if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!Oa(l,["zoom","feature-state"]))return[new ut(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!hc(l))return[new ut(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xh(s,r){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const f of r.valueSpec.expression.parameters)l.delete(f);if(0===l.size)return[];const h=[];return s instanceof na&&l.has(s.name)?[new ut(r.key,r.value,`["${s.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(s.eachChild(f=>{h.push(...xh(f,r))}),h)}function Yd(s){const r=s.key,l=s.value,h=s.valueSpec,f=[];return Array.isArray(h.values)?-1===h.values.indexOf(Oi(l))&&f.push(new ut(r,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(h.values).indexOf(Oi(l))&&f.push(new ut(r,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function bh(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!bh(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function uu(s,r="fill"){if(null==s)return{filter:()=>!0,needGeometry:!1,needFeature:!1};bh(s)||(s=Sl(s));const l=s;let h=!0;try{h=function(S){if(!hu(S))return S;let P=ar(S);return Kd(P),P=Eg(P),P}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const f=ze[`filter_${r}`],_=_c(h,f);let x=null;if("error"===_.result)throw new Error(_.value.map(S=>`${S.key}: ${S.message}`).join(", "));x=(S,P,R)=>_.value.evaluate(S,P,{},R);let w=null,D=null;if(h!==l){const S=_c(l,f);if("error"===S.result)throw new Error(S.value.map(P=>`${P.key}: ${P.message}`).join(", "));w=(P,R,O,N,B)=>S.value.evaluate(P,R,{},O,void 0,void 0,N,B),D=!hc(S.value.expression)}return{filter:x,dynamicFilter:w||void 0,needGeometry:qr(h),needFeature:!!D}}function Eg(s){if(!Array.isArray(s))return s;const r=function(l){if(la.has(l[0]))for(let h=1;h<l.length;h++)if(hu(l[h]))return!0;return l}(s);return!0===r?r:r.map(l=>Eg(l))}function Kd(s){let r=!1;const l=[];if("case"===s[0]){for(let h=1;h<s.length-1;h+=2)r=r||hu(s[h]),l.push(s[h+1]);l.push(s[s.length-1])}else if("match"===s[0]){r=r||hu(s[1]);for(let h=2;h<s.length-1;h+=2)l.push(s[h+1]);l.push(s[s.length-1])}else if("step"===s[0]){r=r||hu(s[1]);for(let h=1;h<s.length-1;h+=2)l.push(s[h+1])}r&&(s.length=0,s.push("any",...l));for(let h=1;h<s.length;h++)Kd(s[h])}function hu(s){if(!Array.isArray(s))return!1;if("pitch"===(r=s[0])||"distance-from-center"===r)return!0;var r;for(let l=1;l<s.length;l++)if(hu(s[l]))return!0;return!1}const la=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Dg(s,r){return s<r?-1:s>r?1:0}function qr(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let r=1;r<s.length;r++)if(qr(s[r]))return!0;return!1}function Sl(s){if(!s)return!0;const r=s[0];return s.length<=1?"any"!==r:"=="===r?Jd(s[1],s[2],"=="):"!="===r?du(Jd(s[1],s[2],"==")):"<"===r||">"===r||"<="===r||">="===r?Jd(s[1],s[2],r):"any"===r?(l=s.slice(1),["any"].concat(l.map(Sl))):"all"===r?["all"].concat(s.slice(1).map(Sl)):"none"===r?["all"].concat(s.slice(1).map(Sl).map(du)):"in"===r?Qd(s[1],s.slice(2)):"!in"===r?du(Qd(s[1],s.slice(2))):"has"===r?wh(s[1]):"!has"===r?du(wh(s[1])):"within"!==r||s;var l}function Jd(s,r,l){switch(s){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,s,r]}}function Qd(s,r){if(0===r.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(l=>typeof l!=typeof r[0])?["filter-in-large",s,["literal",r.sort(Dg)]]:["filter-in-small",s,["literal",r]]}}function wh(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function du(s){return["!",s]}function fu(s){return bh(ar(s.value))?gr(ea({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):Ml(s)}function Ml(s){const r=s.value,l=s.key;if("array"!==gn(r))return[new ut(l,r,`array expected, ${gn(r)} found`)];const h=s.styleSpec;let f,_=[];if(r.length<1)return[new ut(l,r,"filter array must have at least 1 element")];switch(_=_.concat(Yd({key:`${l}[0]`,value:r[0],valueSpec:h.filter_operator,style:s.style,styleSpec:s.styleSpec})),Oi(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Oi(r[1])&&_.push(new ut(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&_.push(new ut(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(f=gn(r[1]),"string"!==f&&_.push(new ut(`${l}[1]`,r[1],`string expected, ${f} found`)));for(let x=2;x<r.length;x++)f=gn(r[x]),"$type"===Oi(r[1])?_=_.concat(Yd({key:`${l}[${x}]`,value:r[x],valueSpec:h.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&_.push(new ut(`${l}[${x}]`,r[x],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)_=_.concat(Ml({key:`${l}[${x}]`,value:r[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":f=gn(r[1]),2!==r.length?_.push(new ut(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==f&&_.push(new ut(`${l}[1]`,r[1],`string expected, ${f} found`));break;case"within":f=gn(r[1]),2!==r.length?_.push(new ut(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==f&&_.push(new ut(`${l}[1]`,r[1],`object expected, ${f} found`))}return _}function ef(s,r){const l=s.key,h=s.style,f=s.styleSpec,_=s.value,x=s.objectKey,w=f[`${r}_${s.layerType}`];if(!w)return[];const D=x.match(/^(.*)-transition$/);if("paint"===r&&D&&w[D[1]]&&w[D[1]].transition)return Rr({key:l,value:_,valueSpec:f.transition,style:h,styleSpec:f});const S=s.valueSpec||w[x];if(!S)return[new ut(l,_,`unknown property "${x}"`)];let P;if("string"===gn(_)&&El(S)&&!S.tokens&&(P=/^{([^}]+)}$/.exec(_))){const O=`\`{ "type": "identity", "property": ${P?JSON.stringify(P[1]):'"_"'} }\``;return[new ut(l,_,`"${x}" does not support interpolation syntax\nUse an identity property function instead: ${O}.`)]}const R=[];return"symbol"===s.layerType&&("text-field"===x&&h&&!h.glyphs&&R.push(new ut(l,_,'use of "text-field" requires a style "glyphs" property')),"text-font"===x&&Ji(ar(_))&&"identity"===Oi(_.type)&&R.push(new ut(l,_,'"text-font" does not support identity functions'))),R.concat(Rr({key:s.key,value:_,valueSpec:S,style:h,styleSpec:f,expressionContext:"property",propertyType:r,propertyKey:x}))}function Eo(s){return ef(s,"paint")}function Ch(s){return ef(s,"layout")}function tf(s){let r=[];const l=s.value,h=s.key,f=s.style,_=s.styleSpec;l.type||l.ref||r.push(new ut(h,l,'either "type" or "ref" is required'));let x=Oi(l.type);const w=Oi(l.ref);if(l.id){const D=Oi(l.id);for(let S=0;S<s.arrayIndex;S++){const P=f.layers[S];Oi(P.id)===D&&r.push(new ut(h,l.id,`duplicate layer id "${l.id}", previously used at line ${P.id.__line__}`))}}if("ref"in l){let D;["type","source","source-layer","filter","layout"].forEach(S=>{S in l&&r.push(new ut(h,l[S],`"${S}" is prohibited for ref layers`))}),f.layers.forEach(S=>{Oi(S.id)===w&&(D=S)}),D?D.ref?r.push(new ut(h,l.ref,"ref cannot reference another ref layer")):x=Oi(D.type):"string"==typeof w&&r.push(new ut(h,l.ref,`ref layer "${w}" not found`))}else if("background"!==x&&"sky"!==x)if(l.source){const D=f.sources&&f.sources[l.source],S=D&&Oi(D.type);D?"vector"===S&&"raster"===x?r.push(new ut(h,l.source,`layer "${l.id}" requires a raster source`)):"raster"===S&&"raster"!==x?r.push(new ut(h,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==S||l["source-layer"]?"raster-dem"===S&&"hillshade"!==x?r.push(new ut(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==x||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===S&&D.lineMetrics||r.push(new ut(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new ut(h,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new ut(h,l.source,`source "${l.source}" not found`))}else r.push(new ut(h,l,'missing required property "source"'));return r=r.concat(Rs({key:h,value:l,valueSpec:_.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Rr({key:`${h}.type`,value:l.type,valueSpec:_.layer.type,style:s.style,styleSpec:s.styleSpec,object:l,objectKey:"type"}),filter:D=>fu(ea({layerType:x},D)),layout:D=>Rs({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":S=>Ch(ea({layerType:x},S))}}),paint:D=>Rs({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":S=>Eo(ea({layerType:x},S))}})}})),r}function _i(s){const r=s.value,l=s.key,h=gn(r);return"string"!==h?[new ut(l,r,`string expected, ${h} found`)]:[]}const Pp={promoteId:function({key:s,value:r}){if("string"===gn(r))return _i({key:s,value:r});{const l=[];for(const h in r)l.push(..._i({key:`${s}.${h}`,value:r[h]}));return l}}};function pu(s){const r=s.value,l=s.key,h=s.styleSpec,f=s.style;if(!r.type)return[new ut(l,r,'"type" is required')];const _=Oi(r.type);let x;switch(_){case"vector":case"raster":case"raster-dem":return x=Rs({key:l,value:r,valueSpec:h[`source_${_.replace("-","_")}`],style:s.style,styleSpec:h,objectElementValidators:Pp}),x;case"geojson":if(x=Rs({key:l,value:r,valueSpec:h.source_geojson,style:f,styleSpec:h,objectElementValidators:Pp}),r.cluster)for(const w in r.clusterProperties){const[D,S]=r.clusterProperties[w],P="string"==typeof D?[D,["accumulated"],["get",w]]:D;x.push(...gr({key:`${l}.${w}.map`,value:S,expressionContext:"cluster-map"})),x.push(...gr({key:`${l}.${w}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return x;case"video":return Rs({key:l,value:r,valueSpec:h.source_video,style:f,styleSpec:h});case"image":return Rs({key:l,value:r,valueSpec:h.source_image,style:f,styleSpec:h});case"canvas":return[new ut(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Yd({key:`${l}.type`,value:r.type,valueSpec:{values:Do(h)},style:f,styleSpec:h})}}function Do(s){return s.source.reduce((r,l)=>{const h=s[l];return"enum"===h.type.type&&(r=r.concat(Object.keys(h.type.values))),r},[])}function kp(s){const r=s.value,l=s.styleSpec,h=l.light,f=s.style;let _=[];const x=gn(r);if(void 0===r)return _;if("object"!==x)return _=_.concat([new ut("light",r,`object expected, ${x} found`)]),_;for(const w in r){const D=w.match(/^(.*)-transition$/);_=_.concat(D&&h[D[1]]&&h[D[1]].transition?Rr({key:w,value:r[w],valueSpec:l.transition,style:f,styleSpec:l}):h[w]?Rr({key:w,value:r[w],valueSpec:h[w],style:f,styleSpec:l}):[new ut(w,r[w],`unknown property "${w}"`)])}return _}function Eh(s){const r=s.value,l=s.key,h=s.style,f=s.styleSpec,_=f.terrain;let x=[];const w=gn(r);if(void 0===r)return x;if("object"!==w)return x=x.concat([new ut("terrain",r,`object expected, ${w} found`)]),x;for(const D in r){const S=D.match(/^(.*)-transition$/);x=x.concat(S&&_[S[1]]&&_[S[1]].transition?Rr({key:D,value:r[D],valueSpec:f.transition,style:h,styleSpec:f}):_[D]?Rr({key:D,value:r[D],valueSpec:_[D],style:h,styleSpec:f}):[new ut(D,r[D],`unknown property "${D}"`)])}if(r.source){const D=h.sources&&h.sources[r.source],S=D&&Oi(D.type);D?"raster-dem"!==S&&x.push(new ut(l,r.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):x.push(new ut(l,r.source,`source "${r.source}" not found`))}else x.push(new ut(l,r,'terrain is missing required property "source"'));return x}function Il(s){const r=s.value,l=s.style,h=s.styleSpec,f=h.fog;let _=[];const x=gn(r);if(void 0===r)return _;if("object"!==x)return _=_.concat([new ut("fog",r,`object expected, ${x} found`)]),_;for(const w in r){const D=w.match(/^(.*)-transition$/);_=_.concat(D&&f[D[1]]&&f[D[1]].transition?Rr({key:w,value:r[w],valueSpec:h.transition,style:l,styleSpec:h}):f[w]?Rr({key:w,value:r[w],valueSpec:f[w],style:l,styleSpec:h}):[new ut(w,r[w],`unknown property "${w}"`)])}return _}const Zr={"*":()=>[],array:Cg,boolean:function(s){const r=s.value,l=s.key,h=gn(r);return"boolean"!==h?[new ut(l,r,`boolean expected, ${h} found`)]:[]},number:yh,color:function(s){const r=s.key,l=s.value,h=gn(l);return"string"!==h?[new ut(r,l,`color expected, ${h} found`)]:null===Jt(l)?[new ut(r,l,`color expected, "${l}" found`)]:[]},enum:Yd,filter:fu,function:vh,layer:tf,object:Rs,source:pu,light:kp,terrain:Eh,fog:Il,string:_i,formatted:function(s){return 0===_i(s).length?[]:gr(s)},resolvedImage:function(s){return 0===_i(s).length?[]:gr(s)},projection:function(s){const r=s.value,l=s.styleSpec,h=l.projection,f=s.style;let _=[];const x=gn(r);if("object"===x)for(const w in r)_=_.concat(Rr({key:w,value:r[w],valueSpec:h[w],style:f,styleSpec:l}));else"string"!==x&&(_=_.concat([new ut("projection",r,`object or string expected, ${x} found`)]));return _}};function Rr(s){const r=s.value,l=s.valueSpec,h=s.styleSpec;return l.expression&&Ji(Oi(r))?vh(s):l.expression&&cu(ar(r))?gr(s):l.type&&Zr[l.type]?Zr[l.type](s):Rs(ea({},s,{valueSpec:l.type?h[l.type]:l}))}function Dh(s){const r=s.value,l=s.key,h=_i(s);return h.length||(-1===r.indexOf("{fontstack}")&&h.push(new ut(l,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&h.push(new ut(l,r,'"glyphs" url must include a "{range}" token'))),h}function Rp(s,r=ze){return ho(Rr({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,objectElementValidators:{glyphs:Dh,"*":()=>[]}}))}const Ba=s=>ho(Eo(s)),Op=s=>ho(Ch(s));function ho(s){return s.slice().sort((r,l)=>r.line&&l.line?r.line-l.line:0)}function rn(s,r){let l=!1;if(r&&r.length)for(const h of r)s.fire(new Ms(new Error(h.message))),l=!0;return l}var Lp=Ls,Os=3;function Ls(s,r,l){var h=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var f=new Int32Array(this.arrayBuffer);s=f[0],this.d=(r=f[1])+2*(l=f[2]);for(var _=0;_<this.d*this.d;_++){var x=f[Os+_],w=f[Os+_+1];h.push(x===w?null:f.subarray(x,w))}var D=f[Os+h.length+1];this.keys=f.subarray(f[Os+h.length],D),this.bboxes=f.subarray(D),this.insert=this._insertReadonly}else{this.d=r+2*l;for(var S=0;S<this.d*this.d;S++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=s,this.padding=l,this.scale=r/s,this.uid=0;var P=l/r*s;this.min=-P,this.max=s+P}Ls.prototype.insert=function(s,r,l,h,f){this._forEachCell(r,l,h,f,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(f)},Ls.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ls.prototype._insertCell=function(s,r,l,h,f,_){this.cells[f].push(_)},Ls.prototype.query=function(s,r,l,h,f){var _=this.min,x=this.max;if(s<=_&&r<=_&&x<=l&&x<=h&&!f)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(s,r,l,h,this._queryCell,w,{},f),w},Ls.prototype._queryCell=function(s,r,l,h,f,_,x,w){var D=this.cells[f];if(null!==D)for(var S=this.keys,P=this.bboxes,R=0;R<D.length;R++){var O=D[R];if(void 0===x[O]){var N=4*O;(w?w(P[N+0],P[N+1],P[N+2],P[N+3]):s<=P[N+2]&&r<=P[N+3]&&l>=P[N+0]&&h>=P[N+1])?(x[O]=!0,_.push(S[O])):x[O]=!1}}},Ls.prototype._forEachCell=function(s,r,l,h,f,_,x,w){for(var D=this._convertToCellCoord(s),S=this._convertToCellCoord(r),P=this._convertToCellCoord(l),R=this._convertToCellCoord(h),O=D;O<=P;O++)for(var N=S;N<=R;N++){var B=this.d*N+O;if((!w||w(this._convertFromCellCoord(O),this._convertFromCellCoord(N),this._convertFromCellCoord(O+1),this._convertFromCellCoord(N+1)))&&f.call(this,s,r,l,h,B,_,x,w))return}},Ls.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Ls.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Ls.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,r=Os+this.cells.length+1+1,l=0,h=0;h<this.cells.length;h++)l+=this.cells[h].length;var f=new Int32Array(r+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var _=r,x=0;x<s.length;x++){var w=s[x];f[Os+x]=_,f.set(w,_),_+=w.length}return f[Os+s.length]=_,f.set(this.keys,_),f[Os+s.length+1]=_+=this.keys.length,f.set(this.bboxes,_),_+=this.bboxes.length,f.buffer};var Al=vo(Lp);const Th={};function pt(s,r,l={}){Object.defineProperty(s,"_classRegistryKey",{value:r,writeable:!1}),Th[r]={klass:s,omit:l.omit||[]}}pt(Object,"Object"),Al.serialize=function(s,r){const l=s.toArrayBuffer();return r&&r.push(l),{buffer:l}},Al.deserialize=function(s){return new Al(s.buffer)},Object.defineProperty(Al,"name",{value:"Grid"}),pt(Al,"Grid"),pt(Fi,"Color"),pt(Error,"Error"),pt(Ma,"AJAXError"),pt(as,"ResolvedImage"),pt(Zd,"StylePropertyFunction"),pt(mh,"StyleExpression",{omit:["_evaluator"]}),pt(gh,"ZoomDependentExpression"),pt(qd,"ZoomConstantExpression"),pt(na,"CompoundExpression",{omit:["_evaluate"]});for(const s in Kn)Th[Kn[s]._classRegistryKey]||pt(Kn[s],`Expression${s}`);function nf(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function rf(s){return Ue.ImageBitmap&&s instanceof Ue.ImageBitmap}function Ze(s,r){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(nf(s)||rf(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const l=s;return r&&r.push(l.buffer),l}if(s instanceof Ue.ImageData)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const l=[];for(const h of s)l.push(Ze(h,r));return l}if("object"==typeof s){const l=s.constructor,h=l._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const f=l.serialize?l.serialize(s,r):{};if(!l.serialize){for(const _ in s)s.hasOwnProperty(_)&&(Th[h].omit.indexOf(_)>=0||(f[_]=Ze(s[_],r)));s instanceof Error&&(f.message=s.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==h&&(f.$name=h),f}throw new Error("can't serialize object of type "+typeof s)}function yn(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||nf(s)||rf(s)||ArrayBuffer.isView(s)||s instanceof Ue.ImageData)return s;if(Array.isArray(s))return s.map(yn);if("object"==typeof s){const r=s.$name||"Object",{klass:l}=Th[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(s);const h=Object.create(l.prototype);for(const f of Object.keys(s))"$name"!==f&&(h[f]=yn(s[f]));return h}throw new Error("can't deserialize object of type "+typeof s)}const ot={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Fs(s){for(const r of s)if(Pl(r.charCodeAt(0)))return!0;return!1}function _r(s){for(const r of s)if(!sf(r.charCodeAt(0)))return!1;return!0}function sf(s){return!(ot.Arabic(s)||ot["Arabic Supplement"](s)||ot["Arabic Extended-A"](s)||ot["Arabic Presentation Forms-A"](s)||ot["Arabic Presentation Forms-B"](s))}function Pl(s){return!(746!==s&&747!==s&&(s<4352||!(ot["Bopomofo Extended"](s)||ot.Bopomofo(s)||ot["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||ot["CJK Compatibility Ideographs"](s)||ot["CJK Compatibility"](s)||ot["CJK Radicals Supplement"](s)||ot["CJK Strokes"](s)||!(!ot["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||ot["CJK Unified Ideographs Extension A"](s)||ot["CJK Unified Ideographs"](s)||ot["Enclosed CJK Letters and Months"](s)||ot["Hangul Compatibility Jamo"](s)||ot["Hangul Jamo Extended-A"](s)||ot["Hangul Jamo Extended-B"](s)||ot["Hangul Jamo"](s)||ot["Hangul Syllables"](s)||ot.Hiragana(s)||ot["Ideographic Description Characters"](s)||ot.Kanbun(s)||ot["Kangxi Radicals"](s)||ot["Katakana Phonetic Extensions"](s)||ot.Katakana(s)&&12540!==s||!(!ot["Halfwidth and Fullwidth Forms"](s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!ot["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||ot["Unified Canadian Aboriginal Syllabics"](s)||ot["Unified Canadian Aboriginal Syllabics Extended"](s)||ot["Vertical Forms"](s)||ot["Yijing Hexagram Symbols"](s)||ot["Yi Syllables"](s)||ot["Yi Radicals"](s))))}function us(s){return!(Pl(s)||(r=s,ot["Latin-1 Supplement"](r)&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||ot["General Punctuation"](r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||ot["Letterlike Symbols"](r)||ot["Number Forms"](r)||ot["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||ot["Control Pictures"](r)&&9251!==r||ot["Optical Character Recognition"](r)||ot["Enclosed Alphanumerics"](r)||ot["Geometric Shapes"](r)||ot["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||ot["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||ot["CJK Symbols and Punctuation"](r)||ot.Katakana(r)||ot["Private Use Area"](r)||ot["CJK Compatibility Forms"](r)||ot["Small Form Variants"](r)||ot["Halfwidth and Fullwidth Forms"](r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r}function Sh(s){return s>=1424&&s<=2303||ot["Arabic Presentation Forms-A"](s)||ot["Arabic Presentation Forms-B"](s)}function af(s,r){return!(!r&&Sh(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||ot.Khmer(s))}function Tg(s){for(const r of s)if(Sh(r.charCodeAt(0)))return!0;return!1}const Fp="deferred",Mh="loading",yr="loaded";let fo=null,g="unavailable",c=null;const d=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(g="error"),fo&&fo(s)};function v(){b.fire(new ml("pluginStateChange",{pluginStatus:g,pluginURL:c}))}const b=new oc,E=function(){return g},M=function(){if(g!==Fp||!c)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");g=Mh,v(),c&&ic({url:c},s=>{s?d(s):(g=yr,v())})},I={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>g===yr||null!=I.applyArabicShaping,isLoading:()=>g===Mh,setState(s){g=s.pluginStatus,c=s.pluginURL},isParsed:()=>null!=I.applyArabicShaping&&null!=I.processBidirectionalText&&null!=I.processStyledBidirectionalText,getPluginURL:()=>c};class k{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return function(l,h){for(const f of l)if(!af(f.charCodeAt(0),h))return!1;return!0}(r,I.isLoaded())}}class F{constructor(r,l){this.property=r,this.value=l,this.expression=function(h,f){if(Ji(h))return new Zd(h,f);if(cu(h)){const _=_h(h,f);if("error"===_.result)throw new Error(_.value.map(x=>`${x.key}: ${x.message}`).join(", "));return _.value}{let _=h;return"string"==typeof h&&"color"===f.type&&(_=Fi.parse(h)),{kind:"constant",evaluate:()=>_}}}(void 0===l?r.specification.default:l,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,l,h){return this.property.possiblyEvaluate(this,r,l,h)}}class L{constructor(r){this.property=r,this.value=new F(r,void 0)}transitioned(r,l){return new q(this.property,this.value,l,ki({},r.transition,this.transition),r.now)}untransitioned(){return new q(this.property,this.value,null,{},0)}}class j{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return xo(this._values[r].value.value)}setValue(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new L(this._values[r].property)),this._values[r].value=new F(this._values[r].property,null===l?void 0:xo(l))}getTransition(r){return xo(this._values[r].transition)}setTransition(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new L(this._values[r].property)),this._values[r].transition=xo(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(r[l]=h);const f=this.getTransition(l);void 0!==f&&(r[`${l}-transition`]=f)}return r}transitioned(r,l){const h=new K(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].transitioned(r,l._values[f]);return h}untransitioned(){const r=new K(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class q{constructor(r,l,h,f,_){const x=f.delay||0,w=f.duration||0;_=_||0,this.property=r,this.value=l,this.begin=_+x,this.end=this.begin+w,r.specification.transition&&(f.delay||f.duration)&&(this.prior=h)}possiblyEvaluate(r,l,h){const f=r.now||0,_=this.value.possiblyEvaluate(r,l,h),x=this.prior;if(x){if(f>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(f<this.begin)return x.possiblyEvaluate(r,l,h);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(r,l,h),_,Ju(w))}}return _}}class K{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,h){const f=new ee(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(r,l,h);return f}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Q{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return xo(this._values[r].value)}setValue(r,l){this._values[r]=new F(this._values[r].property,null===l?void 0:xo(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(r[l]=h)}return r}possiblyEvaluate(r,l,h){const f=new ee(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(r,l,h);return f}}class J{constructor(r,l,h){this.property=r,this.value=l,this.parameters=h}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,l,h,f){return this.property.evaluate(this.value,this.parameters,r,l,h,f)}}class ee{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class U{constructor(r){this.specification=r}possiblyEvaluate(r,l){return r.expression.evaluate(l)}interpolate(r,l,h){const f=nu[this.specification.type];return f?f(r,l,h):r}}class Y{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,h,f){return new J(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(l,null,{},h,f)}:r.expression,l)}interpolate(r,l,h){if("constant"!==r.value.kind||"constant"!==l.value.kind)return r;if(void 0===r.value.value||void 0===l.value.value)return new J(this,{kind:"constant",value:void 0},r.parameters);const f=nu[this.specification.type];return f?new J(this,{kind:"constant",value:f(r.value.value,l.value.value,h)},r.parameters):r}evaluate(r,l,h,f,_,x){return"constant"===r.kind?r.value:r.evaluate(l,h,f,_,x)}}class ie{constructor(r){this.specification=r}possiblyEvaluate(r,l,h,f){return!!r.expression.evaluate(l,null,{},h,f)}interpolate(){return!1}}class re{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new k(0,{});for(const h in r){const f=r[h];f.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new F(f,void 0),x=this.defaultTransitionablePropertyValues[h]=new L(f);this.defaultTransitioningPropertyValues[h]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate(l)}}}function fe(s,r){return 256*(s=hn(Math.floor(s),0,255))+hn(Math.floor(r),0,255)}pt(Y,"DataDrivenProperty"),pt(U,"DataConstantProperty"),pt(ie,"ColorRampProperty");const ge={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class de{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class be{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xe(s,r=1){let l=0,h=0;return{members:s.map(f=>{const _=ge[f.type].BYTES_PER_ELEMENT,x=l=Ie(l,Math.max(r,_)),w=f.components||1;return h=Math.max(h,_),l+=_*w,{name:f.name,type:f.type,components:w,offset:x}}),size:Ie(l,Math.max(h,r)),alignment:r}}function Ie(s,r){return Math.ceil(s/r)*r}class Xe extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const f=2*r;return this.int16[f+0]=l,this.int16[f+1]=h,r}}Xe.prototype.bytesPerElement=4,pt(Xe,"StructArrayLayout2i4");class Te extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,l,h)}emplace(r,l,h,f){const _=3*r;return this.int16[_+0]=l,this.int16[_+1]=h,this.int16[_+2]=f,r}}Te.prototype.bytesPerElement=6,pt(Te,"StructArrayLayout3i6");class je extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,f)}emplace(r,l,h,f,_){const x=4*r;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=f,this.int16[x+3]=_,r}}je.prototype.bytesPerElement=8,pt(je,"StructArrayLayout4i8");class Pe extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,f,_,x,w){const D=this.length;return this.resize(D+1),this.emplace(D,r,l,h,f,_,x,w)}emplace(r,l,h,f,_,x,w,D){const S=6*r,P=12*r,R=3*r;return this.int16[S+0]=l,this.int16[S+1]=h,this.uint8[P+4]=f,this.uint8[P+5]=_,this.uint8[P+6]=x,this.uint8[P+7]=w,this.float32[R+2]=D,r}}Pe.prototype.bytesPerElement=12,pt(Pe,"StructArrayLayout2i4ub1f12");class We extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,f)}emplace(r,l,h,f,_){const x=4*r;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=f,this.float32[x+3]=_,r}}We.prototype.bytesPerElement=16,pt(We,"StructArrayLayout4f16");class Se extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,f,_)}emplace(r,l,h,f,_,x){const w=6*r,D=3*r;return this.uint16[w+0]=l,this.uint16[w+1]=h,this.uint16[w+2]=f,this.uint16[w+3]=_,this.float32[D+2]=x,r}}Se.prototype.bytesPerElement=12,pt(Se,"StructArrayLayout4ui1f12");class Ne extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,f)}emplace(r,l,h,f,_){const x=4*r;return this.uint16[x+0]=l,this.uint16[x+1]=h,this.uint16[x+2]=f,this.uint16[x+3]=_,r}}Ne.prototype.bytesPerElement=8,pt(Ne,"StructArrayLayout4ui8");class Ye extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,f,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,h,f,_,x)}emplace(r,l,h,f,_,x,w){const D=6*r;return this.int16[D+0]=l,this.int16[D+1]=h,this.int16[D+2]=f,this.int16[D+3]=_,this.int16[D+4]=x,this.int16[D+5]=w,r}}Ye.prototype.bytesPerElement=12,pt(Ye,"StructArrayLayout6i12");class $e extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,f,_,x,w,D,S,P,R,O){const N=this.length;return this.resize(N+1),this.emplace(N,r,l,h,f,_,x,w,D,S,P,R,O)}emplace(r,l,h,f,_,x,w,D,S,P,R,O,N){const B=12*r;return this.int16[B+0]=l,this.int16[B+1]=h,this.int16[B+2]=f,this.int16[B+3]=_,this.uint16[B+4]=x,this.uint16[B+5]=w,this.uint16[B+6]=D,this.uint16[B+7]=S,this.int16[B+8]=P,this.int16[B+9]=R,this.int16[B+10]=O,this.int16[B+11]=N,r}}$e.prototype.bytesPerElement=24,pt($e,"StructArrayLayout4i4ui4i24");class qe extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,f,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,h,f,_,x)}emplace(r,l,h,f,_,x,w){const D=10*r,S=5*r;return this.int16[D+0]=l,this.int16[D+1]=h,this.int16[D+2]=f,this.float32[S+2]=_,this.float32[S+3]=x,this.float32[S+4]=w,r}}qe.prototype.bytesPerElement=20,pt(qe,"StructArrayLayout3i3f20");class _t extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}_t.prototype.bytesPerElement=4,pt(_t,"StructArrayLayout1ul4");class zt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,f,_,x,w,D,S,P,R,O,N){const B=this.length;return this.resize(B+1),this.emplace(B,r,l,h,f,_,x,w,D,S,P,R,O,N)}emplace(r,l,h,f,_,x,w,D,S,P,R,O,N,B){const $=20*r,Z=10*r;return this.int16[$+0]=l,this.int16[$+1]=h,this.int16[$+2]=f,this.int16[$+3]=_,this.int16[$+4]=x,this.float32[Z+3]=w,this.float32[Z+4]=D,this.float32[Z+5]=S,this.float32[Z+6]=P,this.int16[$+14]=R,this.uint32[Z+8]=O,this.uint16[$+18]=N,this.uint16[$+19]=B,r}}zt.prototype.bytesPerElement=40,pt(zt,"StructArrayLayout5i4f1i1ul2ui40");class mt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,f,_,x,w){const D=this.length;return this.resize(D+1),this.emplace(D,r,l,h,f,_,x,w)}emplace(r,l,h,f,_,x,w,D){const S=8*r;return this.int16[S+0]=l,this.int16[S+1]=h,this.int16[S+2]=f,this.int16[S+4]=_,this.int16[S+5]=x,this.int16[S+6]=w,this.int16[S+7]=D,r}}mt.prototype.bytesPerElement=16,pt(mt,"StructArrayLayout3i2i2i16");class Tt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,f,_)}emplace(r,l,h,f,_,x){const w=4*r,D=8*r;return this.float32[w+0]=l,this.float32[w+1]=h,this.float32[w+2]=f,this.int16[D+6]=_,this.int16[D+7]=x,r}}Tt.prototype.bytesPerElement=16,pt(Tt,"StructArrayLayout2f1f2i16");class dn extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,f)}emplace(r,l,h,f,_){const x=12*r,w=3*r;return this.uint8[x+0]=l,this.uint8[x+1]=h,this.float32[w+1]=f,this.float32[w+2]=_,r}}dn.prototype.bytesPerElement=12,pt(dn,"StructArrayLayout2ub2f12");class sn extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,l,h)}emplace(r,l,h,f){const _=3*r;return this.float32[_+0]=l,this.float32[_+1]=h,this.float32[_+2]=f,r}}sn.prototype.bytesPerElement=12,pt(sn,"StructArrayLayout3f12");class vt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,l,h)}emplace(r,l,h,f){const _=3*r;return this.uint16[_+0]=l,this.uint16[_+1]=h,this.uint16[_+2]=f,r}}vt.prototype.bytesPerElement=6,pt(vt,"StructArrayLayout3ui6");class Ln extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,h,f,_,x,w,D,S,P,R,O,N,B,$,Z,te,ce,ne,ae,pe){const he=this.length;return this.resize(he+1),this.emplace(he,r,l,h,f,_,x,w,D,S,P,R,O,N,B,$,Z,te,ce,ne,ae,pe)}emplace(r,l,h,f,_,x,w,D,S,P,R,O,N,B,$,Z,te,ce,ne,ae,pe,he){const Me=30*r,Ee=15*r,Oe=60*r;return this.int16[Me+0]=l,this.int16[Me+1]=h,this.int16[Me+2]=f,this.float32[Ee+2]=_,this.float32[Ee+3]=x,this.uint16[Me+8]=w,this.uint16[Me+9]=D,this.uint32[Ee+5]=S,this.uint32[Ee+6]=P,this.uint32[Ee+7]=R,this.uint16[Me+16]=O,this.uint16[Me+17]=N,this.uint16[Me+18]=B,this.float32[Ee+10]=$,this.float32[Ee+11]=Z,this.uint8[Oe+48]=te,this.uint8[Oe+49]=ce,this.uint8[Oe+50]=ne,this.uint32[Ee+13]=ae,this.int16[Me+28]=pe,this.uint8[Oe+58]=he,r}}Ln.prototype.bytesPerElement=60,pt(Ln,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Jn extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,h,f,_,x,w,D,S,P,R,O,N,B,$,Z,te,ce,ne,ae,pe,he,Me,Ee,Oe,Ge,Ae,Be,Ve,He){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,r,l,h,f,_,x,w,D,S,P,R,O,N,B,$,Z,te,ce,ne,ae,pe,he,Me,Ee,Oe,Ge,Ae,Be,Ve,He)}emplace(r,l,h,f,_,x,w,D,S,P,R,O,N,B,$,Z,te,ce,ne,ae,pe,he,Me,Ee,Oe,Ge,Ae,Be,Ve,He,Ke){const Le=38*r,rt=19*r;return this.int16[Le+0]=l,this.int16[Le+1]=h,this.int16[Le+2]=f,this.float32[rt+2]=_,this.float32[rt+3]=x,this.int16[Le+8]=w,this.int16[Le+9]=D,this.int16[Le+10]=S,this.int16[Le+11]=P,this.int16[Le+12]=R,this.int16[Le+13]=O,this.uint16[Le+14]=N,this.uint16[Le+15]=B,this.uint16[Le+16]=$,this.uint16[Le+17]=Z,this.uint16[Le+18]=te,this.uint16[Le+19]=ce,this.uint16[Le+20]=ne,this.uint16[Le+21]=ae,this.uint16[Le+22]=pe,this.uint16[Le+23]=he,this.uint16[Le+24]=Me,this.uint16[Le+25]=Ee,this.uint16[Le+26]=Oe,this.uint16[Le+27]=Ge,this.uint16[Le+28]=Ae,this.uint32[rt+15]=Be,this.float32[rt+16]=Ve,this.float32[rt+17]=He,this.float32[rt+18]=Ke,r}}Jn.prototype.bytesPerElement=76,pt(Jn,"StructArrayLayout3i2f6i15ui1ul3f76");class Fn extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}Fn.prototype.bytesPerElement=4,pt(Fn,"StructArrayLayout1f4");class jn extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,f,_)}emplace(r,l,h,f,_,x){const w=5*r;return this.float32[w+0]=l,this.float32[w+1]=h,this.float32[w+2]=f,this.float32[w+3]=_,this.float32[w+4]=x,r}}jn.prototype.bytesPerElement=20,pt(jn,"StructArrayLayout5f20");class vr extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,f)}emplace(r,l,h,f,_){const x=6*r;return this.uint32[3*r+0]=l,this.uint16[x+2]=h,this.uint16[x+3]=f,this.uint16[x+4]=_,r}}vr.prototype.bytesPerElement=12,pt(vr,"StructArrayLayout1ul3ui12");class Si extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const f=2*r;return this.uint16[f+0]=l,this.uint16[f+1]=h,r}}Si.prototype.bytesPerElement=4,pt(Si,"StructArrayLayout2ui4");class To extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}To.prototype.bytesPerElement=2,pt(To,"StructArrayLayout1ui2");class hs extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const f=2*r;return this.float32[f+0]=l,this.float32[f+1]=h,r}}hs.prototype.bytesPerElement=8,pt(hs,"StructArrayLayout2f8");class Qn extends de{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Qn.prototype.size=40;class Gn extends zt{get(r){return new Qn(this,r)}}pt(Gn,"CollisionBoxArray");class bn extends de{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}bn.prototype.size=60;class wi extends Ln{get(r){return new bn(this,r)}}pt(wi,"PlacedSymbolArray");class ur extends de{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ur.prototype.size=76;class ci extends Jn{get(r){return new ur(this,r)}}pt(ci,"SymbolInstanceArray");class Xr extends Fn{getoffsetX(r){return this.float32[1*r+0]}}pt(Xr,"GlyphOffsetArray");class mu extends Xe{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}pt(mu,"SymbolLineVertexArray");class kl extends de{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}kl.prototype.size=12;class po extends vr{get(r){return new kl(this,r)}}pt(po,"FeatureIndexArray");class ca extends Si{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}pt(ca,"FillExtrusionCentroidArray");const ds=xe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ua=xe([{name:"a_dash",components:4,type:"Uint16"}]);var gu={exports:{}},Sg=function(s,r){var l,h,f,_,x,w,D,S;for(h=s.length-(l=3&s.length),f=r,x=3432918353,w=461845907,S=0;S<h;)D=255&s.charCodeAt(S)|(255&s.charCodeAt(++S))<<8|(255&s.charCodeAt(++S))<<16|(255&s.charCodeAt(++S))<<24,++S,f=27492+(65535&(_=5*(65535&(f=(f^=D=(65535&(D=(D=(65535&D)*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*w+(((D>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(D=0,l){case 3:D^=(255&s.charCodeAt(S+2))<<16;case 2:D^=(255&s.charCodeAt(S+1))<<8;case 1:f^=D=(65535&(D=(D=(65535&(D^=255&s.charCodeAt(S)))*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*w+(((D>>>16)*w&65535)<<16)&4294967295}return f^=s.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0},ov=function(s,r){for(var l,h=s.length,f=r^h,_=0;h>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(_)|(255&s.charCodeAt(++_))<<8|(255&s.charCodeAt(++_))<<16|(255&s.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:f^=(255&s.charCodeAt(_+2))<<16;case 2:f^=(255&s.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&s.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};gu.exports=Sg,gu.exports.murmur3=Sg,gu.exports.murmur2=ov;var zp=vo(gu.exports);class lf{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,h,f){this.ids.push(sv(r)),this.positions.push(l,h,f)}getPositions(r){const l=sv(r);let h=0,f=this.ids.length-1;for(;h<f;){const x=h+f>>1;this.ids[x]>=l?f=x:h=x+1}const _=[];for(;this.ids[h]===l;)_.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return _}static serialize(r,l){const h=new Float64Array(r.ids),f=new Uint32Array(r.positions);return Ih(h,f,0,h.length-1),l&&l.push(h.buffer,f.buffer),{ids:h,positions:f}}static deserialize(r){const l=new lf;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function sv(s){const r=+s;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:zp(String(s))}function Ih(s,r,l,h){for(;l<h;){const f=s[l+h>>1];let _=l-1,x=h+1;for(;;){do{_++}while(s[_]<f);do{x--}while(s[x]>f);if(_>=x)break;Va(s,_,x),Va(r,3*_,3*x),Va(r,3*_+1,3*x+1),Va(r,3*_+2,3*x+2)}x-l<h-x?(Ih(s,r,l,x),l=x+1):(Ih(s,r,x+1,h),h=x)}}function Va(s,r,l){const h=s[r];s[r]=s[l],s[l]=h}pt(lf,"FeaturePositionMap");class Ol{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,l),this.initialized=!0),!!this.location}}class cf extends Ol{constructor(r){super(r),this.current=0}set(r,l,h){this.fetchUniformLocation(r,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class Mg extends Ol{constructor(r){super(r),this.current=[0,0,0,0]}set(r,l,h){this.fetchUniformLocation(r,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class yu extends Ol{constructor(r){super(r),this.current=Fi.transparent}set(r,l,h){this.fetchUniformLocation(r,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const l1=new Float32Array(16),Yr=new Float32Array(9),Ig=new Float32Array(4);function Ag(s){return[fe(255*s.r,255*s.g),fe(255*s.b,255*s.a)]}class Ah{constructor(r,l,h){this.value=r,this.uniformNames=l.map(f=>`u_${f}`),this.type=h}setUniform(r,l,h,f,_){l.set(r,_,f.constantOr(this.value))}getBinding(r,l){return"color"===this.type?new yu(r):new cf(r)}}class Ll{constructor(r,l){this.uniformNames=l.map(h=>`u_${h}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,l,h,f,_){const x="u_pattern"===_||"u_dash"===_?this.pattern:"u_pixel_ratio"===_?this.pixelRatio:null;x&&l.set(r,_,x)}getBinding(r,l){return"u_pattern"===l||"u_dash"===l?new Mg(r):new cf(r)}}class Go{constructor(r,l,h,f){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(_=>({name:`a_${_}`,type:"Float32",components:"color"===h?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(r,l,h,f,_,x){const w=this.paintVertexArray.length,D=this.expression.evaluate(new k(0),l,{},_,f,x);this.paintVertexArray.resize(r),this._setPaintValue(w,r,D)}updatePaintArray(r,l,h,f,_){const x=this.expression.evaluate({zoom:0},h,f,void 0,_);this._setPaintValue(r,l,x)}_setPaintValue(r,l,h){if("color"===this.type){const f=Ag(h);for(let _=r;_<l;_++)this.paintVertexArray.emplace(_,f[0],f[1])}else{for(let f=r;f<l;f++)this.paintVertexArray.emplace(f,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class mo{constructor(r,l,h,f,_,x){this.expression=r,this.uniformNames=l.map(w=>`u_${w}_t`),this.type=h,this.useIntegerZoom=f,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===h?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(r,l,h,f,_,x){const w=this.expression.evaluate(new k(this.zoom),l,{},_,f,x),D=this.expression.evaluate(new k(this.zoom+1),l,{},_,f,x),S=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(S,r,w,D)}updatePaintArray(r,l,h,f,_){const x=this.expression.evaluate({zoom:this.zoom},h,f,void 0,_),w=this.expression.evaluate({zoom:this.zoom+1},h,f,void 0,_);this._setPaintValue(r,l,x,w)}_setPaintValue(r,l,h,f){if("color"===this.type){const _=Ag(h),x=Ag(f);for(let w=r;w<l;w++)this.paintVertexArray.emplace(w,_[0],_[1],x[0],x[1])}else{for(let _=r;_<l;_++)this.paintVertexArray.emplace(_,h,f);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(f))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l,h,f,_){const x=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,w=hn(this.expression.interpolationFactor(x,this.zoom,this.zoom+1),0,1);l.set(r,_,w)}getBinding(r,l){return new cf(r)}}class fs{constructor(r,l,h,f,_){this.expression=r,this.layerId=_,this.paintVertexAttributes=("array"===h?ua:ds).members;for(let x=0;x<l.length;++x);this.paintVertexArray=new f}populatePaintArray(r,l,h){const f=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(f,r,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(r,l,h,f,_,x){this._setPaintValues(r,l,h.patterns&&h.patterns[this.layerId],x)}_setPaintValues(r,l,h,f){if(!f||!h)return;const _=f[h];if(!_)return;const{tl:x,br:w,pixelRatio:D}=_;for(let S=r;S<l;S++)this.paintVertexArray.emplace(S,x[0],x[1],w[0],w[1],D)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fl{constructor(r,l,h=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const _ in r.paint._values){if(!h(_))continue;const x=r.paint.get(_);if(!(x instanceof J&&El(x.property.specification)))continue;const w=kD(_,r.type),D=x.value,S=x.property.specification.type,P=!!x.property.useIntegerZoom,R="line-dasharray"===_||_.endsWith("pattern"),O="line-dasharray"===_&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==D.kind||O)if("source"===D.kind||O||R){const N=u1(_,S,"source");this.binders[_]=R?new fs(D,w,S,N,r.id):new Go(D,w,S,N),f.push(`/a_${_}`)}else{const N=u1(_,S,"composite");this.binders[_]=new mo(D,w,S,P,l,N),f.push(`/z_${_}`)}else this.binders[_]=R?new Ll(D.value,w):new Ah(D.value,w,S),f.push(`/u_${_}`)}this.cacheKey=f.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof Go||l instanceof mo?l.maxValue:0}populatePaintArrays(r,l,h,f,_,x){for(const w in this.binders){const D=this.binders[w];(D instanceof Go||D instanceof mo||D instanceof fs)&&D.populatePaintArray(r,l,h,f,_,x)}}setConstantPatternPositions(r){for(const l in this.binders){const h=this.binders[l];h instanceof Ll&&h.setConstantPatternPositions(r)}}updatePaintArrays(r,l,h,f,_,x){let w=!1;for(const D in r){const S=l.getPositions(D);for(const P of S){const R=h.feature(P.index);for(const O in this.binders){const N=this.binders[O];if((N instanceof Go||N instanceof mo||N instanceof fs)&&!0===N.expression.isStateDependent){const B=f.paint.get(O);N.expression=B.value,N.updatePaintArray(P.start,P.end,R,r[D],_,x),w=!0}}}}return w}defines(){const r=[];for(const l in this.binders){const h=this.binders[l];(h instanceof Ah||h instanceof Ll)&&r.push(...h.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Go||h instanceof mo||h instanceof fs)for(let f=0;f<h.paintVertexAttributes.length;f++)r.push(h.paintVertexAttributes[f].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Ah||h instanceof Ll||h instanceof mo)for(const f of h.uniformNames)r.push(f)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const l=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof Ah||f instanceof Ll||f instanceof mo)for(const _ of f.uniformNames)l.push({name:_,property:h,binding:f.getBinding(r,_)})}return l}setUniforms(r,l,h,f,_){for(const{name:x,property:w,binding:D}of h)this.binders[w].setUniform(r,D,_,f.get(w),x)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const l=this.binders[r];(l instanceof Go||l instanceof mo||l instanceof fs)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(r){for(const l in this.binders){const h=this.binders[l];(h instanceof Go||h instanceof mo||h instanceof fs)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof Go||l instanceof mo||l instanceof fs)&&l.destroy()}}}class zl{constructor(r,l,h=(()=>!0)){this.programConfigurations={};for(const f of r)this.programConfigurations[f.id]=new Fl(f,l,h);this.needsUpload=!1,this._featureMap=new lf,this._bufferOffset=0}populatePaintArrays(r,l,h,f,_,x,w){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(r,l,f,_,x,w);void 0!==l.id&&this._featureMap.add(l.id,h,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,h,f,_){for(const x of h)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(r,this._featureMap,l,x,f,_)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const Ph={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function kD(s,r){return Ph[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const c1={"line-pattern":{source:Se,composite:Se},"fill-pattern":{source:Se,composite:Se},"fill-extrusion-pattern":{source:Se,composite:Se},"line-dasharray":{source:Ne,composite:Ne}},Mt={color:{source:hs,composite:We},number:{source:Fn,composite:hs}};function u1(s,r,l){const h=c1[s];return h&&h[l]||Mt[r][l]}pt(Ah,"ConstantBinder"),pt(Ll,"PatternConstantBinder"),pt(Go,"SourceExpressionBinder"),pt(fs,"PatternCompositeBinder"),pt(mo,"CompositeExpressionBinder"),pt(Fl,"ProgramConfiguration",{omit:["_buffers"]}),pt(zl,"ProgramConfigurationSet");const h1="-transition";class ja extends oc{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new Q(l.layout)),l.paint)){this._transitionablePaint=new j(l.paint);for(const h in r.paint)this.setPaintProperty(h,r.paint[h],{validate:!1});for(const h in r.layout)this.setLayoutProperty(h,r.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ee(l.paint)}}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,h={}){null!=l&&this._validate(Op,`layers.${this.id}.layout.${r}`,r,l,h)||("visibility"!==r?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return Ql(r,h1)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,h={}){if(null!=l&&this._validate(Ba,`layers.${this.id}.paint.${r}`,r,l,h))return!1;if(Ql(r,h1))return this._transitionablePaint.setTransition(r.slice(0,-11),l||void 0),!1;{const f=this._transitionablePaint._values[r],_=f.value.isDataDriven(),x=f.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const w=this._transitionablePaint._values[r].value,D=w.isDataDriven(),S=Ql(r,"pattern")||"line-dasharray"===r;return D||_||S||this._handleOverridablePaintPropertyUpdate(r,x,w)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,l,h){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Da(r,(l,h)=>!(void 0===l||"layout"===h&&!Object.keys(l).length||"paint"===h&&!Object.keys(l).length))}_validate(r,l,h,f,_={}){return(!_||!1!==_.validate)&&rn(this,r.call(Rp,{key:l,layerType:this.type,objectKey:h,value:f,styleSpec:ze,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof J&&El(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=uu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const RD=xe([{name:"a_pos",components:2,type:"Int16"}],4),OD=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $i{constructor(r=[]){this.segments=r}prepareSegment(r,l,h,f){let _=this.segments[this.segments.length-1];return r>$i.MAX_VERTEX_ARRAY_LENGTH&&ui(`Max vertices per segment is ${$i.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!_||_.vertexLength+r>$i.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==f)&&(_={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},void 0!==f&&(_.sortKey=f),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,h,f){return new $i([{vertexOffset:r,primitiveOffset:l,vertexLength:h,primitiveLength:f,vaos:{},sortKey:0}])}}$i.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pt($i,"SegmentVector");var St=8192;class zs{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Un?new Un(r.lng,r.lat):Un.convert(r),this}setSouthWest(r){return this._sw=r instanceof Un?new Un(r.lng,r.lat):Un.convert(r),this}extend(r){const l=this._sw,h=this._ne;let f,_;if(r instanceof Un)f=r,_=r;else{if(!(r instanceof zs))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(zs.convert(r)):this.extend(Un.convert(r)):"object"==typeof r&&null!==r&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(Un.convert(r)):this;if(f=r._sw,_=r._ne,!f||!_)return this}return l||h?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new Un(f.lng,f.lat),this._ne=new Un(_.lng,_.lat)),this}getCenter(){return new Un((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Un(this.getWest(),this.getNorth())}getSouthEast(){return new Un(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:h}=Un.convert(r);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(r){return!r||r instanceof zs?r:new zs(r)}}var Pg=1e-6,ps=typeof Float32Array<"u"?Float32Array:Array;function hr(){var s=new ps(9);return ps!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Np(s,r,l){var h=r[0],f=r[1],_=r[2],x=r[3],w=r[4],D=r[5],S=r[6],P=r[7],R=r[8],O=l[0],N=l[1],B=l[2],$=l[3],Z=l[4],te=l[5],ce=l[6],ne=l[7],ae=l[8];return s[0]=O*h+N*x+B*S,s[1]=O*f+N*w+B*P,s[2]=O*_+N*D+B*R,s[3]=$*h+Z*x+te*S,s[4]=$*f+Z*w+te*P,s[5]=$*_+Z*D+te*R,s[6]=ce*h+ne*x+ae*S,s[7]=ce*f+ne*w+ae*P,s[8]=ce*_+ne*D+ae*R,s}function So(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function kg(s,r){var l=r[0],h=r[1],f=r[2],_=r[3],x=r[4],w=r[5],D=r[6],S=r[7],P=r[8],R=r[9],O=r[10],N=r[11],B=r[12],$=r[13],Z=r[14],te=r[15],ce=l*w-h*x,ne=l*D-f*x,ae=l*S-_*x,pe=h*D-f*w,he=h*S-_*w,Me=f*S-_*D,Ee=P*$-R*B,Oe=P*Z-O*B,Ge=P*te-N*B,Ae=R*Z-O*$,Be=R*te-N*$,Ve=O*te-N*Z,He=ce*Ve-ne*Be+ae*Ae+pe*Ge-he*Oe+Me*Ee;return He?(s[0]=(w*Ve-D*Be+S*Ae)*(He=1/He),s[1]=(f*Be-h*Ve-_*Ae)*He,s[2]=($*Me-Z*he+te*pe)*He,s[3]=(O*he-R*Me-N*pe)*He,s[4]=(D*Ge-x*Ve-S*Oe)*He,s[5]=(l*Ve-f*Ge+_*Oe)*He,s[6]=(Z*ae-B*Me-te*ne)*He,s[7]=(P*Me-O*ae+N*ne)*He,s[8]=(x*Be-w*Ge+S*Ee)*He,s[9]=(h*Ge-l*Be-_*Ee)*He,s[10]=(B*he-$*ae+te*ce)*He,s[11]=(R*ae-P*he-N*ce)*He,s[12]=(w*Oe-x*Ae-D*Ee)*He,s[13]=(l*Ae-h*Oe+f*Ee)*He,s[14]=($*ne-B*pe-Z*ce)*He,s[15]=(P*pe-R*ne+O*ce)*He,s):null}function Or(s,r,l){var h=r[0],f=r[1],_=r[2],x=r[3],w=r[4],D=r[5],S=r[6],P=r[7],R=r[8],O=r[9],N=r[10],B=r[11],$=r[12],Z=r[13],te=r[14],ce=r[15],ne=l[0],ae=l[1],pe=l[2],he=l[3];return s[0]=ne*h+ae*w+pe*R+he*$,s[1]=ne*f+ae*D+pe*O+he*Z,s[2]=ne*_+ae*S+pe*N+he*te,s[3]=ne*x+ae*P+pe*B+he*ce,s[4]=(ne=l[4])*h+(ae=l[5])*w+(pe=l[6])*R+(he=l[7])*$,s[5]=ne*f+ae*D+pe*O+he*Z,s[6]=ne*_+ae*S+pe*N+he*te,s[7]=ne*x+ae*P+pe*B+he*ce,s[8]=(ne=l[8])*h+(ae=l[9])*w+(pe=l[10])*R+(he=l[11])*$,s[9]=ne*f+ae*D+pe*O+he*Z,s[10]=ne*_+ae*S+pe*N+he*te,s[11]=ne*x+ae*P+pe*B+he*ce,s[12]=(ne=l[12])*h+(ae=l[13])*w+(pe=l[14])*R+(he=l[15])*$,s[13]=ne*f+ae*D+pe*O+he*Z,s[14]=ne*_+ae*S+pe*N+he*te,s[15]=ne*x+ae*P+pe*B+he*ce,s}function ha(s,r,l){var h,f,_,x,w,D,S,P,R,O,N,B,$=l[0],Z=l[1],te=l[2];return r===s?(s[12]=r[0]*$+r[4]*Z+r[8]*te+r[12],s[13]=r[1]*$+r[5]*Z+r[9]*te+r[13],s[14]=r[2]*$+r[6]*Z+r[10]*te+r[14],s[15]=r[3]*$+r[7]*Z+r[11]*te+r[15]):(f=r[1],_=r[2],x=r[3],w=r[4],D=r[5],S=r[6],P=r[7],R=r[8],O=r[9],N=r[10],B=r[11],s[0]=h=r[0],s[1]=f,s[2]=_,s[3]=x,s[4]=w,s[5]=D,s[6]=S,s[7]=P,s[8]=R,s[9]=O,s[10]=N,s[11]=B,s[12]=h*$+w*Z+R*te+r[12],s[13]=f*$+D*Z+O*te+r[13],s[14]=_*$+S*Z+N*te+r[14],s[15]=x*$+P*Z+B*te+r[15]),s}function yc(s,r,l){var h=l[0],f=l[1],_=l[2];return s[0]=r[0]*h,s[1]=r[1]*h,s[2]=r[2]*h,s[3]=r[3]*h,s[4]=r[4]*f,s[5]=r[5]*f,s[6]=r[6]*f,s[7]=r[7]*f,s[8]=r[8]*_,s[9]=r[9]*_,s[10]=r[10]*_,s[11]=r[11]*_,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function kh(s,r,l){var h=Math.sin(l),f=Math.cos(l),_=r[4],x=r[5],w=r[6],D=r[7],S=r[8],P=r[9],R=r[10],O=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=_*f+S*h,s[5]=x*f+P*h,s[6]=w*f+R*h,s[7]=D*f+O*h,s[8]=S*f-_*h,s[9]=P*f-x*h,s[10]=R*f-w*h,s[11]=O*f-D*h,s}function vc(s,r,l){var h=Math.sin(l),f=Math.cos(l),_=r[0],x=r[1],w=r[2],D=r[3],S=r[8],P=r[9],R=r[10],O=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=_*f-S*h,s[1]=x*f-P*h,s[2]=w*f-R*h,s[3]=D*f-O*h,s[8]=_*h+S*f,s[9]=x*h+P*f,s[10]=w*h+R*f,s[11]=D*h+O*f,s}function av(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function d1(s,r,l){var h,f,_,x=l[0],w=l[1],D=l[2],S=Math.hypot(x,w,D);return S<Pg?null:(x*=S=1/S,w*=S,D*=S,h=Math.sin(r),f=Math.cos(r),s[0]=x*x*(_=1-f)+f,s[1]=w*x*_+D*h,s[2]=D*x*_-w*h,s[3]=0,s[4]=x*w*_-D*h,s[5]=w*w*_+f,s[6]=D*w*_+x*h,s[7]=0,s[8]=x*D*_+w*h,s[9]=w*D*_-x*h,s[10]=D*D*_+f,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var f1=Or;function lv(){var s=new ps(3);return ps!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Wo(s){var r=new ps(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function vu(s){return Math.hypot(s[0],s[1],s[2])}function da(s,r,l){var h=new ps(3);return h[0]=s,h[1]=r,h[2]=l,h}function xc(s,r,l){return s[0]=r[0]+l[0],s[1]=r[1]+l[1],s[2]=r[2]+l[2],s}function Bp(s,r,l){return s[0]=r[0]-l[0],s[1]=r[1]-l[1],s[2]=r[2]-l[2],s}function cv(s,r,l){return s[0]=r[0]*l[0],s[1]=r[1]*l[1],s[2]=r[2]*l[2],s}function uf(s,r,l){return s[0]=Math.min(r[0],l[0]),s[1]=Math.min(r[1],l[1]),s[2]=Math.min(r[2],l[2]),s}function hf(s,r,l){return s[0]=Math.max(r[0],l[0]),s[1]=Math.max(r[1],l[1]),s[2]=Math.max(r[2],l[2]),s}function ms(s,r,l){return s[0]=r[0]*l,s[1]=r[1]*l,s[2]=r[2]*l,s}function df(s,r,l,h){return s[0]=r[0]+l[0]*h,s[1]=r[1]+l[1]*h,s[2]=r[2]+l[2]*h,s}function go(s,r){var l=r[0],h=r[1],f=r[2],_=l*l+h*h+f*f;return _>0&&(_=1/Math.sqrt(_)),s[0]=r[0]*_,s[1]=r[1]*_,s[2]=r[2]*_,s}function qo(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function Rh(s,r,l){var h=r[0],f=r[1],_=r[2],x=l[0],w=l[1],D=l[2];return s[0]=f*D-_*w,s[1]=_*x-h*D,s[2]=h*w-f*x,s}function yi(s,r,l){var h=r[0],f=r[1],_=r[2],x=l[3]*h+l[7]*f+l[11]*_+l[15];return s[0]=(l[0]*h+l[4]*f+l[8]*_+l[12])/(x=x||1),s[1]=(l[1]*h+l[5]*f+l[9]*_+l[13])/x,s[2]=(l[2]*h+l[6]*f+l[10]*_+l[14])/x,s}function Oh(s,r,l){var h=l[0],f=l[1],_=l[2],x=r[0],w=r[1],D=r[2],S=f*D-_*w,P=_*x-h*D,R=h*w-f*x,O=f*R-_*P,N=_*S-h*R,B=h*P-f*S,$=2*l[3];return P*=$,R*=$,N*=2,B*=2,s[0]=x+(S*=$)+(O*=2),s[1]=w+P+N,s[2]=D+R+B,s}var Lh,Mo=Bp,p1=cv,uv=vu;function Fh(s,r,l){return s[0]=r[0]*l,s[1]=r[1]*l,s[2]=r[2]*l,s[3]=r[3]*l,s}function ff(s,r){var l=r[0],h=r[1],f=r[2],_=r[3],x=l*l+h*h+f*f+_*_;return x>0&&(x=1/Math.sqrt(x)),s[0]=l*x,s[1]=h*x,s[2]=f*x,s[3]=_*x,s}function bc(s,r,l){var h=r[0],f=r[1],_=r[2],x=r[3];return s[0]=l[0]*h+l[4]*f+l[8]*_+l[12]*x,s[1]=l[1]*h+l[5]*f+l[9]*_+l[13]*x,s[2]=l[2]*h+l[6]*f+l[10]*_+l[14]*x,s[3]=l[3]*h+l[7]*f+l[11]*_+l[15]*x,s}function hv(){var s=new ps(4);return ps!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function dv(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function xu(s,r,l){l*=.5;var h=r[0],f=r[1],_=r[2],x=r[3],w=Math.sin(l),D=Math.cos(l);return s[0]=h*D+x*w,s[1]=f*D+_*w,s[2]=_*D-f*w,s[3]=x*D-h*w,s}function zh(s,r,l){l*=.5;var h=r[0],f=r[1],_=r[2],x=r[3],w=Math.sin(l),D=Math.cos(l);return s[0]=h*D-_*w,s[1]=f*D+x*w,s[2]=_*D+h*w,s[3]=x*D-f*w,s}lv(),Lh=new ps(4),ps!=Float32Array&&(Lh[0]=0,Lh[1]=0,Lh[2]=0,Lh[3]=0);var m1=ff;lv(),da(1,0,0),da(0,1,0),hv(),hv(),hr();const LD=xe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Rg}=LD,fv=xe([{name:"a_pos_3",components:3,type:"Int16"}]);var Vp=xe([{name:"a_pos",type:"Int16",components:2}]);class Og{constructor(r,l){this.pos=r,this.dir=l}intersectsPlane(r,l,h){const f=qo(l,this.dir);if(Math.abs(f)<1e-6)return!1;const _=((r[0]-this.pos[0])*l[0]+(r[1]-this.pos[1])*l[1]+(r[2]-this.pos[2])*l[2])/f;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,h[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(r,l,h){if($=(N=this.pos)[0],Z=N[1],te=N[2],ce=(B=r)[0],ne=B[1],ae=B[2],Math.abs($-ce)<=Pg*Math.max(1,Math.abs($),Math.abs(ce))&&Math.abs(Z-ne)<=Pg*Math.max(1,Math.abs(Z),Math.abs(ne))&&Math.abs(te-ae)<=Pg*Math.max(1,Math.abs(te),Math.abs(ae))||0===l)return h[0]=h[1]=h[2]=0,!1;var N,B,$,Z,te,ce,ne,ae;const[f,_,x]=this.dir,w=this.pos[0]-r[0],D=this.pos[1]-r[1],S=this.pos[2]-r[2],P=f*f+_*_+x*x,R=2*(w*f+D*_+S*x),O=R*R-4*P*(w*w+D*D+S*S-l*l);if(O<0){const N=Math.max(-R/2,0),B=w+f*N,$=D+_*N,Z=S+x*N,te=Math.hypot(B,$,Z);return h[0]=B*l/te,h[1]=$*l/te,h[2]=Z*l/te,!1}{const N=(-R-Math.sqrt(O))/(2*P);if(N<0){const B=Math.hypot(w,D,S);return h[0]=w*l/B,h[1]=D*l/B,h[2]=S*l/B,!1}return h[0]=w+f*N,h[1]=D+_*N,h[2]=S+x*N,!0}}}class Lg{constructor(r,l,h,f,_){this.TL=r,this.TR=l,this.BR=h,this.BL=f,this.horizon=_}static fromInvProjectionMatrix(r,l,h){const f=[-1,1,1],_=[1,1,1],x=[1,-1,1],w=[-1,-1,1],D=yi(f,f,r),S=yi(_,_,r),P=yi(x,x,r),R=yi(w,w,r);return new Lg(D,S,P,R,l/h)}}class Fg{constructor(r,l){this.points=r,this.planes=l}static fromInvProjectionMatrix(r,l,h,f){const _=Math.pow(2,h),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const S=bc([],D,r),P=1/S[3]/l*_;return(R=S)[0]=(O=S)[0]*(N=[P,P,f?1/S[3]:P,P])[0],R[1]=O[1]*N[1],R[2]=O[2]*N[2],R[3]=O[3]*N[3],R;var R,O,N}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const S=go([],Rh([],Mo([],x[D[0]],x[D[1]]),Mo([],x[D[2]],x[D[1]]))),P=-qo(S,x[D[1]]);return S.concat(P)});return new Fg(x,w)}}class xr{static fromPoints(r){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const f of r)uf(l,l,f),hf(h,h,f);return new xr(l,h)}static applyTransform(r,l){const h=r.getCorners();for(let f=0;f<h.length;++f)yi(h[f],h[f],l);return xr.fromPoints(h)}constructor(r,l){this.min=r,this.max=l,this.center=ms([],xc([],this.min,this.max),.5)}quadrant(r){const l=[r%2==0,r<2],h=Wo(this.min),f=Wo(this.max);for(let _=0;_<l.length;_++)h[_]=l[_]?this.min[_]:this.center[_],f[_]=l[_]?this.center[_]:this.max[_];return f[2]=this.max[2],new xr(h,f)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,l=this.max;return[[r[0],r[1],r[2]],[l[0],r[1],r[2]],[l[0],l[1],r[2]],[r[0],l[1],r[2]],[r[0],r[1],l[2]],[l[0],r[1],l[2]],[l[0],l[1],l[2]],[r[0],l[1],l[2]]]}intersects(r){const l=this.getCorners();let h=!0;for(let f=0;f<r.planes.length;f++){const _=r.planes[f];let x=0;for(let w=0;w<l.length;w++)x+=qo(_,l[w])+_[3]>=0;if(0===x)return 0;x!==l.length&&(h=!1)}if(h)return 2;for(let f=0;f<3;f++){let _=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let w=0;w<r.points.length;w++){const D=r.points[w][f]-this.min[f];_=Math.min(_,D),x=Math.max(x,D)}if(x<0||_>this.max[f]-this.min[f])return 0}return 1}}const jp=5,pv=6,fa=St/Math.PI/2,FD=16383,Up=[64,32,16],Ns=-fa,Bs=fa,zg=[new xr([Ns,Ns,Ns],[Bs,Bs,Bs]),new xr([Ns,Ns,Ns],[0,0,Bs]),new xr([0,Ns,Ns],[Bs,0,Bs]),new xr([Ns,0,Ns],[0,Bs,Bs]),new xr([0,0,Ns],[Bs,Bs,Bs])];function Ng(s){return s*fa/_f}function g1(s,r,l,h=!0){const f=ms([],s._camera.position,s.worldSize),_=[r,l,1,1];bc(_,_,s.pixelMatrixInverse),Fh(_,_,1/_[3]);const x=go([],Mo([],_,f)),w=s.globeMatrix,D=[w[12],w[13],w[14]],S=Mo([],D,f),P=vu(S),R=go([],S),O=s.worldSize/(2*Math.PI),N=qo(R,x),B=Math.asin(O/P);if(B<Math.acos(N)){if(!h)return null;const Ge=[],Ae=[];ms(Ge,x,P/N),go(Ae,Mo(Ae,Ge,S)),go(x,xc(x,S,ms(x,Ae,Math.tan(B)*P)))}const $=[];new Og(f,x).closestPointOnSphere(D,O,$);const Z=go([],Ks(w,0)),te=go([],Ks(w,1)),ce=go([],Ks(w,2)),ne=qo(Z,$),ae=qo(te,$),pe=qo(ce,$),he=sr(Math.asin(-ae/O));let Me=sr(Math.atan2(ne,pe));Me=s.center.lng+function(Ge,Ae){const Be=(Ae-Ge+180)%360-180;return Be<-180?Be+360:Be}(s.center.lng,Me);const Ee=Ci(Me),Oe=hn(Zo(he),0,1);return new Vh(Ee,Oe)}class Bg{constructor(r,l,h){this.a=Mo([],r,h),this.b=Mo([],l,h),this.center=h;const f=go([],this.a),_=go([],this.b);this.angle=Math.acos(qo(f,_))}}function mv(s,r){if(0===s.angle)return null;let l;return l=0===s.a[r]?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[r]/s.a[r]/Math.sin(s.angle)-1/Math.tan(s.angle)),l<0||l>1?null:function(h,f,_,x){const w=Math.sin(_);return h*(Math.sin((1-x)*_)/w)+f*(Math.sin(x*_)/w)}(s.a[r],s.b[r],s.angle,hn(l,0,1))+s.center[r]}function Nl(s){if(s.z<=1)return zg[s.z+2*s.y+s.x];const r=mf(pf(s));return xr.fromPoints(r)}function Nh(s,r,l){return ms(s,s,1-l),df(s,s,r,l)}function _1(s,r){const l=Cc(r.zoom);if(0===l)return Nl(s);const h=pf(s),f=mf(h),_=Ci(h.getWest())*r.worldSize,x=Ci(h.getEast())*r.worldSize,w=Zo(h.getNorth())*r.worldSize,D=Zo(h.getSouth())*r.worldSize,S=[_,w,0],P=[x,w,0],R=[_,D,0],O=[x,D,0],N=kg([],r.globeMatrix);return yi(S,S,N),yi(P,P,N),yi(R,R,N),yi(O,O,N),f[0]=Nh(f[0],R,l),f[1]=Nh(f[1],O,l),f[2]=Nh(f[2],P,l),f[3]=Nh(f[3],S,l),xr.fromPoints(f)}function y1(s,r,l){for(const h of s)yi(h,h,r),ms(h,h,l)}function pf({x:s,y:r,z:l}){const h=1/(1<<l),f=new Un(Xo(s*h),Lr((r+1)*h)),_=new Un(Xo((s+1)*h),Lr(r*h));return new zs(f,_)}function mf(s){const r=an(s.getNorth()),l=an(s.getSouth()),h=Math.cos(r),f=Math.cos(l),_=Math.sin(r),x=Math.sin(l),w=s.getWest(),D=s.getEast();return[bu(f,x,w),bu(f,x,D),bu(h,_,D),bu(h,_,w)]}function bu(s,r,l,h=fa){return l=an(l),[s*Math.sin(l)*h,-r*h,s*Math.cos(l)*h]}function wu(s,r,l){return bu(Math.cos(an(s)),Math.sin(an(s)),r,l)}function Bh(s,r,l,h){const f=1<<l.z,_=(s/St+l.x)/f;return wu(Lr((r/St+l.y)/f),Xo(_),h)}function Kr({min:s,max:r}){return FD/Math.max(r[0]-s[0],r[1]-s[1],r[2]-s[2])}const gv=new Float64Array(16);function gf(s){const r=Kr(s),l=av(gv,[r,r,r]);return ha(l,l,((h=[])[0]=-(f=s.min)[0],h[1]=-f[1],h[2]=-f[2],h));var h,f}function Vg(s){const r=(h=s.min,(l=gv)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=h[0],l[13]=h[1],l[14]=h[2],l[15]=1,l);var l,h;const f=1/Kr(s);return yc(r,r,[f,f,f])}function jg(s,r,l,h,f){const _=function(D){const S=St/(2*Math.PI);return D/(2*Math.PI)/S}(l),x=[s,r,-l/(2*Math.PI)],w=So(new Float64Array(16));return ha(w,w,x),yc(w,w,[_,_,_]),kh(w,w,an(-f)),vc(w,w,an(-h)),w}function Cc(s){return ul(jp,pv,s)}function _v(s,r){const l=wu(r.lat,r.lng);return x=(f=Bp([],function(B){const $=wu(B._center.lat,B._center.lng);let Z=Rh([],da(0,1,0),$);const te=d1([],-B.angle,$);Z=yi(Z,Z,te),d1(te,-B._pitch,Z);const ce=go([],$);return ms(ce,ce,Ng(B.cameraToCenterDistance/B.pixelsPerMeter)),yi(ce,ce,te),xc([],$,ce)}(s),l))[0],w=f[1],D=f[2],S=(_=l)[0],P=_[1],R=_[2],N=(O=Math.sqrt(x*x+w*w+D*D)*Math.sqrt(S*S+P*P+R*R))&&qo(f,_)/O,Math.acos(Math.min(Math.max(N,-1),1));var f,_,x,w,D,S,P,R,O,N}function Ug(s,r){return _v(s,r)>Math.PI/2*1.01}const yv=an(85),vv=Math.cos(yv),x1=Math.sin(yv),_f=6371008.8,Io=2*Math.PI*_f;class Ua{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ua(fn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,h=this.lat*l,f=r.lat*l,_=Math.sin(h)*Math.sin(f)+Math.cos(h)*Math.cos(f)*Math.cos((r.lng-this.lng)*l);return _f*Math.acos(Math.min(_,1))}toBounds(r=0){const l=360*r/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new zs(new Ua(this.lng-h,this.lat-l),new Ua(this.lng+h,this.lat+l))}toEcef(r){const l=Ng(r);return wu(this.lat,this.lng,fa+l)}static convert(r){if(r instanceof Ua)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new Ua(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new Ua(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Un=Ua;function yf(s){return Io*Math.cos(s*Math.PI/180)}function Ci(s){return(180+s)/360}function Zo(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Vs(s,r){return s/yf(r)}function Xo(s){return 360*s-180}function Lr(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function $g(s,r){return s*yf(Lr(r))}const Fr=85.051129;function Hg(s){return 1/Math.cos(s*Math.PI/180)}class Vh{constructor(r,l,h=0){this.x=+r,this.y=+l,this.z=+h}static fromLngLat(r,l=0){const h=Un.convert(r);return new Vh(Ci(h.lng),Zo(h.lat),Vs(l,h.lat))}toLngLat(){return new Un(Xo(this.x),Lr(this.y))}toAltitude(){return $g(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Io*Hg(Lr(this.y))}}function $p(s,r,l,h,f,_,x,w,D){const S=(r+h)/2,P=(l+f)/2,R=new at(S,P);w(R),function(O,N,B,$,Z,te){const ce=B-Z,ne=$-te;return Math.abs(($-N)*ce-(B-O)*ne)/Math.hypot(ce,ne)}(R.x,R.y,_.x,_.y,x.x,x.y)>=D?($p(s,r,l,S,P,_,R,w,D),$p(s,S,P,h,f,R,x,w,D)):s.push(x)}function xv(s,r,l){let h=s[0],f=h.x,_=h.y;r(h);const x=[h];for(let w=1;w<s.length;w++){const D=s[w],{x:S,y:P}=D;r(D),$p(x,f,_,S,P,h,D,r,l),f=S,_=P,h=D}return x}function Gg(s,r,l,h){if(h(r,l)){const f=r.add(l)._mult(.5);Gg(s,r,f,h),Gg(s,f,l,h)}else s.push(l)}function Wg(s,r){let l=s[0];const h=[l];for(let f=1;f<s.length;f++){const _=s[f];Gg(h,l,_,r),l=_}return h}const vf=Math.pow(2,14)-1,bv=-vf-1;function xf(s,r){const l=Math.round(s.x*r),h=Math.round(s.y*r);return s.x=hn(l,bv,vf),s.y=hn(h,bv,vf),(l<s.x||l>s.x+1||h<s.y||h>s.y+1)&&ui("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function Bl(s,r,l){const h=s.loadGeometry(),f=s.extent,_=St/f;if(r&&l&&l.projection.isReprojectedInTileSpace){const x=1<<r.z,{scale:w,x:D,y:S,projection:P}=l,R=O=>{const N=Xo((r.x+O.x/f)/x),B=Lr((r.y+O.y/f)/x),$=P.project(N,B);O.x=($.x*w-D)*f,O.y=($.y*w-S)*f};for(let O=0;O<h.length;O++)if(1!==s.type)h[O]=xv(h[O],R,1);else{const N=[];for(const B of h[O])B.x<0||B.x>=f||B.y<0||B.y>=f||(R(B),N.push(B));h[O]=N}}for(const x of h)for(const w of x)xf(w,_);return h}function Cu(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?Bl(s):[]}}function jh(s,r,l,h,f){s.emplaceBack(2*r+(h+1)/2,2*l+(f+1)/2)}function Uh(s,r,l){s.emplaceBack(r.x,r.y,r.z,16384*l[0],16384*l[1],16384*l[2])}class Hp{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new Xe,this.indexArray=new vt,this.segments=new $i,this.programConfigurations=new zl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,h,f){const _=this.layers[0],x=[];let w=null;"circle"===_.type&&(w=_.layout.get("circle-sort-key"));for(const{feature:S,id:P,index:R,sourceLayerIndex:O}of r){const N=this.layers[0]._featureFilter.needGeometry,B=Cu(S,N);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),B,h))continue;const $=w?w.evaluate(B,{},h):void 0,Z={id:P,properties:S.properties,type:S.type,sourceLayerIndex:O,index:R,geometry:N?B.geometry:Bl(S,h,f),patterns:{},sortKey:$};x.push(Z)}w&&x.sort((S,P)=>S.sortKey-P.sortKey);let D=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new Ye,D=f.projection);for(const S of x){const{geometry:P,index:R,sourceLayerIndex:O}=S,N=r[R].feature;this.addFeature(S,P,R,l.availableImages,h,D),l.featureIndex.insert(N,P,R,O,this.index)}}update(r,l,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,RD.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,OD.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,l,h,f,_,x){for(const w of l)for(const D of w){const S=D.x,P=D.y;if(S<0||S>=St||P<0||P>=St)continue;if(x){const N=x.projectTilePoint(S,P,_),B=x.upVector(_,S,P),$=this.globeExtVertexArray;Uh($,N,B),Uh($,N,B),Uh($,N,B),Uh($,N,B)}const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),O=R.vertexLength;jh(this.layoutVertexArray,S,P,-1,-1),jh(this.layoutVertexArray,S,P,1,-1),jh(this.layoutVertexArray,S,P,1,1),jh(this.layoutVertexArray,S,P,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{},f,_)}}function Eu(s,r){for(let l=0;l<s.length;l++)if(Du(r,s[l]))return!0;for(let l=0;l<r.length;l++)if(Du(s,r[l]))return!0;return!!bf(s,r)}function qg(s,r,l){return!!Du(s,r)||!!Xg(r,s,l)}function Zg(s,r){if(1===s.length)return Cv(r,s[0]);for(let l=0;l<r.length;l++){const h=r[l];for(let f=0;f<h.length;f++)if(Du(s,h[f]))return!0}for(let l=0;l<s.length;l++)if(Cv(r,s[l]))return!0;for(let l=0;l<r.length;l++)if(bf(s,r[l]))return!0;return!1}function b1(s,r,l){if(s.length>1){if(bf(s,r))return!0;for(let h=0;h<r.length;h++)if(Xg(r[h],s,l))return!0}for(let h=0;h<s.length;h++)if(Xg(s[h],r,l))return!0;return!1}function bf(s,r){if(0===s.length||0===r.length)return!1;for(let l=0;l<s.length-1;l++){const h=s[l],f=s[l+1];for(let _=0;_<r.length-1;_++)if(w1(h,f,r[_],r[_+1]))return!0}return!1}function w1(s,r,l,h){return zo(s,l,h)!==zo(r,l,h)&&zo(s,r,l)!==zo(s,r,h)}function Xg(s,r,l){const h=l*l;if(1===r.length)return s.distSqr(r[0])<h;for(let f=1;f<r.length;f++)if(wv(s,r[f-1],r[f])<h)return!0;return!1}function wv(s,r,l){const h=r.distSqr(l);if(0===h)return s.distSqr(r);const f=((s.x-r.x)*(l.x-r.x)+(s.y-r.y)*(l.y-r.y))/h;return s.distSqr(f<0?r:f>1?l:l.sub(r)._mult(f)._add(r))}function Cv(s,r){let l,h,f,_=!1;for(let x=0;x<s.length;x++){l=s[x];for(let w=0,D=l.length-1;w<l.length;D=w++)h=l[w],f=l[D],h.y>r.y!=f.y>r.y&&r.x<(f.x-h.x)*(r.y-h.y)/(f.y-h.y)+h.x&&(_=!_)}return _}function Du(s,r){let l=!1;for(let h=0,f=s.length-1;h<s.length;f=h++){const _=s[h],x=s[f];_.y>r.y!=x.y>r.y&&r.x<(x.x-_.x)*(r.y-_.y)/(x.y-_.y)+_.x&&(l=!l)}return l}function Ev(s,r,l,h,f){for(const x of s)if(r<=x.x&&l<=x.y&&h>=x.x&&f>=x.y)return!0;const _=[new at(r,l),new at(r,f),new at(h,f),new at(h,l)];if(s.length>2)for(const x of _)if(Du(s,x))return!0;for(let x=0;x<s.length-1;x++)if(Dv(s[x],s[x+1],_))return!0;return!1}function Dv(s,r,l){const h=l[0],f=l[2];if(s.x<h.x&&r.x<h.x||s.x>f.x&&r.x>f.x||s.y<h.y&&r.y<h.y||s.y>f.y&&r.y>f.y)return!1;const _=zo(s,r,l[0]);return _!==zo(s,r,l[1])||_!==zo(s,r,l[2])||_!==zo(s,r,l[3])}function Ec(s,r,l){const h=r.paint.get(s).value;return"constant"===h.kind?h.value:l.programConfigurations.get(r.id).getMaxValue(s)}function wf(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Gp(s,r,l,h,f){if(!r[0]&&!r[1])return s;const _=at.convert(r)._mult(f);"viewport"===l&&_._rotate(-h);const x=[];for(let w=0;w<s.length;w++)x.push(s[w].sub(_));return x}function Tv(s,r,l,h){const f=at.convert(s)._mult(h);return"viewport"===r&&f._rotate(-l),f}pt(Hp,"CircleBucket",{omit:["layers"]});const C1=new re({"circle-sort-key":new Y(ze.layout_circle["circle-sort-key"])});var Sv={paint:new re({"circle-radius":new Y(ze.paint_circle["circle-radius"]),"circle-color":new Y(ze.paint_circle["circle-color"]),"circle-blur":new Y(ze.paint_circle["circle-blur"]),"circle-opacity":new Y(ze.paint_circle["circle-opacity"]),"circle-translate":new U(ze.paint_circle["circle-translate"]),"circle-translate-anchor":new U(ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new U(ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new U(ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Y(ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Y(ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Y(ze.paint_circle["circle-stroke-opacity"])}),layout:C1};function Yg(s,r,l,h,f,_,x,w,D){if(_&&s.queryGeometry.isAboveHorizon)return!1;_&&(D*=s.pixelToTileUnitsFactor);const S=s.tileID.canonical,P=l.projection.upVectorScale(S,l.center.lat,l.worldSize).metersToTile;for(const R of r)for(const O of R){const N=O.add(w),B=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(N.x,N.y,!0):0,$=l.projection.projectTilePoint(N.x,N.y,S);if(B>0){const ne=l.projection.upVector(S,N.x,N.y);$.x+=ne[0]*P*B,$.y+=ne[1]*P*B,$.z+=ne[2]*P*B}const Z=_?N:Tu($.x,$.y,$.z,h),te=_?s.tilespaceRays.map(ne=>E1(ne,B)):s.queryGeometry.screenGeometry,ce=bc([],[$.x,$.y,$.z,1],h);if(!x&&_?D*=ce[3]/l.cameraToCenterDistance:x&&!_&&(D*=l.cameraToCenterDistance/ce[3]),_){const ne=Lr((O.y/St+S.y)/(1<<S.z));D/=l.projection.pixelsPerMeter(ne,1)/Vs(1,ne)}if(qg(te,Z,D))return!0}return!1}function Tu(s,r,l,h){const f=bc([],[s,r,l,1],h);return new at(f[0]/f[3],f[1]/f[3])}const Kg=da(0,0,0),Mv=da(0,0,1);function E1(s,r){const l=lv();return Kg[2]=r,s.intersectsPlane(Kg,Mv,l),new at(l[0],l[1])}class D1 extends Hp{}function Cf(s,{width:r,height:l},h,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==r*l*h)throw new RangeError("mismatched image size")}else f=new Uint8Array(r*l*h);return s.width=r,s.height=l,s.data=f,s}function Iv(s,r,l){const{width:h,height:f}=r;h===s.width&&f===s.height||(Wp(s,r,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,h),height:Math.min(s.height,f)},l),s.width=h,s.height=f,s.data=r.data)}function Wp(s,r,l,h,f,_){if(0===f.width||0===f.height)return r;if(f.width>s.width||f.height>s.height||l.x>s.width-f.width||l.y>s.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>r.width||f.height>r.height||h.x>r.width-f.width||h.y>r.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,w=r.data;for(let D=0;D<f.height;D++){const S=((l.y+D)*s.width+l.x)*_,P=((h.y+D)*r.width+h.x)*_;for(let R=0;R<f.width*_;R++)w[P+R]=x[S+R]}return r}pt(D1,"HeatmapBucket",{omit:["layers"]});class $a{constructor(r,l){Cf(this,r,1,l)}resize(r){Iv(this,new $a(r),1)}clone(){return new $a({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,f,_){Wp(r,l,h,f,_,1)}}class Ao{constructor(r,l){Cf(this,r,4,l)}resize(r){Iv(this,new Ao(r),4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Ao({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,f,_){Wp(r,l,h,f,_,4)}}pt($a,"AlphaImage"),pt(Ao,"RGBAImage");var Jg={paint:new re({"heatmap-radius":new Y(ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Y(ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new U(ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ie(ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new U(ze.paint_heatmap["heatmap-opacity"])})};function qp(s){const r={},l=s.resolution||256,h=s.clips?s.clips.length:1,f=s.image||new Ao({width:l,height:h}),_=(x,w,D)=>{r[s.evaluationKey]=D;const S=s.expression.evaluate(r);f.data[x+w+0]=Math.floor(255*S.r/S.a),f.data[x+w+1]=Math.floor(255*S.g/S.a),f.data[x+w+2]=Math.floor(255*S.b/S.a),f.data[x+w+3]=Math.floor(255*S.a)};if(s.clips)for(let x=0,w=0;x<h;++x,w+=4*l)for(let D=0,S=0;D<l;D++,S+=4){const P=D/(l-1),{start:R,end:O}=s.clips[x];_(w,S,R*(1-P)+O*P)}else for(let x=0,w=0;x<l;x++,w+=4)_(0,w,x/(l-1));return f}var Zp={paint:new re({"hillshade-illumination-direction":new U(ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new U(ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new U(ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new U(ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new U(ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new U(ze.paint_hillshade["hillshade-accent-color"])})};const Xp=xe([{name:"a_pos",components:2,type:"Int16"}],4),{members:Av}=Xp;var Ef={exports:{}};function $h(s,r,l){l=l||2;var h,f,_,x,w,D,S,P=r&&r.length,R=P?r[0]*l:s.length,O=Yp(s,0,R,l,!0),N=[];if(!O||O.next===O.prev)return N;if(P&&(O=function($,Z,te,ce){var ne,ae,pe,he=[];for(ne=0,ae=Z.length;ne<ae;ne++)(pe=Yp($,Z[ne]*ce,ne<ae-1?Z[ne+1]*ce:$.length,ce,!1))===pe.next&&(pe.steiner=!0),he.push(Hh(pe));for(he.sort(kv),ne=0;ne<he.length;ne++)te=Rv(he[ne],te);return te}(s,r,O,l)),s.length>80*l){h=_=s[0],f=x=s[1];for(var B=l;B<R;B+=l)(w=s[B])<h&&(h=w),(D=s[B+1])<f&&(f=D),w>_&&(_=w),D>x&&(x=D);S=0!==(S=Math.max(_-h,x-f))?32767/S:0}return Df(O,N,l,h,f,S,0),N}function Yp(s,r,l,h,f){var _,x;if(f===im(s,r,l,h)>0)for(_=r;_<l;_+=h)x=Qg(_,s[_],s[_+1],x);else for(_=l-h;_>=r;_-=h)x=Qg(_,s[_],s[_+1],x);return x&&Jp(x,x.next)&&(Wh(x),x=x.next),x}function pa(s,r){if(!s)return s;r||(r=s);var l,h=s;do{if(l=!1,h.steiner||!Jp(h,h.next)&&0!==Hi(h.prev,h,h.next))h=h.next;else{if(Wh(h),(h=r=h.prev)===h.next)break;l=!0}}while(l||h!==r);return r}function Df(s,r,l,h,f,_,x){if(s){!x&&_&&function(P,R,O,N){var B=P;do{0===B.z&&(B.z=Tf(B.x,B.y,R,O,N)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next}while(B!==P);B.prevZ.nextZ=null,B.prevZ=null,function($){var Z,te,ce,ne,ae,pe,he,Me,Ee=1;do{for(te=$,$=null,ae=null,pe=0;te;){for(pe++,ce=te,he=0,Z=0;Z<Ee&&(he++,ce=ce.nextZ);Z++);for(Me=Ee;he>0||Me>0&&ce;)0!==he&&(0===Me||!ce||te.z<=ce.z)?(ne=te,te=te.nextZ,he--):(ne=ce,ce=ce.nextZ,Me--),ae?ae.nextZ=ne:$=ne,ne.prevZ=ae,ae=ne;te=ce}ae.nextZ=null,Ee*=2}while(pe>1)}(B)}(s,h,f,_);for(var w,D,S=s;s.prev!==s.next;)if(w=s.prev,D=s.next,_?T1(s,h,f,_):Pv(s))r.push(w.i/l|0),r.push(s.i/l|0),r.push(D.i/l|0),Wh(s),s=D.next,S=D.next;else if((s=D)===S){x?1===x?Df(s=S1(pa(s),r,l),r,l,h,f,_,2):2===x&&M1(s,r,l,h,f,_):Df(pa(s),r,l,h,f,_,1);break}}}function Pv(s){var r=s.prev,l=s,h=s.next;if(Hi(r,l,h)>=0)return!1;for(var f=r.x,_=l.x,x=h.x,w=r.y,D=l.y,S=h.y,P=f<_?f<x?f:x:_<x?_:x,R=w<D?w<S?w:S:D<S?D:S,O=f>_?f>x?f:x:_>x?_:x,N=w>D?w>S?w:S:D>S?D:S,B=h.next;B!==r;){if(B.x>=P&&B.x<=O&&B.y>=R&&B.y<=N&&Gh(f,w,_,D,x,S,B.x,B.y)&&Hi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function T1(s,r,l,h){var f=s.prev,_=s,x=s.next;if(Hi(f,_,x)>=0)return!1;for(var w=f.x,D=_.x,S=x.x,P=f.y,R=_.y,O=x.y,N=w<D?w<S?w:S:D<S?D:S,B=P<R?P<O?P:O:R<O?R:O,$=w>D?w>S?w:S:D>S?D:S,Z=P>R?P>O?P:O:R>O?R:O,te=Tf(N,B,r,l,h),ce=Tf($,Z,r,l,h),ne=s.prevZ,ae=s.nextZ;ne&&ne.z>=te&&ae&&ae.z<=ce;){if(ne.x>=N&&ne.x<=$&&ne.y>=B&&ne.y<=Z&&ne!==f&&ne!==x&&Gh(w,P,D,R,S,O,ne.x,ne.y)&&Hi(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,ae.x>=N&&ae.x<=$&&ae.y>=B&&ae.y<=Z&&ae!==f&&ae!==x&&Gh(w,P,D,R,S,O,ae.x,ae.y)&&Hi(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;ne&&ne.z>=te;){if(ne.x>=N&&ne.x<=$&&ne.y>=B&&ne.y<=Z&&ne!==f&&ne!==x&&Gh(w,P,D,R,S,O,ne.x,ne.y)&&Hi(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;ae&&ae.z<=ce;){if(ae.x>=N&&ae.x<=$&&ae.y>=B&&ae.y<=Z&&ae!==f&&ae!==x&&Gh(w,P,D,R,S,O,ae.x,ae.y)&&Hi(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function S1(s,r,l){var h=s;do{var f=h.prev,_=h.next.next;!Jp(f,_)&&Qp(f,h,h.next,_)&&Dc(f,_)&&Dc(_,f)&&(r.push(f.i/l|0),r.push(h.i/l|0),r.push(_.i/l|0),Wh(h),Wh(h.next),h=s=_),h=h.next}while(h!==s);return pa(h)}function M1(s,r,l,h,f,_){var x=s;do{for(var w=x.next.next;w!==x.prev;){if(x.i!==w.i&&I1(x,w)){var D=tm(x,w);return x=pa(x,x.next),D=pa(D,D.next),Df(x,r,l,h,f,_,0),void Df(D,r,l,h,f,_,0)}w=w.next}x=x.next}while(x!==s)}function kv(s,r){return s.x-r.x}function Rv(s,r){var l=function(f,_){var x,w=_,D=f.x,S=f.y,P=-1/0;do{if(S<=w.y&&S>=w.next.y&&w.next.y!==w.y){var R=w.x+(S-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(R<=D&&R>P&&(P=R,x=w.x<w.next.x?w:w.next,R===D))return x}w=w.next}while(w!==_);if(!x)return null;var O,N=x,B=x.x,$=x.y,Z=1/0;w=x;do{D>=w.x&&w.x>=B&&D!==w.x&&Gh(S<$?D:P,S,B,$,S<$?P:D,S,w.x,w.y)&&(O=Math.abs(S-w.y)/(D-w.x),Dc(w,f)&&(O<Z||O===Z&&(w.x>x.x||w.x===x.x&&Kp(x,w)))&&(x=w,Z=O)),w=w.next}while(w!==N);return x}(s,r);if(!l)return r;var h=tm(l,s);return pa(h,h.next),pa(l,l.next)}function Kp(s,r){return Hi(s.prev,s,r.prev)<0&&Hi(r.next,s,s.next)<0}function Tf(s,r,l,h,f){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*f|0)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*f|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Hh(s){var r=s,l=s;do{(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next}while(r!==s);return l}function Gh(s,r,l,h,f,_,x,w){return(f-x)*(r-w)>=(s-x)*(_-w)&&(s-x)*(h-w)>=(l-x)*(r-w)&&(l-x)*(_-w)>=(f-x)*(h-w)}function I1(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!function(l,h){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==h.i&&f.next.i!==h.i&&Qp(f,f.next,l,h))return!0;f=f.next}while(f!==l);return!1}(s,r)&&(Dc(s,r)&&Dc(r,s)&&function(l,h){var f=l,_=!1,x=(l.x+h.x)/2,w=(l.y+h.y)/2;do{f.y>w!=f.next.y>w&&f.next.y!==f.y&&x<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(_=!_),f=f.next}while(f!==l);return _}(s,r)&&(Hi(s.prev,s,r.prev)||Hi(s,r.prev,r))||Jp(s,r)&&Hi(s.prev,s,s.next)>0&&Hi(r.prev,r,r.next)>0)}function Hi(s,r,l){return(r.y-s.y)*(l.x-r.x)-(r.x-s.x)*(l.y-r.y)}function Jp(s,r){return s.x===r.x&&s.y===r.y}function Qp(s,r,l,h){var f=Sf(Hi(s,r,l)),_=Sf(Hi(s,r,h)),x=Sf(Hi(l,h,s)),w=Sf(Hi(l,h,r));return f!==_&&x!==w||!(0!==f||!em(s,l,r))||!(0!==_||!em(s,h,r))||!(0!==x||!em(l,s,h))||!(0!==w||!em(l,r,h))}function em(s,r,l){return r.x<=Math.max(s.x,l.x)&&r.x>=Math.min(s.x,l.x)&&r.y<=Math.max(s.y,l.y)&&r.y>=Math.min(s.y,l.y)}function Sf(s){return s>0?1:s<0?-1:0}function Dc(s,r){return Hi(s.prev,s,s.next)<0?Hi(s,r,s.next)>=0&&Hi(s,s.prev,r)>=0:Hi(s,r,s.prev)<0||Hi(s,s.next,r)<0}function tm(s,r){var l=new nm(s.i,s.x,s.y),h=new nm(r.i,r.x,r.y),f=s.next,_=r.prev;return s.next=r,r.prev=s,l.next=f,f.prev=l,h.next=l,l.prev=h,_.next=h,h.prev=_,h}function Qg(s,r,l,h){var f=new nm(s,r,l);return h?(f.next=h.next,f.prev=h,h.next.prev=f,h.next=f):(f.prev=f,f.next=f),f}function Wh(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function nm(s,r,l){this.i=s,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function im(s,r,l,h){for(var f=0,_=r,x=l-h;_<l;_+=h)f+=(s[x]-s[_])*(s[_+1]+s[x+1]),x=_;return f}Ef.exports=$h,Ef.exports.default=$h,$h.deviation=function(s,r,l,h){var f=r&&r.length,_=Math.abs(im(s,0,f?r[0]*l:s.length,l));if(f)for(var x=0,w=r.length;x<w;x++)_-=Math.abs(im(s,r[x]*l,x<w-1?r[x+1]*l:s.length,l));var D=0;for(x=0;x<h.length;x+=3){var S=h[x]*l,P=h[x+1]*l,R=h[x+2]*l;D+=Math.abs((s[S]-s[R])*(s[P+1]-s[S+1])-(s[S]-s[P])*(s[R+1]-s[S+1]))}return 0===_&&0===D?0:Math.abs((D-_)/_)},$h.flatten=function(s){for(var r=s[0][0].length,l={vertices:[],holes:[],dimensions:r},h=0,f=0;f<s.length;f++){for(var _=0;_<s[f].length;_++)for(var x=0;x<r;x++)l.vertices.push(s[f][_][x]);f>0&&l.holes.push(h+=s[f-1].length)}return l};var e_=vo(Ef.exports);function A1(s,r,l,h,f){Ov(s,r,l||0,h||s.length-1,f||P1)}function Ov(s,r,l,h,f){for(;h>l;){if(h-l>600){var _=h-l+1,x=r-l+1,w=Math.log(_),D=.5*Math.exp(2*w/3),S=.5*Math.sqrt(w*D*(_-D)/_)*(x-_/2<0?-1:1);Ov(s,r,Math.max(l,Math.floor(r-x*D/_+S)),Math.min(h,Math.floor(r+(_-x)*D/_+S)),f)}var P=s[r],R=l,O=h;for(Mf(s,l,r),f(s[h],P)>0&&Mf(s,l,h);R<O;){for(Mf(s,R,O),R++,O--;f(s[R],P)<0;)R++;for(;f(s[O],P)>0;)O--}0===f(s[l],P)?Mf(s,l,O):Mf(s,++O,h),O<=r&&(l=O+1),r<=O&&(h=O-1)}}function Mf(s,r,l){var h=s[r];s[r]=s[l],s[l]=h}function P1(s,r){return s<r?-1:s>r?1:0}function Ha(s,r){const l=s.length;if(l<=1)return[s];const h=[];let f,_;for(let x=0;x<l;x++){const w=Qu(s[x]);0!==w&&(s[x].area=Math.abs(w),void 0===_&&(_=w<0),_===w<0?(f&&h.push(f),f=[s[x]]):f.push(s[x]))}if(f&&h.push(f),r>1)for(let x=0;x<h.length;x++)h[x].length<=r||(A1(h[x],r,1,h[x].length-1,If),h[x]=h[x].slice(0,r));return h}function If(s,r){return r.area-s.area}function t_(s,r,l){const h=l.patternDependencies;let f=!1;for(const _ of r){const x=_.paint.get(`${s}-pattern`);x.isConstant()||(f=!0);const w=x.constantOr(null);w&&(f=!0,h[w]=!0)}return f}function Lv(s,r,l,h,f){const _=f.patternDependencies;for(const x of r){const w=x.paint.get(`${s}-pattern`).value;if("constant"!==w.kind){let D=w.evaluate({zoom:h},l,{},f.availableImages);D=D&&D.name?D.name:D,_[D]=!0,l.patterns[x.id]=D}}return l}class n_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xe,this.indexArray=new vt,this.indexArray2=new Si,this.programConfigurations=new zl(r.layers,r.zoom),this.segments=new $i,this.segments2=new $i,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=r.projection}populate(r,l,h,f){this.hasPattern=t_("fill",this.layers,l);const _=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:w,id:D,index:S,sourceLayerIndex:P}of r){const R=this.layers[0]._featureFilter.needGeometry,O=Cu(w,R);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),O,h))continue;const N=_?_.evaluate(O,{},h,l.availableImages):void 0,B={id:D,properties:w.properties,type:w.type,sourceLayerIndex:P,index:S,geometry:R?O.geometry:Bl(w,h,f),patterns:{},sortKey:N};x.push(B)}_&&x.sort((w,D)=>w.sortKey-D.sortKey);for(const w of x){const{geometry:D,index:S,sourceLayerIndex:P}=w;if(this.hasPattern){const R=Lv("fill",this.layers,w,this.zoom,l);this.patternFeatures.push(R)}else this.addFeature(w,D,S,h,{},l.availableImages);l.featureIndex.insert(r[S].feature,D,S,P,this.index)}}update(r,l,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,f)}addFeatures(r,l,h,f,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,l,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Av),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,h,f,_,x=[]){for(const w of Ha(l,500)){let D=0;for(const B of w)D+=B.length;const S=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),P=S.vertexLength,R=[],O=[];for(const B of w){if(0===B.length)continue;B!==w[0]&&O.push(R.length/2);const $=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),Z=$.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(Z+B.length-1,Z),R.push(B[0].x),R.push(B[0].y);for(let te=1;te<B.length;te++)this.layoutVertexArray.emplaceBack(B[te].x,B[te].y),this.indexArray2.emplaceBack(Z+te-1,Z+te),R.push(B[te].x),R.push(B[te].y);$.vertexLength+=B.length,$.primitiveLength+=B.length}const N=e_(R,O);for(let B=0;B<N.length;B+=3)this.indexArray.emplaceBack(P+N[B],P+N[B+1],P+N[B+2]);S.vertexLength+=D,S.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,x,f)}}pt(n_,"FillBucket",{omit:["layers","patternFeatures"]});const zD=new re({"fill-sort-key":new Y(ze.layout_fill["fill-sort-key"])});var ND={paint:new re({"fill-antialias":new U(ze.paint_fill["fill-antialias"]),"fill-opacity":new Y(ze.paint_fill["fill-opacity"]),"fill-color":new Y(ze.paint_fill["fill-color"]),"fill-outline-color":new Y(ze.paint_fill["fill-outline-color"]),"fill-translate":new U(ze.paint_fill["fill-translate"]),"fill-translate-anchor":new U(ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new Y(ze.paint_fill["fill-pattern"])}),layout:zD};const BD=xe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Fv=xe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),k1=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:R1}=BD;var rm={},O1=Xs,om=Yo;function Yo(s,r,l,h,f){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=h,this._values=f,s.readFields(Af,this,r)}function Af(s,r,l){1==s?r.id=l.readVarint():2==s?function(h,f){for(var _=h.readVarint()+h.pos;h.pos<_;){var x=f._keys[h.readVarint()],w=f._values[h.readVarint()];f.properties[x]=w}}(l,r):3==s?r.type=l.readVarint():4==s&&(r._geometry=l.pos)}function zv(s){for(var r,l,h=0,f=0,_=s.length,x=_-1;f<_;x=f++)h+=((l=s[x]).x-(r=s[f]).x)*(r.y+l.y);return h}Yo.types=["Unknown","Point","LineString","Polygon"],Yo.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,l=s.readVarint()+s.pos,h=1,f=0,_=0,x=0,w=[];s.pos<l;){if(f<=0){var D=s.readVarint();h=7&D,f=D>>3}if(f--,1===h||2===h)_+=s.readSVarint(),x+=s.readSVarint(),1===h&&(r&&w.push(r),r=[]),r.push(new O1(_,x));else{if(7!==h)throw new Error("unknown command "+h);r&&r.push(r[0].clone())}}return r&&w.push(r),w},Yo.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,l=1,h=0,f=0,_=0,x=1/0,w=-1/0,D=1/0,S=-1/0;s.pos<r;){if(h<=0){var P=s.readVarint();l=7&P,h=P>>3}if(h--,1===l||2===l)(f+=s.readSVarint())<x&&(x=f),f>w&&(w=f),(_+=s.readSVarint())<D&&(D=_),_>S&&(S=_);else if(7!==l)throw new Error("unknown command "+l)}return[x,D,w,S]},Yo.prototype.toGeoJSON=function(s,r,l){var h,f,_=this.extent*Math.pow(2,l),x=this.extent*s,w=this.extent*r,D=this.loadGeometry(),S=Yo.types[this.type];function P(N){for(var B=0;B<N.length;B++){var $=N[B];N[B]=[360*($.x+x)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+w)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(h=0;h<D.length;h++)R[h]=D[h][0];P(D=R);break;case 2:for(h=0;h<D.length;h++)P(D[h]);break;case 3:for(D=function(N){var B=N.length;if(B<=1)return[N];for(var $,Z,te=[],ce=0;ce<B;ce++){var ne=zv(N[ce]);0!==ne&&(void 0===Z&&(Z=ne<0),Z===ne<0?($&&te.push($),$=[N[ce]]):$.push(N[ce]))}return $&&te.push($),te}(D),h=0;h<D.length;h++)for(f=0;f<D[h].length;f++)P(D[h][f])}1===D.length?D=D[0]:S="Multi"+S;var O={type:"Feature",geometry:{type:S,coordinates:D},properties:this.properties};return"id"in this&&(O.id=this.id),O};var Nv=om,i_=L1;function L1(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(VD,this,r),this.length=this._features.length}function VD(s,r,l){15===s?r.version=l.readVarint():1===s?r.name=l.readString():5===s?r.extent=l.readVarint():2===s?r._features.push(l.pos):3===s?r._keys.push(l.readString()):4===s&&r._values.push(function(h){for(var f=null,_=h.readVarint()+h.pos;h.pos<_;){var x=h.readVarint()>>3;f=1===x?h.readString():2===x?h.readFloat():3===x?h.readDouble():4===x?h.readVarint64():5===x?h.readVarint():6===x?h.readSVarint():7===x?h.readBoolean():null}return f}(l))}L1.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new Nv(this._pbf,r,this.extent,this._keys,this._values)};var jD=i_;function r_(s,r,l){if(3===s){var h=new jD(l,l.readVarint()+l.pos);h.length&&(r[h.name]=h)}}var Pf=rm.VectorTile=function(s,r){this.layers=s.readFields(r_,{},r)},o_=rm.VectorTileFeature=om;function s_(s,r,l,h){const f=[],_=0===h?(x,w,D,S,P,R)=>{x.push(new at(R,D+(R-w)/(S-w)*(P-D)))}:(x,w,D,S,P,R)=>{x.push(new at(w+(R-D)/(P-D)*(S-w),R))};for(const x of s){const w=[];for(const D of x){if(D.length<=2)continue;const S=[];for(let O=0;O<D.length-1;O++){const N=D[O].x,B=D[O].y,$=D[O+1].x,Z=D[O+1].y,te=0===h?N:B,ce=0===h?$:Z;te<r?ce>r&&_(S,N,B,$,Z,r):te>l?ce<l&&_(S,N,B,$,Z,l):S.push(D[O]),ce<r&&te>=r&&_(S,N,B,$,Z,r),ce>l&&te<=l&&_(S,N,B,$,Z,l)}let P=D[D.length-1];const R=0===h?P.x:P.y;R>=r&&R<=l&&S.push(P),S.length&&(P=S[S.length-1],S[0].x===P.x&&S[0].y===P.y||S.push(S[0]),w.push(S))}w.length&&f.push(w)}return f}rm.VectorTileLayer=i_;const Bv=o_.types,F1=Math.pow(2,13);function kf(s,r,l,h,f,_,x,w){s.emplaceBack((r<<1)+x,(l<<1)+_,(Math.floor(h*F1)<<1)+f,Math.round(w))}function Rf(s,r,l){s.emplaceBack(r.x,r.y,r.z,16384*l[0],16384*l[1],16384*l[2])}class Vv{constructor(){this.acc=new at(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new at(r.x,r.y),this.max=new at(r.x,r.y))}append(r,l){this.currentPolyCount.edges++,this.acc._add(r);const h=this.min,f=this.max;r.x<h.x?h.x=r.x:r.x>f.x&&(f.x=r.x),r.y<h.y?h.y=r.y:r.y>f.y&&(f.y=r.y),((0===r.x||r.x===St)&&r.x===l.x)!=((0===r.y||r.y===St)&&r.y===l.y)&&this.processBorderOverlap(r,l),l.x<0!=r.x<0&&this.addBorderIntersection(0,mn(l.y,r.y,(0-l.x)/(r.x-l.x))),l.x>St!=r.x>St&&this.addBorderIntersection(1,mn(l.y,r.y,(St-l.x)/(r.x-l.x))),l.y<0!=r.y<0&&this.addBorderIntersection(2,mn(l.x,r.x,(0-l.y)/(r.y-l.y))),l.y>St!=r.y>St&&this.addBorderIntersection(3,mn(l.x,r.x,(St-l.y)/(r.y-l.y)))}addBorderIntersection(r,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[r];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(r,l){if(r.x===l.x){if(r.y===l.y)return;const h=0===r.x?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,r.y)}else{const h=0===r.y?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,r.x)}}centroid(){const r=this.polyCount.reduce((l,h)=>l+h.edges,0);return 0!==r?this.acc.div(r)._round():new at(0,0)}span(){return new at(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,l)=>r+ +(l[0]!==Number.MAX_VALUE),0)}}class qh{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new je,this.centroidVertexArray=new ca,this.indexArray=new vt,this.programConfigurations=new zl(r.layers,r.zoom),this.segments=new $i,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=r.enableTerrain}populate(r,l,h,f){this.features=[],this.hasPattern=t_("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(_){const x=Math.exp(Math.PI*(1-_.y/(1<<_.z)*2));return 80150034*x/(x*x+1)/St/(1<<_.z)}(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:_,id:x,index:w,sourceLayerIndex:D}of r){const S=this.layers[0]._featureFilter.needGeometry,P=Cu(_,S);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),P,h))continue;const R={id:x,sourceLayerIndex:D,index:w,geometry:S?P.geometry:Bl(_,h,f),properties:_.properties,type:_.type,patterns:{}},O=this.layoutVertexArray.length;this.hasPattern?this.features.push(Lv("fill-extrusion",this.layers,R,this.zoom,l)):this.addFeature(R,R.geometry,w,h,{},l.availableImages,f),l.featureIndex.insert(_,R.geometry,w,D,this.index,O)}this.sortBorders()}addFeatures(r,l,h,f,_){for(const x of this.features){const{geometry:w}=x;this.addFeature(x,w,x.index,l,h,f,_)}this.sortBorders()}update(r,l,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,R1),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,k1.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Fv.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,h,f,_,x,w){const D=[new at(0,0),new at(St,St)],S=w.projection,P="globe"===S.name,R=this.enableTerrain&&!P?new Vv:null,O="Polygon"===Bv[r.type];P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ye);const N=Ha(l,500);for(let te=N.length-1;te>=0;te--){const ce=N[te];(0===ce.length||(B=ce[0]).every(ne=>ne.x<=0)||B.every(ne=>ne.x>=St)||B.every(ne=>ne.y<=0)||B.every(ne=>ne.y>=St))&&N.splice(te,1)}var B;let $;if(P)$=Zh(N,D,f);else{$=[];for(const te of N)$.push({polygon:te,bounds:D})}const Z=O?this.edgeRadius:0;for(const{polygon:te,bounds:ce}of $){let ne=0,ae=0;for(const he of te)O&&!he[0].equals(he[he.length-1])&&he.push(he[0]),ae+=O?he.length-1:he.length;const pe=this.segments.prepareSegment((O?5:4)*ae,this.layoutVertexArray,this.indexArray);if(O){const he=[],Me=[];ne=pe.vertexLength;for(const Oe of te){let Ge,Ae;Oe.length&&Oe!==te[0]&&Me.push(he.length/2),Ge=Oe[1].sub(Oe[0])._perp()._unit();for(let Be=1;Be<Oe.length;Be++){const Ve=Oe[Be],He=Oe[Be===Oe.length-1?1:Be+1];let{x:Ke,y:Le}=Ve;if(Z){Ae=He.sub(Ve)._perp()._unit();const rt=Ge.add(Ae)._unit(),ft=Z*Math.min(4,1/(Ge.x*rt.x+Ge.y*rt.y));Ke+=ft*rt.x,Le+=ft*rt.y,Ge=Ae}kf(this.layoutVertexArray,Ke,Le,0,0,1,1,0),pe.vertexLength++,he.push(Ve.x,Ve.y),P&&Rf(this.layoutVertexExtArray,S.projectTilePoint(Ke,Le,f),S.upVector(f,Ke,Le))}}const Ee=e_(he,Me);for(let Oe=0;Oe<Ee.length;Oe+=3)this.indexArray.emplaceBack(ne+Ee[Oe],ne+Ee[Oe+2],ne+Ee[Oe+1]),pe.primitiveLength++}for(const he of te){R&&he.length&&R.startRing(he[0]);let Me,Ee,Oe,Ge=he.length>4&&Qi(he[he.length-2],he[0],he[1]),Ae=Z?z1(he[he.length-2],he[0],he[1],Z):0;Ee=he[1].sub(he[0])._perp()._unit();let Be=!0;for(let Ve=1,He=0;Ve<he.length;Ve++){let Ke=he[Ve-1],Le=he[Ve];const rt=he[Ve===he.length-1?1:Ve+1];if(R&&O&&R.currentPolyCount.top++,jv(Le,Ke,ce)){Z&&(Ee=rt.sub(Le)._perp()._unit(),Be=!Be);continue}R&&R.append(Le,Ke);const ft=Le.sub(Ke)._perp(),st=ft.x/(Math.abs(ft.x)+Math.abs(ft.y)),Bt=ft.y>0?1:0,et=Ke.dist(Le);if(He+et>32768&&(He=0),Z){Oe=rt.sub(Le)._perp()._unit();let jt=sm(Ke,Le,rt,Of(Ee,Oe),Z);isNaN(jt)&&(jt=0);const It=Le.sub(Ke)._unit();Ke=Ke.add(It.mult(Ae))._round(),Le=Le.add(It.mult(-jt))._round(),Ae=jt,Ee=Oe}const Et=pe.vertexLength,Vt=he.length>4&&Qi(Ke,Le,rt);let Cn=Uv(He,Ge,Be);if(kf(this.layoutVertexArray,Ke.x,Ke.y,st,Bt,0,0,Cn),kf(this.layoutVertexArray,Ke.x,Ke.y,st,Bt,0,1,Cn),He+=et,Cn=Uv(He,Vt,!Be),Ge=Vt,kf(this.layoutVertexArray,Le.x,Le.y,st,Bt,0,0,Cn),kf(this.layoutVertexArray,Le.x,Le.y,st,Bt,0,1,Cn),pe.vertexLength+=4,this.indexArray.emplaceBack(Et+0,Et+1,Et+2),this.indexArray.emplaceBack(Et+1,Et+3,Et+2),pe.primitiveLength+=2,Z){const jt=ne+(1===Ve?he.length-2:Ve-2),It=1===Ve?ne:jt+1;if(this.indexArray.emplaceBack(Et+1,jt,Et+3),this.indexArray.emplaceBack(jt,It,Et+3),pe.primitiveLength+=2,void 0===Me&&(Me=Et),!jv(rt,he[Ve],ce)){const ti=Ve===he.length-1?Me:pe.vertexLength;this.indexArray.emplaceBack(Et+2,Et+3,ti),this.indexArray.emplaceBack(Et+3,ti+1,ti),this.indexArray.emplaceBack(Et+3,It,ti+1),pe.primitiveLength+=3}Be=!Be}if(P){const jt=this.layoutVertexExtArray,It=S.projectTilePoint(Ke.x,Ke.y,f),ti=S.projectTilePoint(Le.x,Le.y,f),$t=S.upVector(f,Ke.x,Ke.y),Wt=S.upVector(f,Le.x,Le.y);Rf(jt,It,$t),Rf(jt,It,$t),Rf(jt,ti,Wt),Rf(jt,ti,Wt)}}O&&(ne+=he.length-1)}}if(R&&R.polyCount.length>0){if(R.borders){R.vertexArrayOffset=this.centroidVertexArray.length;const te=R.borders,ce=this.featuresOnBorder.push(R)-1;for(let ne=0;ne<4;ne++)te[ne][0]!==Number.MAX_VALUE&&this.borders[ne].push(ce)}this.encodeCentroid(R.borders?void 0:R.centroid(),R)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,x,f)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((l,h)=>this.featuresOnBorder[l].borders[r][0]-this.featuresOnBorder[h].borders[r][0])}encodeCentroid(r,l,h=!0){let f,_;if(r)if(0!==r.y){const w=l.span()._mult(this.tileToMeter);f=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(w.x/10)),_=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else f=Math.ceil(7*(r.x+450)),_=0;else f=0,_=+h;let x=h?this.centroidVertexArray.length:l.vertexArrayOffset;for(const w of l.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let D=0;D<w.top;D++)this.centroidVertexArray.emplace(x++,f,_);for(let D=0;D<2*w.edges;D++)this.centroidVertexArray.emplace(x++,0,_),this.centroidVertexArray.emplace(x++,f,_)}}}function Of(s,r){const l=s.add(r)._unit();return s.x*l.x+s.y*l.y}function z1(s,r,l,h){const f=r.sub(s)._perp()._unit(),_=l.sub(r)._perp()._unit();return sm(s,r,l,Of(f,_),h)}function sm(s,r,l,h,f){const _=Math.sqrt(1-h*h);return Math.min(s.dist(r)/3,r.dist(l)/3,f*_/h)}function jv(s,r,l){return s.x<l[0].x&&r.x<l[0].x||s.x>l[1].x&&r.x>l[1].x||s.y<l[0].y&&r.y<l[0].y||s.y>l[1].y&&r.y>l[1].y}function Qi(s,r,l){if(s.x<0||s.x>=St||r.x<0||r.x>=St||l.x<0||l.x>=St)return!1;const h=l.sub(r),f=h.perp(),_=s.sub(r);return(h.x*_.x+h.y*_.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(_.x*_.x+_.y*_.y))>-.866&&f.x*_.x+f.y*_.y<0}function Uv(s,r,l){const h=r?2|s:-3&s;return l?1|h:-2&h}function $v(){const s=Math.PI/32,r=Math.tan(s),l=_f;return l*Math.sqrt(1+2*r*r)-l}function Zh(s,r,l){const h=1<<l.z,f=Xo(l.x/h),_=Xo((l.x+1)/h),x=Lr(l.y/h),w=Lr((l.y+1)/h);return function(D,S,P,R,O=0,N){const B=[];if(!D.length||!P||!R)return B;const $=(he,Me)=>{for(const Ee of he)B.push({polygon:Ee,bounds:Me})},Z=Math.ceil(Math.log2(P)),te=Math.ceil(Math.log2(R)),ce=Z-te,ne=[];for(let he=0;he<Math.abs(ce);he++)ne.push(ce>0?0:1);for(let he=0;he<Math.min(Z,te);he++)ne.push(0),ne.push(1);let ae=D;if(ae=s_(ae,S[0].y-O,S[1].y+O,1),ae=s_(ae,S[0].x-O,S[1].x+O,0),!ae.length)return B;const pe=[];for(ne.length?pe.push({polygons:ae,bounds:S,depth:0}):$(ae,S);pe.length;){const he=pe.pop(),Me=he.depth,Ee=ne[Me],Oe=he.bounds[0],Ge=he.bounds[1],Ae=0===Ee?Oe.x:Oe.y,Be=0===Ee?Ge.x:Ge.y,Ve=N?N(Ee,Ae,Be):.5*(Ae+Be),He=s_(he.polygons,Ae-O,Ve+O,Ee),Ke=s_(he.polygons,Ve-O,Be+O,Ee);if(He.length){const Le=[Oe,new at(0===Ee?Ve:Ge.x,1===Ee?Ve:Ge.y)];ne.length>Me+1?pe.push({polygons:He,bounds:Le,depth:Me+1}):$(He,Le)}if(Ke.length){const Le=[new at(0===Ee?Ve:Oe.x,1===Ee?Ve:Oe.y),Ge];ne.length>Me+1?pe.push({polygons:Ke,bounds:Le,depth:Me+1}):$(Ke,Le)}}return B}(s,r,Math.ceil((_-f)/11.25),Math.ceil((x-w)/11.25),1,(D,S,P)=>{if(0===D)return.5*(S+P);{const R=Lr((l.y+S/St)/h);return(Zo(.5*(Lr((l.y+P/St)/h)+R))*h-l.y)*St}})}pt(qh,"FillExtrusionBucket",{omit:["layers","features"]}),pt(Vv,"PartMetadata");const Hv=new re({"fill-extrusion-edge-radius":new U(ze["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var N1={paint:new re({"fill-extrusion-opacity":new U(ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Y(ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new U(ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new U(ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Y(ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Y(ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Y(ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new U(ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new U(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new U(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new U(ze["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Hv};function Gv(s,r,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[s*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}class am{constructor(r,l,h){this.z=r,this.x=l,this.y=h,this.key=lm(0,r,r,l,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l){const h=(x=this.y,w=this.z,D=Gv(256*(_=this.x),256*(x=Math.pow(2,w)-x-1),w),S=Gv(256*(_+1),256*(x+1),w),D[0]+","+D[1]+","+S[0]+","+S[1]),f=function(_,x,w){let D,S="";for(let P=_;P>0;P--)D=1<<P-1,S+=(x&D?1:0)+(w&D?2:0);return S}(this.z,this.x,this.y);var _,x,w,D,S;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Wv{constructor(r,l){this.wrap=r,this.canonical=l,this.key=lm(r,l.z,l.z,l.x,l.y)}}class Jr{constructor(r,l,h,f,_){this.overscaledZ=r,this.wrap=l,this.canonical=new am(h,+f,+_),this.key=0===l&&r===h?this.canonical.key:lm(l,r,h,f,_)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const l=this.canonical.z-r;return r>this.canonical.z?new Jr(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jr(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l=!0){if(this.overscaledZ===r&&l)return this.key;if(r>this.canonical.z)return lm(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-r;return lm(this.wrap*+l,r,r,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new Jr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,f=2*this.canonical.y;return[new Jr(l,this.wrap,l,h,f),new Jr(l,this.wrap,l,h+1,f),new Jr(l,this.wrap,l,h,f+1),new Jr(l,this.wrap,l,h+1,f+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Jr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Jr(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Wv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function lm(s,r,l,h,f){const _=1<<Math.min(l,22);let x=_*(f%_)+h%_;return s&&l<22&&(x+=_*_*((s<0?-2*s-1:2*s)%(1<<2*(22-l)))),16*(32*x+l)+(r-l)}pt(am,"CanonicalTileID"),pt(Jr,"OverscaledTileID",{omit:["projMatrix"]});class Lf extends at{constructor(r,l,h){super(r,l),this.z=h}}function Vl(s,r){return s.x*r.x+s.y*r.y}function Ff(s,r){if(1===s.length){let l=0;const h=r[l++];let f;for(;!f||h.equals(f);)if(f=r[l++],!f)return 1/0;for(;l<r.length;l++){const _=r[l],x=s[0],w=f.sub(h),D=_.sub(h),S=x.sub(h),P=Vl(w,w),R=Vl(w,D),O=Vl(D,D),N=Vl(S,w),B=Vl(S,D),$=P*O-R*R,Z=(O*N-R*B)/$,te=(P*B-R*N)/$,ce=h.z*(1-Z-te)+f.z*Z+_.z*te;if(isFinite(ce))return ce}return 1/0}{let l=1/0;for(const h of r)l=Math.min(l,h.z);return l}}function a_(s,r,l,h,f,_,x,w){const D=x*f.getElevationAt(s,r,!0,!0),S=0!==_[0],P=S?0===_[1]?x*(_[0]/7-450):x*function(R,O,N){const B=Math.floor(O[0]/8),$=Math.floor(O[1]/8),Z=10*(O[0]-8*B),te=10*(O[1]-8*$),ce=R.getElevationAt(B,$,!0,!0),ne=R.getMeterToDEM(N),ae=Math.floor(.5*(Z*ne-1)),pe=Math.floor(.5*(te*ne-1)),he=R.tileCoordToPixel(B,$),Me=2*ae+1,Ee=2*pe+1,Oe=(ft=Me,st=Ee,[(Ke=R).getElevationAtPixel(Le=he.x-ae,rt=he.y-pe,!0),Ke.getElevationAtPixel(Le+st,rt,!0),Ke.getElevationAtPixel(Le,rt+st,!0),Ke.getElevationAtPixel(Le+ft,rt+st,!0)]),Ge=Math.abs(Oe[0]-Oe[1]),Ae=Math.abs(Oe[2]-Oe[3]),Be=Math.abs(Oe[0]-Oe[2])+Math.abs(Oe[1]-Oe[3]),Ve=Math.min(.25,.5*ne*(Ge+Ae)/Me),He=Math.min(.25,.5*ne*Be/Ee);var Ke,Le,rt,ft,st;return ce+Math.max(Ve*Z,He*te)}(f,_,w):D;return{base:D+(0===l)?-1:l,top:S?Math.max(P+h,D+l+2):D+h}}const qv=xe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Zv}=qv,B1=xe([{name:"a_packed",components:4,type:"Float32"}]),{members:V1}=B1,Xv=o_.types,Yv=Math.cos(Math.PI/180*37.5);class Xh{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Pe,this.layoutVertexArray2=new We,this.indexArray=new vt,this.programConfigurations=new zl(r.layers,r.zoom),this.segments=new $i,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,h,f){this.hasPattern=t_("line",this.layers,l);const _=this.layers[0].layout.get("line-sort-key"),x=[];for(const{feature:P,id:R,index:O,sourceLayerIndex:N}of r){const B=this.layers[0]._featureFilter.needGeometry,$=Cu(P,B);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),$,h))continue;const Z=_?_.evaluate($,{},h):void 0,te={id:R,properties:P.properties,type:P.type,sourceLayerIndex:N,index:O,geometry:B?$.geometry:Bl(P,h,f),patterns:{},sortKey:Z};x.push(te)}_&&x.sort((P,R)=>P.sortKey-R.sortKey);const{lineAtlas:w,featureIndex:D}=l,S=this.addConstantDashes(w);for(const P of x){const{geometry:R,index:O,sourceLayerIndex:N}=P;if(S&&this.addFeatureDashes(P,w),this.hasPattern){const B=Lv("line",this.layers,P,this.zoom,l);this.patternFeatures.push(B)}else this.addFeature(P,R,O,h,w.positions,l.availableImages);D.insert(r[O].feature,R,O,N,this.index)}}addConstantDashes(r){let l=!1;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==_.kind)l=!0;else{const x=_.value,w=f.value;if(!w)continue;r.addDash(w,x)}}return l}addFeatureDashes(r,l){const h=this.zoom;for(const f of this.layers){const _=f.paint.get("line-dasharray").value,x=f.layout.get("line-cap").value;if("constant"===_.kind&&"constant"===x.kind)continue;let w,D;if("constant"===_.kind){if(w=_.value,!w)continue}else w=_.evaluate({zoom:h},r);D="constant"===x.kind?x.value:x.evaluate({zoom:h},r),l.addDash(w,D),r.patterns[f.id]=l.getKey(w,D)}}update(r,l,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,f)}addFeatures(r,l,h,f,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,l,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,V1)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Zv),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,h,f,_,x){const w=this.layers[0].layout,D=w.get("line-join").evaluate(r,{}),S=w.get("line-cap").evaluate(r,{}),P=w.get("line-miter-limit"),R=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const O of l)this.addLine(O,r,D,S,P,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,x,f)}addLine(r,l,h,f,_,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<r.length-1;te++)this.totalDistance+=r[te].dist(r[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===Xv[l.type];let D=r.length;for(;D>=2&&r[D-1].equals(r[D-2]);)D--;let S=0;for(;S<D-1&&r[S].equals(r[S+1]);)S++;if(D<(w?3:2))return;"bevel"===h&&(_=1.05);const P=this.overscaling<=16?15*St/(512*this.overscaling):0,R=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let O,N,B,$,Z;this.e1=this.e2=-1,w&&(O=r[D-2],Z=r[S].sub(O)._unit()._perp());for(let te=S;te<D;te++){if(B=te===D-1?w?r[S+1]:void 0:r[te+1],B&&r[te].equals(B))continue;Z&&($=Z),O&&(N=O),O=r[te],Z=B?B.sub(O)._unit()._perp():$,$=$||Z;let ce=$.add(Z);0===ce.x&&0===ce.y||ce._unit();const ne=$.x*Z.x+$.y*Z.y,ae=ce.x*Z.x+ce.y*Z.y,pe=0!==ae?1/ae:1/0,he=2*Math.sqrt(2-2*ae),Me=ae<Yv&&N&&B,Ee=$.x*Z.y-$.y*Z.x>0;if(Me&&te>S){const Ae=O.dist(N);if(Ae>2*P){const Be=O.sub(O.sub(N)._mult(P/Ae)._round());this.updateDistance(N,Be),this.addCurrentVertex(Be,$,0,0,R),N=Be}}const Oe=N&&B;let Ge=Oe?h:w?"butt":f;if(Oe&&"round"===Ge&&(pe<x?Ge="miter":pe<=2&&(Ge="fakeround")),"miter"===Ge&&pe>_&&(Ge="bevel"),"bevel"===Ge&&(pe>2&&(Ge="flipbevel"),pe<_&&(Ge="miter")),N&&this.updateDistance(N,O),"miter"===Ge)ce._mult(pe),this.addCurrentVertex(O,ce,0,0,R);else if("flipbevel"===Ge){if(pe>100)ce=Z.mult(-1);else{const Ae=pe*$.add(Z).mag()/$.sub(Z).mag();ce._perp()._mult(Ae*(Ee?-1:1))}this.addCurrentVertex(O,ce,0,0,R),this.addCurrentVertex(O,ce.mult(-1),0,0,R)}else if("bevel"===Ge||"fakeround"===Ge){const Ae=-Math.sqrt(pe*pe-1),Be=Ee?Ae:0,Ve=Ee?0:Ae;if(N&&this.addCurrentVertex(O,$,Be,Ve,R),"fakeround"===Ge){const He=Math.round(180*he/Math.PI/20);for(let Ke=1;Ke<He;Ke++){let Le=Ke/He;if(.5!==Le){const ft=Le-.5;Le+=Le*ft*(Le-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*ft*ft+(.848013+ne*(.215638*ne-1.06021)))}const rt=Z.sub($)._mult(Le)._add($)._unit()._mult(Ee?-1:1);this.addHalfVertex(O,rt.x,rt.y,!1,Ee,0,R)}}B&&this.addCurrentVertex(O,Z,-Be,-Ve,R)}else if("butt"===Ge)this.addCurrentVertex(O,ce,0,0,R);else if("square"===Ge){const Ae=N?1:-1;N||this.addCurrentVertex(O,ce,Ae,Ae,R),this.addCurrentVertex(O,ce,0,0,R),N&&this.addCurrentVertex(O,ce,Ae,Ae,R)}else"round"===Ge&&(N&&(this.addCurrentVertex(O,$,0,0,R),this.addCurrentVertex(O,$,1,1,R,!0)),B&&(this.addCurrentVertex(O,Z,-1,-1,R,!0),this.addCurrentVertex(O,Z,0,0,R)));if(Me&&te<D-1){const Ae=O.dist(B);if(Ae>2*P){const Be=O.add(B.sub(O)._mult(P/Ae)._round());this.updateDistance(O,Be),this.addCurrentVertex(Be,Z,0,0,R),O=Be}}}}addCurrentVertex(r,l,h,f,_,x=!1){const w=l.y*f-l.x,D=-l.y-l.x*f;this.addHalfVertex(r,l.x+l.y*h,l.y-l.x*h,x,!1,h,_),this.addHalfVertex(r,w,D,x,!0,-f,_)}addHalfVertex({x:r,y:l},h,f,_,x,w,D){this.layoutVertexArray.emplaceBack((r<<1)+(_?1:0),(l<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*f)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),D.primitiveLength++),x?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}pt(Xh,"LineBucket",{omit:["layers","patternFeatures"]});const UD=new re({"line-cap":new Y(ze.layout_line["line-cap"]),"line-join":new Y(ze.layout_line["line-join"]),"line-miter-limit":new U(ze.layout_line["line-miter-limit"]),"line-round-limit":new U(ze.layout_line["line-round-limit"]),"line-sort-key":new Y(ze.layout_line["line-sort-key"])});var cm={paint:new re({"line-opacity":new Y(ze.paint_line["line-opacity"]),"line-color":new Y(ze.paint_line["line-color"]),"line-translate":new U(ze.paint_line["line-translate"]),"line-translate-anchor":new U(ze.paint_line["line-translate-anchor"]),"line-width":new Y(ze.paint_line["line-width"]),"line-gap-width":new Y(ze.paint_line["line-gap-width"]),"line-offset":new Y(ze.paint_line["line-offset"]),"line-blur":new Y(ze.paint_line["line-blur"]),"line-dasharray":new Y(ze.paint_line["line-dasharray"]),"line-pattern":new Y(ze.paint_line["line-pattern"]),"line-gradient":new ie(ze.paint_line["line-gradient"]),"line-trim-offset":new U(ze.paint_line["line-trim-offset"])}),layout:UD};const Kv=new class extends Y{possiblyEvaluate(s,r){return r=new k(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(s,r)}evaluate(s,r,l,h){return r=ki({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(s,r,l,h)}}(cm.paint.properties["line-width"].specification);function um(s,r){return r>0?r+2*s:s}Kv.useIntegerZoom=!0;const Jv=xe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Qv=xe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Su=xe([{name:"a_projected_pos",components:4,type:"Float32"}],4);xe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const j1=xe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),l_=xe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zf=xe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),U1=xe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xe([{name:"triangle",components:3,type:"Uint16"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),xe([{type:"Float32",name:"offsetX"}]),xe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var er=24;const Ko=128;function js(s,r){const{expression:l}=r;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new k(s+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:h,interpolationType:f}=l;let _=0;for(;_<h.length&&h[_]<=s;)_++;_=Math.max(0,_-1);let x=_;for(;x<h.length&&h[x]<s+1;)x++;x=Math.min(h.length-1,x);const w=h[_],D=h[x];return"composite"===l.kind?{kind:"composite",minZoom:w,maxZoom:D,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:D,minSize:l.evaluate(new k(w)),maxSize:l.evaluate(new k(D)),interpolationType:f}}}function Nf(s,{uSize:r,uSizeT:l},{lowerSize:h,upperSize:f}){return"source"===s.kind?h/Ko:"composite"===s.kind?mn(h/Ko,f/Ko,l):r}function Tc(s,r){let l=0,h=0;if("constant"===s.kind)h=s.layoutSize;else if("source"!==s.kind){const{interpolationType:f,minZoom:_,maxZoom:x}=s,w=f?hn(ls.interpolationFactor(f,r,_,x),0,1):0;"camera"===s.kind?h=mn(s.minSize,s.maxSize,w):l=w}return{uSizeT:l,uSize:h}}var $1=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ko,evaluateSizeForFeature:Nf,evaluateSizeForZoom:Tc,getSizeData:js});function H1(s,r,l){return s.sections.forEach(h=>{h.text=function(f,_,x){const w=_.layout.get("text-transform").evaluate(x,{});return"uppercase"===w?f=f.toLocaleUpperCase():"lowercase"===w&&(f=f.toLocaleLowerCase()),I.applyArabicShaping&&(f=I.applyArabicShaping(f)),f}(h.text,r,l)}),s}const Yh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Kh(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function G1(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var e0=ei,t0=function(s,r,l,h,f){var _,x,w=8*f-h-1,D=(1<<w)-1,S=D>>1,P=-7,R=l?f-1:0,O=l?-1:1,N=s[r+R];for(R+=O,_=N&(1<<-P)-1,N>>=-P,P+=w;P>0;_=256*_+s[r+R],R+=O,P-=8);for(x=_&(1<<-P)-1,_>>=-P,P+=h;P>0;x=256*x+s[r+R],R+=O,P-=8);if(0===_)_=1-S;else{if(_===D)return x?NaN:1/0*(N?-1:1);x+=Math.pow(2,h),_-=S}return(N?-1:1)*x*Math.pow(2,_-h)},hm=function(s,r,l,h,f,_){var x,w,D,S=8*_-f-1,P=(1<<S)-1,R=P>>1,O=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,N=h?0:_-1,B=h?1:-1,$=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(w=isNaN(r)?1:0,x=P):(x=Math.floor(Math.log(r)/Math.LN2),r*(D=Math.pow(2,-x))<1&&(x--,D*=2),(r+=x+R>=1?O/D:O*Math.pow(2,1-R))*D>=2&&(x++,D/=2),x+R>=P?(w=0,x=P):x+R>=1?(w=(r*D-1)*Math.pow(2,f),x+=R):(w=r*Math.pow(2,R-1)*Math.pow(2,f),x=0));f>=8;s[l+N]=255&w,N+=B,w/=256,f-=8);for(x=x<<f|w,S+=f;S>0;s[l+N]=255&x,N+=B,x/=256,S-=8);s[l+N-B]|=128*$};function ei(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}ei.Varint=0,ei.Fixed64=1,ei.Bytes=2,ei.Fixed32=5;var dm=4294967296,n0=1/dm,c_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Sc(s){return s.type===ei.Bytes?s.readVarint()+s.pos:s.pos+1}function Qh(s,r,l){var h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(h);for(var f=l.pos-1;f>=s;f--)l.buf[f+h]=l.buf[f]}function W1(s,r){for(var l=0;l<s.length;l++)r.writeVarint(s[l])}function ed(s,r){for(var l=0;l<s.length;l++)r.writeSVarint(s[l])}function Po(s,r){for(var l=0;l<s.length;l++)r.writeFloat(s[l])}function q1(s,r){for(var l=0;l<s.length;l++)r.writeDouble(s[l])}function u_(s,r){for(var l=0;l<s.length;l++)r.writeBoolean(s[l])}function jl(s,r){for(var l=0;l<s.length;l++)r.writeFixed32(s[l])}function Z1(s,r){for(var l=0;l<s.length;l++)r.writeSFixed32(s[l])}function X1(s,r){for(var l=0;l<s.length;l++)r.writeFixed64(s[l])}function Bf(s,r){for(var l=0;l<s.length;l++)r.writeSFixed64(s[l])}function fm(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function Mc(s,r,l){s[l]=r,s[l+1]=r>>>8,s[l+2]=r>>>16,s[l+3]=r>>>24}function pm(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}ei.prototype={destroy:function(){this.buf=null},readFields:function(s,r,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),f=h>>3,_=this.pos;this.type=7&h,s(f,r,this),this.pos===_&&this.skip(h)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=fm(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=pm(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=fm(this.buf,this.pos)+fm(this.buf,this.pos+4)*dm;return this.pos+=8,s},readSFixed64:function(){var s=fm(this.buf,this.pos)+pm(this.buf,this.pos+4)*dm;return this.pos+=8,s},readFloat:function(){var s=t0(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=t0(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,l,h=this.buf;return r=127&(l=h[this.pos++]),l<128?r:(r|=(127&(l=h[this.pos++]))<<7,l<128?r:(r|=(127&(l=h[this.pos++]))<<14,l<128?r:(r|=(127&(l=h[this.pos++]))<<21,l<128?r:function(f,_,x){var w,D,S=x.buf;if(w=(112&(D=S[x.pos++]))>>4,D<128||(w|=(127&(D=S[x.pos++]))<<3,D<128)||(w|=(127&(D=S[x.pos++]))<<10,D<128)||(w|=(127&(D=S[x.pos++]))<<17,D<128)||(w|=(127&(D=S[x.pos++]))<<24,D<128)||(w|=(1&(D=S[x.pos++]))<<31,D<128))return function Jh(s,r,l){return l?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}(f,w,_);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(l=h[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&c_?c_.decode(this.buf.subarray(r,s)):function(l,h,f){for(var _="",x=h;x<f;){var w,D,S,P=l[x],R=null,O=P>239?4:P>223?3:P>191?2:1;if(x+O>f)break;1===O?P<128&&(R=P):2===O?128==(192&(w=l[x+1]))&&(R=(31&P)<<6|63&w)<=127&&(R=null):3===O?(D=l[x+2],128==(192&(w=l[x+1]))&&128==(192&D)&&((R=(15&P)<<12|(63&w)<<6|63&D)<=2047||R>=55296&&R<=57343)&&(R=null)):4===O&&(D=l[x+2],S=l[x+3],128==(192&(w=l[x+1]))&&128==(192&D)&&128==(192&S)&&((R=(15&P)<<18|(63&w)<<12|(63&D)<<6|63&S)<=65535||R>=1114112)&&(R=null)),null===R?(R=65533,O=1):R>65535&&(R-=65536,_+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),_+=String.fromCharCode(R),x+=O}return _}(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==ei.Bytes)return s.push(this.readVarint(r));var l=Sc(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==ei.Bytes)return s.push(this.readSVarint());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==ei.Bytes)return s.push(this.readBoolean());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==ei.Bytes)return s.push(this.readFloat());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==ei.Bytes)return s.push(this.readDouble());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==ei.Bytes)return s.push(this.readFixed32());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==ei.Bytes)return s.push(this.readSFixed32());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==ei.Bytes)return s.push(this.readFixed64());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==ei.Bytes)return s.push(this.readSFixed64());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===ei.Varint)for(;this.buf[this.pos++]>127;);else if(r===ei.Bytes)this.pos=this.readVarint()+this.pos;else if(r===ei.Fixed32)this.pos+=4;else{if(r!==ei.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Mc(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Mc(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Mc(this.buf,-1&s,this.pos),Mc(this.buf,Math.floor(s*n0),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Mc(this.buf,-1&s,this.pos),Mc(this.buf,Math.floor(s*n0),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(r,l){var h,f,_,w;if(r>=0?(h=r%4294967296|0,f=r/4294967296|0):(f=~(-r/4294967296),4294967295^(h=~(-r%4294967296))?h=h+1|0:(h=0,f=f+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),_=h,(w=l).buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,w.buf[w.pos]=127&(_>>>=7),function(_,x){var w=(7&_)<<4;x.buf[x.pos++]|=w|((_>>>=3)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_)))))}(f,l)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=function(h,f,_){for(var x,w,D=0;D<f.length;D++){if((x=f.charCodeAt(D))>55295&&x<57344){if(!w){x>56319||D+1===f.length?(h[_++]=239,h[_++]=191,h[_++]=189):w=x;continue}if(x<56320){h[_++]=239,h[_++]=191,h[_++]=189,w=x;continue}x=w-55296<<10|x-56320|65536,w=null}else w&&(h[_++]=239,h[_++]=191,h[_++]=189,w=null);x<128?h[_++]=x:(x<2048?h[_++]=x>>6|192:(x<65536?h[_++]=x>>12|224:(h[_++]=x>>18|240,h[_++]=x>>12&63|128),h[_++]=x>>6&63|128),h[_++]=63&x|128)}return _}(this.buf,s,this.pos);var l=this.pos-r;l>=128&&Qh(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),hm(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),hm(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,r){this.pos++;var l=this.pos;s(r,this);var h=this.pos-l;h>=128&&Qh(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(s,r,l){this.writeTag(s,ei.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,W1,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,ed,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,u_,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,Po,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,q1,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,jl,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,Z1,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,X1,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,Bf,r)},writeBytesField:function(s,r){this.writeTag(s,ei.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,ei.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,ei.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,ei.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,ei.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,ei.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,ei.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,ei.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,ei.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,ei.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,Boolean(r))}};var mm=vo(e0);const Vf=3;function td(s,r,l){r.glyphs=[],1===s&&l.readMessage(Y1,r)}function Y1(s,r,l){if(3===s){const{id:h,bitmap:f,width:_,height:x,left:w,top:D,advance:S}=l.readMessage(K1,{});r.glyphs.push({id:h,bitmap:new $a({width:_+2*Vf,height:x+2*Vf},f),metrics:{width:_,height:x,left:w,top:D,advance:S}})}else 4===s?r.ascender=l.readSVarint():5===s&&(r.descender=l.readSVarint())}function K1(s,r,l){1===s?r.id=l.readVarint():2===s?r.bitmap=l.readBytes():3===s?r.width=l.readVarint():4===s?r.height=l.readVarint():5===s?r.left=l.readSVarint():6===s?r.top=l.readSVarint():7===s&&(r.advance=l.readVarint())}const r0=Vf;function h_(s){let r=0,l=0;for(const x of s)r+=x.w*x.h,l=Math.max(l,x.w);s.sort((x,w)=>w.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let f=0,_=0;for(const x of s)for(let w=h.length-1;w>=0;w--){const D=h[w];if(!(x.w>D.w||x.h>D.h)){if(x.x=D.x,x.y=D.y,_=Math.max(_,x.y+x.h),f=Math.max(f,x.x+x.w),x.w===D.w&&x.h===D.h){const S=h.pop();w<h.length&&(h[w]=S)}else x.h===D.h?(D.x+=x.w,D.w-=x.w):x.w===D.w?(D.y+=x.h,D.h-=x.h):(h.push({x:D.x+x.w,y:D.y,w:D.w-x.w,h:x.h}),D.y+=x.h,D.h-=x.h);break}}return{w:f,h:_,fill:r/(f*_)||0}}const ko=1;class d_{constructor(r,{pixelRatio:l,version:h,stretchX:f,stretchY:_,content:x}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=f,this.stretchY=_,this.content=x,this.version=h}get tl(){return[this.paddedRect.x+ko,this.paddedRect.y+ko]}get br(){return[this.paddedRect.x+this.paddedRect.w-ko,this.paddedRect.y+this.paddedRect.h-ko]}get displaySize(){return[(this.paddedRect.w-2*ko)/this.pixelRatio,(this.paddedRect.h-2*ko)/this.pixelRatio]}}class o0{constructor(r,l){const h={},f={};this.haveRenderCallbacks=[];const _=[];this.addImages(r,h,_),this.addImages(l,f,_);const{w:x,h:w}=h_(_),D=new Ao({width:x||1,height:w||1});for(const S in r){const P=r[S],R=h[S].paddedRect;Ao.copy(P.data,D,{x:0,y:0},{x:R.x+ko,y:R.y+ko},P.data)}for(const S in l){const P=l[S],R=f[S].paddedRect,O=R.x+ko,N=R.y+ko,B=P.data.width,$=P.data.height;Ao.copy(P.data,D,{x:0,y:0},{x:O,y:N},P.data),Ao.copy(P.data,D,{x:0,y:$-1},{x:O,y:N-1},{width:B,height:1}),Ao.copy(P.data,D,{x:0,y:0},{x:O,y:N+$},{width:B,height:1}),Ao.copy(P.data,D,{x:B-1,y:0},{x:O-1,y:N},{width:1,height:$}),Ao.copy(P.data,D,{x:0,y:0},{x:O+B,y:N},{width:1,height:$})}this.image=D,this.iconPositions=h,this.patternPositions=f}addImages(r,l,h){for(const f in r){const _=r[f],x={x:0,y:0,w:_.data.width+2*ko,h:_.data.height+2*ko};h.push(x),l[f]=new d_(x,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>r.hasImage(h)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in r.updatedImages)this.patchUpdatedImage(this.iconPositions[h],r.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],r.getImage(h),l)}patchUpdatedImage(r,l,h){if(!r||!l||r.version===l.version)return;r.version=l.version;const[f,_]=r.tl;h.update(l.data,void 0,{x:f,y:_})}}pt(d_,"ImagePosition"),pt(o0,"ImageAtlas");const zr={horizontal:1,vertical:2,horizontalOnly:3},Ga=-17;class jf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const h=new jf;return h.scale=r||1,h.fontStack=l,h}static forImage(r){const l=new jf;return l.imageName=r,l}}class nd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const h=new nd;for(let f=0;f<r.sections.length;f++){const _=r.sections[f];_.image?h.addImageSection(_):h.addTextSection(_,l)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(l,h){let f="";for(let _=0;_<l.length;_++){const x=l.charCodeAt(_+1)||null,w=l.charCodeAt(_-1)||null;f+=!h&&(x&&us(x)&&!Yh[l[_+1]]||w&&us(w)&&!Yh[l[_-1]])||!Yh[l[_]]?l[_]:Yh[l[_]]}return f}(this.text,r)}trim(){let r=0;for(let h=0;h<this.text.length&&f_[this.text.charCodeAt(h)];h++)r++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=r&&f_[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const h=new nd;return h.text=this.text.substring(r,l),h.sectionIndex=this.sectionIndex.slice(r,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,l)=>Math.max(r,this.sections[l].scale),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(jf.forText(r.scale,r.fontStack||l));const h=this.sections.length-1;for(let f=0;f<r.text.length;++f)this.sectionIndex.push(h)}addImageSection(r){const l=r.image?r.image.name:"";if(0===l.length)return void ui("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(jf.forImage(l)),this.sectionIndex.push(this.sections.length-1)):ui("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function s0(s,r,l,h,f,_,x,w,D,S,P,R,O,N,B){const $=nd.fromFeature(s,f);R===zr.vertical&&$.verticalizePunctuation(O);let Z=[];const te=function(he,Me,Ee,Oe,Ge,Ae){if(!he)return[];const Be=[],Ve=function(rt,ft,st,Bt,et,Et){let Vt=0;for(let Cn=0;Cn<rt.length();Cn++){const jt=rt.getSection(Cn);Vt+=J1(rt.getCharCode(Cn),jt,Bt,et,ft,Et)}return Vt/Math.max(1,Math.ceil(Vt/st))}(he,Me,Ee,Oe,Ge,Ae),He=he.text.indexOf("\u200b")>=0;let Ke=0;for(let rt=0;rt<he.length();rt++){const ft=he.getSection(rt),st=he.getCharCode(rt);if(f_[st]||(Ke+=J1(st,ft,Oe,Ge,Me,Ae)),rt<he.length()-1){const Bt=!((Le=st)<11904||!(ot["Bopomofo Extended"](Le)||ot.Bopomofo(Le)||ot["CJK Compatibility Forms"](Le)||ot["CJK Compatibility Ideographs"](Le)||ot["CJK Compatibility"](Le)||ot["CJK Radicals Supplement"](Le)||ot["CJK Strokes"](Le)||ot["CJK Symbols and Punctuation"](Le)||ot["CJK Unified Ideographs Extension A"](Le)||ot["CJK Unified Ideographs"](Le)||ot["Enclosed CJK Letters and Months"](Le)||ot["Halfwidth and Fullwidth Forms"](Le)||ot.Hiragana(Le)||ot["Ideographic Description Characters"](Le)||ot["Kangxi Radicals"](Le)||ot["Katakana Phonetic Extensions"](Le)||ot.Katakana(Le)||ot["Vertical Forms"](Le)||ot["Yi Radicals"](Le)||ot["Yi Syllables"](Le)));(a0[st]||Bt||ft.imageName)&&Be.push(c0(rt+1,Ke,Ve,Be,l0(st,he.getCharCode(rt+1),Bt&&He),!1))}}var Le;return m_(c0(he.length(),Ke,Ve,Be,0,!0))}($,S,_,r,h,N),{processBidirectionalText:ce,processStyledBidirectionalText:ne}=I;if(ce&&1===$.sections.length){const he=ce($.toString(),te);for(const Me of he){const Ee=new nd;Ee.text=Me,Ee.sections=$.sections;for(let Oe=0;Oe<Me.length;Oe++)Ee.sectionIndex.push(0);Z.push(Ee)}}else if(ne){const he=ne($.text,$.sectionIndex,te);for(const Me of he){const Ee=new nd;Ee.text=Me[0],Ee.sectionIndex=Me[1],Ee.sections=$.sections,Z.push(Ee)}}else Z=function(he,Me){const Ee=[],Oe=he.text;let Ge=0;for(const Ae of Me)Ee.push(he.substring(Ge,Ae)),Ge=Ae;return Ge<Oe.length&&Ee.push(he.substring(Ge,Oe.length)),Ee}($,te);const ae=[],pe={positionedLines:ae,text:$.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,Me,Ee,Oe,Ge,Ae,Be,Ve,He,Ke,Le,rt){let ft=0,st=0,Bt=0;const et="right"===Ve?1:"left"===Ve?0:.5;let Et=!1;for(const $t of Ge){const Wt=$t.getSections();for(const Wn of Wt){if(Wn.imageName)continue;const qt=Me[Wn.fontStack];if(qt&&(Et=void 0!==qt.ascender&&void 0!==qt.descender,!Et))break}if(!Et)break}let Vt=0;for(const $t of Ge){$t.trim();const Wt=$t.getMaxScale(),Wn=(Wt-1)*er,qt={positionedGlyphs:[],lineOffset:0};he.positionedLines[Vt]=qt;const ni=qt.positionedGlyphs;let zn=0;if(!$t.length()){st+=Ae,++Vt;continue}let xt=0,di=0;for(let ht=0;ht<$t.length();ht++){const gt=$t.getSection(ht),Zt=$t.getSectionIndex(ht),vi=$t.getCharCode(ht);let wn=gt.scale,xi=null,qn=null,tr=null,fi=er,dr=0;const Gi=!(He===zr.horizontal||!Le&&!Pl(vi)||Le&&(f_[vi]||(Cn=vi,ot.Arabic(Cn)||ot["Arabic Supplement"](Cn)||ot["Arabic Extended-A"](Cn)||ot["Arabic Presentation Forms-A"](Cn)||ot["Arabic Presentation Forms-B"](Cn))));if(gt.imageName){const Mn=Oe[gt.imageName];if(!Mn)continue;tr=gt.imageName,he.iconsInText=he.iconsInText||!0,qn=Mn.paddedRect;const nr=Mn.displaySize;wn=wn*er/rt,xi={width:nr[0],height:nr[1],left:ko,top:-r0,advance:Gi?nr[1]:nr[0],localGlyph:!1},dr=Et?-xi.height*wn:Ga+Wt*er-nr[1]*wn,fi=xi.advance;const ya=(Gi?nr[0]:nr[1])*wn-er*Wt;ya>0&&ya>zn&&(zn=ya)}else{const Mn=Ee[gt.fontStack];if(!Mn)continue;Mn[vi]&&(qn=Mn[vi]);const nr=Me[gt.fontStack];if(!nr)continue;const ya=nr.glyphs[vi];if(!ya)continue;if(xi=ya.metrics,fi=8203!==vi?er:0,Et){const Ru=void 0!==nr.ascender?Math.abs(nr.ascender):0,fd=void 0!==nr.descender?Math.abs(nr.descender):0,pd=(Ru+fd)*wn;xt<pd&&(xt=pd,di=(Ru-fd)/2*wn),dr=-Ru*wn}else dr=Ga+(Wt-wn)*er}Gi?(he.verticalizable=!0,ni.push({glyph:vi,imageName:tr,x:ft,y:st+dr,vertical:Gi,scale:wn,localGlyph:xi.localGlyph,fontStack:gt.fontStack,sectionIndex:Zt,metrics:xi,rect:qn}),ft+=fi*wn+Ke):(ni.push({glyph:vi,imageName:tr,x:ft,y:st+dr,vertical:Gi,scale:wn,localGlyph:xi.localGlyph,fontStack:gt.fontStack,sectionIndex:Zt,metrics:xi,rect:qn}),ft+=xi.advance*wn+Ke)}0!==ni.length&&(Bt=Math.max(ft-Ke,Bt),Et?u0(ni,et,zn,di,Ae*Wt/2):u0(ni,et,zn,0,Ae/2)),ft=0;const Bi=Ae*Wt+zn;qt.lineOffset=Math.max(zn,Wn),st+=Bi,++Vt}var Cn;const jt=st,{horizontalAlign:It,verticalAlign:ti}=g_(Be);(function($t,Wt,Wn,qt,ni,zn){const xt=(Wt-Wn)*ni,di=-zn*qt;for(const Bi of $t)for(const ht of Bi.positionedGlyphs)ht.x+=xt,ht.y+=di})(he.positionedLines,et,It,ti,Bt,jt),he.top+=-ti*jt,he.bottom=he.top+jt,he.left+=-It*Bt,he.right=he.left+Bt,he.hasBaseline=Et}(pe,r,l,h,Z,x,w,D,R,S,O,B),!function(he){for(const Me of he)if(0!==Me.positionedGlyphs.length)return!1;return!0}(ae)&&pe}const f_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},a0={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function J1(s,r,l,h,f,_){if(r.imageName){const x=h[r.imageName];return x?x.displaySize[0]*r.scale*er/_+f:0}{const x=l[r.fontStack],w=x&&x.glyphs[s];return w?w.metrics.advance*r.scale+f:0}}function p_(s,r,l,h){const f=Math.pow(s-r,2);return h?s<r?f/2:2*f:f+Math.abs(l)*l}function l0(s,r,l){let h=0;return 10===s&&(h-=1e4),l&&(h+=150),40!==s&&65288!==s||(h+=50),41!==r&&65289!==r||(h+=50),h}function c0(s,r,l,h,f,_){let x=null,w=p_(r,l,f,_);for(const D of h){const S=p_(r-D.x,l,f,_)+D.badness;S<=w&&(x=D,w=S)}return{index:s,x:r,priorBreak:x,badness:w}}function m_(s){return s?m_(s.priorBreak).concat(s.index):[]}function g_(s){let r=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function u0(s,r,l,h,f){if(!(r||l||h||f))return;const _=s.length-1,x=s[_],w=(x.x+x.metrics.advance*x.scale)*r;for(let D=0;D<=_;D++)s[D].x-=w,s[D].y+=l+h+f}function ma(s,r,l){const{horizontalAlign:h,verticalAlign:f}=g_(l),_=r[0]-s.displaySize[0]*h,x=r[1]-s.displaySize[1]*f;return{image:s,top:x,bottom:x+s.displaySize[1],left:_,right:_+s.displaySize[0]}}function h0(s,r,l,h,f,_){const x=s.image;let w;if(x.content){const Z=x.content,te=x.pixelRatio||1;w=[Z[0]/te,Z[1]/te,x.displaySize[0]-Z[2]/te,x.displaySize[1]-Z[3]/te]}const D=r.left*_,S=r.right*_;let P,R,O,N;"width"===l||"both"===l?(N=f[0]+D-h[3],R=f[0]+S+h[1]):(N=f[0]+(D+S-x.displaySize[0])/2,R=N+x.displaySize[0]);const B=r.top*_,$=r.bottom*_;return"height"===l||"both"===l?(P=f[1]+B-h[0],O=f[1]+$+h[2]):(P=f[1]+(B+$-x.displaySize[1])/2,O=P+x.displaySize[1]),{image:x,top:P,right:R,bottom:O,left:N,collisionPadding:w}}class Wa extends at{constructor(r,l,h,f,_){super(r,l),this.angle=f,this.z=h,void 0!==_&&(this.segment=_)}clone(){return new Wa(this.x,this.y,this.z,this.angle,this.segment)}}function d0(s,r,l,h,f){if(void 0===r.segment)return!0;let _=r,x=r.segment+1,w=0;for(;w>-l/2;){if(x--,x<0)return!1;w-=s[x].dist(_),_=s[x]}w+=s[x].dist(s[x+1]),x++;const D=[];let S=0;for(;w<l/2;){const P=s[x],R=s[x+1];if(!R)return!1;let O=s[x-1].angleTo(P)-P.angleTo(R);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:w,angleDelta:O}),S+=O;w-D[0].distance>h;)S-=D.shift().angleDelta;if(S>f)return!1;x++,w+=P.dist(R)}return!0}function f0(s){let r=0;for(let l=0;l<s.length-1;l++)r+=s[l].dist(s[l+1]);return r}function p0(s,r,l){return s?.6*r*l:0}function m0(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function g0(s,r,l,h,f,_){const x=p0(l,f,_),w=m0(l,h)*_;let D=0;const S=f0(s)/2;for(let P=0;P<s.length-1;P++){const R=s[P],O=s[P+1],N=R.dist(O);if(D+N>S){const B=(S-D)/N,$=mn(R.x,O.x,B),Z=mn(R.y,O.y,B),te=new Wa($,Z,0,O.angleTo(R),P);return!x||d0(s,te,w,x,r)?te:void 0}D+=N}}function Q1(s,r,l,h,f,_,x,w,D){const S=p0(h,_,x),P=m0(h,f),R=P*x,O=0===s[0].x||s[0].x===D||0===s[0].y||s[0].y===D;return r-R<r/4&&(r=R+r/4),_0(s,O?r/2*w%r:(P/2+2*_)*x*w%r,r,S,l,R,O,!1,D)}function _0(s,r,l,h,f,_,x,w,D){const S=_/2,P=f0(s);let R=0,O=r-l,N=[];for(let B=0;B<s.length-1;B++){const $=s[B],Z=s[B+1],te=$.dist(Z),ce=Z.angleTo($);for(;O+l<R+te;){O+=l;const ne=(O-R)/te,ae=mn($.x,Z.x,ne),pe=mn($.y,Z.y,ne);if(ae>=0&&ae<D&&pe>=0&&pe<D&&O-S>=0&&O+S<=P){const he=new Wa(ae,pe,0,ce,B);he._round(),h&&!d0(s,he,_,h,f)||N.push(he)}}R+=te}return w||N.length||x||(N=_0(s,R/2,l,h,f,_,x,!0,D)),N}function y0(s,r,l,h,f){const _=[];for(let x=0;x<s.length;x++){const w=s[x];let D;for(let S=0;S<w.length-1;S++){let P=w[S],R=w[S+1];P.x<r&&R.x<r||(P.x<r?P=new at(r,P.y+(r-P.x)/(R.x-P.x)*(R.y-P.y))._round():R.x<r&&(R=new at(r,P.y+(r-P.x)/(R.x-P.x)*(R.y-P.y))._round()),P.y<l&&R.y<l||(P.y<l?P=new at(P.x+(l-P.y)/(R.y-P.y)*(R.x-P.x),l)._round():R.y<l&&(R=new at(P.x+(l-P.y)/(R.y-P.y)*(R.x-P.x),l)._round()),P.x>=h&&R.x>=h||(P.x>=h?P=new at(h,P.y+(h-P.x)/(R.x-P.x)*(R.y-P.y))._round():R.x>=h&&(R=new at(h,P.y+(h-P.x)/(R.x-P.x)*(R.y-P.y))._round()),P.y>=f&&R.y>=f||(P.y>=f?P=new at(P.x+(f-P.y)/(R.y-P.y)*(R.x-P.x),f)._round():R.y>=f&&(R=new at(P.x+(f-P.y)/(R.y-P.y)*(R.x-P.x),f)._round()),D&&P.equals(D[D.length-1])||(D=[P],_.push(D)),D.push(R)))))}}return _}pt(Wa,"Anchor");const Qt=1e20;function kt(s,r,l,h,f,_,x,w,D){for(let S=r;S<r+h;S++)__(s,l*_+S,_,f,x,w,D);for(let S=l;S<l+f;S++)__(s,S*_+r,1,h,x,w,D)}function __(s,r,l,h,f,_,x){_[0]=0,x[0]=-Qt,x[1]=Qt,f[0]=s[r];for(let w=1,D=0,S=0;w<h;w++){f[w]=s[r+w*l];const P=w*w;do{const R=_[D];S=(f[w]-f[R]+P-R*R)/(w-R)/2}while(S<=x[D]&&--D>-1);D++,_[D]=w,x[D]=S,x[D+1]=Qt}for(let w=0,D=0;w<h;w++){for(;x[D+1]<w;)D++;const S=_[D],P=w-S;s[r+w*l]=f[S]+P*P}}const Us=2,y_={none:0,ideographs:1,all:2};class id{constructor(r,l,h){this.requestManager=r,this.localGlyphMode=l,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,l){const h=[];for(const f in r)for(const _ of r[f])h.push({stack:f,id:_});Xi(h,({stack:f,id:_},x)=>{let w=this.entries[f];w||(w=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=w.glyphs[_];if(void 0!==D)return void x(null,{stack:f,id:_,glyph:D});if(D=this._tinySDF(w,f,_),D)return w.glyphs[_]=D,void x(null,{stack:f,id:_,glyph:D});const S=Math.floor(_/256);if(256*S>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[S])return void x(null,{stack:f,id:_,glyph:D});let P=w.requests[S];P||(P=w.requests[S]=[],id.loadGlyphRange(f,S,this.url,this.requestManager,(R,O)=>{if(O){w.ascender=O.ascender,w.descender=O.descender;for(const N in O.glyphs)this._doesCharSupportLocalGlyph(+N)||(w.glyphs[+N]=O.glyphs[+N]);w.ranges[S]=!0}for(const N of P)N(R,O);delete w.requests[S]})),P.push((R,O)=>{R?x(R):O&&x(null,{stack:f,id:_,glyph:O.glyphs[_]||null})})},(f,_)=>{if(f)l(f);else if(_){const x={};for(const{stack:w,id:D,glyph:S}of _)void 0===x[w]&&(x[w]={}),void 0===x[w].glyphs&&(x[w].glyphs={}),x[w].glyphs[D]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},x[w].ascender=this.entries[w].ascender,x[w].descender=this.entries[w].descender;l(null,x)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==y_.none&&(this.localGlyphMode===y_.all?!!this.localFontFamily:!!this.localFontFamily&&(ot["CJK Unified Ideographs"](r)||ot["Hangul Syllables"](r)||ot.Hiragana(r)||ot.Katakana(r)||ot["CJK Symbols and Punctuation"](r)))}_tinySDF(r,l,h){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let _=r.tinySDF;if(!_){let $="400";/bold/i.test(l)?$="900":/medium/i.test(l)?$="500":/light/i.test(l)&&($="200"),_=r.tinySDF=new id.TinySDF({fontFamily:f,fontWeight:$,fontSize:24*Us,buffer:3*Us,radius:8*Us}),_.fontWeight=$}if(this.localGlyphs[_.fontWeight][h])return this.localGlyphs[_.fontWeight][h];const x=String.fromCharCode(h),{data:w,width:D,height:S,glyphWidth:P,glyphHeight:R,glyphLeft:O,glyphTop:N,glyphAdvance:B}=_.draw(x);return this.localGlyphs[_.fontWeight][h]={id:h,bitmap:new $a({width:D,height:S},w),metrics:{width:P/Us,height:R/Us,left:O/Us,top:N/Us-27,advance:B/Us,localGlyph:!0}}}}id.loadGlyphRange=function(s,r,l,h,f){const _=256*r,x=_+255,w=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",s).replace("{range}",`${_}-${x}`),Sa.Glyphs);ic(w,(D,S)=>{if(D)f(D);else if(S){const P={},R=new mm(S).readFields(td,{});for(const O of R.glyphs)P[O.id]=O;f(null,{glyphs:P,ascender:R.ascender,descender:R.descender})}})},id.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:l=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:_="normal",fontStyle:x="normal"}={}){this.buffer=r,this.cutoff=h,this.radius=l;const w=this.size=s+4*r,D=this._createCanvas(w),S=this.ctx=D.getContext("2d",{willReadFrequently:!0});S.font=`${x} ${_} ${s}px ${f}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:_}=this.ctx.measureText(s),x=Math.ceil(l),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-f))),D=Math.min(this.size-this.buffer,x+Math.ceil(h)),S=w+2*this.buffer,P=D+2*this.buffer,R=Math.max(S*P,0),O=new Uint8ClampedArray(R),N={data:O,width:S,height:P,glyphWidth:w,glyphHeight:D,glyphTop:x,glyphLeft:0,glyphAdvance:r};if(0===w||0===D)return N;const{ctx:B,buffer:$,gridInner:Z,gridOuter:te}=this;B.clearRect($,$,w,D),B.fillText(s,$,$+x);const ce=B.getImageData($,$,w,D);te.fill(Qt,0,R),Z.fill(0,0,R);for(let ne=0;ne<D;ne++)for(let ae=0;ae<w;ae++){const pe=ce.data[4*(ne*w+ae)+3]/255;if(0===pe)continue;const he=(ne+$)*S+ae+$;if(1===pe)te[he]=0,Z[he]=Qt;else{const Me=.5-pe;te[he]=Me>0?Me*Me:0,Z[he]=Me<0?Me*Me:0}}kt(te,0,0,S,P,S,this.f,this.v,this.z),kt(Z,$,$,w,D,S,this.f,this.v,this.z);for(let ne=0;ne<R;ne++){const ae=Math.sqrt(te[ne])-Math.sqrt(Z[ne]);O[ne]=Math.round(255-255*(ae/this.radius+this.cutoff))}return N}};const Mu=ko;function v0(s,r,l,h){const f=[],_=s.image,x=_.pixelRatio,w=_.paddedRect.w-2*Mu,D=_.paddedRect.h-2*Mu,S=s.right-s.left,P=s.bottom-s.top,R=_.stretchX||[[0,w]],O=_.stretchY||[[0,D]],N=(Ae,Be)=>Ae+Be[1]-Be[0],B=R.reduce(N,0),$=O.reduce(N,0),Z=w-B,te=D-$;let ce=0,ne=B,ae=0,pe=$,he=0,Me=Z,Ee=0,Oe=te;if(_.content&&h){const Ae=_.content;ce=Uf(R,0,Ae[0]),ae=Uf(O,0,Ae[1]),ne=Uf(R,Ae[0],Ae[2]),pe=Uf(O,Ae[1],Ae[3]),he=Ae[0]-ce,Ee=Ae[1]-ae,Me=Ae[2]-Ae[0]-ne,Oe=Ae[3]-Ae[1]-pe}const Ge=(Ae,Be,Ve,He)=>{const Ke=gm(Ae.stretch-ce,ne,S,s.left),Le=v_(Ae.fixed-he,Me,Ae.stretch,B),rt=gm(Be.stretch-ae,pe,P,s.top),ft=v_(Be.fixed-Ee,Oe,Be.stretch,$),st=gm(Ve.stretch-ce,ne,S,s.left),Bt=v_(Ve.fixed-he,Me,Ve.stretch,B),et=gm(He.stretch-ae,pe,P,s.top),Et=v_(He.fixed-Ee,Oe,He.stretch,$),Vt=new at(Ke,rt),Cn=new at(st,rt),jt=new at(st,et),It=new at(Ke,et),ti=new at(Le/x,ft/x),$t=new at(Bt/x,Et/x),Wt=r*Math.PI/180;if(Wt){const ni=Math.sin(Wt),zn=Math.cos(Wt),xt=[zn,-ni,ni,zn];Vt._matMult(xt),Cn._matMult(xt),It._matMult(xt),jt._matMult(xt)}const Wn=Ae.stretch+Ae.fixed,qt=Be.stretch+Be.fixed;return{tl:Vt,tr:Cn,bl:It,br:jt,tex:{x:_.paddedRect.x+Mu+Wn,y:_.paddedRect.y+Mu+qt,w:Ve.stretch+Ve.fixed-Wn,h:He.stretch+He.fixed-qt},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ti,pixelOffsetBR:$t,minFontScaleX:Me/x/S,minFontScaleY:Oe/x/P,isSDF:l}};if(h&&(_.stretchX||_.stretchY)){const Ae=x0(R,Z,B),Be=x0(O,te,$);for(let Ve=0;Ve<Ae.length-1;Ve++){const He=Ae[Ve],Ke=Ae[Ve+1];for(let Le=0;Le<Be.length-1;Le++)f.push(Ge(He,Be[Le],Ke,Be[Le+1]))}}else f.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:D+1}));return f}function Uf(s,r,l){let h=0;for(const f of s)h+=Math.max(r,Math.min(l,f[1]))-Math.max(r,Math.min(l,f[0]));return h}function x0(s,r,l){const h=[{fixed:-Mu,stretch:0}];for(const[f,_]of s){const x=h[h.length-1];h.push({fixed:f-x.stretch,stretch:x.stretch}),h.push({fixed:f-x.stretch,stretch:x.stretch+(_-f)})}return h.push({fixed:r+Mu,stretch:l}),h}function gm(s,r,l,h){return s/r*l+h}function v_(s,r,l,h){return s-r*l/h}function b0(s,r,l,h){const f=r+s.positionedLines[h].lineOffset;return 0===h?l+f/2:l+(f+(r+s.positionedLines[h-1].lineOffset))/2}class w0{constructor(r=[],l=qa){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:h}=this,f=l[r];for(;r>0;){const _=r-1>>1,x=l[_];if(h(f,x)>=0)break;l[r]=x,r=_}l[r]=f}_down(r){const{data:l,compare:h}=this,f=this.length>>1,_=l[r];for(;r<f;){let x=1+(r<<1),w=l[x];const D=x+1;if(D<this.length&&h(l[D],w)<0&&(x=D,w=l[D]),h(w,_)>=0)break;l[r]=w,r=x}l[r]=_}}function qa(s,r){return s<r?-1:s>r?1:0}function ew(s,r=1,l=!1){let h=1/0,f=1/0,_=-1/0,x=-1/0;const w=s[0];for(let N=0;N<w.length;N++){const B=w[N];(!N||B.x<h)&&(h=B.x),(!N||B.y<f)&&(f=B.y),(!N||B.x>_)&&(_=B.x),(!N||B.y>x)&&(x=B.y)}const D=Math.min(_-h,x-f);let S=D/2;const P=new w0([],x_);if(0===D)return new at(h,f);for(let N=h;N<_;N+=D)for(let B=f;B<x;B+=D)P.push(new Ic(N+S,B+S,S,s));let R=function(N){let B=0,$=0,Z=0;const te=N[0];for(let ce=0,ne=te.length,ae=ne-1;ce<ne;ae=ce++){const pe=te[ce],he=te[ae],Me=pe.x*he.y-he.x*pe.y;$+=(pe.x+he.x)*Me,Z+=(pe.y+he.y)*Me,B+=3*Me}return new Ic($/B,Z/B,0,N)}(s),O=P.length;for(;P.length;){const N=P.pop();(N.d>R.d||!R.d)&&(R=N,l&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,O)),N.max-R.d<=r||(S=N.h/2,P.push(new Ic(N.p.x-S,N.p.y-S,S,s)),P.push(new Ic(N.p.x+S,N.p.y-S,S,s)),P.push(new Ic(N.p.x-S,N.p.y+S,S,s)),P.push(new Ic(N.p.x+S,N.p.y+S,S,s)),O+=4)}return l&&(console.log(`num probes: ${O}`),console.log(`best distance: ${R.d}`)),R.p}function x_(s,r){return r.max-s.max}class Ic{constructor(r,l,h,f){this.p=new at(r,l),this.h=h,this.d=function(_,x){let w=!1,D=1/0;for(let S=0;S<x.length;S++){const P=x[S];for(let R=0,O=P.length,N=O-1;R<O;N=R++){const B=P[R],$=P[N];B.y>_.y!=$.y>_.y&&_.x<($.x-B.x)*(_.y-B.y)/($.y-B.y)+B.x&&(w=!w),D=Math.min(D,wv(_,B,$))}}return(w?1:-1)*Math.sqrt(D)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const rd=7,C0=Number.POSITIVE_INFINITY,$D=Math.sqrt(2);function tw(s,[r,l]){let h=0,f=0;if(l===C0){r<0&&(r=0);const _=r/$D;switch(s){case"top-right":case"top-left":f=_-rd;break;case"bottom-right":case"bottom-left":f=-_+rd;break;case"bottom":f=-r+rd;break;case"top":f=r-rd}switch(s){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=r;break;case"right":h=-r}}else{switch(r=Math.abs(r),l=Math.abs(l),s){case"top-right":case"top-left":case"top":f=l-rd;break;case"bottom-right":case"bottom-left":case"bottom":f=-l+rd}switch(s){case"top-right":case"bottom-right":case"right":h=-r;break;case"top-left":case"bottom-left":case"left":h=r}}return[h,f]}function nw(s,r,l,h,f,_,x,w,D,S){s.createArrays(),s.tilePixelRatio=St/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const P=s.layers[0].layout,R=s.layers[0]._unevaluatedLayout._values,O={};if("composite"===s.textSizeData.kind){const{minZoom:$,maxZoom:Z}=s.textSizeData;O.compositeTextSizes=[R["text-size"].possiblyEvaluate(new k($),w),R["text-size"].possiblyEvaluate(new k(Z),w)]}if("composite"===s.iconSizeData.kind){const{minZoom:$,maxZoom:Z}=s.iconSizeData;O.compositeIconSizes=[R["icon-size"].possiblyEvaluate(new k($),w),R["icon-size"].possiblyEvaluate(new k(Z),w)]}O.layoutTextSize=R["text-size"].possiblyEvaluate(new k(D+1),w),O.layoutIconSize=R["icon-size"].possiblyEvaluate(new k(D+1),w),O.textMaxSize=R["text-size"].possiblyEvaluate(new k(18),w);const N="map"===P.get("text-rotation-alignment")&&"point"!==P.get("symbol-placement"),B=P.get("text-size");for(const $ of s.features){const Z=P.get("text-font").evaluate($,{},w).join(","),te=B.evaluate($,{},w),ce=O.layoutTextSize.evaluate($,{},w),ne=(O.layoutIconSize.evaluate($,{},w),{horizontal:{},vertical:void 0}),ae=$.text;let pe,he=[0,0];if(ae){const Oe=ae.toString(),Ge=P.get("text-letter-spacing").evaluate($,{},w)*er,Ae=P.get("text-line-height").evaluate($,{},w)*er,Be=_r(Oe)?Ge:0,Ve=P.get("text-anchor").evaluate($,{},w),He=P.get("text-variable-anchor");if(!He){const st=P.get("text-radial-offset").evaluate($,{},w);he=st?tw(Ve,[st*er,C0]):P.get("text-offset").evaluate($,{},w).map(Bt=>Bt*er)}let Ke=N?"center":P.get("text-justify").evaluate($,{},w);const Le="point"===P.get("symbol-placement"),rt=Le?P.get("text-max-width").evaluate($,{},w)*er:1/0,ft=st=>{s.allowVerticalPlacement&&Fs(Oe)&&(ne.vertical=s0(ae,r,l,f,Z,rt,Ae,Ve,st,Be,he,zr.vertical,!0,ce,te))};if(!N&&He){const st="auto"===Ke?He.map(et=>_m(et)):[Ke];let Bt=!1;for(let et=0;et<st.length;et++){const Et=st[et];if(!ne.horizontal[Et])if(Bt)ne.horizontal[Et]=ne.horizontal[0];else{const Vt=s0(ae,r,l,f,Z,rt,Ae,"center",Et,Be,he,zr.horizontal,!1,ce,te);Vt&&(ne.horizontal[Et]=Vt,Bt=1===Vt.positionedLines.length)}}ft("left")}else{if("auto"===Ke&&(Ke=_m(Ve)),Le||P.get("text-writing-mode").indexOf("horizontal")>=0||!Fs(Oe)){const st=s0(ae,r,l,f,Z,rt,Ae,Ve,Ke,Be,he,zr.horizontal,!1,ce,te);st&&(ne.horizontal[Ke]=st)}ft(Le?"left":Ke)}}let Me=!1;if($.icon&&$.icon.name){const Oe=h[$.icon.name];Oe&&(pe=ma(f[$.icon.name],P.get("icon-offset").evaluate($,{},w),P.get("icon-anchor").evaluate($,{},w)),Me=Oe.sdf,void 0===s.sdfIcons?s.sdfIcons=Oe.sdf:s.sdfIcons!==Oe.sdf&&ui("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==s.pixelRatio||0!==P.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const Ee=b_(ne.horizontal)||ne.vertical;s.iconsInText||(s.iconsInText=!!Ee&&Ee.iconsInText),(Ee||pe)&&HD(s,$,ne,pe,h,O,ce,0,he,Me,x,w,S)}_&&s.generateCollisionDebugBuffers(D,s.collisionBoxArray)}function _m(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function HD(s,r,l,h,f,_,x,w,D,S,P,R,O){let N=_.textMaxSize.evaluate(r,{},R);void 0===N&&(N=x);const B=s.layers[0].layout,$=B.get("icon-offset").evaluate(r,{},R),Z=b_(l.horizontal)||l.vertical,te="globe"===O.name,ce=er,ne=x/ce,ae=s.tilePixelRatio*N/ce,pe=(Ve=s.overscaling,s.zoom>18&&Ve>2&&(Ve>>=1),Math.max(St/(512*Ve),1)*B.get("symbol-spacing")),he=B.get("text-padding")*s.tilePixelRatio,Me=B.get("icon-padding")*s.tilePixelRatio,Ee=an(B.get("text-max-angle")),Oe="map"===B.get("text-rotation-alignment")&&"point"!==B.get("symbol-placement"),Ge="map"===B.get("icon-rotation-alignment")&&"point"!==B.get("symbol-placement"),Ae=B.get("symbol-placement"),Be=pe/2;var Ve;const He=B.get("icon-text-fit");let Ke;h&&"none"!==He&&(s.allowVerticalPlacement&&l.vertical&&(Ke=h0(h,l.vertical,He,B.get("icon-text-fit-padding"),$,ne)),Z&&(h=h0(h,Z,He,B.get("icon-text-fit-padding"),$,ne)));const Le=(rt,ft,st)=>{if(ft.x<0||ft.x>=St||ft.y<0||ft.y>=St)return;let Bt=null;if(te){const{x:et,y:Et,z:Vt}=O.projectTilePoint(ft.x,ft.y,st);Bt={anchor:new Wa(et,Et,Vt,0,void 0),up:O.upVector(st,ft.x,ft.y)}}!function(et,Et,Vt,Cn,jt,It,ti,$t,Wt,Wn,qt,ni,zn,xt,di,Bi,ht,gt,Zt,vi,wn,xi,qn,tr,fi){const dr=et.addToLineVertexArray(Et,Cn);let Gi,Mn,nr,ya,Ru,fd,pd,br=0,J0=0,Q0=0,ex=0,Mm=-1,ep=-1;const va={};let z_=zp("");const Oc=Vt?Vt.anchor:Et;let Im=0,Am=0;if(void 0===Wt._unevaluatedLayout.getValue("text-radial-offset")?[Im,Am]=Wt.layout.get("text-offset").evaluate(wn,{},fi).map(Qr=>Qr*er):(Im=Wt.layout.get("text-radial-offset").evaluate(wn,{},fi)*er,Am=C0),et.allowVerticalPlacement&&jt.vertical){const Qr=jt.vertical;if(di)fd=w_(Qr),$t&&(pd=w_($t));else{const ir=Wt.layout.get("text-rotate").evaluate(wn,{},fi)+90;nr=Iu(Wn,Oc,Et,qt,ni,zn,Qr,xt,ir,Bi),$t&&(ya=Iu(Wn,Oc,Et,qt,ni,zn,$t,gt,ir))}}if(It){const Qr=Wt.layout.get("icon-rotate").evaluate(wn,{},fi),ir="none"!==Wt.layout.get("icon-text-fit"),tp=v0(It,Qr,qn,ir),N_=$t?v0($t,Qr,qn,ir):void 0;Mn=Iu(Wn,Oc,Et,qt,ni,zn,It,gt,Qr),br=4*tp.length;const km=et.iconSizeData;let _s=null;"source"===km.kind?(_s=[Ko*Wt.layout.get("icon-size").evaluate(wn,{},fi)],_s[0]>gs&&ui(`${et.layerIds[0]}: Value for "icon-size" is >= ${$f}. Reduce your "icon-size".`)):"composite"===km.kind&&(_s=[Ko*xi.compositeIconSizes[0].evaluate(wn,{},fi),Ko*xi.compositeIconSizes[1].evaluate(wn,{},fi)],(_s[0]>gs||_s[1]>gs)&&ui(`${et.layerIds[0]}: Value for "icon-size" is >= ${$f}. Reduce your "icon-size".`)),et.addSymbols(et.icon,tp,_s,vi,Zt,wn,!1,Vt,Et,dr.lineStartIndex,dr.lineLength,-1,tr,fi),Mm=et.icon.placedSymbolArray.length-1,N_&&(J0=4*N_.length,et.addSymbols(et.icon,N_,_s,vi,Zt,wn,zr.vertical,Vt,Et,dr.lineStartIndex,dr.lineLength,-1,tr,fi),ep=et.icon.placedSymbolArray.length-1)}for(const Qr in jt.horizontal){const ir=jt.horizontal[Qr];Gi||(z_=zp(ir.text),di?Ru=w_(ir):Gi=Iu(Wn,Oc,Et,qt,ni,zn,ir,xt,Wt.layout.get("text-rotate").evaluate(wn,{},fi),Bi));const tp=1===ir.positionedLines.length;if(Q0+=E0(et,Vt,Et,ir,ti,Wt,di,wn,Bi,dr,jt.vertical?zr.horizontal:zr.horizontalOnly,tp?Object.keys(jt.horizontal):[Qr],va,Mm,xi,tr,fi),tp)break}jt.vertical&&(ex+=E0(et,Vt,Et,jt.vertical,ti,Wt,di,wn,Bi,dr,zr.vertical,["vertical"],va,ep,xi,tr,fi));let $l=-1;const Pm=(Qr,ir)=>Qr?Math.max(Qr,ir):ir;$l=Pm(Ru,$l),$l=Pm(fd,$l),$l=Pm(pd,$l);const tx=$l>-1?1:0;et.glyphOffsetArray.length>=Za.MAX_GLYPHS&&ui("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==wn.sortKey&&et.addToSortKeyRanges(et.symbolInstances.length,wn.sortKey),et.symbolInstances.emplaceBack(Oc.x,Oc.y,Oc.z,Et.x,Et.y,va.right>=0?va.right:-1,va.center>=0?va.center:-1,va.left>=0?va.left:-1,va.vertical>=0?va.vertical:-1,Mm,ep,z_,void 0!==Gi?Gi:et.collisionBoxArray.length,void 0!==Gi?Gi+1:et.collisionBoxArray.length,void 0!==nr?nr:et.collisionBoxArray.length,void 0!==nr?nr+1:et.collisionBoxArray.length,void 0!==Mn?Mn:et.collisionBoxArray.length,void 0!==Mn?Mn+1:et.collisionBoxArray.length,ya||et.collisionBoxArray.length,ya?ya+1:et.collisionBoxArray.length,qt,Q0,ex,br,J0,tx,0,Im,Am,$l)}(s,ft,Bt,rt,l,h,f,Ke,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,he,Oe,D,0,Me,Ge,$,r,_,S,P,R)};if("line"===Ae)for(const rt of y0(r.geometry,0,0,St,St)){const ft=Q1(rt,pe,Ee,l.vertical||Z,h,ce,ae,s.overscaling,St);for(const st of ft)Z&&D0(s,Z.text,Be,st)||Le(rt,st,R)}else if("line-center"===Ae){for(const rt of r.geometry)if(rt.length>1){const ft=g0(rt,Ee,l.vertical||Z,h,ce,ae);ft&&Le(rt,ft,R)}}else if("Polygon"===r.type)for(const rt of Ha(r.geometry,0)){const ft=ew(rt,16);Le(rt[0],new Wa(ft.x,ft.y,0,0,void 0),R)}else if("LineString"===r.type)for(const rt of r.geometry)Le(rt,new Wa(rt[0].x,rt[0].y,0,0,void 0),R);else if("Point"===r.type)for(const rt of r.geometry)for(const ft of rt)Le([ft],new Wa(ft.x,ft.y,0,0,void 0),R)}const $f=255,gs=$f*Ko;function E0(s,r,l,h,f,_,x,w,D,S,P,R,O,N,B,$,Z){const te=function(ae,pe,he,Me,Ee,Oe,Ge,Ae){const Be=[];if(0===pe.positionedLines.length)return Be;const Ve=Me.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,He=function(st){const Bt=st[0],et=st[1],Et=Bt*et;return Et>0?[Bt,-et]:Et<0?[-Bt,et]:0===Bt?[et,Bt]:[et,-Bt]}(he);let Ke=Math.abs(pe.top-pe.bottom);for(const st of pe.positionedLines)Ke-=st.lineOffset;const Le=pe.positionedLines.length,rt=Ke/Le;let ft=pe.top-he[1];for(let st=0;st<Le;++st){const Bt=pe.positionedLines[st];ft=b0(pe,rt,ft,st);for(const et of Bt.positionedGlyphs){if(!et.rect)continue;const Et=et.rect||{};let Vt=r0+1,Cn=!0,jt=1,It=0;if(et.imageName){const qn=Ge[et.imageName];if(!qn)continue;if(qn.sdf){ui("SDF images are not supported in formatted text and will be ignored.");continue}Cn=!1,jt=qn.pixelRatio,Vt=ko/jt}const ti=(Ee||Ae)&&et.vertical,$t=et.metrics.advance*et.scale/2,Wt=et.metrics,Wn=et.rect;if(null===Wn)continue;Ae&&pe.verticalizable&&(It=et.imageName?$t-et.metrics.width*et.scale/2:0);const qt=Ee?[et.x+$t,et.y]:[0,0];let ni=[0,0],zn=[0,0],xt=!1;Ee||(ti?(zn=[et.x+$t+He[0],et.y+He[1]-It],xt=!0):ni=[et.x+$t+he[0],et.y+he[1]-It]);const di=Wn.w*et.scale/(jt*(et.localGlyph?Us:1)),Bi=Wn.h*et.scale/(jt*(et.localGlyph?Us:1));let ht,gt,Zt,vi;if(ti){const qn=et.y-ft,tr=new at(-$t,$t-qn),fi=-Math.PI/2,dr=new at(...zn);ht=new at(-$t+ni[0],ni[1]),ht._rotateAround(fi,tr)._add(dr),ht.x+=-qn+$t,ht.y-=(Wt.left-Vt)*et.scale;const Gi=et.imageName?Wt.advance*et.scale:er*et.scale,Mn=String.fromCharCode(et.glyph);Kh(Mn)?ht.x+=(1-Vt)*et.scale:G1(Mn)?ht.x+=Gi-Wt.height*et.scale+(-Vt-1)*et.scale:ht.x+=et.imageName||Wt.width+2*Vt===Wn.w&&Wt.height+2*Vt===Wn.h?(Gi-Bi)/2:(Gi-(Wt.height+2*Vt)*et.scale)/2,gt=new at(ht.x,ht.y-di),Zt=new at(ht.x+Bi,ht.y),vi=new at(ht.x+Bi,ht.y-di)}else{const qn=(Wt.left-Vt)*et.scale-$t+ni[0],tr=(-Wt.top-Vt)*et.scale+ni[1],fi=qn+di,dr=tr+Bi;ht=new at(qn,tr),gt=new at(fi,tr),Zt=new at(qn,dr),vi=new at(fi,dr)}if(Ve){let qn;qn=Ee?new at(0,0):xt?new at(He[0],He[1]):new at(he[0],he[1]),ht._rotateAround(Ve,qn),gt._rotateAround(Ve,qn),Zt._rotateAround(Ve,qn),vi._rotateAround(Ve,qn)}const wn=new at(0,0),xi=new at(0,0);Be.push({tl:ht,tr:gt,bl:Zt,br:vi,tex:Et,writingMode:pe.writingMode,glyphOffset:qt,sectionIndex:et.sectionIndex,isSDF:Cn,pixelOffsetTL:wn,pixelOffsetBR:xi,minFontScaleX:0,minFontScaleY:0})}}return Be}(0,h,D,_,x,w,f,s.allowVerticalPlacement),ce=s.textSizeData;let ne=null;"source"===ce.kind?(ne=[Ko*_.layout.get("text-size").evaluate(w,{},Z)],ne[0]>gs&&ui(`${s.layerIds[0]}: Value for "text-size" is >= ${$f}. Reduce your "text-size".`)):"composite"===ce.kind&&(ne=[Ko*B.compositeTextSizes[0].evaluate(w,{},Z),Ko*B.compositeTextSizes[1].evaluate(w,{},Z)],(ne[0]>gs||ne[1]>gs)&&ui(`${s.layerIds[0]}: Value for "text-size" is >= ${$f}. Reduce your "text-size".`)),s.addSymbols(s.text,te,ne,D,x,w,P,r,l,S.lineStartIndex,S.lineLength,N,$,Z);for(const ae of R)O[ae]=s.text.placedSymbolArray.length-1;return 4*te.length}function b_(s){for(const r in s)return s[r];return null}function Iu(s,r,l,h,f,_,x,w,D,S){let P=x.top,R=x.bottom,O=x.left,N=x.right;const B=x.collisionPadding;if(B&&(O-=B[0],P-=B[1],N+=B[2],R+=B[3]),D){const $=new at(O,P),Z=new at(N,P),te=new at(O,R),ce=new at(N,R),ne=an(D);let ae=new at(0,0);S&&(ae=new at(S[0],S[1])),$._rotateAround(ne,ae),Z._rotateAround(ne,ae),te._rotateAround(ne,ae),ce._rotateAround(ne,ae),O=Math.min($.x,Z.x,te.x,ce.x),N=Math.max($.x,Z.x,te.x,ce.x),P=Math.min($.y,Z.y,te.y,ce.y),R=Math.max($.y,Z.y,te.y,ce.y)}return s.emplaceBack(r.x,r.y,r.z,l.x,l.y,O,P,N,R,w,h,f,_),s.length-1}function w_(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function D0(s,r,l,h){const f=s.compareText;if(r in f){const _=f[r];for(let x=_.length-1;x>=0;x--)if(h.dist(_[x])<l)return!0}else f[r]=[];return f[r].push(h),!1}function T0(s,r){const l=s.fovAboveCenter,h=s.elevation?s.elevation.getMinElevationBelowMSL()*r:0,f=(s._camera.position[2]*s.worldSize-h)/Math.cos(s._pitch),_=Math.sin(l)*f/Math.sin(Math.max(Math.PI/2-s._pitch-l,.01)),x=Math.sin(s._pitch)*_+f;return Math.min(1.01*x,f*(1/s._horizonShift))}function Au(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const l=Math.pow(2,-s.z),h=s.x*l,f=(s.x+1)*l,_=s.y*l,x=(s.y+1)*l,w=Xo(h),D=Xo(f),S=Lr(_),P=Lr(x),R=r.project(w,S),O=r.project(D,S),N=r.project(D,P),B=r.project(w,P);let $=Math.min(R.x,O.x,N.x,B.x),Z=Math.min(R.y,O.y,N.y,B.y),te=Math.max(R.x,O.x,N.x,B.x),ce=Math.max(R.y,O.y,N.y,B.y);const ne=l/16;function ae(he,Me,Ee,Oe,Ge,Ae){const Be=(Ee+Ge)/2,Ve=(Oe+Ae)/2,He=r.project(Xo(Be),Lr(Ve)),Ke=Math.max(0,$-He.x,Z-He.y,He.x-te,He.y-ce);$=Math.min($,He.x),te=Math.max(te,He.x),Z=Math.min(Z,He.y),ce=Math.max(ce,He.y),Ke>ne&&(ae(he,He,Ee,Oe,Be,Ve),ae(He,Me,Be,Ve,Ge,Ae))}ae(R,O,h,_,f,_),ae(O,N,f,_,f,x),ae(N,B,f,x,h,x),ae(B,R,h,x,h,_),$-=ne,Z-=ne,te+=ne,ce+=ne;const pe=1/Math.max(te-$,ce-Z);return{scale:pe,x:$*pe,y:Z*pe,x2:te*pe,y2:ce*pe,projection:r}}const iw=So(new Float32Array(16));class Ac{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,l){return{x:0,y:0,z:0}}unproject(r,l){return new Un(0,0)}projectTilePoint(r,l,h){return{x:r,y:l,z:0}}locationPoint(r,l,h=!0){return r._coordinatePoint(r.locationCoordinate(l),h)}pixelsPerMeter(r,l){return Vs(1,r)*l}pixelSpaceConversion(r,l,h){return 1}farthestPixelDistance(r){return T0(r,r.pixelsPerMeter)}pointCoordinate(r,l,h,f){const _=r.horizonLineFromTop(!1),x=new at(l,Math.max(_,h));return r.rayIntersectionCoordinate(r.pointRayIntersection(x,f))}pointCoordinate3D(r,l,h){const f=new at(l,h);if(r.elevation)return r.elevation.pointCoordinate(f);{const _=this.pointCoordinate(r,f.x,f.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(r,l){if(r.elevation)return!this.pointCoordinate3D(r,l.x,l.y);const h=r.horizonLineFromTop();return l.y<h}createInversionMatrix(r,l){return iw}createTileMatrix(r,l,h){let f,_,x;const w=h.canonical,D=So(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=Au(w,this);f=1,_=S.x+h.wrap*S.scale,x=S.y,yc(D,D,[f/S.scale,f/S.scale,r.pixelsPerMeter/l])}else f=l/r.zoomScale(w.z),_=(w.x+Math.pow(2,w.z)*h.wrap)*f,x=w.y*f;return ha(D,D,[_,x,0]),yc(D,D,[f/St,f/St,1]),D}upVector(r,l,h){return[0,0,1]}upVectorScale(r,l,h){return{metersToTile:1}}}class rw extends Ac{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[l,h]=this.parallels=r.parallels||[29.5,45.5],f=Math.sin(an(l));this.n=(f+Math.sin(an(h)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(r,l){const{n:h,c:f,r0:_}=this,x=an(r-this.center[0]),w=an(l),D=Math.sqrt(f-2*h*Math.sin(w))/h;return{x:D*Math.sin(x*h),y:D*Math.cos(x*h)-_,z:0}}unproject(r,l){const{n:h,c:f,r0:_}=this,x=_+l;let w=Math.atan2(r,Math.abs(x))*Math.sign(x);x*h<0&&(w-=Math.PI*Math.sign(r)*Math.sign(x));const D=an(this.center[0])*h;w=fn(w,-Math.PI-D,Math.PI-D);const S=hn(sr(w/h)+this.center[0],-180,180),P=Math.asin(hn((f-(r*r+x*x)*h*h)/(2*h),-1,1)),R=hn(sr(P),-Fr,Fr);return new Un(S,R)}}const od=1.340264,Hf=-.081106,sd=893e-6,ad=.003796,ld=Math.sqrt(3)/2;class GD extends Ac{project(r,l){l=l/180*Math.PI,r=r/180*Math.PI;const h=Math.asin(ld*Math.sin(l)),f=h*h,_=f*f*f;return{x:.5*(r*Math.cos(h)/(ld*(od+3*Hf*f+_*(7*sd+9*ad*f)))/Math.PI+.5),y:1-.5*(h*(od+Hf*f+_*(sd+ad*f))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,f=h*h,_=f*f*f;for(let P,R,O,N=0;N<12&&(R=h*(od+Hf*f+_*(sd+ad*f))-l,O=od+3*Hf*f+_*(7*sd+9*ad*f),P=R/O,h=hn(h-P,-Math.PI/3,Math.PI/3),f=h*h,_=f*f*f,!(Math.abs(P)<1e-12));++N);const x=ld*r*(od+3*Hf*f+_*(7*sd+9*ad*f))/Math.cos(h),w=Math.asin(Math.sin(h)/ld),D=hn(180*x/Math.PI,-180,180),S=hn(180*w/Math.PI,-Fr,Fr);return new Un(D,S)}}class C_ extends Ac{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){return{x:.5+r/360,y:.5-l/360,z:0}}unproject(r,l){const h=360*(r-.5),f=hn(360*(.5-l),-Fr,Fr);return new Un(h,f)}}const cd=Math.PI/2;function E_(s){return Math.tan((cd+s)/2)}class Qe extends Ac{constructor(r){super(r),this.center=r.center||[0,30];const[l,h]=this.parallels=r.parallels||[30,30];let f=an(l),_=an(h);this.southernCenter=f+_<0,this.southernCenter&&(f=-f,_=-_);const x=Math.cos(f),w=E_(f);this.n=f===_?Math.sin(f):Math.log(x/Math.cos(_))/Math.log(E_(_)/w),this.f=x*Math.pow(E_(f),this.n)/this.n}project(r,l){l=an(l),this.southernCenter&&(l=-l),r=an(r-this.center[0]);const h=1e-6,{n:f,f:_}=this;_>0?l<-cd+h&&(l=-cd+h):l>cd-h&&(l=cd-h);const x=_/Math.pow(E_(l),f);let w=x*Math.sin(f*r),D=_-x*Math.cos(f*r);return w=.5*(w/Math.PI+.5),D=.5*(D/Math.PI+.5),{x:w,y:this.southernCenter?D:1-D,z:0}}unproject(r,l){r=(2*r-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f}=this,_=f-l,x=Math.sign(_),w=Math.sign(h)*Math.sqrt(r*r+_*_);let D=Math.atan2(r,Math.abs(_))*x;_*h<0&&(D-=Math.PI*Math.sign(r)*x);const S=hn(sr(D/h)+this.center[0],-180,180),P=hn(sr(2*Math.atan(Math.pow(f/w,1/h))-cd),-Fr,Fr);return new Un(S,this.southernCenter?-P:P)}}class D_ extends Ac{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,l){return{x:Ci(r),y:Zo(l),z:0}}unproject(r,l){const h=Xo(r),f=Lr(l);return new Un(h,f)}}const S0=an(Fr);class M0 extends Ac{project(r,l){const h=(l=an(l))*l,f=h*h;return{x:.5*((r=an(r))*(.8707-.131979*h+f*(f*(.003971*h-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+f*(.028874*h-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,f=25,_=0,x=h*h;do{x=h*h;const S=x*x;_=(h*(1.007226+x*(.015085+S*(.028874*x-.044475-.005916*S)))-l)/(1.007226+x*(.045255+S*(.259866*x-.311325-.005916*11*S))),h=hn(h-_,-S0,S0)}while(Math.abs(_)>1e-6&&--f>0);x=h*h;const w=hn(sr(r/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),D=sr(h);return new Un(w,D)}}const I0=an(Fr);class ow extends Ac{project(r,l){l=an(l),r=an(r);const h=Math.cos(l),f=2/Math.PI,_=Math.acos(h*Math.cos(r/2)),x=Math.sin(_)/_,w=.5*(r*f+2*h*Math.sin(r/2)/x)||0,D=.5*(l+Math.sin(l)/x)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(D/Math.PI+1),z:0}}unproject(r,l){let h=r=(2*r-.5)*Math.PI,f=l=(2*(1-l)-1)*Math.PI,_=25;const x=1e-6;let w=0,D=0;do{const S=Math.cos(f),P=Math.sin(f),R=2*P*S,O=P*P,N=S*S,B=Math.cos(h/2),$=Math.sin(h/2),Z=2*B*$,te=$*$,ce=1-N*B*B,ne=ce?1/ce:0,ae=ce?Math.acos(S*B)*Math.sqrt(1/ce):0,pe=.5*(2*ae*S*$+2*h/Math.PI)-r,he=.5*(ae*P+f)-l,Me=.5*ne*(N*te+ae*S*B*O)+1/Math.PI,Ee=ne*(Z*R/4-ae*P*$),Oe=.125*ne*(R*$-ae*P*N*Z),Ge=.5*ne*(O*B+ae*te*S)+.5,Ae=Ee*Oe-Ge*Me;w=(he*Ee-pe*Ge)/Ae,D=(pe*Oe-he*Me)/Ae,h=hn(h-w,-Math.PI,Math.PI),f=hn(f-D,-I0,I0)}while((Math.abs(w)>x||Math.abs(D)>x)&&--_>0);return new Un(sr(h),sr(f))}}class Gf extends Ac{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(an(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){const{scale:h,cosPhi:f}=this;return{x:an(r)*f*h+.5,y:-Math.sin(an(l))/f*h+.5,z:0}}unproject(r,l){const{scale:h,cosPhi:f}=this,_=-(l-.5)/h,x=hn(sr((r-.5)/h)/f,-180,180),w=Math.asin(hn(_*f,-1,1)),D=hn(sr(w),-Fr,Fr);return new Un(x,D)}}class ud extends D_{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,l,h){const f=Bh(r,l,h);return yi(f,f,gf(Nl(h))),{x:f[0],y:f[1],z:f[2]}}locationPoint(r,l){const h=wu(l.lat,l.lng),f=go([],h),_=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(l),r._centerAltitude):r._centerAltitude;df(h,h,f,Vs(1,0)*St*_);const x=So(new Float64Array(16));return Or(x,r.pixelMatrix,r.globeMatrix),yi(h,h,x),new at(h[0],h[1])}pixelsPerMeter(r,l){return Vs(1,0)*l}pixelSpaceConversion(r,l,h){const f=Vs(1,r)*l,_=mn(Vs(1,45)*l,f,h);return this.pixelsPerMeter(r,l)/_}createTileMatrix(r,l,h){const f=Vg(Nl(h.canonical));return Or(new Float64Array(16),r.globeMatrix,f)}createInversionMatrix(r,l){const{center:h}=r,f=gf(Nl(l));return vc(f,f,an(h.lng)),kh(f,f,an(h.lat)),yc(f,f,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(r,l,h,f){return g1(r,l,h,!0)||new Vh(0,0)}pointCoordinate3D(r,l,h){const f=this.pointCoordinate(r,l,h,0);return[f.x,f.y,f.z]}isPointAboveHorizon(r,l){return!g1(r,l.x,l.y,!1)}farthestPixelDistance(r){const l=function(f,_){const x=f.cameraToCenterDistance,w=f._centerAltitude*_,D=f._camera,S=f._camera.forward(),P=xc([],ms([],S,-x),[0,0,w]),R=f.worldSize/(2*Math.PI),O=[0,0,-R],N=f.width/f.height,B=Math.tan(f.fovAboveCenter),$=ms([],D.up(),B),Z=ms([],D.right(),B*N),te=go([],xc([],xc([],S,$),Z)),ce=[];let ne;if(new Og(P,te).closestPointOnSphere(O,R,ce)){const ae=xc([],ce,O),pe=Mo([],ae,P);ne=Math.cos(f.fovAboveCenter)*vu(pe)}else{const ae=Mo([],P,O),pe=Mo([],O,P);go(pe,pe);const he=vu(ae)-R;ne=Math.sqrt(he*(he+2*R));const Me=Math.acos(ne/(R+he))-Math.acos(qo(S,pe));ne*=Math.cos(Me)}return 1.01*ne}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),h=Cc(r.zoom);if(h>0){const f=T0(r,Vs(1,r.center.lat)*r.worldSize),_=r.worldSize/(2*Math.PI),x=Math.max(r.width,r.height)/r.worldSize*Math.PI;return mn(l,f+_*(1-Math.cos(x)),Math.pow(h,10))}return l}upVector(r,l,h){return Bh(l,h,r,1)}upVectorScale(r){return{metersToTile:Ng(Kr(Nl(r)))}}}function ym(s){const r=s.parallels,l=!!r&&Math.abs(r[0]+r[1])<.01;switch(s.name){case"mercator":return new D_(s);case"equirectangular":return new C_(s);case"naturalEarth":return new M0(s);case"equalEarth":return new GD(s);case"winkelTripel":return new ow(s);case"albers":return l?new Gf(s):new rw(s);case"lambertConformalConic":return l?new Gf(s):new Qe(s);case"globe":return new ud(s)}throw new Error(`Invalid projection name: ${s.name}`)}const Wf=o_.types,T_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Pu(s,r,l,h,f,_,x,w,D,S,P,R,O){const N=w?Math.min(gs,Math.round(w[0])):0,B=w?Math.min(gs,Math.round(w[1])):0;s.emplaceBack(r,l,Math.round(32*h),Math.round(32*f),_,x,(N<<1)+(D?1:0),B,16*S,16*P,256*R,256*O)}function qf(s,r,l,h,f,_,x){s.emplaceBack(r,l,h,f,_,x)}function hd(s,r,l,h,f){s.emplaceBack(r,l,h,f),s.emplaceBack(r,l,h,f),s.emplaceBack(r,l,h,f),s.emplaceBack(r,l,h,f)}function S_(s){for(const r of s.sections)if(Tg(r.text))return!0;return!1}class Zf{constructor(r){this.layoutVertexArray=new $e,this.indexArray=new vt,this.programConfigurations=r,this.segments=new $i,this.dynamicLayoutVertexArray=new We,this.opacityVertexArray=new _t,this.placedSymbolArray=new wi,this.globeExtVertexArray=new qe}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,l,h,f){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Jv.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Su.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,T_,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,Qv.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||f)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}pt(Zf,"SymbolBuffers");class vm{constructor(r,l,h){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new h,this.segments=new $i,this.collisionVertexArray=new dn,this.collisionVertexArrayExt=new sn}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,j1.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,l_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}pt(vm,"CollisionBuffers");class Za{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(x=>x.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=So([]),this.placementViewportMatrix=So([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=js(this.zoom,l["text-size"]),this.iconSizeData=js(this.zoom,l["icon-size"]);const h=this.layers[0].layout,f=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==_&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===_||"auto"===_&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(x=>zr[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new Zf(new zl(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Zf(new zl(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new Xr,this.lineVertexArray=new mu,this.symbolInstances=new ci}calculateGlyphDependencies(r,l,h,f,_){for(let x=0;x<r.length;x++)if(l[r.charCodeAt(x)]=!0,f&&_){const w=Yh[r.charAt(x)];w&&(l[w.charCodeAt(0)]=!0)}}populate(r,l,h,f){const _=this.layers[0],x=_.layout,w="globe"===this.projection.name,D=x.get("text-font"),S=x.get("text-field"),P=x.get("icon-image"),R=("constant"!==S.value.kind||S.value.value instanceof zi&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&("constant"!==D.value.kind||D.value.value.length>0),O="constant"!==P.value.kind||!!P.value.value||Object.keys(P.parameters).length>0,N=x.get("symbol-sort-key");if(this.features=[],!R&&!O)return;const B=l.iconDependencies,$=l.glyphDependencies,Z=l.availableImages,te=new k(this.zoom);for(const{feature:ce,id:ne,index:ae,sourceLayerIndex:pe}of r){const he=_._featureFilter.needGeometry,Me=Cu(ce,he);if(!_._featureFilter.filter(te,Me,h))continue;if(he||(Me.geometry=Bl(ce,h,f)),w&&1!==ce.type&&h.z<=5){const Ae=Me.geometry,Be=.98078528056,Ve=(He,Ke)=>qo(Bh(He.x,He.y,h,1),Bh(Ke.x,Ke.y,h,1))<Be;for(let He=0;He<Ae.length;He++)Ae[He]=Wg(Ae[He],Ve)}let Ee,Oe;if(R){const Ae=_.getValueAndResolveTokens("text-field",Me,h,Z),Be=zi.factory(Ae);S_(Be)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===E()||this.hasRTLText&&I.isParsed())&&(Ee=H1(Be,_,Me))}if(O){const Ae=_.getValueAndResolveTokens("icon-image",Me,h,Z);Oe=Ae instanceof as?Ae:as.fromString(Ae)}if(!Ee&&!Oe)continue;const Ge=this.sortFeaturesByKey?N.evaluate(Me,{},h):void 0;if(this.features.push({id:ne,text:Ee,icon:Oe,index:ae,sourceLayerIndex:pe,geometry:Me.geometry,properties:ce.properties,type:Wf[ce.type],sortKey:Ge}),Oe&&(B[Oe.name]=!0),Ee){const Ae=D.evaluate(Me,{},h).join(","),Be="map"===x.get("text-rotation-alignment")&&"point"!==x.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zr.vertical)>=0;for(const Ve of Ee.sections)if(Ve.image)B[Ve.image.name]=!0;else{const He=Fs(Ee.toString()),Ke=Ve.fontStack||Ae,Le=$[Ke]=$[Ke]||{};this.calculateGlyphDependencies(Ve.text,Le,Be,this.allowVerticalPlacement,He)}}}"line"===x.get("symbol-placement")&&(this.features=function(ce){const ne={},ae={},pe=[];let he=0;function Me(Ae){pe.push(ce[Ae]),he++}function Ee(Ae,Be,Ve){const He=ae[Ae];return delete ae[Ae],ae[Be]=He,pe[He].geometry[0].pop(),pe[He].geometry[0]=pe[He].geometry[0].concat(Ve[0]),He}function Oe(Ae,Be,Ve){const He=ne[Be];return delete ne[Be],ne[Ae]=He,pe[He].geometry[0].shift(),pe[He].geometry[0]=Ve[0].concat(pe[He].geometry[0]),He}function Ge(Ae,Be,Ve){const He=Ve?Be[0][Be[0].length-1]:Be[0][0];return`${Ae}:${He.x}:${He.y}`}for(let Ae=0;Ae<ce.length;Ae++){const Be=ce[Ae],Ve=Be.geometry,He=Be.text?Be.text.toString():null;if(!He){Me(Ae);continue}const Ke=Ge(He,Ve),Le=Ge(He,Ve,!0);if(Ke in ae&&Le in ne&&ae[Ke]!==ne[Le]){const rt=Oe(Ke,Le,Ve),ft=Ee(Ke,Le,pe[rt].geometry);delete ne[Ke],delete ae[Le],ae[Ge(He,pe[ft].geometry,!0)]=ft,pe[rt].geometry=null}else Ke in ae?Ee(Ke,Le,Ve):Le in ne?Oe(Ke,Le,Ve):(Me(Ae),ne[Ke]=he-1,ae[Le]=he-1)}return pe.filter(Ae=>Ae.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ce,ne)=>ce.sortKey-ne.sortKey)}update(r,l,h,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,h,f),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,h,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ym(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const h=this.lineVertexArray.length;if(void 0!==r.segment)for(const{x:f,y:_}of l)this.lineVertexArray.emplaceBack(f,_);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,l,h,f,_,x,w,D,S,P,R,O,N,B){const $=r.indexArray,Z=r.layoutVertexArray,te=r.globeExtVertexArray,ce=r.segments.prepareSegment(4*l.length,Z,$,this.canOverlap?x.sortKey:void 0),ne=this.glyphOffsetArray.length,ae=ce.vertexLength,pe=this.allowVerticalPlacement&&w===zr.vertical?Math.PI/2:0,he=x.text&&x.text.sections;for(let Ee=0;Ee<l.length;Ee++){const{tl:Oe,tr:Ge,bl:Ae,br:Be,tex:Ve,pixelOffsetTL:He,pixelOffsetBR:Ke,minFontScaleX:Le,minFontScaleY:rt,glyphOffset:ft,isSDF:st,sectionIndex:Bt}=l[Ee],et=ce.vertexLength,Et=ft[1];if(Pu(Z,S.x,S.y,Oe.x,Et+Oe.y,Ve.x,Ve.y,h,st,He.x,He.y,Le,rt),Pu(Z,S.x,S.y,Ge.x,Et+Ge.y,Ve.x+Ve.w,Ve.y,h,st,Ke.x,He.y,Le,rt),Pu(Z,S.x,S.y,Ae.x,Et+Ae.y,Ve.x,Ve.y+Ve.h,h,st,He.x,Ke.y,Le,rt),Pu(Z,S.x,S.y,Be.x,Et+Be.y,Ve.x+Ve.w,Ve.y+Ve.h,h,st,Ke.x,Ke.y,Le,rt),D){const{x:Vt,y:Cn,z:jt}=D.anchor,[It,ti,$t]=D.up;qf(te,Vt,Cn,jt,It,ti,$t),qf(te,Vt,Cn,jt,It,ti,$t),qf(te,Vt,Cn,jt,It,ti,$t),qf(te,Vt,Cn,jt,It,ti,$t),hd(r.dynamicLayoutVertexArray,Vt,Cn,jt,pe)}else hd(r.dynamicLayoutVertexArray,S.x,S.y,S.z,pe);$.emplaceBack(et,et+1,et+2),$.emplaceBack(et+1,et+2,et+3),ce.vertexLength+=4,ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ft[0]),Ee!==l.length-1&&Bt===l[Ee+1].sectionIndex||r.programConfigurations.populatePaintArrays(Z.length,x,x.index,{},N,B,he&&he[Bt])}const Me=D?D.anchor:S;r.placedSymbolArray.emplaceBack(Me.x,Me.y,Me.z,S.x,S.y,ne,this.glyphOffsetArray.length-ne,ae,P,R,S.segment,h?h[0]:0,h?h[1]:0,f[0],f[1],w,0,!1,0,O,0)}_commitLayoutVertex(r,l,h,f,_,x,w){r.emplaceBack(l,h,f,_,x,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(r,l,h,f,_,x,w){const D=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),S=D.vertexLength,P=w.tileAnchorX,R=w.tileAnchorY;for(let N=0;N<4;N++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(l,-r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(l,r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(l,r.padding,r.padding),h.collisionVertexArrayExt.emplaceBack(l,-r.padding,r.padding),this._commitLayoutVertex(h.layoutVertexArray,f,_,x,P,R,new at(r.x1,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,f,_,x,P,R,new at(r.x2,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,f,_,x,P,R,new at(r.x2,r.y2)),this._commitLayoutVertex(h.layoutVertexArray,f,_,x,P,R,new at(r.x1,r.y2)),D.vertexLength+=4;const O=h.indexArray;O.emplaceBack(S,S+1),O.emplaceBack(S+1,S+2),O.emplaceBack(S+2,S+3),O.emplaceBack(S+3,S),D.primitiveLength+=4}_addTextDebugCollisionBoxes(r,l,h,f,_,x){for(let w=f;w<_;w++){const D=h.get(w),S=this.getSymbolInstanceTextSize(r,x,l,w);this._addCollisionDebugVertices(D,S,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(r,l,h,f,_,x){for(let w=f;w<_;w++){const D=h.get(w),S=this.getSymbolInstanceIconSize(r,l,x.placedIconSymbolIndex);this._addCollisionDebugVertices(D,S,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,x)}}generateCollisionDebugBuffers(r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vm(mt,zf.members,Si),this.iconCollisionBox=new vm(mt,zf.members,Si);const h=Tc(this.iconSizeData,r),f=Tc(this.textSizeData,r);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(f,r,l,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(f,r,l,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,r,l,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,r,l,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(r,l,h,f){const _=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),x=Nf(this.textSizeData,r,_)/er;return this.tilePixelRatio*x}getSymbolInstanceIconSize(r,l,h){const f=this.icon.placedSymbolArray.get(h),_=Nf(this.iconSizeData,r,f);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(r,l,h){r.emplaceBack(l,-h,-h),r.emplaceBack(l,h,-h),r.emplaceBack(l,h,h),r.emplaceBack(l,-h,h)}_updateTextDebugCollisionBoxes(r,l,h,f,_,x){for(let w=f;w<_;w++){const D=h.get(w),S=this.getSymbolInstanceTextSize(r,x,l,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,D.padding)}}_updateIconDebugCollisionBoxes(r,l,h,f,_,x){for(let w=f;w<_;w++){const D=h.get(w),S=this.getSymbolInstanceIconSize(r,l,x);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,D.padding)}}updateCollisionDebugBuffers(r,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Tc(this.iconSizeData,r),f=Tc(this.textSizeData,r);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(f,r,l,x.textBoxStartIndex,x.textBoxEndIndex,x),this._updateTextDebugCollisionBoxes(f,r,l,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._updateIconDebugCollisionBoxes(h,r,l,x.iconBoxStartIndex,x.iconBoxEndIndex,x.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(h,r,l,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,l,h,f,_,x,w,D,S){const P={};if(l<h){const{x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae,featureIndex:pe}=r.get(l);P.textBox={x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae},P.textFeatureIndex=pe}if(f<_){const{x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae,featureIndex:pe}=r.get(f);P.verticalTextBox={x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae},P.verticalTextFeatureIndex=pe}if(x<w){const{x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae,featureIndex:pe}=r.get(x);P.iconBox={x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae},P.iconFeatureIndex=pe}if(D<S){const{x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae,featureIndex:pe}=r.get(D);P.verticalIconBox={x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae},P.verticalIconFeatureIndex=pe}return P}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const h=r.placedSymbolArray.get(l),f=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<f;_+=4)r.indexArray.emplaceBack(_,_+1,_+2),r.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(r),h=Math.cos(r),f=[],_=[],x=[];for(let w=0;w<this.symbolInstances.length;++w){x.push(w);const D=this.symbolInstances.get(w);f.push(0|Math.round(l*D.tileAnchorX+h*D.tileAnchorY)),_.push(D.featureIndex)}return x.sort((w,D)=>f[w]-f[D]||_[D]-_[w]),x}addToSortKeyRanges(r,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:S}=h;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&_!==f&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&x!==_&&x!==f&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}pt(Za,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Za.MAX_GLYPHS=65535,Za.addDynamicAttributes=hd;const sw=new re({"symbol-placement":new U(ze.layout_symbol["symbol-placement"]),"symbol-spacing":new U(ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new U(ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Y(ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new U(ze.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new U(ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new U(ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new U(ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new U(ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new Y(ze.layout_symbol["icon-size"]),"icon-text-fit":new U(ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new U(ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new Y(ze.layout_symbol["icon-image"]),"icon-rotate":new Y(ze.layout_symbol["icon-rotate"]),"icon-padding":new U(ze.layout_symbol["icon-padding"]),"icon-keep-upright":new U(ze.layout_symbol["icon-keep-upright"]),"icon-offset":new Y(ze.layout_symbol["icon-offset"]),"icon-anchor":new Y(ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new U(ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new U(ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new U(ze.layout_symbol["text-rotation-alignment"]),"text-field":new Y(ze.layout_symbol["text-field"]),"text-font":new Y(ze.layout_symbol["text-font"]),"text-size":new Y(ze.layout_symbol["text-size"]),"text-max-width":new Y(ze.layout_symbol["text-max-width"]),"text-line-height":new Y(ze.layout_symbol["text-line-height"]),"text-letter-spacing":new Y(ze.layout_symbol["text-letter-spacing"]),"text-justify":new Y(ze.layout_symbol["text-justify"]),"text-radial-offset":new Y(ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new U(ze.layout_symbol["text-variable-anchor"]),"text-anchor":new Y(ze.layout_symbol["text-anchor"]),"text-max-angle":new U(ze.layout_symbol["text-max-angle"]),"text-writing-mode":new U(ze.layout_symbol["text-writing-mode"]),"text-rotate":new Y(ze.layout_symbol["text-rotate"]),"text-padding":new U(ze.layout_symbol["text-padding"]),"text-keep-upright":new U(ze.layout_symbol["text-keep-upright"]),"text-transform":new Y(ze.layout_symbol["text-transform"]),"text-offset":new Y(ze.layout_symbol["text-offset"]),"text-allow-overlap":new U(ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new U(ze.layout_symbol["text-ignore-placement"]),"text-optional":new U(ze.layout_symbol["text-optional"])});var M_={paint:new re({"icon-opacity":new Y(ze.paint_symbol["icon-opacity"]),"icon-color":new Y(ze.paint_symbol["icon-color"]),"icon-halo-color":new Y(ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new Y(ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Y(ze.paint_symbol["icon-halo-blur"]),"icon-translate":new U(ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new U(ze.paint_symbol["icon-translate-anchor"]),"text-opacity":new Y(ze.paint_symbol["text-opacity"]),"text-color":new Y(ze.paint_symbol["text-color"],{runtimeType:Hr,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Y(ze.paint_symbol["text-halo-color"]),"text-halo-width":new Y(ze.paint_symbol["text-halo-width"]),"text-halo-blur":new Y(ze.paint_symbol["text-halo-blur"]),"text-translate":new U(ze.paint_symbol["text-translate"]),"text-translate-anchor":new U(ze.paint_symbol["text-translate-anchor"])}),layout:sw};class I_{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:sc,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pt(I_,"FormatSectionOverride",{omit:["defaultValue"]});class xm extends ja{constructor(r){super(r,M_)}recalculate(r,l){super.recalculate(r,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const f=[];for(const _ of h)f.indexOf(_)<0&&f.push(_);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,l,h,f){const _=this.layout.get(r).evaluate(l,{},h,f),x=this._unevaluatedLayout._values[r];return x.isDataDriven()||cu(x.value)||!_?_:(w=l.properties,_.replace(/{([^{}]+)}/g,(S,P)=>P in w?String(w[P]):""));var w}createBucket(r){return new Za(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of M_.paint.overridableProperties){if(!xm.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),h=new I_(l),f=new mh(h,l.property.specification);let _=null;_="constant"===l.value.kind||"source"===l.value.kind?new qd("source",f):new gh("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[r]=new J(l.property,_,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&xm.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const h=r.get("text-field"),f=M_.paint.properties[l];let _=!1;const x=w=>{for(const D of w)if(f.overrides&&f.overrides.hasOverride(D))return void(_=!0)};if("constant"===h.value.kind&&h.value.value instanceof zi)x(h.value.value.sections);else if("source"===h.value.kind){const w=S=>{_||(S instanceof gl&&Ti(S.value)===Hn?x(S.value.sections):S instanceof _l?x(S.sections):S.eachChild(w))},D=h.value;D._styleExpression&&w(D._styleExpression.expression)}return _}getProgramConfiguration(r){return new Fl(this,r)}}var A0={paint:new re({"background-color":new U(ze.paint_background["background-color"]),"background-pattern":new U(ze.paint_background["background-pattern"]),"background-opacity":new U(ze.paint_background["background-opacity"])})},P0={paint:new re({"raster-opacity":new U(ze.paint_raster["raster-opacity"]),"raster-hue-rotate":new U(ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new U(ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new U(ze.paint_raster["raster-brightness-max"]),"raster-saturation":new U(ze.paint_raster["raster-saturation"]),"raster-contrast":new U(ze.paint_raster["raster-contrast"]),"raster-resampling":new U(ze.paint_raster["raster-resampling"]),"raster-fade-duration":new U(ze.paint_raster["raster-fade-duration"])})};class aw extends ja{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var lw={paint:new re({"sky-type":new U(ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new U(ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new U(ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new U(ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new U(ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new ie(ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new U(ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new U(ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new U(ze.paint_sky["sky-opacity"])})};function Ro(s,r,l){const h=[0,0,1],f=dv([]);return zh(f,f,l?-an(s)+Math.PI:an(s)),xu(f,f,-an(r)),Oh(h,h,f),go(h,h)}const cw={circle:class extends ja{constructor(s){super(s,Sv)}createBucket(s){return new Hp(s)}queryRadius(s){const r=s;return Ec("circle-radius",this,r)+Ec("circle-stroke-width",this,r)+wf(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,l,h,f,_,x,w){const D=Tv(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l);return Yg(s,h,_,x,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),D,S)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new Fl(this,s)}},heatmap:class extends ja{createBucket(s){return new D1(s)}constructor(s){super(s,Jg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Ec("heatmap-radius",this,s)}queryIntersectsFeature(s,r,l,h,f,_,x,w){const D=this.paint.get("heatmap-radius").evaluate(r,l);return Yg(s,h,_,x,w,!0,!0,new at(0,0),D)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new Fl(this,s)}},hillshade:class extends ja{constructor(s){super(s,Zp)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ja{constructor(s){super(s,ND)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),l=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(s){return new Fl(this,s)}recalculate(s,r){super.recalculate(s,r);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new n_(s)}queryRadius(){return wf(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,l,h,f,_){return!s.queryGeometry.isAboveHorizon&&Zg(Gp(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends ja{constructor(s){super(s,N1)}createBucket(s){return new qh(s)}queryRadius(){return wf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new Fl(this,s)}queryIntersectsFeature(s,r,l,h,f,_,x,w,D){const S=Tv(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(r,l),R=this.paint.get("fill-extrusion-base").evaluate(r,l),O=[0,0],N=w&&_.elevation,B=_.elevation?_.elevation.exaggeration():1,$=s.tile.getBucket(this);if(N&&$ instanceof qh){const ae=$.centroidVertexArray,pe=D+1;pe<ae.length&&(O[0]=ae.geta_centroid_pos0(pe),O[1]=ae.geta_centroid_pos1(pe))}if(0===O[0]&&1===O[1])return!1;"globe"===_.projection.name&&(h=Zh([h],[new at(0,0),new at(St,St)],s.tileID.canonical).map(ae=>ae.polygon).flat());const Z=N?w:null,[te,ce]=(pe=h,he=R,Me=P,Ee=S,Oe=x,Ge=Z,Ae=O,Be=B,Ve=_.center.lat,"globe"===(ae=_).projection.name?function(Ke,Le,rt,ft,st,Bt,et,Et,Vt,Cn,jt){const It=[],ti=[],$t=Ke.projection.upVectorScale(jt,Ke.center.lat,Ke.worldSize).metersToTile,Wt=[0,0,0,1],Wn=[0,0,0,1],qt=(zn,xt,di,Bi)=>{zn[0]=xt,zn[1]=di,zn[2]=Bi,zn[3]=1},ni=$v();rt>0&&(rt+=ni),ft+=ni;for(const zn of Le){const xt=[],di=[];for(const Bi of zn){const ht=Bi.x+st.x,gt=Bi.y+st.y,Zt=Ke.projection.projectTilePoint(ht,gt,jt),vi=Ke.projection.upVector(jt,Bi.x,Bi.y);let wn=rt,xi=ft;if(et){const qn=a_(ht,gt,rt,ft,et,Et,Vt,Cn);wn+=qn.base,xi+=qn.top}0!==rt?qt(Wt,Zt.x+vi[0]*$t*wn,Zt.y+vi[1]*$t*wn,Zt.z+vi[2]*$t*wn):qt(Wt,Zt.x,Zt.y,Zt.z),qt(Wn,Zt.x+vi[0]*$t*xi,Zt.y+vi[1]*$t*xi,Zt.z+vi[2]*$t*xi),yi(Wt,Wt,Bt),yi(Wn,Wn,Bt),xt.push(new Lf(Wt[0],Wt[1],Wt[2])),di.push(new Lf(Wn[0],Wn[1],Wn[2]))}It.push(xt),ti.push(di)}return[It,ti]}(ae,pe,he,Me,Ee,Oe,Ge,Ae,Be,Ve,s.tileID.canonical):Ge?function(Ke,Le,rt,ft,st,Bt,et,Et,Vt){const Cn=[],jt=[],It=[0,0,0,1];for(const ti of Ke){const $t=[],Wt=[];for(const Wn of ti){const qt=Wn.x+ft.x,ni=Wn.y+ft.y,zn=a_(qt,ni,Le,rt,Bt,et,Et,Vt);It[0]=qt,It[1]=ni,It[2]=zn.base,It[3]=1,bc(It,It,st),It[3]=Math.max(It[3],1e-5);const xt=new Lf(It[0]/It[3],It[1]/It[3],It[2]/It[3]);It[0]=qt,It[1]=ni,It[2]=zn.top,It[3]=1,bc(It,It,st),It[3]=Math.max(It[3],1e-5);const di=new Lf(It[0]/It[3],It[1]/It[3],It[2]/It[3]);$t.push(xt),Wt.push(di)}Cn.push($t),jt.push(Wt)}return[Cn,jt]}(pe,he,Me,Ee,Oe,Ge,Ae,Be,Ve):function(Ke,Le,rt,ft,st){const Bt=[],et=[],Et=st[8]*Le,Vt=st[9]*Le,Cn=st[10]*Le,jt=st[11]*Le,It=st[8]*rt,ti=st[9]*rt,$t=st[10]*rt,Wt=st[11]*rt;for(const Wn of Ke){const qt=[],ni=[];for(const zn of Wn){const xt=zn.x+ft.x,di=zn.y+ft.y,Bi=st[0]*xt+st[4]*di+st[12],ht=st[1]*xt+st[5]*di+st[13],gt=st[2]*xt+st[6]*di+st[14],Zt=st[3]*xt+st[7]*di+st[15],vi=Bi+Et,wn=ht+Vt,xi=gt+Cn,qn=Math.max(Zt+jt,1e-5),tr=Bi+It,fi=ht+ti,dr=gt+$t,Gi=Math.max(Zt+Wt,1e-5);qt.push(new Lf(vi/qn,wn/qn,xi/qn)),ni.push(new Lf(tr/Gi,fi/Gi,dr/Gi))}Bt.push(qt),et.push(ni)}return[Bt,et]}(pe,he,Me,Ee,Oe)),ne=s.queryGeometry;var ae,pe,he,Me,Ee,Oe,Ge,Ae,Be,Ve;return function(ae,pe,he){let Me=1/0;Zg(he,pe)&&(Me=Ff(he,pe[0]));for(let Ee=0;Ee<pe.length;Ee++){const Oe=pe[Ee],Ge=ae[Ee];for(let Ae=0;Ae<Oe.length-1;Ae++){const Be=Oe[Ae],Ve=[Be,Oe[Ae+1],Ge[Ae+1],Ge[Ae],Be];Eu(he,Ve)&&(Me=Math.min(Me,Ff(he,Ve)))}}return Me!==1/0&&Me}(te,ce,ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},line:class extends ja{constructor(s){super(s,cm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof tu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=Kv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Xh(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new Fl(this,s)}queryRadius(s){const r=s,l=um(Ec("line-width",this,r),Ec("line-gap-width",this,r)),h=Ec("line-offset",this,r);return l/2+Math.abs(h)+wf(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,l,h,f,_){if(s.queryGeometry.isAboveHorizon)return!1;const x=Gp(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),w=s.pixelToTileUnitsFactor/2*um(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),D=this.paint.get("line-offset").evaluate(r,l);return D&&(h=function(S,P){const R=[],O=new at(0,0);for(let N=0;N<S.length;N++){const B=S[N],$=[];for(let Z=0;Z<B.length;Z++){const te=B[Z],ce=B[Z+1],ne=0===Z?O:te.sub(B[Z-1])._unit()._perp(),ae=Z===B.length-1?O:ce.sub(te)._unit()._perp(),pe=ne._add(ae)._unit();pe._mult(1/(pe.x*ae.x+pe.y*ae.y)),$.push(pe._mult(P)._add(te))}R.push($)}return R}(h,D*s.pixelToTileUnitsFactor)),function(S,P,R){for(let O=0;O<P.length;O++){const N=P[O];if(S.length>=3)for(let B=0;B<N.length;B++)if(Du(S,N[B]))return!0;if(b1(S,N,R))return!0}return!1}(x,h,w)}isTileClipped(){return!0}},symbol:xm,background:class extends ja{constructor(s){super(s,A0)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ja{constructor(s){super(s,P0)}getProgramIds(){return["raster"]}},sky:class extends ja{constructor(s){super(s,lw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=qp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(s,r){if("atmosphere"===this.paint.get("sky-type")){const h=this.paint.get("sky-atmosphere-sun"),f=!h,_=s.style.light,x=_.properties.get("position");return f&&"viewport"===_.properties.get("anchor")&&ui("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?Ro(x.azimuthal,90-x.polar,r):Ro(h[0],90-h[1],r)}const l=this.paint.get("sky-gradient-center");return Ro(l[0],90-l[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}};class Xf{constructor(r,l,h,f){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(l,f)}update(r,l,h){const{width:f,height:_}=r,{context:x}=this,{gl:w}=x,{HTMLImageElement:D,HTMLCanvasElement:S,HTMLVideoElement:P,ImageData:R,ImageBitmap:O}=Ue;if(w.bindTexture(w.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!l||!1!==l.premultiply)),h||this.size&&this.size[0]===f&&this.size[1]===_){const{x:N,y:B}=h||{x:0,y:0};r instanceof D||r instanceof S||r instanceof P||r instanceof R||O&&r instanceof O?w.texSubImage2D(w.TEXTURE_2D,0,N,B,w.RGBA,w.UNSIGNED_BYTE,r):w.texSubImage2D(w.TEXTURE_2D,0,N,B,f,_,w.RGBA,w.UNSIGNED_BYTE,r.data)}else this.size=[f,_],r instanceof D||r instanceof S||r instanceof P||r instanceof R||O&&r instanceof O?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,r):w.texImage2D(w.TEXTURE_2D,0,this.format,f,_,0,this.format,w.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(r,l){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),r!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?r===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:r),this.filter=r),l!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class WD{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class A_{constructor(){this.tasks={},this.taskQueue=[],Yn(["process"],this),this.invoker=new WD(this.process),this.nextId=0}add(r,l){const h=this.nextId++,f=function({type:_,isSymbolTile:x,zoom:w}){return w=w||0,"message"===_?0:"maybePrepare"!==_||x?"parseTile"!==_||x?"parseTile"===_&&x?300-w:"maybePrepare"===_&&x?400-w:500:200-w:100-w}(l);if(0===f){Ta();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:r,metadata:l,priority:f,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){Ta();try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const l=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let r=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const _=this.tasks[this.taskQueue[f]];_.priority<l&&(l=_.priority,r=f)}if(null===r)return null;const h=this.taskQueue[r];return this.taskQueue.splice(r,1),h}remove(){this.invoker.remove()}}class P_{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const h=r[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const uw=["tile","layer","source","sourceLayer","state"];class k0{constructor(r,l,h,f,_){this.type="Feature",this._vectorTileFeature=r,this._z=l,this._x=h,this._y=f,this.properties=r.properties,this.id=_}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(r.id=this.id);for(const l of uw)void 0!==this[l]&&(r[l]=this[l]);return r}}const $s=32,ga=33,Pc=new Uint16Array(8184);for(let s=0;s<2046;s++){let r=s+2,l=0,h=0,f=0,_=0,x=0,w=0;for(1&r?f=_=x=$s:l=h=w=$s;(r>>=1)>1;){const S=l+f>>1,P=h+_>>1;1&r?(f=l,_=h,l=x,h=w):(l=f,h=_,f=x,_=w),x=S,w=P}const D=4*s;Pc[D+0]=l,Pc[D+1]=h,Pc[D+2]=f,Pc[D+3]=_}const Xa=new Uint16Array(2178),Ya=new Uint8Array(1089),bm=new Uint16Array(1089);function R0(s){return 0===s?-.03125:32===s?.03125:0}var O0=xe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const L0={type:2,extent:St,loadGeometry:()=>[[new at(0,0),new at(St+1,0),new at(St+1,St+1),new at(0,St+1),new at(0,0)]]};class k_{constructor(r,l,h,f,_){this.tileID=r,this.uid=oo(),this.uses=0,this.tileSize=l,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(r){const l=r+this.timeAdded;l<ss.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Au(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,h){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(f,_){const x={};if(!_)return x;for(const w of f){const D=w.layerIds.map(S=>_.getLayer(S)).filter(Boolean);if(0!==D.length){w.layers=D,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(S=>D.filter(P=>P.id===S)[0]));for(const S of D)x[S.id]=w}}return x}(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof Za){if(this.hasSymbolBuckets=!0,!h)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof Za&&_.hasRTLText){this.hasRTLText=!0,I.isLoading()||I.isLoaded()||"deferred"!==E()||M();break}}this.queryPadding=0;for(const f in this.buckets){const _=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(_))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Gn}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const h in this.buckets){const f=this.buckets[h];f.uploadPending()&&f.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Xf(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Xf(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Xf(r,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,h,f,_,x,w,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:w,transform:x,params:_,tileTransform:this.tileTransform},r,l,h):{}}querySourceFeatures(r,l){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const f=h.loadVTLayers(),_=l?l.sourceLayer:"",x=f._geojsonTileLayer||f[_];if(!x)return;const w=uu(l&&l.filter),{z:D,x:S,y:P}=this.tileID.canonical,R={z:D,x:S,y:P};for(let O=0;O<x.length;O++){const N=x.feature(O);if(w.needGeometry){const Z=Cu(N,!0);if(!w.filter(new k(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!w.filter(new k(this.tileID.overscaledZ),N))continue;const B=h.getId(N,_),$=new k0(N,D,S,P,B);$.tile=R,r.push($)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const h=No(r.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const h=Date.now();let f=!1;if(this.expirationTime>h)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const _=this.expirationTime-l;_?this.expirationTime=h+Math.max(_,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!l)return;const h=this.latestFeatureIndex.loadVTLayers(),f=l.style.listImages();for(const _ in this.buckets){if(!l.style.hasLayer(_))continue;const x=this.buckets[_],w=x.layers[0].sourceLayer||"_geojsonTileLayer",D=h[w],S=r[w];if(!D||!S||0===Object.keys(S).length)continue;if(x.update(S,D,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),x instanceof Xh||x instanceof n_){const R=l.style._getSourceCache(x.layers[0].source);l._terrain&&l._terrain.enabled&&R&&x.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(R.id,this.tileID)}const P=l&&l.style&&l.style.getLayer(_);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(x)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ss.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=ss.now()+r}setTexture(r,l){const h=l.context,f=h.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new Xf(h,r,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(r,l){const h={};for(const f of l)h[f]=!0;this.dependencies[r]=h}hasDependency(r,l){for(const h of r){const f=this.dependencies[h];if(f)for(const _ of l)if(f[_])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const h=Bl(L0,this.tileID.canonical,this.tileTransform)[0],f=new Xe,_=new To;for(let x=0;x<h.length;x++){const{x:w,y:D}=h[x];f.emplaceBack(w,D),_.emplaceBack(x)}_.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(_),this._tileDebugBuffer=r.createVertexBuffer(f,Vp.members),this._tileDebugSegments=$i.simpleSegment(0,0,f.length,_.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const h=Bl(L0,this.tileID.canonical,this.tileTransform)[0];let f,_;if(this.isRaster){const x=function(w,D){const S=Au(w,D),P=Math.pow(2,w.z);for(let Z=0;Z<ga;Z++)for(let te=0;te<ga;te++){const ce=Xo((w.x+(te+R0(te))/$s)/P),ne=Lr((w.y+(Z+R0(Z))/$s)/P),ae=D.project(ce,ne),pe=Z*ga+te;Xa[2*pe+0]=Math.round((ae.x*S.scale-S.x)*St),Xa[2*pe+1]=Math.round((ae.y*S.scale-S.y)*St)}Ya.fill(0),bm.fill(0);for(let Z=2045;Z>=0;Z--){const te=4*Z,ce=Pc[te+0],ne=Pc[te+1],ae=Pc[te+2],pe=Pc[te+3],he=ce+ae>>1,Me=ne+pe>>1,Ee=he+Me-ne,Oe=Me+ce-he,Ge=ne*ga+ce,Ae=pe*ga+ae,Be=Me*ga+he,Ve=Math.hypot((Xa[2*Ge+0]+Xa[2*Ae+0])/2-Xa[2*Be+0],(Xa[2*Ge+1]+Xa[2*Ae+1])/2-Xa[2*Be+1])>=16;Ya[Be]=Ya[Be]||(Ve?1:0),Z<1022&&(Ya[Be]=Ya[Be]||Ya[(ne+Oe>>1)*ga+(ce+Ee>>1)]||Ya[(pe+Oe>>1)*ga+(ae+Ee>>1)])}const R=new je,O=new vt;let N=0;function B(Z,te){const ce=te*ga+Z;return 0===bm[ce]&&(R.emplaceBack(Xa[2*ce+0],Xa[2*ce+1],Z*St/$s,te*St/$s),bm[ce]=++N),bm[ce]-1}function $(Z,te,ce,ne,ae,pe){const he=Z+ce>>1,Me=te+ne>>1;if(Math.abs(Z-ae)+Math.abs(te-pe)>1&&Ya[Me*ga+he])$(ae,pe,Z,te,he,Me),$(ce,ne,ae,pe,he,Me);else{const Ee=B(Z,te),Oe=B(ce,ne),Ge=B(ae,pe);O.emplaceBack(Ee,Oe,Ge)}}return $(0,0,$s,$s,$s,0),$($s,$s,0,0,0,$s),{vertices:R,indices:O}}(this.tileID.canonical,l);f=x.vertices,_=x.indices}else{f=new je,_=new vt;for(const{x:w,y:D}of h)f.emplaceBack(w,D,0,0);const x=e_(f.int16,void 0,4);for(let w=0;w<x.length;w+=3)_.emplaceBack(x[w],x[w+1],x[w+2])}this._tileBoundsBuffer=r.createVertexBuffer(f,O0.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(_),this._tileBoundsSegments=$i.simpleSegment(0,0,f.length,_.length)}_makeGlobeTileDebugBuffers(r,l){const h=l.projection;if(!h||"globe"!==h.name||l.freezeTileCoverage)return;const f=this.tileID.canonical,_=gf(_1(f,l)),x=Cc(l.zoom);let w;x>0&&(w=kg(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,f,l,_,w,x),this._makeGlobeTileDebugTextBuffer(r,f,l,_,w,x)}_globePoint(r,l,h,f,_,x,w){let D=Bh(r,l,h);if(x){const S=1<<h.z,P=Ci(f.center.lng),R=Zo(f.center.lat),O=(h.x+.5)/S-P;let N=0;O>.5?N=-1:O<-.5&&(N=1);let B=(r/St+h.x)/S+N,$=(l/St+h.y)/S;B=(B-P)*f._pixelsPerMercatorPixel+P,$=($-R)*f._pixelsPerMercatorPixel+R;const Z=[B*f.worldSize,$*f.worldSize,0];yi(Z,Z,x),D=Nh(D,Z,w)}return yi(D,D,_)}_makeGlobeTileDebugBorderBuffer(r,l,h,f,_,x){const w=new Xe,D=new To,S=new Te,P=(O,N,B,$,Z)=>{const te=(B-O)/(Z-1),ce=($-N)/(Z-1),ne=w.length;for(let ae=0;ae<Z;ae++){const pe=O+ae*te,he=N+ae*ce;w.emplaceBack(pe,he);const Me=this._globePoint(pe,he,l,h,f,_,x);S.emplaceBack(Me[0],Me[1],Me[2]),D.emplaceBack(ne+ae)}},R=St;P(0,0,R,0,16),P(R,0,R,R,16),P(R,R,0,R,16),P(0,R,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(D),this._tileDebugBuffer=r.createVertexBuffer(w,Vp.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(S,fv.members),this._tileDebugSegments=$i.simpleSegment(0,0,w.length,D.length)}_makeGlobeTileDebugTextBuffer(r,l,h,f,_,x){const w=St/4,D=new Xe,S=new vt,P=new Te,R=25;S.reserve(32),D.reserve(R),P.reserve(R);const O=(N,B)=>R*N+B;for(let N=0;N<R;N++){const B=N*w;for(let $=0;$<R;$++){const Z=$*w;D.emplaceBack(Z,B);const te=this._globePoint(Z,B,l,h,f,_,x);P.emplaceBack(te[0],te[1],te[2])}}for(let N=0;N<4;N++)for(let B=0;B<4;B++){const $=O(N,B),Z=O(N,B+1),te=O(N+1,B),ce=O(N+1,B+1);S.emplaceBack($,Z,te),S.emplaceBack(te,Z,ce)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(S),this._tileDebugTextBuffer=r.createVertexBuffer(D,Vp.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(P,fv.members),this._tileDebugTextSegments=$i.simpleSegment(0,0,R,32)}}class Ka{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,h){const f=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][f]=this.stateChanges[r][f]||{},ki(this.stateChanges[r][f],h),null===this.deletedStates[r]){this.deletedStates[r]={};for(const _ in this.state[r])_!==f&&(this.deletedStates[r][_]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][f]){this.deletedStates[r][f]={};for(const _ in this.state[r][f])h[_]||(this.deletedStates[r][f][_]=null)}else for(const _ in h)this.deletedStates[r]&&this.deletedStates[r][f]&&null===this.deletedStates[r][f][_]&&delete this.deletedStates[r][f][_]}removeFeatureState(r,l,h){if(null===this.deletedStates[r])return;const f=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},h&&void 0!==l)null!==this.deletedStates[r][f]&&(this.deletedStates[r][f]=this.deletedStates[r][f]||{},this.deletedStates[r][f][h]=null);else if(void 0!==l)if(this.stateChanges[r]&&this.stateChanges[r][f])for(h in this.deletedStates[r][f]={},this.stateChanges[r][f])this.deletedStates[r][f][h]=null;else this.deletedStates[r][f]=null;else this.deletedStates[r]=null}getState(r,l){const h=String(l),f=ki({},(this.state[r]||{})[h],(this.stateChanges[r]||{})[h]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const _=this.deletedStates[r][l];if(null===_)return{};for(const x in _)delete f[x]}return f}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const h={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const _={};for(const x in this.stateChanges[f])this.state[f][x]||(this.state[f][x]={}),ki(this.state[f][x],this.stateChanges[f][x]),_[x]=this.state[f][x];h[f]=_}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const _={};if(null===this.deletedStates[f])for(const x in this.state[f])_[x]={},this.state[f][x]={};else for(const x in this.deletedStates[f]){if(null===this.deletedStates[f][x])this.state[f][x]={};else if(this.state[f][x])for(const w of Object.keys(this.deletedStates[f][x]))delete this.state[f][x][w];_[x]=this.state[f][x]}h[f]=h[f]||{},ki(h[f],_)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(h).length)for(const f in r)r[f].setFeatureState(h,l)}}class wm{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,l){const h=this.toIdx(r,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(r,l){return this.leaves[this.toIdx(r,l)]}toIdx(r,l){return l*this.size+r}}function F0(s,r,l,h){let f=0,_=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(h[x])<1e-15){if(l[x]<s[x]||l[x]>r[x])return null}else{const w=1/h[x];let D=(s[x]-l[x])*w,S=(r[x]-l[x])*w;if(D>S){const P=D;D=S,S=P}if(D>f&&(f=D),S<_&&(_=S),f>_)return null}return f}function z0(s,r,l,h,f,_,x,w,D,S,P){const R=h-s,O=f-r,N=_-l,B=x-s,$=w-r,Z=D-l,te=P[1]*Z-P[2]*$,ce=P[2]*B-P[0]*Z,ne=P[0]*$-P[1]*B,ae=R*te+O*ce+N*ne;if(Math.abs(ae)<1e-15)return null;const pe=1/ae,he=S[0]-s,Me=S[1]-r,Ee=S[2]-l,Oe=(he*te+Me*ce+Ee*ne)*pe;if(Oe<0||Oe>1)return null;const Ge=Me*N-Ee*O,Ae=Ee*R-he*N,Be=he*O-Me*R,Ve=(P[0]*Ge+P[1]*Ae+P[2]*Be)*pe;return Ve<0||Oe+Ve>1?null:(B*Ge+$*Ae+Z*Be)*pe}function R_(s,r,l){return(s-r)/(l-r)}function N0(s,r,l,h,f,_,x,w,D){const S=1<<l,P=_-h,R=x-f,O=(s+1)/S*P+h,N=(r+0)/S*R+f,B=(r+1)/S*R+f;w[0]=(s+0)/S*P+h,w[1]=N,D[0]=O,D[1]=B}class B0{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(_){const x=Math.ceil(Math.log2(_.dim/8)),w=[];let D=Math.ceil(Math.pow(2,x));const S=1/D,P=(N,B,$,Z,te)=>{const ce=Z?1:0,ne=(N+1)*$-ce,ae=B*$,pe=(B+1)*$-ce;te[0]=N*$,te[1]=ae,te[2]=ne,te[3]=pe};let R=new wm(D);const O=[];for(let N=0;N<D*D;N++){P(N%D,Math.floor(N/D),S,!1,O);const B=Ja(O[0],O[1],_),$=Ja(O[2],O[1],_),Z=Ja(O[2],O[3],_),te=Ja(O[0],O[3],_);R.minimums.push(Math.min(B,$,Z,te)),R.maximums.push(Math.max(B,$,Z,te)),R.leaves.push(1)}for(w.push(R),D/=2;D>=1;D/=2){const N=w[w.length-1];R=new wm(D);for(let B=0;B<D*D;B++){P(B%D,Math.floor(B/D),2,!0,O);const $=N.getElevation(O[0],O[1]),Z=N.getElevation(O[2],O[1]),te=N.getElevation(O[2],O[3]),ce=N.getElevation(O[0],O[3]),ne=N.isLeaf(O[0],O[1]),ae=N.isLeaf(O[2],O[1]),pe=N.isLeaf(O[2],O[3]),he=N.isLeaf(O[0],O[3]),Me=Math.min($.min,Z.min,te.min,ce.min),Ee=Math.max($.max,Z.max,te.max,ce.max),Oe=ne&&ae&&pe&&he;R.maximums.push(Ee),R.minimums.push(Me),R.leaves.push(Ee-Me<=5&&Oe?1:0)}w.push(R)}return w}(this.dem),h=l.length-1,f=l[h];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(r,l,h,f,_,x,w=1){return F0([r,l,-100],[h,f,this.maximums[0]*w],_,x)}raycast(r,l,h,f,_,x,w=1){if(!this.nodeCount)return null;const D=this.raycastRoot(r,l,h,f,_,x,w);if(null==D)return null;const S=[],P=[],R=[],O=[],N=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:B,t:$,nodex:Z,nodey:te,depth:ce}=N.pop();if(this.leaves[B]){N0(Z,te,ce,r,l,h,f,R,O);const ae=1<<ce,pe=(Z+0)/ae,he=(Z+1)/ae,Me=(te+0)/ae,Ee=(te+1)/ae,Oe=Ja(pe,Me,this.dem)*w,Ge=Ja(he,Me,this.dem)*w,Ae=Ja(he,Ee,this.dem)*w,Be=Ja(pe,Ee,this.dem)*w,Ve=z0(R[0],R[1],Oe,O[0],R[1],Ge,O[0],O[1],Ae,_,x),He=z0(O[0],O[1],Ae,R[0],O[1],Be,R[0],R[1],Oe,_,x),Ke=Math.min(null!==Ve?Ve:Number.MAX_VALUE,null!==He?He:Number.MAX_VALUE);if(Ke!==Number.MAX_VALUE)return Ke;{const Le=df([],_,x,$);if(V0(Oe,Ge,Be,Ae,R_(Le[0],R[0],O[0]),R_(Le[1],R[1],O[1]))>=Le[2])return $}continue}let ne=0;for(let ae=0;ae<this._siblingOffset.length;ae++){N0((Z<<1)+this._siblingOffset[ae][0],(te<<1)+this._siblingOffset[ae][1],ce+1,r,l,h,f,R,O),R[2]=-100,O[2]=this.maximums[this.childOffsets[B]+ae]*w;const pe=F0(R,O,_,x);if(null!=pe){const he=pe;S[ae]=he;let Me=!1;for(let Ee=0;Ee<ne&&!Me;Ee++)he>=S[P[Ee]]&&(P.splice(Ee,0,ae),Me=!0);Me||(P[ne]=ae),ne++}}for(let ae=0;ae<ne;ae++){const pe=P[ae];N.push({idx:this.childOffsets[B]+pe,t:S[pe],nodex:(Z<<1)+this._siblingOffset[pe][0],nodey:(te<<1)+this._siblingOffset[pe][1],depth:ce+1})}}return null}_addNode(r,l,h){return this.minimums.push(r),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(r,l,h,f,_){if(1===r[f].isLeaf(l,h))return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const x=f-1,w=r[x];let D=0,S=0;for(let P=0;P<this._siblingOffset.length;P++){const R=2*l+this._siblingOffset[P][0],O=2*h+this._siblingOffset[P][1],N=w.getElevation(R,O),B=w.isLeaf(R,O),$=this._addNode(N.min,N.max,B);B&&(D|=1<<P),S||(S=$)}for(let P=0;P<this._siblingOffset.length;P++)D&1<<P||this._construct(r,2*l+this._siblingOffset[P][0],2*h+this._siblingOffset[P][1],x,S+P)}}function V0(s,r,l,h,f,_){return mn(mn(s,l,_),mn(r,h,_),f)}function Ja(s,r,l){const h=l.dim,f=hn(s*h-.5,0,h-1),_=hn(r*h-.5,0,h-1),x=Math.floor(f),w=Math.floor(_),D=Math.min(x+1,h-1),S=Math.min(w+1,h-1);return V0(l.get(x,w),l.get(D,w),l.get(x,S),l.get(D,S),f-x,_-w)}const j0={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function hw(s,r,l){return(256*s*256+256*r+l)/10-1e4}function Cm(s,r,l){return 256*s+r+l/256-32768}class ku{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,l,h,f=!1,_=!1){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&"mapbox"!==h&&"terrarium"!==h)return ui(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const x=this.dim=l.height-2,w=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=h||"mapbox",this.borderReady=f,!f){for(let D=0;D<x;D++)w[this._idx(-1,D)]=w[this._idx(0,D)],w[this._idx(x,D)]=w[this._idx(x-1,D)],w[this._idx(D,-1)]=w[this._idx(D,0)],w[this._idx(D,x)]=w[this._idx(D,x-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(x,-1)]=w[this._idx(x-1,0)],w[this._idx(-1,x)]=w[this._idx(0,x-1)],w[this._idx(x,x)]=w[this._idx(x-1,x-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new B0(this)}get(r,l,h=!1){h&&(r=hn(r,-1,this.dim),l=hn(l,-1,this.dim));const f=4*this._idx(r,l);return("terrarium"===this.encoding?Cm:hw)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(r){return j0[r]}get unpackVector(){return j0[this.encoding]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}static pack(r,l){const h=[0,0,0,0],f=ku.getUnpackVector(l);let _=Math.floor((r+f[3])/f[2]);return h[2]=_%256,_=Math.floor(_/256),h[1]=_%256,_=Math.floor(_/256),h[0]=_,h}getPixels(){return new Ao({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,l,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,_=l*this.dim+this.dim,x=h*this.dim,w=h*this.dim+this.dim;switch(l){case-1:f=_-1;break;case 1:_=f+1}switch(h){case-1:x=w-1;break;case 1:w=x+1}const D=-l*this.dim,S=-h*this.dim;for(let P=x;P<w;P++)for(let R=f;R<_;R++){const O=4*this._idx(R,P),N=4*this._idx(R+D,P+S);this.pixels[O+0]=r.pixels[N+0],this.pixels[O+1]=r.pixels[N+1],this.pixels[O+2]=r.pixels[N+2],this.pixels[O+3]=r.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}pt(ku,"DEMData"),pt(B0,"DemMinMaxQuadTree",{omit:["dem"]});class Em{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,h){const f=r.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const _={value:l,timeout:void 0};if(void 0!==h&&(_.timeout=setTimeout(()=>{this.remove(r,_)},h)),this.data[f].push(_),this.order.push(f),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const h=r.wrapped().key,f=void 0===l?0:this.data[h].indexOf(l),_=this.data[h][f];return this.data[h].splice(f,1),_.timeout&&clearTimeout(_.timeout),0===this.data[h].length&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const h in this.data)for(const f of this.data[h])r(f.value)||l.push(f);for(const h of l)this.remove(h.value.tileID,h)}}class Yf{constructor(r,l,h){this.func=r,this.mask=l,this.range=h}}Yf.ReadOnly=!1,Yf.ReadWrite=!0,Yf.disabled=new Yf(519,Yf.ReadOnly,[0,1]);class U0{constructor(r,l,h,f,_,x){this.test=r,this.ref=l,this.mask=h,this.fail=f,this.depthFail=_,this.pass=x}}U0.disabled=new U0({func:519,mask:0},0,0,7680,7680,7680);class _a{constructor(r,l,h){this.blendFunction=r,this.blendColor=l,this.mask=h}}_a.Replace=[1,0],_a.disabled=new _a(_a.Replace,Fi.transparent,[!1,!1,!1,!1]),_a.unblended=new _a(_a.Replace,Fi.transparent,[!0,!0,!0,!0]),_a.alphaBlended=new _a([1,771],Fi.transparent,[!0,!0,!0,!0]);class Hs{constructor(r,l,h){this.enable=r,this.mode=l,this.frontFace=h}}Hs.disabled=new Hs(!1,1029,2305),Hs.backCCW=new Hs(!0,1029,2305),Hs.backCW=new Hs(!0,1029,2304),Hs.frontCW=new Hs(!0,1028,2304),Hs.frontCCW=new Hs(!0,1028,2305);class Ul extends oc{constructor(r,l,h){super(),this.id=r,this._onlySymbols=h,l.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new Em(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ka,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(r){this.map=r,this._minTileCacheSize=void 0===this._minTileCacheSize&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const l=this._tiles[r];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const h=this._tiles[l];h.upload(r),h.prepare(this.map.style.imageManager)}}getIds(){return Ca(this._tiles).map(r=>r.tileID).sort(Qa).map(r=>r.key)}getRenderableIds(r){const l=[];for(const h in this._tiles)this._isIdRenderable(+h,r)&&l.push(this._tiles[h]);return r?l.sort((h,f)=>{const _=h.tileID,x=f.tileID,w=new at(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),D=new at(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-x.overscaledZ||D.y-w.y||D.x-w.x}).map(h=>h.tileID.key):l.map(h=>h.tileID).sort(Qa).map(h=>h.key)}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const h=this._tiles[r];h&&("loading"!==h.state&&(h.state=l),this._loadTile(h,this._tileLoaded.bind(this,h,r,l)))}_tileLoaded(r,l,h,f){if(f)if(r.state="errored",404!==f.status)this._source.fire(new Ms(f,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=ss.now(),"expired"===h&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new ml("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const _=l[f];if(r.neighboringTiles&&r.neighboringTiles[_]){const x=this.getTileByID(_);h(r,x),h(x,r)}}function h(f,_){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let x=_.tileID.canonical.x-f.tileID.canonical.x;const w=_.tileID.canonical.y-f.tileID.canonical.y,D=Math.pow(2,f.tileID.canonical.z),S=_.tileID.key;0===x&&0===w||Math.abs(w)>1||(Math.abs(x)>1&&(1===Math.abs(x+D)?x+=D:1===Math.abs(x-D)&&(x-=D)),_.dem&&f.dem&&(f.dem.backfillBorder(_.dem,x,w),f.neighboringTiles&&f.neighboringTiles[S]&&(f.neighboringTiles[S].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,h,f){for(const _ in this._tiles){let x=this._tiles[_];if(f[_]||!x.hasData()||x.tileID.overscaledZ<=l||x.tileID.overscaledZ>h)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>l+1;){const S=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[S.key],x&&x.hasData()&&(w=S)}let D=w;for(;D.overscaledZ>l;)if(D=D.scaledTo(D.overscaledZ-1),r[D.key]){f[w.key]=w;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const h=this._loadedParentTiles[r.key];return h&&h.tileID.overscaledZ>=l?h:null}for(let h=r.overscaledZ-1;h>=l;h--){const f=r.scaledTo(h),_=this._getLoadedTile(f);if(_)return _}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const h=Math.ceil(r.width/l)+1,f=Math.ceil(r.height/l)+1,_=Math.floor(h*f*5),x="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,_):_,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(w)}handleWrapJump(r){const l=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,l){const h={};for(const f in this._tiles){const _=this._tiles[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+l),h[_.tileID.key]=_}this._tiles=h;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(r,l,h){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let f;this.updateCacheSize(r,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new Jr(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(f=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(w=>this._source.hasTile(w)))):f=[];const _=this._updateRetainedTiles(f);if(Jf(this._source.type)&&0!==f.length){const w={},D={},S=Object.keys(_);for(const R of S){const O=_[R],N=this._tiles[R];if(!N||N.fadeEndTime&&N.fadeEndTime<=ss.now())continue;const B=this.findLoadedParent(O,Math.max(O.overscaledZ-Ul.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),w[B.tileID.key]=B.tileID),D[R]=O}const P=f[f.length-1].overscaledZ;for(const R in this._tiles){const O=this._tiles[R];if(_[R]||!O.hasData())continue;let N=O.tileID;for(;N.overscaledZ>P;){N=N.scaledTo(N.overscaledZ-1);const B=this._tiles[N.key];if(B&&B.hasData()&&D[N.key]){_[R]=O.tileID;break}}}for(const R in w)_[R]||(this._coveredTiles[R]=!0,_[R]=w[R])}for(const w in _)this._tiles[w].clearFadeHold();const x=function(w,D){const S=[];for(const P in w)P in D||S.push(P);return S}(this._tiles,_);for(const w of x){const D=this._tiles[w];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(0===r.length)return l;const h={},f=r.reduce((S,P)=>Math.min(S,P.overscaledZ),1/0),_=r[0].overscaledZ,x=Math.max(_-Ul.maxOverzooming,this._source.minzoom),w=Math.max(_+Ul.maxUnderzooming,this._source.minzoom),D={};for(const S of r){const P=this._addTile(S);l[S.key]=S,P.hasData()||f<this._source.maxzoom&&(D[S.key]=S)}this._retainLoadedChildren(D,f,w,l);for(const S of r){let P=this._tiles[S.key];if(P.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const O=S.children(this._source.maxzoom)[0],N=this.getTile(O);if(N&&N.hasData()){l[O.key]=O;continue}}else{const O=S.children(this._source.maxzoom);if(l[O[0].key]&&l[O[1].key]&&l[O[2].key]&&l[O[3].key])continue}let R=P.wasRequested();for(let O=S.overscaledZ-1;O>=x;--O){const N=S.scaledTo(O);if(h[N.key]||(h[N.key]=!0,P=this.getTile(N),!P&&R&&(P=this._addTile(N)),P&&(l[N.key]=N,R=P.wasRequested(),P.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let h,f=this._tiles[r].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){h=this._loadedParentTiles[f.key];break}l.push(f.key);const _=f.scaledTo(f.overscaledZ-1);if(h=this._getLoadedTile(_),h)break;f=_}for(const _ of l)this._loadedParentTiles[_]=h}}_addTile(r){let l=this._tiles[r.key];if(l)return l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const h=Boolean(l);if(!h){const f=this.map?this.map.painter:null;l=new k_(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l?(l.uses++,this._tiles[r.key]=l,h||this._source.fire(new ml("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const h=l.getExpiryTimeout();h&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},h))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,l,h){const f=[],_=this.transform;if(!_)return f;const x="globe"===_.projection.name,w=Ci(_.center.lng);for(const D in this._tiles){const S=this._tiles[D];if(h&&S.clearQueryDebugViz(),S.holdingForFade())continue;let P;if(x){const R=S.tileID.canonical;if(0===R.z){const O=[Math.abs(hn(w,...kc(R,-1))-w),Math.abs(hn(w,...kc(R,1))-w)];P=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(hn(w,...kc(R,-1))-w),Math.abs(hn(w,...kc(R,0))-w),Math.abs(hn(w,...kc(R,1))-w)];P=[O.indexOf(Math.min(...O))-1]}}else P=[0];for(const R of P){const O=r.containsTile(S,_,l,R);O&&f.push(O)}}return f}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map(h=>this._tiles[h].tileID);for(const h of l)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(Jf(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=ss.now())return!0}return!1}setFeatureState(r,l,h){this._state.updateState(r=r||"_geojsonTileLayer",l,h)}removeFeatureState(r,l,h){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,h)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,h){const f=this._tiles[r];f&&f.setDependencies(l,h)}reloadTilesForDependencies(r,l){for(const h in this._tiles)this._tiles[h].hasDependency(r,l)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(r,l))}_preloadTiles(r,l){if(!this._sourceLoaded){const w=()=>{this._sourceLoaded&&(this._source.off("data",w),this._preloadTiles(r,l))};return void this._source.on("data",w)}const h=new Map,f=Array.isArray(r)?r:[r],_=this.map.painter.terrain,x=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const w of f){const D=w.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of D)h.set(S.key,S);this.usedForTerrain&&w.updateElevation(!1)}Xi(Array.from(h.values()),(w,D)=>{const S=new k_(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,P=>{"raster-dem"===this._source.type&&S.dem&&this._backfillDEM(S),D(P,S)})},l)}}function Qa(s,r){const l=Math.abs(2*s.wrap)-+(s.wrap<0),h=Math.abs(2*r.wrap)-+(r.wrap<0);return s.overscaledZ-r.overscaledZ||h-l||r.canonical.y-s.canonical.y||r.canonical.x-s.canonical.x}function Jf(s){return"raster"===s||"image"===s||"video"===s||"custom"===s}function kc(s,r){const l=1<<s.z;return[s.x/l+r,(s.x+1)/l+r]}Ul.maxOverzooming=10,Ul.maxUnderzooming=3;class Rc{constructor(r,l,h){this._demTile=r,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(r,l,h){const f=h||r.findDEMTileFor(l);if(!f||!f.dem)return;const _=f.dem,x=f.tileID,w=1<<l.canonical.z-x.canonical.z;return new Rc(f,f.tileSize/St/w,[(l.canonical.x/w-x.canonical.x)*_.dim,(l.canonical.y/w-x.canonical.y)*_.dim])}tileCoordToPixel(r,l){const h=l*this._scale+this._offset[1],f=Math.floor(r*this._scale+this._offset[0]),_=Math.floor(h);return new at(f,_)}getElevationAt(r,l,h,f){const _=r*this._scale+this._offset[0],x=l*this._scale+this._offset[1],w=Math.floor(_),D=Math.floor(x),S=this._dem;return f=!!f,h?mn(mn(S.get(w,D,f),S.get(w,D+1,f),x-D),mn(S.get(w+1,D,f),S.get(w+1,D+1,f),x-D),_-w):S.get(w,D,f)}getElevationAtPixel(r,l,h){return this._dem.get(r,l,!!h)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Vs(1,r)*this._dem.stride}}class $0{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Al(St,16,0),this.featureIndexArray=new po,this.promoteId=l}insert(r,l,h,f,_,x=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,f,_,x);const D=this.grid;for(let S=0;S<l.length;S++){const P=l[S],R=[1/0,1/0,-1/0,-1/0];for(let O=0;O<P.length;O++){const N=P[O];R[0]=Math.min(R[0],N.x),R[1]=Math.min(R[1],N.y),R[2]=Math.max(R[2],N.x),R[3]=Math.max(R[3],N.y)}R[0]<St&&R[1]<St&&R[2]>=0&&R[3]>=0&&D.insert(w,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Pf(new mm(this.rawTileData)).layers,this.sourceLayerCoder=new P_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,l,h,f){this.loadVTLayers();const _=r.params||{},x=uu(_.filter),w=r.tileResult,D=r.transform,S=w.bufferedTilespaceBounds,P=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(B,$,Z,te)=>Ev(w.bufferedTilespaceGeometry,B,$,Z,te));P.sort(H0);let R=null;D.elevation&&P.length>0&&(R=Rc.create(D.elevation,this.tileID));const O={};let N;for(let B=0;B<P.length;B++){const $=P[B];if($===N)continue;N=$;const Z=this.featureIndexArray.get($);let te=null;this.loadMatchingFeature(O,Z,x,_.layers,_.availableImages,l,h,f,(ce,ne,ae,pe=0)=>(te||(te=Bl(ce,this.tileID.canonical,r.tileTransform)),ne.queryIntersectsFeature(w,ce,ae,te,this.z,r.transform,r.pixelPosMatrix,R,pe)))}return O}loadMatchingFeature(r,l,h,f,_,x,w,D,S){const{featureIndex:P,bucketIndex:R,sourceLayerIndex:O,layoutVertexArrayOffset:N}=l,B=this.bucketLayerIDs[R];if(f&&!function(ce,ne){for(let ae=0;ae<ce.length;ae++)if(ne.indexOf(ce[ae])>=0)return!0;return!1}(f,B))return;const $=this.sourceLayerCoder.decode(O),Z=this.vtLayers[$].feature(P);if(h.needGeometry){const ce=Cu(Z,!0);if(!h.filter(new k(this.tileID.overscaledZ),ce,this.tileID.canonical))return}else if(!h.filter(new k(this.tileID.overscaledZ),Z))return;const te=this.getId(Z,$);for(let ce=0;ce<B.length;ce++){const ne=B[ce];if(f&&f.indexOf(ne)<0)continue;const ae=x[ne];if(!ae)continue;let pe={};void 0!==te&&D&&(pe=D.getState(ae.sourceLayer||"_geojsonTileLayer",te));const he=ki({},w[ne]);he.paint=O_(he.paint,ae.paint,Z,pe,_),he.layout=O_(he.layout,ae.layout,Z,pe,_);const Me=!S||S(Z,ae,pe,N);if(!Me)continue;const Ee=new k0(Z,this.z,this.x,this.y,te);Ee.layer=he;let Oe=r[ne];void 0===Oe&&(Oe=r[ne]=[]),Oe.push({featureIndex:P,feature:Ee,intersectionZ:Me})}}lookupSymbolFeatures(r,l,h,f,_,x,w,D){const S={};this.loadVTLayers();const P=uu(_);for(const R of r)this.loadMatchingFeature(S,{bucketIndex:h,sourceLayerIndex:f,featureIndex:R,layoutVertexArrayOffset:0},P,x,w,D,l);return S}loadFeature(r){const{featureIndex:l,sourceLayerIndex:h}=r;this.loadVTLayers();const f=this.sourceLayerCoder.decode(h),_=this.vtFeatures[f];if(_[l])return _[l];const x=this.vtLayers[f].feature(l);return _[l]=x,x}hasLayer(r){for(const l of this.bucketLayerIDs)for(const h of l)if(r===h)return!0;return!1}getId(r,l){let h=r.id;if(this.promoteId){const f="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=f&&(h=r.properties[f]),"boolean"==typeof h&&(h=Number(h))}return h}}function O_(s,r,l,h,f){return dt(s,(_,x)=>{const w=r instanceof ee?r.get(x):null;return w&&w.evaluate?w.evaluate(l,h,f):w})}function H0(s,r){return r-s}pt($0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class G0{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.image=new $a({width:r,height:l}),this.positions={},this.uploaded=!1}getDash(r,l){const h=this.getKey(r,l);return this.positions[h]}trim(){const r=this.width,l=this.height=Ts(this.nextRow);this.image.resize({width:r,height:l})}getKey(r,l){return r.join(",")+l}getDashRanges(r,l,h){const f=[];let _=r.length%2==1?-r[r.length-1]*h:0,x=r[0]*h,w=!0;f.push({left:_,right:x,isDash:w,zeroLength:0===r[0]});let D=r[0];for(let S=1;S<r.length;S++){w=!w;const P=r[S];_=D*h,D+=P,x=D*h,f.push({left:_,right:x,isDash:w,zeroLength:0===P})}return f}addRoundDash(r,l,h){const f=l/2;for(let _=-h;_<=h;_++){const x=this.width*(this.nextRow+h+_);let w=0,D=r[w];for(let S=0;S<this.width;S++){S/D.right>1&&(D=r[++w]);const P=Math.abs(S-D.left),R=Math.abs(S-D.right),O=Math.min(P,R);let N;const B=_/h*(f+1);if(D.isDash){const $=f-Math.abs(B);N=Math.sqrt(O*O+$*$)}else N=f-Math.sqrt(O*O+B*B);this.image.data[x+S]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(r,l){for(let D=r.length-1;D>=0;--D){const S=r[D],P=r[D+1];S.zeroLength?r.splice(D,1):P&&P.isDash===S.isDash&&(P.left=S.left,r.splice(D,1))}const h=r[0],f=r[r.length-1];h.isDash===f.isDash&&(h.left=f.left-this.width,f.right=h.right+this.width);const _=this.width*this.nextRow;let x=0,w=r[x];for(let D=0;D<this.width;D++){D/w.right>1&&(w=r[++x]);const S=Math.abs(D-w.left),P=Math.abs(D-w.right),R=Math.min(S,P);this.image.data[_+D]=Math.max(0,Math.min(255,(w.isDash?R:-R)+l+128))}}addDash(r,l){const h=this.getKey(r,l);if(this.positions[h])return this.positions[h];const f="round"===l,_=f?7:0,x=2*_+1;if(this.nextRow+x>this.height)return ui("LineAtlas out of space"),null;0===r.length&&r.push(1);let w=0;for(let P=0;P<r.length;P++)r[P]<0&&(ui("Negative value is found in line dasharray, replacing values with 0"),r[P]=0),w+=r[P];if(0!==w){const P=this.width/w,R=this.getDashRanges(r,this.width,P);f?this.addRoundDash(R,P,_):this.addRegularDash(R,"square"===l?.5*P:0)}const D=this.nextRow+_;this.nextRow+=x;const S={tl:[D,_],br:[w,0]};return this.positions[h]=S,S}}pt(G0,"LineAtlas");const W0=1*Us;class dd{constructor(r){const l={},h=[];for(const w in r){const D=r[w],S=l[w]={};for(const P in D.glyphs){const R=D.glyphs[+P];if(!R||0===R.bitmap.width||0===R.bitmap.height)continue;const O=R.metrics.localGlyph?W0:1,N={x:0,y:0,w:R.bitmap.width+2*O,h:R.bitmap.height+2*O};h.push(N),S[P]=N}}const{w:f,h:_}=h_(h),x=new $a({width:f||1,height:_||1});for(const w in r){const D=r[w];for(const S in D.glyphs){const P=D.glyphs[+S];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const R=l[w][S],O=P.metrics.localGlyph?W0:1;$a.copy(P.bitmap,x,{x:0,y:0},{x:R.x+O,y:R.y+O},P.bitmap)}}this.image=x,this.positions=l}}pt(dd,"GlyphAtlas");class dw{constructor(r){this.tileID=new Jr(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=Au(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,l,h,f,_){this.status="parsing",this.data=r,this.collisionBoxArray=new Gn;const x=new P_(Object.keys(r.layers).sort()),w=new $0(this.tileID,this.promoteId);w.bucketLayerIDs=[];const D={},S=new G0(256,256),P={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:h},R=l.familiesBySource[this.source];for(const pe in R){const he=r.layers[pe];if(!he)continue;let Me=!1,Ee=!1;for(const Ae of R[pe])"symbol"===Ae[0].type?Me=!0:Ee=!0;if(!0===this.isSymbolTile&&!Me||!1===this.isSymbolTile&&!Ee)continue;1===he.version&&ui(`Vector tile source "${this.source}" layer "${pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Oe=x.encode(pe),Ge=[];for(let Ae=0;Ae<he.length;Ae++){const Be=he.feature(Ae),Ve=w.getId(Be,pe);Ge.push({feature:Be,id:Ve,index:Ae,sourceLayerIndex:Oe})}for(const Ae of R[pe]){const Be=Ae[0];void 0!==this.isSymbolTile&&"symbol"===Be.type!==this.isSymbolTile||Be.minzoom&&this.zoom<Math.floor(Be.minzoom)||Be.maxzoom&&this.zoom>=Be.maxzoom||"none"!==Be.visibility&&(q0(Ae,this.zoom,h),(D[Be.id]=Be.createBucket({index:w.bucketLayerIDs.length,layers:Ae,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Oe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:h})).populate(Ge,P,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(Ae.map(Ve=>Ve.id)))}}let O,N,B,$;S.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},te=()=>{if(O)return _(O);if(N&&B&&$){const pe=new dd(N),he=new o0(B,$);for(const Me in D){const Ee=D[Me];Ee instanceof Za?(q0(Ee.layers,this.zoom,h),nw(Ee,N,pe.positions,B,he.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection)):Ee.hasPattern&&(Ee instanceof Xh||Ee instanceof n_||Ee instanceof qh)&&(q0(Ee.layers,this.zoom,h),Ee.addFeatures(P,this.tileID.canonical,he.patternPositions,h,this.tileTransform))}this.status="done",_(null,{buckets:Ca(D).filter(Me=>!Me.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pe.image,lineAtlas:S,imageAtlas:he,glyphMap:this.returnDependencies?N:null,iconMap:this.returnDependencies?B:null,glyphPositions:this.returnDependencies?pe.positions:null})}},ce=dt(P.glyphDependencies,pe=>Object.keys(pe).map(Number));Object.keys(ce).length?f.send("getGlyphs",{uid:this.uid,stacks:ce},(pe,he)=>{O||(O=pe,N=he,te())},void 0,!1,Z):N={};const ne=Object.keys(P.iconDependencies);ne.length?f.send("getImages",{icons:ne,source:this.source,tileID:this.tileID,type:"icons"},(pe,he)=>{O||(O=pe,B=he,te())},void 0,!1,Z):B={};const ae=Object.keys(P.patternDependencies);ae.length?f.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"patterns"},(pe,he)=>{O||(O=pe,$=he,te())},void 0,!1,Z):$={},te()}}function q0(s,r,l){const h=new k(r);for(const f of s)f.recalculate(h,l)}class Z0{constructor(r){this.entries={},this.scheduler=r}request(r,l,h,f){const _=this.entries[r]=this.entries[r]||{callbacks:[]};if(_.result){const[x,w]=_.result;return this.scheduler?this.scheduler.add(()=>{f(x,w)},l):f(x,w),()=>{}}return _.callbacks.push(f),_.cancel||(_.cancel=h((x,w)=>{_.result=[x,w];for(const D of _.callbacks)this.scheduler?this.scheduler.add(()=>{D(x,w)},l):D(x,w);setTimeout(()=>delete this.entries[r],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(x=>x!==f),_.callbacks.length||(_.cancel(),delete this.entries[r]))}}}function X0(s,r,l){const h=JSON.stringify(s.request);return s.data&&(this.deduped.entries[h]={result:[null,s.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},f=>{const _=ic(s.request,(x,w,D,S)=>{x?f(x):w&&f(null,{vectorTile:l?void 0:new Pf(new mm(w)),rawData:w,cacheControl:D,expires:S})});return()=>{_.cancel(),f()}},r)}const Y0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class L_{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(r,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const f=h>>4;if(1!==f)throw new Error(`Got v${f} data when expected v1.`);const _=Y0[15&h];if(!_)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(r,2,1),[w]=new Uint32Array(r,4,1);return new L_(w,x,_,r)}constructor(r,l=64,h=Float64Array,f){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const _=Y0.indexOf(this.ArrayType),x=2*r*this.ArrayType.BYTES_PER_ELEMENT,w=r*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-w%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${h}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+w+D,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+x+w+D),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+w+D,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=r)}add(r,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=r,this.coords[this._pos++]=l,h}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return F_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,l,h,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:x,nodeSize:w}=this,D=[0,_.length-1,0],S=[];for(;D.length;){const P=D.pop()||0,R=D.pop()||0,O=D.pop()||0;if(R-O<=w){for(let Z=O;Z<=R;Z++){const te=x[2*Z],ce=x[2*Z+1];te>=r&&te<=h&&ce>=l&&ce<=f&&S.push(_[Z])}continue}const N=O+R>>1,B=x[2*N],$=x[2*N+1];B>=r&&B<=h&&$>=l&&$<=f&&S.push(_[N]),(0===P?r<=B:l<=$)&&(D.push(O),D.push(N-1),D.push(1-P)),(0===P?h>=B:f>=$)&&(D.push(N+1),D.push(R),D.push(1-P))}return S}within(r,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:_,nodeSize:x}=this,w=[0,f.length-1,0],D=[],S=h*h;for(;w.length;){const P=w.pop()||0,R=w.pop()||0,O=w.pop()||0;if(R-O<=x){for(let Z=O;Z<=R;Z++)ri(_[2*Z],_[2*Z+1],r,l)<=S&&D.push(f[Z]);continue}const N=O+R>>1,B=_[2*N],$=_[2*N+1];ri(B,$,r,l)<=S&&D.push(f[N]),(0===P?r-h<=B:l-h<=$)&&(w.push(O),w.push(N-1),w.push(1-P)),(0===P?r+h>=B:l+h>=$)&&(w.push(N+1),w.push(R),w.push(1-P))}return D}}function F_(s,r,l,h,f,_){if(f-h<=l)return;const x=h+f>>1;K0(s,r,x,h,f,_),F_(s,r,l,h,x-1,1-_),F_(s,r,l,x+1,f,1-_)}function K0(s,r,l,h,f,_){for(;f>h;){if(f-h>600){const S=f-h+1,P=l-h+1,R=Math.log(S),O=.5*Math.exp(2*R/3),N=.5*Math.sqrt(R*O*(S-O)/S)*(P-S/2<0?-1:1);K0(s,r,l,Math.max(h,Math.floor(l-P*O/S+N)),Math.min(f,Math.floor(l+(S-P)*O/S+N)),_)}const x=r[2*l+_];let w=h,D=f;for(Qf(s,r,h,l),r[2*f+_]>x&&Qf(s,r,h,f);w<D;){for(Qf(s,r,w,D),w++,D--;r[2*w+_]<x;)w++;for(;r[2*D+_]>x;)D--}r[2*h+_]===x?Qf(s,r,h,D):(D++,Qf(s,r,D,f)),D<=l&&(h=D+1),l<=D&&(f=D-1)}}function Qf(s,r,l,h){Sm(s,l,h),Sm(r,2*l,2*h),Sm(r,2*l+1,2*h+1)}function Sm(s,r,l){const h=s[r];s[r]=s[l],s[l]=h}function ri(s,r,l,h){const f=s-l,_=r-h;return f*f+_*_}p.ARRAY_TYPE=ps,p.AUTH_ERR_MSG=me,p.Aabb=xr,p.Actor=class{constructor(s,r,l){this.target=s,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Yn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ta()?s:Ue,this.scheduler=new A_}send(s,r,l,h,f=!1,_){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=_,this.callbacks[x]=l);const w=qc(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:s,hasCallback:!!l,targetMapId:h,mustQueue:f,sourceMapId:this.mapId,data:Ze(r,w)},w),{cancel:()=>{l&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(s){const r=s.data,l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(r.mustQueue||Ta()){const h=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,r),h&&h.metadata||{type:"message"})}else this.processTask(l,r)}processTask(s,r){if("<response>"===r.type){const l=this.callbacks[s];delete this.callbacks[s],l&&(r.error?l(yn(r.error)):l(null,yn(r.data)))}else{const l=qc(this.globalScope)?void 0:[],h=r.hasCallback?(_,x)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:_?Ze(_):null,data:Ze(x,l)},l)}:_=>{},f=yn(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,f,h);else if(this.parent.getWorkerSource){const _=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,_[0],f.source)[_[1]](f,h)}else h(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=am,p.Color=Fi,p.ColorMode=_a,p.CullFaceMode=Hs,p.DEMData=ku,p.DataConstantProperty=U,p.DedupedRequest=Z0,p.DepthMode=Yf,p.EXTENT=St,p.Elevation=class{isDataAvailableAtPoint(s){const r=this._source();if(this.isUsingMockSource()||!r||s.y<0||s.y>1)return!1;const l=r.getSource().maxzoom,h=1<<l,f=Math.floor(s.x),_=Math.floor((s.x-f)*h),x=Math.floor(s.y*h),w=this.findDEMTileFor(new Jr(l,f,l,_,x));return!(!w||!w.dem)}getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,l=!0){if(this.isUsingMockSource())return null;null==r&&(r=null);const h=this._source();if(!h||s.y<0||s.y>1)return r;const f=h.getSource().maxzoom,_=1<<f,x=Math.floor(s.x),w=s.x-x,D=new Jr(f,x,f,Math.floor(w*_),Math.floor(s.y*_)),S=this.findDEMTileFor(D);if(!S||!S.dem)return r;const P=S.dem,R=1<<S.tileID.canonical.z,O=(w*R-S.tileID.canonical.x)*P.dim,N=(s.y*R-S.tileID.canonical.y)*P.dim,B=Math.floor(O),$=Math.floor(N);return(l?this.exaggeration():1)*mn(mn(P.get(B,$),P.get(B,$+1),N-$),mn(P.get(B+1,$),P.get(B+1,$+1),N-$),O-B)}getAtTileOffset(s,r,l){const h=1<<s.canonical.z;return this.getAtPointOrZero(new Vh(s.wrap+(s.canonical.x+r/St)/h,(s.canonical.y+l/St)/h))}getAtTileOffsetFunc(s,r,l,h){return f=>{const _=this.getAtTileOffset(s,f.x,f.y),x=h.upVector(s.canonical,f.x,f.y);return ms(x,x,_*h.upVectorScale(s.canonical,r,l).metersToTile),x}}getForTilePoints(s,r,l,h){if(this.isUsingMockSource())return!1;const f=Rc.create(this,s,h);return!!f&&(r.forEach(_=>{_[2]=this.exaggeration()*f.getElevationAt(_[0],_[1],l)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const l=r.dem.tree,h=r.tileID,f=1<<s.canonical.z-h.canonical.z;let _=s.canonical.x/f-h.canonical.x,x=s.canonical.y/f-h.canonical.y,w=0;for(let D=0;D<s.canonical.z-h.canonical.z&&!l.leaves[w];D++){_*=2,x*=2;const S=2*Math.floor(x)+Math.floor(_);w=l.childOffsets[w]+S,_%=1,x%=1}return{min:this.exaggeration()*l.minimums[w],max:this.exaggeration()*l.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,l){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=Ms,p.EvaluationParameters=k,p.Event=ml,p.Evented=oc,p.FillExtrusionBucket=qh,p.Frustum=Fg,p.FrustumCorners=Lg,p.GLOBE_RADIUS=fa,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=pv,p.GLOBE_ZOOM_THRESHOLD_MIN=jp,p.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,r){const l=new Xe,h=new vt,f=[],_=s+1+2,x=r[0]+1,w=r[0]+1+(1+r.length),D=(S,P,R)=>{let O=S===_-1?S-2:0===S?S:S-1;return O+=R?24575:0,[O,P]};for(let S=0;S<_;++S)l.emplaceBack(...D(S,0,!0));for(let S=0;S<x;++S)for(let P=0;P<_;++P)l.emplaceBack(...D(P,S,(0===P||P===_-1)&&!0));for(let S=0;S<r.length;++S){const P=r[S];for(let R=0;R<_;++R)l.emplaceBack(...D(R,P,!0))}for(let S=0;S<r.length;++S){const P=h.length,R=r[S]+1+2,O=new vt;for(let $=0;$<R-1;$++){const Z=$===R-2,te=Z?_*(w-r.length+S-$):_;for(let ce=0;ce<_-1;ce++){const ne=$*_+ce;0===$||Z||0===ce||ce===_-2?(O.emplaceBack(ne+1,ne,ne+te),O.emplaceBack(ne+te,ne+te+1,ne+1)):(h.emplaceBack(ne+1,ne,ne+te),h.emplaceBack(ne+te,ne+te+1,ne+1))}}const N=$i.simpleSegment(0,P,l.length,h.length-P);for(let $=0;$<O.uint16.length;$+=3)h.emplaceBack(O.uint16[$],O.uint16[$+1],O.uint16[$+2]);const B=$i.simpleSegment(0,P,l.length,h.length-P);f.push({withoutSkirts:N,withSkirts:B})}return{vertices:l,indices:h,segments:f}}_createGrid(s){const r=this._fillGridMeshWithLods(64,Up);this._gridSegments=r.segments,this._gridBuffer=s.createVertexBuffer(r.vertices,Vp.members),this._gridIndexBuffer=s.createIndexBuffer(r.indices,!0)}_createPoles(s){const r=new vt;for(let f=0;f<=64;f++)r.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=s.createIndexBuffer(r,!0);const l=new jn,h=new jn;this._poleSegments=[];for(let f=0,_=0;f<jp;f++){const x=360/(1<<f);l.emplaceBack(0,-fa,0,.5,0),h.emplaceBack(0,-fa,0,.5,1);for(let w=0;w<=64;w++){const D=w/64,S=mn(0,x,D),[P,R,O]=bu(vv,x1,S,fa);l.emplaceBack(P,R,O,D,0),h.emplaceBack(P,R,O,D,1)}this._poleSegments.push($i.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(l,Rg,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(h,Rg,!1)}getGridBuffers(s,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,r){if(!this._wireframeSegments){const l=new Si,h=64,f=h+1+2,_=1;this._wireframeSegments=[];for(let x=0,w=0;x<Up.length;x++){const D=Up[x];for(let P=_;P<D+_;P++)for(let R=_;R<h+_;R++){const O=P*f+R;l.emplaceBack(O,O+1),l.emplaceBack(O,O+f),l.emplaceBack(O,O+f+1)}const S=D*h*3;this._wireframeSegments.push($i.simpleSegment(0,w,(D+1)*f,S)),w+=S}this._wireframeIndexBuffer=s.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},p.GlyphManager=id,p.ImagePosition=d_,p.KDBush=L_,p.LivePerformanceUtils=Qs,p.LngLat=Un,p.LngLatBounds=zs,p.LocalGlyphMode=y_,p.MAX_MERCATOR_LATITUDE=Fr,p.MercatorCoordinate=Vh,p.ONE_EM=er,p.OverscaledTileID=Jr,p.PerformanceMarkers=rc,p.Point=at,p.Properties=re,p.RGBAImage=Ao,p.Ray=Og,p.RequestManager=class{constructor(s,r,l){this._transformRequestFn=s,this._customAccessToken=r,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const s=function(){let r="";for(let l=0;l<10;l++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Jl,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,r){return this._transformRequestFn&&this._transformRequestFn(s,r)||{url:s}}normalizeStyleURL(s,r){if(!ye(s))return s;const l=it(s);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeGlyphsURL(s,r){if(!ye(s))return s;const l=it(s);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeSourceURL(s,r,l,h){if(!ye(s))return s;const f=it(s);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),l&&f.params.push(`language=${l}`),h&&f.params.push(`worldview=${h}`),this._makeAPIURL(f,this._customAccessToken||r)}normalizeSpriteURL(s,r,l,h){const f=it(s);return ye(s)?(f.path=`/styles/v1${f.path}/sprite${r}${l}`,this._makeAPIURL(f,this._customAccessToken||h)):(f.path+=`${r}${l}`,Je(f))}normalizeTileURL(s,r,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!ye(s))return s;const h=it(s);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||l&&"raster"!==h.authority&&512===l?"@2x":""}${Xt.supported?".webp":"$1"}`),"raster"===h.authority?h.path=`/${Kt.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${Kt.TILE_URL_VERSION}${h.path}`);const f=this._customAccessToken||function(_){for(const x of _){const w=x.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(h.params)||Kt.ACCESS_TOKEN;return Kt.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,f)}canonicalizeTileURL(s,r){const l=it(s);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return s;let h="mapbox://";l.path.match(/^\/raster\/v1\//)?h+=`raster/${l.path.replace(`/${Kt.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${l.path.replace(`/${Kt.TILE_URL_VERSION}/`,"")}`;let f=l.params;return r&&(f=f.filter(_=>!_.match(/^access_token=/))),f.length&&(h+=`?${f.join("&")}`),h}canonicalizeTileset(s,r){const l=!!r&&ye(r),h=[];for(const f of s.tiles||[])De(f)?h.push(this.canonicalizeTileURL(f,l)):h.push(f);return h}_makeAPIURL(s,r){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",h=it(Kt.API_URL);if(s.protocol=h.protocol,s.authority=h.authority,"http"===s.protocol){const f=s.params.indexOf("secure");f>=0&&s.params.splice(f,1)}if("/"!==h.path&&(s.path=`${h.path}${s.path}`),!Kt.REQUIRE_ACCESS_TOKEN)return Je(s);if(r=r||Kt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return s.params=s.params.filter(f=>-1===f.indexOf("access_token")),s.params.push(`access_token=${r||""}`),Je(s)}},p.ResourceType=Sa,p.SegmentVector=$i,p.SourceCache=Ul,p.StencilMode=U0,p.StructArrayLayout1ui2=To,p.StructArrayLayout2f1f2i16=Tt,p.StructArrayLayout2i4=Xe,p.StructArrayLayout2ui4=Si,p.StructArrayLayout3f12=sn,p.StructArrayLayout3ui6=vt,p.StructArrayLayout4i8=je,p.StructArrayLayout5f20=jn,p.Texture=Xf,p.Tile=k_,p.Transitionable=j,p.Uniform1f=cf,p.Uniform1i=class extends Ol{constructor(s){super(s),this.current=0}set(s,r,l){this.fetchUniformLocation(s,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},p.Uniform2f=class extends Ol{constructor(s){super(s),this.current=[0,0]}set(s,r,l){this.fetchUniformLocation(s,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},p.Uniform3f=class extends Ol{constructor(s){super(s),this.current=[0,0,0]}set(s,r,l){this.fetchUniformLocation(s,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},p.Uniform4f=Mg,p.UniformColor=yu,p.UniformMatrix2f=class extends Ol{constructor(s){super(s),this.current=Ig}set(s,r,l){if(this.fetchUniformLocation(s,r))for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},p.UniformMatrix3f=class extends Ol{constructor(s){super(s),this.current=Yr}set(s,r,l){if(this.fetchUniformLocation(s,r))for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},p.UniformMatrix4f=class extends Ol{constructor(s){super(s),this.current=l1}set(s,r,l){if(this.fetchUniformLocation(s,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},p.UnwrappedTileID=Wv,p.ValidationError=ut,p.VectorTileFeature=o_,p.VectorTileWorkerSource=class extends oc{constructor(s,r,l,h,f){super(),this.actor=s,this.layerIndex=r,this.availableImages=l,this.loadVectorData=f||X0,this.loading={},this.loaded={},this.deduped=new Z0(s.scheduler),this.isSpriteLoaded=h,this.scheduler=s.scheduler}loadTile(s,r){const l=s.uid,h=s&&s.request,f=h&&h.collectResourceTiming,_=this.loading[l]=new dw(s);_.abort=this.loadVectorData(s,(x,w)=>{const D=!this.loading[l];if(delete this.loading[l],D||x||!w)return _.status="done",D||(this.loaded[l]=_),r(x);const S=w.rawData,P={};w.expires&&(P.expires=w.expires),w.cacheControl&&(P.cacheControl=w.cacheControl),_.vectorTile=w.vectorTile||new Pf(new mm(S));const R=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(O,N)=>{if(O||!N)return r(O);const B={};if(f){const $=Aa(h);$.length>0&&(B.resourceTiming=JSON.parse(JSON.stringify($)))}r(null,ki({rawTileData:S.slice(0)},N,P,B))})};this.isSpriteLoaded?R():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(R,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):R()}),this.loaded=this.loaded||{},this.loaded[l]=_})}reloadTile(s,r){const l=this.loaded,h=s.uid,f=this;if(l&&l[h]){const _=l[h];_.showCollisionBoxes=s.showCollisionBoxes,_.enableTerrain=!!s.enableTerrain,_.projection=s.projection,_.tileTransform=Au(s.tileID.canonical,s.projection);const x=(w,D)=>{const S=_.reloadCallback;S&&(delete _.reloadCallback,_.parse(_.vectorTile,f.layerIndex,this.availableImages,f.actor,S)),r(w,D)};"parsing"===_.status?_.reloadCallback=x:"done"===_.status&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,x):x())}}abortTile(s,r){const l=s.uid,h=this.loading[l];h&&(h.abort&&h.abort(),delete this.loading[l]),r()}removeTile(s,r){const l=this.loaded,h=s.uid;l&&l[h]&&delete l[h],r()}},p.WritingMode=zr,p.ZoomDependentExpression=gh,p.add=xc,p.addDynamicAttributes=hd,p.adjoint=function(s,r){var l=r[0],h=r[1],f=r[2],_=r[3],x=r[4],w=r[5],D=r[6],S=r[7],P=r[8];return s[0]=x*P-w*S,s[1]=f*S-h*P,s[2]=h*w-f*x,s[3]=w*D-_*P,s[4]=l*P-f*D,s[5]=f*_-l*w,s[6]=_*S-x*D,s[7]=h*D-l*S,s[8]=l*x-h*_,s},p.asyncAll=Xi,p.bezier=cl,p.bindAll=Yn,p.boundsAttributes=O0,p.bufferConvexPolygon=function(s,r){const l=[];for(let h=0;h<s.length;h++){const f=fn(h-1,-1,s.length-1),_=fn(h+1,-1,s.length-1),x=s[h],w=s[_],D=s[f].sub(x).unit(),S=w.sub(x).unit(),P=S.angleWithSep(D.x,D.y),R=D.add(S).unit().mult(-1*r/Math.sin(P/2));l.push(x.add(R))}return l},p.cacheEntryPossiblyAdded=function(s){Bo++,Bo>th&&(s.getActor().send("enforceCacheSizeLimit",tc),Bo=0)},p.calculateGlobeLabelMatrix=function(s,r){const{x:l,y:h}=s.point,f=jg(l,h,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Or(f,f,Vg(Nl(r)))},p.calculateGlobeMatrix=function(s){const{x:r,y:l}=s.point,{lng:h,lat:f}=s._center;return jg(r,l,s.worldSize,h,f)},p.calculateGlobeMercatorMatrix=function(s){const r=s.pixelsPerMeter,l=r/Vs(1,s.center.lat),h=So(new Float64Array(16));return ha(h,h,[s.point.x,s.point.y,0]),yc(h,h,[l,l,r]),Float32Array.from(h)},p.circumferenceAtLatitude=yf,p.clamp=hn,p.clearTileCache=function(s){if(!Xc())return;const r=Ue.caches.delete(ec);s&&r.catch(s).then(()=>s())},p.clipLine=y0,p.clone=function(s){var r=new ps(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},p.clone$1=xo,p.collisionCircleLayout=U1,p.config=Kt,p.conjugate=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},p.create=function(){var s=new ps(16);return ps!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},p.create$1=hr,p.createExpression=_c,p.createLayout=xe,p.createStyleLayer=function(s){return"custom"===s.type?new aw(s):new cw[s.type](s)},p.cross=Rh,p.degToRad=an,p.distance=function(s,r){return Math.hypot(r[0]-s[0],r[1]-s[1],r[2]-s[2])},p.div=function(s,r,l){return s[0]=r[0]/l[0],s[1]=r[1]/l[1],s[2]=r[2]/l[2],s},p.dot=qo,p.earthRadius=_f,p.ease=rs,p.easeCubicInOut=Ju,p.ecefToLatLng=function([s,r,l]){const h=Math.hypot(s,r,l),f=Math.atan2(s,l),_=.5*Math.PI-Math.acos(-r/h);return new Un(sr(f),sr(_))},p.emitValidationErrors=rn,p.endsWith=Ql,p.enforceCacheSizeLimit=function(s){dl(),so&&so.then(r=>{r.keys().then(l=>{for(let h=0;h<l.length-s;h++)r.delete(l[h])})})},p.evaluateSizeForFeature=Nf,p.evaluateSizeForZoom=Tc,p.evaluateVariableOffset=tw,p.evented=b,p.exactEquals=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},p.exactEquals$1=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]},p.exported=ss,p.exported$1=Xt,p.extend=ki,p.extend$1=ea,p.fillExtrusionHeightLift=$v,p.filterObject=Da,p.fromMat4=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},p.fromQuat=function(s,r){var l=r[0],h=r[1],f=r[2],_=r[3],x=l+l,w=h+h,D=f+f,S=l*x,P=h*x,R=h*w,O=f*x,N=f*w,B=f*D,$=_*x,Z=_*w,te=_*D;return s[0]=1-R-B,s[1]=P+te,s[2]=O-Z,s[3]=0,s[4]=P-te,s[5]=1-S-B,s[6]=N+$,s[7]=0,s[8]=O+Z,s[9]=N-$,s[10]=1-S-R,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},p.fromRotation=function(s,r){var l=Math.sin(r),h=Math.cos(r);return s[0]=h,s[1]=l,s[2]=0,s[3]=-l,s[4]=h,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},p.fromScaling=av,p.furthestTileCorner=function(s){const r=Math.round((s+45+360)%360/90)%4;return Wc[r]},p.getAABBPointSquareDist=function(s,r,l){let h=0;for(let f=0;f<2;++f){const _=l?l[f]:0;s[f]>_&&(h+=(s[f]-_)*(s[f]-_)),r[f]<_&&(h+=(_-r[f])*(_-r[f]))}return h},p.getAnchorAlignment=g_,p.getAnchorJustification=_m,p.getBounds=function(s){let r=1/0,l=1/0,h=-1/0,f=-1/0;for(const _ of s)r=Math.min(r,_.x),l=Math.min(l,_.y),h=Math.max(h,_.x),f=Math.max(f,_.y);return{min:new at(r,l),max:new at(h,f)}},p.getColumn=Ks,p.getDefaultExportFromCjs=vo,p.getGridMatrix=function(s,r,l,h){const f=r.getNorth(),_=r.getSouth(),x=r.getWest(),w=r.getEast(),D=1<<s.z,S=w-x,P=f-_,R=S/64,O=-P/Up[l],N=[0,R,0,O,0,0,f,x,0];if(s.z>0){const B=180/h;Np(N,N,[B/S+1,0,0,0,B/P+1,0,-.5*B/R,.5*B/O,1])}return N[2]=D,N[5]=s.x,N[8]=s.y,N},p.getImage=se,p.getJSON=function(s,r){return fl(ki(s,{type:"json"}),r)},p.getLatitudinalLod=function(s){const r=Fr-5;s=hn(s,-r,r)/r*90;const l=Math.pow(Math.abs(Math.sin(an(s))),3);return Math.round(l*(Up.length-1))},p.getMapSessionAPI=Yi,p.getPerformanceMeasurement=Aa,p.getProjection=ym,p.getRTLTextPluginStatus=E,p.getReferrer=Ia,p.getTilePoint=function(s,{x:r,y:l},h=0){return new at(((r-h)*s.scale-s.x)*St,(l*s.scale-s.y)*St)},p.getTileVec3=function(s,r,l=0){return da(((r.x-l)*s.scale-s.x)*St,(r.y*s.scale-s.y)*St,$g(r.z,r.y))},p.getVideo=function(s,r){const l=Ue.document.createElement("video");l.muted=!0,l.onloadstart=function(){r(null,l)};for(let h=0;h<s.length;h++){const f=Ue.document.createElement("source");nh(s[h])||(l.crossOrigin="Anonymous"),f.src=s[h],l.appendChild(f)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(s){const r=[0,0,0],l=So(new Float64Array(16));return Or(l,s.pixelMatrix,s.globeMatrix),yi(r,r,l),new at(r[0],r[1])},p.globeDenormalizeECEF=Vg,p.globeECEFOrigin=function(s,r){const l=[0,0,0];return yi(l,l,gf(Nl(r.canonical))),yi(l,l,s),l},p.globeMetersToEcef=Ng,p.globeNormalizeECEF=gf,p.globePixelsToTileUnits=function(s,r){return St/(512*Math.pow(2,s))*Kr(Nl(r))},p.globePoleMatrixForTile=function(s,r,l){const h=So(new Float64Array(16)),f=(r/(1<<s)-.5)*Math.PI*2;return vc(h,l.globeMatrix,f),Float32Array.from(h)},p.globeTileBounds=Nl,p.globeTiltAtLngLat=_v,p.globeToMercatorTransition=Cc,p.globeUseCustomAntiAliasing=function(s,r,l){const h=Cc(l.zoom),f=s.style.map._antialias,_=!!r.extStandardDerivatives,x=r.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return 0===h&&!f&&!x&&_},p.identity=So,p.identity$1=dv,p.invert=kg,p.isFullscreen=function(){return!!Ue.document.fullscreenElement||!!Ue.document.webkitFullscreenElement},p.isLngLatBehindGlobe=Ug,p.isMapAuthenticated=function(s){return $r.has(s)},p.isMapboxURL=ye,p.isSafariWithAntialiasingBug=function(s){const r=s.navigator?s.navigator.userAgent:null;return!!qc(s)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=Lr,p.latLngToECEF=wu,p.len=uv,p.length=vu,p.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},p.lngFromMercatorX=Xo,p.loadVectorTile=X0,p.makeRequest=fl,p.mapValue=function(s,r,l,h,f){return hn((s-r)/(l-r)*(f-h)+h,h,f)},p.mercatorScale=Hg,p.mercatorXfromLng=Ci,p.mercatorYfromLat=Zo,p.mercatorZfromAltitude=Vs,p.mul=f1,p.mul$1=p1,p.multiply=Or,p.multiply$1=Np,p.multiply$2=cv,p.nextPowerOfTwo=Ts,p.normalize=go,p.normalize$1=m1,p.normalize$2=ff,p.number=mn,p.ortho=function(s,r,l,h,f,_,x){var w=1/(r-l),D=1/(h-f),S=1/(_-x);return s[0]=-2*w,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*D,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*S,s[11]=0,s[12]=(r+l)*w,s[13]=(f+h)*D,s[14]=(x+_)*S,s[15]=1,s},p.pbf=e0,p.perspective=function(s,r,l,h,f){var _,x=1/Math.tan(r/2);return s[0]=x/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=f&&f!==1/0?(s[10]=(f+h)*(_=1/(h-f)),s[14]=2*f*h*_):(s[10]=-1,s[14]=-2*h),s},p.pick=function(s,r){const l={};for(let h=0;h<r.length;h++){const f=r[h];f in s&&(l[f]=s[f])}return l},p.plugin=I,p.pointGeometry=Xs,p.polesInViewport=function(s){const r=So(new Float64Array(16));Or(r,s.pixelMatrix,s.globeMatrix);const l=[0,Ns,0],h=[0,Bs,0];return yi(l,l,r),yi(h,h,r),[l[0]>0&&l[0]<=s.width&&l[1]>0&&l[1]<=s.height&&!Ug(s,new Un(s.center.lat,90)),h[0]>0&&h[0]<=s.width&&h[1]>0&&h[1]<=s.height&&!Ug(s,new Un(s.center.lat,-90))]},p.polygonContainsPoint=Du,p.polygonIntersectsBox=Ev,p.polygonIntersectsPolygon=Eu,p.polygonizeBounds=function(s,r,l=0,h=!0){const f=new at(l,l),_=s.sub(f),x=r.add(f),w=[_,new at(x.x,_.y),x,new at(_.x,x.y)];return h&&w.push(_.clone()),w},p.posAttributes=Vp,p.postMapLoadEvent=Ri,p.postPerformanceEvent=ji,p.postTurnstileEvent=pn,p.potpack=h_,p.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},p.radToDeg=sr,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(s){return s({pluginStatus:g,pluginURL:c}),b.on("pluginStateChange",s),s},p.removeAuthState=function(s){$r.delete(s)},p.renderColorRamp=qp,p.resample=xv,p.rotateX=kh,p.rotateX$1=xu,p.rotateY=vc,p.rotateY$1=zh,p.rotateZ=function(s,r,l){var h=Math.sin(l),f=Math.cos(l),_=r[0],x=r[1],w=r[2],D=r[3],S=r[4],P=r[5],R=r[6],O=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=_*f+S*h,s[1]=x*f+P*h,s[2]=w*f+R*h,s[3]=D*f+O*h,s[4]=S*f-_*h,s[5]=P*f-x*h,s[6]=R*f-w*h,s[7]=O*f-D*h,s},p.rotateZ$1=function(s,r,l){l*=.5;var h=r[0],f=r[1],_=r[2],x=r[3],w=Math.sin(l),D=Math.cos(l);return s[0]=h*D+f*w,s[1]=f*D-h*w,s[2]=_*D+x*w,s[3]=x*D-_*w,s},p.scale=yc,p.scale$1=Fh,p.scale$2=ms,p.scaleAndAdd=df,p.set=function(s,r,l,h){return s[0]=r,s[1]=l,s[2]=h,s},p.setCacheLimits=function(s,r){tc=s,th=r},p.setColumn=function(s,r,l){s[4*r+0]=l[0],s[4*r+1]=l[1],s[4*r+2]=l[2],s[4*r+3]=l[3]},p.setRTLTextPlugin=function(s,r,l=!1){if(g===Fp||g===Mh||g===yr)throw new Error("setRTLTextPlugin cannot be called multiple times.");c=ss.resolveURL(s),g=Fp,fo=r,v(),l||M()},p.smoothstep=ul,p.spec=ze,p.squaredLength=function(s){var r=s[0],l=s[1],h=s[2];return r*r+l*l+h*h},p.storeAuthState=function(s,r){r?$r.add(s):$r.delete(s)},p.sub=Mo,p.subtract=Bp,p.symbolSize=$1,p.tileAABB=function(s,r,l,h,f,_,x,w,D){if("globe"===D.name)return function v1(s,r,l){const h=r/s.worldSize,f=s.globeMatrix;if(l.z<=1){const Ee=Nl(l).getCorners();return y1(Ee,f,h),xr.fromPoints(Ee)}const _=pf(l),x=mf(_);y1(x,f,h);const w=Number.MAX_VALUE,D=[-w,-w,-w],S=[w,w,w];if(_.contains(s.center)){for(const Ge of x)uf(S,S,Ge),hf(D,D,Ge);D[2]=0;const Ee=s.point,Oe=[Ee.x*h,Ee.y*h,0];return uf(S,S,Oe),hf(D,D,Oe),new xr(S,D)}const P=[f[12]*h,f[13]*h,f[14]*h],R=_.getCenter(),O=hn(s.center.lat,-Fr,Fr),N=hn(R.lat,-Fr,Fr),B=Ci(s.center.lng),$=Zo(O);let Z=B-Ci(R.lng);const te=$-Zo(N);Z>.5?Z-=1:Z<-.5&&(Z+=1);let ce=0;Math.abs(Z)>Math.abs(te)?ce=Z>=0?1:3:(ce=te>=0?0:2,df(P,P,[f[4]*h,f[5]*h,f[6]*h],-Math.sin(an(te>=0?_.getSouth():_.getNorth()))*fa));const ne=x[ce],ae=x[(ce+1)%4],pe=new Bg(ne,ae,P),he=[mv(pe,0)||ne[0],mv(pe,1)||ne[1],mv(pe,2)||ne[2]],Me=Cc(s.zoom);if(Me>0){const Ee=function({x:Ge,y:Ae,z:Be},Ve,He,Ke,Le){const rt=1/(1<<Be);let ft=Ge*rt,st=ft+rt,Bt=Ae*rt,et=Bt+rt,Et=0;const Vt=(ft+st)/2-Ke;return Vt>.5?Et=-1:Vt<-.5&&(Et=1),ft=((ft+Et)*Ve-(Ke*=Ve))*He+Ke,st=((st+Et)*Ve-Ke)*He+Ke,Bt=(Bt*Ve-(Le*=Ve))*He+Le,et=(et*Ve-Le)*He+Le,[[ft,et,0],[st,et,0],[st,Bt,0],[ft,Bt,0]]}(l,r,s._pixelsPerMercatorPixel,B,$);for(let Ge=0;Ge<x.length;Ge++)Nh(x[Ge],Ee[Ge],Me);const Oe=xc([],Ee[ce],Ee[(ce+1)%4]);ms(Oe,Oe,.5),Nh(he,Oe,Me)}for(const Ee of x)uf(S,S,Ee),hf(D,D,Ee);return S[2]=Math.min(ne[2],ae[2]),uf(S,S,he),hf(D,D,he),new xr(S,D)}(s,r,new am(l,h,f));const S=Au({z:l,x:h,y:f},D);return new xr([(_+S.x/S.scale)*r,r*(S.y/S.scale),x],[(_+S.x2/S.scale)*r,r*(S.y2/S.scale),w])},p.tileCornersToBounds=pf,p.tileTransform=Au,p.transformMat3=function(s,r,l){var h=r[0],f=r[1],_=r[2];return s[0]=h*l[0]+f*l[3]+_*l[6],s[1]=h*l[1]+f*l[4]+_*l[7],s[2]=h*l[2]+f*l[5]+_*l[8],s},p.transformMat4=yi,p.transformMat4$1=bc,p.transformQuat=Oh,p.transitionTileAABBinECEF=_1,p.translate=ha,p.transpose=function(s,r){if(s===r){var l=r[1],h=r[2],f=r[5];s[1]=r[3],s[2]=r[6],s[3]=l,s[5]=r[7],s[6]=h,s[7]=f}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return s},p.triggerPluginCompletionEvent=d,p.uniqueId=oo,p.updateGlobeVertexNormal=function(s,r,l,h,f){const _=5*r+2;s.float32[_+0]=l,s.float32[_+1]=h,s.float32[_+2]=f},p.validateCustomStyleLayer=function(s){const r=[],l=s.id;return void 0===l&&r.push({message:`layers.${l}: missing required property "id"`}),void 0===s.render&&r.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},p.validateFilter=s=>ho(fu(s)),p.validateFog=s=>ho(Il(s)),p.validateLayer=s=>ho(tf(s)),p.validateLight=s=>ho(kp(s)),p.validateSource=s=>ho(pu(s)),p.validateStyle=Rp,p.validateTerrain=s=>ho(Eh(s)),p.values=Ca,p.vectorTile=rm,p.version=Ds,p.warnOnce=ui,p.window=Ue,p.wrap=fn}),Od(0,function(p){function Ue(ue){if("number"==typeof ue||"boolean"==typeof ue||"string"==typeof ue||null==ue)return JSON.stringify(ue);if(Array.isArray(ue)){let W="[";for(const se of ue)W+=`${Ue(se)},`;return`${W}]`}let G="{";for(const W of Object.keys(ue).sort())G+=`${W}:${Ue(ue[W])},`;return`${G}}`}function Ds(ue){let G="";for(const W of p.refProperties)G+=`/${Ue(ue[W])}`;return G}class Lo{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,W){for(const me of G)this._layerConfigs[me.id]=me,(this._layers[me.id]=p.createStyleLayer(me)).compileFilter(),this.keyCache[me.id]&&delete this.keyCache[me.id];for(const me of W)delete this.keyCache[me],delete this._layerConfigs[me],delete this._layers[me];this.familiesBySource={};const se=function(me,ye){const De={};for(let _e=0;_e<me.length;_e++){const ke=ye&&ye[me[_e].id]||Ds(me[_e]);ye&&(ye[me[_e].id]=ke);let tt=De[ke];tt||(tt=De[ke]=[]),tt.push(me[_e])}const Ce=[];for(const _e in De)Ce.push(De[_e]);return Ce}(p.values(this._layerConfigs),this.keyCache);for(const me of se){const ye=me.map(it=>this._layers[it.id]),De=ye[0];if("none"===De.visibility)continue;const Ce=De.source||"";let _e=this.familiesBySource[Ce];_e||(_e=this.familiesBySource[Ce]={});const ke=De.sourceLayer||"_geojsonTileLayer";let tt=_e[ke];tt||(tt=_e[ke]=[]),tt.push(ye)}}}class Kt{loadTile(G,W){const{uid:se,encoding:me,rawImageData:ye,padding:De,buildQuadTree:Ce}=G,_e=p.window.ImageBitmap&&ye instanceof p.window.ImageBitmap?this.getImageData(ye,De):ye;W(null,new p.DEMData(se,_e,me,De<1,Ce))}getImageData(G,W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);const se=this.offscreenCanvasContext.getImageData(-W,-W,G.width+2*W,G.height+2*W);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),se}}function Xt(ue,G){if(0!==ue.length){Zi(ue[0],G);for(var W=1;W<ue.length;W++)Zi(ue[W],!G)}}function Zi(ue,G){for(var W=0,se=0,me=0,ye=ue.length,De=ye-1;me<ye;De=me++){var Ce=(ue[me][0]-ue[De][0])*(ue[De][1]+ue[me][1]),_e=W+Ce;se+=Math.abs(W)>=Math.abs(Ce)?W-_e+Ce:Ce-_e+W,W=_e}W+se>=0!=!!G&&ue.reverse()}var Ur=p.getDefaultExportFromCjs(function ue(G,W){var se,me=G&&G.type;if("FeatureCollection"===me)for(se=0;se<G.features.length;se++)ue(G.features[se],W);else if("GeometryCollection"===me)for(se=0;se<G.geometries.length;se++)ue(G.geometries[se],W);else if("Feature"===me)ue(G.geometry,W);else if("Polygon"===me)Xt(G.coordinates,W);else if("MultiPolygon"===me)for(se=0;se<G.coordinates.length;se++)Xt(G.coordinates[se],W);return G});const ns=p.VectorTileFeature.prototype.toGeoJSON;var Zs={exports:{}},Gc=p.pointGeometry,Jl=p.vectorTile.VectorTileFeature,vo=Fo;function Fo(ue,G){this.options=G||{},this.features=ue,this.length=ue.length}function ro(ue,G){this.id="number"==typeof ue.id?ue.id:void 0,this.type=ue.type,this.rawGeometry=1===ue.type?[ue.geometry]:ue.geometry,this.properties=ue.tags,this.extent=G||4096}Fo.prototype.feature=function(ue){return new ro(this.features[ue],this.options.extent)},ro.prototype.loadGeometry=function(){var ue=this.rawGeometry;this.geometry=[];for(var G=0;G<ue.length;G++){for(var W=ue[G],se=[],me=0;me<W.length;me++)se.push(new Gc(W[me][0],W[me][1]));this.geometry.push(se)}return this.geometry},ro.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ue=this.geometry,G=1/0,W=-1/0,se=1/0,me=-1/0,ye=0;ye<ue.length;ye++)for(var De=ue[ye],Ce=0;Ce<De.length;Ce++){var _e=De[Ce];G=Math.min(G,_e.x),W=Math.max(W,_e.x),se=Math.min(se,_e.y),me=Math.max(me,_e.y)}return[G,se,W,me]},ro.prototype.toGeoJSON=Jl.prototype.toGeoJSON;var al=p.pbf,Xs=vo;function is(ue){var G=new al;return function(W,se){for(var me in W.layers)se.writeMessage(3,at,W.layers[me])}(ue,G),G.finish()}function at(ue,G){var W;G.writeVarintField(15,ue.version||1),G.writeStringField(1,ue.name||""),G.writeVarintField(5,ue.extent||4096);var se={keys:[],values:[],keycache:{},valuecache:{}};for(W=0;W<ue.length;W++)se.feature=ue.feature(W),G.writeMessage(2,Ld,se);var me=se.keys;for(W=0;W<me.length;W++)G.writeStringField(3,me[W]);var ye=se.values;for(W=0;W<ye.length;W++)G.writeMessage(4,Ju,ye[W])}function Ld(ue,G){var W=ue.feature;void 0!==W.id&&G.writeVarintField(1,W.id),G.writeMessage(2,ll,ue),G.writeVarintField(3,W.type),G.writeMessage(4,Wc,W)}function ll(ue,G){var W=ue.feature,se=ue.keys,me=ue.values,ye=ue.keycache,De=ue.valuecache;for(var Ce in W.properties){var _e=W.properties[Ce],ke=ye[Ce];if(null!==_e){void 0===ke&&(se.push(Ce),ye[Ce]=ke=se.length-1),G.writeVarint(ke);var tt=typeof _e;"string"!==tt&&"boolean"!==tt&&"number"!==tt&&(_e=JSON.stringify(_e));var it=tt+":"+_e,Je=De[it];void 0===Je&&(me.push(_e),De[it]=Je=me.length-1),G.writeVarint(Je)}}}function an(ue,G){return(G<<3)+(7&ue)}function sr(ue){return ue<<1^ue>>31}function Wc(ue,G){for(var W=ue.loadGeometry(),se=ue.type,me=0,ye=0,De=W.length,Ce=0;Ce<De;Ce++){var _e=W[Ce],ke=1;1===se&&(ke=_e.length),G.writeVarint(an(1,ke));for(var tt=3===se?_e.length-1:_e.length,it=0;it<tt;it++){1===it&&1!==se&&G.writeVarint(an(2,tt-1));var Je=_e[it].x-me,Gt=_e[it].y-ye;G.writeVarint(sr(Je)),G.writeVarint(sr(Gt)),me+=Je,ye+=Gt}3===se&&G.writeVarint(an(7,1))}}function Ju(ue,G){var W=typeof ue;"string"===W?G.writeStringField(1,ue):"boolean"===W?G.writeBooleanField(7,ue):"number"===W&&(ue%1!=0?G.writeDoubleField(3,ue):ue<0?G.writeSVarintField(6,ue):G.writeVarintField(5,ue))}Zs.exports=is,Zs.exports.fromVectorTileJs=is,Zs.exports.fromGeojsonVt=function(ue,G){G=G||{};var W={};for(var se in ue)W[se]=new Xs(ue[se].features,G),W[se].name=se,W[se].version=G.version,W[se].extent=G.extent;return is({layers:W})},Zs.exports.GeoJSONWrapper=Xs;var cl=p.getDefaultExportFromCjs(Zs.exports);const rs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ue=>ue},hn=Math.fround||(ul=new Float32Array(1),ue=>(ul[0]=+ue,ul[0]));var ul;const fn=3,Xi=5,Ca=6;class ki{constructor(G){this.options=Object.assign(Object.create(rs),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:W,minZoom:se,maxZoom:me}=this.options;W&&console.time("total time");const ye=`prepare ${G.length} points`;W&&console.time(ye),this.points=G;const De=[];for(let _e=0;_e<G.length;_e++){const ke=G[_e];if(!ke.geometry)continue;const[tt,it]=ke.geometry.coordinates,Je=hn(Ys(tt)),Gt=hn(Ts(it));De.push(Je,Gt,1/0,_e,-1,1),this.options.reduce&&De.push(0)}let Ce=this.trees[me+1]=this._createTree(De);W&&console.timeEnd(ye);for(let _e=me;_e>=se;_e--){const ke=+Date.now();Ce=this.trees[_e]=this._createTree(this._cluster(Ce,_e)),W&&console.log("z%d: %d clusters in %dms",_e,Ce.numItems,+Date.now()-ke)}return W&&console.timeEnd("total time"),this}getClusters(G,W){let se=((G[0]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,G[1]));let ye=180===G[2]?180:((G[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)se=-180,ye=180;else if(se>ye){const it=this.getClusters([se,me,180,De],W),Je=this.getClusters([-180,me,ye,De],W);return it.concat(Je)}const Ce=this.trees[this._limitZoom(W)],_e=Ce.range(Ys(se),Ts(De),Ys(ye),Ts(me)),ke=Ce.data,tt=[];for(const it of _e){const Je=this.stride*it;tt.push(ke[Je+Xi]>1?Ea(ke,Je,this.clusterProps):this.points[ke[Je+fn]])}return tt}getChildren(G){const W=this._getOriginId(G),se=this._getOriginZoom(G),me="No cluster with the specified id.",ye=this.trees[se];if(!ye)throw new Error(me);const De=ye.data;if(W*this.stride>=De.length)throw new Error(me);const Ce=this.options.radius/(this.options.extent*Math.pow(2,se-1)),_e=ye.within(De[W*this.stride],De[W*this.stride+1],Ce),ke=[];for(const tt of _e){const it=tt*this.stride;De[it+4]===G&&ke.push(De[it+Xi]>1?Ea(De,it,this.clusterProps):this.points[De[it+fn]])}if(0===ke.length)throw new Error(me);return ke}getLeaves(G,W,se){const me=[];return this._appendLeaves(me,G,W=W||10,se=se||0,0),me}getTile(G,W,se){const me=this.trees[this._limitZoom(G)],ye=Math.pow(2,G),{extent:De,radius:Ce}=this.options,_e=Ce/De,ke=(se-_e)/ye,tt=(se+1+_e)/ye,it={features:[]};return this._addTileFeatures(me.range((W-_e)/ye,ke,(W+1+_e)/ye,tt),me.data,W,se,ye,it),0===W&&this._addTileFeatures(me.range(1-_e/ye,ke,1,tt),me.data,ye,se,ye,it),W===ye-1&&this._addTileFeatures(me.range(0,ke,_e/ye,tt),me.data,-1,se,ye,it),it.features.length?it:null}getClusterExpansionZoom(G){let W=this._getOriginZoom(G)-1;for(;W<=this.options.maxZoom;){const se=this.getChildren(G);if(W++,1!==se.length)break;G=se[0].properties.cluster_id}return W}_appendLeaves(G,W,se,me,ye){const De=this.getChildren(W);for(const Ce of De){const _e=Ce.properties;if(_e&&_e.cluster?ye+_e.point_count<=me?ye+=_e.point_count:ye=this._appendLeaves(G,_e.cluster_id,se,me,ye):ye<me?ye++:G.push(Ce),G.length===se)break}return ye}_createTree(G){const W=new p.KDBush(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let se=0;se<G.length;se+=this.stride)W.add(G[se],G[se+1]);return W.finish(),W.data=G,W}_addTileFeatures(G,W,se,me,ye,De){for(const Ce of G){const _e=Ce*this.stride,ke=W[_e+Xi]>1;let tt,it,Je;if(ke)tt=oo(W,_e,this.clusterProps),it=W[_e],Je=W[_e+1];else{const Ut=this.points[W[_e+fn]];tt=Ut.properties;const[tn,pn]=Ut.geometry.coordinates;it=Ys(tn),Je=Ts(pn)}const Gt={type:1,geometry:[[Math.round(this.options.extent*(it*ye-se)),Math.round(this.options.extent*(Je*ye-me))]],tags:tt};let en;en=ke||this.options.generateId?W[_e+fn]:this.points[W[_e+fn]].id,void 0!==en&&(Gt.id=en),De.features.push(Gt)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,W){const{radius:se,extent:me,reduce:ye,minPoints:De}=this.options,Ce=se/(me*Math.pow(2,W)),_e=G.data,ke=[],tt=this.stride;for(let it=0;it<_e.length;it+=tt){if(_e[it+2]<=W)continue;_e[it+2]=W;const Je=_e[it],Gt=_e[it+1],en=G.within(_e[it],_e[it+1],Ce),Ut=_e[it+Xi];let tn=Ut;for(const pn of en){const xn=pn*tt;_e[xn+2]>W&&(tn+=_e[xn+Xi])}if(tn>Ut&&tn>=De){let pn,xn=Je*Ut,Ri=Gt*Ut,Tr=-1;const ji=((it/tt|0)<<5)+(W+1)+this.points.length;for(const Ss of en){const Yi=Ss*tt;if(_e[Yi+2]<=W)continue;_e[Yi+2]=W;const $r=_e[Yi+Xi];xn+=_e[Yi]*$r,Ri+=_e[Yi+1]*$r,_e[Yi+4]=ji,ye&&(pn||(pn=this._map(_e,it,!0),Tr=this.clusterProps.length,this.clusterProps.push(pn)),ye(pn,this._map(_e,Yi)))}_e[it+4]=ji,ke.push(xn/tn,Ri/tn,1/0,ji,-1,tn),ye&&ke.push(Tr)}else{for(let pn=0;pn<tt;pn++)ke.push(_e[it+pn]);if(tn>1)for(const pn of en){const xn=pn*tt;if(!(_e[xn+2]<=W)){_e[xn+2]=W;for(let Ri=0;Ri<tt;Ri++)ke.push(_e[xn+Ri])}}}}return ke}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,W,se){if(G[W+Xi]>1){const De=this.clusterProps[G[W+Ca]];return se?Object.assign({},De):De}const me=this.points[G[W+fn]].properties,ye=this.options.map(me);return se&&ye===me?Object.assign({},ye):ye}}function Ea(ue,G,W){return{type:"Feature",id:ue[G+fn],properties:oo(ue,G,W),geometry:{type:"Point",coordinates:[(se=ue[G],360*(se-.5)),gi(ue[G+1])]}};var se}function oo(ue,G,W){const se=ue[G+Xi],me=se>=1e4?`${Math.round(se/1e3)}k`:se>=1e3?Math.round(se/100)/10+"k":se,ye=ue[G+Ca],De=-1===ye?{}:Object.assign({},W[ye]);return Object.assign(De,{cluster:!0,cluster_id:ue[G+fn],point_count:se,point_count_abbreviated:me})}function Ys(ue){return ue/360+.5}function Ts(ue){const G=Math.sin(ue*Math.PI/180),W=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return W<0?0:W>1?1:W}function gi(ue){const G=(180-360*ue)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function Yn(ue,G,W,se){for(var me,ye=se,De=W-G>>1,Ce=W-G,_e=ue[G],ke=ue[G+1],tt=ue[W],it=ue[W+1],Je=G+3;Je<W;Je+=3){var Gt=Ql(ue[Je],ue[Je+1],_e,ke,tt,it);if(Gt>ye)me=Je,ye=Gt;else if(Gt===ye){var en=Math.abs(Je-De);en<Ce&&(me=Je,Ce=en)}}ye>se&&(me-G>3&&Yn(ue,G,me,se),ue[me+2]=ye,W-me>3&&Yn(ue,me,W,se))}function Ql(ue,G,W,se,me,ye){var De=me-W,Ce=ye-se;if(0!==De||0!==Ce){var _e=((ue-W)*De+(G-se)*Ce)/(De*De+Ce*Ce);_e>1?(W=me,se=ye):_e>0&&(W+=De*_e,se+=Ce*_e)}return(De=ue-W)*De+(Ce=G-se)*Ce}function dt(ue,G,W,se){var me={id:void 0===ue?null:ue,type:G,geometry:W,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ye){var De=ye.geometry,Ce=ye.type;if("Point"===Ce||"MultiPoint"===Ce||"LineString"===Ce)Da(ye,De);else if("Polygon"===Ce||"MultiLineString"===Ce)for(var _e=0;_e<De.length;_e++)Da(ye,De[_e]);else if("MultiPolygon"===Ce)for(_e=0;_e<De.length;_e++)for(var ke=0;ke<De[_e].length;ke++)Da(ye,De[_e][ke])}(me),me}function Da(ue,G){for(var W=0;W<G.length;W+=3)ue.minX=Math.min(ue.minX,G[W]),ue.minY=Math.min(ue.minY,G[W+1]),ue.maxX=Math.max(ue.maxX,G[W]),ue.maxY=Math.max(ue.maxY,G[W+1])}function xo(ue,G,W,se){if(G.geometry){var me=G.geometry.coordinates,ye=G.geometry.type,De=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2),Ce=[],_e=G.id;if(W.promoteId?_e=G.properties[W.promoteId]:W.generateId&&(_e=se||0),"Point"===ye)hl(me,Ce);else if("MultiPoint"===ye)for(var ke=0;ke<me.length;ke++)hl(me[ke],Ce);else if("LineString"===ye)ui(me,Ce,De,!1);else if("MultiLineString"===ye){if(W.lineMetrics){for(ke=0;ke<me.length;ke++)ui(me[ke],Ce=[],De,!1),ue.push(dt(_e,"LineString",Ce,G.properties));return}zo(me,Ce,De,!1)}else if("Polygon"===ye)zo(me,Ce,De,!0);else{if("MultiPolygon"!==ye){if("GeometryCollection"===ye){for(ke=0;ke<G.geometry.geometries.length;ke++)xo(ue,{id:_e,geometry:G.geometry.geometries[ke],properties:G.properties},W,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ke=0;ke<me.length;ke++){var tt=[];zo(me[ke],tt,De,!0),Ce.push(tt)}}ue.push(dt(_e,ye,Ce,G.properties))}}function hl(ue,G){G.push(Qu(ue[0])),G.push(Ta(ue[1])),G.push(0)}function ui(ue,G,W,se){for(var me,ye,De=0,Ce=0;Ce<ue.length;Ce++){var _e=Qu(ue[Ce][0]),ke=Ta(ue[Ce][1]);G.push(_e),G.push(ke),G.push(0),Ce>0&&(De+=se?(me*ke-_e*ye)/2:Math.sqrt(Math.pow(_e-me,2)+Math.pow(ke-ye,2))),me=_e,ye=ke}var tt=G.length-3;G[2]=1,Yn(G,0,tt,W),G[tt+2]=1,G.size=Math.abs(De),G.start=0,G.end=G.size}function zo(ue,G,W,se){for(var me=0;me<ue.length;me++){var ye=[];ui(ue[me],ye,W,se),G.push(ye)}}function Qu(ue){return ue/360+.5}function Ta(ue){var G=Math.sin(ue*Math.PI/180),W=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return W<0?0:W>1?1:W}function No(ue,G,W,se,me,ye,De,Ce){if(se/=G,ye>=(W/=G)&&De<se)return ue;if(De<W||ye>=se)return null;for(var _e=[],ke=0;ke<ue.length;ke++){var tt=ue[ke],it=tt.geometry,Je=tt.type,Gt=0===me?tt.minX:tt.minY,en=0===me?tt.maxX:tt.maxY;if(Gt>=W&&en<se)_e.push(tt);else if(!(en<W||Gt>=se)){var Ut=[];if("Point"===Je||"MultiPoint"===Je)eh(it,Ut,W,se,me);else if("LineString"===Je)qc(it,Ut,W,se,me,!1,Ce.lineMetrics);else if("MultiLineString"===Je)Ks(it,Ut,W,se,me,!1);else if("Polygon"===Je)Ks(it,Ut,W,se,me,!0);else if("MultiPolygon"===Je)for(var tn=0;tn<it.length;tn++){var pn=[];Ks(it[tn],pn,W,se,me,!0),pn.length&&Ut.push(pn)}if(Ut.length){if(Ce.lineMetrics&&"LineString"===Je){for(tn=0;tn<Ut.length;tn++)_e.push(dt(tt.id,Je,Ut[tn],tt.tags));continue}"LineString"!==Je&&"MultiLineString"!==Je||(1===Ut.length?(Je="LineString",Ut=Ut[0]):Je="MultiLineString"),"Point"!==Je&&"MultiPoint"!==Je||(Je=3===Ut.length?"Point":"MultiPoint"),_e.push(dt(tt.id,Je,Ut,tt.tags))}}}return _e.length?_e:null}function eh(ue,G,W,se,me){for(var ye=0;ye<ue.length;ye+=3){var De=ue[ye+me];De>=W&&De<=se&&(G.push(ue[ye]),G.push(ue[ye+1]),G.push(ue[ye+2]))}}function qc(ue,G,W,se,me,ye,De){for(var Ce,_e,ke=Zc(ue),tt=0===me?tc:th,it=ue.start,Je=0;Je<ue.length-3;Je+=3){var Gt=ue[Je],en=ue[Je+1],Ut=ue[Je+2],tn=ue[Je+3],pn=ue[Je+4],xn=0===me?Gt:en,Ri=0===me?tn:pn,Tr=!1;De&&(Ce=Math.sqrt(Math.pow(Gt-tn,2)+Math.pow(en-pn,2))),xn<W?Ri>W&&(_e=tt(ke,Gt,en,tn,pn,W),De&&(ke.start=it+Ce*_e)):xn>se?Ri<se&&(_e=tt(ke,Gt,en,tn,pn,se),De&&(ke.start=it+Ce*_e)):ec(ke,Gt,en,Ut),Ri<W&&xn>=W&&(_e=tt(ke,Gt,en,tn,pn,W),Tr=!0),Ri>se&&xn<=se&&(_e=tt(ke,Gt,en,tn,pn,se),Tr=!0),!ye&&Tr&&(De&&(ke.end=it+Ce*_e),G.push(ke),ke=Zc(ue)),De&&(it+=Ce)}var ji=ue.length-3;Gt=ue[ji],en=ue[ji+1],Ut=ue[ji+2],(xn=0===me?Gt:en)>=W&&xn<=se&&ec(ke,Gt,en,Ut),ji=ke.length-3,ye&&ji>=3&&(ke[ji]!==ke[0]||ke[ji+1]!==ke[1])&&ec(ke,ke[0],ke[1],ke[2]),ke.length&&G.push(ke)}function Zc(ue){var G=[];return G.size=ue.size,G.start=ue.start,G.end=ue.end,G}function Ks(ue,G,W,se,me,ye){for(var De=0;De<ue.length;De++)qc(ue[De],G,W,se,me,ye,!1)}function ec(ue,G,W,se){ue.push(G),ue.push(W),ue.push(se)}function tc(ue,G,W,se,me,ye){var De=(ye-G)/(se-G);return ue.push(ye),ue.push(W+(me-W)*De),ue.push(1),De}function th(ue,G,W,se,me,ye){var De=(ye-W)/(me-W);return ue.push(G+(se-G)*De),ue.push(ye),ue.push(1),De}function so(ue,G){for(var W=[],se=0;se<ue.length;se++){var me,ye=ue[se],De=ye.type;if("Point"===De||"MultiPoint"===De||"LineString"===De)me=Js(ye.geometry,G);else if("MultiLineString"===De||"Polygon"===De){me=[];for(var Ce=0;Ce<ye.geometry.length;Ce++)me.push(Js(ye.geometry[Ce],G))}else if("MultiPolygon"===De)for(me=[],Ce=0;Ce<ye.geometry.length;Ce++){for(var _e=[],ke=0;ke<ye.geometry[Ce].length;ke++)_e.push(Js(ye.geometry[Ce][ke],G));me.push(_e)}W.push(dt(ye.id,De,me,ye.tags))}return W}function Js(ue,G){var W=[];W.size=ue.size,void 0!==ue.start&&(W.start=ue.start,W.end=ue.end);for(var se=0;se<ue.length;se+=3)W.push(ue[se]+G,ue[se+1],ue[se+2]);return W}function Xc(ue,G){if(ue.transformed)return ue;var W,se,me,ye=1<<ue.z,De=ue.x,Ce=ue.y;for(W=0;W<ue.features.length;W++){var _e=ue.features[W],ke=_e.geometry,tt=_e.type;if(_e.geometry=[],1===tt)for(se=0;se<ke.length;se+=2)_e.geometry.push(dl(ke[se],ke[se+1],G,ye,De,Ce));else for(se=0;se<ke.length;se++){var it=[];for(me=0;me<ke[se].length;me+=2)it.push(dl(ke[se][me],ke[se][me+1],G,ye,De,Ce));_e.geometry.push(it)}}return ue.transformed=!0,ue}function dl(ue,G,W,se,me,ye){return[Math.round(W*(ue*se-me)),Math.round(W*(G*se-ye))]}function nc(ue,G,W,se,me){for(var ye=G===me.maxZoom?0:me.tolerance/((1<<G)*me.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:W,y:se,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ce=0;Ce<ue.length;Ce++){De.numFeatures++,Bo(De,ue[Ce],ye,me);var _e=ue[Ce].minX,ke=ue[Ce].minY,tt=ue[Ce].maxX,it=ue[Ce].maxY;_e<De.minX&&(De.minX=_e),ke<De.minY&&(De.minY=ke),tt>De.maxX&&(De.maxX=tt),it>De.maxY&&(De.maxY=it)}return De}function Bo(ue,G,W,se){var me=G.geometry,ye=G.type,De=[];if("Point"===ye||"MultiPoint"===ye)for(var Ce=0;Ce<me.length;Ce+=3)De.push(me[Ce]),De.push(me[Ce+1]),ue.numPoints++,ue.numSimplified++;else if("LineString"===ye)Sa(De,me,ue,W,!1,!1);else if("MultiLineString"===ye||"Polygon"===ye)for(Ce=0;Ce<me.length;Ce++)Sa(De,me[Ce],ue,W,"Polygon"===ye,0===Ce);else if("MultiPolygon"===ye)for(var _e=0;_e<me.length;_e++){var ke=me[_e];for(Ce=0;Ce<ke.length;Ce++)Sa(De,ke[Ce],ue,W,!0,0===Ce)}if(De.length){var tt=G.tags||null;if("LineString"===ye&&se.lineMetrics){for(var it in tt={},G.tags)tt[it]=G.tags[it];tt.mapbox_clip_start=me.start/me.size,tt.mapbox_clip_end=me.end/me.size}var Je={geometry:De,type:"Polygon"===ye||"MultiPolygon"===ye?3:"LineString"===ye||"MultiLineString"===ye?2:1,tags:tt};null!==G.id&&(Je.id=G.id),ue.features.push(Je)}}function Sa(ue,G,W,se,me,ye){var De=se*se;if(se>0&&G.size<(me?De:se))W.numPoints+=G.length/3;else{for(var Ce=[],_e=0;_e<G.length;_e+=3)(0===se||G[_e+2]>De)&&(W.numSimplified++,Ce.push(G[_e]),Ce.push(G[_e+1])),W.numPoints++;me&&function(ke,tt){for(var it=0,Je=0,Gt=ke.length,en=Gt-2;Je<Gt;en=Je,Je+=2)it+=(ke[Je]-ke[en])*(ke[Je+1]+ke[en+1]);if(it>0===tt)for(Je=0,Gt=ke.length;Je<Gt/2;Je+=2){var Ut=ke[Je],tn=ke[Je+1];ke[Je]=ke[Gt-2-Je],ke[Je+1]=ke[Gt-1-Je],ke[Gt-2-Je]=Ut,ke[Gt-1-Je]=tn}}(Ce,ye),ue.push(Ce)}}function Ma(ue,G){var W=(G=this.options=function(me,ye){for(var De in ye)me[De]=ye[De];return me}(Object.create(this.options),G)).debug;if(W&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");var me,ye,De,Ce,_e,ke,se=function(me,ye){var De=[];if("FeatureCollection"===me.type)for(var Ce=0;Ce<me.features.length;Ce++)xo(De,me.features[Ce],ye,Ce);else xo(De,"Feature"===me.type?me:{geometry:me},ye);return De}(ue,G);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ce=me=se,_e=No(me,1,-1-(De=(ye=G).buffer/ye.extent),De,0,-1,2,ye),ke=No(me,1,1-De,2+De,0,-1,2,ye),(_e||ke)&&(Ce=No(me,1,-De,1+De,0,-1,2,ye)||[],_e&&(Ce=so(_e,1).concat(Ce)),ke&&(Ce=Ce.concat(so(ke,-1)))),(se=Ce).length&&this.splitTile(se,0,0,0),W&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ia(ue,G,W){return 32*((1<<ue)*W+G)+ue}function fl(ue,G){const W=ue.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);const se=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!se)return G(null,null);const me=new class{constructor(De){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=De.length,this._features=De}feature(De){return new class{constructor(Ce){this._feature=Ce,this.extent=p.EXTENT,this.type=Ce.type,this.properties=Ce.tags,"id"in Ce&&!isNaN(Ce.id)&&(this.id=parseInt(Ce.id,10))}loadGeometry(){if(1===this._feature.type){const Ce=[];for(const _e of this._feature.geometry)Ce.push([new p.Point(_e[0],_e[1])]);return Ce}{const Ce=[];for(const _e of this._feature.geometry){const ke=[];for(const tt of _e)ke.push(new p.Point(tt[0],tt[1]));Ce.push(ke)}return Ce}}toGeoJSON(Ce,_e,ke){return ns.call(this,Ce,_e,ke)}}(this._features[De])}}(se.features);let ye=cl(me);0===ye.byteOffset&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),G(null,{vectorTile:me,rawData:ye.buffer})}Ma.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ma.prototype.splitTile=function(ue,G,W,se,me,ye,De){for(var Ce=[ue,G,W,se],_e=this.options,ke=_e.debug;Ce.length;){se=Ce.pop(),W=Ce.pop(),G=Ce.pop(),ue=Ce.pop();var tt=1<<G,it=Ia(G,W,se),Je=this.tiles[it];if(!Je&&(ke>1&&console.time("creation"),Je=this.tiles[it]=nc(ue,G,W,se,_e),this.tileCoords.push({z:G,x:W,y:se}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,W,se,Je.numFeatures,Je.numPoints,Je.numSimplified),console.timeEnd("creation"));var Gt="z"+G;this.stats[Gt]=(this.stats[Gt]||0)+1,this.total++}if(Je.source=ue,me){if(G===_e.maxZoom||G===me)continue;var en=1<<me-G;if(W!==Math.floor(ye/en)||se!==Math.floor(De/en))continue}else if(G===_e.indexMaxZoom||Je.numPoints<=_e.indexMaxPoints)continue;if(Je.source=null,0!==ue.length){ke>1&&console.time("clipping");var Ut,tn,pn,xn,Ri,Tr,ji=.5*_e.buffer/_e.extent,Ss=.5-ji,Yi=.5+ji,$r=1+ji;Ut=tn=pn=xn=null,Ri=No(ue,tt,W-ji,W+Yi,0,Je.minX,Je.maxX,_e),Tr=No(ue,tt,W+Ss,W+$r,0,Je.minX,Je.maxX,_e),ue=null,Ri&&(Ut=No(Ri,tt,se-ji,se+Yi,1,Je.minY,Je.maxY,_e),tn=No(Ri,tt,se+Ss,se+$r,1,Je.minY,Je.maxY,_e),Ri=null),Tr&&(pn=No(Tr,tt,se-ji,se+Yi,1,Je.minY,Je.maxY,_e),xn=No(Tr,tt,se+Ss,se+$r,1,Je.minY,Je.maxY,_e),Tr=null),ke>1&&console.timeEnd("clipping"),Ce.push(Ut||[],G+1,2*W,2*se),Ce.push(tn||[],G+1,2*W,2*se+1),Ce.push(pn||[],G+1,2*W+1,2*se),Ce.push(xn||[],G+1,2*W+1,2*se+1)}}},Ma.prototype.getTile=function(ue,G,W){var se=this.options,me=se.extent,ye=se.debug;if(ue<0||ue>24)return null;var De=1<<ue,Ce=Ia(ue,G=(G%De+De)%De,W);if(this.tiles[Ce])return Xc(this.tiles[Ce],me);ye>1&&console.log("drilling down to z%d-%d-%d",ue,G,W);for(var _e,ke=ue,tt=G,it=W;!_e&&ke>0;)ke--,tt=Math.floor(tt/2),it=Math.floor(it/2),_e=this.tiles[Ia(ke,tt,it)];return _e&&_e.source?(ye>1&&console.log("found parent tile z%d-%d-%d",ke,tt,it),ye>1&&console.time("drilling down"),this.splitTile(_e.source,ke,tt,it,ue,G,W),ye>1&&console.timeEnd("drilling down"),this.tiles[Ce]?Xc(this.tiles[Ce],me):null):null};class ic extends p.VectorTileWorkerSource{constructor(G,W,se,me,ye){super(G,W,se,me,fl),ye&&(this.loadGeoJSON=ye)}loadData(G,W){const se=G&&G.request,me=se&&se.collectResourceTiming;this.loadGeoJSON(G,(ye,De)=>{if(ye||!De)return W(ye);if("object"!=typeof De)return W(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{Ur(De,!0);try{if(G.filter){const _e=p.createExpression(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===_e.result)throw new Error(_e.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));De={type:"FeatureCollection",features:De.features.filter(tt=>_e.value.evaluate({zoom:0},tt))}}this._geoJSONIndex=G.cluster?new ki(function({superclusterOptions:_e,clusterProperties:ke}){if(!ke||!_e)return _e;const tt={},it={},Je={accumulated:null,zoom:0},Gt={properties:null},en=Object.keys(ke);for(const Ut of en){const[tn,pn]=ke[Ut],xn=p.createExpression(pn),Ri=p.createExpression("string"==typeof tn?[tn,["accumulated"],["get",Ut]]:tn);tt[Ut]=xn.value,it[Ut]=Ri.value}return _e.map=Ut=>{Gt.properties=Ut;const tn={};for(const pn of en)tn[pn]=tt[pn].evaluate(Je,Gt);return tn},_e.reduce=(Ut,tn)=>{Gt.properties=tn;for(const pn of en)Je.accumulated=Ut[pn],Ut[pn]=it[pn].evaluate(Je,Gt)},_e}(G)).load(De.features):new Ma(_e=De,G.geojsonVtOptions)}catch(_e){return W(_e)}this.loaded={};const Ce={};if(me){const _e=p.getPerformanceMeasurement(se);_e&&(Ce.resourceTiming={},Ce.resourceTiming[G.source]=JSON.parse(JSON.stringify(_e)))}W(null,Ce)}var _e})}reloadTile(G,W){const se=this.loaded;return se&&se[G.uid]?super.reloadTile(G,W):this.loadTile(G,W)}loadGeoJSON(G,W){if(G.request)p.getJSON(G.request,W);else{if("string"!=typeof G.data)return W(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return W(null,JSON.parse(G.data))}catch{return W(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(se){W(se)}}getClusterChildren(G,W){try{W(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(se){W(se)}}getClusterLeaves(G,W){try{W(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(se){W(se)}}}class nh{constructor(G){this.self=G,this.actor=new p.Actor(G,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:ic},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(W,se)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=se},this.self.registerRTLTextPlugin=W=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=W.applyArabicShaping,p.plugin.processBidirectionalText=W.processBidirectionalText,p.plugin.processStyledBidirectionalText=W.processStyledBidirectionalText}}clearCaches(G,W,se){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],se()}checkIfReady(G,W,se){se()}setReferrer(G,W){this.referrer=W}spriteLoaded(G,W){this.isSpriteLoaded[G]=W;for(const se in this.workerSources[G]){const me=this.workerSources[G][se];for(const ye in me)me[ye]instanceof p.VectorTileWorkerSource&&(me[ye].isSpriteLoaded=W,me[ye].fire(new p.Event("isSpriteLoaded")))}}setImages(G,W,se){this.availableImages[G]=W;for(const me in this.workerSources[G]){const ye=this.workerSources[G][me];for(const De in ye)ye[De].availableImages=W}se()}enableTerrain(G,W,se){this.terrain=W,se()}setProjection(G,W){this.projections[G]=p.getProjection(W)}setLayers(G,W,se){this.getLayerIndex(G).replace(W),se()}updateLayers(G,W,se){this.getLayerIndex(G).update(W.layers,W.removedIds),se()}loadTile(G,W,se){const me=this.enableTerrain?p.extend({enableTerrain:this.terrain},W):W;me.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,W.type,W.source).loadTile(me,se)}loadDEMTile(G,W,se){const me=this.enableTerrain?p.extend({buildQuadTree:this.terrain},W):W;this.getDEMWorkerSource(G,W.source).loadTile(me,se)}reloadTile(G,W,se){const me=this.enableTerrain?p.extend({enableTerrain:this.terrain},W):W;me.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,W.type,W.source).reloadTile(me,se)}abortTile(G,W,se){this.getWorkerSource(G,W.type,W.source).abortTile(W,se)}removeTile(G,W,se){this.getWorkerSource(G,W.type,W.source).removeTile(W,se)}removeSource(G,W,se){if(!this.workerSources[G]||!this.workerSources[G][W.type]||!this.workerSources[G][W.type][W.source])return;const me=this.workerSources[G][W.type][W.source];delete this.workerSources[G][W.type][W.source],void 0!==me.removeSource?me.removeSource(W,se):se()}loadWorkerSource(G,W,se){try{this.self.importScripts(W.url),se()}catch(me){se(me.toString())}}syncRTLPluginState(G,W,se){try{p.plugin.setState(W);const me=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=me){this.self.importScripts(me);const ye=p.plugin.isParsed();se(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${me}`),ye)}}catch(me){se(me.toString())}}getAvailableImages(G){let W=this.availableImages[G];return W||(W=[]),W}getLayerIndex(G){let W=this.layerIndexes[G];return W||(W=this.layerIndexes[G]=new Lo),W}getWorkerSource(G,W,se){return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][W]||(this.workerSources[G][W]={}),this.workerSources[G][W][se]||(this.workerSources[G][W][se]=new this.workerSourceTypes[W]({send:(ye,De,Ce,_e,ke,tt)=>{this.actor.send(ye,De,Ce,G,ke,tt)},scheduler:this.actor.scheduler},this.getLayerIndex(G),this.getAvailableImages(G),this.isSpriteLoaded[G])),this.workerSources[G][W][se]}getDEMWorkerSource(G,W){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][W]||(this.demWorkerSources[G][W]=new Kt),this.demWorkerSources[G][W]}enforceCacheSizeLimit(G,W){p.enforceCacheSizeLimit(W)}getWorkerPerformanceMetrics(G,W,se){se(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new nh(self)),nh}),Od(0,function(p){function Ue(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let d=0;d<g.length;d++)if(!Ue(g[d],c[d]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==c){if("object"!=typeof c||Object.keys(g).length!==Object.keys(c).length)return!1;for(const d in g)if(!Ue(g[d],c[d]))return!1;return!0}return g===c}var Ds=Lo;function Lo(g){return c=g,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,b,E=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(E);try{b=new Worker(M),v=!0}catch{v=!1}return b&&b.terminate(),URL.revokeObjectURL(M),v}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var v=document.createElement("canvas");v.width=v.height=1;var b=v.getContext("2d");if(!b)return!1;var E=b.getImageData(0,0,1,1);return E&&E.width===v.width}()||(void 0===Kt[d=c&&c.failIfMajorPerformanceCaveat]&&(Kt[d]=function(v){var b,M,I,k,E=(M=v,I=document.createElement("canvas"),(k=Object.create(Lo.webGLContextAttributes)).failIfMajorPerformanceCaveat=M,I.getContext("webgl",k)||I.getContext("experimental-webgl",k));if(!E)return!1;try{b=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!b||E.isContextLost())&&(E.shaderSource(b,"void main() {}"),E.compileShader(b),!0===E.getShaderParameter(b,E.COMPILE_STATUS))}(d)),!Kt[d]||document.documentMode));var c,d}var Kt={};function Xt(g,c,d){const v=p.window.document.createElement(g);return void 0!==c&&(v.className=c),d&&d.appendChild(v),v}function Zi(g,c,d){const v=p.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const b of Object.keys(c))v.setAttributeNS(null,b,c[b]);return d&&d.appendChild(v),v}Lo.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ur=p.window.document&&p.window.document.documentElement.style,ns=Ur&&void 0!==Ur.userSelect?"userSelect":"WebkitUserSelect";let Zs;function Gc(){Ur&&ns&&(Zs=Ur[ns],Ur[ns]="none")}function Jl(){Ur&&ns&&(Ur[ns]=Zs)}function vo(g){g.preventDefault(),g.stopPropagation(),p.window.removeEventListener("click",vo,!0)}function Fo(){p.window.addEventListener("click",vo,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",vo,!0)},0)}function ro(g,c){const d=g.getBoundingClientRect();return is(g,d,c)}function al(g,c){const d=g.getBoundingClientRect(),v=[];for(let b=0;b<c.length;b++)v.push(is(g,d,c[b]));return v}function Xs(g){return void 0!==p.window.InstallTrigger&&2===g.button&&g.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function is(g,c,d){const v=g.offsetWidth===c.width?1:g.offsetWidth/c.width;return new p.Point((d.clientX-c.left)*v,(d.clientY-c.top)*v)}function at(g,c){var d=c[0],v=c[1],b=c[2],E=c[3],M=d*E-b*v;return M?(g[0]=E*(M=1/M),g[1]=-v*M,g[2]=-b*M,g[3]=d*M,g):null}function Ld(g){const{userImage:c}=g;return!!(c&&c.render&&c.render())&&(g.data.replace(new Uint8Array(c.data.buffer)),!0)}class ll extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:d,callback:v}of this.requestors)this._notify(d,v);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,d){this._validate(c,d)&&(this.images[c]=d)}_validate(c,d){let v=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),v=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),v=!1),this._validateContent(d.content,d)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),v=!1),v}_validateStretch(c,d){if(!c)return!0;let v=0;for(const b of c){if(b[0]<v||b[1]<b[0]||d<b[1])return!1;v=b[1]}return!0}_validateContent(c,d){return!(c&&(4!==c.length||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0}removeImage(c){const d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,d){let v=!0;if(!this.isLoaded())for(const b of c)this.images[b]||(v=!1);this.isLoaded()||v?this._notify(c,d):this.requestors.push({ids:c,callback:d})}_notify(c,d){const v={};for(const b of c){this.images[b]||this.fire(new p.Event("styleimagemissing",{id:b}));const E=this.images[b];E?v[b]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:Boolean(E.userImage&&E.userImage.render)}:p.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,v)}getPixelSize(){const{width:c,height:d}=this.atlasImage;return{width:c,height:d}}getPattern(c){const d=this.patterns[c],v=this.getImage(c);if(!v)return null;if(d&&d.position.version===v.version)return d.position;if(d)d.position.version=v.version;else{const b={w:v.data.width+2,h:v.data.height+2,x:0,y:0},E=new p.ImagePosition(b,v);this.patterns[c]={bin:b,position:E}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture&&this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const E in this.patterns)c.push(this.patterns[E].bin);const{w:d,h:v}=p.potpack(c),b=this.atlasImage;b.resize({width:d||1,height:v||1});for(const E in this.patterns){const{bin:M}=this.patterns[E],I=M.x+1,k=M.y+1,F=this.images[E].data,L=F.width,j=F.height;p.RGBAImage.copy(F,b,{x:0,y:0},{x:I,y:k},{width:L,height:j}),p.RGBAImage.copy(F,b,{x:0,y:j-1},{x:I,y:k-1},{width:L,height:1}),p.RGBAImage.copy(F,b,{x:0,y:0},{x:I,y:k+j},{width:L,height:1}),p.RGBAImage.copy(F,b,{x:L-1,y:0},{x:I-1,y:k},{width:1,height:j}),p.RGBAImage.copy(F,b,{x:0,y:0},{x:I+L,y:k},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const d of c){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const v=this.images[d];Ld(v)&&this.updateImage(d,v)}}}const an=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(g,c){return function([d,v,b]){const E=p.degToRad(v+90),M=p.degToRad(b);return{x:d*Math.cos(E)*Math.sin(M),y:d*Math.sin(E)*Math.sin(M),z:d*Math.cos(M),azimuthal:v,polar:b}}(g.expression.evaluate(c))}interpolate(g,c,d){return{x:p.number(g.x,c.x,d),y:p.number(g.y,c.y,d),z:p.number(g.z,c.z,d),azimuthal:p.number(g.azimuthal,c.azimuthal,d),polar:p.number(g.polar,c.polar,d)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class sr extends p.Evented{constructor(c){super(),this._transitionable=new p.Transitionable(an),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,d={}){if(!this._validate(p.validateLight,c,d))for(const v in c){const b=c[v];p.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),b):this._transitionable.setValue(v,b)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,d,v){return(!v||!1!==v.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const Wc=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let Ju=class extends p.Evented{constructor(g,c){super(),this._transitionable=new p.Transitionable(Wc),this.set(g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(g){for(const c in g){const d=g[c];p.endsWith(c,"-transition")?this._transitionable.setTransition(c.slice(0,-11),d):this._transitionable.setValue(c,d)}}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}};function cl(g,c,d,v){const b=p.smoothstep(45,65,d),[E,M]=rs(g,v),I=p.length(c);let k=1-Math.min(1,Math.exp((I-E)/(M-E)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*b*g.alpha}function rs(g,c){const d=.5/Math.tan(.5*c);return[g.range[0]+d,g.range[1]+d]}const hn=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class ul extends p.Evented{constructor(c,d){super(),this._transitionable=new p.Transitionable(hn),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){const c=this._transform,d="globe"===c.projection.name,v=p.globeToMercatorTransition(c.zoom),b=this.properties.get("range"),E=[.5,3];return{range:d?[p.number(E[0],b[0],v),p.number(E[1],b[1],v)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,d={}){if(!this._validate(p.validateFog,c,d)){for(const v of Object.keys(p.spec.fog))c&&void 0===c[v]&&(c[v]=p.spec.fog[v].default);for(const v in c){const b=c[v];p.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),b):this._transitionable.setValue(v,b)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,c))*d.a}getOpacityAtLatLng(c,d){return this._transform.projection.supportsFog?function(v,b,E){const M=p.MercatorCoordinate.fromLngLat(b),I=E.elevation?E.elevation.getAtPointOrZero(M):0,k=[M.x,M.y,I];return p.transformMat4(k,k,E.mercatorFogMatrix),cl(v,k,E.pitch,E._fov)}(this.state,c,d):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?rs(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,d,v){return(!v||!1!==v.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class fn{constructor(c,d){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const v=this.workerPool.acquire(this.id);for(let b=0;b<v.length;b++){const E=new fn.Actor(v[b],d,this.id);E.name=`Worker ${b}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,d,v){p.asyncAll(this.actors,(b,E)=>{b.send(c,d,E)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Xi(g,c,d){return c*(p.EXTENT/(g.tileSize*Math.pow(2,d-g.tileID.overscaledZ)))}fn.Actor=p.Actor;class Ca{constructor(c,d,v,b){this.screenBounds=c,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(c,d){let v,b;if(c instanceof p.Point||"number"==typeof c[0]){const E=p.Point.convert(c);v=[E],b=d.isPointAboveHorizon(E)}else{const E=p.Point.convert(c[0]),M=p.Point.convert(c[1]);v=[E,M],b=p.polygonizeBounds(E,M).every(I=>d.isPointAboveHorizon(I))}return new Ca(v,d.getCameraPoint(),b,d)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const d=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],b=p.polygonizeBounds(d,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<v.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),p.bufferConvexPolygon(b,c)}bufferedCameraGeometryGlobe(c){const d=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],b=p.polygonizeBounds(d,v,c),E=this.cameraPoint.clone();switch(3*((E.y>d.y)+(E.y>v.y))+((E.x>d.x)+(E.x>v.x))){case 0:b[0]=E,b[4]=E.clone();break;case 1:b.splice(1,0,E);break;case 2:b[1]=E;break;case 3:b.splice(4,0,E);break;case 5:b.splice(2,0,E);break;case 6:b[3]=E;break;case 7:b.splice(3,0,E);break;case 8:b[2]=E}return b}containsTile(c,d,v,b=0){const E=c.queryPadding/d._pixelsPerMercatorPixel+1,M=v?this._bufferedCameraMercator(E,d):this._bufferedScreenMercator(E,d);let I=c.tileID.wrap+(M.unwrapped?b:0);const k=M.polygon.map(ee=>p.getTilePoint(c.tileTransform,ee,I));if(!p.polygonIntersectsBox(k,0,0,p.EXTENT,p.EXTENT))return;I=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const F=this.screenGeometryMercator.polygon.map(ee=>p.getTileVec3(c.tileTransform,ee,I)),L=F.map(ee=>new p.Point(ee[0],ee[1])),j=d.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),q=p.getTileVec3(c.tileTransform,j,I),K=F.map(ee=>{const U=p.sub(ee,ee,q);return p.normalize(U,U),new p.Ray(q,U)}),Q=Xi(c,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:K,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(J=p.getBounds(k),J.min.x=p.clamp(J.min.x,0,p.EXTENT),J.min.y=p.clamp(J.min.y,0,p.EXTENT),J.max.x=p.clamp(J.max.x,0,p.EXTENT),J.max.y=p.clamp(J.max.y,0,p.EXTENT),J),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:Q};var J}_bufferedScreenMercator(c,d){const v=oo(c);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let b;return b="globe"===d.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),d):{polygon:this.bufferedScreenGeometry(c).map(E=>d.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[v]=b,b}}_bufferedCameraMercator(c,d){const v=oo(c);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let b;return b="globe"===d.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),d):{polygon:this.bufferedCameraGeometry(c).map(E=>d.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[v]=b,b}}_projectAndResample(c,d){const v=function(E,M){const I=p.multiply([],M.pixelMatrix,M.globeMatrix),k=[0,-p.GLOBE_RADIUS,0,1],F=[0,p.GLOBE_RADIUS,0,1],L=[0,0,0,1];p.transformMat4$1(k,k,I),p.transformMat4$1(F,F,I),p.transformMat4$1(L,L,I);const j=new p.Point(k[0]/k[3],k[1]/k[3]),q=new p.Point(F[0]/F[3],F[1]/F[3]),K=p.polygonContainsPoint(E,j)&&k[3]<L[3],Q=p.polygonContainsPoint(E,q)&&F[3]<L[3];if(!K&&!Q)return null;const J=function(de,be,xe){for(let Ie=1;Ie<de.length;Ie++){const Xe=Ea(be.pointCoordinate3D(de[Ie-1]).x),Te=Ea(be.pointCoordinate3D(de[Ie]).x);if(xe<0){if(Xe<Te)return{idx:Ie,t:-Xe/(Te-1-Xe)}}else if(Te<Xe)return{idx:Ie,t:(1-Xe)/(Te+1-Xe)}}return null}(E,M,K?-1:1);if(!J)return null;const{idx:ee,t:U}=J;let Y=ee>1?ki(E.slice(0,ee),M):[],ie=ee<E.length?ki(E.slice(ee),M):[];Y=Y.map(de=>new p.Point(Ea(de.x),de.y)),ie=ie.map(de=>new p.Point(Ea(de.x),de.y));const re=[...Y];0===re.length&&re.push(ie[ie.length-1]);const fe=p.number(re[re.length-1].y,(0===ie.length?Y[0]:ie[0]).y,U);let ge;return ge=K?[new p.Point(0,fe),new p.Point(0,0),new p.Point(1,0),new p.Point(1,fe)]:[new p.Point(1,fe),new p.Point(1,1),new p.Point(0,1),new p.Point(0,fe)],re.push(...ge),0===ie.length?re.push(Y[0]):re.push(...ie),{polygon:re.map(de=>new p.MercatorCoordinate(de.x,de.y)),unwrapped:!1}}(c,d);if(v)return v;const b=function(E,M){let I=!1,k=-1/0,F=0;for(let j=0;j<E.length-1;j++)E[j].x>k&&(k=E[j].x,F=j);for(let j=0;j<E.length-1;j++){const q=(F+j)%(E.length-1),K=E[q],Q=E[q+1];Math.abs(K.x-Q.x)>.5&&(K.x<Q.x?(K.x+=1,0===q&&(E[E.length-1].x+=1)):(Q.x+=1,q+1===E.length-1&&(E[0].x+=1)),I=!0)}const L=p.mercatorXfromLng(M.center.lng);return I&&L<Math.abs(L-1)&&E.forEach(j=>{j.x-=1}),{polygon:E,unwrapped:I}}(ki(c,d).map(E=>new p.Point(Ea(E.x),E.y)),d);return{polygon:b.polygon.map(E=>new p.MercatorCoordinate(E.x,E.y)),unwrapped:b.unwrapped}}}function ki(g,c){return p.resample(g,d=>{const v=c.pointCoordinate3D(d);d.x=v.x,d.y=v.y},1/256)}function Ea(g){return g<0?1+g%1:g%1}function oo(g){return 100*g|0}function Ys(g,c,d,v,b){const E=function(M,I){if(M)return b(M);if(I){g.url&&I.tiles&&g.tiles&&delete g.tiles;const k=p.pick(p.extend(I,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(k.vectorLayers=I.vector_layers,k.vectorLayerIds=k.vectorLayers.map(F=>F.id)),k.tiles=c.canonicalizeTileset(k,g.url),b(null,k)}};return g.url?p.getJSON(c.transformRequest(c.normalizeSourceURL(g.url,null,d,v),p.ResourceType.Source),E):p.exported.frame(()=>E(null,g))}class Ts{constructor(c,d,v){this.bounds=p.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=d||0,this.maxzoom=v||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const d=Math.pow(2,c.z),v=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*d),b=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*d),E=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*d),M=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*d);return c.x>=v&&c.x<E&&c.y>=b&&c.y<M}}class gi{constructor(c,d,v){this.context=c;const b=c.gl;this.buffer=b.createBuffer(),this.dynamicDraw=Boolean(v),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ql{constructor(c,d,v,b){this.length=d.length,this.attributes=v,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.context=c;const E=c.gl;this.buffer=E.createBuffer(),c.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,d){for(let v=0;v<this.attributes.length;v++){const b=d.attributes[this.attributes[v].name];void 0!==b&&c.enableVertexAttribArray(b)}}setVertexAttribPointers(c,d,v){for(let b=0;b<this.attributes.length;b++){const E=this.attributes[b],M=d.attributes[E.name];void 0!==M&&c.vertexAttribPointer(M,E.components,c[Yn[E.type]],!1,this.itemSize,E.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class dt{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Da extends dt{getDefault(){return p.Color.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class xo extends dt{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class hl extends dt{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class ui extends dt{getDefault(){return[!0,!0,!0,!0]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class zo extends dt{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Qu extends dt{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Ta extends dt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class No extends dt{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class eh extends dt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}}class qc extends dt{getDefault(){return[0,1]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class Zc extends dt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}}class Ks extends dt{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class ec extends dt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}}class tc extends dt{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class th extends dt{getDefault(){return p.Color.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class so extends dt{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class Js extends dt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}}class Xc extends dt{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class dl extends dt{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let nc,Bo=class extends dt{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class Sa extends dt{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Ma extends dt{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Ia extends dt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class fl extends dt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class ic extends dt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class nh extends dt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class ue extends dt{getDefault(){return null}set(c){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class G extends dt{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class W extends dt{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class se extends dt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class me extends dt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class ye extends dt{constructor(c,d){super(c),this.context=c,this.parent=d}getDefault(){return null}}class De extends ye{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Ce extends ye{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class _e extends Ce{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ke{constructor(c,d,v,b){this.context=c,this.width=d,this.height=v;const E=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new De(c,E),b&&(this.depthAttachment=new Ce(c,E))}destroy(){const c=this.context.gl,d=this.colorAttachment.get();if(d&&c.deleteTexture(d),this.depthAttachment){const v=this.depthAttachment.get();v&&c.deleteRenderbuffer(v)}c.deleteFramebuffer(this.framebuffer)}}class tt{constructor(c,d=!1){if(this.gl=c,this.isWebGL2=d,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),d){const v=c;this.extVertexArrayObject={createVertexArrayOES:v.createVertexArray.bind(c),deleteVertexArrayOES:v.deleteVertexArray.bind(c),bindVertexArrayOES:v.bindVertexArray.bind(c)}}this.clearColor=new Da(this),this.clearDepth=new xo(this),this.clearStencil=new hl(this),this.colorMask=new ui(this),this.depthMask=new zo(this),this.stencilMask=new Qu(this),this.stencilFunc=new Ta(this),this.stencilOp=new No(this),this.stencilTest=new eh(this),this.depthRange=new qc(this),this.depthTest=new Zc(this),this.depthFunc=new Ks(this),this.blend=new ec(this),this.blendFunc=new tc(this),this.blendColor=new th(this),this.blendEquation=new so(this),this.cullFace=new Js(this),this.cullFaceSide=new Xc(this),this.frontFace=new dl(this),this.program=new Bo(this),this.activeTexture=new Sa(this),this.viewport=new Ma(this),this.bindFramebuffer=new Ia(this),this.bindRenderbuffer=new fl(this),this.bindTexture=new ic(this),this.bindVertexBuffer=new nh(this),this.bindElementBuffer=new ue(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new G(this),this.pixelStoreUnpack=new W(this),this.pixelStoreUnpackPremultiplyAlpha=new se(this),this.pixelStoreUnpackFlipY=new me(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),d||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(d||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=d||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,d){return new gi(this,c,d)}createVertexBuffer(c,d,v){return new Ql(this,c,d,v)}createRenderbuffer(c,d,v){const b=this.gl,E=b.createRenderbuffer();return this.bindRenderbuffer.set(E),b.renderbufferStorage(b.RENDERBUFFER,c,d,v),this.bindRenderbuffer.set(null),E}createFramebuffer(c,d,v){return new ke(this,c,d,v)}clear({color:c,depth:d,stencil:v}){const b=this.gl;let E=0;c&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),void 0!==v&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),b.clear(E)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){Ue(c.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class it extends p.Evented{constructor(c,d,v,b){if(super(),this.id=c,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(d,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=Ys(this._options,this.map._requestManager,d,v,(b,E)=>{this._tileJSONRequest=null,this._loaded=!0,b?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),v&&2!==v.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new p.ErrorEvent(b))):E&&(p.extend(this,E),E.bounds&&(this.tileBounds=new Ts(E.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(E.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(b)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(c,d){const v=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(v,p.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(b.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=d:c.request=c.actor.send("reloadTile",b,E.bind(this));else if(c.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",b,E.bind(this),void 0,!0);else{const M=p.loadVectorTile.call({deduped:this._deduped},b,(I,k)=>{I||!k?E.call(this,I):(b.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},c.actor&&c.actor.send("loadTile",b,E.bind(this),void 0,!0))},!0);c.request={cancel:M}}function E(M,I){return delete c.request,c.aborted?d(null):M&&404!==M.status?d(M):(I&&I.resourceTiming&&(c.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&c.setExpiryData(I),c.loadVectorData(I,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Je extends p.Evented{constructor(c,d,v,b){super(),this.id=c,this.dispatcher=v,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},d),p.extend(this,p.pick(d,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ys(this._options,this.map._requestManager,null,null,(d,v)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new p.ErrorEvent(d)):v&&(p.extend(this,v),v.bounds&&(this.tileBounds=new Ts(v.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(v.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(d)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,d){const v=p.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);c.request=p.getImage(this.map._requestManager.transformRequest(b,p.ResourceType.Tile),(E,M,I,k)=>(delete c.request,c.aborted?(c.state="unloaded",d(null)):E?(c.state="errored",d(E)):M?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:I,expires:k}),c.setTexture(M,this.map.painter),c.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(c,d,v){c.setTexture(d,v)}static unloadTileData(c,d){c.texture&&d.saveTileTexture(c.texture)}abortTile(c,d){c.request&&(c.request.cancel(),delete c.request),d()}unloadTile(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Gt(g,c,d,v,b,E,M,I){const k=[g,d,b,c,v,E,1,1,1],F=[M,I,1],L=p.adjoint([],k),[j,q,K]=p.transformMat3(F,F,p.transpose(L,L));return p.multiply$1(k,[j,0,0,0,q,0,0,0,K],k)}class en extends p.Evented{constructor(c,d,v,b){super(),this.id=c,this.dispatcher=v,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=d,this._dirty=!1}load(c,d){this._loaded=d||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(v,b)=>{if(this._imageRequest=null,this._loaded=!0,v)this.fire(new p.ErrorEvent(v));else if(b){const{HTMLImageElement:E}=p.window;this.image=b instanceof E?p.exported.getImageData(b):b,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const d=c.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(v){let b=1/0,E=1/0,M=-1/0,I=-1/0;for(const j of v)b=Math.min(b,j.x),E=Math.min(E,j.y),M=Math.max(M,j.x),I=Math.max(I,j.y);const k=Math.max(M-b,I-E),F=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),L=Math.pow(2,F);return new p.CanonicalTileID(F,Math.floor((b+M)/2*L),Math.floor((E+I)/2*L))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const k in this.tiles){const F=this.tiles[k];"loaded"!==F.state&&(F.state="loaded",F.texture=this.texture)}if(this._boundsArray)return;const d=p.tileTransform(this.tileID,this.map.transform.projection),[v,b,E,M]=this.coordinates.map(k=>{const F=d.projection.project(k[0],k[1]);return p.getTilePoint(d,F)._round()});this.perspectiveTransform=function(k,F,L,j,q,K,Q,J,ee,U){const Y=Gt(0,0,k,0,0,F,k,F),ie=Gt(L,j,q,K,Q,J,ee,U);return p.multiply$1(ie,p.adjoint(Y,Y),ie),[ie[6]/ie[8]*k/p.EXTENT,ie[7]/ie[8]*F/p.EXTENT]}(this.width,this.height,v.x,v.y,b.x,b.y,M.x,M.y,E.x,E.y);const I=this._boundsArray=new p.StructArrayLayout4i8;I.emplaceBack(v.x,v.y,0,0),I.emplaceBack(b.x,b.y,p.EXTENT,0),I.emplaceBack(M.x,M.y,0,p.EXTENT),I.emplaceBack(E.x,E.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(I,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,d=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ut={vector:it,raster:Je,"raster-dem":class extends Je{constructor(g,c,d,v){super(g,c,d,v),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(g,c){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(b,E){b&&(g.state="errored",c(b)),E&&(g.dem=E,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",c(null))}g.request=p.getImage(this.map._requestManager.transformRequest(d,p.ResourceType.Tile),function(b,E,M,I){if(delete g.request,g.aborted)g.state="unloaded",c(null);else if(b)g.state="errored",c(b);else if(E){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:M,expires:I});const k=p.window.ImageBitmap&&E instanceof p.window.ImageBitmap&&(null==nc&&(nc=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),nc),F=1-(E.width-p.prevPowerOfTwo(E.width))/2;F<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const L=k?E:p.exported.getImageData(E,F),j={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:F};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",j,v.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const c=g.canonical,d=Math.pow(2,c.z),v=(c.x-1+d)%d,b=0===c.x?g.wrap-1:g.wrap,E=(c.x+1+d)%d,M=c.x+1===d?g.wrap+1:g.wrap,I={};return I[new p.OverscaledTileID(g.overscaledZ,b,c.z,v,c.y).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,M,c.z,E,c.y).key]={backfilled:!1},c.y>0&&(I[new p.OverscaledTileID(g.overscaledZ,b,c.z,v,c.y-1).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,M,c.z,E,c.y-1).key]={backfilled:!1}),c.y+1<d&&(I[new p.OverscaledTileID(g.overscaledZ,b,c.z,v,c.y+1).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,M,c.z,E,c.y+1).key]={backfilled:!1}),I}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends p.Evented{constructor(g,c,d,v){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(v),this._data=c.data,this._options=p.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const b=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*b,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*b,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*b,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},c),this}getClusterChildren(g,c){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},c),this}getClusterLeaves(g,c,d,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:c,offset:d},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=p.extend({},this.workerOptions),c=this._data;"string"==typeof c?(g.request=this.map._requestManager.transformRequest(p.exported.resolveURL(c),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(d,v)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new p.ErrorEvent(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(b.resourceTiming=v.resourceTiming[this.id]),this.fire(new p.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,c){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(d,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(v,b)=>(delete g.request,g.unloadVectorData(),g.aborted?c(null):v?c(v):(g.loadVectorData(b,this.map.painter,"reloadTile"===d),c(null))),void 0,"loadTile"===d)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends en{constructor(g,c,d,v){super(g,c,d,v),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const c of g.urls)this.urls.push(this.map._requestManager.transformRequest(c,p.ResourceType.Source).url);p.getVideo(this.urls,(c,d)=>{this._loaded=!0,c?this.fire(new p.ErrorEvent(c)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const c=this.video.seekable;g<c.start(0)||g>c.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,c=g.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(g,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:en,canvas:class extends en{constructor(g,c,d,v){super(g,c,d,v),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(E=>"number"!=typeof E))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends p.Evented{constructor(g,c,d,v){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=c,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ts(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:c,y:d,z:v}=g.canonical;return this._implementation.hasTile({x:c,y:d,z:v})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,c){const{x:d,y:v,z:b}=g.tileID.canonical,E=new p.window.AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:d,y:v,z:b},{signal:E.signal})).then(function(M){return delete g.request,g.aborted?(g.state="unloaded",c(null)):void 0===M?(g.state="errored",c(null)):null===M?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",c(null)):(I=M)instanceof p.window.ImageData||I instanceof p.window.HTMLCanvasElement||I instanceof p.window.ImageBitmap||I instanceof p.window.HTMLImageElement?(this.loadTileData(g,M),g.state="loaded",void c(null)):(g.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var I}.bind(this)).catch(M=>{20!==M.code&&(g.state="errored",c(M))}),g.request.cancel=()=>E.abort()}loadTileData(g,c){Je.loadTileData(g,c,this._map.painter)}unloadTileData(g){Je.unloadTileData(g,this._map.painter)}unloadTile(g,c){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:d,y:v,z:b}=g.tileID.canonical;this._implementation.unloadTile({x:d,y:v,z:b})}c()}abortTile(g,c){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},tn=function(g,c,d,v){const b=new Ut[c.type](g,c,d,v);if(b.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${b.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],b),b};function pn(g,c){const d=p.identity([]);return p.scale(d,d,[.5*g.width,.5*-g.height,1]),p.translate(d,d,[1,-1,0]),p.multiply(d,d,g.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(d)}function xn(g,c,d,v,b,E,M,I=!1){const k=g.tilesIn(v,M,I);k.sort(Tr);const F=[];for(const j of k)F.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(c,d,g._state,j,b,E,pn(g.transform,j.tile.tileID),I)});const L=function(j){const q={},K={};for(const Q of j){const J=Q.queryResults,ee=Q.wrappedTileID,U=K[ee]=K[ee]||{};for(const Y in J){const ie=J[Y],re=U[Y]=U[Y]||{},fe=q[Y]=q[Y]||[];for(const ge of ie)re[ge.featureIndex]||(re[ge.featureIndex]=!0,fe.push(ge))}}return q}(F);for(const j in L)L[j].forEach(q=>{const K=q.feature,Q=K.layer;Q&&"background"!==Q.type&&"sky"!==Q.type&&(K.source=Q.source,Q["source-layer"]&&(K.sourceLayer=Q["source-layer"]),K.state=void 0!==K.id?g.getFeatureState(Q["source-layer"],K.id):{})});return L}function Ri(g,c){const d=g.getRenderableIds().map(E=>g.getTileByID(E)),v=[],b={};for(let E=0;E<d.length;E++){const M=d[E],I=M.tileID.canonical.key;b[I]||(b[I]=!0,M.querySourceFeatures(v,c))}return v}function Tr(g,c){const d=g.tileID,v=c.tileID;return d.overscaledZ-v.overscaledZ||d.canonical.y-v.canonical.y||d.wrap-v.wrap||d.canonical.x-v.canonical.x}function ji(){return null!=fo.workerClass?new fo.workerClass:new p.window.Worker(fo.workerUrl)}const Ss="mapboxgl_preloaded_worker_pool";class Yi{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<Yi.workerCount;)this.workers.push(new ji);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ss]}numActive(){return Object.keys(this.active).length}}let $r;function rc(){return $r||($r=new Yi),$r}function Qs(g,c){const d={};for(const v in g)"ref"!==v&&(d[v]=g[v]);return p.refProperties.forEach(v=>{v in c&&(d[v]=c[v])}),d}function wp(g){g=g.slice();const c=Object.create(null);for(let d=0;d<g.length;d++)c[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=Qs(g[d],c[g[d].ref]));return g}Yi.workerCount=2;const Lt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Aa(g,c,d){d.push({command:Lt.addSource,args:[g,c[g]]})}function ao(g,c,d){c.push({command:Lt.removeSource,args:[g]}),d[g]=!0}function Cp(g,c,d,v){ao(g,d,v),Aa(g,c,d)}function ih(g,c,d){let v;for(v in g[d])if(g[d].hasOwnProperty(v)&&"data"!==v&&!Ue(g[d][v],c[d][v]))return!1;for(v in c[d])if(c[d].hasOwnProperty(v)&&"data"!==v&&!Ue(g[d][v],c[d][v]))return!1;return!0}function os(g,c,d,v,b,E){let M;for(M in c=c||{},g=g||{})g.hasOwnProperty(M)&&(Ue(g[M],c[M])||d.push({command:E,args:[v,M,c[M],b]}));for(M in c)c.hasOwnProperty(M)&&!g.hasOwnProperty(M)&&(Ue(g[M],c[M])||d.push({command:E,args:[v,M,c[M],b]}))}function ss(g){return g.id}function rh(g,c){return g[c.id]=c,g}class pl{constructor(c,d){this.reset(c,d)}reset(c,d){this.points=c||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=p.clamp(c,0,1);let d=1,v=this._distances[d];const b=c*this.paddedLength+this.padding;for(;v<b&&d<this._distances.length;)v=this._distances[++d];const E=d-1,M=this._distances[E],I=v-M,k=I>0?(b-M)/I:0;return this.points[E].mult(1-k).add(this.points[d].mult(k))}}class ml{constructor(c,d,v){const b=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(c/v),this.yCellCount=Math.ceil(d/v);for(let M=0;M<this.xCellCount*this.yCellCount;M++)b.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=d,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,d,v,b,E){this._forEachCell(d,v,b,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(d),this.bboxes.push(v),this.bboxes.push(b),this.bboxes.push(E)}insertCircle(c,d,v,b){this._forEachCell(d-b,v-b,d+b,v+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(d),this.circles.push(v),this.circles.push(b)}_insertBoxCell(c,d,v,b,E,M){this.boxCells[E].push(M)}_insertCircleCell(c,d,v,b,E,M){this.circleCells[E].push(M)}_query(c,d,v,b,E,M){if(v<0||c>this.width||b<0||d>this.height)return!E&&[];const I=[];if(c<=0&&d<=0&&this.width<=v&&this.height<=b){if(E)return!0;for(let k=0;k<this.boxKeys.length;k++)I.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const F=this.circles[3*k],L=this.circles[3*k+1],j=this.circles[3*k+2];I.push({key:this.circleKeys[k],x1:F-j,y1:L-j,x2:F+j,y2:L+j})}return M?I.filter(M):I}return this._forEachCell(c,d,v,b,this._queryCell,I,{hitTest:E,seenUids:{box:{},circle:{}}},M),E?I.length>0:I}_queryCircle(c,d,v,b,E){const M=c-v,I=c+v,k=d-v,F=d+v;if(I<0||M>this.width||F<0||k>this.height)return!b&&[];const L=[];return this._forEachCell(M,k,I,F,this._queryCellCircle,L,{hitTest:b,circle:{x:c,y:d,radius:v},seenUids:{box:{},circle:{}}},E),b?L.length>0:L}query(c,d,v,b,E){return this._query(c,d,v,b,!1,E)}hitTest(c,d,v,b,E){return this._query(c,d,v,b,!0,E)}hitTestCircle(c,d,v,b){return this._queryCircle(c,d,v,!0,b)}_queryCell(c,d,v,b,E,M,I,k){const F=I.seenUids,L=this.boxCells[E];if(null!==L){const q=this.bboxes;for(const K of L)if(!F.box[K]){F.box[K]=!0;const Q=4*K;if(c<=q[Q+2]&&d<=q[Q+3]&&v>=q[Q+0]&&b>=q[Q+1]&&(!k||k(this.boxKeys[K]))){if(I.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[K],x1:q[Q],y1:q[Q+1],x2:q[Q+2],y2:q[Q+3]})}}}const j=this.circleCells[E];if(null!==j){const q=this.circles;for(const K of j)if(!F.circle[K]){F.circle[K]=!0;const Q=3*K;if(this._circleAndRectCollide(q[Q],q[Q+1],q[Q+2],c,d,v,b)&&(!k||k(this.circleKeys[K]))){if(I.hitTest)return M.push(!0),!0;{const J=q[Q],ee=q[Q+1],U=q[Q+2];M.push({key:this.circleKeys[K],x1:J-U,y1:ee-U,x2:J+U,y2:ee+U})}}}}}_queryCellCircle(c,d,v,b,E,M,I,k){const F=I.circle,L=I.seenUids,j=this.boxCells[E];if(null!==j){const K=this.bboxes;for(const Q of j)if(!L.box[Q]){L.box[Q]=!0;const J=4*Q;if(this._circleAndRectCollide(F.x,F.y,F.radius,K[J+0],K[J+1],K[J+2],K[J+3])&&(!k||k(this.boxKeys[Q])))return M.push(!0),!0}}const q=this.circleCells[E];if(null!==q){const K=this.circles;for(const Q of q)if(!L.circle[Q]){L.circle[Q]=!0;const J=3*Q;if(this._circlesCollide(K[J],K[J+1],K[J+2],F.x,F.y,F.radius)&&(!k||k(this.circleKeys[Q])))return M.push(!0),!0}}}_forEachCell(c,d,v,b,E,M,I,k){const F=this._convertToXCellCoord(c),L=this._convertToYCellCoord(d),j=this._convertToXCellCoord(v),q=this._convertToYCellCoord(b);for(let K=F;K<=j;K++)for(let Q=L;Q<=q;Q++)if(E.call(this,c,d,v,b,this.xCellCount*Q+K,M,I,k))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,d,v,b,E,M){const I=b-c,k=E-d,F=v+M;return F*F>I*I+k*k}_circleAndRectCollide(c,d,v,b,E,M,I){const k=(M-b)/2,F=Math.abs(c-(b+k));if(F>k+v)return!1;const L=(I-E)/2,j=Math.abs(d-(E+L));if(j>L+v)return!1;if(F<=k||j<=L)return!0;const q=F-k,K=j-L;return q*q+K*K<=v*v}}const Ms={unknown:0,flipRequired:1,flipNotRequired:2},oc=Math.tan(85*Math.PI/180);function ze(g,c,d,v,b,E,M){const I=p.create();if(d)if("globe"===E.name){const k=p.calculateGlobeLabelMatrix(b,c);p.multiply(I,I,k)}else{const k=at([],M);I[0]=k[0],I[1]=k[1],I[4]=k[2],I[5]=k[3],v||p.rotateZ(I,I,b.angle)}else p.multiply(I,b.labelPlaneMatrix,g);return I}function ea(g,c,d,v,b,E,M){const I=ze(g,c,d,v,b,E,M);return"globe"===E.name&&d||(I[2]=I[6]=I[10]=I[14]=0),I}function Oi(g,c,d,v,b,E,M){if(d){if("globe"===E.name){const I=ze(g,c,d,v,b,E,M);return p.invert(I,I),p.multiply(I,g,I),I}{const I=p.clone(g),k=p.identity([]);return k[0]=M[0],k[1]=M[1],k[4]=M[2],k[5]=M[3],p.multiply(I,I,k),v||p.rotateZ(I,I,-b.angle),I}}return b.glCoordMatrix}function ar(g,c,d,v){const b=[g,c,d,1];d?p.transformMat4$1(b,b,v):nn(b,b,v);const E=b[3];return b[0]/=E,b[1]/=E,b[2]/=E,b}function Fd(g,c){return Math.min(.5+g/c*.5,1.5)}function Is(g,c){const d=g[0]/g[3],v=g[1]/g[3];return d>=-c[0]&&d<=c[0]&&v>=-c[1]&&v<=c[1]}function zd(g,c,d,v,b,E,M,I,k,F){const L=d.transform,j=v?g.textSizeData:g.iconSizeData,q=p.evaluateSizeForZoom(j,d.transform.zoom),K="globe"===L.projection.name,Q=[256/d.width*2+1,256/d.height*2+1],J=v?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;J.clear();let ee=null;K&&(ee=v?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const U=g.lineVertexArray,Y=v?g.text.placedSymbolArray:g.icon.placedSymbolArray,ie=d.transform.width/d.transform.height;let re,fe=!1;for(let ge=0;ge<Y.length;ge++){const de=Y.get(ge),{numGlyphs:be,writingMode:xe}=de;if(xe!==p.WritingMode.vertical||fe||re===p.WritingMode.horizontal||(fe=!0),re=xe,(de.hidden||xe===p.WritingMode.vertical)&&!fe){Tn(be,J);continue}fe=!1;const Ie=new p.Point(de.tileAnchorX,de.tileAnchorY);let{x:Xe,y:Te,z:je}=L.projection.projectTilePoint(Ie.x,Ie.y,F.canonical);if(k){const[zt,mt,Tt]=k(Ie);Xe+=zt,Te+=mt,je+=Tt}const Pe=[Xe,Te,je,1];if(p.transformMat4$1(Pe,Pe,c),!Is(Pe,Q)){Tn(be,J);continue}const We=Fd(d.transform.cameraToCenterDistance,Pe[3]),Se=p.evaluateSizeForFeature(j,q,de),Ne=M?Se/We:Se*We,Ye=ar(Xe,Te,je,b);if(Ye[3]<=0){Tn(be,J);continue}let $e={};const qe=M?null:k,_t=ct(de,Ne,!1,I,c,b,E,g.glyphOffsetArray,U,J,ee,Ye,Ie,$e,ie,qe,L.projection,F,M);fe=_t.useVertical,qe&&_t.needsFlipping&&($e={}),(_t.notEnoughRoom||fe||_t.needsFlipping&&ct(de,Ne,!0,I,c,b,E,g.glyphOffsetArray,U,J,ee,Ye,Ie,$e,ie,qe,L.projection,F,M).notEnoughRoom)&&Tn(be,J)}v?(g.text.dynamicLayoutVertexBuffer.updateData(J),ee&&g.text.globeExtVertexBuffer.updateData(ee)):(g.icon.dynamicLayoutVertexBuffer.updateData(J),ee&&g.icon.globeExtVertexBuffer.updateData(ee))}function Li(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J){const{lineStartIndex:ee,glyphStartIndex:U,segment:Y}=I,ie=U+I.numGlyphs,re=ee+I.lineLength,fe=c.getoffsetX(U),ge=c.getoffsetX(ie-1),de=Hr(g*fe,d,v,b,E,M,Y,ee,re,k,F,L,j,q,!0,K,Q,J);if(!de)return null;const be=Hr(g*ge,d,v,b,E,M,Y,ee,re,k,F,L,j,q,!0,K,Q,J);return be?{first:de,last:be}:null}function sc(g,c,d,v){return g===p.WritingMode.horizontal&&Math.abs(v)>Math.abs(d)?{useVertical:!0}:g===p.WritingMode.vertical?v>0?{needsFlipping:!0}:null:c!==Ms.unknown&&(0===(b=d)||Math.abs(v/b)>oc)?c===Ms.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null;var b}function ct(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J,ee,U,Y){const ie=c/24,re=g.lineOffsetX*ie,fe=g.lineOffsetY*ie,{lineStartIndex:ge,glyphStartIndex:de,numGlyphs:be,segment:xe,writingMode:Ie,flipState:Xe}=g,Te=ge+g.lineLength,je=Pe=>{if(L){const[Ye,$e,qe]=Pe.up,_t=F.length;p.updateGlobeVertexNormal(L,_t+0,Ye,$e,qe),p.updateGlobeVertexNormal(L,_t+1,Ye,$e,qe),p.updateGlobeVertexNormal(L,_t+2,Ye,$e,qe),p.updateGlobeVertexNormal(L,_t+3,Ye,$e,qe)}const[We,Se,Ne]=Pe.point;p.addDynamicAttributes(F,We,Se,Ne,Pe.angle)};if(be>1){const Pe=Li(ie,I,re,fe,d,j,q,g,k,E,K,J,!1,ee,U,Y);if(!Pe)return{notEnoughRoom:!0};if(v&&!d){let[We,Se,Ne]=Pe.first.point,[Ye,$e,qe]=Pe.last.point;[We,Se]=ar(We,Se,Ne,M),[Ye,$e]=ar(Ye,$e,qe,M);const _t=sc(Ie,Xe,(Ye-We)*Q,$e-Se);if(g.flipState=_t&&_t.needsFlipping?Ms.flipRequired:Ms.flipNotRequired,_t)return _t}je(Pe.first);for(let We=de+1;We<de+be-1;We++){const Se=Hr(ie*I.getoffsetX(We),re,fe,d,j,q,xe,ge,Te,k,E,K,J,!1,!1,ee,U,Y);if(!Se)return F.length-=4*(We-de),{notEnoughRoom:!0};je(Se)}je(Pe.last)}else{if(v&&!d){const We=ar(q.x,q.y,0,b),Se=ge+xe+1,Ne=new p.Point(k.getx(Se),k.gety(Se)),Ye=ar(Ne.x,Ne.y,0,b),$e=Ye[3]>0?Ye:yt(q,Ne,We,1,b,void 0,ee,U.canonical),qe=sc(Ie,Xe,($e[0]-We[0])*Q,$e[1]-We[1]);if(g.flipState=qe&&qe.needsFlipping?Ms.flipRequired:Ms.flipNotRequired,qe)return qe}const Pe=Hr(ie*I.getoffsetX(de),re,fe,d,j,q,xe,ge,Te,k,E,K,J,!1,!1,ee,U,Y);if(!Pe)return{notEnoughRoom:!0};je(Pe)}return{}}function ln(g,c,d,v,b){const{x:E,y:M,z:I}=v.projectTilePoint(g.x,g.y,c);if(!b)return ar(E,M,I,d);const[k,F,L]=b(g);return ar(E+k,M+F,I+L,d)}function yt(g,c,d,v,b,E,M,I){const k=ln(g.sub(c)._unit()._add(g),I,b,M,E);return p.sub(k,d,k),p.normalize(k,k),p.scaleAndAdd(k,d,k,v)}function Hr(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J,ee,U){const Y=v?g-c:g+c;let ie=Y>0?1:-1,re=0;v&&(ie*=-1,re=Math.PI),ie<0&&(re+=Math.PI);let fe=I+M+(ie>0?0:1)|0,ge=b,de=b,be=0,xe=0;const Ie=Math.abs(Y),Xe=[],Te=[];let je=E,Pe=je;const We=()=>yt(Pe,je,de,Ie-be+1,L,q,J,ee.canonical);for(;be+xe<=Ie;){if(fe+=ie,fe<I||fe>=k)return null;if(de=ge,Pe=je,Xe.push(de),K&&Te.push(Pe),je=new p.Point(F.getx(fe),F.gety(fe)),ge=j[fe],!ge){const Tt=ln(je,ee.canonical,L,J,q);ge=Tt[3]>0?j[fe]=Tt:We()}be+=xe,xe=p.distance(de,ge)}Q&&q&&(j[fe]&&(ge=We(),xe=p.distance(de,ge)),j[fe]=ge);const Se=(Ie-be)/xe,Ne=je.sub(Pe)._mult(Se)._add(Pe),Ye=p.sub([],ge,de),$e=p.scaleAndAdd([],de,Ye,Se);let qe=[0,0,1],_t=Ye[0],zt=Ye[1];if(U&&(qe=J.upVector(ee.canonical,Ne.x,Ne.y),0!==qe[0]||0!==qe[1]||1!==qe[2])){const Tt=[qe[2],0,-qe[0]],dn=p.cross([],qe,Tt);p.normalize(Tt,Tt),p.normalize(dn,dn),_t=p.dot(Ye,Tt),zt=p.dot(Ye,dn)}if(d){const Tt=p.cross([],qe,Ye);p.normalize(Tt,Tt),p.scaleAndAdd($e,$e,Tt,d*ie)}const mt=re+Math.atan2(zt,_t);return Xe.push($e),K&&Te.push(Ne),{point:$e,angle:mt,path:Xe,tilePath:Te,up:qe}}function Tn(g,c){const d=c.length,v=d+4*g;c.resize(v),c.float32.fill(-1/0,4*d,4*v)}function nn(g,c,d){const v=c[0],b=c[1];return g[0]=d[0]*v+d[4]*b+d[12],g[1]=d[1]*v+d[5]*b+d[13],g[3]=d[3]*v+d[7]*b+d[15],g}const bo=100;class Hn{constructor(c,d,v=new ml(c.width+200,c.height+200,25),b=new ml(c.width+200,c.height+200,25)){this.transform=c,this.grid=v,this.ignoredGrid=b,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+bo,this.screenBottomBoundary=c.height+bo,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=d}placeCollisionBox(c,d,v,b,E,M,I,k){let F=v.projectedAnchorX,L=v.projectedAnchorY,j=v.projectedAnchorZ;const q=v.elevation,K=v.tileID,Q=c.getProjection();if(q&&K){const[ge,de,be]=Q.upVector(K.canonical,v.tileAnchorX,v.tileAnchorY),xe=Q.upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=ge*q*xe,L+=de*q*xe,j+=be*q*xe}const J=this.projectAndGetPerspectiveRatio(I,F,L,j,v.tileID,"globe"===Q.name||!!q||this.transform.pitch>0,Q),ee=M*J.perspectiveRatio,U=(v.x1*d+b.x-v.padding)*ee+J.point.x,Y=(v.y1*d+b.y-v.padding)*ee+J.point.y,ie=(v.x2*d+b.x+v.padding)*ee+J.point.x,re=(v.y2*d+b.y+v.padding)*ee+J.point.y,fe=J.perspectiveRatio<=.55||J.occluded;return!this.isInsideGrid(U,Y,ie,re)||!E&&this.grid.hitTest(U,Y,ie,re,k)||fe?{box:[],offscreen:!1,occluded:J.occluded}:{box:[U,Y,ie,re],offscreen:this.isOffscreen(U,Y,ie,re),occluded:!1}}placeCollisionCircles(c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J){const ee=[],U=this.transform.elevation,Y=c.getProjection(),ie=U?U.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,Y):null,re=new p.Point(v.tileAnchorX,v.tileAnchorY);let{x:fe,y:ge,z:de}=Y.projectTilePoint(re.x,re.y,J.canonical);if(ie){const[Ne,Ye,$e]=ie(re);fe+=Ne,ge+=Ye,de+=$e}const be="globe"===Y.name,xe=this.projectAndGetPerspectiveRatio(I,fe,ge,de,J,be||!!U||this.transform.pitch>0,Y),{perspectiveRatio:Ie}=xe,Xe=(j?M/Ie:M*Ie)/p.ONE_EM,Te=ar(fe,ge,de,k),je=xe.signedDistanceFromCamera>0?Li(Xe,E,v.lineOffsetX*Xe,v.lineOffsetY*Xe,!1,Te,re,v,b,k,{},U&&!j?ie:null,j&&!!U,Y,J,j):null;let Pe=!1,We=!1,Se=!0;if(je&&!xe.occluded){const Ne=.5*K*Ie+Q,Ye=new p.Point(-100,-100),$e=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),qe=new pl,{first:_t,last:zt}=je,mt=_t.path.length;let Tt=[];for(let vt=mt-1;vt>=1;vt--)Tt.push(_t.path[vt]);for(let vt=1;vt<zt.path.length;vt++)Tt.push(zt.path[vt]);const dn=2.5*Ne;F&&(Tt=Tt.map(([vt,Ln,Jn],Fn)=>(ie&&!be&&(Jn=ie(Fn<mt-1?_t.tilePath[mt-1-Fn]:zt.tilePath[Fn-mt+2])[2]),ar(vt,Ln,Jn,F))),Tt.some(vt=>vt[3]<=0)&&(Tt=[]));let sn=[];if(Tt.length>0){let vt=1/0,Ln=-1/0,Jn=1/0,Fn=-1/0;for(const jn of Tt)vt=Math.min(vt,jn[0]),Jn=Math.min(Jn,jn[1]),Ln=Math.max(Ln,jn[0]),Fn=Math.max(Fn,jn[1]);Ln>=Ye.x&&vt<=$e.x&&Fn>=Ye.y&&Jn<=$e.y&&(sn=[Tt.map(jn=>new p.Point(jn[0],jn[1]))],(vt<Ye.x||Ln>$e.x||Jn<Ye.y||Fn>$e.y)&&(sn=p.clipLine(sn,Ye.x,Ye.y,$e.x,$e.y)))}for(const vt of sn){qe.reset(vt,.25*Ne);let Ln=0;Ln=qe.length<=.5*Ne?1:Math.ceil(qe.paddedLength/dn)+1;for(let Jn=0;Jn<Ln;Jn++){const Fn=Jn/Math.max(Ln-1,1),jn=qe.lerp(Fn),vr=jn.x+bo,Si=jn.y+bo;ee.push(vr,Si,Ne,0);const To=vr-Ne,hs=Si-Ne,Qn=vr+Ne,Gn=Si+Ne;if(Se=Se&&this.isOffscreen(To,hs,Qn,Gn),We=We||this.isInsideGrid(To,hs,Qn,Gn),!d&&this.grid.hitTestCircle(vr,Si,Ne,q)&&(Pe=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Pe,occluded:!1}}}}return{circles:!L&&Pe||!We?[]:ee,offscreen:Se,collisionDetected:Pe,occluded:xe.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let v=1/0,b=1/0,E=-1/0,M=-1/0;for(const L of c){const j=new p.Point(L.x+bo,L.y+bo);v=Math.min(v,j.x),b=Math.min(b,j.y),E=Math.max(E,j.x),M=Math.max(M,j.y),d.push(j)}const I=this.grid.query(v,b,E,M).concat(this.ignoredGrid.query(v,b,E,M)),k={},F={};for(const L of I){const j=L.key;if(void 0===k[j.bucketInstanceId]&&(k[j.bucketInstanceId]={}),k[j.bucketInstanceId][j.featureIndex])continue;const q=[new p.Point(L.x1,L.y1),new p.Point(L.x2,L.y1),new p.Point(L.x2,L.y2),new p.Point(L.x1,L.y2)];p.polygonIntersectsPolygon(d,q)&&(k[j.bucketInstanceId][j.featureIndex]=!0,void 0===F[j.bucketInstanceId]&&(F[j.bucketInstanceId]=[]),F[j.bucketInstanceId].push(j.featureIndex))}return F}insertCollisionBox(c,d,v,b,E){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:b,collisionGroupID:E},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,d,v,b,E){const M=d?this.ignoredGrid:this.grid,I={bucketInstanceId:v,featureIndex:b,collisionGroupID:E};for(let k=0;k<c.length;k+=4)M.insertCircle(I,c[k],c[k+1],c[k+2])}projectAndGetPerspectiveRatio(c,d,v,b,E,M,I){const k=[d,v,b,1];let F=!1;b||this.transform.pitch>0?(p.transformMat4$1(k,k,c),this.fogState&&E&&"globe"!==I.name&&(F=function(q,K,Q,J,ee,U){const Y=U.calculateFogTileMatrix(ee),ie=[K,Q,J];return p.transformMat4(ie,ie,Y),cl(q,ie,U.pitch,U._fov)}(this.fogState,d,v,b,E.toUnwrapped(),this.transform)>.9)):nn(k,k,c);const L=k[3];return{point:new p.Point((k[0]/L+1)/2*this.transform.width+bo,(-k[1]/L+1)/2*this.transform.height+bo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/L*.5,1.5),signedDistanceFromCamera:L,occluded:M&&k[2]>L||F}}isOffscreen(c,d,v,b){return v<bo||c>=this.screenRightBoundary||b<bo||d>this.screenBottomBoundary}isInsideGrid(c,d,v,b){return v>=0&&c<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const c=p.identity([]);return p.translate(c,c,[-100,-100,0]),c}}function Pt(g,c,d){const v=c.createTileMatrix(g,g.worldSize,d.toUnwrapped());return p.multiply(new Float32Array(16),g.projMatrix,v)}function lo(g,c,d){if(c.projection.name===d.projection.name)return g.projMatrix;const v=d.clone();return v.setProjection(c.projection),Pt(v,c.getProjection(),g)}function ii(g,c,d){return c.name===d.projection.name?g.projMatrix:Pt(d,c,g)}class yg{constructor(c,d,v,b){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?d:-d))):b&&v?1:0,this.placed=v}isHidden(){return 0===this.opacity&&!this.placed}}class As{constructor(c,d,v,b,E,M=!1){this.text=new yg(c?c.text:null,d,v,E),this.icon=new yg(c?c.icon:null,d,b,E),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class nt{constructor(c,d,v,b=!1){this.text=c,this.icon=d,this.skipFade=v,this.clipped=b}}class Pa{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Jt{constructor(c,d,v,b,E){this.bucketInstanceId=c,this.featureIndex=d,this.sourceLayerIndex=v,this.bucketIndex=b,this.tileID=E}}class Bn{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const d=++this.maxGroupID;this.collisionGroups[c]={ID:d,predicate:v=>v.collisionGroupID===d}}return this.collisionGroups[c]}}function Yc(g,c,d,v,b){const{horizontalAlign:E,verticalAlign:M}=p.getAnchorAlignment(g),I=-(E-.5)*c,k=-(M-.5)*d,F=p.evaluateVariableOffset(g,v);return new p.Point(I+F[0]*b,k+F[1]*b)}function oh(g,c,d,v,b){const E=new p.Point(g,c);return d&&E._rotate(v?b:-b),E}class sh{constructor(c,d,v,b,E){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new Hn(this.transform,E),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Bn(v),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,d,v,b){const E=v.getBucket(d),M=v.latestFeatureIndex;if(!E||!M||d.id!==E.layerIds[0])return;const I=E.layers[0].layout,k=v.collisionBoxArray,F=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),L=v.tileSize/p.EXTENT,j=v.tileID.toUnwrapped();this.transform.setProjection(E.projection);const q=(K=v.tileID,Q=E.getProjection(),J=this.transform,Q.name===this.projection?J.calculateProjMatrix(K.toUnwrapped()):Pt(J,Q,K));var K,Q,J;const ee="map"===I.get("text-pitch-alignment"),U="map"===I.get("text-rotation-alignment");d.compileFilter();const Y=d.dynamicFilter(),ie=d.dynamicFilterNeedsFeature(),re=this.transform.calculatePixelsToTileUnitsMatrix(v),fe=ea(q,v.tileID.canonical,ee,U,this.transform,E.getProjection(),re);let ge=null;if(ee){const xe=Oi(q,v.tileID.canonical,ee,U,this.transform,E.getProjection(),re);ge=p.multiply([],this.transform.labelPlaneMatrix,xe)}let de=null;Y&&v.latestFeatureIndex&&(de={unwrappedTileID:j,dynamicFilter:Y,dynamicFilterNeedsFeature:ie,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[E.bucketInstanceId]=new Jt(E.bucketInstanceId,M,E.sourceLayerIndex,E.index,v.tileID);const be={bucket:E,layout:I,posMatrix:q,textLabelPlaneMatrix:fe,labelToScreenMatrix:ge,clippingData:de,scale:F,textPixelRatio:L,holdingForFade:v.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(E.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(b)for(const xe of E.sortKeyRanges){const{sortKey:Ie,symbolInstanceStart:Xe,symbolInstanceEnd:Te}=xe;c.push({sortKey:Ie,symbolInstanceStart:Xe,symbolInstanceEnd:Te,parameters:be})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:be})}attemptAnchorPlacement(c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J,ee,U,Y){const{textOffset0:ie,textOffset1:re,crossTileID:fe}=q,ge=[ie,re],de=Yc(c,v,b,ge,E),be=this.collisionIndex.placeCollisionBox(Q,E,d,oh(de.x,de.y,M,I,this.transform.angle),j,k,F,L.predicate);if(ee){const xe=Q.getSymbolInstanceIconSize(Y,this.transform.zoom,q.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Q,xe,ee,oh(de.x,de.y,M,I,this.transform.angle),j,k,F,L.predicate).box.length)return}if(be.box.length>0){let xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[fe]&&this.prevPlacement.placements[fe]&&this.prevPlacement.placements[fe].text&&(xe=this.prevPlacement.variableOffsets[fe].anchor),this.variableOffsets[fe]={textOffset:ge,width:v,height:b,anchor:c,textScale:E,prevAnchor:xe},this.markUsedJustification(Q,c,q,J),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,J,q),this.placedOrientations[fe]=J),{shift:de,placedGlyphBoxes:be}}}placeLayerBucketPart(c,d,v,b){const{bucket:E,layout:M,posMatrix:I,textLabelPlaneMatrix:k,labelToScreenMatrix:F,clippingData:L,textPixelRatio:j,holdingForFade:q,collisionBoxArray:K,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:J,collisionGroup:ee}=c.parameters,U=M.get("text-optional"),Y=M.get("icon-optional"),ie=M.get("text-allow-overlap"),re=M.get("icon-allow-overlap"),fe="map"===M.get("text-rotation-alignment"),ge="map"===M.get("text-pitch-alignment"),de="none"!==M.get("icon-text-fit"),be="viewport-y"===M.get("symbol-z-order");this.transform.setProjection(E.projection);let xe=ie&&(re||!E.hasIconData()||Y),Ie=re&&(ie||!E.hasTextData()||U);!E.collisionArrays&&K&&E.deserializeCollisionBoxes(K),v&&b&&E.updateCollisionDebugBuffers(this.transform.zoom,K);const Xe=(Te,je,Pe)=>{const{crossTileID:We,numVerticalGlyphVertices:Se}=Te;if(L){const Qn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Gn=null;if(L.dynamicFilterNeedsFeature){const bn=this.retainedQueryData[E.bucketInstanceId];Gn=L.featureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:bn.bucketIndex,sourceLayerIndex:bn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Qn,Gn,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new p.Point(Te.tileAnchorX,Te.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[We]=new nt(!1,!1,!1,!0),void d.add(We)}if(d.has(We))return;if(q)return void(this.placements[We]=new nt(!1,!1,!1));let Ne=!1,Ye=!1,$e=!0,qe=!1,_t=!1,zt=null,mt={box:null,offscreen:null,occluded:null},Tt={box:null,offscreen:null,occluded:null},dn=null,sn=null,vt=null,Ln=0,Jn=0,Fn=0;Pe.textFeatureIndex?Ln=Pe.textFeatureIndex:Te.useRuntimeCollisionCircles&&(Ln=Te.featureIndex),Pe.verticalTextFeatureIndex&&(Jn=Pe.verticalTextFeatureIndex);const jn=Qn=>{Qn.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Gn=this.transform.elevation;(Gn||Qn.elevation)&&(Qn.elevation=Gn?Gn.getAtTileOffset(Qn.tileID,Qn.tileAnchorX,Qn.tileAnchorY):0)},vr=Pe.textBox;if(vr){jn(vr);const Qn=bn=>{let wi=p.WritingMode.horizontal;if(E.allowVerticalPlacement&&!bn&&this.prevPlacement){const ur=this.prevPlacement.placedOrientations[We];ur&&(this.placedOrientations[We]=ur,wi=ur,this.markUsedOrientation(E,wi,Te))}return wi},Gn=(bn,wi)=>{if(E.allowVerticalPlacement&&Se>0&&Pe.verticalTextBox){for(const ur of E.writingModes)if(ur===p.WritingMode.vertical?(mt=wi(),Tt=mt):mt=bn(),mt&&mt.box&&mt.box.length)break}else mt=bn()};if(M.get("text-variable-anchor")){let bn=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[We]){const ci=this.prevPlacement.variableOffsets[We];bn.indexOf(ci.anchor)>0&&(bn=bn.filter(Xr=>Xr!==ci.anchor),bn.unshift(ci.anchor))}const wi=(ci,Xr,mu)=>{const kl=E.getSymbolInstanceTextSize(Q,Te,this.transform.zoom,je),po=(ci.x2-ci.x1)*kl+2*ci.padding,ca=(ci.y2-ci.y1)*kl+2*ci.padding,ds=de&&!re?Xr:null;ds&&jn(ds);let ua={box:[],offscreen:!1,occluded:!1};const gu=ie?2*bn.length:bn.length;for(let Rl=0;Rl<gu;++Rl){const _u=this.attemptAnchorPlacement(bn[Rl%bn.length],ci,po,ca,kl,fe,ge,j,I,ee,Rl>=bn.length,Te,je,E,mu,ds,Q,J);if(_u&&(ua=_u.placedGlyphBoxes,ua&&ua.box&&ua.box.length)){Ne=!0,zt=_u.shift;break}}return ua};Gn(()=>wi(vr,Pe.iconBox,p.WritingMode.horizontal),()=>{const ci=Pe.verticalTextBox;return ci&&jn(ci),E.allowVerticalPlacement&&!(mt&&mt.box&&mt.box.length)&&Se>0&&ci?wi(ci,Pe.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),mt&&(Ne=mt.box,$e=mt.offscreen,qe=mt.occluded);const ur=Qn(!(!mt||!mt.box));if(!Ne&&this.prevPlacement){const ci=this.prevPlacement.variableOffsets[We];ci&&(this.variableOffsets[We]=ci,this.markUsedJustification(E,ci.anchor,Te,ur))}}else{const bn=(wi,ur)=>{const ci=E.getSymbolInstanceTextSize(Q,Te,this.transform.zoom,je),Xr=this.collisionIndex.placeCollisionBox(E,ci,wi,new p.Point(0,0),ie,j,I,ee.predicate);return Xr&&Xr.box&&Xr.box.length&&(this.markUsedOrientation(E,ur,Te),this.placedOrientations[We]=ur),Xr};Gn(()=>bn(vr,p.WritingMode.horizontal),()=>{const wi=Pe.verticalTextBox;return E.allowVerticalPlacement&&Se>0&&wi?(jn(wi),bn(wi,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Qn(!!(mt&&mt.box&&mt.box.length))}}if(dn=mt,Ne=dn&&dn.box&&dn.box.length>0,$e=dn&&dn.offscreen,qe=dn&&dn.occluded,Te.useRuntimeCollisionCircles){const Qn=E.text.placedSymbolArray.get(Te.centerJustifiedTextSymbolIndex>=0?Te.centerJustifiedTextSymbolIndex:Te.verticalPlacedTextSymbolIndex),Gn=p.evaluateSizeForFeature(E.textSizeData,Q,Qn),bn=M.get("text-padding");sn=this.collisionIndex.placeCollisionCircles(E,ie,Qn,E.lineVertexArray,E.glyphOffsetArray,Gn,I,k,F,v,ge,ee.predicate,Te.collisionCircleDiameter*Gn/p.ONE_EM,bn,this.retainedQueryData[E.bucketInstanceId].tileID),Ne=ie||sn.circles.length>0&&!sn.collisionDetected,$e=$e&&sn.offscreen,qe=sn.occluded}if(Pe.iconFeatureIndex&&(Fn=Pe.iconFeatureIndex),Pe.iconBox){const Qn=Gn=>{jn(Gn);const bn=de&&zt?oh(zt.x,zt.y,fe,ge,this.transform.angle):new p.Point(0,0),wi=E.getSymbolInstanceIconSize(J,this.transform.zoom,Te.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,wi,Gn,bn,re,j,I,ee.predicate)};Tt&&Tt.box&&Tt.box.length&&Pe.verticalIconBox?(vt=Qn(Pe.verticalIconBox),Ye=vt.box.length>0):(vt=Qn(Pe.iconBox),Ye=vt.box.length>0),$e=$e&&vt.offscreen,_t=vt.occluded}const Si=U||0===Te.numHorizontalGlyphVertices&&0===Se,To=Y||0===Te.numIconVertices;if(Si||To?To?Si||(Ye=Ye&&Ne):Ne=Ye&&Ne:Ye=Ne=Ye&&Ne,Ne&&dn&&dn.box&&this.collisionIndex.insertCollisionBox(dn.box,M.get("text-ignore-placement"),E.bucketInstanceId,Tt&&Tt.box&&Jn?Jn:Ln,ee.ID),Ye&&vt&&this.collisionIndex.insertCollisionBox(vt.box,M.get("icon-ignore-placement"),E.bucketInstanceId,Fn,ee.ID),sn&&(Ne&&this.collisionIndex.insertCollisionCircles(sn.circles,M.get("text-ignore-placement"),E.bucketInstanceId,Ln,ee.ID),v)){const Qn=E.bucketInstanceId;let Gn=this.collisionCircleArrays[Qn];void 0===Gn&&(Gn=this.collisionCircleArrays[Qn]=new Pa);for(let bn=0;bn<sn.circles.length;bn+=4)Gn.circles.push(sn.circles[bn+0]),Gn.circles.push(sn.circles[bn+1]),Gn.circles.push(sn.circles[bn+2]),Gn.circles.push(sn.collisionDetected?1:0)}const hs="globe"!==E.projection.name;xe=xe&&(hs||!qe),Ie=Ie&&(hs||!_t),this.placements[We]=new nt(Ne||xe,Ye||Ie,$e||E.justReloaded),d.add(We)};if(be){const Te=E.getSortedSymbolIndexes(this.transform.angle);for(let je=Te.length-1;je>=0;--je){const Pe=Te[je];Xe(E.symbolInstances.get(Pe),Pe,E.collisionArrays[Pe])}}else for(let Te=c.symbolInstanceStart;Te<c.symbolInstanceEnd;Te++)Xe(E.symbolInstances.get(Te),Te,E.collisionArrays[Te]);if(v&&E.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[E.bucketInstanceId];p.invert(Te.invProjMatrix,I),Te.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(c,d,v,b){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:k,crossTileID:F}=v,L=p.getAnchorJustification(d),j=b===p.WritingMode.vertical?k:"left"===L?E:"center"===L?M:"right"===L?I:-1;E>=0&&(c.text.placedSymbolArray.get(E).crossTileID=j>=0&&E!==j?0:F),M>=0&&(c.text.placedSymbolArray.get(M).crossTileID=j>=0&&M!==j?0:F),I>=0&&(c.text.placedSymbolArray.get(I).crossTileID=j>=0&&I!==j?0:F),k>=0&&(c.text.placedSymbolArray.get(k).crossTileID=j>=0&&k!==j?0:F)}markUsedOrientation(c,d,v){const b=d===p.WritingMode.horizontal||d===p.WritingMode.horizontalOnly?d:0,E=d===p.WritingMode.vertical?d:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:F}=v,L=c.text.placedSymbolArray;M>=0&&(L.get(M).placedOrientation=b),I>=0&&(L.get(I).placedOrientation=b),k>=0&&(L.get(k).placedOrientation=b),F>=0&&(L.get(F).placedOrientation=E)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let v=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(c):1,E=d?d.opacities:{},M=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(const k in this.placements){const F=this.placements[k],L=E[k];L?(this.opacities[k]=new As(L,b,F.text,F.icon,null,F.clipped),v=v||F.text!==L.text.placed||F.icon!==L.icon.placed):(this.opacities[k]=new As(null,b,F.text,F.icon,F.skipFade,F.clipped),v=v||F.text||F.icon)}for(const k in E){const F=E[k];if(!this.opacities[k]){const L=new As(F,b,!1,!1);L.isHidden()||(this.opacities[k]=L,v=v||F.text.placed||F.icon.placed)}}for(const k in M)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=M[k]);for(const k in I)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=I[k]);v?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:c)}updateLayerOpacities(c,d){const v=new Set;for(const b of d){const E=b.getBucket(c);E&&b.latestFeatureIndex&&c.id===E.layerIds[0]&&this.updateBucketOpacities(E,v,b.collisionBoxArray)}}updateBucketOpacities(c,d,v){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const b=c.layers[0].layout,E=!!c.layers[0].dynamicFilter(),M=new As(null,0,!1,!1,!0),I=b.get("text-allow-overlap"),k=b.get("icon-allow-overlap"),F=b.get("text-variable-anchor"),L="map"===b.get("text-rotation-alignment"),j="map"===b.get("text-pitch-alignment"),q="none"!==b.get("icon-text-fit"),K=new As(null,0,I&&(k||!c.hasIconData()||b.get("icon-optional")),k&&(I||!c.hasTextData()||b.get("text-optional")),!0);!c.collisionArrays&&v&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(v);const Q=(ee,U,Y)=>{for(let ie=0;ie<U/4;ie++)ee.opacityVertexArray.emplaceBack(Y)};let J=0;for(let ee=0;ee<c.symbolInstances.length;ee++){const U=c.symbolInstances.get(ee),{numHorizontalGlyphVertices:Y,numVerticalGlyphVertices:ie,crossTileID:re,numIconVertices:fe}=U,ge=d.has(re);let de=this.opacities[re];ge?de=M:de||(de=K,this.opacities[re]=de),d.add(re);const be=Y>0||ie>0,xe=fe>0,Ie=this.placedOrientations[re],Xe=Ie===p.WritingMode.vertical,Te=Ie===p.WritingMode.horizontal||Ie===p.WritingMode.horizontalOnly;if(!be&&!xe||de.isHidden()||J++,be){const je=ah(de.text);Q(c.text,Y,Xe?Ti:je),Q(c.text,ie,Te?Ti:je);const Pe=de.text.isHidden(),{leftJustifiedTextSymbolIndex:We,centerJustifiedTextSymbolIndex:Se,rightJustifiedTextSymbolIndex:Ne,verticalPlacedTextSymbolIndex:Ye}=U,$e=c.text.placedSymbolArray,qe=Pe||Xe?1:0;We>=0&&($e.get(We).hidden=qe),Se>=0&&($e.get(Se).hidden=qe),Ne>=0&&($e.get(Ne).hidden=qe),Ye>=0&&($e.get(Ye).hidden=Pe||Te?1:0);const _t=this.variableOffsets[re];_t&&this.markUsedJustification(c,_t.anchor,U,Ie);const zt=this.placedOrientations[re];zt&&(this.markUsedJustification(c,"left",U,zt),this.markUsedOrientation(c,zt,U))}if(xe){const je=ah(de.icon),{placedIconSymbolIndex:Pe,verticalPlacedIconSymbolIndex:We}=U,Se=c.icon.placedSymbolArray,Ne=de.icon.isHidden()?1:0;Pe>=0&&(Q(c.icon,fe,Xe?Ti:je),Se.get(Pe).hidden=Ne),We>=0&&(Q(c.icon,U.numVerticalIconVertices,Te?Ti:je),Se.get(We).hidden=Ne)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const je=c.collisionArrays[ee];if(je){let Pe=new p.Point(0,0),We=!0;if(je.textBox||je.verticalTextBox){if(F){const Ne=this.variableOffsets[re];Ne?(Pe=Yc(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textScale),L&&Pe._rotate(j?this.transform.angle:-this.transform.angle)):We=!1}E&&(We=!de.clipped),je.textBox&&ta(c.textCollisionBox.collisionVertexArray,de.text.placed,!We||Xe,Pe.x,Pe.y),je.verticalTextBox&&ta(c.textCollisionBox.collisionVertexArray,de.text.placed,!We||Te,Pe.x,Pe.y)}const Se=We&&Boolean(!Te&&je.verticalIconBox);je.iconBox&&ta(c.iconCollisionBox.collisionVertexArray,de.icon.placed,Se,q?Pe.x:0,q?Pe.y:0),je.verticalIconBox&&ta(c.iconCollisionBox.collisionVertexArray,de.icon.placed,!Se,q?Pe.x:0,q?Pe.y:0)}}}if(c.fullyClipped=0===J,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const ee=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=ee.invProjMatrix,c.placementViewportMatrix=ee.viewportMatrix,c.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,d){const v=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*v>c}setStale(){this.stale=!0}}function ta(g,c,d,v,b){g.emplaceBack(c?1:0,d?1:0,v||0,b||0),g.emplaceBack(c?1:0,d?1:0,v||0,b||0),g.emplaceBack(c?1:0,d?1:0,v||0,b||0),g.emplaceBack(c?1:0,d?1:0,v||0,b||0)}const ai=Math.pow(2,25),Fi=Math.pow(2,24),Nd=Math.pow(2,17),Ep=Math.pow(2,16),zi=Math.pow(2,9),as=Math.pow(2,8),vg=Math.pow(2,1);function ah(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const c=g.placed?1:0,d=Math.floor(127*g.opacity);return d*ai+c*Fi+d*Nd+c*Ep+d*zi+c*as+d*vg+c}const Ti=0;class Kc{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,d,v,b,E){const M=this._bucketParts;for(;this._currentTileIndex<c.length;)if(d.getBucketParts(M,b,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((I,k)=>I.sortKey-k.sortKey));this._currentPartIndex<M.length;){const I=M[this._currentPartIndex];if(d.placeLayerBucketPart(I,this._seenCrossTileIDs,v,0===I.symbolInstanceStart),this._currentPartIndex++,E())return!0}return!1}}class Dp{constructor(c,d,v,b,E,M,I,k){this.placement=new sh(c,E,M,I,k),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(c,d,v){const b=p.exported.now(),E=()=>{const M=p.exported.now()-b;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=d[c[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if("symbol"===M.type&&(!M.minzoom||M.minzoom<=I)&&(!M.maxzoom||M.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Kc(M)),this._inProgressLayer.continuePlacement(v[M.source],this.placement,this._showCollisionBoxes,M,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const gl=512/p.EXTENT/2;class Sr{constructor(c,d,v){this.tileID=c,this.bucketInstanceId=v,this.index=new p.KDBush(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=c.canonical.x*p.EXTENT,E=c.canonical.y*p.EXTENT;for(let M=0;M<d.length;M++){const{key:I,crossTileID:k,tileAnchorX:F,tileAnchorY:L}=d.get(M),j=Math.floor((b+F)*gl),q=Math.floor((E+L)*gl);this.index.add(j,q),this.keys.push(I),this.crossTileIDs.push(k)}this.index.finish()}findMatches(c,d,v){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),E=gl/Math.pow(2,d.canonical.z-this.tileID.canonical.z),M=d.canonical.x*p.EXTENT,I=d.canonical.y*p.EXTENT;for(let k=0;k<c.length;k++){const F=c.get(k);if(F.crossTileID)continue;const{key:L,tileAnchorX:j,tileAnchorY:q}=F,K=Math.floor((M+j)*E),Q=Math.floor((I+q)*E),J=this.index.range(K-b,Q-b,K+b,Q+b);for(const ee of J){const U=this.crossTileIDs[ee];if(this.keys[ee]===L&&!v.has(U)){v.add(U),F.crossTileID=U;break}}}}}class co{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class On{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const d=Math.round((c-this.lng)/360);if(0!==d)for(const v in this.indexes){const b=this.indexes[v],E={};for(const M in b){const I=b[M];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),E[I.tileID.key]=I}this.indexes[v]=E}this.lng=c}addBucket(c,d,v){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let E=0;E<d.symbolInstances.length;E++)d.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const b=this.usedCrossTileIDs[c.overscaledZ];for(const E in this.indexes){const M=this.indexes[E];if(Number(E)>c.overscaledZ)for(const I in M){const k=M[I];k.tileID.isChildOf(c)&&k.findMatches(d.symbolInstances,c,b)}else{const I=M[c.scaledTo(Number(E)).key];I&&I.findMatches(d.symbolInstances,c,b)}}for(let E=0;E<d.symbolInstances.length;E++){const M=d.symbolInstances.get(E);M.crossTileID||(M.crossTileID=v.generate(),b.add(M.crossTileID))}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Sr(c,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(c,d){for(const v of d.crossTileIDs)this.usedCrossTileIDs[c].delete(v)}removeStaleBuckets(c){let d=!1;for(const v in this.indexes){const b=this.indexes[v];for(const E in b)c[b[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,b[E]),delete b[E],d=!0)}return d}}class ka{constructor(){this.layerIndexes={},this.crossTileIDs=new co,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,d,v,b){let E=this.layerIndexes[c.id];void 0===E&&(E=this.layerIndexes[c.id]=new On);let M=!1;const I={};"globe"!==b.name&&E.handleWrapJump(v);for(const k of d){const F=k.getBucket(c);F&&c.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(k.tileID,F,this.crossTileIDs)&&(M=!0),I[F.bucketInstanceId]=!0)}return E.removeStaleBuckets(I)&&(M=!0),M}pruneUnusedLayers(c){const d={};c.forEach(v=>{d[v]=!0});for(const v in this.layerIndexes)d[v]||delete this.layerIndexes[v]}}const _l=(g,c)=>p.emitValidationErrors(g,c&&c.filter(d=>"source.canvas"!==d.identifier)),Bd=p.pick(Lt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),At=p.pick(Lt,["setCenter","setZoom","setBearing","setPitch"]),Tp={version:8,layers:[],sources:{}},Ui={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class wo extends p.Evented{constructor(c,d={}){super(),this.map=c,this.dispatcher=new fn(rc(),this),this.imageManager=new ll,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(c._requestManager,d.localFontFamily?p.LocalGlyphMode.all:d.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.crossTileSymbolIndex=new ka,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const v=this;this._rtlTextPluginCallback=wo.registerForPluginStateChange(b=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(E,M)=>{if(p.triggerPluginCompletionEvent(E),M&&M.every(I=>I))for(const I in v._sourceCaches){const k=v._sourceCaches[I],F=k.getSource().type;"vector"!==F&&"geojson"!==F||k.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const E=this.getSource(b.sourceId);if(E&&E.vectorLayerIds)for(const M in this._layers){const I=this._layers[M];I.source===E.id&&this._validateLayer(I)}})}loadURL(c,d={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const v="boolean"==typeof d.validate?d.validate:!p.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);const b=this.map._requestManager.transformRequest(c,p.ResourceType.Style);this._request=p.getJSON(b,(E,M)=>{this._request=null,E?this.fire(new p.ErrorEvent(E)):M&&this._load(M,v)})}loadJSON(c,d={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(c,!1!==d.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Tp,!1)}_updateLayerCount(c,d){const v=d?1:-1;c.is3D()&&(this._num3DLayers+=v),"circle"===c.type&&(this._numCircleLayers+=v),"symbol"===c.type&&(this._numSymbolLayers+=v)}_load(c,d){if(d&&_l(this,p.validateStyle(c)))return;this._loaded=!0,this.stylesheet=p.clone$1(c),this._updateMapProjection();for(const b in c.sources)this.addSource(b,c.sources[b],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const v=wp(this.stylesheet.layers);this._order=v.map(b=>b.id),this._layers={},this._serializedLayers={};for(const b of v){const E=p.createStyleLayer(b);E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new sr(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(d,v,b){let E,M,I;const k=p.exported.devicePixelRatio>1?"@2x":"";let F=p.getJSON(v.transformRequest(v.normalizeSpriteURL(d,k,".json"),p.ResourceType.SpriteJSON),(q,K)=>{F=null,I||(I=q,E=K,j())}),L=p.getImage(v.transformRequest(v.normalizeSpriteURL(d,k,".png"),p.ResourceType.SpriteImage),(q,K)=>{L=null,I||(I=q,M=K,j())});function j(){if(I)b(I);else if(E&&M){const q=p.exported.getImageData(M),K={};for(const Q in E){const{width:J,height:ee,x:U,y:Y,sdf:ie,pixelRatio:re,stretchX:fe,stretchY:ge,content:de}=E[Q],be=new p.RGBAImage({width:J,height:ee});p.RGBAImage.copy(q,be,{x:U,y:Y},{x:0,y:0},{width:J,height:ee}),K[Q]={data:be,pixelRatio:re,sdf:ie,stretchX:fe,stretchY:ge,content:de}}b(null,K)}}return{cancel(){F&&(F.cancel(),F=null),L&&(L.cancel(),L=null)}}}(c,this.map._requestManager,(d,v)=>{if(this._spriteRequest=null,d)this.fire(new p.ErrorEvent(d));else if(v)for(const b in v)this.imageManager.addImage(b,v[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(c){const d=this.getSource(c.source);if(!d)return;const v=c.sourceLayer;v&&("geojson"===d.type||d.vectorLayerIds&&-1===d.vectorLayerIds.indexOf(v))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${d.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const d=[];for(const v of c){const b=this._layers[v];"custom"!==b.type&&d.push(b.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&("function"==typeof c.isLayerDraped?c.isLayerDraped():Ui[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const d=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(b.length||E.length)&&this._updateWorkerLayers(b,E);for(const M in this._updatedSources){const I=this._updatedSources[M];"reload"===I?this._reloadSource(M):"clear"===I&&this._clearSource(M)}this._updateTilesForChangedImages();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const v={};for(const b in this._sourceCaches){const E=this._sourceCaches[b];v[b]=E.used,E.used=!1}for(const b of this._order){const E=this._layers[b];if(E.recalculate(c,this._availableImages),!E.isHidden(c.zoom)){const I=this._getLayerSourceCache(E);I&&(I.used=!0)}const M=this.map.painter;if(M){const I=E.getProgramIds();if(!I)continue;const k=E.getProgramConfiguration(c.zoom);for(const F of I)M.useProgram(F,k)}}for(const b in v){const E=this._sourceCaches[b];v[b]!==E.used&&E.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),_l(this,p.validateStyle(c)))return!1;(c=p.clone$1(c)).layers=wp(c.layers);const d=function(b,E){if(!b)return[{command:Lt.setStyle,args:[E]}];let M=[];try{if(!Ue(b.version,E.version))return[{command:Lt.setStyle,args:[E]}];Ue(b.center,E.center)||M.push({command:Lt.setCenter,args:[E.center]}),Ue(b.zoom,E.zoom)||M.push({command:Lt.setZoom,args:[E.zoom]}),Ue(b.bearing,E.bearing)||M.push({command:Lt.setBearing,args:[E.bearing]}),Ue(b.pitch,E.pitch)||M.push({command:Lt.setPitch,args:[E.pitch]}),Ue(b.sprite,E.sprite)||M.push({command:Lt.setSprite,args:[E.sprite]}),Ue(b.glyphs,E.glyphs)||M.push({command:Lt.setGlyphs,args:[E.glyphs]}),Ue(b.transition,E.transition)||M.push({command:Lt.setTransition,args:[E.transition]}),Ue(b.light,E.light)||M.push({command:Lt.setLight,args:[E.light]}),Ue(b.fog,E.fog)||M.push({command:Lt.setFog,args:[E.fog]}),Ue(b.projection,E.projection)||M.push({command:Lt.setProjection,args:[E.projection]});const I={},k=[];!function(j,q,K,Q){let J;for(J in q=q||{},j=j||{})j.hasOwnProperty(J)&&(q.hasOwnProperty(J)||ao(J,K,Q));for(J in q){if(!q.hasOwnProperty(J))continue;const ee=q[J];j.hasOwnProperty(J)?Ue(j[J],ee)||("geojson"===j[J].type&&"geojson"===ee.type&&ih(j,q,J)?K.push({command:Lt.setGeoJSONSourceData,args:[J,ee.data]}):Cp(J,q,K,Q)):Aa(J,q,K)}}(b.sources,E.sources,k,I);const F=[];b.layers&&b.layers.forEach(j=>{j.source&&I[j.source]?M.push({command:Lt.removeLayer,args:[j.id]}):F.push(j)});let L=b.terrain;L&&I[L.source]&&(M.push({command:Lt.setTerrain,args:[void 0]}),L=void 0),M=M.concat(k),Ue(L,E.terrain)||M.push({command:Lt.setTerrain,args:[E.terrain]}),function(j,q,K){q=q||[];const Q=(j=j||[]).map(ss),J=q.map(ss),ee=j.reduce(rh,{}),U=q.reduce(rh,{}),Y=Q.slice(),ie=Object.create(null);let re,fe,ge,de,be,xe,Ie;for(re=0,fe=0;re<Q.length;re++)ge=Q[re],U.hasOwnProperty(ge)?fe++:(K.push({command:Lt.removeLayer,args:[ge]}),Y.splice(Y.indexOf(ge,fe),1));for(re=0,fe=0;re<J.length;re++)ge=J[J.length-1-re],Y[Y.length-1-re]!==ge&&(ee.hasOwnProperty(ge)?(K.push({command:Lt.removeLayer,args:[ge]}),Y.splice(Y.lastIndexOf(ge,Y.length-fe),1)):fe++,xe=Y[Y.length-re],K.push({command:Lt.addLayer,args:[U[ge],xe]}),Y.splice(Y.length-re,0,ge),ie[ge]=!0);for(re=0;re<J.length;re++)if(ge=J[re],de=ee[ge],be=U[ge],!ie[ge]&&!Ue(de,be))if(Ue(de.source,be.source)&&Ue(de["source-layer"],be["source-layer"])&&Ue(de.type,be.type)){for(Ie in os(de.layout,be.layout,K,ge,null,Lt.setLayoutProperty),os(de.paint,be.paint,K,ge,null,Lt.setPaintProperty),Ue(de.filter,be.filter)||K.push({command:Lt.setFilter,args:[ge,be.filter]}),Ue(de.minzoom,be.minzoom)&&Ue(de.maxzoom,be.maxzoom)||K.push({command:Lt.setLayerZoomRange,args:[ge,be.minzoom,be.maxzoom]}),de)de.hasOwnProperty(Ie)&&"layout"!==Ie&&"paint"!==Ie&&"filter"!==Ie&&"metadata"!==Ie&&"minzoom"!==Ie&&"maxzoom"!==Ie&&(0===Ie.indexOf("paint.")?os(de[Ie],be[Ie],K,ge,Ie.slice(6),Lt.setPaintProperty):Ue(de[Ie],be[Ie])||K.push({command:Lt.setLayerProperty,args:[ge,Ie,be[Ie]]}));for(Ie in be)be.hasOwnProperty(Ie)&&!de.hasOwnProperty(Ie)&&"layout"!==Ie&&"paint"!==Ie&&"filter"!==Ie&&"metadata"!==Ie&&"minzoom"!==Ie&&"maxzoom"!==Ie&&(0===Ie.indexOf("paint.")?os(de[Ie],be[Ie],K,ge,Ie.slice(6),Lt.setPaintProperty):Ue(de[Ie],be[Ie])||K.push({command:Lt.setLayerProperty,args:[ge,Ie,be[Ie]]}))}else K.push({command:Lt.removeLayer,args:[ge]}),xe=Y[Y.lastIndexOf(ge)+1],K.push({command:Lt.addLayer,args:[be,xe]})}(F,E.layers,M)}catch(I){console.warn("Unable to compute style diff:",I),M=[{command:Lt.setStyle,args:[E]}]}return M}(this.serialize(),c).filter(b=>!(b.command in At));if(0===d.length)return!1;const v=d.filter(b=>!(b.command in Bd));if(v.length>0)throw new Error(`Unimplemented: ${v.map(b=>b.command).join(", ")}.`);return d.forEach(b=>{"setTransition"!==b.command&&"setProjection"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,d){return this.getImage(c)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,d),this._afterImageUpdated(c),this)}updateImage(c,d){this.imageManager.updateImage(c,d)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,d,v={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(p.validateSource,`sources.${c}`,d,null,v))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=tn(c,d,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:b.serialize(),sourceId:c}));const E=M=>{const I=(M?"symbol:":"other:")+c,k=this._sourceCaches[I]=new p.SourceCache(I,b,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[c]=k,k.style=this,k.onAdd(this.map)};E(!1),"vector"!==d.type&&"geojson"!==d.type||E(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const d=this.getSource(c);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(c);for(const b of v)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,d){this._checkLoaded(),this.getSource(c).setData(d),this._changed=!0}getSource(c){const d=this._getSourceCache(c);return d&&d.getSource()}_getSources(){const c=[];for(const d in this._otherSourceCaches){const v=this._getSourceCache(d);v&&c.push(v.getSource())}return c}addLayer(c,d,v={}){this._checkLoaded();const b=c.id;if(this.getLayer(b))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let E;if("custom"===c.type){if(_l(this,p.validateCustomStyleLayer(c)))return;E=p.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(b,c.source),c=p.clone$1(c),c=p.extend(c,{source:b})),this._validate(p.validateLayer,`layers.${b}`,c,{arrayIndex:-1},v))return;E=p.createStyleLayer(c),this._validateLayer(E),E.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}const M=d?this._order.indexOf(d):this._order.length;if(d&&-1===M)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(M,0,b),this._layerOrderChanged=!0,this._layers[b]=E;const I=this._getLayerSourceCache(E);if(this._removedLayers[b]&&E.source&&I&&"custom"!==E.type){const k=this._removedLayers[b];delete this._removedLayers[b],k.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",I.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,d){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===d)return;const v=this._order.indexOf(c);this._order.splice(v,1);const b=d?this._order.indexOf(d):this._order.length;d&&-1===b?this.fire(new p.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(b,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const d=this._layers[c];if(!d)return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const v=this._order.indexOf(c);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const d in this._layers)if(this._layers[d].type===c)return!0;return!1}setLayerZoomRange(c,d,v){this._checkLoaded();const b=this.getLayer(c);b?b.minzoom===d&&b.maxzoom===v||(null!=d&&(b.minzoom=d),null!=v&&(b.maxzoom=v),this._updateLayer(b)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,d,v={}){this._checkLoaded();const b=this.getLayer(c);if(b){if(!Ue(b.filter,d))return null==d?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(p.validateFilter,`layers.${b.id}.filter`,d,{layerType:b.type},v)||(b.filter=p.clone$1(d),this._updateLayer(b)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const d=this.getLayer(c);return d&&p.clone$1(d.filter)}setLayoutProperty(c,d,v,b={}){this._checkLoaded();const E=this.getLayer(c);E?Ue(E.getLayoutProperty(d),v)||(E.setLayoutProperty(d,v,b),this._updateLayer(E)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,d){const v=this.getLayer(c);if(v)return v.getLayoutProperty(d);this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,d,v,b={}){this._checkLoaded();const E=this.getLayer(c);E?Ue(E.getPaintProperty(d),v)||(E.setPaintProperty(d,v,b)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,d){const v=this.getLayer(c);return v&&v.getPaintProperty(d)}setFeatureState(c,d){this._checkLoaded();const v=c.source,b=c.sourceLayer,E=this.getSource(v);if(!E)return void this.fire(new p.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const M=E.type;if("geojson"===M&&b)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===M&&!b)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const I=this._getSourceCaches(v);for(const k of I)k.setFeatureState(b,c.id,d)}removeFeatureState(c,d){this._checkLoaded();const v=c.source,b=this.getSource(v);if(!b)return void this.fire(new p.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const E=b.type,M="vector"===E?c.sourceLayer:void 0;if("vector"===E&&!M)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const I=this._getSourceCaches(v);for(const k of I)k.removeFeatureState(M,c.id,d)}getFeatureState(c){this._checkLoaded();const d=c.source,v=c.sourceLayer,b=this.getSource(d);if(b){if("vector"!==b.type||v)return void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(v,c.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const d in this._sourceCaches){const v=this._sourceCaches[d].getSource();c[v.id]||(c[v.id]=v.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(c){this._updatedLayers[c.id]=!0;const d=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&d&&"raster"!==d.getSource().type&&(this._updatedSources[c.source]="reload",d.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const d=M=>"fill-extrusion"===this._layers[M].type,v={},b=[];for(let M=this._order.length-1;M>=0;M--){const I=this._order[M];if(d(I)){v[I]=M;for(const k of c){const F=k[I];if(F)for(const L of F)b.push(L)}}}b.sort((M,I)=>I.intersectionZ-M.intersectionZ);const E=[];for(let M=this._order.length-1;M>=0;M--){const I=this._order[M];if(d(I))for(let k=b.length-1;k>=0;k--){const F=b[k].feature;if(v[F.layer.id]<M)break;E.push(F),b.pop()}else for(const k of c){const F=k[I];if(F)for(const L of F)E.push(L.feature)}}return E}queryRenderedFeatures(c,d,v){d&&d.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of d.layers){const F=this._layers[k];if(!F)return this.fire(new p.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];b[F.source]=!0}}const E=[];d.availableImages=this._availableImages;const M=d&&d.layers?d.layers.some(k=>{const F=this.getLayer(k);return F&&F.is3D()}):this.has3DLayers(),I=Ca.createFromScreenPoints(c,v);for(const k in this._sourceCaches){const F=this._sourceCaches[k].getSource().id;d.layers&&!b[F]||E.push(xn(this._sourceCaches[k],this._layers,this._serializedLayers,I,d,v,M,!!this.map._showQueryGeometry))}return this.placement&&E.push(function(k,F,L,j,q,K,Q){const J={},ee=K.queryRenderedSymbols(j),U=[];for(const Y of Object.keys(ee).map(Number))U.push(Q[Y]);U.sort(Tr);for(const Y of U){const ie=Y.featureIndex.lookupSymbolFeatures(ee[Y.bucketInstanceId],F,Y.bucketIndex,Y.sourceLayerIndex,q.filter,q.layers,q.availableImages,k);for(const re in ie){const fe=J[re]=J[re]||[],ge=ie[re];ge.sort((de,be)=>{const xe=Y.featureSortOrder;if(xe){const Ie=xe.indexOf(de.featureIndex);return xe.indexOf(be.featureIndex)-Ie}return be.featureIndex-de.featureIndex});for(const de of ge)fe.push(de)}}for(const Y in J)J[Y].forEach(ie=>{const re=ie.feature,fe=L(k[Y]);if(!fe)return;const ge=fe.getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=ge});return J}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),I.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(c,d){d&&d.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",d.filter,null,d);const v=this._getSourceCaches(c);let b=[];for(const E of v)b=b.concat(Ri(E,d));return b}addSourceType(c,d,v){return wo.getSourceType(c)?v(new Error(`A source type called "${c}" already exists.`)):(wo.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(c,d={}){this._checkLoaded();const v=this.light.getLight();let b=!1;for(const M in c)if(!Ue(c[M],v[M])){b=!0;break}if(!b)return;const E=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,d),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,d=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=c;if(1===d){if("object"==typeof v.source){const b="terrain-dem-src";this.addSource(b,v.source),v=p.clone$1(v),v=p.extend(v,{source:b})}if(this._validate(p.validateTerrain,"terrain",v))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,d)}else{const b=this.terrain,E=b.get();for(const M of Object.keys(p.spec.terrain))!v.hasOwnProperty(M)&&p.spec.terrain[M].default&&(v[M]=p.spec.terrain[M].default);for(const M in v)if(!Ue(v[M],E[M])){b.set(v),this.stylesheet.terrain=v;const I=this._setTransitionParameters({duration:0});b.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const d=this.fog=new ul(c,this.map.transform);this.stylesheet.fog=c;const v=this._setTransitionParameters({duration:0});d.updateTransitions(v)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,v=d.get();0===Object.keys(c).length&&d.set(c);for(const b in c)if(!Ue(c[b],v[b])){d.set(c),this.stylesheet.fog=c;const E=this._setTransitionParameters({duration:0});d.updateTransitions(E);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:p.exported.now(),transition:p.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(v=>this.isLayerDraped(this._layers[v])),d=this._order.filter(v=>!this.isLayerDraped(this._layers[v]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...d)}_createTerrain(c,d){const v=this.terrain=new Ju(c,d);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b=this._setTransitionParameters({duration:0});v.updateTransitions(b)}_force3DLayerUpdate(){for(const c in this._layers){const d=this._layers[c];"fill-extrusion"===d.type&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const d=this._layers[c];"symbol"===d.type&&this._updateLayer(d)}}_validate(c,d,v,b,E={}){return(!E||!1!==E.validate)&&_l(this,c.call(p.validateStyle,p.extend({key:d,style:this.serialize(),value:v,styleSpec:p.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const d=this._getSourceCaches(c);for(const v of d)v.clearTiles()}_reloadSource(c){const d=this._getSourceCaches(c);for(const v of d)v.resume(),v.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const d in this._sourceCaches)this._sourceCaches[d].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const d=this._sourceCaches[c];d.resume(),d.reload()}}_updatePlacement(c,d,v,b,E=!1){let M=!1,I=!1;const k={};for(const F of this._order){const L=this._layers[F];if("symbol"!==L.type)continue;if(!k[L.source]){const q=this._getLayerSourceCache(L);if(!q)continue;k[L.source]=q.getRenderableIds(!0).map(K=>q.getTileByID(K)).sort((K,Q)=>Q.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(Q.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(L,k[L.source],c.center.lng,c.projection);M=M||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),E=E||this._layerOrderChanged||0===v,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),c.zoom))&&(this.pauseablePlacement=new Dp(c,this._order,E,d,v,b,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),I=!0),M&&this.pauseablePlacement.placement.setStale()),I||M)for(const F of this._order){const L=this._layers[F];"symbol"===L.type&&this.placement.updateLayerOpacities(L,k[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,d,v){this.imageManager.getImages(d.icons,v),this._updateTilesForChangedImages();const b=E=>{E&&E.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(c,d,v){this.glyphManager.getGlyphs(d.stacks,v)}getResource(c,d,v){return p.makeRequest(d,v)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const d=[];return this._otherSourceCaches[c]&&d.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&d.push(this._symbolSourceCaches[c]),d}_isSourceCacheLoaded(c){const d=this._getSourceCaches(c);return 0===d.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):d.every(v=>v.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}wo.getSourceType=function(g){return Ut[g]},wo.setSourceType=function(g,c){Ut[g]=c},wo.registerForPluginStateChange=p.registerForPluginStateChange;var Vd="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Ra="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",na="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ac="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Vo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let lc={},yl={};const Jc=[];vl(Vd,Jc),vl(na,Jc),vl(ac,Jc),vl(Vo,Jc),lc=In("",na),yl=In(Vo,ac);const Nt=In("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),cc=Vd,jd="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var uo={background:In("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:In("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:In("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:In("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:In("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:In("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:In("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:In("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:In("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:In("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:In("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:In("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:In("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:In("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:In("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:In("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:In("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:In("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:In("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:In("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:In("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:In("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:In("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:In("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:In("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:In("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ra),skyboxGradient:In("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ra),skyboxCapture:In("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:In("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:In("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function vl(g,c){const d=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let v of d)if(v=v.trim(),"#"===v[0]&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=v.split(" ");for(const E of b)c.includes(E)||c.push(E)}}function In(g,c){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b={},E=[...Jc];return vl(g,E),vl(c,E),{fragmentSource:g=g.replace(d,(M,I,k,F,L)=>(b[L]=!0,"define"===I?`\n#ifndef HAS_UNIFORM_u_${L}\nvarying ${k} ${F} ${L};\n#else\nuniform ${k} ${F} u_${L};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${L}\n    ${k} ${F} ${L} = u_${L};\n#endif\n`)),vertexSource:c=c.replace(d,(M,I,k,F,L)=>{const j="float"===F?"vec2":"vec4",q=L.match(/color/)?"color":j;return b[L]?"define"===I?`\n#ifndef HAS_UNIFORM_u_${L}\nuniform lowp float u_${L}_t;\nattribute ${k} ${j} a_${L};\nvarying ${k} ${F} ${L};\n#else\nuniform ${k} ${F} u_${L};\n#endif\n`:"vec4"===q?`\n#ifndef HAS_UNIFORM_u_${L}\n    ${L} = a_${L};\n#else\n    ${k} ${F} ${L} = u_${L};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${L}\n    ${L} = unpack_mix_${q}(a_${L}, u_${L}_t);\n#else\n    ${k} ${F} ${L} = u_${L};\n#endif\n`:"define"===I?`\n#ifndef HAS_UNIFORM_u_${L}\nuniform lowp float u_${L}_t;\nattribute ${k} ${j} a_${L};\n#else\nuniform ${k} ${F} u_${L};\n#endif\n`:"vec4"===q?`\n#ifndef HAS_UNIFORM_u_${L}\n    ${k} ${F} ${L} = a_${L};\n#else\n    ${k} ${F} ${L} = u_${L};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${L}\n    ${k} ${F} ${L} = unpack_mix_${q}(a_${L}, u_${L}_t);\n#else\n    ${k} ${F} ${L} = u_${L};\n#endif\n`}),staticAttributes:v,usedDefines:E}}class hi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,d,v,b,E,M,I){this.context=c;let k=this.boundPaintVertexBuffers.length!==b.length;for(let L=0;!k&&L<b.length;L++)this.boundPaintVertexBuffers[L]!==b[L]&&(k=!0);let F=this.boundDynamicVertexBuffers.length!==I.length;for(let L=0;!F&&L<I.length;L++)this.boundDynamicVertexBuffers[L]!==I[L]&&(F=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==v||k||F||this.boundIndexBuffer!==E||this.boundVertexOffset!==M)this.freshBind(d,v,b,E,M,I);else{c.bindVertexArrayOES.set(this.vao);for(const L of I)L&&L.bind();E&&E.dynamicDraw&&E.bind()}}freshBind(c,d,v,b,E,M){let I;const k=c.numAttributes,F=this.context,L=F.gl;if(F.extVertexArrayObject)this.vao&&this.destroy(),this.vao=F.extVertexArrayObject.createVertexArrayOES(),F.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=c,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=b,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=M;else{I=F.currentNumAttributes||0;for(let j=k;j<I;j++)L.disableVertexAttribArray(j)}d.enableAttributes(L,c),d.bind(),d.setVertexAttribPointers(L,c,E);for(const j of v)j.enableAttributes(L,c),j.bind(),j.setVertexAttribPointers(L,c,E);for(const j of M)j&&(j.enableAttributes(L,c),j.bind(),j.setVertexAttribPointers(L,c,E));b&&b.bind(),F.currentNumAttributes=k}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Sp(g,c){const d=Math.pow(2,c.canonical.z),v=c.canonical.y;return[new p.MercatorCoordinate(0,v/d).toLngLat().lat,new p.MercatorCoordinate(0,(v+1)/d).toLngLat().lat]}function xg(g,c,d,v,b,E,M){const I=g.context,k=I.gl,F=d.fbo;if(!F)return;g.prepareDrawTile();const L=g.useProgram("hillshade");I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,F.colorAttachment.get());const j=((J,ee,U,Y)=>{const ie=U.paint.get("hillshade-shadow-color"),re=U.paint.get("hillshade-highlight-color"),fe=U.paint.get("hillshade-accent-color");let ge=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===U.paint.get("hillshade-illumination-anchor")&&(ge-=J.transform.angle);const de=!J.options.moving;return{u_matrix:Y||J.transform.calculateProjMatrix(ee.tileID.toUnwrapped(),de),u_image:0,u_latrange:Sp(0,ee.tileID),u_light:[U.paint.get("hillshade-exaggeration"),ge],u_shadow:ie,u_highlight:re,u_accent:fe}})(g,d,v,g.terrain?c.projMatrix:null);g.prepareDrawProgram(I,L,c.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:K,tileBoundsSegments:Q}=g.getTileBoundsBuffers(d);L.draw(I,k.TRIANGLES,b,E,M,p.CullFaceMode.disabled,j,v.id,q,K,Q)}function Mp(g,c,d){if(!c.needsDEMTextureUpload)return;const v=g.context,b=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||g.getTileTexture(d.stride);const E=d.getPixels();c.demTexture?c.demTexture.update(E,{premultiply:!1}):c.demTexture=new p.Texture(v,E,b.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function uc(g,c,d,v,b,E){const M=g.context,I=M.gl;if(!c.dem)return;const k=c.dem;if(M.activeTexture.set(I.TEXTURE1),Mp(g,c,k),!c.demTexture)return;c.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);const F=k.dim;M.activeTexture.set(I.TEXTURE0);let L=c.fbo;if(!L){const Q=new p.Texture(M,{width:F,height:F,data:null},I.RGBA);Q.bind(I.LINEAR,I.CLAMP_TO_EDGE),L=c.fbo=M.createFramebuffer(F,F,!0),L.colorAttachment.set(Q.texture)}M.bindFramebuffer.set(L.framebuffer),M.viewport.set([0,0,F,F]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:q,tileBoundsSegments:K}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(M,I.TRIANGLES,v,b,E,p.CullFaceMode.disabled,((Q,J)=>{const ee=J.stride,U=p.create();return p.ortho(U,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(U,U,[0,-p.EXTENT,0]),{u_matrix:U,u_image:1,u_dimension:[ee,ee],u_zoom:Q.overscaledZ,u_unpack:J.unpackVector}})(c.tileID,k),d.id,j,q,K),c.needsHillshadePrepare=!1}const Qc=g=>({u_matrix:new p.UniformMatrix4f(g),u_image0:new p.Uniform1i(g),u_skirt_height:new p.Uniform1f(g)}),ia=(g,c)=>({u_matrix:g,u_image0:0,u_skirt_height:c}),lh=(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:d,u_zoom_transition:b,u_merc_center:E,u_image0:0,u_frustum_tl:M,u_frustum_tr:I,u_frustum_br:k,u_frustum_bl:F,u_globe_pos:L,u_globe_radius:j,u_viewport:q,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:K});function hc(g,c){return null!=g&&null!=c&&!(!g.hasData()||!c.hasData())&&null!=g.demTexture&&null!=c.demTexture&&g.tileID.key!==c.tileID.key}const ra=new class{constructor(){this.operations={}}newMorphing(g,c,d,v,b){if(g in this.operations){const E=this.operations[g];E.to.tileID.key!==d.tileID.key&&(E.queued=d)}else this.operations[g]={startTime:v,phase:0,duration:b,from:c,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const c=this.operations[g];return{from:c.from,to:c.to,phase:c.phase}}update(g){for(const c in this.operations){const d=this.operations[c];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[c];break}}}_nextOp(g,c){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=c,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Oa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function La(g){return 6*Math.pow(1.5,22-g)}function xl(g,c){const d=1<<g.z;return!c&&(0===g.x||g.x===d-1)||0===g.y||g.y===d-1}const eu=g=>({u_matrix:g});function Dt(g,c,d,v,b){if(b>0){const E=p.exported.now(),M=(E-g.timeAdded)/b,I=c?(E-c.timeAdded)/b:-1,k=d.getSource(),F=v.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),L=!c||Math.abs(c.tileID.overscaledZ-F)>Math.abs(g.tileID.overscaledZ-F),j=L&&g.refreshedUponExpiration?1:p.clamp(L?M:1-I,0,1);return g.refreshedUponExpiration&&M>=1&&(g.refreshedUponExpiration=!1),c?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class ch extends p.SourceCache{constructor(c){const d={type:"raster-dem",maxzoom:c.transform.maxZoom},v=new fn(rc(),null),b=tn("mock-dem",d,v,c.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,d){c.state="loaded",d(null)}}class cn extends p.SourceCache{constructor(c){const d=tn("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new fn(rc(),null),c.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,d,v){if(c.freezeTileCoverage)return;this.transform=c;const b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,M)=>{if(E[M.key]="",!this._tiles[M.key]){const I=new p.Tile(M,this._source.tileSize*M.overscaleFactor(),c.tileZoom);I.state="loaded",this._tiles[M.key]=I}return E},{});for(const E in this._tiles)E in b||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(c){const d=this.proxyCachedFBO[c];if(void 0!==d){const v=Object.values(d);this.renderCachePool.push(...v),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class bl extends p.OverscaledTileID{constructor(c,d,v){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=d,this.projMatrix=v}}class tu extends p.Elevation{constructor(c,d){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,b,E]=function(k){const F=new p.StructArrayLayout2i4,L=new p.StructArrayLayout3ui6,j=131;F.reserve(17161),L.reserve(33800);const q=p.EXTENT/128,K=p.EXTENT+q/2,Q=K+q;for(let ee=-q;ee<Q;ee+=q)for(let U=-q;U<Q;U+=q){const Y=U<0||U>K||ee<0||ee>K?24575:0,ie=p.clamp(Math.round(U),0,p.EXTENT),re=p.clamp(Math.round(ee),0,p.EXTENT);F.emplaceBack(ie+Y,re)}const J=(ee,U)=>{const Y=U*j+ee;L.emplaceBack(Y+1,Y,Y+j),L.emplaceBack(Y+j,Y+j+1,Y+1)};for(let ee=1;ee<129;ee++)for(let U=1;U<129;U++)J(U,ee);return[0,129].forEach(ee=>{for(let U=0;U<130;U++)J(U,ee),J(ee,U)}),[F,L,32768]}(),M=c.context;this.gridBuffer=M.createVertexBuffer(v,p.posAttributes.members),this.gridIndexBuffer=M.createIndexBuffer(b),this.gridSegments=p.SegmentVector.simpleSegment(0,0,v.length,b.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,v.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new cn(d.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const I=M.gl;this._overlapStencilMode=new p.StencilMode({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ch(d.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,d,v){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const b=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const E=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const M=this.getScaledDemTileSize();this.sourceCache.update(d,M,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,E(),this._initializing=!0),E(),d.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=0===v._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(v.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(k=>{const F=d.getTileByID(k).tileID;return F.projMatrix=v.calculateProjMatrix(F.toUnwrapped()),F});(function(k,F){const L=F.transform.pointCoordinate(F.transform.getCameraPoint()),j=new p.Point(L.x,L.y);k.sort((q,K)=>{if(K.overscaledZ-q.overscaledZ)return K.overscaledZ-q.overscaledZ;const Q=new p.Point(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),J=new p.Point(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ee=j.mult(1<<q.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(Q)-ee.distSqr(J)})})(b,this.painter),this._previousZoom=v.zoom;const E=this.proxyToSource||{};this.proxyToSource={},b.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const M=this._style._sourceCaches;for(const k in M){const F=M[k];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,c[k],E),F.usedForTerrain))continue;const L=c[k];F.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[d.id]=b.map(k=>new bl(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const I={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const F=this.terrainTileForTile[k.key];if(!F)continue;const L=F.tileID.key;L in I||(this._visibleDemTiles.push(F),I[L]=L)}}_assignTerrainTiles(c){this._initializing||c.forEach(d=>{if(this.terrainTileForTile[d.key])return;const v=this._findTileCoveringTileID(d,this.sourceCache);v&&(this.terrainTileForTile[d.key]=v)})}_prepareDEMTextures(){const c=this.painter.context,d=c.gl;for(const v in this.terrainTileForTile){const b=this.terrainTileForTile[v],E=b.dem;!E||b.demTexture&&!b.needsDEMTextureUpload||(c.activeTexture.set(d.TEXTURE1),Mp(this.painter,b,E))}}_prepareDemTileUniforms(c,d,v,b){if(!d||null==d.demTexture)return!1;const E=c.tileID.canonical,M=Math.pow(2,d.tileID.canonical.z-E.z),I=b||"";return v[`u_dem_tl${I}`]=[E.x*M%1,E.y*M%1],v[`u_dem_scale${I}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,d=c.gl;if(!this._emptyDepthBufferTexture){const v=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(c,v,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const d=this._visibleDemTiles.reduce((v,b)=>{if(!b.dem)return v;const E=b.dem.tree.minimums[0];return E>0&&c++,v+E},0);return c?d/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,d=c.gl;c.activeTexture.set(d.TEXTURE2);const v=this._getLoadedAreaMinimum(),b=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(v,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(b,{premultiply:!1}):E=this._emptyDEMTexture=new p.Texture(c,b,d.RGBA,{premultiply:!1}),E}setupElevationDraw(c,d,v){const b=this.painter.context,E=b.gl,M=(I=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(I),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var I;M.u_dem_size=this.sourceCache.getSource().tileSize,M.u_exaggeration=this.exaggeration();let k=null,F=null,L=1;if(v&&v.morphing&&this._useVertexMorphing){const j=v.morphing.srcDemTile,q=v.morphing.dstDemTile;L=v.morphing.phase,j&&q&&(this._prepareDemTileUniforms(c,j,M,"_prev")&&(F=j),this._prepareDemTileUniforms(c,q,M)&&(k=q))}if(F&&k?(b.activeTexture.set(E.TEXTURE2),k.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),b.activeTexture.set(E.TEXTURE4),F.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),M.u_dem_lerp=L):(k=this.terrainTileForTile[c.tileID.key],b.activeTexture.set(E.TEXTURE2),(this._prepareDemTileUniforms(c,k,M)?k.demTexture:this.emptyDEMTexture).bind(E.NEAREST,E.CLAMP_TO_EDGE)),b.activeTexture.set(E.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),this._depthFBO&&(M.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),M.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&k){const j=(1<<k.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=j}if(v&&v.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),d.setTerrainUniformValues(b,M),"globe"===this.painter.transform.projection.name){const j=this.globeUniformValues(this.painter.transform,c.tileID.canonical,v&&v.useDenormalizedUpVectorScale);d.setGlobeUniformValues(b,j)}}globeUniformValues(c,d,v){const b=c.projection;return{u_tile_tl_up:b.upVector(d,0,0),u_tile_tr_up:b.upVector(d,p.EXTENT,0),u_tile_br_up:b.upVector(d,p.EXTENT,p.EXTENT),u_tile_bl_up:b.upVector(d,0,p.EXTENT),u_tile_up_scale:v?p.globeMetersToEcef(1):b.upVectorScale(d,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const d=this.painter,v=this.painter.context;0!==c.length&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,E,M,I,k){if("globe"===b.transform.projection.name)!function(F,L,j,q,K){const Q=F.context,J=Q.gl;let ee,U;const Y=F.options.showTerrainWireframe?2:0,ie=F.transform,re=p.globeUseCustomAntiAliasing(F,Q,ie),fe=(We,Se)=>{if(U===We)return;const Ne=[Oa[We],"PROJECTION_GLOBE_VIEW"];re&&Ne.push("CUSTOM_ANTIALIASING"),Se&&Ne.push(Oa[Y]),ee=F.useProgram("globeRaster",null,Ne),U=We},ge=F.colorModeForRenderPass(),de=new p.DepthMode(J.LEQUAL,p.DepthMode.ReadWrite,F.depthRangeFor3D);ra.update(K);const be=p.calculateGlobeMercatorMatrix(ie),xe=[p.mercatorXfromLng(ie.center.lng),p.mercatorYfromLat(ie.center.lat)],Ie=Y?[!1,!0]:[!1],Xe=F.globeSharedBuffers,Te=[ie.width*p.exported.devicePixelRatio,ie.height*p.exported.devicePixelRatio],je=Float32Array.from(ie.globeMatrix),Pe={useDenormalizedUpVectorScale:!0};if(Ie.forEach(We=>{const Se=F.transform,Ne=La(Se.zoom)*L.exaggeration();U=-1;const Ye=We?J.LINES:J.TRIANGLES;for(const $e of q){const qe=j.getTile($e),_t=p.StencilMode.disabled,zt=L.prevTerrainTileForTile[$e.key],mt=L.terrainTileForTile[$e.key];hc(zt,mt)&&ra.newMorphing($e.key,zt,mt,K,250),Q.activeTexture.set(J.TEXTURE0),qe.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Tt=ra.getMorphValuesForProxy($e.key),dn=Tt?1:0;Tt&&p.extend$1(Pe,{morphing:{srcDemTile:Tt.from,dstDemTile:Tt.to,phase:p.easeCubicInOut(Tt.phase)}});const sn=p.tileCornersToBounds($e.canonical),vt=p.getLatitudinalLod(sn.getCenter().lat),Ln=p.getGridMatrix($e.canonical,sn,vt,Se.worldSize/Se._pixelsPerMercatorPixel),Jn=p.globeNormalizeECEF(p.globeTileBounds($e.canonical)),Fn=lh(Se.projMatrix,je,be,Jn,p.globeToMercatorTransition(Se.zoom),xe,Se.frustumCorners.TL,Se.frustumCorners.TR,Se.frustumCorners.BR,Se.frustumCorners.BL,Se.globeCenterInViewSpace,Se.globeRadius,Te,Ne,Ln);if(fe(dn,We),L.setupElevationDraw(qe,ee,Pe),F.prepareDrawProgram(Q,ee,$e.toUnwrapped()),Xe){const[jn,vr,Si]=We?Xe.getWirefameBuffers(F.context,vt):Xe.getGridBuffers(vt,0!==Ne);ee.draw(Q,Ye,de,_t,ge,p.CullFaceMode.backCCW,Fn,"globe_raster",jn,vr,Si)}}}),Xe){const We=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&We.push("CUSTOM_ANTIALIASING"),ee=F.useProgram("globeRaster",null,We);for(const Se of q){const{x:Ne,y:Ye,z:$e}=Se.canonical,qe=0===Ye,_t=Ye===(1<<$e)-1,[zt,mt,Tt,dn]=Xe.getPoleBuffers($e);if(dn&&(qe||_t)){const sn=j.getTile(Se);Q.activeTexture.set(J.TEXTURE0),sn.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let vt=p.globePoleMatrixForTile($e,Ne,ie);const Ln=p.globeNormalizeECEF(p.globeTileBounds(Se.canonical)),Jn=(Fn,jn)=>Fn.draw(Q,J.TRIANGLES,de,p.StencilMode.disabled,ge,p.CullFaceMode.disabled,lh(ie.projMatrix,vt,vt,Ln,0,xe,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Te,0),"globe_pole_raster",jn,Tt,dn);L.setupElevationDraw(sn,ee,Pe),F.prepareDrawProgram(Q,ee,Se.toUnwrapped()),qe&&Jn(ee,zt),_t&&(vt=p.scale(p.create(),vt,[1,-1,1]),Jn(ee,mt))}}}}(b,E,M,I,k);else{const F=b.context,L=F.gl;let j,q;const K=b.options.showTerrainWireframe?2:0,Q=(ie,re)=>{if(q===ie)return;const fe=[Oa[ie]];re&&fe.push(Oa[K]),j=b.useProgram("terrainRaster",null,fe),q=ie},J=b.colorModeForRenderPass(),ee=new p.DepthMode(L.LEQUAL,p.DepthMode.ReadWrite,b.depthRangeFor3D);ra.update(k);const U=b.transform,Y=La(U.zoom)*E.exaggeration();(K?[!1,!0]:[!1]).forEach(ie=>{q=-1;const re=ie?L.LINES:L.TRIANGLES,[fe,ge]=ie?E.getWirefameBuffer():[E.gridIndexBuffer,E.gridSegments];for(const de of I){const be=M.getTile(de),xe=p.StencilMode.disabled,Ie=E.prevTerrainTileForTile[de.key],Xe=E.terrainTileForTile[de.key];hc(Ie,Xe)&&ra.newMorphing(de.key,Ie,Xe,k,250),F.activeTexture.set(L.TEXTURE0),be.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const Te=ra.getMorphValuesForProxy(de.key),je=Te?1:0;let Pe;Te&&(Pe={morphing:{srcDemTile:Te.from,dstDemTile:Te.to,phase:p.easeCubicInOut(Te.phase)}});const We=ia(de.projMatrix,xl(de.canonical,U.renderWorldCopies)?Y/10:Y);Q(je,ie),E.setupElevationDraw(be,j,Pe),b.prepareDrawProgram(F,j,de.toUnwrapped()),j.draw(F,re,ee,xe,J,p.CullFaceMode.backCCW,We,"terrain_raster",E.gridBuffer,fe,ge)}})}}(d,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const d=this.painter,v=this.painter.context,b=this.proxySourceCache,E=this.proxiedCoords[b.id],M=this._drapedRenderBatches.shift(),I=[],k=d.style.order;let F=0;for(const L of E){const j=b.getTileByID(L.proxyTileKey),q=b.proxyCachedFBO[L.key]?b.proxyCachedFBO[L.key][c]:void 0,K=void 0!==q?b.renderCache[q]:this.pool[F++],Q=void 0!==q;if(j.texture=K.tex,Q&&!K.dirty){I.push(j.tileID);continue}let J;v.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(v.clear({color:p.Color.transparent,stencil:0}),K.dirty=!1);for(let ee=M.start;ee<=M.end;++ee){const U=d.style._layers[k[ee]];if(U.isHidden(d.transform.zoom))continue;const Y=d.style._getLayerSourceCache(U),ie=Y?this.proxyToSource[L.key][Y.id]:[L];if(!ie)continue;const re=ie;v.viewport.set([0,0,K.fb.width,K.fb.height]),J!==(Y?Y.id:null)&&(this._setupStencil(K,ie,U,Y),J=Y?Y.id:null),d.renderLayer(d,Y,U,re)}this.renderedToTile?(K.dirty=!0,I.push(j.tileID)):Q||--F,5===F&&(F=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,d.width,d.height]),M.end+1}postRender(){}renderCacheEfficiency(c){const d=c.order.length;if(0===d)return{efficiency:100};let v,b=0,E=0,M=!1;for(let I=0;I<d;++I){const k=c._layers[c.order[I]];this._style.isLayerDraped(k)?(M&&++b,++E):M||(M=!0,v=k.id)}return 0===E?{efficiency:100}:{efficiency:100*(1-b/E),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{c=Math.min(c,d.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,d,v){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const M=E.tileID,I=1<<M.overscaledZ,{x:k,y:F}=M.canonical,L=k/I,j=(k+1)/I,q=F/I,K=(F+1)/I;return{minx:L,miny:q,maxx:j,maxy:K,t:E.dem.tree.raycastRoot(L,q,j,K,c,d,v),tile:E}});b.sort((E,M)=>(null!==E.t?E.t:Number.MAX_VALUE)-(null!==M.t?M.t:Number.MAX_VALUE));for(const E of b){if(null==E.t)return null;const M=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,c,d,v);if(null!=M)return M}return null}_createFBO(){const c=this.painter.context,d=c.gl,v=this.drapeBufferSize;c.activeTexture.set(d.TEXTURE0);const b=new p.Texture(c,{width:v[0],height:v[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const E=c.createFramebuffer(v[0],v[1],!1);return E.colorAttachment.set(b.texture),E.depthAttachment=new _e(c,E.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:E,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const d=this._style._layers[c],v=d.isHidden(this.painter.transform.zoom);return"custom"===d.type?!v&&d.shouldRedrape():!v&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const v of this._style._getSources())if(v instanceof it){c=!0;break}if(!c)return;const d={};for(let v=0;v<this._style.order.length;++v){const b=this._style._layers[this._style.order[v]],E=this._style._getLayerSourceCache(b);if(E&&!d[E.id]&&!b.isHidden(this.painter.transform.zoom)&&"line"===b.type&&b.widthExpression()instanceof p.ZoomDependentExpression){d[E.id]=!0;for(const M of this.proxyCoords){const I=this.proxyToSource[M.key][E.id];if(I)for(const k of I)this._clearRenderCacheForTile(E.id,k)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const v in this._style._sourceCaches)if(this._style._sourceCaches[v]._source instanceof Je){c=!0;break}if(!c)return;const d={};for(let v=0;v<this._style.order.length;++v){const b=this._style._layers[this._style.order[v]],E=this._style._getLayerSourceCache(b);if(!E||d[E.id]||b.isHidden(this.painter.transform.zoom)||"raster"!==b.type)continue;const M=b.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const k=this.proxyToSource[I.key][E.id];if(k)for(const F of k){const L=Dt(E.getTile(F),E.findLoadedParent(F,0),E,this.painter.transform,M);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(E.id,F)}}}}_setupDrapedRenderBatches(){const c=this._style.order,d=c.length;if(0===d)return;const v=[];let b,E=0,M=this._style._layers[c[E]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++E<d;)M=this._style._layers[c[E]];for(;E<d;++E){const I=this._style._layers[c[E]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?void 0===b&&(b=E):void 0!==b&&(v.push({start:b,end:E-1}),b=void 0))}void 0!==b&&v.push({start:b,end:E-1}),this._drapedRenderBatches=v}_setupRenderCache(c){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const M=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let I=0;I<M.length;++I){const k=Object.values(M[I]);d.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,b=this._tilesDirty;for(let M=v.length-1;M>=0;M--){const I=v[M];if(d.getTileByID(I.key),void 0!==d.proxyCachedFBO[I.key]){const k=c[I.key],F=this.proxyToSource[I.key];let L=0;for(const j in F){const q=F[j],K=k[j];if(!K||K.length!==q.length||q.some((Q,J)=>Q!==K[J]||b[j]&&b[j].hasOwnProperty(Q.key))){L=-1;break}++L}for(const j in d.proxyCachedFBO[I.key])d.renderCache[d.proxyCachedFBO[I.key][j]].dirty=L<0||L!==Object.values(k).length}}const E=[...this._drapedRenderBatches];E.sort((M,I)=>I.end-I.start-(M.end-M.start));for(const M of E)for(const I of v){if(d.proxyCachedFBO[I.key])continue;let k=d.renderCachePool.pop();void 0===k&&d.renderCache.length<50&&(k=d.renderCache.length,d.renderCache.push(this._createFBO())),void 0!==k&&(d.proxyCachedFBO[I.key]={},d.proxyCachedFBO[I.key][M.start]=k,d.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(c,d,v,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,M=E.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let I;if(v.isTileClipped())I=d.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(c,d){const v=this.painter,b=this.painter.context,E=b.gl;v._tileClippingMaskIDs={},b.setColorMode(p.ColorMode.disabled),b.setDepthMode(p.DepthMode.disabled);const M=v.useProgram("clippingMask");for(const I of c){const k=v._tileClippingMaskIDs[I.key]=--d;M.draw(b,E.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:E.ALWAYS,mask:0},k,255,E.KEEP,E.KEEP,E.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,eu(I.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(c){const d=this.painter.transform;if(c.x<0||c.x>d.width||c.y<0||c.y>d.height)return null;const v=[c.x,c.y,1,1];p.transformMat4$1(v,v,d.pixelMatrixInverse),p.scale$1(v,v,1/v[3]),v[0]/=d.worldSize,v[1]/=d.worldSize;const b=d._camera.position,E=p.mercatorZfromAltitude(1,d.center.lat),M=[b[0],b[1],b[2]/E,0],I=p.subtract([],v.slice(0,3),M);p.normalize(I,I);const k=this.raycast(M,I,this._exaggeration);return null!==k&&k?(p.scaleAndAdd(M,M,I,k),M[3]=M[2],M[2]*=E,M):null}drawDepth(){const c=this.painter,d=c.context,v=this.proxySourceCache,b=Math.ceil(c.width),E=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===E||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const M=d.gl,I=d.createFramebuffer(b,E,!0);d.activeTexture.set(M.TEXTURE0);const k=new p.Texture(d,{width:b,height:E,data:null},M.RGBA);k.bind(M.NEAREST,M.CLAMP_TO_EDGE),I.colorAttachment.set(k.texture);const F=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,b,E);I.depthAttachment.set(F),this._depthFBO=I,this._depthTexture=k}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,b,E]),function(M,I,k,F){if("globe"===M.transform.projection.name)return;const L=M.context,j=L.gl;L.clear({depth:1});const q=M.useProgram("terrainDepth"),K=new p.DepthMode(j.LESS,p.DepthMode.ReadWrite,M.depthRangeFor3D);for(const Q of F){const J=k.getTile(Q),ee=ia(Q.projMatrix,0);I.setupElevationDraw(J,q),q.draw(L,j.TRIANGLES,K,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,ee,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(c,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,d,v){if(c.getSource()instanceof en)return this._setupProxiedCoordsForImageSource(c,d,v);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const b=this.proxiedCoords[c.id]=[],E=this.proxyCoords;for(let I=0;I<E.length;I++){const k=E[I],F=this._findTileCoveringTileID(k,c);if(F){const L=this._createProxiedId(k,F,v[k.key]&&v[k.key][c.id]);b.push(L),this.proxyToSource[k.key][c.id]=[L]}}let M=!1;for(let I=0;I<d.length;I++){const k=c.getTile(d[I]);if(!k||!k.hasData())continue;const F=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==k.tileID.canonical.z){const L=this.proxyToSource[F.tileID.key][c.id],j=this._createProxiedId(F.tileID,k,v[F.tileID.key]&&v[F.tileID.key][c.id]);L?L.splice(L.length-1,0,j):this.proxyToSource[F.tileID.key][c.id]=[j],b.push(j),M=!0}}this._sourceTilesOverlap[c.id]=M}_setupProxiedCoordsForImageSource(c,d,v){if(!c.getSource().loaded())return;const b=this.proxiedCoords[c.id]=[],E=this.proxyCoords,M=c.getSource(),I=new p.Point(M.tileID.x,M.tileID.y)._div(1<<M.tileID.z),k=M.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((L,j)=>(L.min.x=Math.min(L.min.x,j.x-I.x),L.min.y=Math.min(L.min.y,j.y-I.y),L.max.x=Math.max(L.max.x,j.x-I.x),L.max.y=Math.max(L.max.y,j.y-I.y),L),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(L,j)=>{const q=L.wrap+L.canonical.x/(1<<L.canonical.z),K=L.canonical.y/(1<<L.canonical.z),Q=p.EXTENT/(1<<L.canonical.z),J=j.wrap+j.canonical.x/(1<<j.canonical.z),ee=j.canonical.y/(1<<j.canonical.z);return q+Q<J+k.min.x||q>J+k.max.x||K+Q<ee+k.min.y||K>ee+k.max.y};for(let L=0;L<E.length;L++){const j=E[L];for(let q=0;q<d.length;q++){const K=c.getTile(d[q]);if(!K||!K.hasData()||F(j,K.tileID))continue;const Q=this._createProxiedId(j,K,v[j.key]&&v[j.key][c.id]),J=this.proxyToSource[j.key][c.id];J?J.push(Q):this.proxyToSource[j.key][c.id]=[Q],b.push(Q)}}}_createProxiedId(c,d,v){let b=this.orthoMatrix;if(v){const E=v.find(M=>M.key===d.tileID.key);if(E)return E}if(d.tileID.key!==c.key){const E=c.canonical.z-d.tileID.canonical.z;let M,I,k;b=p.create();const F=d.tileID.wrap-c.wrap<<c.overscaledZ;E>0?(M=p.EXTENT>>E,I=M*((d.tileID.canonical.x<<E)-c.canonical.x+F),k=M*((d.tileID.canonical.y<<E)-c.canonical.y)):(M=p.EXTENT<<-E,I=p.EXTENT*(d.tileID.canonical.x-(c.canonical.x+F<<-E)),k=p.EXTENT*(d.tileID.canonical.y-(c.canonical.y<<-E))),p.ortho(b,0,M,0,M,0,1),p.translate(b,b,[I,k,0])}return new bl(d.tileID,c.key,b)}_findTileCoveringTileID(c,d){let v=d.getTile(c);if(v&&v.hasData())return v;const b=this._findCoveringTileCache[d.id],E=b[c.key];if(v=E?d.getTileByID(E):null,v&&v.hasData()||null===E)return v;let M=v?v.tileID:c,I=M.overscaledZ;const k=d.getSource().minzoom,F=[];if(!E){const j=d.getSource().maxzoom;if(c.canonical.z>=j){const q=c.canonical.z-j;d.getSource().reparseOverscaled?(I=Math.max(c.canonical.z+2,d.transform.tileZoom),M=new p.OverscaledTileID(I,c.wrap,j,c.canonical.x>>q,c.canonical.y>>q)):0!==q&&(I=j,M=new p.OverscaledTileID(I,c.wrap,j,c.canonical.x>>q,c.canonical.y>>q))}M.key!==c.key&&(F.push(M.key),v=d.getTile(M))}const L=j=>{F.forEach(q=>{b[q]=j}),F.length=0};for(I-=1;I>=k&&(!v||!v.hasData());I--){v&&L(v.tileID.key);const j=M.calculateScaledKey(I);if(v=d.getTileByID(j),v&&v.hasData())break;const q=b[j];if(null===q)break;void 0===q?F.push(j):v=d.getTileByID(q)}return L(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,d){let v=this._tilesDirty[c];v||(v=this._tilesDirty[c]={}),v[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(d){let v=0;const b=new p.StructArrayLayout2ui4,E=131;for(let M=1;M<129;M++){for(let I=1;I<129;I++)v=M*E+I,b.emplaceBack(v,v+1),b.emplaceBack(v,v+E),b.emplaceBack(v+1,v+E),128===M&&b.emplaceBack(v+E,v+E+1);b.emplaceBack(v+1,v+1+E)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class mn{static cacheKey(c,d,v,b){let E=`${d}${b?b.cacheKey:""}`;for(const M of v)c.usedDefines.includes(M)&&(E+=`/${M}`);return E}constructor(c,d,v,b,E,M){const I=c.gl;this.program=I.createProgram();const k=function(U){const Y=[];for(let ie=0;ie<U.length;ie++){if(null===U[ie])continue;const re=U[ie].split(" ");Y.push(re.pop())}return Y}(v.staticAttributes),F=b?b.getBinderAttributes():[],L=k.concat(F);let j=b?b.defines():[];j=j.concat(M.map(U=>`#define ${U}`));const q=c.isWebGL2?"#version 300 es\n":"",K=q+j.concat(c.extStandardDerivatives&&0===q.length?"#extension GL_OES_standard_derivatives : enable\n".concat(jd):jd,jd,cc,Nt.fragmentSource,yl.fragmentSource,v.fragmentSource).join("\n"),Q=q+j.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",cc,Nt.vertexSource,yl.vertexSource,lc.vertexSource,v.vertexSource).join("\n"),J=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(J,K),I.compileShader(J),I.attachShader(this.program,J);const ee=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(ee,Q),I.compileShader(ee),I.attachShader(this.program,ee),this.attributes={},this.numAttributes=L.length;for(let U=0;U<this.numAttributes;U++)L[U]&&(I.bindAttribLocation(this.program,U,L[U]),this.attributes[L[U]]=U);I.linkProgram(this.program),I.deleteShader(ee),I.deleteShader(J),this.fixedUniforms=E(c),this.binderUniforms=b?b.getUniforms(c):[],M.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(U=c),u_dem_prev:new p.Uniform1i(U),u_dem_unpack:new p.Uniform4f(U),u_dem_tl:new p.Uniform2f(U),u_dem_scale:new p.Uniform1f(U),u_dem_tl_prev:new p.Uniform2f(U),u_dem_scale_prev:new p.Uniform1f(U),u_dem_size:new p.Uniform1f(U),u_dem_lerp:new p.Uniform1f(U),u_exaggeration:new p.Uniform1f(U),u_depth:new p.Uniform1i(U),u_depth_size_inv:new p.Uniform2f(U),u_meter_to_dem:new p.Uniform1f(U),u_label_plane_matrix_inv:new p.UniformMatrix4f(U)}),M.includes("GLOBE")&&(this.globeUniforms=(U=>({u_tile_tl_up:new p.Uniform3f(U),u_tile_tr_up:new p.Uniform3f(U),u_tile_br_up:new p.Uniform3f(U),u_tile_bl_up:new p.Uniform3f(U),u_tile_up_scale:new p.Uniform1f(U)}))(c)),M.includes("FOG")&&(this.fogUniforms=(U=>({u_fog_matrix:new p.UniformMatrix4f(U),u_fog_range:new p.Uniform2f(U),u_fog_color:new p.Uniform4f(U),u_fog_horizon_blend:new p.Uniform1f(U),u_fog_temporal_offset:new p.Uniform1f(U),u_frustum_tl:new p.Uniform3f(U),u_frustum_tr:new p.Uniform3f(U),u_frustum_br:new p.Uniform3f(U),u_frustum_bl:new p.Uniform3f(U),u_globe_pos:new p.Uniform3f(U),u_globe_radius:new p.Uniform1f(U),u_globe_transition:new p.Uniform1f(U),u_is_globe:new p.Uniform1i(U),u_viewport:new p.Uniform2f(U)}))(c))}var U}setTerrainUniformValues(c,d){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)v[b]&&v[b].set(this.program,b,d[b])}}setGlobeUniformValues(c,d){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)v[b]&&v[b].set(this.program,b,d[b])}}setFogUniformValues(c,d){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)v[b].set(this.program,b,d[b])}}draw(c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J){const ee=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(v),c.setStencilMode(b),c.setColorMode(E),c.setCullFace(M);for(const Y of Object.keys(this.fixedUniforms))this.fixedUniforms[Y].set(this.program,Y,I[Y]);Q&&Q.setUniforms(this.program,c,this.binderUniforms,q,{zoom:K});const U={[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[d];for(const Y of j.get()){const ie=Y.vaos||(Y.vaos={});(ie[k]||(ie[k]=new hi)).bind(c,this,F,Q?Q.getPaintVertexBuffers():[],L,Y.vertexOffset,J||[]),ee.drawElements(d,Y.primitiveLength*U,ee.UNSIGNED_SHORT,Y.primitiveOffset*U*2)}}}function nu(g,c){const d=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,g.transform.tileZoom)/d,b=v*(c.tileID.canonical.x+c.tileID.wrap*d),E=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/Xi(c,1,g.transform.tileZoom),u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}const Ip=p.create(),Ud=(g,c,d,v,b,E,M,I,k,F,L)=>{const j=c.style.light,q=j.properties.get("position"),K=[q.x,q.y,q.z],Q=p.create$1();"viewport"===j.properties.get("anchor")&&(p.fromRotation(Q,-c.transform.angle),p.transformMat3(K,K,Q));const J=j.properties.get("color"),ee=c.transform,U={u_matrix:g,u_lightpos:K,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+d,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ip,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:E};return"globe"===ee.projection.name&&(U.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],U.u_zoom_transition=k,U.u_inv_rot_matrix=L,U.u_merc_center=F,U.u_up_dir=ee.projection.upVector(new p.CanonicalTileID(0,0,0),F[0]*p.EXTENT,F[1]*p.EXTENT),U.u_height_lift=I),U},Ps=(g,c,d,v,b,E,M,I,k,F,L,j)=>{const q=Ud(g,c,d,v,b,E,M,k,F,L,j),K={u_height_factor:-Math.pow(2,M.overscaledZ)/I.tileSize/8};return p.extend(q,nu(c,I),K)},Mr=g=>({u_matrix:g}),jo=(g,c,d)=>p.extend(Mr(g),nu(c,d)),oa=(g,c)=>({u_matrix:g,u_world:c}),Vn=(g,c,d,v)=>p.extend(jo(g,c,d),{u_world:v}),uh=p.create(),iu=(g,c,d,v,b,E)=>{const M=g.transform,I="globe"===M.projection.name;let k;if("map"===E.paint.get("circle-pitch-alignment"))if(I){const L=p.globePixelsToTileUnits(M.zoom,c.canonical)*M._pixelsPerMercatorPixel;k=Float32Array.from([L,0,0,L])}else k=M.calculatePixelsToTileUnitsMatrix(d);else k=new Float32Array([M.pixelsToGLUnits[0],0,0,M.pixelsToGLUnits[1]]);const F={u_camera_to_center_distance:M.cameraToCenterDistance,u_matrix:g.translatePosMatrix(c.projMatrix,d,E.paint.get("circle-translate"),E.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:k,u_inv_rot_matrix:uh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){F.u_inv_rot_matrix=v,F.u_merc_center=b,F.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],F.u_zoom_transition=p.globeToMercatorTransition(M.zoom);const L=b[0]*p.EXTENT,j=b[1]*p.EXTENT;F.u_up_dir=M.projection.upVector(new p.CanonicalTileID(0,0,0),L,j)}return F},ru=g=>{const c=[];return"map"===g.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},hh=(g,c,d,v)=>{const b=p.EXTENT/d.tileSize;return{u_matrix:g,u_camera_to_center_distance:c.getCameraToCenterDistance(v),u_extrude_scale:[c.pixelsToGLUnits[0]/b,c.pixelsToGLUnits[1]/b]}},Uo=(g,c,d=1)=>({u_matrix:g,u_color:c,u_overlay:0,u_overlay_scale:d}),dc=p.create(),Ap=(g,c,d,v,b,E,M)=>{const I=g.transform,k="globe"===I.projection.name,F=k?p.globePixelsToTileUnits(I.zoom,c.canonical)*I._pixelsPerMercatorPixel:Xi(d,1,E),L={u_matrix:c.projMatrix,u_extrude_scale:F,u_intensity:M,u_inv_rot_matrix:dc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){L.u_inv_rot_matrix=v,L.u_merc_center=b,L.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],L.u_zoom_transition=p.globeToMercatorTransition(I.zoom);const j=b[0]*p.EXTENT,q=b[1]*p.EXTENT;L.u_up_dir=I.projection.upVector(new p.CanonicalTileID(0,0,0),j,q)}return L},ks=(g,c,d,v,b,E,M)=>{const I=g.transform,k=I.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:$d(g,c,d,v),u_pixels_to_tile_units:k,u_device_pixel_ratio:E,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:lr(d)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:fc(c,g.transform),u_alpha_discard_threshold:0,u_trim_offset:M}},ou=(g,c,d,v,b)=>{const E=g.transform;return{u_matrix:$d(g,c,d,v),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:b,u_image:0,u_tile_units_to_pixels:fc(c,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function fc(g,c){return 1/Xi(g,1,c.tileZoom)}function $d(g,c,d,v){return g.translatePosMatrix(v||c.tileID.projMatrix,c,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function lr(g){const c=g.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const Hd=(g,c,d,v,b,E)=>{return{u_matrix:g,u_tl_parent:c,u_scale_parent:d,u_fade_t:v.mix,u_opacity:v.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(I=b.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(M=b.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:ls(b.paint.get("raster-hue-rotate")),u_perspective_transform:E};var M,I};function ls(g){g*=Math.PI/180;const c=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*c-d+1)/3,(Math.sqrt(3)*c-d+1)/3]}const Ft=p.create(),Ir=(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J)=>{const ee=b.transform,U={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:ee.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:ee.width/ee.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:M,u_coord_matrix:I,u_is_text:+k,u_pitch_with_map:+v,u_texsize:F,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ft,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ft,u_up_vector:[0,-1,0]};return"globe"===J.name&&(U.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],U.u_zoom_transition=j,U.u_inv_rot_matrix=K,U.u_merc_center=q,U.u_camera_forward=ee._camera.forward(),U.u_ecef_origin=p.globeECEFOrigin(ee.globeMatrix,L.toUnwrapped()),U.u_tile_matrix=Float32Array.from(ee.globeMatrix),U.u_up_vector=Q),U},An=(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J,ee)=>p.extend(Ir(g,c,d,v,b,E,M,I,k,F,j,q,K,Q,J,ee),{u_gamma_scale:v?b.transform.cameraToCenterDistance*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+L}),mr=(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J)=>p.extend(An(g,c,d,v,b,E,M,I,!0,k,!0,L,j,q,K,Q,J),{u_texsize_icon:F,u_texture_icon:1}),Ar=(g,c,d)=>({u_matrix:g,u_opacity:c,u_color:d}),pc=(g,c,d,v,b)=>p.extend(function(E,M,I){const k=M.imageManager.getPattern(E.toString()),{width:F,height:L}=M.imageManager.getPixelSize(),j=Math.pow(2,I.tileID.overscaledZ),q=I.tileSize*Math.pow(2,M.transform.tileZoom)/j,K=q*(I.tileID.canonical.x+I.tileID.wrap*j),Q=q*I.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[F,L],u_pattern_size:k.displaySize,u_tile_units_to_pixels:1/Xi(I,1,M.transform.tileZoom),u_pixel_coord_upper:[K>>16,Q>>16],u_pixel_coord_lower:[65535&K,65535&Q]}}(v,d,b),{u_matrix:g,u_opacity:c}),Gr={fillExtrusion:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g)}),fillExtrusionPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_height_factor:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g)}),fill:g=>({u_matrix:new p.UniformMatrix4f(g)}),fillPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),fillOutline:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g)}),fillOutlinePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),circle:g=>({u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),collisionBox:g=>({u_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.Uniform2f(g)}),collisionCircle:g=>({u_matrix:new p.UniformMatrix4f(g),u_inv_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_viewport_size:new p.Uniform2f(g)}),debug:g=>({u_color:new p.UniformColor(g),u_matrix:new p.UniformMatrix4f(g),u_overlay:new p.Uniform1i(g),u_overlay_scale:new p.Uniform1f(g)}),clippingMask:g=>({u_matrix:new p.UniformMatrix4f(g)}),heatmap:g=>({u_extrude_scale:new p.Uniform1f(g),u_intensity:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),heatmapTexture:g=>({u_image:new p.Uniform1i(g),u_color_ramp:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g)}),hillshade:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_latrange:new p.Uniform2f(g),u_light:new p.Uniform2f(g),u_shadow:new p.UniformColor(g),u_highlight:new p.UniformColor(g),u_accent:new p.UniformColor(g)}),hillshadePrepare:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_dimension:new p.Uniform2f(g),u_zoom:new p.Uniform1f(g),u_unpack:new p.Uniform4f(g)}),line:g=>({u_matrix:new p.UniformMatrix4f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_units_to_pixels:new p.Uniform2f(g),u_dash_image:new p.Uniform1i(g),u_gradient_image:new p.Uniform1i(g),u_image_height:new p.Uniform1f(g),u_texsize:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g),u_trim_offset:new p.Uniform2f(g)}),linePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_texsize:new p.Uniform2f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_units_to_pixels:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g)}),raster:g=>({u_matrix:new p.UniformMatrix4f(g),u_tl_parent:new p.Uniform2f(g),u_scale_parent:new p.Uniform1f(g),u_fade_t:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_image0:new p.Uniform1i(g),u_image1:new p.Uniform1i(g),u_brightness_low:new p.Uniform1f(g),u_brightness_high:new p.Uniform1f(g),u_saturation_factor:new p.Uniform1f(g),u_contrast_factor:new p.Uniform1f(g),u_spin_weights:new p.Uniform3f(g),u_perspective_transform:new p.Uniform2f(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_texture:new p.Uniform1i(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_is_halo:new p.Uniform1i(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texsize_icon:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_texture_icon:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_is_halo:new p.Uniform1i(g)}),background:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_color:new p.UniformColor(g)}),backgroundPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_pattern_tl:new p.Uniform2f(g),u_pattern_br:new p.Uniform2f(g),u_texsize:new p.Uniform2f(g),u_pattern_size:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),terrainRaster:Qc,terrainDepth:Qc,skybox:g=>({u_matrix:new p.UniformMatrix4f(g),u_sun_direction:new p.Uniform3f(g),u_cubemap:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxGradient:g=>({u_matrix:new p.UniformMatrix4f(g),u_color_ramp:new p.Uniform1i(g),u_center_direction:new p.Uniform3f(g),u_radius:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxCapture:g=>({u_matrix_3f:new p.UniformMatrix3f(g),u_sun_direction:new p.Uniform3f(g),u_sun_intensity:new p.Uniform1f(g),u_color_tint_r:new p.Uniform4f(g),u_color_tint_m:new p.Uniform4f(g),u_luminance:new p.Uniform1f(g)}),globeRaster:g=>({u_proj_matrix:new p.UniformMatrix4f(g),u_globe_matrix:new p.UniformMatrix4f(g),u_normalize_matrix:new p.UniformMatrix4f(g),u_merc_matrix:new p.UniformMatrix4f(g),u_zoom_transition:new p.Uniform1f(g),u_merc_center:new p.Uniform2f(g),u_image0:new p.Uniform1i(g),u_grid_matrix:new p.UniformMatrix3f(g),u_skirt_height:new p.Uniform1f(g),u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_globe_pos:new p.Uniform3f(g),u_globe_radius:new p.Uniform1f(g),u_viewport:new p.Uniform2f(g)}),globeAtmosphere:g=>({u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_horizon:new p.Uniform1f(g),u_transition:new p.Uniform1f(g),u_fadeout_range:new p.Uniform1f(g),u_color:new p.Uniform4f(g),u_high_color:new p.Uniform4f(g),u_space_color:new p.Uniform4f(g),u_star_intensity:new p.Uniform1f(g),u_star_density:new p.Uniform1f(g),u_star_size:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g),u_horizon_angle:new p.Uniform1f(g),u_rotation_matrix:new p.UniformMatrix4f(g)})};let su;function mc(g,c,d,v,b,E,M){const I=g.context,k=I.gl,F=g.transform,L=g.useProgram("collisionBox"),j=[];let q=0,K=0;for(let re=0;re<v.length;re++){const fe=v[re],ge=c.getTile(fe),de=ge.getBucket(d);if(!de)continue;const be=lo(fe,de,F);let xe=be;0===b[0]&&0===b[1]||(xe=g.translatePosMatrix(be,ge,b,E));const Ie=M?de.textCollisionBox:de.iconCollisionBox,Xe=de.collisionCircleArray;if(Xe.length>0){const Te=p.create(),je=xe;p.mul(Te,de.placementInvProjMatrix,F.glCoordMatrix),p.mul(Te,Te,de.placementViewportMatrix),j.push({circleArray:Xe,circleOffset:K,transform:je,invTransform:Te,projection:de.getProjection()}),q+=Xe.length/4,K=q}Ie&&(g.terrain&&g.terrain.setupElevationDraw(ge,L),L.draw(I,k.LINES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,hh(xe,F,ge,de.getProjection()),d.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,null,F.zoom,null,[Ie.collisionVertexBuffer,Ie.collisionVertexBufferExt]))}if(!M||!j.length)return;const Q=g.useProgram("collisionCircle"),J=new p.StructArrayLayout2f1f2i16;J.resize(4*q),J._trim();let ee=0;for(const re of j)for(let fe=0;fe<re.circleArray.length/4;fe++){const ge=4*fe,de=re.circleArray[ge+0],be=re.circleArray[ge+1],xe=re.circleArray[ge+2],Ie=re.circleArray[ge+3];J.emplace(ee++,de,be,xe,Ie,0),J.emplace(ee++,de,be,xe,Ie,1),J.emplace(ee++,de,be,xe,Ie,2),J.emplace(ee++,de,be,xe,Ie,3)}(!su||su.length<2*q)&&(su=function(re){const fe=2*re,ge=new p.StructArrayLayout3ui6;ge.resize(fe),ge._trim();for(let de=0;de<fe;de++){const be=6*de;ge.uint16[be+0]=4*de+0,ge.uint16[be+1]=4*de+1,ge.uint16[be+2]=4*de+2,ge.uint16[be+3]=4*de+2,ge.uint16[be+4]=4*de+3,ge.uint16[be+5]=4*de+0}return ge}(q));const U=I.createIndexBuffer(su,!0),Y=I.createVertexBuffer(J,p.collisionCircleLayout.members,!0);for(const re of j){const fe={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(ie=F).getCameraToCenterDistance(re.projection),u_viewport_size:[ie.width,ie.height]};Q.draw(I,k.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,fe,d.id,Y,U,p.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,F.zoom)}var ie;Y.destroy(),U.destroy()}const au=p.create();function cs({width:g,height:c,anchor:d,textOffset:v,textScale:b},E){const{horizontalAlign:M,verticalAlign:I}=p.getAnchorAlignment(d),k=-(M-.5)*g,F=-(I-.5)*c,L=p.evaluateVariableOffset(d,v);return new p.Point((k/b+L[0])*E,(F/b+L[1])*E)}function wt(g,c,d,v,b,E,M,I,k,F,L){const j=g.text.placedSymbolArray,q=g.text.dynamicLayoutVertexArray,K=g.icon.dynamicLayoutVertexArray,Q={},J=g.getProjection(),ee=ii(I,J,E),U=E.elevation,Y=J.upVectorScale(I.canonical,E.center.lat,E.worldSize).metersToTile;q.clear();for(let ie=0;ie<j.length;ie++){const re=j.get(ie),{tileAnchorX:fe,tileAnchorY:ge,numGlyphs:de}=re,be=re.hidden||!re.crossTileID||g.allowVerticalPlacement&&!re.placedOrientation?null:v[re.crossTileID];if(be){let xe=0,Ie=0,Xe=0;if(U){const qe=U?U.getAtTileOffset(I,fe,ge):0,[_t,zt,mt]=J.upVector(I.canonical,fe,ge);xe=qe*_t*Y,Ie=qe*zt*Y,Xe=qe*mt*Y}let[Te,je,Pe,We]=ar(re.projectedAnchorX+xe,re.projectedAnchorY+Ie,re.projectedAnchorZ+Xe,d?ee:M);const Se=Fd(E.getCameraToCenterDistance(J),We);let Ne=b.evaluateSizeForFeature(g.textSizeData,F,re)*Se/p.ONE_EM;d&&(Ne*=g.tilePixelRatio/k);const Ye=cs(be,Ne);d?(({x:Te,y:je,z:Pe}=J.projectTilePoint(fe+Ye.x,ge+Ye.y,I.canonical)),[Te,je,Pe]=ar(Te+xe,je+Ie,Pe+Xe,M)):(c&&Ye._rotate(-E.angle),Te+=Ye.x,je+=Ye.y,Pe=0);const $e=g.allowVerticalPlacement&&re.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let qe=0;qe<de;qe++)p.addDynamicAttributes(q,Te,je,Pe,$e);L&&re.associatedIconIndex>=0&&(Q[re.associatedIconIndex]={x:Te,y:je,z:Pe,angle:$e})}else Tn(de,q)}if(L){K.clear();const ie=g.icon.placedSymbolArray;for(let re=0;re<ie.length;re++){const fe=ie.get(re),{numGlyphs:ge}=fe,de=Q[re];if(fe.hidden||!de)Tn(ge,K);else{const{x:be,y:xe,z:Ie,angle:Xe}=de;for(let Te=0;Te<ge;Te++)p.addDynamicAttributes(K,be,xe,Ie,Xe)}}g.icon.dynamicLayoutVertexBuffer.updateData(K)}g.text.dynamicLayoutVertexBuffer.updateData(q)}function un(g,c,d){return d.iconsInText&&c?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function bi(g,c,d,v,b,E,M,I,k,F,L,j){const q=g.context,K=q.gl,Q=g.transform,J="map"===I,ee="map"===k,U=J&&"point"!==d.layout.get("symbol-placement"),Y=J&&!ee&&!U,ie=void 0!==d.layout.get("symbol-sort-key").constantOr(1);let re=!1;const fe=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),ge=[p.mercatorXfromLng(Q.center.lng),p.mercatorYfromLat(Q.center.lat)],de=d.layout.get("text-variable-anchor"),be="globe"===Q.projection.name,xe=[],Ie=[0,-1,0];let Xe=Ie;!be&&!Q.mercatorFromTransition||J||(Xe=function(Te){const je=Te._camera.getWorldToCamera(Te.worldSize,1),Pe=p.multiply([],je,Te.globeMatrix);p.invert(Pe,Pe);const We=[0,0,0],Se=[0,1,0,0];return p.transformMat4$1(Se,Se,Pe),We[0]=Se[0],We[1]=Se[1],We[2]=Se[2],p.normalize(We,We),We}(Q));for(const Te of v){const je=c.getTile(Te),Pe=je.getBucket(d);if(!Pe||"mercator"===Pe.projection.name&&be)continue;const We=b?Pe.text:Pe.icon;if(!We||Pe.fullyClipped||!We.segments.get().length)continue;const Se=We.programConfigurations.get(d.id),Ne=b||Pe.sdfIcons,Ye=b?Pe.textSizeData:Pe.iconSizeData,$e=ee||0!==Q.pitch,qe=p.evaluateSizeForZoom(Ye,Q.zoom);let _t,zt,mt,Tt,dn=[0,0],sn=null;if(b)zt=je.glyphAtlasTexture,mt=K.LINEAR,_t=je.glyphAtlasTexture.size,Pe.iconsInText&&(dn=je.imageAtlasTexture.size,sn=je.imageAtlasTexture,Tt=$e||g.options.rotating||g.options.zooming||"composite"===Ye.kind||"camera"===Ye.kind?K.LINEAR:K.NEAREST);else{const ca=1!==d.layout.get("icon-size").constantOr(0)||Pe.iconsNeedLinear;zt=je.imageAtlasTexture,mt=Ne||g.options.rotating||g.options.zooming||ca||$e?K.LINEAR:K.NEAREST,_t=je.imageAtlasTexture.size}const vt="globe"===Pe.projection.name,Ln=vt?Xe:Ie,Jn=vt?p.globeToMercatorTransition(Q.zoom):0,Fn=ii(Te,Pe.getProjection(),Q),jn=Q.calculatePixelsToTileUnitsMatrix(je),vr=ze(Fn,je.tileID.canonical,ee,J,Q,Pe.getProjection(),jn),Si=g.terrain&&ee&&U?p.invert(p.create(),vr):au,To=Oi(Fn,je.tileID.canonical,ee,J,Q,Pe.getProjection(),jn),hs=de&&Pe.hasTextData(),Qn="none"!==d.layout.get("icon-text-fit")&&hs&&Pe.hasIconData();if(U){const ca=Q.elevation,ds=ca?ca.getAtTileOffsetFunc(Te,Q.center.lat,Q.worldSize,Pe.getProjection()):null,ua=ea(Fn,je.tileID.canonical,ee,J,Q,Pe.getProjection(),jn);zd(Pe,Fn,g,b,ua,To,ee,F,ds,Te)}const Gn=U||b&&de||Qn,bn=g.translatePosMatrix(Fn,je,E,M),wi=Gn?au:vr,ur=g.translatePosMatrix(To,je,E,M,!0),ci=Pe.getProjection().createInversionMatrix(Q,Te.canonical),Xr=[];g.terrainRenderModeElevated()&&ee&&Xr.push("PITCH_WITH_MAP_TERRAIN"),vt&&Xr.push("PROJECTION_GLOBE_VIEW"),Gn&&Xr.push("PROJECTED_POS_ON_VIEWPORT");const mu=Ne&&0!==d.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let kl;kl=Ne?Pe.iconsInText?mr(Ye.kind,qe,Y,ee,g,bn,wi,ur,_t,dn,Te,Jn,ge,ci,Ln,Pe.getProjection()):An(Ye.kind,qe,Y,ee,g,bn,wi,ur,b,_t,!0,Te,Jn,ge,ci,Ln,Pe.getProjection()):Ir(Ye.kind,qe,Y,ee,g,bn,wi,ur,b,_t,Te,Jn,ge,ci,Ln,Pe.getProjection());const po={program:g.useProgram(un(Ne,b,Pe),Se,Xr),buffers:We,uniformValues:kl,atlasTexture:zt,atlasTextureIcon:sn,atlasInterpolation:mt,atlasInterpolationIcon:Tt,isSDF:Ne,hasHalo:mu,tile:je,labelPlaneMatrixInv:Si};if(ie&&Pe.canOverlap){re=!0;const ca=We.segments.get();for(const ds of ca)xe.push({segments:new p.SegmentVector([ds]),sortKey:ds.sortKey,state:po})}else xe.push({segments:We.segments,sortKey:0,state:po})}re&&xe.sort((Te,je)=>Te.sortKey-je.sortKey);for(const Te of xe){const je=Te.state;if(g.terrain&&g.terrain.setupElevationDraw(je.tile,je.program,{useDepthForOcclusion:!be,labelPlaneMatrixInv:je.labelPlaneMatrixInv}),q.activeTexture.set(K.TEXTURE0),je.atlasTexture.bind(je.atlasInterpolation,K.CLAMP_TO_EDGE),je.atlasTextureIcon&&(q.activeTexture.set(K.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),je.isSDF){const Pe=je.uniformValues;je.hasHalo&&(Pe.u_is_halo=1,Wr(je.buffers,Te.segments,d,g,je.program,fe,L,j,Pe)),Pe.u_is_halo=0}Wr(je.buffers,Te.segments,d,g,je.program,fe,L,j,je.uniformValues)}}function Wr(g,c,d,v,b,E,M,I,k){const F=v.context,L=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer];b.draw(F,F.gl.TRIANGLES,E,M,I,p.CullFaceMode.disabled,k,d.id,g.layoutVertexBuffer,g.indexBuffer,c,d.paint,v.transform.zoom,g.programConfigurations.get(d.id),L)}function Fa(g,c,d,v,b,E,M){const I=g.context.gl,k=d.paint.get("fill-pattern"),F=k&&k.constantOr(1);let L,j,q,K,Q;M?(j=F&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=I.LINES):(j=F?"fillPattern":"fill",L=I.TRIANGLES);for(const J of v){const ee=c.getTile(J);if(F&&!ee.patternsLoaded())continue;const U=ee.getBucket(d);if(!U)continue;g.prepareDrawTile();const Y=U.programConfigurations.get(d.id),ie=g.useProgram(j,Y);F&&(g.context.activeTexture.set(I.TEXTURE0),ee.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Y.updatePaintBuffers());const re=k.constantOr(null);if(re&&ee.imageAtlas){const ge=ee.imageAtlas.patternPositions[re.toString()];ge&&Y.setConstantPatternPositions(ge)}const fe=g.translatePosMatrix(J.projMatrix,ee,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(M){K=U.indexBuffer2,Q=U.segments2;const ge=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];q="fillOutlinePattern"===j&&F?Vn(fe,g,ee,ge):oa(fe,ge)}else K=U.indexBuffer,Q=U.segments,q=F?jo(fe,g,ee):Mr(fe);g.prepareDrawProgram(g.context,ie,J.toUnwrapped()),ie.draw(g.context,L,b,g.stencilModeForClipping(J),E,p.CullFaceMode.disabled,q,d.id,U.layoutVertexBuffer,K,Q,d.paint,g.transform.zoom,Y)}}function Ki(g,c,d,v,b,E,M){const I=g.context,k=I.gl,F=g.transform,L=d.paint.get("fill-extrusion-pattern"),j=L.constantOr(1),q=d.paint.get("fill-extrusion-opacity"),K=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),d.paint.get("fill-extrusion-ambient-occlusion-radius")],Q=d.layout.get("fill-extrusion-edge-radius"),J=Q>0&&!d.paint.get("fill-extrusion-rounded-roof"),ee=J?0:Q,U="globe"===F.projection.name?p.fillExtrusionHeightLift():0,Y="globe"===F.projection.name,ie=Y?p.globeToMercatorTransition(F.zoom):0,re=[p.mercatorXfromLng(F.center.lng),p.mercatorYfromLat(F.center.lat)],fe=[];Y&&fe.push("PROJECTION_GLOBE_VIEW"),K[0]>0&&fe.push("FAUX_AO"),J&&fe.push("ZERO_ROOF_RADIUS");for(const ge of v){const de=c.getTile(ge),be=de.getBucket(d);if(!be||be.projection.name!==F.projection.name)continue;const xe=be.programConfigurations.get(d.id),Ie=g.useProgram(j?"fillExtrusionPattern":"fillExtrusion",xe,fe);if(g.terrain){const Ne=g.terrain;if(g.style.terrainSetForDrapingOnly())Ne.setupElevationDraw(de,Ie,{useMeterToDem:!0});else{if(!be.enableTerrain)continue;if(Ne.setupElevationDraw(de,Ie,{useMeterToDem:!0}),wl(I,c,ge,be,d,Ne),!be.centroidVertexBuffer){const Ye=Ie.attributes.a_centroid_pos;void 0!==Ye&&k.vertexAttrib2f(Ye,0,0)}}}j&&(g.context.activeTexture.set(k.TEXTURE0),de.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),xe.updatePaintBuffers());const Xe=L.constantOr(null);if(Xe&&de.imageAtlas){const Ne=de.imageAtlas.patternPositions[Xe.toString()];Ne&&xe.setConstantPatternPositions(Ne)}const Te=g.translatePosMatrix(ge.projMatrix,de,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),je=F.projection.createInversionMatrix(F,ge.canonical),Pe=d.paint.get("fill-extrusion-vertical-gradient"),We=j?Ps(Te,g,Pe,q,K,ee,ge,de,U,ie,re,je):Ud(Te,g,Pe,q,K,ee,ge,U,ie,re,je);g.prepareDrawProgram(I,Ie,ge.toUnwrapped());const Se=[];g.terrain&&Se.push(be.centroidVertexBuffer),Y&&Se.push(be.layoutVertexExtBuffer),Ie.draw(I,I.gl.TRIANGLES,b,E,M,p.CullFaceMode.backCCW,We,d.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,d.paint,g.transform.zoom,xe,Se)}}function wl(g,c,d,v,b,E){const M=[U=>{let Y=U.canonical.x-1,ie=U.wrap;return Y<0&&(Y=(1<<U.canonical.z)-1,ie--),new p.OverscaledTileID(U.overscaledZ,ie,U.canonical.z,Y,U.canonical.y)},U=>{let Y=U.canonical.x+1,ie=U.wrap;return Y===1<<U.canonical.z&&(Y=0,ie++),new p.OverscaledTileID(U.overscaledZ,ie,U.canonical.z,Y,U.canonical.y)},U=>new p.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,(0===U.canonical.y?1<<U.canonical.z:U.canonical.y)-1),U=>new p.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y===(1<<U.canonical.z)-1?0:U.canonical.y+1)],I=U=>{const Y=c.getSource().minzoom,ie=fe=>{const ge=c.getTileByID(fe);if(ge&&ge.hasData())return ge.getBucket(b)},re=[0,-1,1];for(const fe of re){if(U.overscaledZ+fe<Y)continue;const ge=ie(U.calculateScaledKey(U.overscaledZ+fe));if(ge)return ge}},k=[0,0,0],F=(U,Y)=>(k[0]=Math.min(U.min.y,Y.min.y),k[1]=Math.max(U.max.y,Y.max.y),k[2]=p.EXTENT-Y.min.x>U.max.x?Y.min.x-p.EXTENT:U.max.x,k),L=(U,Y)=>(k[0]=Math.min(U.min.x,Y.min.x),k[1]=Math.max(U.max.x,Y.max.x),k[2]=p.EXTENT-Y.min.y>U.max.y?Y.min.y-p.EXTENT:U.max.y,k),j=[(U,Y)=>F(U,Y),(U,Y)=>F(Y,U),(U,Y)=>L(U,Y),(U,Y)=>L(Y,U)],q=new p.Point(0,0);let K,Q,J;const ee=(U,Y,ie,re,fe)=>{const ge=[[re?ie:U,re?U:ie,0],[re?ie:Y,re?Y:ie,0]],de=fe<0?p.EXTENT+fe:fe,be=[re?de:(U+Y)/2,re?(U+Y)/2:de,0];return 0===ie&&fe<0||0!==ie&&fe>0?E.getForTilePoints(J,[be],!0,Q):ge.push(be),E.getForTilePoints(d,ge,!0,K),Math.max(ge[0][2],ge[1][2],be[2])/E.exaggeration()};for(let U=0;U<4;U++){const Y=(U<2?1:5)-U,ie=v.borders[U];if(0===ie.length)continue;const re=J=M[U](d),fe=I(re);if(!(fe&&fe instanceof p.FillExtrusionBucket&&fe.enableTerrain)||v.borderDoneWithNeighborZ[U]===fe.canonical.z&&fe.borderDoneWithNeighborZ[Y]===v.canonical.z||(Q=E.findDEMTileFor(re),!Q||!Q.dem))continue;if(!K){const xe=E.findDEMTileFor(d);if(!xe||!xe.dem)return;K=xe}const ge=fe.borders[Y];let de=0;const be=fe.borderDoneWithNeighborZ[Y]!==v.canonical.z;if(v.canonical.z===fe.canonical.z){for(let xe=0;xe<ie.length;xe++){const Ie=v.featuresOnBorder[ie[xe]],Xe=Ie.borders[U];let Te;for(;de<ge.length&&(Te=fe.featuresOnBorder[ge[de]],!(Te.borders[Y][1]>Xe[0]+3));)be&&fe.encodeCentroid(void 0,Te,!1),de++;if(Te&&de<ge.length){const je=de;let Pe=0;for(;!(Te.borders[Y][0]>Xe[1]-3)&&(Pe++,++de!==ge.length);)Te=fe.featuresOnBorder[ge[de]];if(Te=fe.featuresOnBorder[ge[je]],Ie.intersectsCount()>1||Te.intersectsCount()>1||1!==Pe){1!==Pe&&(de=je),v.encodeCentroid(void 0,Ie,!1),be&&fe.encodeCentroid(void 0,Te,!1);continue}const We=j[U](Ie,Te),Se=U%2?p.EXTENT-1:0;q.x=ee(We[0],Math.min(p.EXTENT-1,We[1]),Se,U<2,We[2]),q.y=0,v.encodeCentroid(q,Ie,!1),be&&fe.encodeCentroid(q,Te,!1)}else v.encodeCentroid(void 0,Ie,!1)}v.borderDoneWithNeighborZ[U]=fe.canonical.z,v.needsCentroidUpdate=!0,be&&(fe.borderDoneWithNeighborZ[Y]=v.canonical.z,fe.needsCentroidUpdate=!0)}else{for(const xe of ie)v.encodeCentroid(void 0,v.featuresOnBorder[xe],!1);if(be){for(const xe of ge)fe.encodeCentroid(void 0,fe.featuresOnBorder[xe],!1);fe.borderDoneWithNeighborZ[Y]=v.canonical.z,fe.needsCentroidUpdate=!0}v.borderDoneWithNeighborZ[U]=fe.canonical.z,v.needsCentroidUpdate=!0}}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&0!==v.centroidVertexArray.length)&&v.uploadCentroid(g)}const li=new p.Color(1,0,0,1),dh=new p.Color(0,1,0,1),fh=new p.Color(0,0,1,1),_n=new p.Color(1,0,1,1),Gd=new p.Color(0,1,1,1);function lu(g,c,d){const v=g.context,b=g.transform,E=v.gl,M="globe"===b.projection.name,I=M?["PROJECTION_GLOBE_VIEW"]:null;let k=d.projMatrix;if(M&&p.globeToMercatorTransition(b.zoom)>0){const Ie=p.transitionTileAABBinECEF(d.canonical,b),Xe=p.globeDenormalizeECEF(Ie);k=p.multiply(new Float32Array(16),b.globeMatrix,Xe),p.multiply(k,b.projMatrix,k)}const F=g.useProgram("debug",null,I),L=c.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(L,F);const j=p.DepthMode.disabled,q=p.StencilMode.disabled,K=g.colorModeForRenderPass(),Q="$debug";v.activeTexture.set(E.TEXTURE0),g.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),M?L._makeGlobeTileDebugBuffers(g.context,b):L._makeDebugTileBoundsBuffers(g.context,b.projection);const J=L._tileDebugBuffer||g.debugBuffer,ee=L._tileDebugIndexBuffer||g.debugIndexBuffer,U=L._tileDebugSegments||g.debugSegments;F.draw(v,E.LINE_STRIP,j,q,K,p.CullFaceMode.disabled,Uo(k,p.Color.red),Q,J,ee,U,null,null,null,[L._globeTileDebugBorderBuffer]);const Y=L.latestRawTileData,ie=Math.floor((Y&&Y.byteLength||0)/1024),re=c.getTile(d).tileSize,fe=512/Math.min(re,512)*(d.overscaledZ/b.zoom)*.5;let ge=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ge+=` => ${d.overscaledZ}`),ge+=` ${ie}kb`,function(Ie,Xe){Ie.initDebugOverlayCanvas();const Te=Ie.debugOverlayCanvas,je=Ie.context.gl,Pe=Ie.debugOverlayCanvas.getContext("2d");Pe.clearRect(0,0,Te.width,Te.height),Pe.shadowColor="white",Pe.shadowBlur=2,Pe.lineWidth=1.5,Pe.strokeStyle="white",Pe.textBaseline="top",Pe.font="bold 36px Open Sans, sans-serif",Pe.fillText(Xe,5,5),Pe.strokeText(Xe,5,5),Ie.debugOverlayTexture.update(Te),Ie.debugOverlayTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE)}(g,ge);const de=L._tileDebugTextBuffer||g.debugBuffer,be=L._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,xe=L._tileDebugTextSegments||g.debugSegments;F.draw(v,E.TRIANGLES,j,q,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,Uo(k,p.Color.transparent,fe),Q,de,be,xe,null,null,null,[L._globeTileDebugTextBuffer])}function Wd(g,c,d,v){Ni(g,0,c+d/2,g.transform.width,d,v)}function sa(g,c,d,v){Ni(g,c-d/2,0,d,g.transform.height,v)}function Ni(g,c,d,v,b,E){const M=g.context,I=M.gl;I.enable(I.SCISSOR_TEST),I.scissor(c*p.exported.devicePixelRatio,d*p.exported.devicePixelRatio,v*p.exported.devicePixelRatio,b*p.exported.devicePixelRatio),M.clear({color:E}),I.disable(I.SCISSOR_TEST)}const gc=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Cl}=gc;function cr(g,c,d,v){g.emplaceBack(c,d,v)}class za{constructor(c){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,cr(this.vertexArray,-1,-1,1),cr(this.vertexArray,1,-1,1),cr(this.vertexArray,-1,1,1),cr(this.vertexArray,1,1,1),cr(this.vertexArray,-1,-1,-1),cr(this.vertexArray,1,-1,-1),cr(this.vertexArray,-1,1,-1),cr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Cl),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function Co(g,c,d,v,b,E){const M=g.gl,I=c.paint.get("sky-atmosphere-color"),k=c.paint.get("sky-atmosphere-halo-color"),F=c.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:p.fromMat4(p.create$1(),v),u_sun_direction:b,u_sun_intensity:F,u_color_tint_r:[(Q=I).r,Q.g,Q.b,Q.a],u_color_tint_m:[(J=k).r,J.g,J.b,J.a],u_luminance:5e-5};var Q,J;M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+E,c.skyboxTexture,0),d.draw(g,M.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,L,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Kn=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class bg{constructor(c){const d=new p.StructArrayLayout5f20;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const v=new p.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(d,Kn.members),this.indexBuffer=c.createIndexBuffer(v),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const aa={symbol:function(g,c,d,v,b){if("translucent"!==g.renderPass)return;const E=p.StencilMode.disabled,M=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(I,k,F,L,j,q,K){const Q=k.transform,J="map"===j,ee="map"===q;for(const U of I){const Y=L.getTile(U),ie=Y.getBucket(F);if(!ie||!ie.text||!ie.text.segments.get().length)continue;const re=p.evaluateSizeForZoom(ie.textSizeData,Q.zoom),fe=ii(U,ie.getProjection(),Q),ge=Q.calculatePixelsToTileUnitsMatrix(Y),de=ze(fe,Y.tileID.canonical,ee,J,Q,ie.getProjection(),ge),be="none"!==F.layout.get("icon-text-fit")&&ie.hasIconData();if(re){const xe=Math.pow(2,Q.zoom-Y.tileID.overscaledZ);wt(ie,J,ee,K,p.symbolSize,Q,de,U,xe,re,be)}}}(v,g,d,c,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b),0!==d.paint.get("icon-opacity").constantOr(1)&&bi(g,c,d,v,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),E,M),0!==d.paint.get("text-opacity").constantOr(1)&&bi(g,c,d,v,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),E,M),c.map.showCollisionBoxes&&(mc(g,c,d,v,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),mc(g,c,d,v,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,c,d,v){if("translucent"!==g.renderPass)return;const b=d.paint.get("circle-opacity"),E=d.paint.get("circle-stroke-width"),M=d.paint.get("circle-stroke-opacity"),I=void 0!==d.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===E.constantOr(1)||0===M.constantOr(1)))return;const k=g.context,F=k.gl,L=g.transform,j=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),q=p.StencilMode.disabled,K=g.colorModeForRenderPass(),Q="globe"===L.projection.name,J=[p.mercatorXfromLng(L.center.lng),p.mercatorYfromLat(L.center.lat)],ee=[];for(let Y=0;Y<v.length;Y++){const ie=v[Y],re=c.getTile(ie),fe=re.getBucket(d);if(!fe||fe.projection.name!==L.projection.name)continue;const ge=fe.programConfigurations.get(d.id),de=ru(d);Q&&de.push("PROJECTION_GLOBE_VIEW");const be=g.useProgram("circle",ge,de),xe=fe.layoutVertexBuffer,Ie=fe.globeExtVertexBuffer,Xe=fe.indexBuffer,Te=L.projection.createInversionMatrix(L,ie.canonical),je={programConfiguration:ge,program:be,layoutVertexBuffer:xe,globeExtVertexBuffer:Ie,indexBuffer:Xe,uniformValues:iu(g,ie,re,Te,J,d),tile:re};if(I){const Pe=fe.segments.get();for(const We of Pe)ee.push({segments:new p.SegmentVector([We]),sortKey:We.sortKey,state:je})}else ee.push({segments:fe.segments,sortKey:0,state:je})}I&&ee.sort((Y,ie)=>Y.sortKey-ie.sortKey);const U={useDepthForOcclusion:!Q};for(const Y of ee){const{programConfiguration:ie,program:re,layoutVertexBuffer:fe,globeExtVertexBuffer:ge,indexBuffer:de,uniformValues:be,tile:xe}=Y.state,Ie=Y.segments;g.terrain&&g.terrain.setupElevationDraw(xe,re,U),g.prepareDrawProgram(k,re,xe.tileID.toUnwrapped()),re.draw(k,F.TRIANGLES,j,q,K,p.CullFaceMode.disabled,be,d.id,fe,de,Ie,d.paint,L.zoom,ie,[ge])}},heatmap:function(g,c,d,v){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const b=g.context,E=b.gl,M=p.StencilMode.disabled,I=new p.ColorMode([E.ONE,E.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(K,Q,J,ee){const U=K.gl,Y=Q.width*ee,ie=Q.height*ee;K.activeTexture.set(U.TEXTURE1),K.viewport.set([0,0,Y,ie]);let re=J.heatmapFbo;if(!re||re&&(re.width!==Y||re.height!==ie)){re&&re.destroy();const fe=U.createTexture();U.bindTexture(U.TEXTURE_2D,fe),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),re=J.heatmapFbo=K.createFramebuffer(Y,ie,!1),function(ge,de,be,xe,Ie,Xe){const Te=ge.gl;Te.texImage2D(Te.TEXTURE_2D,0,ge.isWebGL2&&ge.extRenderToTextureHalfFloat?Te.RGBA16F:Te.RGBA,Ie,Xe,0,Te.RGBA,ge.extRenderToTextureHalfFloat?ge.isWebGL2?Te.HALF_FLOAT:ge.extTextureHalfFloat.HALF_FLOAT_OES:Te.UNSIGNED_BYTE,null),xe.colorAttachment.set(be)}(K,0,fe,re,Y,ie)}else U.bindTexture(U.TEXTURE_2D,re.colorAttachment.get()),K.bindFramebuffer.set(re.framebuffer)})(b,g,d,"globe"===g.transform.projection.name?.5:.25),b.clear({color:p.Color.transparent});const k=g.transform,F="globe"===k.projection.name,L=F?["PROJECTION_GLOBE_VIEW"]:null,j=F?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,q=[p.mercatorXfromLng(k.center.lng),p.mercatorYfromLat(k.center.lat)];for(let K=0;K<v.length;K++){const Q=v[K];if(c.hasRenderableParent(Q))continue;const J=c.getTile(Q),ee=J.getBucket(d);if(!ee||ee.projection.name!==k.projection.name)continue;const U=ee.programConfigurations.get(d.id),Y=g.useProgram("heatmap",U,L),{zoom:ie}=g.transform;g.terrain&&g.terrain.setupElevationDraw(J,Y),g.prepareDrawProgram(b,Y,Q.toUnwrapped());const re=k.projection.createInversionMatrix(k,Q.canonical);Y.draw(b,E.TRIANGLES,p.DepthMode.disabled,M,I,j,Ap(g,Q,J,re,q,ie,d.paint.get("heatmap-intensity")),d.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,d.paint,g.transform.zoom,U,F?[ee.globeExtVertexBuffer]:null)}b.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(b,E){const M=b.context,I=M.gl,k=E.heatmapFbo;if(!k)return;M.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,k.colorAttachment.get()),M.activeTexture.set(I.TEXTURE1);let F=E.colorRampTexture;F||(F=E.colorRampTexture=new p.Texture(M,E.colorRamp,I.RGBA)),F.bind(I.LINEAR,I.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(M,I.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,b.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:E.paint.get("heatmap-opacity")},E.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,E.paint,b.transform.zoom)}(g,d))},line:function(g,c,d,v){if("translucent"!==g.renderPass)return;const b=d.paint.get("line-opacity"),E=d.paint.get("line-width");if(0===b.constantOr(1)||0===E.constantOr(1))return;const M=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),I=g.colorModeForRenderPass(),k=g.terrain&&g.terrain.renderingToTexture?1:p.exported.devicePixelRatio,F=d.paint.get("line-dasharray"),L=F.constantOr(1),j=d.layout.get("line-cap"),q=d.paint.get("line-pattern"),K=q.constantOr(1),Q=d.paint.get("line-gradient"),J=K?"linePattern":"line",ee=g.context,U=ee.gl,Y=(re=>{const fe=[];lr(re)&&fe.push("RENDER_LINE_DASH"),re.paint.get("line-gradient")&&fe.push("RENDER_LINE_GRADIENT");const ge=re.paint.get("line-trim-offset");0===ge[0]&&0===ge[1]||fe.push("RENDER_LINE_TRIM_OFFSET");const de=re.paint.get("line-pattern").constantOr(1),be=1!==re.paint.get("line-opacity").constantOr(1);return!de&&be&&fe.push("RENDER_LINE_ALPHA_DISCARD"),fe})(d);let ie=Y.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(ie=!1);for(const re of v){const fe=c.getTile(re);if(K&&!fe.patternsLoaded())continue;const ge=fe.getBucket(d);if(!ge)continue;g.prepareDrawTile();const de=ge.programConfigurations.get(d.id),be=g.useProgram(J,de,Y),xe=q.constantOr(null);if(xe&&fe.imageAtlas){const Ne=fe.imageAtlas.patternPositions[xe.toString()];Ne&&de.setConstantPatternPositions(Ne)}const Ie=F.constantOr(null),Xe=j.constantOr(null);if(!K&&Ie&&Xe&&fe.lineAtlas){const Ne=fe.lineAtlas.getDash(Ie,Xe);Ne&&de.setConstantPatternPositions(Ne)}let[Te,je]=d.paint.get("line-trim-offset");("round"===Xe||"square"===Xe)&&Te!==je&&(0===Te&&(Te-=1),1===je&&(je+=1));const Pe=g.terrain?re.projMatrix:null,We=K?ou(g,fe,d,Pe,k):ks(g,fe,d,Pe,ge.lineClipsArray.length,k,[Te,je]);if(Q){const Ne=ge.gradients[d.id];let Ye=Ne.texture;if(d.gradientVersion!==Ne.version){let $e=256;if(d.stepInterpolant){const qe=c.getSource().maxzoom,_t=re.canonical.z===qe?Math.ceil(1<<g.transform.maxZoom-re.canonical.z):1;$e=p.clamp(p.nextPowerOfTwo(ge.maxLineLength/p.EXTENT*1024*_t),256,ee.maxTextureSize)}Ne.gradient=p.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:$e,image:Ne.gradient||void 0,clips:ge.lineClipsArray}),Ne.texture?Ne.texture.update(Ne.gradient):Ne.texture=new p.Texture(ee,Ne.gradient,U.RGBA),Ne.version=d.gradientVersion,Ye=Ne.texture}ee.activeTexture.set(U.TEXTURE1),Ye.bind(d.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}L&&(ee.activeTexture.set(U.TEXTURE0),fe.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),de.updatePaintBuffers()),K&&(ee.activeTexture.set(U.TEXTURE0),fe.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),de.updatePaintBuffers()),g.prepareDrawProgram(ee,be,re.toUnwrapped());const Se=Ne=>{be.draw(ee,U.TRIANGLES,M,Ne,I,p.CullFaceMode.disabled,We,d.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,d.paint,g.transform.zoom,de,[ge.layoutVertexBuffer2])};if(ie){const Ne=g.stencilModeForClipping(re).ref;0===Ne&&g.terrain&&ee.clear({stencil:0});const Ye={func:U.EQUAL,mask:255};We.u_alpha_discard_threshold=.8,Se(new p.StencilMode(Ye,Ne,255,U.KEEP,U.KEEP,U.INVERT)),We.u_alpha_discard_threshold=0,Se(new p.StencilMode(Ye,Ne,255,U.KEEP,U.KEEP,U.KEEP))}else Se(g.stencilModeForClipping(re))}ie&&(g.resetStencilClippingMasks(),g.terrain&&ee.clear({stencil:0}))},fill:function(g,c,d,v){const b=d.paint.get("fill-color"),E=d.paint.get("fill-opacity");if(0===E.constantOr(1))return;const M=g.colorModeForRenderPass(),I=d.paint.get("fill-pattern"),k=g.opaquePassEnabledForLayer()&&!I.constantOr(1)&&1===b.constantOr(p.Color.transparent).a&&1===E.constantOr(0)?"opaque":"translucent";if(g.renderPass===k){const F=g.depthModeForSublayer(1,"opaque"===g.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Fa(g,c,d,v,F,M,!1)}if("translucent"===g.renderPass&&d.paint.get("fill-antialias")){const F=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Fa(g,c,d,v,F,M,!0)}},"fill-extrusion":function(g,c,d,v){const b=d.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===g.renderPass){const E=new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==b||d.paint.get("fill-extrusion-pattern").constantOr(1))Ki(g,c,d,v,E,p.StencilMode.disabled,p.ColorMode.disabled),Ki(g,c,d,v,E,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const M=g.colorModeForRenderPass();Ki(g,c,d,v,E,p.StencilMode.disabled,M)}}},hillshade:function(g,c,d,v){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const b=g.context,E=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),M=g.colorModeForRenderPass(),I=g.terrain&&g.terrain.renderingToTexture,[k,F]="translucent"!==g.renderPass||I?[{},v]:g.stencilConfigForOverlap(v);for(const L of F){const j=c.getTile(L);if(j.needsHillshadePrepare&&"offscreen"===g.renderPass)uc(g,j,d,E,p.StencilMode.disabled,M);else if("translucent"===g.renderPass){const q=I&&g.terrain?g.terrain.stencilModeForRTTOverlap(L):k[L.overscaledZ];xg(g,L,j,d,E,q,M)}}b.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,c,d,v,b,E){if("translucent"!==g.renderPass||0===d.paint.get("raster-opacity")||!v.length)return;const M=g.context,I=M.gl,k=c.getSource(),F=g.useProgram("raster"),L=g.colorModeForRenderPass(),j=g.terrain&&g.terrain.renderingToTexture,[q,K]=k instanceof en||j?[{},v]:g.stencilConfigForOverlap(v),Q=K[K.length-1].overscaledZ,J=!g.options.moving;for(const ee of K){const U=j?p.DepthMode.disabled:g.depthModeForSublayer(ee.overscaledZ-Q,1===d.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,I.LESS),Y=ee.toUnwrapped(),ie=c.getTile(ee);if(j&&(!ie||!ie.hasData()))continue;const re=j?ee.projMatrix:g.transform.calculateProjMatrix(Y,J),fe=g.terrain&&j?g.terrain.stencilModeForRTTOverlap(ee):q[ee.overscaledZ],ge=E?0:d.paint.get("raster-fade-duration");ie.registerFadeDuration(ge);const de=c.findLoadedParent(ee,0),be=Dt(ie,de,c,g.transform,ge);let xe,Ie;g.terrain&&g.terrain.prepareDrawTile();const Xe="nearest"===d.paint.get("raster-resampling")?I.NEAREST:I.LINEAR;M.activeTexture.set(I.TEXTURE0),ie.texture.bind(Xe,I.CLAMP_TO_EDGE),M.activeTexture.set(I.TEXTURE1),de?(de.texture.bind(Xe,I.CLAMP_TO_EDGE),xe=Math.pow(2,de.tileID.overscaledZ-ie.tileID.overscaledZ),Ie=[ie.tileID.canonical.x*xe%1,ie.tileID.canonical.y*xe%1]):ie.texture.bind(Xe,I.CLAMP_TO_EDGE),ie.texture.useMipmap&&M.extTextureFilterAnisotropic&&g.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const Te=Hd(re,Ie||[0,0],xe||1,be,d,k instanceof en?k.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(M,F,Y),k instanceof en)k.boundsBuffer&&k.boundsSegments&&F.draw(M,I.TRIANGLES,U,p.StencilMode.disabled,L,p.CullFaceMode.disabled,Te,d.id,k.boundsBuffer,g.quadTriangleIndexBuffer,k.boundsSegments);else{const{tileBoundsBuffer:je,tileBoundsIndexBuffer:Pe,tileBoundsSegments:We}=g.getTileBoundsBuffers(ie);F.draw(M,I.TRIANGLES,U,fe,L,p.CullFaceMode.disabled,Te,d.id,je,Pe,We)}}g.resetStencilClippingMasks()},background:function(g,c,d,v){const b=d.paint.get("background-color"),E=d.paint.get("background-opacity");if(0===E)return;const M=g.context,I=M.gl,k=g.transform,F=k.tileSize,L=d.paint.get("background-pattern");if(g.isPatternMissing(L))return;const j=!L&&1===b.a&&1===E&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==j)return;const q=p.StencilMode.disabled,K=g.depthModeForSublayer(0,"opaque"===j?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),Q=g.colorModeForRenderPass(),J=g.useProgram(L?"backgroundPattern":"background");let ee,U=v;U||(ee=g.getBackgroundTiles(),U=Object.values(ee).map(Y=>Y.tileID)),L&&(M.activeTexture.set(I.TEXTURE0),g.imageManager.bind(g.context));for(const Y of U){const ie=Y.toUnwrapped(),re=v?Y.projMatrix:g.transform.calculateProjMatrix(ie);g.prepareDrawTile();const fe=c?c.getTile(Y):ee?ee[Y.key]:new p.Tile(Y,F,k.zoom,g),ge=L?pc(re,E,g,L,{tileID:Y,tileSize:F}):Ar(re,E,b);g.prepareDrawProgram(M,J,ie);const{tileBoundsBuffer:de,tileBoundsIndexBuffer:be,tileBoundsSegments:xe}=g.getTileBoundsBuffers(fe);J.draw(M,I.TRIANGLES,K,q,Q,p.CullFaceMode.disabled,ge,d.id,de,be,xe)}},sky:function(g,c,d){const v=g.transform,b="mercator"===v.projection.name||"globe"===v.projection.name?1:p.smoothstep(7,8,v.zoom),E=d.paint.get("sky-opacity")*b;if(0===E)return;const M=g.context,I=d.paint.get("sky-type"),k=new p.DepthMode(M.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),F=g.frameCounter/1e3%1;"atmosphere"===I?"offscreen"===g.renderPass?d.needsSkyboxCapture(g)&&(function(L,j,q,K){const Q=L.context,J=Q.gl;let ee=j.skyboxFbo;if(!ee){ee=j.skyboxFbo=Q.createFramebuffer(32,32,!1),j.skyboxGeometry=new za(Q),j.skyboxTexture=Q.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,j.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let re=0;re<6;++re)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(ee.framebuffer),Q.viewport.set([0,0,32,32]);const U=j.getCenter(L,!0),Y=L.useProgram("skyboxCapture"),ie=new Float64Array(16);p.identity(ie),p.rotateY(ie,ie,.5*-Math.PI),Co(Q,j,Y,ie,U,0),p.identity(ie),p.rotateY(ie,ie,.5*Math.PI),Co(Q,j,Y,ie,U,1),p.identity(ie),p.rotateX(ie,ie,.5*-Math.PI),Co(Q,j,Y,ie,U,2),p.identity(ie),p.rotateX(ie,ie,.5*Math.PI),Co(Q,j,Y,ie,U,3),p.identity(ie),Co(Q,j,Y,ie,U,4),p.identity(ie),p.rotateY(ie,ie,Math.PI),Co(Q,j,Y,ie,U,5),Q.viewport.set([0,0,L.width,L.height])}(g,d),d.markSkyboxValid(g)):"sky"===g.renderPass&&function(L,j,q,K,Q){const J=L.context,ee=J.gl,U=L.transform,Y=L.useProgram("skybox");J.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_CUBE_MAP,j.skyboxTexture);const ie={u_matrix:U.skyboxMatrix,u_sun_direction:j.getCenter(L,!1),u_cubemap:0,u_opacity:K,u_temporal_offset:Q};L.prepareDrawProgram(J,Y),Y.draw(J,ee.TRIANGLES,q,p.StencilMode.disabled,L.colorModeForRenderPass(),p.CullFaceMode.backCW,ie,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(g,d,k,E,F):"gradient"===I&&"sky"===g.renderPass&&function(L,j,q,K,Q){const J=L.context,ee=J.gl,U=L.transform,Y=L.useProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new za(J)),J.activeTexture.set(ee.TEXTURE0);let ie=j.colorRampTexture;ie||(ie=j.colorRampTexture=new p.Texture(J,j.colorRamp,ee.RGBA)),ie.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const re=(fe=U.skyboxMatrix,ge=j.getCenter(L,!1),de=j.paint.get("sky-gradient-radius"),be=K,xe=Q,{u_matrix:fe,u_color_ramp:0,u_center_direction:ge,u_radius:p.degToRad(de),u_opacity:be,u_temporal_offset:xe});var fe,ge,de,be,xe;L.prepareDrawProgram(J,Y),Y.draw(J,ee.TRIANGLES,q,p.StencilMode.disabled,L.colorModeForRenderPass(),p.CullFaceMode.backCW,re,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(g,d,k,E,F)},debug:function(g,c,d){for(let v=0;v<d.length;v++)lu(g,c,d[v])},custom:function(g,c,d,v){const b=g.context,E=d.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||"offscreen"===g.renderPass)&&d.isLayerDraped()){if("offscreen"===g.renderPass){const M=E.prerender;if(M){if(g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),"globe"===g.transform.projection.name){const I=g.transform.pointMerc;M.call(E,b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[I.x,I.y],g.transform.pixelsPerMeterRatio)}else M.call(E,b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState()}}else if("translucent"===g.renderPass){if(g.terrain&&g.terrain.renderingToTexture){const I=E.renderToTile;if(I){const k=v[0].canonical,F=new p.MercatorCoordinate(k.x+v[0].wrap*(1<<k.z),k.y,k.z);b.setDepthMode(p.DepthMode.disabled),b.setStencilMode(p.StencilMode.disabled),b.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),I.call(E,b.gl,F),b.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),b.setStencilMode(p.StencilMode.disabled);const M="3d"===E.renderingMode?new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(b.setDepthMode(M),"globe"===g.transform.projection.name){const I=g.transform.pointMerc;E.render(b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[I.x,I.y],g.transform.pixelsPerMeterRatio)}else E.render(b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState(),b.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class El{constructor(c,d,v=!1){this.context=new tt(c,v),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,d){const v=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new tu(this,c));const b=this._terrain;this.transform.elevation=v?b:null,b.update(c,this.transform,d)}_updateFog(c){const d=c.fog;if(!d||"globe"===this.transform.projection.name||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,b]=d.getFovAdjustedRange(this.transform._fov);if(v>b)return void(this.transform.fogCullDistSq=null);const E=v+.78*(b-v);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,d){if(this.width=c*p.exported.devicePixelRatio,this.height=d*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const c=this.context,d=new p.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(p.EXTENT,0),d.emplaceBack(0,p.EXTENT),d.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(d,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const v=new p.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(p.EXTENT,0),v.emplaceBack(0,p.EXTENT),v.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=c.createVertexBuffer(v,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const b=new p.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(b,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const E=new p.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(p.EXTENT,0,p.EXTENT,0),E.emplaceBack(0,p.EXTENT,0,p.EXTENT),E.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(E,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const M=new p.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(M);const I=new p.StructArrayLayout1ui2;for(const F of[0,1,3,2,0])I.emplaceBack(F);this.debugIndexBuffer=c.createIndexBuffer(I),this.emptyTexture=new p.Texture(c,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=p.create();const k=this.context.gl;this.stencilClearMode=new p.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new bg(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,d=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,d.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,eu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,d,v){if(!d||this.currentStencilSource===d.id||!c.isTileClipped()||!v||0===v.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const k of v)if(void 0===this._tileClippingMaskIDs[k.key]){I=!0;break}if(!I)return}this.currentStencilSource=d.id;const b=this.context,E=b.gl;this.nextStencilID+v.length>256&&this.clearStencil(),b.setColorMode(p.ColorMode.disabled),b.setDepthMode(p.DepthMode.disabled);const M=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of v){const k=d.getTile(I),F=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:j,tileBoundsSegments:q}=this.getTileBoundsBuffers(k);M.draw(b,E.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:E.ALWAYS,mask:0},F,255,E.KEEP,E.KEEP,E.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,eu(I.projMatrix),"$clipping",L,j,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,d=this.context.gl;return new p.StencilMode({func:d.NOTEQUAL,mask:255},c,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const d=this.context.gl;return new p.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(c){const d=this.context.gl,v=c.sort((M,I)=>I.overscaledZ-M.overscaledZ),b=v[v.length-1].overscaledZ,E=v[0].overscaledZ-b+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const M={};for(let I=0;I<E;I++)M[I+b]=new p.StencilMode({func:d.GEQUAL,mask:255},I+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=E,[M,v]}return[{[b]:p.StencilMode.disabled},v]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([c.CONSTANT_COLOR,c.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(c,d,v){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new p.DepthMode(v||this.context.gl.LEQUAL,d,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,d){this.style=c,this.options=d,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const v=this.style.order,b=this.style._sourceCaches;for(const F in b){const L=b[F];L.used&&L.prepare(this.context)}const E={},M={},I={};for(const F in b){const L=b[F];E[F]=L.getVisibleCoordinates(),M[F]=E[F].slice().reverse(),I[F]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<v.length;F++)if(this.style._layers[v[F]].is3D()){this.opaquePassCutoff=F;break}if(this.terrain&&(this.terrain.updateTileBinding(I),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const F of v){const L=this.style._layers[F],j=c._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const q=j?M[j.id]:void 0;("custom"===L.type||L.isSky()||q&&q.length)&&this.renderLayer(this,j,L,q)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const k=this.terrain;if(k&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&k.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:d.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[v[this.currentLayer]],L=c._getLayerSourceCache(F);if(F.isSky())continue;const j=L?M[L.id]:void 0;this._renderTileClippingMasks(F,L,j),this.renderLayer(this,L,F,j)}if(this.style.fog&&this.transform.projection.supportsFog&&function(F,L){const j=F.context,q=j.gl,K=F.transform,Q=new p.DepthMode(q.LEQUAL,p.DepthMode.ReadOnly,[0,1]),J=F.useProgram("globeAtmosphere",null,"globe"===K.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ee=p.globeToMercatorTransition(K.zoom),U=L.properties.get("color").toArray01(),Y=L.properties.get("high-color").toArray01(),ie=L.properties.get("space-color").toArray01PremultipliedAlpha(),re=p.identity$1([]);p.rotateY$1(re,re,-p.degToRad(K._center.lng)),p.rotateX$1(re,re,p.degToRad(K._center.lat)),p.rotateZ$1(re,re,K.angle),p.rotateX$1(re,re,-K._pitch);const fe=p.fromQuat(new Float32Array(16),re),ge=p.mapValue(L.properties.get("star-intensity"),0,1,0,.25),be=p.mapValue(L.properties.get("horizon-blend"),0,1,5e-4,.25),xe=p.globeUseCustomAntiAliasing(F,j,K)&&5e-4===be?K.worldSize/(2*Math.PI*1.025)-1:K.globeRadius,Ie=F.frameCounter/1e3%1,Xe=p.length(K.globeCenterInViewSpace),Te=Math.sqrt(Math.pow(Xe,2)-Math.pow(xe,2)),je=Math.acos(Te/Xe),Pe={u_frustum_tl:K.frustumCorners.TL,u_frustum_tr:K.frustumCorners.TR,u_frustum_br:K.frustumCorners.BR,u_frustum_bl:K.frustumCorners.BL,u_horizon:K.frustumCorners.horizon,u_transition:ee,u_fadeout_range:be,u_color:U,u_high_color:Y,u_space_color:ie,u_star_intensity:ge,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ie,u_horizon_angle:je,u_rotation_matrix:fe};F.prepareDrawProgram(j,J);const We=F.atmosphereBuffer;We&&J.draw(j,q.TRIANGLES,Q,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,Pe,"skybox",We.vertexBuffer,We.indexBuffer,We.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const F=this.style._layers[v[this.currentLayer]],L=c._getLayerSourceCache(F);F.isSky()&&this.renderLayer(this,L,F,L?M[L.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const F=this.style._layers[v[this.currentLayer]],L=c._getLayerSourceCache(F);if(F.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(F)){if(F.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const j=L?("symbol"===F.type?I:M)[L.id]:void 0;this._renderTileClippingMasks(F,L,L?E[L.id]:void 0),this.renderLayer(this,L,F,j),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let F=null;p.values(this.style._layers).forEach(L=>{const j=c._getLayerSourceCache(L);j&&!L.isHidden(this.transform.zoom)&&(!F||F.getSource().maxzoom<j.getSource().maxzoom)&&(F=j)}),F&&this.options.showTileBoundaries&&aa.debug(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const L=F.transform.padding;Wd(F,F.transform.height-(L.top||0),3,li),Wd(F,L.bottom||0,3,dh),sa(F,L.left||0,3,fh),sa(F,F.transform.width-(L.right||0),3,_n);const j=F.transform.centerPoint;var q,K,Q,J;Ni(q=F,(K=j.x)-1,(Q=F.transform.height-j.y)-10,2,20,J=Gd),Ni(q,K-10,Q-1,20,2,J)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,d,v,b){v.isHidden(this.transform.zoom)||("background"===v.type||"sky"===v.type||"custom"===v.type||b&&b.length)&&(this.id=v.id,this.gpuTimingStart(v),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(v.type)||c.terrain&&"custom"===v.type)&&aa[v.type](c,d,v,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let v=this.gpuTimers[c.id];v||(v=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),v.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,d=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(d),c.beginQueryEXT(c.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const d={};for(const v in c){const b=c[v],E=this.context.extTimerQuery,M=E.getQueryObjectEXT(b.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(b.query),d[v]=M}return d}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery;let v=0;for(const b of c)v+=d.getQueryObjectEXT(b,d.QUERY_RESULT_EXT)/1e6,d.deleteQueryEXT(b);return v}translatePosMatrix(c,d,v,b,E){if(!v[0]&&!v[1])return c;const M=E?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(M){const F=Math.sin(M),L=Math.cos(M);v=[v[0]*L-v[1]*F,v[0]*F+v[1]*L]}const I=[E?v[0]:Xi(d,v[0],this.transform.zoom),E?v[1]:Xi(d,v[1],this.transform.zoom),0],k=new Float32Array(16);return p.translate(k,c,I),k}saveTileTexture(c){const d=this._tileTextures[c.size[0]];d?d.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const d=this._tileTextures[c];return d&&d.length>0?d.pop():null}isPatternMissing(c){return null===c||void 0!==c&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,d=this.terrain&&0===this.terrain.exaggeration(),v=this.style&&this.style.fog,b=[];return this.terrainRenderModeElevated()&&b.push("TERRAIN"),"globe"===this.transform.projection.name&&b.push("GLOBE"),d&&b.push("ZERO_EXAGGERATION"),v&&!c&&0!==v.getOpacity(this.transform.pitch)&&b.push("FOG"),c&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}useProgram(c,d,v){this.cache=this.cache||{};const b=v||[],E=this.currentGlobalDefines().concat(b),M=mn.cacheKey(uo[c],c,E,d);return this.cache[M]||(this.cache[M]=new mn(this.context,c,uo[c],d,Gr[c],E)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,d,v){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const E=b.getOpacity(this.transform.pitch),M=((I,k,F,L,j,q,K,Q,J,ee,U)=>{const Y=I.transform,ie=k.properties.get("color").toArray01();ie[3]=L;const re=I.frameCounter/1e3%1;return{u_fog_matrix:F?Y.calculateFogTileMatrix(F):I.identityMat,u_fog_range:k.getFovAdjustedRange(Y._fov),u_fog_color:ie,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_temporal_offset:re,u_frustum_tl:j,u_frustum_tr:q,u_frustum_br:K,u_frustum_bl:Q,u_globe_pos:J,u_globe_radius:ee,u_viewport:U,u_globe_transition:p.globeToMercatorTransition(Y.zoom),u_is_globe:+("globe"===Y.projection.name)}})(this,b,v,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);d.setFogUniformValues(c,M)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,d=c.createTexture();return c.bindTexture(c.TEXTURE_2D,d),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,d=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const b of v)d[b.key]=c[b.key]||new p.Tile(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class Dl{constructor(c=0,d=0,v=0,b=0){if(isNaN(c)||c<0||isNaN(d)||d<0||isNaN(v)||v<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=d,this.left=v,this.right=b}interpolate(c,d,v){return null!=d.top&&null!=c.top&&(this.top=p.number(c.top,d.top,v)),null!=d.bottom&&null!=c.bottom&&(this.bottom=p.number(c.bottom,d.bottom,v)),null!=d.left&&null!=c.left&&(this.left=p.number(c.left,d.left,v)),null!=d.right&&null!=c.right&&(this.right=p.number(c.right,d.right,v)),this}getCenter(c,d){const v=p.clamp((this.left+c-this.right)/2,0,c),b=p.clamp((this.top+d-this.bottom)/2,0,d);return new p.Point(v,b)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Dl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Tl(g,c){const d=p.getColumn(g,3);p.fromQuat(g,c),p.setColumn(g,3,d)}function gn(g,c){const d=p.identity$1([]);return p.rotateZ$1(d,d,-c),p.rotateX$1(d,d,-g),d}function Ji(g,c){const d=[g[0],g[1],0],v=[c[0],c[1],0];if(p.length(d)>=1e-15){const M=p.normalize([],d);p.scale$2(v,M,p.dot(v,M)),c[0]=v[0],c[1]=v[1]}const b=p.cross([],c,g);if(p.len(b)<1e-15)return null;const E=Math.atan2(-b[1],b[0]);return gn(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),E)}class wg{constructor(c,d){this.position=c,this.orientation=d}get position(){return this._position}set position(c){if(c){const d=c instanceof p.MercatorCoordinate?c:new p.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(d.x=p.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(c,d){if(this.orientation=null,!this.position)return;const v=this.position,b=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(c)):0,E=p.MercatorCoordinate.fromLngLat(c,b),M=[E.x-v.x,E.y-v.y,E.z-v.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Ji(M,d)}setPitchBearing(c,d){this.orientation=gn(p.degToRad(c),p.degToRad(-d))}}class Pr{constructor(c,d){this._transform=p.identity([]),this.orientation=d,this.position=c}get mercatorPosition(){const c=this.position;return new p.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=p.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var d;c&&p.setColumn(this._transform,3,[(d=c)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||p.identity$1([]),c&&Tl(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,d){this._orientation=gn(c,d),Tl(this._transform,this._orientation)}forward(){const c=p.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=p.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=p.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,d){const v=new Float64Array(16);return p.invert(v,this.getWorldToCamera(c,d)),v}getWorldToCameraPosition(c,d,v){const b=this.position;p.scale$2(b,b,-c);const E=new Float64Array(16);return p.fromScaling(E,[v,v,v]),p.translate(E,E,b),E[10]*=d,E}getWorldToCamera(c,d){const v=new Float64Array(16),b=new Float64Array(4),E=this.position;return p.conjugate(b,this._orientation),p.scale$2(E,E,-c),p.fromQuat(v,b),p.translate(v,v,E),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=d,v[9]*=d,v[10]*=d,v[11]*=d,v}getCameraToClipPerspective(c,d,v,b){const E=new Float64Array(16);return p.perspective(E,c,d,v,b),E}getDistanceToElevation(c,d=!1){const v=0===c?0:p.mercatorZfromAltitude(c,d?p.latFromMercatorY(this.position[1]):this.position[1]),b=this.forward();return(v-this.position[2])/b[2]}clone(){return new Pr([...this.position],[...this.orientation])}}function kr(g,c){const d=Na(g.projection,g.zoom,g.width,g.height),v=function(E,M,I,k,F){const L=new p.LngLat(I.lng-180*$o,I.lat),j=new p.LngLat(I.lng+180*$o,I.lat),q=E.project(L.lng,L.lat),K=E.project(j.lng,j.lat),Q=-Math.atan2(K.y-q.y,K.x-q.x),J=p.MercatorCoordinate.fromLngLat(I);J.y=p.clamp(J.y,-1+$o,1-$o);const ee=J.toLngLat(),U=E.project(ee.lng,ee.lat),Y=p.MercatorCoordinate.fromLngLat(ee);Y.x+=$o;const ie=Y.toLngLat(),re=E.project(ie.lng,ie.lat),fe=mh(re.x-U.x,re.y-U.y,Q),ge=p.MercatorCoordinate.fromLngLat(ee);ge.y+=$o;const de=ge.toLngLat(),be=E.project(de.lng,de.lat),xe=mh(be.x-U.x,be.y-U.y,Q),Ie=Math.abs(fe.x)/Math.abs(xe.y),Xe=p.identity([]);p.rotateZ(Xe,Xe,-Q*(1-(F?0:k)));const Te=p.identity([]);return p.scale(Te,Te,[1,1-(1-Ie)*k,1]),Te[4]=-xe.x/xe.y*k,p.rotateZ(Te,Te,Q),p.multiply(Te,Xe,Te),Te}(g.projection,0,g.center,d,c),b=ph(g);return p.scale(v,v,[b,b,1]),v}function ph(g){const c=g.projection,d=Na(g.projection,g.zoom,g.width,g.height),v=Ho(c,g.center),b=Ho(c,p.LngLat.convert(c.center));return Math.pow(2,v*d+(1-d)*b)}function Na(g,c,d,v,b=1/0){const E=g.range;if(!E)return 0;const M=Math.min(b,Math.max(d,v)),I=Math.log(M/1024)/Math.LN2;return p.smoothstep(E[0]+I,E[1]+I,c)}const $o=1/4e4;function Ho(g,c){const d=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),v=new p.LngLat(c.lng-180*$o,d),b=new p.LngLat(c.lng+180*$o,d),E=g.project(v.lng,d),M=g.project(b.lng,d),I=p.MercatorCoordinate.fromLngLat(v),k=p.MercatorCoordinate.fromLngLat(b),F=M.x-E.x,L=M.y-E.y,j=k.x-I.x,q=k.y-I.y,K=Math.sqrt((j*j+q*q)/(F*F+L*L));return Math.log(K)/Math.LN2}function mh(g,c,d){const v=Math.cos(d),b=Math.sin(d);return{x:g*v-c*b,y:g*b+c*v}}class cu{constructor(c,d,v,b,E,M,I){this.tileSize=512,this._renderWorldCopies=void 0===E||E,this._minZoom=c||0,this._maxZoom=d||22,this._minPitch=v??0,this._maxPitch=b??60,this.setProjection(M),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Dl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Pr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new cu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,d=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||v)&&this._updateCameraOnTerrain(),(c||v)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const v=!Ue(d,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const d=c!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const d=-c*Math.PI/180;var v,b,E,M,I,k,F,L,j,q;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(v=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),b=this.rotationMatrix,M=this.angle,I=(E=this.rotationMatrix)[0],k=E[1],F=E[2],L=E[3],j=Math.sin(M),q=Math.cos(M),b[0]=I*q+F*j,b[1]=k*q+L*j,b[2]=I*-j+F*q,b[3]=k*-j+L*q)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const d=p.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=p.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const d=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let b=0,E=0;for(let M=0;M<d.length;M++){const I=new p.Point(d[M][0]*this.width,v+d[M][1]*(this.height-v)),k=c.pointCoordinate(I);if(!k)continue;const F=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);b+=k[3]*F,E+=F}return 0===E?NaN:b/E}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(c),E=this._mercatorZfromZoom(this._maxZoom),M=Math.max(b-v,E);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let v;v=c.z<this._camera.position[2]?[d.x,d.y,d.z]:[c.x,c.y,c.z];const b=p.length(p.sub([],this._camera.position,v));return p.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let d=!1;if(c.orientation&&!p.exactEquals(c.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(c.orientation)),c.position){const v=[c.position.x,c.position.y,c.position.z];p.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,d=new wg;return d.position=new p.MercatorCoordinate(c[0],c[1],c[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(c){if(!p.length$1(c))return!1;p.normalize$1(c,c);const d=p.transformQuat([],[0,0,-1],c),v=p.transformQuat([],[0,-1,0],c);if(v[2]<0)return!1;const b=Ji(d,v);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(c){const d=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;c[2]=p.clamp(c[2],b/v,b/d),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,d,v){this._unmodified=!1,this._edgeInsets.interpolate(c,d,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const d=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(c){const d=[new p.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const v=this.pointCoordinate(new p.Point(0,0)),b=this.pointCoordinate(new p.Point(this.width,0)),E=this.pointCoordinate(new p.Point(this.width,this.height)),M=this.pointCoordinate(new p.Point(0,this.height)),I=Math.floor(Math.min(v.x,b.x,E.x,M.x)),k=Math.floor(Math.max(v.x,b.x,E.x,M.x)),F=1;for(let L=I-F;L<=k+F;L++)0!==L&&d.push(new p.UnwrappedTileID(L,c))}return d}coveringTiles(c){let d=this.coveringZoomLevel(c);const v=d,b=this.elevation&&!c.isTerrainDEM,E="mercator"===this.projection.name;if(void 0!==c.minzoom&&d<c.minzoom)return[];void 0!==c.maxzoom&&d>c.maxzoom&&(d=c.maxzoom);const M=this.locationCoordinate(this.center),I=this.center.lat,k=1<<d,F=[k*M.x,k*M.y,0],L="globe"===this.projection.name,j=!L,q=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,j),K=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=k*p.mercatorZfromAltitude(1,this.center.lat),J=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),ee=[k*K.x,k*K.y,J*(j?1:Q)],U=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),Y=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,ie=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,re=c.isTerrainDEM?-ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?ph(this):1,ge=Se=>{const Ye=new p.MercatorCoordinate(Se.x+25e-6,Se.y,Se.z),$e=new p.MercatorCoordinate(Se.x,Se.y+25e-6,Se.z),qe=Se.toLngLat(),_t=Ye.toLngLat(),zt=$e.toLngLat(),mt=this.locationCoordinate(qe),Tt=this.locationCoordinate(_t),dn=this.locationCoordinate(zt),sn=Math.hypot(Tt.x-mt.x,Tt.y-mt.y),vt=Math.hypot(dn.x-mt.x,dn.y-mt.y);return Math.sqrt(sn*vt)*fe/25e-6},de=Se=>{const Ne=ie,Ye=re;return{aabb:p.tileAABB(this,k,0,0,0,Se,Ye,Ne,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:Ne,wrap:Se,fullyVisible:!1}},be=[];let xe=[];const Ie=d,Xe=c.reparseOverscaled?v:d,Te=Se=>Se*Se,je=Te((J-this._centerAltitude)*Q),Pe=Se=>{if(!this._elevation||!Se.tileID||!E)return;const Ne=this._elevation.getMinMaxForTile(Se.tileID),Ye=Se.aabb;Ne?(Ye.min[2]=Ne.min,Ye.max[2]=Ne.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(Se.shouldSplit=We(Se),Se.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},We=Se=>{if(Se.zoom<Y)return!0;if(Se.zoom===Ie)return!1;if(null!=Se.shouldSplit)return Se.shouldSplit;const Ne=Se.aabb.distanceX(ee),Ye=Se.aabb.distanceY(ee);let $e=je,qe=1;if(L){$e=Te(Se.aabb.distanceZ(ee));const mt=Math.pow(2,Se.zoom),Tt=p.latFromMercatorY((Se.y+1)/mt),dn=p.latFromMercatorY(Se.y/mt),sn=Math.min(Math.max(I,Tt),dn),vt=p.circumferenceAtLatitude(sn)/p.circumferenceAtLatitude(I);if(qe=sn===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,vt/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&Se.zoom===Ie-1&&vt>=.9)return!0}else if(b&&($e=Te(Se.aabb.distanceZ(ee)*Q)),this.projection.isReprojectedInTileSpace&&v<=5){const mt=Math.pow(2,Se.zoom),Tt=ge(new p.MercatorCoordinate((Se.x+.5)/mt,(Se.y+.5)/mt));qe=Tt>.85?1:Tt}const _t=Ne*Ne+Ye*Ye+$e;return _t<Te((1<<Ie-Se.zoom)*U*qe*((mt,Tt)=>{if(Tt*Te(.707)<mt)return 1;const dn=Math.sqrt(Tt/mt);return dn/(1.4144271570014144+(Math.pow(1.1,dn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max($e,je),_t))};if(this.renderWorldCopies)for(let Se=1;Se<=3;Se++)be.push(de(-Se)),be.push(de(Se));for(be.push(de(0));be.length>0;){const Se=be.pop(),Ne=Se.x,Ye=Se.y;let $e=Se.fullyVisible;if(!$e){const qe=Se.aabb.intersects(q);if(0===qe)continue;$e=2===qe}if(Se.zoom!==Ie&&We(Se))for(let qe=0;qe<4;qe++){const _t=(Ne<<1)+qe%2,zt=(Ye<<1)+(qe>>1),mt={aabb:E?Se.aabb.quadrant(qe):p.tileAABB(this,k,Se.zoom+1,_t,zt,Se.wrap,Se.minZ,Se.maxZ,this.projection),zoom:Se.zoom+1,x:_t,y:zt,wrap:Se.wrap,fullyVisible:$e,tileID:void 0,shouldSplit:void 0,minZ:Se.minZ,maxZ:Se.maxZ};b&&!L&&(mt.tileID=new p.OverscaledTileID(Se.zoom+1===Ie?Xe:Se.zoom+1,Se.wrap,Se.zoom+1,_t,zt),Pe(mt)),be.push(mt)}else{const qe=Se.zoom===Ie?Xe:Se.zoom;if(c.minzoom&&c.minzoom>qe)continue;const _t=F[0]-(.5+Ne+(Se.wrap<<Se.zoom))*(1<<d-Se.zoom),zt=F[1]-.5-Ye,mt=Se.tileID?Se.tileID:new p.OverscaledTileID(qe,Se.wrap,Se.zoom,Ne,Ye);xe.push({tileID:mt,distanceSq:_t*_t+zt*zt})}}if(this.fogCullDistSq){const Se=this.fogCullDistSq,Ne=this.horizonLineFromTop();xe=xe.filter(Ye=>{const $e=[0,0,0,1],qe=[p.EXTENT,p.EXTENT,0,1],_t=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());p.transformMat4$1($e,$e,_t),p.transformMat4$1(qe,qe,_t);const zt=p.getAABBPointSquareDist($e,qe);if(0===zt)return!0;let mt=!1;const Tt=this._elevation;if(Tt&&zt>Se&&0!==Ne){const dn=this.calculateProjMatrix(Ye.tileID.toUnwrapped());let sn;c.isTerrainDEM||(sn=Tt.getMinMaxForTile(Ye.tileID)),sn||(sn={min:re,max:ie});const vt=p.furthestTileCorner(this.rotation),Ln=[vt[0]*p.EXTENT,vt[1]*p.EXTENT,sn.max];p.transformMat4(Ln,Ln,dn),mt=(1-Ln[1])*this.height*.5<Ne}return zt<Se||mt})}return xe.sort((Se,Ne)=>Se.distanceSq-Ne.distanceSq).map(Se=>Se.tileID)}resize(c,d){this.width=c,this.height=d,this.pixelsToGLUnits=[2/c,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const d=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),v=this.projection.project(c.lng,d);return new p.Point(v.x*this.worldSize,v.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,d){let v,b;const E=this.centerPoint;if("globe"===this.projection.name){const I=this.worldSize;v=(d.x-E.x)/I,b=(d.y-E.y)/I}else{const I=this.pointCoordinate(d),k=this.pointCoordinate(E);v=I.x-k.x,b=I.y-k.y}const M=this.locationCoordinate(c);this.setLocation(new p.MercatorCoordinate(M.x-v,M.y-b))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,d){const v=d?p.mercatorZfromAltitude(d,c.lat):void 0,b=this.projection.project(c.lng,c.lat);return new p.MercatorCoordinate(b.x,b.y,v)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,d){const v=d??this._centerAltitude,b=[c.x,c.y,0,1],E=[c.x,c.y,1,1];p.transformMat4$1(b,b,this.pixelMatrixInverse),p.transformMat4$1(E,E,this.pixelMatrixInverse);const M=E[3];p.scale$1(b,b,1/b[3]),p.scale$1(E,E,1/M);const I=b[2],k=E[2];return{p0:b,p1:E,t:I===k?0:(v-I)/(k-I)}}screenPointToMercatorRay(c){const d=[c.x,c.y,0,1],v=[c.x,c.y,1,1];return p.transformMat4$1(d,d,this.pixelMatrixInverse),p.transformMat4$1(v,v,this.pixelMatrixInverse),p.scale$1(d,d,1/d[3]),p.scale$1(v,v,1/v[3]),d[2]=p.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,v[2]=p.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,p.scale$1(d,d,1/this.worldSize),p.scale$1(v,v,1/this.worldSize),new p.Ray([d[0],d[1],d[2]],p.normalize([],p.sub([],v,d)))}rayIntersectionCoordinate(c){const{p0:d,p1:v,t:b}=c,E=p.mercatorZfromAltitude(d[2],this._center.lat),M=p.mercatorZfromAltitude(v[2],this._center.lat);return new p.MercatorCoordinate(p.number(d[0],v[0],b)/this.worldSize,p.number(d[1],v[1],b)/this.worldSize,p.number(E,M,b))}pointCoordinate(c,d=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,d)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let d=this.projection.pointCoordinate3D(this,c.x,c.y);if(d)return new p.MercatorCoordinate(d[0],d[1],d[2]);let v=0,b=this.horizonLineFromTop();if(c.y>b)return this.pointCoordinate(c);const E=.02*b,M=c.clone();for(let I=0;I<10&&b-v>E;I++){M.y=p.number(v,b,.66);const k=this.projection.pointCoordinate3D(this,M.x,M.y);k?(b=M.y,d=k):v=M.y}return d?new p.MercatorCoordinate(d[0],d[1],d[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(c);const d=this.pointCoordinate(c);return d.y>=0&&d.y<=1}_coordinatePoint(c,d){const v=d&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,b=[c.x*this.worldSize,c.y*this.worldSize,v+c.toAltitude(),1];return p.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new p.Point(b[0]/b[3],b[1]/b[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:d}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,E=this.pointLocation3D(new p.Point(d,c)),M=this.pointLocation3D(new p.Point(b,c)),I=this.pointLocation3D(new p.Point(b,v)),k=this.pointLocation3D(new p.Point(d,v));let F=Math.min(E.lng,M.lng,I.lng,k.lng),L=Math.max(E.lng,M.lng,I.lng,k.lng),j=Math.min(E.lat,M.lat,I.lat,k.lat),q=Math.max(E.lat,M.lat,I.lat,k.lat);const K=Math.pow(2,-this.zoom)/16*270,Q="globe"===this.projection.name?1:4,J=(ee,U,Y,ie,re)=>{const fe=(ee+Y)/2,ge=(U+ie)/2,de=new p.Point(fe,ge),{lng:be,lat:xe}=this.pointLocation3D(de),Ie=Math.max(0,F-be,j-xe,be-L,xe-q);F=Math.min(F,be),L=Math.max(L,be),j=Math.min(j,xe),q=Math.max(q,xe),(re<Q||Ie>K)&&(J(ee,U,fe,ge,re+1),J(fe,ge,Y,ie,re+1))};if(J(d,c,b,c,1),J(b,c,b,v,1),J(b,v,d,v,1),J(d,v,d,c,1),"globe"===this.projection.name){const[ee,U]=p.polesInViewport(this);ee?(q=90,L=180,F=-180):U&&(j=-90,L=180,F=-180)}return new p.LngLatBounds(new p.LngLat(F,j),new p.LngLat(L,q))}_getBoundsRectangular(c,d){const{top:v,left:b}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,I=new p.Point(b,v),k=new p.Point(M,v),F=new p.Point(M,E),L=new p.Point(b,E);let j=this.pointCoordinate(I,c),q=this.pointCoordinate(k,c);const K=this.pointCoordinate(F,d),Q=this.pointCoordinate(L,d),J=(ee,U)=>(U.y-ee.y)/(U.x-ee.x);return j.y>1&&q.y>=0?j=new p.MercatorCoordinate((1-Q.y)/J(Q,j)+Q.x,1):j.y<0&&q.y<=1&&(j=new p.MercatorCoordinate(-Q.y/J(Q,j)+Q.x,0)),q.y>1&&j.y>=0?q=new p.MercatorCoordinate((1-K.y)/J(K,q)+K.x,1):q.y<0&&j.y<=1&&(q=new p.MercatorCoordinate(-K.y/J(K,q)+K.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(K))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=c.visibleDemTiles.reduce((v,b)=>{if(b.dem){const E=b.dem.tree;v.min=Math.min(v.min,E.minimums[0]),v.max=Math.max(v.max,E.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*c.exaggeration(),d.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-d*(1-this._horizonShift);return c?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,d){return this.projection.createTileMatrix(this,d,c)}calculateDistanceTileData(c){const d=c.key,v=this._distanceTileDataCache;if(v[d])return v[d];const b=c.canonical,E=1/this.height,M=this.cameraWorldSize,I=M/this.zoomScale(b.z),k=(b.x+Math.pow(2,b.z)*c.wrap)*I,F=b.y*I,L=this.point;L.x*=M/this.worldSize,L.y*=M/this.worldSize;const j=this.angle,q=Math.sin(-j),K=-Math.cos(-j);return v[d]={bearing:[q,K],center:[(L.x-k)*E,(L.y-F)*E],scale:I/p.EXTENT*E},v[d]}calculateFogTileMatrix(c){const d=c.key,v=this._fogTileMatrixCache;if(v[d])return v[d];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return p.multiply(b,this.worldToFogMatrix,b),v[d]=new Float32Array(b),v[d]}calculateProjMatrix(c,d=!1){const v=c.key,b=d?this._alignedProjMatrixCache:this._projMatrixCache;if(b[v])return b[v];const E=this.calculatePosMatrix(c,this.worldSize);return p.multiply(E,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,E),b[v]=new Float32Array(E),b[v]}calculatePixelsToTileUnitsMatrix(c){const d=c.tileID.key,v=this._pixelsToTileUnitsCache;if(v[d])return v[d];const b=function(E,M){const{scale:I}=E.tileTransform,k=I*p.EXTENT/(E.tileSize*Math.pow(2,M.zoom-E.tileID.overscaledZ+E.tileID.canonical.z));return F=new Float32Array(4),q=(L=M.inverseAdjustmentMatrix)[1],K=L[2],Q=L[3],ee=(j=[k,k])[1],F[0]=L[0]*(J=j[0]),F[1]=q*J,F[2]=K*ee,F[3]=Q*ee,F;var F,L,j,q,K,Q,J,ee}(c,this);return v[d]=b,v[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,d=p.fromScaling([],[c,c,c]);return p.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const d=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(d),b=this._camera.forward(),E=p.mercatorZfromAltitude(1,this._center.lat);v[2]/=E,b[2]/=E,p.normalize(b,b);const M=c.raycast(v,b,c.exaggeration());if(M){const I=p.scaleAndAdd([],v,b,M),k=new p.MercatorCoordinate(I[0],I[1],p.mercatorZfromAltitude(I[2],p.latFromMercatorY(I[1]))),F=(k.z+p.length([k.x-v[0],k.y-v[1],k.z-v[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const d=this._elevation,v=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(v),E=d.getAtPointOrZero(new p.MercatorCoordinate(...b)),M=this.pixelsPerMeter/this.worldSize*E,I=this._minimumHeightOverTerrain(),k=b[2]-M;if(k<=I)if(k<0||c){const F=this.locationCoordinate(this._center,this._centerAltitude),L=[b[0],b[1],F.z-b[2]],j=p.length(L);L[2]-=(I-k)/this._pixelsPerMercatorPixel;const q=p.length(L);if(0===q)return;p.scale$2(L,L,j/q*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],F.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const q=this.center;return q.lat=p.clamp(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(q.lng=p.clamp(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const d=this._unmodified,{x:v,y:b}=this.point;let E=0,M=v,I=b;const k=this.width/2,F=this.height/2,L=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(b-F<L&&(I=L+F),b+F>j&&(I=j-F),j-L<this.height&&(E=Math.max(E,this.height/(j-L)),I=(j+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,Q=this.worldSize/2-(q+K)/2;M=(v+Q+this.worldSize)%this.worldSize-Q,M-k<q&&(M=q+k),M+k>K&&(M=K-k),K-q<this.width&&(E=Math.max(E,this.width/(K-q)),M=(K+q)/2)}M===v&&I===b||(this.center=this.unproject(new p.Point(M,I))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,d=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const v=Na(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b="meters"===this.projection.zAxisUnit?d:1,E=this._camera.getWorldToCamera(this.worldSize,b),M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);M[8]=2*-c.x/this.width,M[9]=2*c.y/this.height;let I=p.mul([],M,E);if(this.projection.isReprojectedInTileSpace){const ge=this.locationCoordinate(this.center),de=p.identity([]);p.translate(de,de,[ge.x*this.worldSize,ge.y*this.worldSize,0]),p.multiply(de,de,kr(this)),p.translate(de,de,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),p.multiply(I,I,de),this.inverseAdjustmentMatrix=function(be){const xe=kr(be,!0);return at([],[xe[0],xe[1],xe[4],xe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],I,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=I,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const k=p.invert([],M);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height);const F=new Float32Array(16);p.identity(F),p.scale(F,F,[1,-1,1]),p.rotateX(F,F,this._pitch),p.rotateZ(F,F,this.angle);const L=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;L[8]=2*-c.x/this.width,L[9]=2*(c.y+j)/this.height,this.skyboxMatrix=p.multiply(F,L,F);const q=this.point,K=q.x,Q=q.y,J=this.width%2/2,ee=this.height%2/2,U=Math.cos(this.angle),Y=Math.sin(this.angle),ie=K-Math.round(K)+U*J+Y*ee,re=Q-Math.round(Q)+U*ee+Y*J,fe=new Float64Array(I);if(p.translate(fe,fe,[ie>.5?ie-1:ie,re>.5?re-1:re,0]),this.alignedProjMatrix=fe,I=p.create(),p.scale(I,I,[this.width/2,-this.height/2,1]),p.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=p.create(),p.scale(I,I,[1,-1,1]),p.translate(I,I,[-1,-1,0]),p.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=p.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(ge,ge,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,v=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,E=[c,c,d];p.scale$2(E,E,b),p.scale$2(v,v,-1),p.multiply$2(v,v,E);const M=p.create();p.translate(M,M,v),p.scale(M,M,E),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,d,b)}_computeCameraPosition(c){const d=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),b=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-c/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-v[0]*E,b.y/this.worldSize-v[1]*E,c/this.worldSize*this._centerAltitude-v[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],b=c[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(E=Math.min((d-v)/b,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,c,E),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,d=this._camera.forward(),{pitch:v,bearing:b}=this._camera.getPitchBearing(),E=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),I=Math.max((c[2]-E)/Math.cos(v),M),k=this._zoomFromMercatorZ(I);p.scaleAndAdd(c,c,d,I),this._pitch=p.clamp(v,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(b,-Math.PI,Math.PI),this._setZoom(p.clamp(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let d=0,v=p.GLOBE_ZOOM_THRESHOLD_MAX,b=0,E=1/0;for(;v-d>1e-6&&v>d;){const M=d+.5*(v-d),I=this.tileSize*Math.pow(2,M),k=this.getCameraToCenterDistance(this.projection,M,I),F=this.scaleZoom(k/(c*this.tileSize)),L=Math.abs(M-F);L<E&&(E=L,b=M),M<F?d=M:v=M}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,d){const v=Math.min(c.x,d.x),b=Math.max(c.x,d.x),E=Math.min(c.y,d.y),M=Math.max(c.y,d.y);if(E<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const I=[new p.Point(v,E),new p.Point(b,M),new p.Point(v,M),new p.Point(b,E)],k=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const L of I){const j=this.pointRayIntersection(L);if(j.t<0)return!0;const q=this.rayIntersectionCoordinate(j);if(q.x<k||q.y<0||q.x>F||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(c,d){const v=p.length(p.sub([],this._camera.position,c)),b=this._zoomFromMercatorZ(v)+d;return v-this._mercatorZfromZoom(b)}getCameraPoint(){if("globe"===this.projection.name){const c=function([d,v,b],E){const M=[d,v,b,1];p.transformMat4$1(M,M,E);const I=M[3]=Math.max(M[3],1e-6);return M[0]/=I,M[1]/=I,M[2]/=I,M}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,c))}}getCameraToCenterDistance(c,d=this.zoom,v=this.worldSize){const b=Na(c,d,this.width,this.height,1024),E=c.pixelSpaceConversion(this.center.lat,v,b);return.5/Math.tan(.5*this._fov)*this.height*E}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(c,c,this.globeMatrix),c}}function _c(g,c){let d=!1,v=null;const b=()=>{v=null,d&&(g(),v=setTimeout(b,c),d=!1)};return()=>(d=!0,v||b(),v)}class qd{constructor(c){this._hashName=c&&encodeURIComponent(c),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=_c(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,p.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const d=gh(c);if(this._hashName){const v=this._hashName;let b=!1;const E=p.window.location.hash.slice(1).split("&").map(M=>{const I=M.split("=")[0];return I===v?(b=!0,`${I}=${d}`):M}).filter(M=>M);return b||E.push(`${v}=${d}`),`#${E.join("&")}`}return`#${d}`}_getCurrentHash(){const c=p.window.location.hash.replace("#","");if(this._hashName){let d;return c.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(d=v)}),(d&&d[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(v=>isNaN(v))){const v=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(d[3]||0):c.getBearing();return c.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:v,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,c)}}function gh(g,c){const d=g.getCenter(),v=Math.round(100*g.getZoom())/100,b=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,b),M=Math.round(d.lng*E)/E,I=Math.round(d.lat*E)/E,k=g.getBearing(),F=g.getPitch();let L=c?`/${M}/${I}/${v}`:`${v}/${I}/${M}`;return(k||F)&&(L+="/"+Math.round(10*k)/10),F&&(L+=`/${Math.round(F)}`),L}const _h={linearity:.3,easing:p.bezier(0,0,.3,1)},Zd=p.extend({deceleration:2500,maxSpeed:1400},_h),Xd=p.extend({deceleration:20,maxSpeed:1400},_h),ut=p.extend({deceleration:1e3,maxSpeed:360},_h),Rs=p.extend({deceleration:1e3,maxSpeed:90},_h);class Cg{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,d=p.exported.now();for(;c.length>0&&d-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const E=vh(d.pan.mag(),v,p.extend({},Zd,c||{}));b.offset=d.pan.mult(E.amount/d.pan.mag()),b.center=this._map.transform.center,yh(b,E)}if(d.zoom){const E=vh(d.zoom,v,Xd);b.zoom=this._map.transform.zoom+E.amount,yh(b,E)}if(d.bearing){const E=vh(d.bearing,v,ut);b.bearing=this._map.transform.bearing+p.clamp(E.amount,-179,179),yh(b,E)}if(d.pitch){const E=vh(d.pitch,v,Rs);b.pitch=this._map.transform.pitch+E.amount,yh(b,E)}if(b.zoom||b.bearing){const E=void 0===d.pinchAround?d.around:d.pinchAround;b.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function yh(g,c){(!g.duration||g.duration<c.duration)&&(g.duration=c.duration,g.easing=c.easing)}function vh(g,c,d){const{maxSpeed:v,linearity:b,deceleration:E}=d,M=p.clamp(g*b/(c/1e3),-v,v),I=Math.abs(M)/(E*b);return{easing:d.easing,duration:1e3*I,amount:M*(I/2)}}class gr extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,v,b={}){const E=ro(d.getCanvasContainer(),v),M=d.unproject(E);super(c,p.extend({point:E,lngLat:M,originalEvent:v},b)),this._defaultPrevented=!1,this.target=d}}class xh extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,v){const b="touchend"===c?v.changedTouches:v.touches,E=al(d.getCanvasContainer(),b),M=E.map(k=>d.unproject(k)),I=E.reduce((k,F,L,j)=>k.add(F.div(j.length)),new p.Point(0,0));super(c,{points:E,point:I,lngLats:M,lngLat:d.unproject(I),originalEvent:v}),this._defaultPrevented=!1}}class Yd extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,v){super(c,{originalEvent:v}),this._defaultPrevented=!1}}class bh{constructor(c,d){this._map=c,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new Yd(c.type,this._map,c))}mousedown(c,d){return this._mousedownPos=d,this._firePreventable(new gr(c.type,this._map,c))}mouseup(c){this._map.fire(new gr(c.type,this._map,c))}preclick(c){const d=p.extend({},c);d.type="preclick",this._map.fire(new gr(d.type,this._map,d))}click(c,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(c),this._map.fire(new gr(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new gr(c.type,this._map,c))}mouseover(c){this._map.fire(new gr(c.type,this._map,c))}mouseout(c){this._map.fire(new gr(c.type,this._map,c))}touchstart(c){return this._firePreventable(new xh(c.type,this._map,c))}touchmove(c){this._map.fire(new xh(c.type,this._map,c))}touchend(c){this._map.fire(new xh(c.type,this._map,c))}touchcancel(c){this._map.fire(new xh(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uu{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new gr(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new gr(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eg{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,d){this.isEnabled()&&c.shiftKey&&0===c.button&&(Gc(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(c,d){if(!this._active)return;const v=d,b=this._startPos,E=this._lastPos;if(!b||!E||E.equals(v)||!this._box&&v.dist(b)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=Xt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const M=Math.min(b.x,v.x),I=Math.max(b.x,v.x),k=Math.min(b.y,v.y),F=Math.max(b.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${k}px)`,this._box.style.width=I-M+"px",this._box.style.height=F-k+"px")})}mouseupWindow(c,d){if(!this._active)return;const v=this._startPos,b=d;if(v&&0===c.button){if(this.reset(),Fo(),v.x!==b.x||v.y!==b.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:E=>E.fitScreenCoordinates(v,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Jl(),delete this._startPos,delete this._lastPos}_fireEvent(c,d){return this._map.fire(new p.Event(c,{originalEvent:d}))}}function Kd(g,c){const d={};for(let v=0;v<g.length;v++)d[g[v].identifier]=c[v];return d}class hu{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,d,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),v.length===this.numTouches&&(this.centroid=function(b){const E=new p.Point(0,0);for(const M of b)E._add(M);return E.div(b.length)}(d),this.touches=Kd(v,d)))}touchmove(c,d,v){if(this.aborted||!this.centroid)return;const b=Kd(v,d);for(const E in this.touches){const M=b[E];(!M||M.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(c,d,v){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===v.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class la{constructor(c){this.singleTap=new hu(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,d,v){this.singleTap.touchstart(c,d,v)}touchmove(c,d,v){this.singleTap.touchmove(c,d,v)}touchend(c,d,v){const b=this.singleTap.touchend(c,d,v);if(b){const E=c.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(b)<30;if(E&&M||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Dg{constructor(){this._zoomIn=new la({numTouches:1,numTaps:2}),this._zoomOut=new la({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,d,v){this._zoomIn.touchstart(c,d,v),this._zoomOut.touchstart(c,d,v)}touchmove(c,d,v){this._zoomIn.touchmove(c,d,v),this._zoomOut.touchmove(c,d,v)}touchend(c,d,v){const b=this._zoomIn.touchend(c,d,v),E=this._zoomOut.touchend(c,d,v);return b?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(b)},{originalEvent:c})}):E?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(E)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qr={0:1,2:2};class Sl{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,d){return!1}_move(c,d){return{}}mousedown(c,d){if(this._lastPoint)return;const v=Xs(c);this._correctButton(c,v)&&(this._lastPoint=d,this._eventButton=v)}mousemoveWindow(c,d){const v=this._lastPoint;if(v)if(c.preventDefault(),null!=this._eventButton&&function(b,E){const M=qr[E];return void 0===b.buttons||(b.buttons&M)!==M}(c,this._eventButton))this.reset();else if(this._moved||!(d.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(v,d)}mouseupWindow(c){this._lastPoint&&Xs(c)===this._eventButton&&(this._moved&&Fo(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jd extends Sl{mousedown(c,d){super.mousedown(c,d),this._lastPoint&&(this._active=!0)}_correctButton(c,d){return 0===d&&!c.ctrlKey}_move(c,d){return{around:d,panDelta:d.sub(c)}}}class Qd extends Sl{_correctButton(c,d){return 0===d&&c.ctrlKey||2===d}_move(c,d){const v=.8*(d.x-c.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(c){c.preventDefault()}}class wh extends Sl{_correctButton(c,d){return 0===d&&c.ctrlKey||2===d}_move(c,d){const v=-.5*(d.y-c.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(c){c.preventDefault()}}class du{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(c,d,v){return this._calculateTransform(c,d,v)}touchmove(c,d,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===v.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,d,v)}}touchend(c,d,v){this._calculateTransform(c,d,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,d,v){v.length>0&&(this._active=!0);const b=Kd(v,d),E=new p.Point(0,0),M=new p.Point(0,0);let I=0;for(const F in b){const L=b[F],j=this._touches[F];j&&(E._add(L),M._add(L.sub(j)),I++,b[F]=L)}if(this._touches=b,I<this._minTouches||!M.mag())return;const k=M.div(I);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(I),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Xt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class fu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,d,v){return{}}touchstart(c,d,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([d[0],d[1]]))}touchmove(c,d,v){const b=this._firstTwoTouches;if(!b)return;c.preventDefault();const[E,M]=b,I=Ml(v,d,E),k=Ml(v,d,M);if(!I||!k)return;const F=this._aroundCenter?null:I.add(k).div(2);return this._move([I,k],F,c)}touchend(c,d,v){if(!this._firstTwoTouches)return;const[b,E]=this._firstTwoTouches,M=Ml(v,d,b),I=Ml(v,d,E);M&&I||(this._active&&Fo(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ml(g,c,d){for(let v=0;v<g.length;v++)if(g[v].identifier===d)return c[v]}function ef(g,c){return Math.log(g/c)/Math.LN2}class Eo extends fu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,d){const v=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(ef(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ef(this._distance,v),pinchAround:d}}}function Ch(g,c){return 180*g.angleWith(c)/Math.PI}class tf extends fu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,d){const v=this._vector;if(this._vector=c[0].sub(c[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ch(this._vector,v),pinchAround:d}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const d=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const b=Ch(c,v);return Math.abs(b)<d}}function _i(g){return Math.abs(g.y)>Math.abs(g.x)}class Pp extends fu{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,_i(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,d,v){const b=this._lastPoints;if(!b)return;const E=c[0].sub(b[0]),M=c[1].sub(b[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(E,M,v.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(E.y+M.y)/2*-.5})}gestureBeginsVertically(c,d,v){if(void 0!==this._valid)return this._valid;const b=c.mag()>=2,E=d.mag()>=2;if(!b&&!E)return;if(!b||!E)return null==this._firstMove&&(this._firstMove=v),v-this._firstMove<100&&void 0;const M=c.y>0==d.y>0;return _i(c)&&_i(d)&&M}}const pu={panStep:100,bearingStep:15,pitchStep:10};class Do{constructor(){const c=pu;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let d=0,v=0,b=0,E=0,M=0;switch(c.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:c.shiftKey?v=-1:(c.preventDefault(),E=-1);break;case 39:c.shiftKey?v=1:(c.preventDefault(),E=1);break;case 38:c.shiftKey?b=1:(c.preventDefault(),M=-1);break;case 40:c.shiftKey?b=-1:(c.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(v=0,b=0),{cameraAnimation:I=>{const k=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:kp,zoom:d?Math.round(k)+d*(c.shiftKey?2:1):k,bearing:I.getBearing()+v*this._bearingStep,pitch:I.getPitch()+b*this._pitchStep,offset:[-E*this._panStep,-M*this._panStep],center:I.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kp(g){return g*(2-g)}const Eh=4.000244140625;class Il{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=c.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const v=p.exported.now(),b=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,0!==d&&d%Eh==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),c.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=c,this._delta-=d,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=ro(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const k="wheel"===this._type&&Math.abs(this._delta)>Eh?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&0!==F&&(F=1/F);const L=d(),j=Math.pow(2,L),q="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(q*F))),"wheel"===this._type&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._delta=0}const v="number"==typeof this._targetZoom?this._targetZoom:d(),b=this._startZoom,E=this._easing;let M,I=!1;if("wheel"===this._type&&b&&E){const k=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),F=E(k);M=p.number(b,v,F),k<1?this._frameId||(this._frameId=!0):I=!0}else M=v,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:M-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let d=p.ease;if(this._prevEase){const v=this._prevEase,b=(p.exported.now()-v.start)/v.duration,E=v.easing(b+.01)-v.easing(b),M=.27/Math.sqrt(E*E+1e-4)*.01,I=Math.sqrt(.0729-M*M);d=p.bezier(M,I,.25,1)}return this._prevEase={start:p.exported.now(),duration:c,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Xt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Zr{constructor(c,d){this._clickZoom=c,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,d){return c.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(c.shiftKey?-1:1),around:v.unproject(d)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dh{constructor(){this._tap=new la({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,d,v){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=d[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(c,d,v))}touchmove(c,d,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const b=d[0],E=b.y-this._swipePoint.y;return this._swipePoint=b,c.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(c,d,v)}touchend(c,d,v){this._tapTime?this._swipePoint&&0===v.length&&this.reset():this._tap.touchend(c,d,v)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rp{constructor(c,d,v){this._el=c,this._mousePan=d,this._touchPan=v}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ba{constructor(c,d,v){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=d,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Op{constructor(c,d,v,b){this._el=c,this._touchZoom=d,this._touchRotate=v,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ho=g=>g.zoom||g.drag||g.pitch||g.rotate;class rn extends p.Event{}class Lp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,d){const v=p.sub([],d,c);this.radius=p.length(v[2]<0?p.div([],v,this.constants):[v[0],v[1],0])}projectRay(c){p.div(c,c,this.constants),p.normalize(c,c),p.mul$1(c,c,this.constants);const d=p.scale$2([],c,this.radius);if(d[2]>0){const v=p.scale$2([],[0,0,1],p.dot(d,[0,0,1])),b=p.scale$2([],p.normalize([],[d[0],d[1],0]),this.radius),E=p.add([],d,p.scale$2([],p.sub([],p.add([],b,v),d),2));d[0]=E[0],d[1]=E[1]}return d}}function Os(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Ls{constructor(c,d){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cg(c),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Lp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),p.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[b,E,M]of this._listeners)b.addEventListener(E,b===p.window.document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[c,d,v]of this._listeners)c.removeEventListener(d,c===p.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(c){const d=this._map,v=d.getCanvasContainer();this._add("mapEvent",new bh(d,c));const b=d.boxZoom=new Eg(d,c);this._add("boxZoom",b);const E=new Dg,M=new Rr;d.doubleClickZoom=new Zr(M,E),this._add("tapZoom",E),this._add("clickZoom",M);const I=new Dh;this._add("tapDragZoom",I);const k=d.touchPitch=new Pp(d);this._add("touchPitch",k);const F=new Qd(c),L=new wh(c);d.dragRotate=new Ba(c,F,L),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const j=new Jd(c),q=new du(d,c);d.dragPan=new Rp(v,j,q),this._add("mousePan",j),this._add("touchPan",q,["touchZoom","touchRotate"]);const K=new tf,Q=new Eo;d.touchZoomRotate=new Op(v,Q,K,I),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new uu(d));const J=d.scrollZoom=new Il(d,this);this._add("scrollZoom",J,["mousePan"]);const ee=d.keyboard=new Do;this._add("keyboard",ee);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[U]&&d[U].enable(c[U])}_add(c,d,v){this._handlers.push({handlerName:c,handler:d,allowed:v}),this._handlersById[c]=d}stop(c){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ho(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,d,v){for(const b in c)if(b!==v&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const d=[];for(const v of c)this._el.contains(v.target)&&d.push(v);return d}handleEvent(c,d){this._updatingCamera=!0;const v="renderFrame"===c.type,b=v?void 0:c,E={needsRenderFrame:!1},M={},I={},k=c.touches?this._getMapTouches(c.touches):void 0,F=k?al(this._el,k):v?void 0:ro(this._el,c);for(const{handlerName:q,handler:K,allowed:Q}of this._handlers){if(!K.isEnabled())continue;let J;this._blockedByActive(I,Q,q)?K.reset():K[d||c.type]&&(J=K[d||c.type](c,F,k),this.mergeHandlerResult(E,M,J,q,b),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||K.isActive())&&(I[q]=K)}const L={};for(const q in this._previousActiveHandlers)I[q]||(L[q]=b);this._previousActiveHandlers=I,(Object.keys(L).length||Os(E))&&(this._changes.push([E,M,L]),this._triggerRenderFrame()),(Object.keys(I).length||Os(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=E;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(c,d,v,b,E){if(!v)return;p.extend(c,v);const M={handlerName:b,originalEvent:v.originalEvent||E};void 0!==v.zoomDelta&&(d.zoom=M),void 0!==v.panDelta&&(d.drag=M),void 0!==v.pitchDelta&&(d.pitch=M),void 0!==v.bearingDelta&&(d.rotate=M)}_applyChanges(){const c={},d={},v={};for(const[b,E,M]of this._changes)b.panDelta&&(c.panDelta=(c.panDelta||new p.Point(0,0))._add(b.panDelta)),b.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(c.around=b.around),void 0!==b.aroundCoord&&(c.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(c.pinchAround=b.pinchAround),b.noInertia&&(c.noInertia=b.noInertia),p.extend(d,E),p.extend(v,M);this._updateMapTransform(c,d,v),this._changes=[]}_updateMapTransform(c,d,v){const b=this._map,E=b.transform,M=Y=>[Y.x,Y.y,Y.z];if((Y=>{const ie=this._eventsInProgress.drag;return ie&&!this._handlersById[ie.handlerName].isActive()})()&&!Os(c)){const Y=E.zoom;E.cameraElevationReference="sea",E.recenterOnTerrain(),E.cameraElevationReference="ground",Y!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&b._stop(!0),!Os(c))return void this._fireEvents(d,v,!0);let{panDelta:I,zoomDelta:k,bearingDelta:F,pitchDelta:L,around:j,aroundCoord:q,pinchAround:K}=c;E._isCameraConstrained&&(k>0&&(k=0),E._isCameraConstrained=!1),void 0!==K&&(j=K),(k||(Y=>d[Y]&&!this._eventsInProgress[Y])("drag"))&&j&&(this._dragOrigin=M(E.pointCoordinate3D(j)),this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",b._stop(!0),j=j||b.transform.centerPoint,F&&(E.bearing+=F),L&&(E.pitch+=L),E._updateCameraState();const Q=[0,0,0];if(I)if("mercator"===E.projection.name){const Y=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(j).dir),ie=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(j.sub(I)).dir);Q[0]=ie[0]-Y[0],Q[1]=ie[1]-Y[1]}else{const Y=E.pointCoordinate(j);if("globe"===E.projection.name){I=I.rotate(-E.angle);const ie=E._pixelsPerMercatorPixel/E.worldSize;Q[0]=-I.x*p.mercatorScale(p.latFromMercatorY(Y.y))*ie,Q[1]=-I.y*p.mercatorScale(E.center.lat)*ie}else{const ie=E.pointCoordinate(j.sub(I));Y&&ie&&(Q[0]=ie.x-Y.x,Q[1]=ie.y-Y.y)}}const J=E.zoom,ee=[0,0,0];if(k){const Y=M(q||E.pointCoordinate3D(j)),ie={dir:p.normalize([],p.sub([],Y,E._camera.position))};if(ie.dir[2]<0){const re=E.zoomDeltaToMovement(Y,k);p.scale$2(ee,ie.dir,re)}}const U=p.add(Q,Q,ee);E._translateCameraConstrained(U),k&&Math.abs(E.zoom-J)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(d,v,!0)}_fireEvents(c,d,v){const b=ho(this._eventsInProgress),E=ho(c),M={};for(const L in c){const{originalEvent:j}=c[L];this._eventsInProgress[L]||(M[`${L}start`]=j),this._eventsInProgress[L]=c[L]}!b&&E&&this._fireEvent("movestart",E.originalEvent);for(const L in M)this._fireEvent(L,M[L]);E&&this._fireEvent("move",E.originalEvent);for(const L in c){const{originalEvent:j}=c[L];this._fireEvent(L,j)}const I={};let k;for(const L in this._eventsInProgress){const{handlerName:j,originalEvent:q}=this._eventsInProgress[L];this._handlersById[j].isActive()||(delete this._eventsInProgress[L],k=d[j]||q,I[`${L}end`]=k)}for(const L in I)this._fireEvent(L,I[L]);const F=ho(this._eventsInProgress);if(v&&(b||E)&&!F){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=q=>0!==q&&-this._bearingSnap<q&&q<this._bearingSnap;L?(j(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:k})):(this._map.fire(new p.Event("moveend",{originalEvent:k})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,d){this._map.fire(new p.Event(c,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new rn("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Al="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Th extends p.Evented{constructor(c,d){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=!1!==d.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,d){return this.jumpTo({center:c},d)}panBy(c,d,v){return c=p.Point.convert(c).mult(-1),this.panTo(this.transform.center,p.extend({offset:c},d),v)}panTo(c,d,v){return this.easeTo(p.extend({center:c},d),v)}getZoom(){return this.transform.zoom}setZoom(c,d){return this.jumpTo({zoom:c},d),this}zoomTo(c,d,v){return this.easeTo(p.extend({zoom:c},d),v)}zoomIn(c,d){return this.zoomTo(this.getZoom()+1,c,d),this}zoomOut(c,d){return this.zoomTo(this.getZoom()-1,c,d),this}getBearing(){return this.transform.bearing}setBearing(c,d){return this.jumpTo({bearing:c},d),this}getPadding(){return this.transform.padding}setPadding(c,d){return this.jumpTo({padding:c},d),this}rotateTo(c,d,v){return this.easeTo(p.extend({bearing:c},d),v)}resetNorth(c,d){return this.rotateTo(0,p.extend({duration:1e3},c),d),this}resetNorthPitch(c,d){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},c),d),this}snapToNorth(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this}getPitch(){return this.transform.pitch}setPitch(c,d){return this.jumpTo({pitch:c},d),this}cameraForBounds(c,d){c=p.LngLatBounds.convert(c);const v=d&&d.bearing||0,b=d&&d.pitch||0,E=c.getNorthWest(),M=c.getSouthEast();return this._cameraForBounds(this.transform,E,M,v,b,d)}_extendCameraOptions(c){const d={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=p.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const v=c.padding;c.padding={top:v,bottom:v,right:v,left:v}}return c.padding=p.extend(d,c.padding),c}_minimumAABBFrustumDistance(c,d){const v=d.max[0]-d.min[0],b=d.max[1]-d.min[1];return v/b>c.aspect?v/(2*Math.tan(.5*c.fovX)*c.aspect):b/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,d,v,b,E,M){const I=c.clone(),k=this._extendCameraOptions(M);I.bearing=b,I.pitch=E;const F=p.LngLat.convert(d),L=p.LngLat.convert(v),j=.5*(F.lat+L.lat),q=.5*(F.lng+L.lng),K=p.latLngToECEF(j,q),Q=p.normalize([],K),J=p.normalize([],p.cross([],Q,[0,1,0])),ee=p.cross([],J,Q),U=[J[0],J[1],J[2],0,ee[0],ee[1],ee[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],Y=[K,p.latLngToECEF(F.lat,F.lng),p.latLngToECEF(L.lat,F.lng),p.latLngToECEF(L.lat,L.lng),p.latLngToECEF(F.lat,L.lng),p.latLngToECEF(j,F.lng),p.latLngToECEF(j,L.lng),p.latLngToECEF(F.lat,q),p.latLngToECEF(L.lat,q)];let ie=p.Aabb.fromPoints(Y.map($e=>[p.dot(J,$e),p.dot(ee,$e),p.dot(Q,$e)]));const re=p.transformMat4([],ie.center,U);0===p.squaredLength(re)&&p.set(re,0,0,1),p.normalize(re,re),p.scale$2(re,re,p.GLOBE_RADIUS),I.center=p.ecefToLatLng(re);const fe=I.getWorldToCameraMatrix(),ge=p.invert(new Float64Array(16),fe);ie=p.Aabb.applyTransform(ie,p.multiply([],fe,U)),p.transformMat4(re,re,fe);const de=.5*(ie.max[2]-ie.min[2]),be=this._minimumAABBFrustumDistance(I,ie),xe=p.scale$2([],[0,0,1],de),Ie=p.add(xe,re,xe),Xe=be+(0===I.pitch?0:p.distance(re,Ie)),Te=I.globeCenterInViewSpace,je=p.sub([],re,[Te[0],Te[1],Te[2]]);p.normalize(je,je),p.scale$2(je,je,Xe);const Pe=p.add([],re,je);p.transformMat4(Pe,Pe,ge);const We=p.earthRadius/p.GLOBE_RADIUS,Se=p.length(Pe),Ne=p.mercatorZfromAltitude(Math.max(Se*We-p.earthRadius,Number.EPSILON),0),Ye=Math.min(I.zoomFromMercatorZAdjusted(Ne),k.maxZoom);return Ye>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"mercator"}),I.zoom=Ye,this._cameraForBounds(I,d,v,b,E,M)):{center:I.center,zoom:Ye,bearing:b,pitch:E}}queryTerrainElevation(c,d){const v=this.transform.elevation;return v?(d=p.extend({},{exaggerated:!0},d),v.getAtPoint(p.MercatorCoordinate.fromLngLat(c),null,d.exaggerated)):null}_cameraForBounds(c,d,v,b,E,M){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,d,v,b,E,M);const I=c.clone(),k=this._extendCameraOptions(M),F=I.padding;I.bearing=b,I.pitch=E;const L=p.LngLat.convert(d),j=p.LngLat.convert(v),q=new p.LngLat(L.lng,j.lat),K=new p.LngLat(j.lng,L.lat),Q=I.project(L),J=I.project(j),ee=this.queryTerrainElevation(L),U=this.queryTerrainElevation(j),Y=this.queryTerrainElevation(q),ie=this.queryTerrainElevation(K),re=[[Q.x,Q.y,Math.min(ee||0,U||0,Y||0,ie||0)],[J.x,J.y,Math.max(ee||0,U||0,Y||0,ie||0)]];let fe=p.Aabb.fromPoints(re);const ge=I.getWorldToCameraMatrix(),de=p.invert(new Float64Array(16),ge);fe=p.Aabb.applyTransform(fe,ge);const be=p.sub([],fe.max,fe.min),xe=F.left||0,Ie=F.right||0,Xe=F.bottom||0,Te=F.top||0,{left:je,right:Pe,top:We,bottom:Se}=k.padding,Ne=.5*(xe+Ie),Ye=.5*(Te+Xe),$e=Math.min(I.scaleZoom(I.scale*Math.min((I.width-(xe+Ie+je+Pe))/be[0],(I.height-(Xe+Te+Se+We))/be[1])),k.maxZoom),qe=I.scale/I.zoomScale($e);fe=new p.Aabb([fe.min[0]-(je+Ne)*qe,fe.min[1]-(Se+Ye)*qe,fe.min[2]],[fe.max[0]+(Pe+Ne)*qe,fe.max[1]+(We+Ye)*qe,fe.max[2]]);const _t=.5*be[2],zt=this._minimumAABBFrustumDistance(I,fe),mt=[0,0,1,0];p.transformMat4$1(mt,mt,ge),p.normalize$2(mt,mt);const Tt=p.scale$2([],mt,zt+_t),dn=p.add([],fe.center,Tt),sn=("number"==typeof k.offset.x&&"number"==typeof k.offset.y?new p.Point(k.offset.x,k.offset.y):p.Point.convert(k.offset)).rotate(-p.degToRad(b));fe.center[0]-=sn.x*qe,fe.center[1]+=sn.y*qe,p.transformMat4(fe.center,fe.center,de),p.transformMat4(dn,dn,de);const vt=[fe.center[0],fe.center[1],dn[2]*I.pixelsPerMeter];p.scale$2(vt,vt,1/I.worldSize);const Ln=p.lngFromMercatorX(vt[0]),Jn=p.latFromMercatorY(vt[1]),Fn=Math.min(I._zoomFromMercatorZ(vt[2]),k.maxZoom),jn=new p.LngLat(Ln,Jn);return I.mercatorFromTransition&&Fn<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"globe"}),I.zoom=Fn,this._cameraForBounds(I,d,v,b,E,M)):{center:jn,zoom:Fn,bearing:b,pitch:E}}fitBounds(c,d,v){const b=this.cameraForBounds(c,d);return this._fitInternal(b,d,v)}fitScreenCoordinates(c,d,v,b,E){const M=p.Point.convert(c),I=p.Point.convert(d),k=new p.Point(Math.min(M.x,I.x),Math.min(M.y,I.y)),F=new p.Point(Math.max(M.x,I.x),Math.max(M.y,I.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(M,I))return this;const L=this.transform.pointLocation3D(k),j=this.transform.pointLocation3D(F),q=this.transform.pointLocation3D(new p.Point(k.x,F.y)),K=this.transform.pointLocation3D(new p.Point(F.x,k.y)),Q=[Math.min(L.lng,j.lng,q.lng,K.lng),Math.min(L.lat,j.lat,q.lat,K.lat)],J=[Math.max(L.lng,j.lng,q.lng,K.lng),Math.max(L.lat,j.lat,q.lat,K.lat)],ee=b&&b.pitch?b.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,Q,J,v,ee,b);return this._fitInternal(U,b,E)}_fitInternal(c,d,v){return c?(delete(d=p.extend(c,d)).padding,d.linear?this.easeTo(d,v):this.flyTo(d,v)):this}jumpTo(c,d){this.stop();const v=c.preloadOnly?this.transform.clone():this.transform;let b=!1,E=!1,M=!1;return"zoom"in c&&v.zoom!==+c.zoom&&(b=!0,v.zoom=+c.zoom),void 0!==c.center&&(v.center=p.LngLat.convert(c.center)),"bearing"in c&&v.bearing!==+c.bearing&&(E=!0,v.bearing=+c.bearing),"pitch"in c&&v.pitch!==+c.pitch&&(M=!0,v.pitch=+c.pitch),null==c.padding||v.isPaddingEqual(c.padding)||(v.padding=c.padding),c.preloadOnly?(this._preloadTiles(v),this):(this.fire(new p.Event("movestart",d)).fire(new p.Event("move",d)),b&&this.fire(new p.Event("zoomstart",d)).fire(new p.Event("zoom",d)).fire(new p.Event("zoomend",d)),E&&this.fire(new p.Event("rotatestart",d)).fire(new p.Event("rotate",d)).fire(new p.Event("rotateend",d)),M&&this.fire(new p.Event("pitchstart",d)).fire(new p.Event("pitch",d)).fire(new p.Event("pitchend",d)),this.fire(new p.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Al),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,d){const v=this.transform;if(!v.projection.supportsFreeCamera)return p.warnOnce(Al),this;this.stop();const b=v.zoom,E=v.pitch,M=v.bearing;v.setFreeCameraOptions(c);const I=b!==v.zoom,k=E!==v.pitch,F=M!==v.bearing;return this.fire(new p.Event("movestart",d)).fire(new p.Event("move",d)),I&&this.fire(new p.Event("zoomstart",d)).fire(new p.Event("zoom",d)).fire(new p.Event("zoomend",d)),F&&this.fire(new p.Event("rotatestart",d)).fire(new p.Event("rotate",d)).fire(new p.Event("rotateend",d)),k&&this.fire(new p.Event("pitchstart",d)).fire(new p.Event("pitch",d)).fire(new p.Event("pitchend",d)),this.fire(new p.Event("moveend",d)),this}easeTo(c,d){this._stop(!1,c.easeId),(!1===(c=p.extend({offset:[0,0],duration:500,easing:p.ease},c)).animate||this._prefersReducedMotion(c))&&(c.duration=0);const v=this.transform,b=this.getZoom(),E=this.getBearing(),M=this.getPitch(),I=this.getPadding(),k="zoom"in c?+c.zoom:b,F="bearing"in c?this._normalizeBearing(c.bearing,E):E,L="pitch"in c?+c.pitch:M,j="padding"in c?c.padding:v.padding,q=p.Point.convert(c.offset);let K,Q,J;if("globe"===v.projection.name){const xe=p.MercatorCoordinate.fromLngLat(v.center),Ie=q.rotate(-v.angle);xe.x+=Ie.x/v.worldSize,xe.y+=Ie.y/v.worldSize;const Xe=xe.toLngLat(),Te=p.LngLat.convert(c.center||Xe);this._normalizeCenter(Te),K=v.centerPoint.add(Ie),Q=new p.Point(xe.x,xe.y).mult(v.worldSize),J=new p.Point(p.mercatorXfromLng(Te.lng),p.mercatorYfromLat(Te.lat)).mult(v.worldSize).sub(Q)}else{K=v.centerPoint.add(q);const xe=v.pointLocation(K),Ie=p.LngLat.convert(c.center||xe);this._normalizeCenter(Ie),Q=v.project(xe),J=v.project(Ie).sub(Q)}const ee=v.zoomScale(k-b);let U,Y;c.around&&(U=p.LngLat.convert(c.around),Y=v.locationPoint(U));const ie=this._zooming||k!==b,re=this._rotating||E!==F,fe=this._pitching||L!==M,ge=!v.isPaddingEqual(j),de=xe=>Ie=>{if(ie&&(xe.zoom=p.number(b,k,Ie)),re&&(xe.bearing=p.number(E,F,Ie)),fe&&(xe.pitch=p.number(M,L,Ie)),ge&&(xe.interpolatePadding(I,j,Ie),K=xe.centerPoint.add(q)),U)xe.setLocationAtPoint(U,Y);else{const Xe=xe.zoomScale(xe.zoom-b),Te=k>b?Math.min(2,ee):Math.max(.5,ee),je=Math.pow(Te,1-Ie),Pe=xe.unproject(Q.add(J.mult(Ie*je)).mult(Xe));xe.setLocationAtPoint(xe.renderWorldCopies?Pe.wrap():Pe,K)}return c.preloadOnly||this._fireMoveEvents(d),xe};if(c.preloadOnly){const xe=this._emulate(de,c.duration,v);return this._preloadTiles(xe),this}const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=re,this._pitching=fe,this._padding=ge,this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,be),this._ease(de(v),xe=>{v.recenterOnTerrain(),this._afterEase(d,xe)},c),this}_prepareEase(c,d,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||v.moving||this.fire(new p.Event("movestart",c)),this._zooming&&!v.zooming&&this.fire(new p.Event("zoomstart",c)),this._rotating&&!v.rotating&&this.fire(new p.Event("rotatestart",c)),this._pitching&&!v.pitching&&this.fire(new p.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new p.Event("move",c)),this._zooming&&this.fire(new p.Event("zoom",c)),this._rotating&&this.fire(new p.Event("rotate",c)),this._pitching&&this.fire(new p.Event("pitch",c))}_afterEase(c,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,b=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new p.Event("zoomend",c)),b&&this.fire(new p.Event("rotateend",c)),E&&this.fire(new p.Event("pitchend",c)),this.fire(new p.Event("moveend",c))}flyTo(c,d){if(this._prefersReducedMotion(c)){const $e=p.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo($e,d)}this.stop(),c=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},c);const v=this.transform,b=this.getZoom(),E=this.getBearing(),M=this.getPitch(),I=this.getPadding(),k="zoom"in c?p.clamp(+c.zoom,v.minZoom,v.maxZoom):b,F="bearing"in c?this._normalizeBearing(c.bearing,E):E,L="pitch"in c?+c.pitch:M,j="padding"in c?c.padding:v.padding,q=v.zoomScale(k-b),K=p.Point.convert(c.offset);let Q=v.centerPoint.add(K);const J=v.pointLocation(Q),ee=p.LngLat.convert(c.center||J);this._normalizeCenter(ee);const U=v.project(J),Y=v.project(ee).sub(U);let ie=c.curve;const re=Math.max(v.width,v.height),fe=re/q,ge=Y.mag();if("minZoom"in c){const $e=p.clamp(Math.min(c.minZoom,b,k),v.minZoom,v.maxZoom),qe=re/v.zoomScale($e-b);ie=Math.sqrt(qe/ge*2)}const de=ie*ie;function be($e){const qe=(fe*fe-re*re+($e?-1:1)*de*de*ge*ge)/(2*($e?fe:re)*de*ge);return Math.log(Math.sqrt(qe*qe+1)-qe)}function xe($e){return(Math.exp($e)-Math.exp(-$e))/2}function Ie($e){return(Math.exp($e)+Math.exp(-$e))/2}const Xe=be(0);let Te=function($e){return Ie(Xe)/Ie(Xe+ie*$e)},je=function($e){return re*((Ie(Xe)*(xe(qe=Xe+ie*$e)/Ie(qe))-xe(Xe))/de)/ge;var qe},Pe=(be(1)-Xe)/ie;if(Math.abs(ge)<1e-6||!isFinite(Pe)){if(Math.abs(re-fe)<1e-6)return this.easeTo(c,d);const $e=fe<re?-1:1;Pe=Math.abs(Math.log(fe/re))/ie,je=function(){return 0},Te=function(qe){return Math.exp($e*ie*qe)}}c.duration="duration"in c?+c.duration:1e3*Pe/("screenSpeed"in c?+c.screenSpeed/ie:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const We=E!==F,Se=L!==M,Ne=!v.isPaddingEqual(j),Ye=$e=>qe=>{const _t=qe*Pe,zt=1/Te(_t);$e.zoom=1===qe?k:b+$e.scaleZoom(zt),We&&($e.bearing=p.number(E,F,qe)),Se&&($e.pitch=p.number(M,L,qe)),Ne&&($e.interpolatePadding(I,j,qe),Q=$e.centerPoint.add(K));const mt=1===qe?ee:$e.unproject(U.add(Y.mult(je(_t))).mult(zt));return $e.setLocationAtPoint($e.renderWorldCopies?mt.wrap():mt,Q),$e._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(d),$e};if(c.preloadOnly){const $e=this._emulate(Ye,c.duration,v);return this._preloadTiles($e),this}return this._zooming=!0,this._rotating=We,this._pitching=Se,this._padding=Ne,this._prepareEase(d,!1),this._ease(Ye(v),()=>this._afterEase(d),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,d)}if(!c){const v=this.handlers;v&&v.stop(!1)}return this}_ease(c,d,v){!1===v.animate||0===v.duration?(c(1),d()):(this._easeStart=p.exported.now(),this._easeOptions=v,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,d){c=p.wrap(c,-180,180);const v=Math.abs(c-d);return Math.abs(c-360-d)<v&&(c-=360),Math.abs(c+360-d)<v&&(c+=360),c}_normalizeCenter(c){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const v=c.lng-d.center.lng;c.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,d,v){const b=Math.ceil(15*d/1e3),E=[],M=c(v.clone());for(let I=0;I<=b;I++){const k=M(I/b);E.push(k.clone())}return E}}class pt{constructor(c={}){this.options=c,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const d=this.options&&this.options.compact;return this._map=c,this._container=Xt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Xt("button","mapboxgl-ctrl-attrib-button",this._container),Xt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Xt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===d&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,d){const v=this._map._getUIString(`AttributionControl.${d}`);c.setAttribute("aria-label",v),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(c){const v=d.reduce((b,E,M)=>(E.value&&(b+=`${E.key}=${E.value}${M<d.length-1?"&":""}`),b),"?");c.href=`${p.config.FEEDBACK_URL}/${v}#${gh(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._sourceCaches;for(const b in d){const E=d[b];if(E.used){const M=E.getSource();M.attribution&&c.indexOf(M.attribution)<0&&c.push(M.attribution)}}c.sort((b,E)=>b.length-E.length),c=c.filter((b,E)=>{for(let M=E+1;M<c.length;M++)if(c[M].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const v=c.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,c.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class nf{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Xt("div","mapboxgl-ctrl");const d=Xt("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const d in c){const v=c[d].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const d=c[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class rf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const d=++this._id;return this._queue.push({callback:c,id:d,cancelled:!1}),d}remove(c){const d=this._currentlyRunning,v=d?this._queue.concat(d):this._queue;for(const b of v)if(b.id===c)return void(b.cancelled=!0)}run(c=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const v of d)if(!v.cancelled&&(v.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ze(g,c,d){if(g=new p.LngLat(g.lng,g.lat),c){const v=new p.LngLat(g.lng-360,g.lat),b=new p.LngLat(g.lng+360,g.lat),E=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),M=d.locationPoint(g).distSqr(c),I=c.x<0||c.y<0||c.x>d.width||c.y>d.height;d.locationPoint(v).distSqr(c)<M&&(I||Math.abs(v.lng-d.center.lng)<E)?g=v:d.locationPoint(b).distSqr(c)<M&&(I||Math.abs(b.lng-d.center.lng)<E)&&(g=b)}for(;Math.abs(g.lng-d.center.lng)>180;){const v=d.locationPoint(g);if(v.x>=0&&v.y>=0&&v.x<=d.width&&v.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const yn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ot extends p.Evented{constructor(c,d){if(super(),(c instanceof p.window.HTMLElement||d)&&(c=p.extend({element:c},d)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=p.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Xt("div");const b=41,E=27,M=Zi("svg",{display:"block",height:b*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${b}`},this._element),I=Zi("radialGradient",{id:"shadowGradient"},Zi("defs",{},M));Zi("stop",{offset:"10%","stop-opacity":.4},I),Zi("stop",{offset:"100%","stop-opacity":.05},I),Zi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),Zi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),Zi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),Zi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=p.Point.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const v=this._element.classList;for(const b in yn)v.remove(`mapboxgl-marker-anchor-${b}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=p.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const d=c.code,v=c.charCode||c.keyCode;"Space"!==d&&"Enter"!==d&&32!==v&&13!==v||this.togglePopup()}_onMapClick(c){const d=c.originalEvent.target,v=this._element;this._popup&&(d===v||v.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,d=this._pos;if(!c||!d)return!1;const v=c.unproject(d),b=c.getFreeCameraOptions();if(!b.position)return!1;const E=b.position.toLngLat();return E.distanceTo(v)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const d=this._pos;if(!d||d.x<0||d.x>c.transform.width||d.y<0||d.y>c.transform.height)return void this._clearFadeTimer();const v=c.unproject(d);let b;c._showingGlobe()&&p.isLngLatBehindGlobe(c.transform,this._lngLat)?b=0:(b=1-c._queryFogOpacity(v),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${yn[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${d.x}px,${d.y}px)\n        `}_calculateXYTransform(){const c=this._pos,d=this._map,v=this.getPitchAlignment();if(!d||!c||"map"!==v)return"";if(!d._showingGlobe()){const k=d.getPitch();return k?`rotateX(${k}deg)`:""}const b=p.radToDeg(p.globeTiltAtLngLat(d.transform,this._lngLat)),E=c.sub(p.globeCenterToScreenPoint(d.transform)),M=Math.abs(E.x)+Math.abs(E.y);if(0===M)return"";const I=b/M;return`rotateX(${-E.y*I}deg) rotateY(${E.x*I}deg)`}_calculateZTransform(){const c=this._pos,d=this._map;if(!d||!c)return"";let v=0;const b=this.getRotationAlignment();if("map"===b)if(d._showingGlobe()){const E=d.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),M=d.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(E);v=p.radToDeg(Math.atan2(M.y,M.x))-90}else v=-d.getBearing();else if("horizon"===b){const E=p.smoothstep(4,6,d.getZoom()),M=p.globeCenterToScreenPoint(d.transform);M.y+=E*d.transform.height;const I=c.sub(M),k=p.radToDeg(Math.atan2(I.y,I.x));v=(k>90?k-270:k+90)*(1-E)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(c){p.window.cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Ze(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),!0===c?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=p.Point.convert(c),this._update(),this}_onMove(c){const d=this._map;if(!d)return;const v=this._pointerdownPos,b=this._positionDelta;if(v&&b){if(!this._isDragging){const E=this._clickTolerance||d._clickTolerance;if(c.point.dist(v)<E)return;this._isDragging=!0}this._pos=c.point.sub(b),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(c){const d=this._map,v=this._pos;d&&v&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(v),this._pointerdownPos=c.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const d=this._map;return d&&(c?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Fs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},_r=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function sf(g=new p.Point(0,0),c="bottom"){if("number"==typeof g){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(c){case"top":return new p.Point(0,g);case"top-left":return new p.Point(d,d);case"top-right":return new p.Point(-d,d);case"bottom":return new p.Point(0,-g);case"bottom-left":return new p.Point(d,-d);case"bottom-right":return new p.Point(-d,-d);case"left":return new p.Point(g,0);case"right":return new p.Point(-g,0)}return new p.Point(0,0)}return g instanceof p.Point||Array.isArray(g)?p.Point.convert(g):p.Point.convert(g[c]||[0,0])}class Pl{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const d=p.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,d,v){this._start=this.getValue(d),this._end=c,this._startTime=d,this._endTime=d+v}}const us={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Sh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},af={showCompass:!0,showZoom:!0,visualizePitch:!1};class Tg{constructor(c,d,v=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Qd({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,v&&(this.mousePitch=new wh({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(c,d){this.mouseRotate.mousedown(c,d),this.mousePitch&&this.mousePitch.mousedown(c,d),Gc()}move(c,d){const v=this.map,b=this.mouseRotate.mousemoveWindow(c,d),E=b&&b.bearingDelta;if(E&&v.setBearing(v.getBearing()+E),this.mousePitch){const M=this.mousePitch.mousemoveWindow(c,d),I=M&&M.pitchDelta;I&&v.setPitch(v.getPitch()+I)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Jl(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(p.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),ro(this.element,c)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,ro(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=al(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=al(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Fp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Mh={maxWidth:100,unit:"metric"},yr={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},fo={version:p.version,supported:Ds,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends Th{constructor(g){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(g=p.extend({},Sh,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(g.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new cu(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._useWebGL2=g.useWebGL2,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new rf,this._domRenderTaskQueue=new rf,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},us,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Pl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=p.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Ls(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new qd("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,p.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new pt({customAttribution:g.customAttribution})),this._logoControl=new nf,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new p.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new p.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(g,c){if(void 0===c&&(c=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const v=this._controlPositions[c];return-1!==c.indexOf("bottom")?v.insertBefore(d,v.firstChild):v.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(g);return c>-1&&this._controls.splice(c,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),this.fire(new p.Event("resize",g)),c&&this.fire(new p.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(p.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?p.window.navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(c=>"auto"===c?p.window.navigator.language:c):g}setLanguage(g){const c=this._parseLanguage(g);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,c=g.projection.name;let d;"globe"===c&&g.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(g.setMercatorFromTransition(),d=!0):"mercator"===c&&g.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(g.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,c){return this._updateProjection(g||c||{name:"mercator"})}_updateProjection(g){let c;if(c="globe"===g.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const d in this.style._sourceCaches)this.style._sourceCaches[d].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(g){return this.transform.locationPoint3D(p.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(p.Point.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,c,d){if("mouseenter"===g||"mouseover"===g){let v=!1;const b=M=>{const I=c.filter(F=>this.getLayer(F)),k=I.length?this.queryRenderedFeatures(M.point,{layers:I}):[];k.length?v||(v=!0,d.call(this,new gr(g,this,M.originalEvent,{features:k}))):v=!1},E=()=>{v=!1};return{layers:new Set(c),listener:d,delegates:{mousemove:b,mouseout:E}}}if("mouseleave"===g||"mouseout"===g){let v=!1;const b=M=>{const I=c.filter(k=>this.getLayer(k));(I.length?this.queryRenderedFeatures(M.point,{layers:I}):[]).length?v=!0:v&&(v=!1,d.call(this,new gr(g,this,M.originalEvent)))},E=M=>{v&&(v=!1,d.call(this,new gr(g,this,M.originalEvent)))};return{layers:new Set(c),listener:d,delegates:{mousemove:b,mouseout:E}}}{const v=b=>{const E=c.filter(I=>this.getLayer(I)),M=E.length?this.queryRenderedFeatures(b.point,{layers:E}):[];M.length&&(b.features=M,d.call(this,b),delete b.features)};return{layers:new Set(c),listener:d,delegates:{[g]:v}}}}on(g,c,d){if(void 0===d)return super.on(g,c);Array.isArray(c)||(c=[c]);const v=this._createDelegatedListener(g,c,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(v);for(const b in v.delegates)this.on(b,v.delegates[b]);return this}once(g,c,d){if(void 0===d)return super.once(g,c);Array.isArray(c)||(c=[c]);const v=this._createDelegatedListener(g,c,d);for(const b in v.delegates)this.once(b,v.delegates[b]);return this}off(g,c,d){if(void 0===d)return super.off(g,c);c=new Set(Array.isArray(c)?c:[c]);const v=(E,M)=>{if(E.size!==M.size)return!1;for(const I of E)if(!M.has(I))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[g]:void 0;return b&&(E=>{for(let M=0;M<E.length;M++){const I=E[M];if(I.listener===d&&v(I.layers,c)){for(const k in I.delegates)this.off(k,I.delegates[k]);return E.splice(M,1),this}}})(b),this}queryRenderedFeatures(g,c){return this.style?(void 0!==c||void 0===g||g instanceof p.Point||Array.isArray(g)||(c=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(g,c){return this.style.querySourceFeatures(g,c)}isPointOnSurface(g){const{name:c}=this.transform.projection;return"globe"!==c&&"mercator"!==c&&p.warnOnce(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(g))}setStyle(g,c){return!1!==(c=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(g,c))}_getUIString(g){const c=this._locale[g];if(null==c)throw new Error(`Missing UI string '${g}'`);return c}_updateStyle(g,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new wo(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new wo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,c){if("string"==typeof g){const d=this._requestManager.normalizeStyleURL(g),v=this._requestManager.transformRequest(d,p.ResourceType.Style);p.getJSON(v,(b,E)=>{b?this.fire(new p.ErrorEvent(b)):E&&this._updateDiff(E,c)})}else"object"==typeof g&&this._updateDiff(g,c)}_updateDiff(g,c){try{this.style.setState(g)&&this._update(!0)}catch(d){p.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(g,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(g,c){return this._lazyInitEmptyStyle(),this.style.addSource(g,c),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const c in g){const d=g[c]._tiles;for(const v in d){const b=d[v];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(g,c,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,c,d)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,c,{pixelRatio:d=1,sdf:v=!1,stretchX:b,stretchY:E,content:M}={}){if(this._lazyInitEmptyStyle(),c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap){const{width:I,height:k,data:F}=p.exported.getImageData(c);this.style.addImage(g,{data:new p.RGBAImage({width:I,height:k},F),pixelRatio:d,stretchX:b,stretchY:E,content:M,sdf:v,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:k}=c,F=c;this.style.addImage(g,{data:new p.RGBAImage({width:I,height:k},new Uint8Array(F.data)),pixelRatio:d,stretchX:b,stretchY:E,content:M,sdf:v,version:0,userImage:F}),F.onAdd&&F.onAdd(this,g)}}updateImage(g,c){const d=this.style.getImage(g);if(!d)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap?p.exported.getImageData(c):c,{width:b,height:E}=v;void 0!==b&&void 0!==E?b===d.data.width&&E===d.data.height?(d.data.replace(v.data,!(c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap)),this.style.updateImage(g,d)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${b}, ${E})\n                must be that same as the previous version of the image\n                (${d.data.width}, ${d.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,c){p.getImage(this._requestManager.transformRequest(g,p.ResourceType.Image),(d,v)=>{c(d,v instanceof p.window.HTMLImageElement?p.exported.getImageData(v):v)})}listImages(){return this.style.listImages()}addLayer(g,c){return this._lazyInitEmptyStyle(),this.style.addLayer(g,c),this._update(!0)}moveLayer(g,c){return this.style.moveLayer(g,c),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,c,d){return this.style.setLayerZoomRange(g,c,d),this._update(!0)}setFilter(g,c,d={}){return this.style.setFilter(g,c,d),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,c,d,v={}){return this.style.setPaintProperty(g,c,d,v),this._update(!0)}getPaintProperty(g,c){return this.style.getPaintProperty(g,c)}setLayoutProperty(g,c,d,v={}){return this.style.setLayoutProperty(g,c,d,v),this._update(!0)}getLayoutProperty(g,c){return this.style.getLayoutProperty(g,c)}setLight(g,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(g),this.transform):0}setFeatureState(g,c){return this.style.setFeatureState(g,c),this._update()}removeFeatureState(g,c){return this.style.removeFeatureState(g,c),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let d,v,b,E=this._container;for(;E&&(!v||!b);){const M=p.window.getComputedStyle(E).transform;M&&"none"!==M&&(d=M.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&"0"!==d[0]&&"1"!==d[0]&&(v=d[0]),d[3]&&"0"!==d[3]&&"1"!==d[3]&&(b=d[3])),E=E.parentElement}this._containerWidth=v?Math.abs(g/v):g,this._containerHeight=b?Math.abs(c/b):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Xt("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Xt("div","mapboxgl-canvas-container",g);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=Xt("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=Xt("div","mapboxgl-control-container",g),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{v[b]=Xt("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,c){const d=p.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(c),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${c}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const c=this._markers.indexOf(g);-1!==c&&this._markers.splice(c,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const c=this._popups.indexOf(g);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const g=p.extend({},Ds.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",g),d=c||this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);d?(this._useWebGL2&&!c&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(d,!0),this.painter=new El(d,this.transform,!!c),this.on("data",v=>{"source"===v.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(d)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let c;const d=this.painter.context.extTimerQuery,v=p.exported.now();if(this.listens("gpu-timing-frame")&&(c=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,k=this.transform.pitch,F=p.exported.now(),L=new p.EvaluationParameters(I,{now:F,fadeDuration:b,pitch:k,transition:this.style.getTransition()});this.style.update(L)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(v),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const I=p.exported.now()-v;d.endQueryEXT(d.TIME_ELAPSED_EXT,c),setTimeout(()=>{const k=d.getQueryObjectEXT(c,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(c),this.fire(new p.Event("gpu-timing-frame",{cpuTime:I,gpuTime:k})),p.window.performance.mark("frame-gpu",{startTime:v,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(I);this.fire(new p.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(I);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(M||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(E=this._updateAverageElevation(v,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const c of this._markers)g&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!g||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(g,c=!1){const d=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&d(0);if((c||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const v=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),E=!1;this.transform.elevation&&(E=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=g;const M=Math.abs(v-b);if(M>1){if(this._isInitialLoad||E)return this._averageElevation.jumpTo(b),d(b);this._averageElevation.easeTo(b,g,300)}else if(M>1e-4)return this._averageElevation.jumpTo(b),d(b)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===p.AUTH_ERR_MSG||401===g.status)){const c=this.painter.context.gl;p.storeAuthState(c,!1),this._logoControl instanceof nf&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const d=this.painter.context.gl,v=d.createFramebuffer();function b(E){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,E,0);const M=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,M),M}return d.bindFramebuffer(d.FRAMEBUFFER,v),this._canvasPixelComparison(b(g),c.canvasCopies.map(b),c.timeStamps)}_canvasPixelComparison(g,c,d){let v=d[1]-d[0];const b=g.length/4;for(let E=0;E<c.length;E++){const M=c[E];let I=0;for(let k=0;k<M.length;k+=4)M[k]===g[k]&&M[k+1]===g[k+1]&&M[k+2]===g[k+2]&&M[k+3]===g[k+3]&&(I+=1);v+=(d[E+2]-d[E+1])*(1-I/b)}return v}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=p.exported.frame(c=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(c)}))}_preloadTiles(g){const c=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(c,(d,v)=>d._preloadTiles(g,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,c){p.setCacheLimits(g,c)}get version(){return p.version}},NavigationControl:class{constructor(g){this.options=p.extend({},af,g),this._container=Xt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Xt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Xt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:c}):d.resetNorth({},{originalEvent:c}))}),this._compassIcon=Xt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const c=g.getZoom(),d=c===g.getMaxZoom(),v=c===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Tg(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,c){const d=Xt("button",g,this._container);return d.type="button",d.addEventListener("click",c),d}_setButtonTitle(g,c){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${c}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends p.Evented{constructor(g){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},Fp,g),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=_c(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Xt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const c=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,g(d)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(d=>c("denied"!==d.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(g){const c=this._map.getMaxBounds(),d=g.coords;return!!c&&(d.longitude<c.getWest()||d.longitude>c.getEast()||d.latitude<c.getSouth()||d.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",g)),this._finish()}}_updateCamera(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,v=this._map.getBearing(),b=p.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(d),b,{geolocateSource:!0})}_updateMarker(g){if(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,c=p.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,d=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Xt("button","mapboxgl-ctrl-geolocate",this._container),Xt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Xt("div","mapboxgl-user-location"),this._dotElement.appendChild(Xt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Xt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ot({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Xt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ot({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:pt,ScaleControl:class{constructor(g){this.options=p.extend({},Mh,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,c=this._map,d=c._containerHeight/2,v=c._containerWidth/2-g/2,b=c.unproject([v,d]),E=c.unproject([v+g,d]),M=b.distanceTo(E);if("imperial"===this.options.unit){const I=3.2808*M;I>5280?this._setScale(g,I/5280,"mile"):this._setScale(g,I,"foot")}else"nautical"===this.options.unit?this._setScale(g,M/1852,"nautical-mile"):M>=1e3?this._setScale(g,M/1e3,"kilometer"):this._setScale(g,M,"meter")}_setScale(g,c,d){this._map._requestDomTask(()=>{const v=function(E){const M=Math.pow(10,`${Math.floor(E)}`.length-1);let I=E/M;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(k){const F=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*F)/F}(I),M*I}(c),b=v/c;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==d?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(v):`${v}&nbsp;${yr[d]}`,this._container.style.width=g*b+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Xt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof p.window.HTMLElement?this._container=g.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Xt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Xt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Xt("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(g){super(),this.options=p.extend(Object.create(Fs),g),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=p.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(p.window.document.createTextNode(g))}setHTML(g){const c=p.window.document.createDocumentFragment(),d=p.window.document.createElement("body");let v;for(d.innerHTML=g;v=d.firstChild,v;)c.appendChild(v);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Xt("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(g),this.options.closeButton){const d=this._closeButton=Xt("button","mapboxgl-popup-close-button",c);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let c;return this._classList.delete(g)?c=!1:(this._classList.add(g),c=!0),this._updateClassList(),c}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const c=this._map,d=this._container,v=this._pos;if(!c||!d||!v)return"bottom";const b=d.offsetWidth,E=d.offsetHeight,M=v.x<b/2,I=v.x>c.transform.width-b/2;if(v.y+g<E)return M?"top-left":I?"top-right":"top";if(v.y>c.transform.height-E){if(M)return"bottom-left";if(I)return"bottom-right"}return M?"left":I?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),g.className=c.join(" ")}_update(g){const c=this._map,d=this._content;if(!c||!this._lngLat&&!this._trackPointer||!d)return;let v=this._container;if(v||(v=this._container=Xt("div","mapboxgl-popup",c.getContainer()),this._tip=Xt("div","mapboxgl-popup-tip",v),v.appendChild(d)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ze(this._lngLat,this._pos,c.transform)),!this._trackPointer||g){const b=this._pos=this._trackPointer&&g?g:c.project(this._lngLat),E=sf(this.options.offset),M=this._anchor=this._getAnchor(E.y),I=sf(this.options.offset,M),k=b.add(I).round();c._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${yn[M]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&c._showingGlobe()){const b=p.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(_r);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:ot,Style:wo,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:wg,Evented:p.Evented,config:p.config,prewarm:function(){rc().acquire(Ss)},clearPrewarmedResources:function(){const g=$r;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(Ss),$r=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(g){p.config.ACCESS_TOKEN=g},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(g){p.config.API_URL=g},get workerCount(){return Yi.workerCount},set workerCount(g){Yi.workerCount=g},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){p.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){p.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return fo}),Rn}()}},gg=>{gg(gg.s=781)}]);