(self.webpackChunkmap_project=self.webpackChunkmap_project||[]).push([[179],{460:(gg,Yu,Ku)=>{"use strict";function kn(e){return"function"==typeof e}function Od(e){const t=e(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const _g=Od(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,o)=>`${o+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function p(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class Ue{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const l of t)l.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(kn(i))try{i()}catch(l){n=l instanceof _g?l.errors:[l]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const l of o)try{Kt(l)}catch(u){n=n??[],u instanceof _g?n=[...n,...u.errors]:n.push(u)}}if(n)throw new _g(n)}}add(n){var t;if(n&&n!==this)if(this.closed)Kt(n);else{if(n instanceof Ue){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&p(t,n)}remove(n){const{_finalizers:t}=this;t&&p(t,n),n instanceof Ue&&n._removeParent(this)}}Ue.EMPTY=(()=>{const e=new Ue;return e.closed=!0,e})();const Ds=Ue.EMPTY;function Lo(e){return e instanceof Ue||e&&"closed"in e&&kn(e.remove)&&kn(e.add)&&kn(e.unsubscribe)}function Kt(e){kn(e)?e():e.unsubscribe()}const Zt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Zi={setTimeout(e,n,...t){const{delegate:i}=Zi;return i?.setTimeout?i.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=Zi;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function jr(e){Zi.setTimeout(()=>{const{onUnhandledError:n}=Zt;if(!n)throw e;n(e)})}function ns(){}const qs=yo("C",void 0,void 0);function yo(e,n,t){return{kind:e,value:n,error:t}}let Fo=null;function io(e){if(Zt.useDeprecatedSynchronousErrorHandling){const n=!Fo;if(n&&(Fo={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:i}=Fo;if(Fo=null,t)throw i}}else e()}class Zs extends Ue{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Lo(n)&&n.add(this)):this.destination=Ju}static create(n,t,i){return new al(n,t,i)}next(n){this.isStopped?Wc(function Jl(e){return yo("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?Wc(function Gc(e){return yo("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?Wc(qs,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const is=Function.prototype.bind;function st(e,n){return is.call(e,n)}class Ld{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(i){an(i)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(i){an(i)}else an(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){an(t)}}}class al extends Zs{constructor(n,t,i){let o;if(super(),kn(n)||!n)o={next:n??void 0,error:t??void 0,complete:i??void 0};else{let l;this&&Zt.useDeprecatedNextContext?(l=Object.create(n),l.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&st(n.next,l),error:n.error&&st(n.error,l),complete:n.complete&&st(n.complete,l)}):o=n}this.destination=new Ld(o)}}function an(e){Zt.useDeprecatedSynchronousErrorHandling?function sl(e){Zt.useDeprecatedSynchronousErrorHandling&&Fo&&(Fo.errorThrown=!0,Fo.error=e)}(e):jr(e)}function Wc(e,n){const{onStoppedNotification:t}=Zt;t&&Zi.setTimeout(()=>t(e,n))}const Ju={closed:!0,next:ns,error:function or(e){throw e},complete:ns},ll="function"==typeof Symbol&&Symbol.observable||"@@observable";function rs(e){return e}function cl(e){return 0===e.length?rs:1===e.length?e[0]:function(t){return e.reduce((i,o)=>o(i),t)}}let fn=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new e;return i.source=this,i.operator=t,i}subscribe(t,i,o){const l=function ki(e){return e&&e instanceof Zs||function wa(e){return e&&kn(e.next)&&kn(e.error)&&kn(e.complete)}(e)&&Lo(e)}(t)?t:new al(t,i,o);return io(()=>{const{operator:u,source:m}=this;l.add(u?u.call(l,m):m?this._subscribe(l):this._trySubscribe(l))}),l}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=Xi(i))((o,l)=>{const u=new al({next:m=>{try{t(m)}catch(y){l(y),u.unsubscribe()}},error:l,complete:o});this.subscribe(u)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[ll](){return this}pipe(...t){return cl(t)(this)}toPromise(t){return new(t=Xi(t))((i,o)=>{let l;this.subscribe(u=>l=u,u=>o(u),()=>i(l))})}}return e.create=n=>new e(n),e})();function Xi(e){var n;return null!==(n=e??Zt.Promise)&&void 0!==n?n:Promise}const Ca=Od(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let ro=(()=>{class e extends fn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new Xs(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new Ca}next(t){io(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){io(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){io(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:o,observers:l}=this;return i||o?Ds:(this.currentObservers=null,l.push(t),new Ue(()=>{this.currentObservers=null,p(l,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:o,isStopped:l}=this;i?t.error(o):l&&t.complete()}asObservable(){const t=new fn;return t.source=this,t}}return e.create=(n,t)=>new Xs(n,t),e})();class Xs extends ro{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,n)}error(n){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==i?i:Ds}}function Ts(e){return kn(e?.lift)}function gi(e){return n=>{if(Ts(n))return n.lift(function(t){try{return e(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Yn(e,n,t,i,o){return new Ql(e,n,t,i,o)}class Ql extends Zs{constructor(n,t,i,o,l,u){super(n),this.onFinalize=l,this.shouldUnsubscribe=u,this._next=t?function(m){try{t(m)}catch(y){n.error(y)}}:super._next,this._error=o?function(m){try{o(m)}catch(y){n.error(y)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(m){n.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function ht(e,n){return gi((t,i)=>{let o=0;t.subscribe(Yn(i,l=>{i.next(e.call(n,l,o++))}))})}function Bo(e){return this instanceof Bo?(this.v=e,this):new Bo(e)}function Ma(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function oo(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],i=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(l){t[l]=e[l]&&function(u){return new Promise(function(m,y){!function o(l,u,m,y){Promise.resolve(y).then(function(C){l({value:C,done:m})},u)}(m,y,(u=e[l](u)).done,u.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const _e=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function ke(e){return kn(e?.then)}function tt(e){return kn(e[ll])}function it(e){return Symbol.asyncIterator&&kn(e?.[Symbol.asyncIterator])}function Je(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const en=function Gt(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Ut(e){return kn(e?.[en])}function tn(e){return function Ta(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,i=t.apply(e,n||[]),l=[];return o={},u("next"),u("throw"),u("return"),o[Symbol.asyncIterator]=function(){return this},o;function u(z){i[z]&&(o[z]=function(V){return new Promise(function(H,X){l.push([z,V,H,X])>1||m(z,V)})})}function m(z,V){try{!function y(z){z.value instanceof Bo?Promise.resolve(z.value.v).then(C,T):A(l[0][2],z)}(i[z](V))}catch(H){A(l[0][3],H)}}function C(z){m("next",z)}function T(z){m("throw",z)}function A(z,V){z(V),l.shift(),l.length&&m(l[0][0],l[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:i,done:o}=yield Bo(t.read());if(o)return yield Bo(void 0);yield yield Bo(i)}}finally{t.releaseLock()}})}function pn(e){return kn(e?.getReader)}function xn(e){if(e instanceof fn)return e;if(null!=e){if(tt(e))return function Ri(e){return new fn(n=>{const t=e[ll]();if(kn(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(_e(e))return function Dr(e){return new fn(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(ke(e))return function ji(e){return new fn(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,jr)})}(e);if(it(e))return Yi(e);if(Ut(e))return function Ss(e){return new fn(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(pn(e))return function Ur(e){return Yi(tn(e))}(e)}throw Je(e)}function Yi(e){return new fn(n=>{(function rc(e,n){var t,i,o,l;return function Ys(e,n,t,i){return new(t||(t=Promise))(function(l,u){function m(T){try{C(i.next(T))}catch(A){u(A)}}function y(T){try{C(i.throw(T))}catch(A){u(A)}}function C(T){T.done?l(T.value):function o(l){return l instanceof t?l:new t(function(u){u(l)})}(T.value).then(m,y)}C((i=i.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=Ma(e);!(i=yield t.next()).done;)if(n.next(i.value),n.closed)return}catch(u){o={error:u}}finally{try{i&&!i.done&&(l=t.return)&&(yield l.call(t))}finally{if(o)throw o.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function Js(e,n,t,i=0,o=!1){const l=n.schedule(function(){t(),o?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(l),!o)return l}function Lt(e,n,t=1/0){return kn(n)?Lt((i,o)=>ht((l,u)=>n(i,l,o,u))(xn(e(i,o))),t):("number"==typeof n&&(t=n),gi((i,o)=>function wp(e,n,t,i,o,l,u,m){const y=[];let C=0,T=0,A=!1;const z=()=>{A&&!y.length&&!C&&n.complete()},V=X=>C<i?H(X):y.push(X),H=X=>{l&&n.next(X),C++;let oe=!1;xn(t(X,T++)).subscribe(Yn(n,le=>{o?.(le),l?V(le):n.next(le)},()=>{oe=!0},void 0,()=>{if(oe)try{for(C--;y.length&&C<i;){const le=y.shift();u?Js(n,u,()=>H(le)):H(le)}z()}catch(le){n.error(le)}}))};return e.subscribe(Yn(n,V,()=>{A=!0,z()})),()=>{m?.()}}(i,o,e,t)))}function Ia(e=1/0){return Lt(rs,e)}const so=new fn(e=>e.complete());function os(e){return e&&kn(e.schedule)}function ss(e){return e[e.length-1]}function rh(e){return kn(ss(e))?e.pop():void 0}function fl(e){return os(ss(e))?e.pop():void 0}function Ms(e,n=0){return gi((t,i)=>{t.subscribe(Yn(i,o=>Js(i,e,()=>i.next(o),n),()=>Js(i,e,()=>i.complete(),n),o=>Js(i,e,()=>i.error(o),n)))})}function oc(e,n=0){return gi((t,i)=>{i.add(e.schedule(()=>t.subscribe(i),n))})}function Fd(e,n){if(!e)throw new Error("Iterable cannot be null");return new fn(t=>{Js(t,n,()=>{const i=e[Symbol.asyncIterator]();Js(t,n,()=>{i.next().then(o=>{o.done?t.complete():t.next(o.value)})},0,!0)})})}function Li(e,n){return n?function zd(e,n){if(null!=e){if(tt(e))return function ze(e,n){return xn(e).pipe(oc(n),Ms(n))}(e,n);if(_e(e))return function Oi(e,n){return new fn(t=>{let i=0;return n.schedule(function(){i===e.length?t.complete():(t.next(e[i++]),t.closed||this.schedule())})})}(e,n);if(ke(e))return function Qs(e,n){return xn(e).pipe(oc(n),Ms(n))}(e,n);if(it(e))return Fd(e,n);if(Ut(e))return function sr(e,n){return new fn(t=>{let i;return Js(t,n,()=>{i=e[en](),Js(t,n,()=>{let o,l;try{({value:o,done:l}=i.next())}catch(u){return void t.error(u)}l?t.complete():t.next(o)},0,!0)}),()=>kn(i?.return)&&i.return()})}(e,n);if(pn(e))return function Is(e,n){return Fd(tn(e),n)}(e,n)}throw Je(e)}(e,n):xn(e)}function ln(e,n,...t){if(!0===n)return void e();if(!1===n)return;const i=new al({next:()=>{i.unsubscribe(),e()}});return xn(n(...t)).subscribe(i)}function yt(e){for(let n in e)if(e[n]===yt)return n;throw Error("Could not find renamed property on target object.")}function $r(e,n){for(const t in n)n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function Tn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Tn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function nn(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const xo=yt({__forward_ref__:yt});function Hn(e){return e.__forward_ref__=Hn,e.toString=function(){return Tn(this())},e}function Pt(e){return ao(e)?e():e}function ao(e){return"function"==typeof e&&e.hasOwnProperty(xo)&&e.__forward_ref__===Hn}function ii(e){return e&&!!e.\u0275providers}const As="https://g.co/ng/security#xss";class nt extends Error{constructor(n,t){super(Aa(n,t)),this.code=n}}function Aa(e,n){return`NG0${Math.abs(e)}${n?": "+n.trim():""}`}function Jt(e){return"string"==typeof e?e:null==e?"":String(e)}function ea(e,n){throw new nt(-201,!1)}function lo(e,n){null==e&&function Rn(e,n,t,i){throw new Error(`ASSERTION ERROR: ${e}`+(null==i?"":` [Expected=> ${t} ${i} ${n} <=Actual]`))}(n,e,null,"!=")}function At(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ui(e){return{providers:e.providers||[],imports:e.imports||[]}}function bo(e){return ka(e,Vo)||ka(e,_l)}function ka(e,n){return e.hasOwnProperty(n)?e[n]:null}function ac(e){return e&&(e.hasOwnProperty(lc)||e.hasOwnProperty(Jc))?e[lc]:null}const Vo=yt({\u0275prov:yt}),lc=yt({\u0275inj:yt}),_l=yt({ngInjectableDef:yt}),Jc=yt({ngInjectorDef:yt});var Nt=(()=>((Nt=Nt||{})[Nt.Default=0]="Default",Nt[Nt.Host=1]="Host",Nt[Nt.Self=2]="Self",Nt[Nt.SkipSelf=4]="SkipSelf",Nt[Nt.Optional=8]="Optional",Nt))();let cc;function co(e){const n=cc;return cc=e,n}function yl(e,n,t){const i=bo(e);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:t&Nt.Optional?null:void 0!==n?n:void ea(Tn(e))}const hi=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),uc={},Qc="__NG_DI_FLAG__",na="ngTempTokenPath",lh="ngTokenPath",hc=/\n/gm,ia="\u0275",Ra="__source";let Oa;function vl(e){const n=Oa;return Oa=e,n}function eu(e,n=Nt.Default){if(void 0===Oa)throw new nt(-203,!1);return null===Oa?yl(e,void 0,n):Oa.get(e,n&Nt.Optional?null:void 0,n)}function Dt(e,n=Nt.Default){return(function jd(){return cc}()||eu)(Pt(e),n)}function cn(e,n=Nt.Default){return Dt(e,xl(n))}function xl(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function tu(e){const n=[];for(let t=0;t<e.length;t++){const i=Pt(e[t]);if(Array.isArray(i)){if(0===i.length)throw new nt(900,!1);let o,l=Nt.Default;for(let u=0;u<i.length;u++){const m=i[u],y=nu(m);"number"==typeof y?-1===y?o=m.token:l|=y:o=m}n.push(Dt(o,l))}else n.push(Dt(i))}return n}function mn(e,n){return e[Qc]=n,e.prototype[Qc]=n,e}function nu(e){return e[Qc]}function Ps(e){return{toString:e}.toString()}var Sr=(()=>((Sr=Sr||{})[Sr.OnPush=0]="OnPush",Sr[Sr.Default=1]="Default",Sr))(),jo=(()=>{return(e=jo||(jo={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",jo;var e})();const ra={},Bn=[],uh=yt({\u0275cmp:yt}),iu=yt({\u0275dir:yt}),ru=yt({\u0275pipe:yt}),hh=yt({\u0275mod:yt}),Uo=yt({\u0275fac:yt}),dc=yt({__NG_ELEMENT_ID__:yt});let Ap=0;function ks(e){return Ps(()=>{const n=su(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Sr.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,data:e.data||{},encapsulation:e.encapsulation||jo.Emulated,id:"c"+Ap++,styles:e.styles||Bn,_:null,schemas:e.schemas||null,tView:null};mc(t);const i=e.dependencies;return t.directiveDefs=au(i,!1),t.pipeDefs=au(i,!0),t})}function fc(e){return In(e)||pr(e)}function $d(e){return null!==e}function ar(e){return Ps(()=>({type:e.type,bootstrap:e.bootstrap||Bn,declarations:e.declarations||Bn,imports:e.imports||Bn,exports:e.exports||Bn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function ls(e,n){if(null==e)return ra;const t={};for(const i in e)if(e.hasOwnProperty(i)){let o=e[i],l=o;Array.isArray(o)&&(l=o[1],o=o[0]),t[o]=i,n&&(n[o]=l)}return t}function Ft(e){return Ps(()=>{const n=su(e);return mc(n),n})}function Mr(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function In(e){return e[uh]||null}function pr(e){return e[iu]||null}function Ir(e){return e[ru]||null}function Hr(e,n){const t=e[hh]||null;if(!t&&!0===n)throw new Error(`Type ${Tn(e)} does not have '\u0275mod' property.`);return t}function su(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,exportAs:e.exportAs||null,standalone:!0===e.standalone,selectors:e.selectors||Bn,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:ls(e.inputs,n),outputs:ls(e.outputs)}}function mc(e){e.features?.forEach(n=>n(e))}function au(e,n){if(!e)return null;const t=n?Ir:fc;return()=>("function"==typeof e?e():e).map(i=>t(i)).filter($d)}const cs=0,wt=1,un=2,bi=3,Gr=4,La=5,Ki=6,bl=7,li=8,dh=9,fh=10,_n=11,Gd=12,lu=13,Wd=14,oa=15,Ni=16,gc=17,wl=18,lr=19,Fa=20,wo=21,Kn=22,sa=1,Cl=2,El=7,Dl=8,gn=9,Ji=10;function Ar(e){return Array.isArray(e)&&"object"==typeof e[sa]}function Pr(e){return Array.isArray(e)&&!0===e[sa]}function ph(e){return 0!=(4&e.flags)}function za(e){return e.componentOffset>-1}function $o(e){return 1==(1&e.flags)}function Ho(e){return!!e.template}function mh(e){return 0!=(256&e[un])}function aa(e,n){return e.hasOwnProperty(Uo)?e[Uo]:null}class Dg{constructor(n,t,i){this.previousValue=n,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function Wr(){return Tl}function Tl(e){return e.type.prototype.ngOnChanges&&(e.setInput=Qd),Jd}function Jd(){const e=du(this),n=e?.current;if(n){const t=e.previous;if(t===ra)e.previous=n;else for(let i in n)t[i]=n[i];e.current=null,this.ngOnChanges(n)}}function Qd(e,n,t,i){const o=this.declaredInputs[t],l=du(e)||function fu(e,n){return e[wh]=n}(e,{previous:ra,current:null}),u=l.current||(l.current={}),m=l.previous,y=m[o];u[o]=new Dg(y&&y.currentValue,n,m===ra),e[i]=n}Wr.ngInherit=!0;const wh="__ngSimpleChanges__";function du(e){return e[wh]||null}const Co=function(e,n,t){};function _i(e){for(;Array.isArray(e);)e=e[cs];return e}function pu(e,n){return _i(n[e])}function Eo(e,n){return _i(n[e.index])}function Eh(e,n){return e.data[n]}function Ml(e,n){return e[n]}function qr(e,n){const t=n[e];return Ar(t)?t:t[cs]}function Dh(e){return 64==(64&e[un])}function Na(e,n){return null==n?null:e[n]}function Op(e){e[wl]=0}function uo(e,n){e[La]+=n;let t=e,i=e[bi];for(;null!==i&&(1===n&&1===t[La]||-1===n&&0===t[La]);)i[La]+=n,t=i,i=i[bi]}const rn={lFrame:J(null),bindingsEnabled:!0};function pt(){return rn.bindingsEnabled}function Ze(){return rn.lFrame.lView}function yn(){return rn.lFrame.tView}function at(e){return rn.lFrame.contextLView=e,e[li]}function Al(e){return rn.lFrame.contextLView=null,e}function gr(){let e=sf();for(;null!==e&&64===e.type;)e=e.parent;return e}function sf(){return rn.lFrame.currentTNode}function us(e,n){const t=rn.lFrame;t.currentTNode=e,t.isParent=n}function Sh(){return rn.lFrame.isParent}function af(){rn.lFrame.isParent=!1}function _r(){const e=rn.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}function c(){return rn.lFrame.bindingIndex++}function E(e,n){const t=rn.lFrame;t.bindingIndex=t.bindingRootIndex=e,I(n)}function I(e){rn.lFrame.currentDirectiveIndex=e}function L(e){rn.lFrame.currentQueryIndex=e}function j(e){const n=e[wt];return 2===n.type?n.declTNode:1===n.type?e[Ki]:null}function q(e,n,t){if(t&Nt.SkipSelf){let o=n,l=e;for(;!(o=o.parent,null!==o||t&Nt.Host||(o=j(l),null===o||(l=l[oa],10&o.type))););if(null===o)return!1;n=o,e=l}const i=rn.lFrame=Q();return i.currentTNode=n,i.lView=e,!0}function K(e){const n=Q(),t=e[wt];rn.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function Q(){const e=rn.lFrame,n=null===e?null:e.child;return null===n?J(e):n}function J(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function ee(){const e=rn.lFrame;return rn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const U=ee;function Y(){const e=ee();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function fe(){return rn.lFrame.selectedIndex}function ge(e){rn.lFrame.selectedIndex=e}function de(){const e=rn.lFrame;return Eh(e.tView,e.selectedIndex)}function Pe(e,n){for(let t=n.directiveStart,i=n.directiveEnd;t<i;t++){const l=e.data[t].type.prototype,{ngAfterContentInit:u,ngAfterContentChecked:m,ngAfterViewInit:y,ngAfterViewChecked:C,ngOnDestroy:T}=l;u&&(e.contentHooks??(e.contentHooks=[])).push(-t,u),m&&((e.contentHooks??(e.contentHooks=[])).push(t,m),(e.contentCheckHooks??(e.contentCheckHooks=[])).push(t,m)),y&&(e.viewHooks??(e.viewHooks=[])).push(-t,y),C&&((e.viewHooks??(e.viewHooks=[])).push(t,C),(e.viewCheckHooks??(e.viewCheckHooks=[])).push(t,C)),null!=T&&(e.destroyHooks??(e.destroyHooks=[])).push(t,T)}}function We(e,n,t){Ye(e,n,3,t)}function Se(e,n,t,i){(3&e[un])===t&&Ye(e,n,t,i)}function Ne(e,n){let t=e[un];(3&t)===n&&(t&=2047,t+=1,e[un]=t)}function Ye(e,n,t,i){const l=i??-1,u=n.length-1;let m=0;for(let y=void 0!==i?65535&e[wl]:0;y<u;y++)if("number"==typeof n[y+1]){if(m=n[y],null!=i&&m>=i)break}else n[y]<0&&(e[wl]+=65536),(m<l||-1==l)&&($e(e,t,n,y),e[wl]=(4294901760&e[wl])+y+2),y++}function $e(e,n,t,i){const o=t[i]<0,l=t[i+1],m=e[o?-t[i]:t[i]];if(o){if(e[un]>>11<e[wl]>>16&&(3&e[un])===n){e[un]+=2048,Co(4,m,l);try{l.call(m)}finally{Co(5,m,l)}}}else{Co(4,m,l);try{l.call(m)}finally{Co(5,m,l)}}}const qe=-1;class _t{constructor(n,t,i){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}}function Ln(e,n,t){let i=0;for(;i<t.length;){const o=t[i];if("number"==typeof o){if(0!==o)break;i++;const l=t[i++],u=t[i++],m=t[i++];e.setAttribute(n,u,m,l)}else{const l=o,u=t[++i];yr(l)?e.setProperty(n,l,u):e.setAttribute(n,l,u),i++}}return i}function Vn(e){return 3===e||4===e||6===e}function yr(e){return 64===e.charCodeAt(0)}function Si(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let i=0;i<n.length;i++){const o=n[i];"number"==typeof o?t=o:0===t||Do(e,t,o,null,-1===t||2===t?n[++i]:null)}}return e}function Do(e,n,t,i,o){let l=0,u=e.length;if(-1===n)u=-1;else for(;l<e.length;){const m=e[l++];if("number"==typeof m){if(m===n){u=-1;break}if(m>n){u=l-1;break}}}for(;l<e.length;){const m=e[l];if("number"==typeof m)break;if(m===t){if(null===i)return void(null!==o&&(e[l+1]=o));if(i===e[l+1])return void(e[l+2]=o)}l++,null!==i&&l++,null!==o&&l++}-1!==u&&(e.splice(u,0,n),l=u+1),e.splice(l++,0,t),null!==i&&e.splice(l++,0,i),null!==o&&e.splice(l++,0,o)}function hs(e){return e!==qe}function Qn(e){return 32767&e}function bn(e,n){let t=function Gn(e){return e>>16}(e),i=n;for(;t>0;)i=i[oa],t--;return i}let wi=!0;function cr(e){const n=wi;return wi=e,n}const Zr=255,mu=5;let kl=0;const fo={};function ds(e,n){const t=gu(e,n);if(-1!==t)return t;const i=n[wt];i.firstCreatePass&&(e.injectorIndex=n.length,ca(i.data,e),ca(n,null),ca(i.blueprint,null));const o=Rl(e,n),l=e.injectorIndex;if(hs(o)){const u=Qn(o),m=bn(o,n),y=m[wt].data;for(let C=0;C<8;C++)n[l+C]=m[u+C]|y[u+C]}return n[l+8]=o,l}function ca(e,n){e.push(0,0,0,0,0,0,0,0,n)}function gu(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function Rl(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,i=null,o=n;for(;null!==o;){if(i=Ah(o),null===i)return qe;if(t++,o=o[oa],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return qe}function _u(e,n,t){!function la(e,n,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(dc)&&(i=t[dc]),null==i&&(i=t[dc]=kl++);const o=i&Zr;n.data[e+(o>>mu)]|=1<<o}(e,n,t)}function Sg(e,n,t){if(t&Nt.Optional||void 0!==e)return e;ea()}function ov(e,n,t,i){if(t&Nt.Optional&&void 0===i&&(i=null),!(t&(Nt.Self|Nt.Host))){const o=e[dh],l=co(void 0);try{return o?o.get(n,i,t&Nt.Optional):yl(n,i,t&Nt.Optional)}finally{co(l)}}return Sg(i,0,t)}function zp(e,n,t,i=Nt.Default,o){if(null!==e){if(1024&n[un]){const u=function Ag(e,n,t,i,o){let l=e,u=n;for(;null!==l&&null!==u&&1024&u[un]&&!(256&u[un]);){const m=lf(l,u,t,i|Nt.Self,fo);if(m!==fo)return m;let y=l.parent;if(!y){const C=u[wo];if(C){const T=C.get(t,fo,i);if(T!==fo)return T}y=Ah(u),u=u[oa]}l=y}return o}(e,n,t,i,fo);if(u!==fo)return u}const l=lf(e,n,t,i,fo);if(l!==fo)return l}return ov(n,t,i,o)}function lf(e,n,t,i,o){const l=function Ol(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(dc)?e[dc]:void 0;return"number"==typeof n?n>=0?n&Zr:l1:n}(t);if("function"==typeof l){if(!q(n,e,i))return i&Nt.Host?Sg(o,0,i):ov(n,t,i,o);try{const u=l(i);if(null!=u||i&Nt.Optional)return u;ea()}finally{U()}}else if("number"==typeof l){let u=null,m=gu(e,n),y=qe,C=i&Nt.Host?n[Ni][Ki]:null;for((-1===m||i&Nt.SkipSelf)&&(y=-1===m?Rl(e,n):n[m+8],y!==qe&&Mg(i,!1)?(u=n[wt],m=Qn(y),n=bn(y,n)):m=-1);-1!==m;){const T=n[wt];if(cf(l,m,T.data)){const A=sv(m,n,t,u,i,C);if(A!==fo)return A}y=n[m+8],y!==qe&&Mg(i,n[wt].data[m+8]===C)&&cf(l,m,n)?(u=T,m=Qn(y),n=bn(y,n)):m=-1}}return o}function sv(e,n,t,i,o,l){const u=n[wt],m=u.data[e+8],T=function Ih(e,n,t,i,o){const l=e.providerIndexes,u=n.data,m=1048575&l,y=e.directiveStart,T=l>>20,z=o?m+T:e.directiveEnd;for(let V=i?m:m+T;V<z;V++){const H=u[V];if(V<y&&t===H||V>=y&&H.type===t)return V}if(o){const V=u[y];if(V&&Ho(V)&&V.type===t)return y}return null}(m,u,t,null==i?za(m)&&wi:i!=u&&0!=(3&m.type),o&Nt.Host&&l===m);return null!==T?Ba(n,u,T,m):fo}function Ba(e,n,t,i){let o=e[t];const l=n.data;if(function zt(e){return e instanceof _t}(o)){const u=o;u.resolving&&function Yc(e,n){const t=n?`. Dependency path: ${n.join(" > ")} > ${e}`:"";throw new nt(-200,`Circular dependency in DI detected for ${e}${t}`)}(function Nn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Jt(e)}(l[t]));const m=cr(u.canSeeViewProviders);u.resolving=!0;const y=u.injectImpl?co(u.injectImpl):null;q(e,i,Nt.Default);try{o=e[t]=u.factory(void 0,l,e,i),n.firstCreatePass&&t>=i.directiveStart&&function je(e,n,t){const{ngOnChanges:i,ngOnInit:o,ngDoCheck:l}=n.type.prototype;if(i){const u=Tl(n);(t.preOrderHooks??(t.preOrderHooks=[])).push(e,u),(t.preOrderCheckHooks??(t.preOrderCheckHooks=[])).push(e,u)}o&&(t.preOrderHooks??(t.preOrderHooks=[])).push(0-e,o),l&&((t.preOrderHooks??(t.preOrderHooks=[])).push(e,l),(t.preOrderCheckHooks??(t.preOrderCheckHooks=[])).push(e,l))}(t,l[t],n)}finally{null!==y&&co(y),cr(m),u.resolving=!1,U()}}return o}function cf(e,n,t){return!!(t[n+(e>>mu)]&1<<e)}function Mg(e,n){return!(e&Nt.Self||e&Nt.Host&&n)}class yu{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,i){return zp(this._tNode,this._lView,n,xl(i),t)}}function l1(){return new yu(gr(),Ze())}function Xr(e){return Ps(()=>{const n=e.prototype.constructor,t=n[Uo]||Ig(n),i=Object.prototype;let o=Object.getPrototypeOf(e.prototype).constructor;for(;o&&o!==i;){const l=o[Uo]||Ig(o);if(l&&l!==t)return l;o=Object.getPrototypeOf(o)}return l=>new l})}function Ig(e){return ao(e)?()=>{const n=Ig(Pt(e));return n&&n()}:aa(e)}function Ah(e){const n=e[wt],t=n.type;return 2===t?n.declTNode:1===t?e[Ki]:null}const po="__parameters__";function Ph(e,n,t){return Ps(()=>{const i=function zl(e){return function(...t){if(e){const i=e(...t);for(const o in i)this[o]=i[o]}}}(n);function o(...l){if(this instanceof o)return i.apply(this,l),this;const u=new o(...l);return m.annotation=u,m;function m(y,C,T){const A=y.hasOwnProperty(po)?y[po]:Object.defineProperty(y,po,{value:[]})[po];for(;A.length<=T;)A.push(null);return(A[T]=A[T]||[]).push(u),y}}return t&&(o.prototype=Object.create(t.prototype)),o.prototype.ngMetadataName=e,o.annotationCls=o,o})}class Mt{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=At({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function ua(e,n){e.forEach(t=>Array.isArray(t)?ua(t,n):n(t))}function yc(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function kh(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function Wo(e,n,t){let i=ha(e,n);return i>=0?e[1|i]=t:(i=~i,function f1(e,n,t,i){let o=e.length;if(o==n)e.push(t,i);else if(1===o)e.push(i,e[0]),e[0]=t;else{for(o--,e.push(e[o-1],e[o]);o>n;)e[o]=e[o-2],o--;e[n]=t,e[n+1]=i}}(e,i,n,t)),i}function vu(e,n){const t=ha(e,n);if(t>=0)return e[1|t]}function ha(e,n){return function Bp(e,n,t){let i=0,o=e.length>>t;for(;o!==i;){const l=i+(o-i>>1),u=e[l<<t];if(n===u)return l<<t;u>n?o=l:i=l+1}return~(o<<t)}(e,n,1)}const Oh=mn(Ph("Optional"),8),So=mn(Ph("SkipSelf"),4);var Yr=(()=>((Yr=Yr||{})[Yr.Important=1]="Important",Yr[Yr.DashCase=2]="DashCase",Yr))();const Cc=new Map;let _v=0;const yf="__ngContext__";function Ci(e,n){Ar(n)?(e[yf]=n[Fa],function yv(e){Cc.set(e[Fa],e)}(n)):e[yf]=n}let Wg;function vf(e,n){return Wg(e,n)}function xf(e){const n=e[bi];return Pr(n)?n[bi]:n}function jh(e){return Hp(e[lu])}function Uh(e){return Hp(e[Gr])}function Hp(e){for(;null!==e&&!Pr(e);)e=e[Gr];return e}function Eu(e,n,t,i,o){if(null!=i){let l,u=!1;Pr(i)?l=i:Ar(i)&&(u=!0,i=i[cs]);const m=_i(i);0===e&&null!==t?null==o?Kg(n,t,m):Tu(n,t,m,o||null,!0):1===e&&null!==t?Tu(n,t,m,o||null,!0):2===e?function $h(e,n,t){const i=Cf(e,n);i&&function E1(e,n,t,i){e.removeChild(n,t,i)}(e,i,n,t)}(n,m,u):3===e&&n.destroyNode(m),null!=l&&function T1(e,n,t,i,o){const l=t[El];l!==_i(t)&&Eu(n,e,i,l,o);for(let m=Ji;m<t.length;m++){const y=t[m];fa(y[wt],y,e,n,i,l)}}(n,e,l,t,o)}}function bf(e,n,t){return e.createElement(n,t)}function Dv(e,n){const t=e[gn],i=t.indexOf(n),o=n[bi];512&n[un]&&(n[un]&=-513,uo(o,-1)),t.splice(i,1)}function Ec(e,n){if(e.length<=Ji)return;const t=Ji+n,i=e[t];if(i){const o=i[gc];null!==o&&o!==e&&Dv(o,i),n>0&&(e[t-1][Gr]=i[Gr]);const l=kh(e,Ji+n);!function w1(e,n){fa(e,n,n[_n],2,null,null),n[cs]=null,n[Ki]=null}(i[wt],i);const u=l[lr];null!==u&&u.detachView(l[wt]),i[bi]=null,i[Gr]=null,i[un]&=-65}return i}function wf(e,n){if(!(128&n[un])){const t=n[_n];t.destroyNode&&fa(e,n,t,3,null,null),function Cv(e){let n=e[lu];if(!n)return Gp(e[wt],e);for(;n;){let t=null;if(Ar(n))t=n[lu];else{const i=n[Ji];i&&(t=i)}if(!t){for(;n&&!n[Gr]&&n!==e;)Ar(n)&&Gp(n[wt],n),n=n[bi];null===n&&(n=e),Ar(n)&&Gp(n[wt],n),t=n&&n[Gr]}n=t}}(n)}}function Gp(e,n){if(!(128&n[un])){n[un]&=-65,n[un]|=128,function C1(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let i=0;i<t.length;i+=2){const o=n[t[i]];if(!(o instanceof _t)){const l=t[i+1];if(Array.isArray(l))for(let u=0;u<l.length;u+=2){const m=o[l[u]],y=l[u+1];Co(4,m,y);try{y.call(m)}finally{Co(5,m,y)}}else{Co(4,o,l);try{l.call(o)}finally{Co(5,o,l)}}}}}(e,n),function Tv(e,n){const t=e.cleanup,i=n[bl];let o=-1;if(null!==t)for(let l=0;l<t.length-1;l+=2)if("string"==typeof t[l]){const u=t[l+3];u>=0?i[o=u]():i[o=-u].unsubscribe(),l+=2}else{const u=i[o=t[l+1]];t[l].call(u)}if(null!==i){for(let l=o+1;l<i.length;l++)(0,i[l])();n[bl]=null}}(e,n),1===n[wt].type&&n[_n].destroy();const t=n[gc];if(null!==t&&Pr(n[bi])){t!==n[bi]&&Dv(t,n);const i=n[lr];null!==i&&i.detachView(e)}!function x1(e){Cc.delete(e[Fa])}(n)}}function Sv(e,n,t){return function Yg(e,n,t){let i=n;for(;null!==i&&40&i.type;)i=(n=i).parent;if(null===i)return t[cs];{const{componentOffset:o}=i;if(o>-1){const{encapsulation:l}=e.data[i.directiveStart+o];if(l===jo.None||l===jo.Emulated)return null}return Eo(i,t)}}(e,n.parent,t)}function Tu(e,n,t,i,o){e.insertBefore(n,t,i,o)}function Kg(e,n,t){e.appendChild(n,t)}function Mv(e,n,t,i,o){null!==i?Tu(e,n,t,i,o):Kg(e,n,t)}function Cf(e,n){return e.parentNode(n)}let Jg,Qp,Dc,Io=function Ua(e,n,t){return 40&e.type?Eo(e,t):null};function Zp(e,n,t,i){const o=Sv(e,i,n),l=n[_n],m=function Wp(e,n,t){return Io(e,n,t)}(i.parent||n[Ki],i,n);if(null!=o)if(Array.isArray(t))for(let y=0;y<t.length;y++)Mv(l,o,t[y],m,!1);else Mv(l,o,t,m,!1);void 0!==Jg&&Jg(l,i,n,t,o)}function Xp(e,n){if(null!==n){const t=n.type;if(3&t)return Eo(n,e);if(4&t)return Ef(-1,e[n.index]);if(8&t){const i=n.child;if(null!==i)return Xp(e,i);{const o=e[n.index];return Pr(o)?Ef(-1,o):_i(o)}}if(32&t)return vf(n,e)()||_i(e[n.index]);{const i=Av(e,n);return null!==i?Array.isArray(i)?i[0]:Xp(xf(e[Ni]),i):Xp(e,n.next)}}return null}function Av(e,n){return null!==n?e[Ni][Ki].projection[n.projection]:null}function Ef(e,n){const t=Ji+e+1;if(t<n.length){const i=n[t],o=i[wt].firstChild;if(null!==o)return Xp(i,o)}return n[El]}function Yp(e,n,t,i,o,l,u){for(;null!=t;){const m=i[t.index],y=t.type;if(u&&0===n&&(m&&Ci(_i(m),i),t.flags|=2),32!=(32&t.flags))if(8&y)Yp(e,n,t.child,i,o,l,!1),Eu(n,e,o,m,l);else if(32&y){const C=vf(t,i);let T;for(;T=C();)Eu(n,e,o,T,l);Eu(n,e,o,m,l)}else 16&y?Pv(e,n,i,t,o,l):Eu(n,e,o,m,l);t=u?t.projectionNext:t.next}}function fa(e,n,t,i,o,l){Yp(t,i,e.firstChild,n,o,l,!1)}function Pv(e,n,t,i,o,l){const u=t[Ni],y=u[Ki].projection[i.projection];if(Array.isArray(y))for(let C=0;C<y.length;C++)Eu(n,e,o,y[C],l);else Yp(e,n,y,u[bi],o,l,!0)}function kv(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function Rv(e,n,t){const{mergedAttrs:i,classes:o,styles:l}=t;null!==i&&Ln(e,n,i),null!==o&&kv(e,n,o),null!==l&&function M1(e,n,t){e.setAttribute(n,"style",t)}(e,n,l)}function nm(e){return function tm(){if(void 0===Dc&&(Dc=null,hi.trustedTypes))try{Dc=hi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Dc}()?.createScriptURL(e)||e}class im{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${As})`}}function $a(e){return e instanceof im?e.changingThisBreaksApplicationSecurity:e}function If(e,n){const t=function t_(e){return e instanceof im&&e.getTypeName()||null}(e);if(null!=t&&t!==n){if("ResourceURL"===t&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${As})`)}return t===n}const O1=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Qi=(()=>((Qi=Qi||{})[Qi.NONE=0]="NONE",Qi[Qi.HTML=1]="HTML",Qi[Qi.STYLE=2]="STYLE",Qi[Qi.SCRIPT=3]="SCRIPT",Qi[Qi.URL=4]="URL",Qi[Qi.RESOURCE_URL=5]="RESOURCE_URL",Qi))();function Zh(e){const n=Vl();return n?n.sanitize(Qi.URL,e)||"":If(e,"URL")?$a(e):function om(e){return(e=String(e)).match(O1)?e:"unsafe:"+e}(Jt(e))}function Hv(e){const n=Vl();if(n)return nm(n.sanitize(Qi.RESOURCE_URL,e)||"");if(If(e,"ResourceURL"))return nm($a(e));throw new nt(904,!1)}function Vl(){const e=Ze();return e&&e[Gd]}const Ff=new Mt("ENVIRONMENT_INITIALIZER"),a_=new Mt("INJECTOR",-1),qv=new Mt("INJECTOR_DEF_TYPES");class Zv{get(n,t=uc){if(t===uc){const i=new Error(`NullInjectorError: No provider for ${Tn(n)}!`);throw i.name="NullInjectorError",i}return t}}function V1(...e){return{\u0275providers:Xv(0,e),\u0275fromNgModule:!0}}function Xv(e,...n){const t=[],i=new Set;let o;return ua(n,l=>{const u=l;Xh(u,t,[],i)&&(o||(o=[]),o.push(u))}),void 0!==o&&Yv(o,t),t}function Yv(e,n){for(let t=0;t<e.length;t++){const{providers:o}=e[t];cm(o,l=>{n.push(l)})}}function Xh(e,n,t,i){if(!(e=Pt(e)))return!1;let o=null,l=ac(e);const u=!l&&In(e);if(l||u){if(u&&!u.standalone)return!1;o=e}else{const y=e.ngModule;if(l=ac(y),!l)return!1;o=y}const m=i.has(o);if(u){if(m)return!1;if(i.add(o),u.dependencies){const y="function"==typeof u.dependencies?u.dependencies():u.dependencies;for(const C of y)Xh(C,n,t,i)}}else{if(!l)return!1;{if(null!=l.imports&&!m){let C;i.add(o);try{ua(l.imports,T=>{Xh(T,n,t,i)&&(C||(C=[]),C.push(T))})}finally{}void 0!==C&&Yv(C,n)}if(!m){const C=aa(o)||(()=>new o);n.push({provide:o,useFactory:C,deps:Bn},{provide:qv,useValue:o,multi:!0},{provide:Ff,useValue:()=>Dt(o),multi:!0})}const y=l.providers;null==y||m||cm(y,T=>{n.push(T)})}}return o!==e&&void 0!==e.providers}function cm(e,n){for(let t of e)ii(t)&&(t=t.\u0275providers),Array.isArray(t)?cm(t,n):n(t)}const Kv=yt({provide:String,useValue:yt});function um(e){return null!==e&&"object"==typeof e&&Kv in e}function Su(e){return"function"==typeof e}const l_=new Mt("Set Injector scope."),zf={},U1={};let er;function Ko(){return void 0===er&&(er=new Zv),er}class Vs{}class Nf extends Vs{get destroyed(){return this._destroyed}constructor(n,t,i,o){super(),this.parent=t,this.source=i,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,hm(n,u=>this.processProvider(u)),this.records.set(a_,Kh(void 0,this)),o.has("environment")&&this.records.set(Vs,Kh(void 0,this));const l=this.records.get(l_);null!=l&&"string"==typeof l.value&&this.scopes.add(l.value),this.injectorDefTypes=new Set(this.get(qv.multi,Bn,Nt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();for(const n of this._onDestroyHooks)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(n){this._onDestroyHooks.push(n)}runInContext(n){this.assertNotDestroyed();const t=vl(this),i=co(void 0);try{return n()}finally{vl(t),co(i)}}get(n,t=uc,i=Nt.Default){this.assertNotDestroyed(),i=xl(i);const o=vl(this),l=co(void 0);try{if(!(i&Nt.SkipSelf)){let m=this.records.get(n);if(void 0===m){const y=function t0(e){return"function"==typeof e||"object"==typeof e&&e instanceof Mt}(n)&&bo(n);m=y&&this.injectableDefInScope(y)?Kh(Tc(n),zf):null,this.records.set(n,m)}if(null!=m)return this.hydrate(n,m)}return(i&Nt.Self?Ko():this.parent).get(n,t=i&Nt.Optional&&t===uc?null:t)}catch(u){if("NullInjectorError"===u.name){if((u[na]=u[na]||[]).unshift(Tn(n)),o)throw u;return function Ip(e,n,t,i){const o=e[na];throw n[Ra]&&o.unshift(n[Ra]),e.message=function Ud(e,n,t,i=null){e=e&&"\n"===e.charAt(0)&&e.charAt(1)==ia?e.slice(2):e;let o=Tn(n);if(Array.isArray(n))o=n.map(Tn).join(" -> ");else if("object"==typeof n){let l=[];for(let u in n)if(n.hasOwnProperty(u)){let m=n[u];l.push(u+":"+("string"==typeof m?JSON.stringify(m):Tn(m)))}o=`{${l.join(", ")}}`}return`${t}${i?"("+i+")":""}[${o}]: ${e.replace(hc,"\n  ")}`}("\n"+e.message,o,t,i),e[lh]=o,e[na]=null,e}(u,n,"R3InjectorError",this.source)}throw u}finally{co(l),vl(o)}}resolveInjectorInitializers(){const n=vl(this),t=co(void 0);try{const i=this.get(Ff.multi,Bn,Nt.Self);for(const o of i)o()}finally{vl(n),co(t)}}toString(){const n=[],t=this.records;for(const i of t.keys())n.push(Tn(i));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new nt(205,!1)}processProvider(n){let t=Su(n=Pt(n))?n:Pt(n&&n.provide);const i=function H1(e){return um(e)?Kh(void 0,e.useValue):Kh(Yh(e),zf)}(n);if(Su(n)||!0!==n.multi)this.records.get(t);else{let o=this.records.get(t);o||(o=Kh(void 0,zf,!0),o.factory=()=>tu(o.multi),this.records.set(t,o)),t=n,o.multi.push(n)}this.records.set(t,i)}hydrate(n,t){return t.value===zf&&(t.value=U1,t.value=t.factory()),"object"==typeof t.value&&t.value&&function e0(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(n){if(!n.providedIn)return!1;const t=Pt(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}}function Tc(e){const n=bo(e),t=null!==n?n.factory:aa(e);if(null!==t)return t;if(e instanceof Mt)throw new nt(204,!1);if(e instanceof Function)return function $1(e){const n=e.length;if(n>0)throw function vc(e,n){const t=[];for(let i=0;i<e;i++)t.push(n);return t}(n,"?"),new nt(204,!1);const t=function ta(e){return e&&(e[Vo]||e[_l])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new nt(204,!1)}function Yh(e,n,t){let i;if(Su(e)){const o=Pt(e);return aa(o)||Tc(o)}if(um(e))i=()=>Pt(e.useValue);else if(function Qv(e){return!(!e||!e.useFactory)}(e))i=()=>e.useFactory(...tu(e.deps||[]));else if(function Jv(e){return!(!e||!e.useExisting)}(e))i=()=>Dt(Pt(e.useExisting));else{const o=Pt(e&&(e.useClass||e.provide));if(!function G1(e){return!!e.deps}(e))return aa(o)||Tc(o);i=()=>new o(...tu(e.deps))}return i}function Kh(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function hm(e,n){for(const t of e)Array.isArray(t)?hm(t,n):t&&ii(t)?hm(t.\u0275providers,n):n(t)}class ei{}class dm{}class Jh{resolveComponentFactory(n){throw function n0(e){const n=Error(`No component factory found for ${Tn(e)}. Did you add it to @NgModule.entryComponents?`);return n.ngComponent=e,n}(n)}}let Qh=(()=>{class e{}return e.NULL=new Jh,e})();function W1(){return ed(gr(),Ze())}function ed(e,n){return new Ao(Eo(e,n))}let Ao=(()=>{class e{constructor(t){this.nativeElement=t}}return e.__NG_ELEMENT_ID__=W1,e})();class u_{}let jl=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>function Z1(){const e=Ze(),t=qr(gr().index,e);return(Ar(t)?t:e)[_n]}(),e})(),X1=(()=>{class e{}return e.\u0275prov=At({token:e,providedIn:"root",factory:()=>null}),e})();class Bf{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const fm=new Bf("15.2.10"),Mc={},pm="ngOriginalError";function Vf(e){return e[pm]}class td{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&Vf(n);for(;t&&Vf(t);)t=Vf(t);return t||null}}function Ha(e){return e instanceof Function?e():e}function p_(e,n,t){let i=e.length;for(;;){const o=e.indexOf(n,t);if(-1===o)return o;if(0===o||e.charCodeAt(o-1)<=32){const l=n.length;if(o+l===i||e.charCodeAt(o+l)<=32)return o}t=o+1}}const l0="ng-template";function c0(e,n,t){let i=0,o=!0;for(;i<e.length;){let l=e[i++];if("string"==typeof l&&o){const u=e[i++];if(t&&"class"===l&&-1!==p_(u.toLowerCase(),n,0))return!0}else{if(1===l){for(;i<e.length&&"string"==typeof(l=e[i++]);)if(l.toLowerCase()===n)return!0;return!1}"number"==typeof l&&(o=!1)}}return!1}function m_(e){return 4===e.type&&e.value!==l0}function g_(e,n,t){return n===(4!==e.type||t?e.value:l0)}function u0(e,n,t){let i=4;const o=e.attrs||[],l=function f0(e){for(let n=0;n<e.length;n++)if(Vn(e[n]))return n;return e.length}(o);let u=!1;for(let m=0;m<n.length;m++){const y=n[m];if("number"!=typeof y){if(!u)if(4&i){if(i=2|1&i,""!==y&&!g_(e,y,t)||""===y&&1===n.length){if(pa(i))return!1;u=!0}}else{const C=8&i?y:n[++m];if(8&i&&null!==e.attrs){if(!c0(e.attrs,C,t)){if(pa(i))return!1;u=!0}continue}const A=h0(8&i?"class":y,o,m_(e),t);if(-1===A){if(pa(i))return!1;u=!0;continue}if(""!==C){let z;z=A>l?"":o[A+1].toLowerCase();const V=8&i?z:null;if(V&&-1!==p_(V,C,0)||2&i&&C!==z){if(pa(i))return!1;u=!0}}}}else{if(!u&&!pa(i)&&!pa(y))return!1;if(u&&pa(y))continue;u=!1,i=y|1&i}}return pa(i)||u}function pa(e){return 0==(1&e)}function h0(e,n,t,i){if(null===n)return-1;let o=0;if(i||!t){let l=!1;for(;o<n.length;){const u=n[o];if(u===e)return o;if(3===u||6===u)l=!0;else{if(1===u||2===u){let m=n[++o];for(;"string"==typeof m;)m=n[++o];continue}if(4===u)break;if(0===u){o+=4;continue}}o+=l?1:2}return-1}return function p0(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const i=e[t];if("number"==typeof i)return-1;if(i===n)return t;t++}return-1}(n,e)}function Ga(e,n,t=!1){for(let i=0;i<n.length;i++)if(u0(e,n[i],t))return!0;return!1}function g0(e,n){return e?":not("+n.trim()+")":n}function Q1(e){let n=e[0],t=1,i=2,o="",l=!1;for(;t<e.length;){let u=e[t];if("string"==typeof u)if(2&i){const m=e[++t];o+="["+u+(m.length>0?'="'+m+'"':"")+"]"}else 8&i?o+="."+u:4&i&&(o+=" "+u);else""!==o&&!pa(u)&&(n+=g0(l,o),o=""),i=u,l=l||!pa(i);t++}return""!==o&&(n+=g0(l,o)),n}const Qt={};function Rt(e){__(yn(),Ze(),fe()+e,!1)}function __(e,n,t,i){if(!i)if(3==(3&n[un])){const l=e.preOrderCheckHooks;null!==l&&We(n,l,t)}else{const l=e.preOrderHooks;null!==l&&Se(n,l,0,t)}ge(t)}function b0(e,n=null,t=null,i){const o=w0(e,n,t,i);return o.resolveInjectorInitializers(),o}function w0(e,n=null,t=null,i,o=new Set){const l=[t||Bn,V1(e)];return i=i||("object"==typeof e?void 0:Tn(e)),new Nf(l,n||Ko(),i||null,o)}let Wa=(()=>{class e{static create(t,i){if(Array.isArray(t))return b0({name:""},i,t,"");{const o=t.name??"";return b0({name:o},t.parent,t.providers,o)}}}return e.THROW_IF_NOT_FOUND=uc,e.NULL=new Zv,e.\u0275prov=At({token:e,providedIn:"any",factory:()=>Dt(a_)}),e.__NG_ELEMENT_ID__=-1,e})();function Qe(e,n=Nt.Default){const t=Ze();return null===t?Dt(e,n):zp(gr(),t,Pt(e),n)}function M0(e,n){const t=e.contentQueries;if(null!==t)for(let i=0;i<t.length;i+=2){const l=t[i+1];if(-1!==l){const u=e.data[l];L(t[i]),u.contentQueries(2,n[l],l)}}}function Gf(e,n,t,i,o,l,u,m,y,C,T){const A=n.blueprint.slice();return A[cs]=o,A[un]=76|i,(null!==T||e&&1024&e[un])&&(A[un]|=1024),Op(A),A[bi]=A[oa]=e,A[li]=t,A[fh]=u||e&&e[fh],A[_n]=m||e&&e[_n],A[Gd]=y||e&&e[Gd]||null,A[dh]=C||e&&e[dh]||null,A[Ki]=l,A[Fa]=function Ug(){return _v++}(),A[wo]=T,A[Ni]=2==n.type?e[Ni]:A,A}function ud(e,n,t,i,o){let l=e.data[n];if(null===l)l=function ym(e,n,t,i,o){const l=sf(),u=Sh(),y=e.data[n]=function xm(e,n,t,i,o,l){return{type:t,index:i,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:l,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,u?l:l&&l.parent,t,n,i,o);return null===e.firstChild&&(e.firstChild=y),null!==l&&(u?null==l.child&&null!==y.parent&&(l.child=y):null===l.next&&(l.next=y,y.prev=l)),y}(e,n,t,i,o),function v(){return rn.lFrame.inI18n}()&&(l.flags|=32);else if(64&l.type){l.type=t,l.value=i,l.attrs=o;const u=function Pl(){const e=rn.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();l.injectorIndex=null===u?-1:u.injectorIndex}return us(l,!0),l}function Wf(e,n,t,i){if(0===t)return-1;const o=n.length;for(let l=0;l<t;l++)n.push(i),e.blueprint.push(i),e.data.push(null);return o}function T_(e,n,t){K(n);try{const i=e.viewQuery;null!==i&&Kf(1,i,t);const o=e.template;null!==o&&qf(e,n,o,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&M0(e,n),e.staticViewQueries&&Kf(2,e.viewQuery,t);const l=e.components;null!==l&&function ow(e,n){for(let t=0;t<n.length;t++)j0(e,n[t])}(n,l)}catch(i){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),i}finally{n[un]&=-5,Y()}}function Pu(e,n,t,i){const o=n[un];if(128!=(128&o)){K(n);try{Op(n),function g(e){return rn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&qf(e,n,t,2,i);const u=3==(3&o);if(u){const C=e.preOrderCheckHooks;null!==C&&We(n,C,null)}else{const C=e.preOrderHooks;null!==C&&Se(n,C,0,null),Ne(n,0)}if(function B0(e){for(let n=jh(e);null!==n;n=Uh(n)){if(!n[Cl])continue;const t=n[gn];for(let i=0;i<t.length;i++){const o=t[i];512&o[un]||uo(o[bi],1),o[un]|=512}}}(n),function N0(e){for(let n=jh(e);null!==n;n=Uh(n))for(let t=Ji;t<n.length;t++){const i=n[t],o=i[wt];Dh(i)&&Pu(o,i,o.template,i[li])}}(n),null!==e.contentQueries&&M0(e,n),u){const C=e.contentCheckHooks;null!==C&&We(n,C)}else{const C=e.contentHooks;null!==C&&Se(n,C,1),Ne(n,1)}!function S0(e,n){const t=e.hostBindingOpCodes;if(null!==t)try{for(let i=0;i<t.length;i++){const o=t[i];if(o<0)ge(~o);else{const l=o,u=t[++i],m=t[++i];E(u,l),m(2,n[l])}}}finally{ge(-1)}}(e,n);const m=e.components;null!==m&&function I0(e,n){for(let t=0;t<n.length;t++)V0(e,n[t])}(n,m);const y=e.viewQuery;if(null!==y&&Kf(2,y,i),u){const C=e.viewCheckHooks;null!==C&&We(n,C)}else{const C=e.viewHooks;null!==C&&Se(n,C,2),Ne(n,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[un]&=-41,512&n[un]&&(n[un]&=-513,uo(n[bi],-1))}finally{Y()}}}function qf(e,n,t,i,o){const l=fe(),u=2&i;try{ge(-1),u&&n.length>Kn&&__(e,n,Kn,!1),Co(u?2:0,o),t(i,o)}finally{ge(l),Co(u?3:1,o)}}function hd(e,n,t){if(ph(n)){const o=n.directiveEnd;for(let l=n.directiveStart;l<o;l++){const u=e.data[l];u.contentQueries&&u.contentQueries(1,t[l],l)}}}function S_(e,n,t){pt()&&(function Us(e,n,t,i){const o=t.directiveStart,l=t.directiveEnd;za(t)&&function k_(e,n,t){const i=Eo(n,e),o=vm(t),l=e[fh],u=Cm(e,Gf(e,o,null,t.onPush?32:16,i,n,l,l.createRenderer(i,t),null,null,null));e[n.index]=u}(n,t,e.data[o+t.componentOffset]),e.firstCreatePass||ds(t,n),Ci(i,n);const u=t.initialInputs;for(let m=o;m<l;m++){const y=e.data[m],C=Ba(n,e,m,t);Ci(C,n),null!==u&&F0(0,m-o,C,y,0,u),Ho(y)&&(qr(t.index,n)[li]=Ba(n,e,m,t))}}(e,n,t,Eo(t,n)),64==(64&t.flags)&&ma(e,n,t))}function Zf(e,n,t=Eo){const i=n.localNames;if(null!==i){let o=n.index+1;for(let l=0;l<i.length;l+=2){const u=i[l+1],m=-1===u?t(n,e):e[u];e[o++]=m}}}function vm(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=qa(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):n}function qa(e,n,t,i,o,l,u,m,y,C){const T=Kn+i,A=T+o,z=function sw(e,n){const t=[];for(let i=0;i<n;i++)t.push(i<e?null:Qt);return t}(T,A),V="function"==typeof C?C():C;return z[wt]={type:e,blueprint:z,template:t,queries:null,viewQuery:m,declTNode:n,data:z.slice().fill(null,T),bindingStartIndex:T,expandoStartIndex:A,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof l?l():l,pipeRegistry:"function"==typeof u?u():u,firstChild:null,schemas:y,consts:V,incompleteFirstPass:!1}}function A0(e,n,t,i){for(let o in e)if(e.hasOwnProperty(o)){t=null===t?{}:t;const l=e[o];null===i?P0(t,n,o,l):i.hasOwnProperty(o)&&P0(t,n,i[o],l)}return t}function P0(e,n,t,i){e.hasOwnProperty(t)?e[t].push(n,i):e[t]=[n,i]}function A_(e,n,t,i){if(pt()){const o=null===i?null:{"":-1},l=function Za(e,n){const t=e.directiveRegistry;let i=null,o=null;if(t)for(let l=0;l<t.length;l++){const u=t[l];if(Ga(n,u.selectors,!1))if(i||(i=[]),Ho(u))if(null!==u.findHostDirectiveDefs){const m=[];o=o||new Map,u.findHostDirectiveDefs(u,m,o),i.unshift(...m,u),Xa(e,n,m.length)}else i.unshift(u),Xa(e,n,0);else o=o||new Map,u.findHostDirectiveDefs?.(u,i,o),i.push(u)}return null===i?null:[i,o]}(e,t);let u,m;null===l?u=m=null:[u,m]=l,null!==u&&P_(e,n,t,u,o,m),o&&function bm(e,n,t){if(n){const i=e.localNames=[];for(let o=0;o<n.length;o+=2){const l=t[n[o+1]];if(null==l)throw new nt(-301,!1);i.push(n[o],l)}}}(t,i,o)}t.mergedAttrs=Si(t.mergedAttrs,t.attrs)}function P_(e,n,t,i,o,l){for(let C=0;C<i.length;C++)_u(ds(t,n),e,i[C].type);!function O0(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,i.length);for(let C=0;C<i.length;C++){const T=i[C];T.providersResolver&&T.providersResolver(T)}let u=!1,m=!1,y=Wf(e,n,i.length,null);for(let C=0;C<i.length;C++){const T=i[C];t.mergedAttrs=Si(t.mergedAttrs,T.hostAttrs),L0(e,t,n,y,T),R0(y,T,o),null!==T.contentQueries&&(t.flags|=4),(null!==T.hostBindings||null!==T.hostAttrs||0!==T.hostVars)&&(t.flags|=64);const A=T.type.prototype;!u&&(A.ngOnChanges||A.ngOnInit||A.ngDoCheck)&&((e.preOrderHooks??(e.preOrderHooks=[])).push(t.index),u=!0),!m&&(A.ngOnChanges||A.ngDoCheck)&&((e.preOrderCheckHooks??(e.preOrderCheckHooks=[])).push(t.index),m=!0),y++}!function aw(e,n,t){const o=n.directiveEnd,l=e.data,u=n.attrs,m=[];let y=null,C=null;for(let T=n.directiveStart;T<o;T++){const A=l[T],z=t?t.get(A):null,H=z?z.outputs:null;y=A0(A.inputs,T,y,z?z.inputs:null),C=A0(A.outputs,T,C,H);const X=null===y||null===u||m_(n)?null:z0(y,T,u);m.push(X)}null!==y&&(y.hasOwnProperty("class")&&(n.flags|=8),y.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=m,n.inputs=y,n.outputs=C}(e,t,l)}function ma(e,n,t){const i=t.directiveStart,o=t.directiveEnd,l=t.index,u=function M(){return rn.lFrame.currentDirectiveIndex}();try{ge(l);for(let m=i;m<o;m++){const y=e.data[m],C=n[m];I(m),(null!==y.hostBindings||0!==y.hostVars||null!==y.hostAttrs)&&Pc(y,C)}}finally{ge(-1),I(u)}}function Pc(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function Xa(e,n,t){n.componentOffset=t,(e.components??(e.components=[])).push(n.index)}function R0(e,n,t){if(t){if(n.exportAs)for(let i=0;i<n.exportAs.length;i++)t[n.exportAs[i]]=e;Ho(n)&&(t[""]=e)}}function L0(e,n,t,i,o){e.data[i]=o;const l=o.factory||(o.factory=aa(o.type)),u=new _t(l,Ho(o),Qe);e.blueprint[i]=u,t[i]=u,function uw(e,n,t,i,o){const l=o.hostBindings;if(l){let u=e.hostBindingOpCodes;null===u&&(u=e.hostBindingOpCodes=[]);const m=~n.index;(function k0(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(u)!=m&&u.push(m),u.push(t,i,l)}}(e,n,i,Wf(e,t,o.hostVars,Qt),o)}function Ya(e,n,t,i,o,l){const u=Eo(e,n);!function wm(e,n,t,i,o,l,u){if(null==l)e.removeAttribute(n,o,t);else{const m=null==u?Jt(l):u(l,i||"",o);e.setAttribute(n,o,m,t)}}(n[_n],u,l,e.value,t,i,o)}function F0(e,n,t,i,o,l){const u=l[n];if(null!==u){const m=i.setInput;for(let y=0;y<u.length;){const C=u[y++],T=u[y++],A=u[y++];null!==m?i.setInput(t,A,C,T):t[T]=A}}}function z0(e,n,t){let i=null,o=0;for(;o<t.length;){const l=t[o];if(0!==l)if(5!==l){if("number"==typeof l)break;if(e.hasOwnProperty(l)){null===i&&(i=[]);const u=e[l];for(let m=0;m<u.length;m+=2)if(u[m]===n){i.push(l,u[m+1],t[o+1]);break}}o+=2}else o+=2;else o+=4}return i}function R_(e,n,t,i){return[e,!0,!1,n,null,0,i,t,null,null]}function V0(e,n){const t=qr(n,e);if(Dh(t)){const i=t[wt];48&t[un]?Pu(i,t,i.template,t[li]):t[La]>0&&Ka(t)}}function Ka(e){for(let i=jh(e);null!==i;i=Uh(i))for(let o=Ji;o<i.length;o++){const l=i[o];if(Dh(l))if(512&l[un]){const u=l[wt];Pu(u,l,u.template,l[li])}else l[La]>0&&Ka(l)}const t=e[wt].components;if(null!==t)for(let i=0;i<t.length;i++){const o=qr(t[i],e);Dh(o)&&o[La]>0&&Ka(o)}}function j0(e,n){const t=qr(n,e),i=t[wt];(function hw(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])})(i,t),T_(i,t,t[li])}function Cm(e,n){return e[lu]?e[Wd][Gr]=n:e[lu]=n,e[Wd]=n,n}function ku(e){for(;e;){e[un]|=32;const n=xf(e);if(mh(e)&&!n)return e;e=n}return null}function Em(e,n,t,i=!0){const o=n[fh];o.begin&&o.begin();try{Pu(e,n,e.template,t)}catch(u){throw i&&$s(n,u),u}finally{o.end&&o.end()}}function Kf(e,n,t){L(0),n(e,t)}function ga(e){return e[bl]||(e[bl]=[])}function Dm(e){return e.cleanup||(e.cleanup=[])}function $s(e,n){const t=e[dh],i=t?t.get(td,null):null;i&&i.handleError(n)}function Ul(e,n,t,i,o){for(let l=0;l<t.length;){const u=t[l++],m=t[l++],y=n[u],C=e.data[u];null!==C.setInput?C.setInput(y,o,i,m):y[m]=o}}function Jf(e,n,t){let i=t?e.styles:null,o=t?e.classes:null,l=0;if(null!==n)for(let u=0;u<n.length;u++){const m=n[u];"number"==typeof m?l=m:1==l?o=nn(o,m):2==l&&(i=nn(i,m+": "+n[++u]+";"))}t?e.styles=i:e.stylesWithoutHost=i,t?e.classes=o:e.classesWithoutHost=o}function kc(e,n,t,i,o=!1){for(;null!==t;){const l=n[t.index];if(null!==l&&i.push(_i(l)),Pr(l))for(let m=Ji;m<l.length;m++){const y=l[m],C=y[wt].firstChild;null!==C&&kc(y[wt],y,C,i)}const u=t.type;if(8&u)kc(e,n,t.child,i);else if(32&u){const m=vf(t,n);let y;for(;y=m();)i.push(y)}else if(16&u){const m=Av(n,t);if(Array.isArray(m))i.push(...m);else{const y=xf(n[Ni]);kc(y[wt],y,m,i,!0)}}t=o?t.projectionNext:t.next}return i}class Rc{get rootNodes(){const n=this._lView,t=n[wt];return kc(t,n,t.firstChild,[])}constructor(n,t){this._lView=n,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[li]}set context(n){this._lView[li]=n}get destroyed(){return 128==(128&this._lView[un])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[bi];if(Pr(n)){const t=n[Dl],i=t?t.indexOf(this):-1;i>-1&&(Ec(n,i),kh(t,i))}this._attachedToViewContainer=!1}wf(this._lView[wt],this._lView)}onDestroy(n){!function I_(e,n,t,i){const o=ga(n);null===t?o.push(i):(o.push(t),e.firstCreatePass&&Dm(e).push(i,o.length-1))}(this._lView[wt],this._lView,null,n)}markForCheck(){ku(this._cdRefInjectingView||this._lView)}detach(){this._lView[un]&=-65}reattach(){this._lView[un]|=64}detectChanges(){Em(this._lView[wt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new nt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function wv(e,n){fa(e,n,n[_n],2,null,null)}(this._lView[wt],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new nt(902,!1);this._appRef=n}}class $0 extends Rc{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;Em(n[wt],n,n[li],!1)}checkNoChanges(){}get context(){return null}}class O_ extends Qh{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=In(n);return new dd(t,this.ngModule)}}function H0(e){const n=[];for(let t in e)e.hasOwnProperty(t)&&n.push({propName:e[t],templateName:t});return n}class W0{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,i){i=xl(i);const o=this.injector.get(n,Mc,i);return o!==Mc||t===Mc?o:this.parentInjector.get(n,t,i)}}class dd extends dm{get inputs(){return H0(this.componentDef.inputs)}get outputs(){return H0(this.componentDef.outputs)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function _0(e){return e.map(Q1).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,i,o){let l=(o=o||this.ngModule)instanceof Vs?o:o?.injector;l&&null!==this.componentDef.getStandaloneInjector&&(l=this.componentDef.getStandaloneInjector(l)||l);const u=l?new W0(n,l):n,m=u.get(u_,null);if(null===m)throw new nt(407,!1);const y=u.get(X1,null),C=m.createRenderer(null,this.componentDef),T=this.componentDef.selectors[0][0]||"div",A=i?function M_(e,n,t){return e.selectRootElement(n,t===jo.ShadowDom)}(C,i,this.componentDef.encapsulation):bf(C,T,function G0(e){const n=e.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(T)),z=this.componentDef.onPush?288:272,V=qa(0,null,null,1,0,null,null,null,null,null),H=Gf(null,V,null,z,null,null,m,C,y,u,null);let X,oe;K(H);try{const le=this.componentDef;let we,ve=null;le.findHostDirectiveDefs?(we=[],ve=new Map,le.findHostDirectiveDefs(le,we,ve),we.push(le)):we=[le];const Re=function Z0(e,n){const t=e[wt],i=Kn;return e[i]=n,ud(t,i,2,"#host",null)}(H,A),Fe=function X0(e,n,t,i,o,l,u,m){const y=o[wt];!function Y0(e,n,t,i){for(const o of e)n.mergedAttrs=Si(n.mergedAttrs,o.hostAttrs);null!==n.mergedAttrs&&(Jf(n,n.mergedAttrs,!0),null!==t&&Rv(i,t,n))}(i,e,n,u);const C=l.createRenderer(n,t),T=Gf(o,vm(t),null,t.onPush?32:16,o[e.index],e,l,C,m||null,null,null);return y.firstCreatePass&&Xa(y,e,i.length-1),Cm(o,T),o[e.index]=T}(Re,A,le,we,H,m,C);oe=Eh(V,Kn),A&&function F_(e,n,t,i){if(i)Ln(e,t,["ng-version",fm.full]);else{const{attrs:o,classes:l}=function y0(e){const n=[],t=[];let i=1,o=2;for(;i<e.length;){let l=e[i];if("string"==typeof l)2===o?""!==l&&n.push(l,e[++i]):8===o&&t.push(l);else{if(!pa(o))break;o=l}i++}return{attrs:n,classes:t}}(n.selectors[0]);o&&Ln(e,t,o),l&&l.length>0&&kv(e,t,l.join(" "))}}(C,le,A,i),void 0!==t&&function K0(e,n,t){const i=e.projection=[];for(let o=0;o<n.length;o++){const l=t[o];i.push(null!=l?Array.from(l):null)}}(oe,this.ngContentSelectors,t),X=function L_(e,n,t,i,o,l){const u=gr(),m=o[wt],y=Eo(u,o);P_(m,o,u,t,null,i);for(let T=0;T<t.length;T++)Ci(Ba(o,m,u.directiveStart+T,u),o);ma(m,o,u),y&&Ci(y,o);const C=Ba(o,m,u.directiveStart+u.componentOffset,u);if(e[li]=o[li]=C,null!==l)for(const T of l)T(C,n);return hd(m,u,e),C}(Fe,le,we,ve,H,[Qf]),T_(V,H,null)}finally{Y()}return new dw(this.componentType,X,ed(oe,H),H,oe)}}class dw extends ei{constructor(n,t,i,o,l){super(),this.location=i,this._rootLView=o,this._tNode=l,this.instance=t,this.hostView=this.changeDetectorRef=new $0(o),this.componentType=n}setInput(n,t){const i=this._tNode.inputs;let o;if(null!==i&&(o=i[n])){const l=this._rootLView;Ul(l[wt],l,o,n,t),ku(qr(this._tNode.index,l))}}get injector(){return new yu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function Qf(){const e=gr();Pe(Ze()[wt],e)}function ri(e){let n=function Sm(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const i=[e];for(;n;){let o;if(Ho(e))o=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new nt(903,!1);o=n.\u0275dir}if(o){if(t){i.push(o);const u=e;u.inputs=r(e.inputs),u.declaredInputs=r(e.declaredInputs),u.outputs=r(e.outputs);const m=o.hostBindings;m&&f(e,m);const y=o.viewQuery,C=o.contentQueries;if(y&&a(e,y),C&&h(e,C),$r(e.inputs,o.inputs),$r(e.declaredInputs,o.declaredInputs),$r(e.outputs,o.outputs),Ho(o)&&o.data.animation){const T=e.data;T.animation=(T.animation||[]).concat(o.data.animation)}}const l=o.features;if(l)for(let u=0;u<l.length;u++){const m=l[u];m&&m.ngInherit&&m(e),m===ri&&(t=!1)}}n=Object.getPrototypeOf(n)}!function s(e){let n=0,t=null;for(let i=e.length-1;i>=0;i--){const o=e[i];o.hostVars=n+=o.hostVars,o.hostAttrs=Si(o.hostAttrs,t=Si(t,o.hostAttrs))}}(i)}function r(e){return e===ra?{}:e===Bn?[]:e}function a(e,n){const t=e.viewQuery;e.viewQuery=t?(i,o)=>{n(i,o),t(i,o)}:n}function h(e,n){const t=e.contentQueries;e.contentQueries=t?(i,o,l)=>{n(i,o,l),t(i,o,l)}:n}function f(e,n){const t=e.hostBindings;e.hostBindings=t?(i,o)=>{n(i,o),t(i,o)}:n}function $(e){return!!function ce(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function he(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function Ge(e,n,t,i){const o=Ze();return he(o,c(),n)&&(yn(),Ya(de(),o,e,n,t,i)),Ge}function qt(e,n,t,i,o,l,u,m){const y=Ze(),C=yn(),T=e+Kn,A=C.firstCreatePass?function Wn(e,n,t,i,o,l,u,m,y){const C=n.consts,T=ud(n,e,4,u||null,Na(C,m));A_(n,t,T,Na(C,y)),Pe(n,T);const A=T.tView=qa(2,T,i,o,l,n.directiveRegistry,n.pipeRegistry,null,n.schemas,C);return null!==n.queries&&(n.queries.template(n,T),A.queries=n.queries.embeddedTView(T)),T}(T,C,y,n,t,i,o,l,u):C.data[T];us(A,!1);const z=y[_n].createComment("");Zp(C,y,z,A),Ci(z,y),Cm(y,y[T]=R_(z,y,z,A)),$o(A)&&S_(C,y,A),null!=u&&Zf(y,A,m)}function Fn(e){return Ml(function Tg(){return rn.lFrame.contextLView}(),Kn+e)}function xt(e,n,t){const i=Ze();return he(i,c(),n)&&function ko(e,n,t,i,o,l,u,m){const y=Eo(n,t);let T,C=n.inputs;!m&&null!=C&&(T=C[i])?(Ul(e,t,T,i,o),za(n)&&function cw(e,n){const t=qr(n,e);16&t[un]||(t[un]|=32)}(t,n.index)):3&n.type&&(i=function lw(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(i),o=null!=u?u(o,n.value||"",i):o,l.setProperty(y,i,o))}(yn(),de(),i,e,n,i[_n],t,!1),xt}function di(e,n,t,i,o){const u=o?"class":"style";Ul(e,t,n.inputs[u],u,i)}function ft(e,n,t,i){const o=Ze(),l=yn(),u=Kn+e,m=o[_n],y=l.firstCreatePass?function Bi(e,n,t,i,o,l){const u=n.consts,y=ud(n,e,2,i,Na(u,o));return A_(n,t,y,Na(u,l)),null!==y.attrs&&Jf(y,y.attrs,!1),null!==y.mergedAttrs&&Jf(y,y.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,y),y}(u,l,o,n,t,i):l.data[u],C=o[u]=bf(m,n,function Te(){return rn.lFrame.currentNamespace}()),T=$o(y);return us(y,!0),Rv(m,C,y),32!=(32&y.flags)&&Zp(l,o,C,y),0===function Ls(){return rn.lFrame.elementDepthCount}()&&Ci(C,o),function Il(){rn.lFrame.elementDepthCount++}(),T&&(S_(l,o,y),hd(l,y,o)),null!==i&&Zf(o,y),ft}function gt(){let e=gr();Sh()?af():(e=e.parent,us(e,!1));const n=e;!function Th(){rn.lFrame.elementDepthCount--}();const t=yn();return t.firstCreatePass&&(Pe(t,e),ph(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function sn(e){return 0!=(8&e.flags)}(n)&&di(t,n,Ze(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function vt(e){return 0!=(16&e.flags)}(n)&&di(t,n,Ze(),n.stylesWithoutHost,!1),gt}function Xt(e,n,t,i){return ft(e,n,t,i),gt(),Xt}function wn(e,n,t){const i=Ze(),o=yn(),l=e+Kn,u=o.firstCreatePass?function vi(e,n,t,i,o){const l=n.consts,u=Na(l,i),m=ud(n,e,8,"ng-container",u);return null!==u&&Jf(m,u,!0),A_(n,t,m,Na(l,o)),null!==n.queries&&n.queries.elementStart(n,m),m}(l,o,i,n,t):o.data[l];us(u,!0);const m=i[l]=i[_n].createComment("");return Zp(o,i,m,u),Ci(m,i),$o(u)&&(S_(o,i,u),hd(o,u,i)),null!=t&&Zf(i,u),wn}function xi(){let e=gr();const n=yn();return Sh()?af():(e=e.parent,us(e,!1)),n.firstCreatePass&&(Pe(n,e),ph(e)&&n.queries.elementEnd(e)),xi}function xr(){return Ze()}function fi(e){return!!e&&"function"==typeof e.then}function hr(e){return!!e&&"function"==typeof e.subscribe}const Gi=hr;function Un(e,n,t,i){const o=Ze(),l=yn(),u=gr();return function Ru(e,n,t,i,o,l,u){const m=$o(i),C=e.firstCreatePass&&Dm(e),T=n[li],A=ga(n);let z=!0;if(3&i.type||u){const X=Eo(i,n),oe=u?u(X):X,le=A.length,we=u?Re=>u(_i(Re[i.index])):i.index;let ve=null;if(!u&&m&&(ve=function _a(e,n,t,i){const o=e.cleanup;if(null!=o)for(let l=0;l<o.length-1;l+=2){const u=o[l];if(u===t&&o[l+1]===i){const m=n[bl],y=o[l+2];return m.length>y?m[y]:null}"string"==typeof u&&(l+=2)}return null}(e,n,o,i.index)),null!==ve)(ve.__ngLastListenerFn__||ve).__ngNextListenerFn__=l,ve.__ngLastListenerFn__=l,z=!1;else{l=pd(i,n,T,l,!1);const Re=t.listen(oe,o,l);A.push(l,Re),C&&C.push(o,we,le,le+1)}}else l=pd(i,n,T,l,!1);const V=i.outputs;let H;if(z&&null!==V&&(H=V[o])){const X=H.length;if(X)for(let oe=0;oe<X;oe+=2){const Fe=n[H[oe]][H[oe+1]].subscribe(l),lt=A.length;A.push(l,Fe),C&&C.push(o,i.index,lt,-(lt+1))}}}(l,o,o[_n],u,e,n,i),Un}function fd(e,n,t,i){try{return Co(6,n,t),!1!==t(i)}catch(o){return $s(e,o),!1}finally{Co(7,n,t)}}function pd(e,n,t,i,o){return function l(u){if(u===Function)return i;ku(e.componentOffset>-1?qr(e.index,n):n);let y=fd(n,t,i,u),C=l.__ngNextListenerFn__;for(;C;)y=fd(n,t,C,u)&&y,C=C.__ngNextListenerFn__;return o&&!1===y&&(u.preventDefault(),u.returnValue=!1),y}}function go(e=1){return function ie(e){return(rn.lFrame.contextLView=function re(e,n){for(;e>0;)n=n[oa],e--;return n}(e,rn.lFrame.contextLView))[li]}(e)}function Jr(e,n){return e<<17|n<<2}function nr(e){return e>>17&32767}function km(e){return 2|e}function _s(e){return(131068&e)>>2}function fw(e,n){return-131069&e|n<<2}function pw(e){return 1|e}function WD(e,n,t,i,o){const l=e[t+1],u=null===n;let m=i?nr(l):_s(l),y=!1;for(;0!==m&&(!1===y||u);){const T=e[m+1];eO(e[m],n)&&(y=!0,e[m+1]=i?pw(T):km(T)),m=i?nr(T):_s(T)}y&&(e[t+1]=i?km(l):pw(l))}function eO(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&ha(e,n)>=0}function nx(e,n,t){return Hl(e,n,t,!1),nx}function ix(e,n){return Hl(e,n,null,!0),ix}function Hl(e,n,t,i){const o=Ze(),l=yn(),u=function d(e){const n=rn.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}(2);l.firstUpdatePass&&function eT(e,n,t,i){const o=e.data;if(null===o[t+1]){const l=o[fe()],u=function QD(e,n){return n>=e.expandoStartIndex}(e,t);(function rT(e,n){return 0!=(e.flags&(n?8:16))})(l,i)&&null===n&&!u&&(n=!1),n=function cO(e,n,t,i){const o=function k(e){const n=rn.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let l=i?n.residualClasses:n.residualStyles;if(null===o)0===(i?n.classBindings:n.styleBindings)&&(t=B_(t=mw(null,e,n,t,i),n.attrs,i),l=null);else{const u=n.directiveStylingLast;if(-1===u||e[u]!==o)if(t=mw(o,e,n,t,i),null===l){let y=function uO(e,n,t){const i=t?n.classBindings:n.styleBindings;if(0!==_s(i))return e[nr(i)]}(e,n,i);void 0!==y&&Array.isArray(y)&&(y=mw(null,e,n,y[1],i),y=B_(y,n.attrs,i),function hO(e,n,t,i){e[nr(t?n.classBindings:n.styleBindings)]=i}(e,n,i,y))}else l=function dO(e,n,t){let i;const o=n.directiveEnd;for(let l=1+n.directiveStylingLast;l<o;l++)i=B_(i,e[l].hostAttrs,t);return B_(i,n.attrs,t)}(e,n,i)}return void 0!==l&&(i?n.residualClasses=l:n.residualStyles=l),t}(o,l,n,i),function JR(e,n,t,i,o,l){let u=l?n.classBindings:n.styleBindings,m=nr(u),y=_s(u);e[i]=t;let T,C=!1;if(Array.isArray(t)?(T=t[1],(null===T||ha(t,T)>0)&&(C=!0)):T=t,o)if(0!==y){const z=nr(e[m+1]);e[i+1]=Jr(z,m),0!==z&&(e[z+1]=fw(e[z+1],i)),e[m+1]=function N_(e,n){return 131071&e|n<<17}(e[m+1],i)}else e[i+1]=Jr(m,0),0!==m&&(e[m+1]=fw(e[m+1],i)),m=i;else e[i+1]=Jr(y,0),0===m?m=i:e[y+1]=fw(e[y+1],i),y=i;C&&(e[i+1]=km(e[i+1])),WD(e,T,i,!0),WD(e,T,i,!1),function QR(e,n,t,i,o){const l=o?e.residualClasses:e.residualStyles;null!=l&&"string"==typeof n&&ha(l,n)>=0&&(t[i+1]=pw(t[i+1]))}(n,T,e,i,l),u=Jr(m,y),l?n.classBindings=u:n.styleBindings=u}(o,l,n,t,u,i)}}(l,e,u,i),n!==Qt&&he(o,u,n)&&function nT(e,n,t,i,o,l,u,m){if(!(3&n.type))return;const y=e.data,C=y[m+1],T=function KR(e){return 1==(1&e)}(C)?iT(y,n,t,o,_s(C),u):void 0;rx(T)||(rx(l)||function tp(e){return 2==(2&e)}(C)&&(l=iT(y,null,t,o,m,u)),function S1(e,n,t,i,o){if(n)o?e.addClass(t,i):e.removeClass(t,i);else{let l=-1===i.indexOf("-")?void 0:Yr.DashCase;null==o?e.removeStyle(t,i,l):("string"==typeof o&&o.endsWith("!important")&&(o=o.slice(0,-10),l|=Yr.Important),e.setStyle(t,i,o,l))}}(i,u,pu(fe(),t),o,l))}(l,l.data[fe()],o,o[_n],e,o[u+1]=function gO(e,n){return null==e||""===e||("string"==typeof n?e+=n:"object"==typeof e&&(e=Tn($a(e)))),e}(n,t),i,u)}function mw(e,n,t,i,o){let l=null;const u=t.directiveEnd;let m=t.directiveStylingLast;for(-1===m?m=t.directiveStart:m++;m<u&&(l=n[m],i=B_(i,l.hostAttrs,o),l!==e);)m++;return null!==e&&(t.directiveStylingLast=m),i}function B_(e,n,t){const i=t?1:2;let o=-1;if(null!==n)for(let l=0;l<n.length;l++){const u=n[l];"number"==typeof u?o=u:o===i&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Wo(e,u,!!t||n[++l]))}return void 0===e?null:e}function iT(e,n,t,i,o,l){const u=null===n;let m;for(;o>0;){const y=e[o],C=Array.isArray(y),T=C?y[1]:y,A=null===T;let z=t[o+1];z===Qt&&(z=A?Bn:void 0);let V=A?vu(z,i):T===i?z:void 0;if(C&&!rx(V)&&(V=vu(y,i)),rx(V)&&(m=V,u))return m;const H=e[o+1];o=u?nr(H):_s(H)}if(null!==n){let y=l?n.residualClasses:n.residualStyles;null!=y&&(m=vu(y,i))}return m}function rx(e){return void 0!==e}function si(e,n=""){const t=Ze(),i=yn(),o=e+Kn,l=i.firstCreatePass?ud(i,o,1,n,null):i.data[o],u=t[o]=function qg(e,n){return e.createText(n)}(t[_n],n);Zp(i,t,u,l),us(l,!1)}function Ro(e){return zc("",e,""),Ro}function zc(e,n,t){const i=Ze(),o=function Be(e,n,t,i){return he(e,c(),t)?n+Jt(t)+i:Qt}(i,e,n,t);return o!==Qt&&function Ja(e,n,t){const i=pu(n,e);!function Zg(e,n,t){e.setValue(n,t)}(e[_n],i,t)}(i,fe(),o),zc}const Lm="en-US";let TT=Lm;function yw(e,n,t,i,o){if(e=Pt(e),Array.isArray(e))for(let l=0;l<e.length;l++)yw(e[l],n,t,i,o);else{const l=yn(),u=Ze();let m=Su(e)?e:Pt(e.provide),y=Yh(e);const C=gr(),T=1048575&C.providerIndexes,A=C.directiveStart,z=C.providerIndexes>>20;if(Su(e)||!e.multi){const V=new _t(y,o,Qe),H=xw(m,n,o?T:T+z,A);-1===H?(_u(ds(C,u),l,m),vw(l,e,n.length),n.push(m),C.directiveStart++,C.directiveEnd++,o&&(C.providerIndexes+=1048576),t.push(V),u.push(V)):(t[H]=V,u[H]=V)}else{const V=xw(m,n,T+z,A),H=xw(m,n,T,T+z),oe=H>=0&&t[H];if(o&&!oe||!o&&!(V>=0&&t[V])){_u(ds(C,u),l,m);const le=function OL(e,n,t,i,o){const l=new _t(e,t,Qe);return l.multi=[],l.index=n,l.componentProviders=0,KT(l,o,i&&!t),l}(o?RL:kL,t.length,o,i,y);!o&&oe&&(t[H].providerFactory=le),vw(l,e,n.length,0),n.push(m),C.directiveStart++,C.directiveEnd++,o&&(C.providerIndexes+=1048576),t.push(le),u.push(le)}else vw(l,e,V>-1?V:H,KT(t[o?H:V],y,!o&&i));!o&&i&&oe&&t[H].componentProviders++}}}function vw(e,n,t,i){const o=Su(n),l=function j1(e){return!!e.useClass}(n);if(o||l){const y=(l?Pt(n.useClass):n).prototype.ngOnDestroy;if(y){const C=e.destroyHooks||(e.destroyHooks=[]);if(!o&&n.multi){const T=C.indexOf(t);-1===T?C.push(t,[i,y]):C[T+1].push(i,y)}else C.push(t,y)}}}function KT(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function xw(e,n,t,i){for(let o=t;o<i;o++)if(n[o]===e)return o;return-1}function kL(e,n,t,i){return bw(this.multi,[])}function RL(e,n,t,i){const o=this.multi;let l;if(this.providerFactory){const u=this.providerFactory.componentProviders,m=Ba(t,t[wt],this.providerFactory.index,i);l=m.slice(0,u),bw(o,l);for(let y=u;y<m.length;y++)l.push(m[y])}else l=[],bw(o,l);return l}function bw(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function Wi(e,n=[]){return t=>{t.providersResolver=(i,o)=>function PL(e,n,t){const i=yn();if(i.firstCreatePass){const o=Ho(e);yw(t,i.data,i.blueprint,o,!0),yw(n,i.data,i.blueprint,o,!1)}}(i,o?o(e):e,n)}}class Fm{}class JT{}class QT extends Fm{constructor(n,t){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new O_(this);const i=Hr(n);this._bootstrapComponents=Ha(i.bootstrap),this._r3Injector=w0(n,t,[{provide:Fm,useValue:this},{provide:Qh,useValue:this.componentFactoryResolver}],Tn(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class ww extends JT{constructor(n){super(),this.moduleType=n}create(n){return new QT(this.moduleType,n)}}class FL extends Fm{constructor(n,t,i){super(),this.componentFactoryResolver=new O_(this),this.instance=null;const o=new Nf([...n,{provide:Fm,useValue:this},{provide:Qh,useValue:this.componentFactoryResolver}],t||Ko(),i,new Set(["environment"]));this.injector=o,o.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function cx(e,n,t=null){return new FL(e,n,t).injector}let zL=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t.id)){const i=Xv(0,t.type),o=i.length>0?cx([i],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t.id,o)}return this.cachedInjectors.get(t.id)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=At({token:e,providedIn:"environment",factory:()=>new e(Dt(Vs))}),e})();function eS(e){e.getStandaloneInjector=n=>n.get(zL).getOrCreateStandaloneInjector(e)}function lS(e,n,t,i,o,l){const u=n+t;return he(e,u,o)?function ae(e,n,t){return e[n]=t}(e,u+1,l?i.call(l,o):i(o)):function G_(e,n){const t=e[n];return t===Qt?void 0:t}(e,u+1)}function pS(e,n,t){const i=e+Kn,o=Ze(),l=Ml(o,i);return function W_(e,n){return e[wt].data[n].pure}(o,i)?lS(o,_r(),n,l.transform,t,l):l.transform(t)}function Ew(e){return n=>{setTimeout(e,void 0,n)}}const Mi=class sF extends ro{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,t,i){let o=n,l=t||(()=>null),u=i;if(n&&"object"==typeof n){const y=n;o=y.next?.bind(y),l=y.error?.bind(y),u=y.complete?.bind(y)}this.__isAsync&&(l=Ew(l),o&&(o=Ew(o)),u&&(u=Ew(u)));const m=super.subscribe({next:o,error:l,complete:u});return n instanceof Ue&&n.add(m),m}};let Ou=(()=>{class e{}return e.__NG_ELEMENT_ID__=uF,e})();const lF=Ou,cF=class extends lF{constructor(n,t,i){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=i}createEmbeddedView(n,t){const i=this._declarationTContainer.tView,o=Gf(this._declarationLView,i,n,16,null,i.declTNode,null,null,null,null,t||null);o[gc]=this._declarationLView[this._declarationTContainer.index];const u=this._declarationLView[lr];return null!==u&&(o[lr]=u.createEmbeddedView(i)),T_(i,o,n),new Rc(o)}};function uF(){return function ux(e,n){return 4&e.type?new cF(n,e,ed(e,n)):null}(gr(),Ze())}let Wl=(()=>{class e{}return e.__NG_ELEMENT_ID__=hF,e})();function hF(){return function _S(e,n){let t;const i=n[e.index];if(Pr(i))t=i;else{let o;if(8&e.type)o=_i(i);else{const l=n[_n];o=l.createComment("");const u=Eo(e,n);Tu(l,Cf(l,u),o,function Iv(e,n){return e.nextSibling(n)}(l,u),!1)}n[e.index]=t=R_(i,n,o,e),Cm(n,t)}return new mS(t,e,n)}(gr(),Ze())}const dF=Wl,mS=class extends dF{constructor(n,t,i){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=i}get element(){return ed(this._hostTNode,this._hostLView)}get injector(){return new yu(this._hostTNode,this._hostLView)}get parentInjector(){const n=Rl(this._hostTNode,this._hostLView);if(hs(n)){const t=bn(n,this._hostLView),i=Qn(n);return new yu(t[wt].data[i+8],t)}return new yu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=gS(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-Ji}createEmbeddedView(n,t,i){let o,l;"number"==typeof i?o=i:null!=i&&(o=i.index,l=i.injector);const u=n.createEmbeddedView(t||{},l);return this.insert(u,o),u}createComponent(n,t,i,o,l){const u=n&&!function To(e){return"function"==typeof e}(n);let m;if(u)m=t;else{const A=t||{};m=A.index,i=A.injector,o=A.projectableNodes,l=A.environmentInjector||A.ngModuleRef}const y=u?n:new dd(In(n)),C=i||this.parentInjector;if(!l&&null==y.ngModule){const z=(u?C:this.parentInjector).get(Vs,null);z&&(l=z)}const T=y.create(C,o,void 0,l);return this.insert(T.hostView,m),T}insert(n,t){const i=n._lView,o=i[wt];if(function Rp(e){return Pr(e[bi])}(i)){const T=this.indexOf(n);if(-1!==T)this.detach(T);else{const A=i[bi],z=new mS(A,A[Ki],A[bi]);z.detach(z.indexOf(n))}}const l=this._adjustIndex(t),u=this._lContainer;!function Du(e,n,t,i){const o=Ji+i,l=t.length;i>0&&(t[o-1][Gr]=n),i<l-Ji?(n[Gr]=t[o],yc(t,Ji+i,n)):(t.push(n),n[Gr]=null),n[bi]=t;const u=n[gc];null!==u&&t!==u&&function Ev(e,n){const t=e[gn];n[Ni]!==n[bi][bi][Ni]&&(e[Cl]=!0),null===t?e[gn]=[n]:t.push(n)}(u,n);const m=n[lr];null!==m&&m.insertView(e),n[un]|=64}(o,i,u,l);const m=Ef(l,u),y=i[_n],C=Cf(y,u[El]);return null!==C&&function Xg(e,n,t,i,o,l){i[cs]=o,i[Ki]=n,fa(e,i,t,1,o,l)}(o,u[Ki],y,i,C,m),n.attachToViewContainerRef(),yc(Tw(u),l,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=gS(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),i=Ec(this._lContainer,t);i&&(kh(Tw(this._lContainer),t),wf(i[wt],i))}detach(n){const t=this._adjustIndex(n,-1),i=Ec(this._lContainer,t);return i&&null!=kh(Tw(this._lContainer),t)?new Rc(i):null}_adjustIndex(n,t=0){return n??this.length+t}};function gS(e){return e[Dl]}function Tw(e){return e[Dl]||(e[Dl]=[])}function dx(...e){}const fx=new Mt("Application Initializer");let px=(()=>{class e{constructor(t){this.appInits=t,this.resolve=dx,this.reject=dx,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,o)=>{this.resolve=i,this.reject=o})}runInitializers(){if(this.initialized)return;const t=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let o=0;o<this.appInits.length;o++){const l=this.appInits[o]();if(fi(l))t.push(l);else if(Gi(l)){const u=new Promise((m,y)=>{l.subscribe({complete:m,error:y})});t.push(u)}}Promise.all(t).then(()=>{i()}).catch(o=>{this.reject(o)}),0===t.length&&i(),this.initialized=!0}}return e.\u0275fac=function(t){return new(t||e)(Dt(fx,8))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Z_=new Mt("AppId",{providedIn:"root",factory:function $S(){return`${zw()}${zw()}${zw()}`}});function zw(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const HS=new Mt("Platform Initializer"),Nw=new Mt("Platform ID",{providedIn:"platform",factory:()=>"unknown"});let VF=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Lu=new Mt("LocaleId",{providedIn:"root",factory:()=>cn(Lu,Nt.Optional|Nt.SkipSelf)||function jF(){return typeof $localize<"u"&&$localize.locale||Lm}()});class $F{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let GS=(()=>{class e{compileModuleSync(t){return new ww(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const i=this.compileModuleSync(t),l=Ha(Hr(t).declarations).reduce((u,m)=>{const y=In(m);return y&&u.push(new dd(y)),u},[]);return new $F(i,l)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const WF=(()=>Promise.resolve(0))();function Bw(e){typeof Zone>"u"?WF.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class ir{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Mi(!1),this.onMicrotaskEmpty=new Mi(!1),this.onStable=new Mi(!1),this.onError=new Mi(!1),typeof Zone>"u")throw new nt(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!i&&t,o.shouldCoalesceRunChangeDetection=i,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function qF(){let e=hi.requestAnimationFrame,n=hi.cancelAnimationFrame;if(typeof Zone<"u"&&e&&n){const t=e[Zone.__symbol__("OriginalDelegate")];t&&(e=t);const i=n[Zone.__symbol__("OriginalDelegate")];i&&(n=i)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function YF(e){const n=()=>{!function XF(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(hi,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,jw(e),e.isCheckStableRunning=!0,Vw(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),jw(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,i,o,l,u,m)=>{try{return ZS(e),t.invokeTask(o,l,u,m)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===l.type||e.shouldCoalesceRunChangeDetection)&&n(),XS(e)}},onInvoke:(t,i,o,l,u,m,y)=>{try{return ZS(e),t.invoke(o,l,u,m,y)}finally{e.shouldCoalesceRunChangeDetection&&n(),XS(e)}},onHasTask:(t,i,o,l)=>{t.hasTask(o,l),i===o&&("microTask"==l.change?(e._hasPendingMicrotasks=l.microTask,jw(e),Vw(e)):"macroTask"==l.change&&(e.hasPendingMacrotasks=l.macroTask))},onHandleError:(t,i,o,l)=>(t.handleError(o,l),e.runOutsideAngular(()=>e.onError.emit(l)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ir.isInAngularZone())throw new nt(909,!1)}static assertNotInAngularZone(){if(ir.isInAngularZone())throw new nt(909,!1)}run(n,t,i){return this._inner.run(n,t,i)}runTask(n,t,i,o){const l=this._inner,u=l.scheduleEventTask("NgZoneEvent: "+o,n,ZF,dx,dx);try{return l.runTask(u,t,i)}finally{l.cancelTask(u)}}runGuarded(n,t,i){return this._inner.runGuarded(n,t,i)}runOutsideAngular(n){return this._outer.run(n)}}const ZF={};function Vw(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function jw(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function ZS(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function XS(e){e._nesting--,Vw(e)}class KF{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Mi,this.onMicrotaskEmpty=new Mi,this.onStable=new Mi,this.onError=new Mi}run(n,t,i){return n.apply(t,i)}runGuarded(n,t,i){return n.apply(t,i)}runOutsideAngular(n){return n()}runTask(n,t,i,o){return n.apply(t,i)}}const YS=new Mt(""),mx=new Mt("");let Hw,Uw=(()=>{class e{constructor(t,i,o){this._ngZone=t,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Hw||(function JF(e){Hw=e}(o),o.addToWindow(i)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ir.assertNotInAngularZone(),Bw(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Bw(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(t)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,i,o){let l=-1;i&&i>0&&(l=setTimeout(()=>{this._callbacks=this._callbacks.filter(u=>u.timeoutId!==l),t(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:t,timeoutId:l,updateCb:o})}whenStable(t,i,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,i,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,i,o){return[]}}return e.\u0275fac=function(t){return new(t||e)(Dt(ir),Dt($w),Dt(mx))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})(),$w=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,i){this._applications.set(t,i)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,i=!0){return Hw?.findTestabilityInTree(this,t,i)??null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Fu=!1;let md=null;const KS=new Mt("AllowMultipleToken"),Gw=new Mt("PlatformDestroyListeners"),JS=new Mt("appBootstrapListener");class QS{constructor(n,t){this.name=n,this.token=t}}function tM(e,n,t=[]){const i=`Platform: ${n}`,o=new Mt(i);return(l=[])=>{let u=Ww();if(!u||u.injector.get(KS,!1)){const m=[...t,...l,{provide:o,useValue:!0}];e?e(m):function tz(e){if(md&&!md.get(KS,!1))throw new nt(400,!1);md=e;const n=e.get(iM);(function eM(e){const n=e.get(HS,null);n&&n.forEach(t=>t())})(e)}(function nM(e=[],n){return Wa.create({name:n,providers:[{provide:l_,useValue:"platform"},{provide:Gw,useValue:new Set([()=>md=null])},...e]})}(m,i))}return function iz(e){const n=Ww();if(!n)throw new nt(401,!1);return n}()}}function Ww(){return md?.get(iM)??null}let iM=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,i){const o=function oM(e,n){let t;return t="noop"===e?new KF:("zone.js"===e?void 0:e)||new ir(n),t}(i?.ngZone,function rM(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!e||!e.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!e||!e.ngZoneRunCoalescing)||!1}}(i)),l=[{provide:ir,useValue:o}];return o.run(()=>{const u=Wa.create({providers:l,parent:this.injector,name:t.moduleType.name}),m=t.create(u),y=m.injector.get(td,null);if(!y)throw new nt(402,!1);return o.runOutsideAngular(()=>{const C=o.onError.subscribe({next:T=>{y.handleError(T)}});m.onDestroy(()=>{_x(this._modules,m),C.unsubscribe()})}),function sM(e,n,t){try{const i=t();return fi(i)?i.catch(o=>{throw n.runOutsideAngular(()=>e.handleError(o)),o}):i}catch(i){throw n.runOutsideAngular(()=>e.handleError(i)),i}}(y,o,()=>{const C=m.injector.get(px);return C.runInitializers(),C.donePromise.then(()=>(function ST(e){lo(e,"Expected localeId to be defined"),"string"==typeof e&&(TT=e.toLowerCase().replace(/_/g,"-"))}(m.injector.get(Lu,Lm)||Lm),this._moduleDoBootstrap(m),m))})})}bootstrapModule(t,i=[]){const o=aM({},i);return function QF(e,n,t){const i=new ww(t);return Promise.resolve(i)}(0,0,t).then(l=>this.bootstrapModuleFactory(l,o))}_moduleDoBootstrap(t){const i=t.injector.get(gx);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(o=>i.bootstrap(o));else{if(!t.instance.ngDoBootstrap)throw new nt(-403,!1);t.instance.ngDoBootstrap(i)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new nt(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const t=this._injector.get(Gw,null);t&&(t.forEach(i=>i()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(t){return new(t||e)(Dt(Wa))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function aM(e,n){return Array.isArray(n)?n.reduce(aM,e):{...e,...n}}let gx=(()=>{class e{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(t,i,o){this._zone=t,this._injector=i,this._exceptionHandler=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const l=new fn(m=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{m.next(this._stable),m.complete()})}),u=new fn(m=>{let y;this._zone.runOutsideAngular(()=>{y=this._zone.onStable.subscribe(()=>{ir.assertNotInAngularZone(),Bw(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,m.next(!0))})})});const C=this._zone.onUnstable.subscribe(()=>{ir.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{m.next(!1)}))});return()=>{y.unsubscribe(),C.unsubscribe()}});this.isStable=function sc(...e){const n=fl(e),t=function pl(e,n){return"number"==typeof ss(e)?e.pop():n}(e,1/0),i=e;return i.length?1===i.length?xn(i[0]):Ia(t)(Li(i,n)):so}(l,u.pipe(function ct(e={}){const{connector:n=(()=>new ro),resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:o=!0}=e;return l=>{let u,m,y,C=0,T=!1,A=!1;const z=()=>{m?.unsubscribe(),m=void 0},V=()=>{z(),u=y=void 0,T=A=!1},H=()=>{const X=u;V(),X?.unsubscribe()};return gi((X,oe)=>{C++,!A&&!T&&z();const le=y=y??n();oe.add(()=>{C--,0===C&&!A&&!T&&(m=ln(H,o))}),le.subscribe(oe),!u&&C>0&&(u=new al({next:we=>le.next(we),error:we=>{A=!0,z(),m=ln(V,t,we),le.error(we)},complete:()=>{T=!0,z(),m=ln(V,i),le.complete()}}),xn(X).subscribe(u))})(l)}}()))}bootstrap(t,i){const o=t instanceof dm;if(!this._injector.get(px).done){!o&&function pc(e){const n=In(e)||pr(e)||Ir(e);return null!==n&&n.standalone}(t);throw new nt(405,Fu)}let u;u=o?t:this._injector.get(Qh).resolveComponentFactory(t),this.componentTypes.push(u.componentType);const m=function ez(e){return e.isBoundToModule}(u)?void 0:this._injector.get(Fm),C=u.create(Wa.NULL,[],i||u.selector,m),T=C.location.nativeElement,A=C.injector.get(YS,null);return A?.registerApplication(T),C.onDestroy(()=>{this.detachView(C.hostView),_x(this.components,C),A?.unregisterApplication(T)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new nt(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){const i=t;_x(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const i=this._injector.get(JS,[]);i.push(...this._bootstrapListeners),i.forEach(o=>o(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>_x(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new nt(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(t){return new(t||e)(Dt(ir),Dt(Vs),Dt(td))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function _x(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}let yx=(()=>{class e{}return e.__NG_ELEMENT_ID__=oz,e})();function oz(e){return function sz(e,n,t){if(za(e)&&!t){const i=qr(e.index,n);return new Rc(i,i)}return 47&e.type?new Rc(n[Ni],n):null}(gr(),Ze(),16==(16&e))}class dM{constructor(){}supports(n){return $(n)}create(n){return new dz(n)}}const hz=(e,n)=>n;class dz{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||hz}forEachItem(n){let t;for(t=this._itHead;null!==t;t=t._next)n(t)}forEachOperation(n){let t=this._itHead,i=this._removalsHead,o=0,l=null;for(;t||i;){const u=!i||t&&t.currentIndex<pM(i,o,l)?t:i,m=pM(u,o,l),y=u.currentIndex;if(u===i)o--,i=i._nextRemoved;else if(t=t._next,null==u.previousIndex)o++;else{l||(l=[]);const C=m-o,T=y-o;if(C!=T){for(let z=0;z<C;z++){const V=z<l.length?l[z]:l[z]=0,H=V+z;T<=H&&H<C&&(l[z]=V+1)}l[u.previousIndex]=T-C}}m!==y&&n(u,m,y)}}forEachPreviousItem(n){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachMovedItem(n){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}forEachIdentityChange(n){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)n(t)}diff(n){if(null==n&&(n=[]),!$(n))throw new nt(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let o,l,u,t=this._itHead,i=!1;if(Array.isArray(n)){this.length=n.length;for(let m=0;m<this.length;m++)l=n[m],u=this._trackByFn(m,l),null!==t&&Object.is(t.trackById,u)?(i&&(t=this._verifyReinsertion(t,l,u,m)),Object.is(t.item,l)||this._addIdentityChange(t,l)):(t=this._mismatch(t,l,u,m),i=!0),t=t._next}else o=0,function te(e,n){if(Array.isArray(e))for(let t=0;t<e.length;t++)n(e[t]);else{const t=e[Symbol.iterator]();let i;for(;!(i=t.next()).done;)n(i.value)}}(n,m=>{u=this._trackByFn(o,m),null!==t&&Object.is(t.trackById,u)?(i&&(t=this._verifyReinsertion(t,m,u,o)),Object.is(t.item,m)||this._addIdentityChange(t,m)):(t=this._mismatch(t,m,u,o),i=!0),t=t._next,o++}),this.length=o;return this._truncate(t),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,t,i,o){let l;return null===n?l=this._itTail:(l=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._reinsertAfter(n,l,o)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(i,o))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._moveAfter(n,l,o)):n=this._addAfter(new fz(t,i),l,o),n}_verifyReinsertion(n,t,i,o){let l=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==l?n=this._reinsertAfter(l,n._prev,o):n.currentIndex!=o&&(n.currentIndex=o,this._addToMoves(n,o)),n}_truncate(n){for(;null!==n;){const t=n._next;this._addToRemovals(this._unlink(n)),n=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,t,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const o=n._prevRemoved,l=n._nextRemoved;return null===o?this._removalsHead=l:o._nextRemoved=l,null===l?this._removalsTail=o:l._prevRemoved=o,this._insertAfter(n,t,i),this._addToMoves(n,i),n}_moveAfter(n,t,i){return this._unlink(n),this._insertAfter(n,t,i),this._addToMoves(n,i),n}_addAfter(n,t,i){return this._insertAfter(n,t,i),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,t,i){const o=null===t?this._itHead:t._next;return n._next=o,n._prev=t,null===o?this._itTail=n:o._prev=n,null===t?this._itHead=n:t._next=n,null===this._linkedRecords&&(this._linkedRecords=new fM),this._linkedRecords.put(n),n.currentIndex=i,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const t=n._prev,i=n._next;return null===t?this._itHead=i:t._next=i,null===i?this._itTail=t:i._prev=t,n}_addToMoves(n,t){return n.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new fM),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,t){return n.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class fz{constructor(n,t){this.item=n,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class pz{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,t){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===t||t<=i.currentIndex)&&Object.is(i.trackById,n))return i;return null}remove(n){const t=n._prevDup,i=n._nextDup;return null===t?this._head=i:t._nextDup=i,null===i?this._tail=t:i._prevDup=t,null===this._head}}class fM{constructor(){this.map=new Map}put(n){const t=n.trackById;let i=this.map.get(t);i||(i=new pz,this.map.set(t,i)),i.add(n)}get(n,t){const o=this.map.get(n);return o?o.get(n,t):null}remove(n){const t=n.trackById;return this.map.get(t).remove(n)&&this.map.delete(t),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function pM(e,n,t){const i=e.previousIndex;if(null===i)return i;let o=0;return t&&i<t.length&&(o=t[i]),i+n+o}function gM(){return new bx([new dM])}let bx=(()=>{class e{constructor(t){this.factories=t}static create(t,i){if(null!=i){const o=i.factories.slice();t=t.concat(o)}return new e(t)}static extend(t){return{provide:e,useFactory:i=>e.create(t,i||gM()),deps:[[e,new So,new Oh]]}}find(t){const i=this.factories.find(o=>o.supports(t));if(null!=i)return i;throw new nt(901,!1)}}return e.\u0275prov=At({token:e,providedIn:"root",factory:gM}),e})();const vz=tM(null,"core",[]);let xz=(()=>{class e{constructor(t){}}return e.\u0275fac=function(t){return new(t||e)(Dt(gx))},e.\u0275mod=ar({type:e}),e.\u0275inj=Ui({}),e})();function Bm(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let Kw=null;function zu(){return Kw}class Cz{}const xs=new Mt("DocumentToken");let Jw=(()=>{class e{historyGo(t){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:function(){return function Ez(){return Dt(yM)}()},providedIn:"platform"}),e})();const Dz=new Mt("Location Initialized");let yM=(()=>{class e extends Jw{constructor(t){super(),this._doc=t,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return zu().getBaseHref(this._doc)}onPopState(t){const i=zu().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){const i=zu().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,i,o){vM()?this._history.pushState(t,i,o):this._location.hash=o}replaceState(t,i,o){vM()?this._history.replaceState(t,i,o):this._location.hash=o}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return e.\u0275fac=function(t){return new(t||e)(Dt(xs))},e.\u0275prov=At({token:e,factory:function(){return function Tz(){return new yM(Dt(xs))}()},providedIn:"platform"}),e})();function vM(){return!!window.history.pushState}function Qw(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function xM(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function Nu(e){return e&&"?"!==e[0]?"?"+e:e}let rp=(()=>{class e{historyGo(t){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:function(){return cn(wM)},providedIn:"root"}),e})();const bM=new Mt("appBaseHref");let wM=(()=>{class e extends rp{constructor(t,i){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??cn(xs).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Qw(this._baseHref,t)}path(t=!1){const i=this._platformLocation.pathname+Nu(this._platformLocation.search),o=this._platformLocation.hash;return o&&t?`${i}${o}`:i}pushState(t,i,o,l){const u=this.prepareExternalUrl(o+Nu(l));this._platformLocation.pushState(t,i,u)}replaceState(t,i,o,l){const u=this.prepareExternalUrl(o+Nu(l));this._platformLocation.replaceState(t,i,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return e.\u0275fac=function(t){return new(t||e)(Dt(Jw),Dt(bM,8))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Sz=(()=>{class e extends rp{constructor(t,i){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(t){const i=Qw(this._baseHref,t);return i.length>0?"#"+i:i}pushState(t,i,o,l){let u=this.prepareExternalUrl(o+Nu(l));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.pushState(t,i,u)}replaceState(t,i,o,l){let u=this.prepareExternalUrl(o+Nu(l));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.replaceState(t,i,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return e.\u0275fac=function(t){return new(t||e)(Dt(Jw),Dt(bM,8))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})(),eC=(()=>{class e{constructor(t){this._subject=new Mi,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const i=this._locationStrategy.getBaseHref();this._basePath=function Az(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(xM(CM(i))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+Nu(i))}normalize(t){return e.stripTrailingSlash(function Iz(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,CM(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,i="",o=null){this._locationStrategy.pushState(o,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Nu(i)),o)}replaceState(t,i="",o=null){this._locationStrategy.replaceState(o,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Nu(i)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(o=>o(t,i))}subscribe(t,i,o){return this._subject.subscribe({next:t,error:i,complete:o})}}return e.normalizeQueryParams=Nu,e.joinWithSlash=Qw,e.stripTrailingSlash=xM,e.\u0275fac=function(t){return new(t||e)(Dt(rp))},e.\u0275prov=At({token:e,factory:function(){return function Mz(){return new eC(Dt(rp))}()},providedIn:"root"}),e})();function CM(e){return e.replace(/\/index.html$/,"")}function kM(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const i=t.indexOf("="),[o,l]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(o.trim()===n)return decodeURIComponent(l)}return null}class mN{constructor(n,t,i,o){this.$implicit=n,this.ngForOf=t,this.index=i,this.count=o}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Vm=(()=>{class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,i,o){this._viewContainer=t,this._template=i,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const i=this._viewContainer;t.forEachOperation((o,l,u)=>{if(null==o.previousIndex)i.createEmbeddedView(this._template,new mN(o.item,this._ngForOf,-1,-1),null===u?void 0:u);else if(null==u)i.remove(null===l?void 0:l);else if(null!==l){const m=i.get(l);i.move(m,u),FM(m,o)}});for(let o=0,l=i.length;o<l;o++){const m=i.get(o).context;m.index=o,m.count=l,m.ngForOf=this._ngForOf}t.forEachIdentityChange(o=>{FM(i.get(o.currentIndex),o)})}static ngTemplateContextGuard(t,i){return!0}}return e.\u0275fac=function(t){return new(t||e)(Qe(Wl),Qe(Ou),Qe(bx))},e.\u0275dir=Ft({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),e})();function FM(e,n){e.context.$implicit=n.item}let J_=(()=>{class e{constructor(t,i){this._viewContainer=t,this._context=new _N,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){zM("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){zM("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,i){return!0}}return e.\u0275fac=function(t){return new(t||e)(Qe(Wl),Qe(Ou))},e.\u0275dir=Ft({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),e})();class _N{constructor(){this.$implicit=null,this.ngIf=null}}function zM(e,n){if(n&&!n.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${Tn(n)}'.`)}class xN{createSubscription(n,t){return n.subscribe({next:t,error:i=>{throw i}})}dispose(n){n.unsubscribe()}}class bN{createSubscription(n,t){return n.then(t,i=>{throw i})}dispose(n){}}const wN=new bN,CN=new xN;let BM=(()=>{class e{constructor(t){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue:(t&&this._subscribe(t),this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,i=>this._updateLatestValue(t,i))}_selectStrategy(t){if(fi(t))return wN;if(hr(t))return CN;throw function Xl(e,n){return new nt(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,i){t===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return e.\u0275fac=function(t){return new(t||e)(Qe(yx,16))},e.\u0275pipe=Mr({name:"async",type:e,pure:!1,standalone:!0}),e})(),jM=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=ar({type:e}),e.\u0275inj=Ui({}),e})();let HN=(()=>{class e{}return e.\u0275prov=At({token:e,providedIn:"root",factory:()=>new GN(Dt(xs),window)}),e})();class GN{constructor(n,t){this.document=n,this.window=t,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const t=function WN(e,n){const t=e.getElementById(n)||e.getElementsByName(n)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const i=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let o=i.currentNode;for(;o;){const l=o.shadowRoot;if(l){const u=l.getElementById(n)||l.querySelector(`[name="${n}"]`);if(u)return u}o=i.nextNode()}}return null}(this.document,n);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(n){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=n)}}scrollToElement(n){const t=n.getBoundingClientRect(),i=t.left+this.window.pageXOffset,o=t.top+this.window.pageYOffset,l=this.offset();this.window.scrollTo(i-l[0],o-l[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const n=$M(this.window.history)||$M(Object.getPrototypeOf(this.window.history));return!(!n||!n.writable&&!n.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function $M(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class HM{}class vB extends Cz{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class _C extends vB{static makeCurrent(){!function wz(e){Kw||(Kw=e)}(new _C)}onAndCancel(n,t,i){return n.addEventListener(t,i,!1),()=>{n.removeEventListener(t,i,!1)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function xB(){return ey=ey||document.querySelector("base"),ey?ey.getAttribute("href"):null}();return null==t?null:function bB(e){Rx=Rx||document.createElement("a"),Rx.setAttribute("href",e);const n=Rx.pathname;return"/"===n.charAt(0)?n:`/${n}`}(t)}resetBaseElement(){ey=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return kM(document.cookie,n)}}let Rx,ey=null;const XM=new Mt("TRANSITION_ID"),CB=[{provide:fx,useFactory:function wB(e,n,t){return()=>{t.get(px).donePromise.then(()=>{const i=zu(),o=n.querySelectorAll(`style[ng-transition="${e}"]`);for(let l=0;l<o.length;l++)i.remove(o[l])})}},deps:[XM,xs,Wa],multi:!0}];let DB=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();const Ox=new Mt("EventManagerPlugins");let Lx=(()=>{class e{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(o=>{o.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,i,o){return this._findPluginFor(i).addEventListener(t,i,o)}addGlobalEventListener(t,i,o){return this._findPluginFor(i).addGlobalEventListener(t,i,o)}getZone(){return this._zone}_findPluginFor(t){const i=this._eventNameToPlugin.get(t);if(i)return i;const o=this._plugins;for(let l=0;l<o.length;l++){const u=o[l];if(u.supports(t))return this._eventNameToPlugin.set(t,u),u}throw new Error(`No event manager plugin found for event ${t}`)}}return e.\u0275fac=function(t){return new(t||e)(Dt(Ox),Dt(ir))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();class YM{constructor(n){this._doc=n}addGlobalEventListener(n,t,i){const o=zu().getGlobalEventTarget(this._doc,n);if(!o)throw new Error(`Unsupported event target ${o} for event ${t}`);return this.addEventListener(o,t,i)}}let KM=(()=>{class e{constructor(){this.usageCount=new Map}addStyles(t){for(const i of t)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(t){for(const i of t)0===this.changeUsageCount(i,-1)&&this.onStyleRemoved(i)}onStyleRemoved(t){}onStyleAdded(t){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(t,i){const o=this.usageCount;let l=o.get(t)??0;return l+=i,l>0?o.set(t,l):o.delete(t),l}ngOnDestroy(){for(const t of this.getAllStyles())this.onStyleRemoved(t);this.usageCount.clear()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})(),ty=(()=>{class e extends KM{constructor(t){super(),this.doc=t,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(t){for(const i of this.hostNodes)this.addStyleToHost(i,t)}onStyleRemoved(t){const i=this.styleRef;i.get(t)?.forEach(l=>l.remove()),i.delete(t)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const i of this.getAllStyles())this.addStyleToHost(t,i)}removeHost(t){this.hostNodes.delete(t)}addStyleToHost(t,i){const o=this.doc.createElement("style");o.textContent=i,t.appendChild(o);const l=this.styleRef.get(i);l?l.push(o):this.styleRef.set(i,[o])}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}}return e.\u0275fac=function(t){return new(t||e)(Dt(xs))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();const yC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},vC=/%COMP%/g,eI=new Mt("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function tI(e,n){return n.flat(100).map(t=>t.replace(vC,e))}function nI(e){return n=>{if("__ngUnwrap__"===n)return e;!1===e(n)&&(n.preventDefault(),n.returnValue=!1)}}let xC=(()=>{class e{constructor(t,i,o,l){this.eventManager=t,this.sharedStylesHost=i,this.appId=o,this.removeStylesOnCompDestory=l,this.rendererByCompId=new Map,this.defaultRenderer=new bC(t)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;const o=this.getOrCreateRenderer(t,i);return o instanceof oI?o.applyToHost(t):o instanceof wC&&o.applyStyles(),o}getOrCreateRenderer(t,i){const o=this.rendererByCompId;let l=o.get(i.id);if(!l){const u=this.eventManager,m=this.sharedStylesHost,y=this.removeStylesOnCompDestory;switch(i.encapsulation){case jo.Emulated:l=new oI(u,m,i,this.appId,y);break;case jo.ShadowDom:return new kB(u,m,t,i);default:l=new wC(u,m,i,y)}l.onDestroy=()=>o.delete(i.id),o.set(i.id,l)}return l}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return e.\u0275fac=function(t){return new(t||e)(Dt(Lx),Dt(ty),Dt(Z_),Dt(eI))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();class bC{constructor(n){this.eventManager=n,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,t){return t?document.createElementNS(yC[t]||t,n):document.createElement(n)}createComment(n){return document.createComment(n)}createText(n){return document.createTextNode(n)}appendChild(n,t){(rI(n)?n.content:n).appendChild(t)}insertBefore(n,t,i){n&&(rI(n)?n.content:n).insertBefore(t,i)}removeChild(n,t){n&&n.removeChild(t)}selectRootElement(n,t){let i="string"==typeof n?document.querySelector(n):n;if(!i)throw new Error(`The selector "${n}" did not match any elements`);return t||(i.textContent=""),i}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,i,o){if(o){t=o+":"+t;const l=yC[o];l?n.setAttributeNS(l,t,i):n.setAttribute(t,i)}else n.setAttribute(t,i)}removeAttribute(n,t,i){if(i){const o=yC[i];o?n.removeAttributeNS(o,t):n.removeAttribute(`${i}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,i,o){o&(Yr.DashCase|Yr.Important)?n.style.setProperty(t,i,o&Yr.Important?"important":""):n.style[t]=i}removeStyle(n,t,i){i&Yr.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,i){n[t]=i}setValue(n,t){n.nodeValue=t}listen(n,t,i){return"string"==typeof n?this.eventManager.addGlobalEventListener(n,t,nI(i)):this.eventManager.addEventListener(n,t,nI(i))}}function rI(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class kB extends bC{constructor(n,t,i,o){super(n),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const l=tI(o.id,o.styles);for(const u of l){const m=document.createElement("style");m.textContent=u,this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,i){return super.insertBefore(this.nodeOrShadowRoot(n),t,i)}removeChild(n,t){return super.removeChild(this.nodeOrShadowRoot(n),t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class wC extends bC{constructor(n,t,i,o,l=i.id){super(n),this.sharedStylesHost=t,this.removeStylesOnCompDestory=o,this.rendererUsageCount=0,this.styles=tI(l,i.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class oI extends wC{constructor(n,t,i,o,l){const u=o+"-"+i.id;super(n,t,i,l,u),this.contentAttr=function IB(e){return"_ngcontent-%COMP%".replace(vC,e)}(u),this.hostAttr=function AB(e){return"_nghost-%COMP%".replace(vC,e)}(u)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const i=super.createElement(n,t);return super.setAttribute(i,this.contentAttr,""),i}}let RB=(()=>{class e extends YM{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,o){return t.addEventListener(i,o,!1),()=>this.removeEventListener(t,i,o)}removeEventListener(t,i,o){return t.removeEventListener(i,o)}}return e.\u0275fac=function(t){return new(t||e)(Dt(xs))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();const sI=["alt","control","meta","shift"],OB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},LB={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let FB=(()=>{class e extends YM{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,i,o){const l=e.parseEventName(i),u=e.eventCallback(l.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>zu().onAndCancel(t,l.domEventName,u))}static parseEventName(t){const i=t.toLowerCase().split("."),o=i.shift();if(0===i.length||"keydown"!==o&&"keyup"!==o)return null;const l=e._normalizeKey(i.pop());let u="",m=i.indexOf("code");if(m>-1&&(i.splice(m,1),u="code."),sI.forEach(C=>{const T=i.indexOf(C);T>-1&&(i.splice(T,1),u+=C+".")}),u+=l,0!=i.length||0===l.length)return null;const y={};return y.domEventName=o,y.fullKey=u,y}static matchEventFullKeyCode(t,i){let o=OB[t.key]||t.key,l="";return i.indexOf("code.")>-1&&(o=t.code,l="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),sI.forEach(u=>{u!==o&&(0,LB[u])(t)&&(l+=u+".")}),l+=o,l===i)}static eventCallback(t,i,o){return l=>{e.matchEventFullKeyCode(l,t)&&o.runGuarded(()=>i(l))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return e.\u0275fac=function(t){return new(t||e)(Dt(xs))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();const lI=[{provide:Nw,useValue:"browser"},{provide:HS,useValue:function zB(){_C.makeCurrent()},multi:!0},{provide:xs,useFactory:function BB(){return function em(e){Qp=e}(document),document},deps:[]}],VB=tM(vz,"browser",lI),cI=new Mt(""),uI=[{provide:mx,useClass:class EB{addToWindow(n){hi.getAngularTestability=(i,o=!0)=>{const l=n.findTestabilityInTree(i,o);if(null==l)throw new Error("Could not find testability for element.");return l},hi.getAllAngularTestabilities=()=>n.getAllTestabilities(),hi.getAllAngularRootElements=()=>n.getAllRootElements(),hi.frameworkStabilizers||(hi.frameworkStabilizers=[]),hi.frameworkStabilizers.push(i=>{const o=hi.getAllAngularTestabilities();let l=o.length,u=!1;const m=function(y){u=u||y,l--,0==l&&i(u)};o.forEach(function(y){y.whenStable(m)})})}findTestabilityInTree(n,t,i){return null==t?null:n.getTestability(t)??(i?zu().isShadowRoot(t)?this.findTestabilityInTree(n,t.host,!0):this.findTestabilityInTree(n,t.parentElement,!0):null)}},deps:[]},{provide:YS,useClass:Uw,deps:[ir,$w,mx]},{provide:Uw,useClass:Uw,deps:[ir,$w,mx]}],hI=[{provide:l_,useValue:"root"},{provide:td,useFactory:function NB(){return new td},deps:[]},{provide:Ox,useClass:RB,multi:!0,deps:[xs,ir,Nw]},{provide:Ox,useClass:FB,multi:!0,deps:[xs]},{provide:xC,useClass:xC,deps:[Lx,ty,Z_,eI]},{provide:u_,useExisting:xC},{provide:KM,useExisting:ty},{provide:ty,useClass:ty,deps:[xs]},{provide:Lx,useClass:Lx,deps:[Ox,ir]},{provide:HM,useClass:DB,deps:[]},[]];let jB=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:Z_,useValue:t.appId},{provide:XM,useExisting:Z_},CB]}}}return e.\u0275fac=function(t){return new(t||e)(Dt(cI,12))},e.\u0275mod=ar({type:e}),e.\u0275inj=Ui({providers:[...hI,...uI],imports:[jM,xz]}),e})(),dI=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}}return e.\u0275fac=function(t){return new(t||e)(Dt(xs))},e.\u0275prov=At({token:e,factory:function(t){let i=null;return i=t?new t:function $B(){return new dI(Dt(xs))}(),i},providedIn:"root"}),e})();function Ht(...e){return Li(e,fl(e))}typeof window<"u"&&window;class va extends ro{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:i}=this;if(n)throw t;return this._throwIfClosed(),i}next(n){super.next(this._value=n)}}const Fx=Od(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:XB}=Array,{getPrototypeOf:YB,prototype:KB,keys:JB}=Object;function mI(e){if(1===e.length){const n=e[0];if(XB(n))return{args:n,keys:null};if(function QB(e){return e&&"object"==typeof e&&YB(e)===KB}(n)){const t=JB(n);return{args:t.map(i=>n[i]),keys:t}}}return{args:e,keys:null}}const{isArray:e3}=Array;function DC(e){return ht(n=>function t3(e,n){return e3(n)?e(...n):e(n)}(e,n))}function gI(e,n){return e.reduce((t,i,o)=>(t[i]=n[o],t),{})}function _I(...e){const n=fl(e),t=rh(e),{args:i,keys:o}=mI(e);if(0===i.length)return Li([],n);const l=new fn(function n3(e,n,t=rs){return i=>{yI(n,()=>{const{length:o}=e,l=new Array(o);let u=o,m=o;for(let y=0;y<o;y++)yI(n,()=>{const C=Li(e[y],n);let T=!1;C.subscribe(Yn(i,A=>{l[y]=A,T||(T=!0,m--),m||i.next(t(l.slice()))},()=>{--u||i.complete()}))},i)},i)}}(i,n,o?u=>gI(o,u):rs));return t?l.pipe(DC(t)):l}function yI(e,n,t){e?Js(t,e,n):n()}function TC(...e){return function i3(){return Ia(1)}()(Li(e,fl(e)))}function vI(e){return new fn(n=>{xn(e()).subscribe(n)})}function ny(e,n){const t=kn(e)?e:()=>e,i=o=>o.error(t());return new fn(n?o=>n.schedule(i,0,o):i)}function SC(){return gi((e,n)=>{let t=null;e._refCount++;const i=Yn(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const o=e._connection,l=t;t=null,o&&(!l||o===l)&&o.unsubscribe(),n.unsubscribe()});e.subscribe(i),i.closed||(t=e.connect())})}class xI extends fn{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,Ts(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Ue;const t=this.getSubject();n.add(this.source.subscribe(Yn(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Ue.EMPTY)}return n}refCount(){return SC()(this)}}function Nc(e,n){return gi((t,i)=>{let o=null,l=0,u=!1;const m=()=>u&&!o&&i.complete();t.subscribe(Yn(i,y=>{o?.unsubscribe();let C=0;const T=l++;xn(e(y,T)).subscribe(o=Yn(i,A=>i.next(n?n(y,A,T,C++):A),()=>{o=null,m()}))},()=>{u=!0,m()}))})}function jm(e){return e<=0?()=>so:gi((n,t)=>{let i=0;n.subscribe(Yn(t,o=>{++i<=e&&(t.next(o),e<=i&&t.complete())}))})}function Bc(e,n){return gi((t,i)=>{let o=0;t.subscribe(Yn(i,l=>e.call(n,l,o++)&&i.next(l)))})}function zx(e){return gi((n,t)=>{let i=!1;n.subscribe(Yn(t,o=>{i=!0,t.next(o)},()=>{i||t.next(e),t.complete()}))})}function bI(e=o3){return gi((n,t)=>{let i=!1;n.subscribe(Yn(t,o=>{i=!0,t.next(o)},()=>i?t.complete():t.error(e())))})}function o3(){return new Fx}function _d(e,n){const t=arguments.length>=2;return i=>i.pipe(e?Bc((o,l)=>e(o,l,i)):rs,jm(1),t?zx(n):bI(()=>new Fx))}function yd(e,n){return kn(n)?Lt(e,n,1):Lt(e,1)}function to(e,n,t){const i=kn(e)||n||t?{next:e,error:n,complete:t}:e;return i?gi((o,l)=>{var u;null===(u=i.subscribe)||void 0===u||u.call(i);let m=!0;o.subscribe(Yn(l,y=>{var C;null===(C=i.next)||void 0===C||C.call(i,y),l.next(y)},()=>{var y;m=!1,null===(y=i.complete)||void 0===y||y.call(i),l.complete()},y=>{var C;m=!1,null===(C=i.error)||void 0===C||C.call(i,y),l.error(y)},()=>{var y,C;m&&(null===(y=i.unsubscribe)||void 0===y||y.call(i)),null===(C=i.finalize)||void 0===C||C.call(i)}))}):rs}function vd(e){return gi((n,t)=>{let l,i=null,o=!1;i=n.subscribe(Yn(t,void 0,void 0,u=>{l=xn(e(u,vd(e)(n))),i?(i.unsubscribe(),i=null,l.subscribe(t)):o=!0})),o&&(i.unsubscribe(),i=null,l.subscribe(t))})}function wI(e,n){return gi(function s3(e,n,t,i,o){return(l,u)=>{let m=t,y=n,C=0;l.subscribe(Yn(u,T=>{const A=C++;y=m?e(y,T,A):(m=!0,T),i&&u.next(y)},o&&(()=>{m&&u.next(y),u.complete()})))}}(e,n,arguments.length>=2,!0))}function MC(e){return e<=0?()=>so:gi((n,t)=>{let i=[];n.subscribe(Yn(t,o=>{i.push(o),e<i.length&&i.shift()},()=>{for(const o of i)t.next(o);t.complete()},void 0,()=>{i=null}))})}function CI(e,n){const t=arguments.length>=2;return i=>i.pipe(e?Bc((o,l)=>e(o,l,i)):rs,MC(1),t?zx(n):bI(()=>new Fx))}function IC(e){return gi((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}const vn="primary",iy=Symbol("RouteTitle");class c3{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Um(e){return new c3(e)}function u3(e,n,t){const i=t.path.split("/");if(i.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||i.length<e.length))return null;const o={};for(let l=0;l<i.length;l++){const u=i[l],m=e[l];if(u.startsWith(":"))o[u.substring(1)]=m;else if(u!==m.path)return null}return{consumed:e.slice(0,i.length),posParams:o}}function Vc(e,n){const t=e?Object.keys(e):void 0,i=n?Object.keys(n):void 0;if(!t||!i||t.length!=i.length)return!1;let o;for(let l=0;l<t.length;l++)if(o=t[l],!EI(e[o],n[o]))return!1;return!0}function EI(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),i=[...n].sort();return t.every((o,l)=>i[l]===o)}return e===n}function DI(e){return Array.prototype.concat.apply([],e)}function TI(e){return e.length>0?e[e.length-1]:null}function Oo(e,n){for(const t in e)e.hasOwnProperty(t)&&n(e[t],t)}function xd(e){return Gi(e)?e:fi(e)?Li(Promise.resolve(e)):Ht(e)}const Nx=!1,d3={exact:function II(e,n,t){if(!op(e.segments,n.segments)||!Bx(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const i in n.children)if(!e.children[i]||!II(e.children[i],n.children[i],t))return!1;return!0},subset:AI},SI={exact:function f3(e,n){return Vc(e,n)},subset:function p3(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>EI(e[t],n[t]))},ignored:()=>!0};function MI(e,n,t){return d3[t.paths](e.root,n.root,t.matrixParams)&&SI[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function AI(e,n,t){return PI(e,n,n.segments,t)}function PI(e,n,t,i){if(e.segments.length>t.length){const o=e.segments.slice(0,t.length);return!(!op(o,t)||n.hasChildren()||!Bx(o,t,i))}if(e.segments.length===t.length){if(!op(e.segments,t)||!Bx(e.segments,t,i))return!1;for(const o in n.children)if(!e.children[o]||!AI(e.children[o],n.children[o],i))return!1;return!0}{const o=t.slice(0,e.segments.length),l=t.slice(e.segments.length);return!!(op(e.segments,o)&&Bx(e.segments,o,i)&&e.children[vn])&&PI(e.children[vn],n,l,i)}}function Bx(e,n,t){return n.every((i,o)=>SI[t](e[o].parameters,i.parameters))}class bd{constructor(n=new Sn([],{}),t={},i=null){this.root=n,this.queryParams=t,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Um(this.queryParams)),this._queryParamMap}toString(){return _3.serialize(this)}}class Sn{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Oo(t,(i,o)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Vx(this)}}class ry{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Um(this.parameters)),this._parameterMap}toString(){return OI(this)}}function op(e,n){return e.length===n.length&&e.every((t,i)=>t.path===n[i].path)}let oy=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:function(){return new AC},providedIn:"root"}),e})();class AC{parse(n){const t=new T3(n);return new bd(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${sy(n.root,!0)}`,i=function x3(e){const n=Object.keys(e).map(t=>{const i=e[t];return Array.isArray(i)?i.map(o=>`${jx(t)}=${jx(o)}`).join("&"):`${jx(t)}=${jx(i)}`}).filter(t=>!!t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${i}${"string"==typeof n.fragment?`#${function y3(e){return encodeURI(e)}(n.fragment)}`:""}`}}const _3=new AC;function Vx(e){return e.segments.map(n=>OI(n)).join("/")}function sy(e,n){if(!e.hasChildren())return Vx(e);if(n){const t=e.children[vn]?sy(e.children[vn],!1):"",i=[];return Oo(e.children,(o,l)=>{l!==vn&&i.push(`${l}:${sy(o,!1)}`)}),i.length>0?`${t}(${i.join("//")})`:t}{const t=function g3(e,n){let t=[];return Oo(e.children,(i,o)=>{o===vn&&(t=t.concat(n(i,o)))}),Oo(e.children,(i,o)=>{o!==vn&&(t=t.concat(n(i,o)))}),t}(e,(i,o)=>o===vn?[sy(e.children[vn],!1)]:[`${o}:${sy(i,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[vn]?`${Vx(e)}/${t[0]}`:`${Vx(e)}/(${t.join("//")})`}}function kI(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function jx(e){return kI(e).replace(/%3B/gi,";")}function PC(e){return kI(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ux(e){return decodeURIComponent(e)}function RI(e){return Ux(e.replace(/\+/g,"%20"))}function OI(e){return`${PC(e.path)}${function v3(e){return Object.keys(e).map(n=>`;${PC(n)}=${PC(e[n])}`).join("")}(e.parameters)}`}const b3=/^[^\/()?;=#]+/;function $x(e){const n=e.match(b3);return n?n[0]:""}const w3=/^[^=?&#]+/,E3=/^[^&#]+/;class T3{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Sn([],{}):new Sn([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(i[vn]=new Sn(n,t)),i}parseSegment(){const n=$x(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new nt(4009,Nx);return this.capture(n),new ry(Ux(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=$x(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const o=$x(this.remaining);o&&(i=o,this.capture(i))}n[Ux(t)]=Ux(i)}parseQueryParam(n){const t=function C3(e){const n=e.match(w3);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const u=function D3(e){const n=e.match(E3);return n?n[0]:""}(this.remaining);u&&(i=u,this.capture(i))}const o=RI(t),l=RI(i);if(n.hasOwnProperty(o)){let u=n[o];Array.isArray(u)||(u=[u],n[o]=u),u.push(l)}else n[o]=l}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=$x(this.remaining),o=this.remaining[i.length];if("/"!==o&&")"!==o&&";"!==o)throw new nt(4010,Nx);let l;i.indexOf(":")>-1?(l=i.slice(0,i.indexOf(":")),this.capture(l),this.capture(":")):n&&(l=vn);const u=this.parseChildren();t[l]=1===Object.keys(u).length?u[vn]:new Sn([],u),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new nt(4011,Nx)}}function kC(e){return e.segments.length>0?new Sn([],{[vn]:e}):e}function Hx(e){const n={};for(const i of Object.keys(e.children)){const l=Hx(e.children[i]);(l.segments.length>0||l.hasChildren())&&(n[i]=l)}return function S3(e){if(1===e.numberOfChildren&&e.children[vn]){const n=e.children[vn];return new Sn(e.segments.concat(n.segments),n.children)}return e}(new Sn(e.segments,n))}function sp(e){return e instanceof bd}const RC=!1;function M3(e,n,t,i,o){if(0===t.length)return $m(n.root,n.root,n.root,i,o);const l=function BI(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new NI(!0,0,e);let n=0,t=!1;const i=e.reduce((o,l,u)=>{if("object"==typeof l&&null!=l){if(l.outlets){const m={};return Oo(l.outlets,(y,C)=>{m[C]="string"==typeof y?y.split("/"):y}),[...o,{outlets:m}]}if(l.segmentPath)return[...o,l.segmentPath]}return"string"!=typeof l?[...o,l]:0===u?(l.split("/").forEach((m,y)=>{0==y&&"."===m||(0==y&&""===m?t=!0:".."===m?n++:""!=m&&o.push(m))}),o):[...o,l]},[]);return new NI(t,n,i)}(t);return l.toRoot()?$m(n.root,n.root,new Sn([],{}),i,o):function u(y){const C=function A3(e,n,t,i){if(e.isAbsolute)return new Hm(n.root,!0,0);if(-1===i)return new Hm(t,t===n.root,0);return function VI(e,n,t){let i=e,o=n,l=t;for(;l>o;){if(l-=o,i=i.parent,!i)throw new nt(4005,RC&&"Invalid number of '../'");o=i.segments.length}return new Hm(i,!1,o-l)}(t,i+(ay(e.commands[0])?0:1),e.numberOfDoubleDots)}(l,n,e.snapshot?._urlSegment,y),T=C.processChildren?Gm(C.segmentGroup,C.index,l.commands):OC(C.segmentGroup,C.index,l.commands);return $m(n.root,C.segmentGroup,T,i,o)}(e.snapshot?._lastPathIndex)}function ay(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function ly(e){return"object"==typeof e&&null!=e&&e.outlets}function $m(e,n,t,i,o){let u,l={};i&&Oo(i,(y,C)=>{l[C]=Array.isArray(y)?y.map(T=>`${T}`):`${y}`}),u=e===n?t:zI(e,n,t);const m=kC(Hx(u));return new bd(m,l,o)}function zI(e,n,t){const i={};return Oo(e.children,(o,l)=>{i[l]=o===n?t:zI(o,n,t)}),new Sn(e.segments,i)}class NI{constructor(n,t,i){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=i,n&&i.length>0&&ay(i[0]))throw new nt(4003,RC&&"Root segment cannot have matrix parameters");const o=i.find(ly);if(o&&o!==TI(i))throw new nt(4004,RC&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Hm{constructor(n,t,i){this.segmentGroup=n,this.processChildren=t,this.index=i}}function OC(e,n,t){if(e||(e=new Sn([],{})),0===e.segments.length&&e.hasChildren())return Gm(e,n,t);const i=function k3(e,n,t){let i=0,o=n;const l={match:!1,pathIndex:0,commandIndex:0};for(;o<e.segments.length;){if(i>=t.length)return l;const u=e.segments[o],m=t[i];if(ly(m))break;const y=`${m}`,C=i<t.length-1?t[i+1]:null;if(o>0&&void 0===y)break;if(y&&C&&"object"==typeof C&&void 0===C.outlets){if(!UI(y,C,u))return l;i+=2}else{if(!UI(y,{},u))return l;i++}o++}return{match:!0,pathIndex:o,commandIndex:i}}(e,n,t),o=t.slice(i.commandIndex);if(i.match&&i.pathIndex<e.segments.length){const l=new Sn(e.segments.slice(0,i.pathIndex),{});return l.children[vn]=new Sn(e.segments.slice(i.pathIndex),e.children),Gm(l,0,o)}return i.match&&0===o.length?new Sn(e.segments,{}):i.match&&!e.hasChildren()?LC(e,n,t):i.match?Gm(e,0,o):LC(e,n,t)}function Gm(e,n,t){if(0===t.length)return new Sn(e.segments,{});{const i=function P3(e){return ly(e[0])?e[0].outlets:{[vn]:e}}(t),o={};if(!i[vn]&&e.children[vn]&&1===e.numberOfChildren&&0===e.children[vn].segments.length){const l=Gm(e.children[vn],n,t);return new Sn(e.segments,l.children)}return Oo(i,(l,u)=>{"string"==typeof l&&(l=[l]),null!==l&&(o[u]=OC(e.children[u],n,l))}),Oo(e.children,(l,u)=>{void 0===i[u]&&(o[u]=l)}),new Sn(e.segments,o)}}function LC(e,n,t){const i=e.segments.slice(0,n);let o=0;for(;o<t.length;){const l=t[o];if(ly(l)){const y=R3(l.outlets);return new Sn(i,y)}if(0===o&&ay(t[0])){i.push(new ry(e.segments[n].path,jI(t[0]))),o++;continue}const u=ly(l)?l.outlets[vn]:`${l}`,m=o<t.length-1?t[o+1]:null;u&&m&&ay(m)?(i.push(new ry(u,jI(m))),o+=2):(i.push(new ry(u,{})),o++)}return new Sn(i,{})}function R3(e){const n={};return Oo(e,(t,i)=>{"string"==typeof t&&(t=[t]),null!==t&&(n[i]=LC(new Sn([],{}),0,t))}),n}function jI(e){const n={};return Oo(e,(t,i)=>n[i]=`${t}`),n}function UI(e,n,t){return e==t.path&&Vc(n,t.parameters)}const cy="imperative";class jc{constructor(n,t){this.id=n,this.url=t}}class FC extends jc{constructor(n,t,i="imperative",o=null){super(n,t),this.type=0,this.navigationTrigger=i,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ap extends jc{constructor(n,t,i){super(n,t),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Gx extends jc{constructor(n,t,i,o){super(n,t),this.reason=i,this.code=o,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Wx extends jc{constructor(n,t,i,o){super(n,t),this.reason=i,this.code=o,this.type=16}}class zC extends jc{constructor(n,t,i,o){super(n,t),this.error=i,this.target=o,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class O3 extends jc{constructor(n,t,i,o){super(n,t),this.urlAfterRedirects=i,this.state=o,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class L3 extends jc{constructor(n,t,i,o){super(n,t),this.urlAfterRedirects=i,this.state=o,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class F3 extends jc{constructor(n,t,i,o,l){super(n,t),this.urlAfterRedirects=i,this.state=o,this.shouldActivate=l,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class z3 extends jc{constructor(n,t,i,o){super(n,t),this.urlAfterRedirects=i,this.state=o,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class N3 extends jc{constructor(n,t,i,o){super(n,t),this.urlAfterRedirects=i,this.state=o,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class B3{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class V3{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class j3{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class U3{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class $3{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class H3{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class $I{constructor(n,t,i){this.routerEvent=n,this.position=t,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let q3=(()=>{class e{createUrlTree(t,i,o,l,u,m){return M3(t||i.root,o,l,u,m)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})(),X3=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:function(n){return q3.\u0275fac(n)},providedIn:"root"}),e})();class HI{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=NC(n,this._root);return t?t.children.map(i=>i.value):[]}firstChild(n){const t=NC(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=BC(n,this._root);return t.length<2?[]:t[t.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return BC(n,this._root).map(t=>t.value)}}function NC(e,n){if(e===n.value)return n;for(const t of n.children){const i=NC(e,t);if(i)return i}return null}function BC(e,n){if(e===n.value)return[n];for(const t of n.children){const i=BC(e,t);if(i.length)return i.unshift(n),i}return[]}class Vu{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function Wm(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class GI extends HI{constructor(n,t){super(n),this.snapshot=t,VC(this,n)}toString(){return this.snapshot.toString()}}function WI(e,n){const t=function Y3(e,n){const u=new qx([],{},{},"",{},vn,n,null,e.root,-1,{});return new ZI("",new Vu(u,[]))}(e,n),i=new va([new ry("",{})]),o=new va({}),l=new va({}),u=new va({}),m=new va(""),y=new qm(i,o,u,m,l,vn,n,t.root);return y.snapshot=t.root,new GI(new Vu(y,[]),t)}class qm{constructor(n,t,i,o,l,u,m,y){this.url=n,this.params=t,this.queryParams=i,this.fragment=o,this.data=l,this.outlet=u,this.component=m,this.title=this.data?.pipe(ht(C=>C[iy]))??Ht(void 0),this._futureSnapshot=y}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(ht(n=>Um(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(ht(n=>Um(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function qI(e,n="emptyOnly"){const t=e.pathFromRoot;let i=0;if("always"!==n)for(i=t.length-1;i>=1;){const o=t[i],l=t[i-1];if(o.routeConfig&&""===o.routeConfig.path)i--;else{if(l.component)break;i--}}return function K3(e){return e.reduce((n,t)=>({params:{...n.params,...t.params},data:{...n.data,...t.data},resolve:{...t.data,...n.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(i))}class qx{get title(){return this.data?.[iy]}constructor(n,t,i,o,l,u,m,y,C,T,A){this.url=n,this.params=t,this.queryParams=i,this.fragment=o,this.data=l,this.outlet=u,this.component=m,this.routeConfig=y,this._urlSegment=C,this._lastPathIndex=T,this._resolve=A}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Um(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Um(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class ZI extends HI{constructor(n,t){super(t),this.url=n,VC(this,t)}toString(){return XI(this._root)}}function VC(e,n){n.value._routerState=e,n.children.forEach(t=>VC(e,t))}function XI(e){const n=e.children.length>0?` { ${e.children.map(XI).join(", ")} } `:"";return`${e.value}${n}`}function jC(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,Vc(n.queryParams,t.queryParams)||e.queryParams.next(t.queryParams),n.fragment!==t.fragment&&e.fragment.next(t.fragment),Vc(n.params,t.params)||e.params.next(t.params),function h3(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!Vc(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.url.next(t.url),Vc(n.data,t.data)||e.data.next(t.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function UC(e,n){const t=Vc(e.params,n.params)&&function m3(e,n){return op(e,n)&&e.every((t,i)=>Vc(t.parameters,n[i].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||UC(e.parent,n.parent))}function uy(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const i=t.value;i._futureSnapshot=n.value;const o=function Q3(e,n,t){return n.children.map(i=>{for(const o of t.children)if(e.shouldReuseRoute(i.value,o.value.snapshot))return uy(e,i,o);return uy(e,i)})}(e,n,t);return new Vu(i,o)}{if(e.shouldAttach(n.value)){const l=e.retrieve(n.value);if(null!==l){const u=l.route;return u.value._futureSnapshot=n.value,u.children=n.children.map(m=>uy(e,m)),u}}const i=function eV(e){return new qm(new va(e.url),new va(e.params),new va(e.queryParams),new va(e.fragment),new va(e.data),e.outlet,e.component,e)}(n.value),o=n.children.map(l=>uy(e,l));return new Vu(i,o)}}const $C="ngNavigationCancelingError";function YI(e,n){const{redirectTo:t,navigationBehaviorOptions:i}=sp(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,o=KI(!1,0,n);return o.url=t,o.navigationBehaviorOptions=i,o}function KI(e,n,t){const i=new Error("NavigationCancelingError: "+(e||""));return i[$C]=!0,i.cancellationCode=n,t&&(i.url=t),i}function JI(e){return QI(e)&&sp(e.url)}function QI(e){return e&&e[$C]}class tV{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new hy,this.attachRef=null}}let hy=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(t,i){const o=this.getOrCreateContext(t);o.outlet=i,this.contexts.set(t,o)}onChildOutletDestroyed(t){const i=this.getContext(t);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let i=this.getContext(t);return i||(i=new tV,this.contexts.set(t,i)),i}getContext(t){return this.contexts.get(t)||null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Zx=!1;let HC=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=vn,this.activateEvents=new Mi,this.deactivateEvents=new Mi,this.attachEvents=new Mi,this.detachEvents=new Mi,this.parentContexts=cn(hy),this.location=cn(Wl),this.changeDetector=cn(yx),this.environmentInjector=cn(Vs)}ngOnChanges(t){if(t.name){const{firstChange:i,previousValue:o}=t.name;if(i)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new nt(4012,Zx);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new nt(4012,Zx);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new nt(4012,Zx);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,i){this.activated=t,this._activatedRoute=i,this.location.insert(t.hostView),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,i){if(this.isActivated)throw new nt(4013,Zx);this._activatedRoute=t;const o=this.location,u=t.snapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,y=new nV(t,m,o.injector);if(i&&function iV(e){return!!e.resolveComponentFactory}(i)){const C=i.resolveComponentFactory(u);this.activated=o.createComponent(C,o.length,y)}else this.activated=o.createComponent(u,{index:o.length,injector:y,environmentInjector:i??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=Ft({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Wr]}),e})();class nV{constructor(n,t,i){this.route=n,this.childContexts=t,this.parent=i}get(n,t){return n===qm?this.route:n===hy?this.childContexts:this.parent.get(n,t)}}let GC=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=ks({type:e,selectors:[["ng-component"]],standalone:!0,features:[eS],decls:1,vars:0,template:function(t,i){1&t&&Xt(0,"router-outlet")},dependencies:[HC],encapsulation:2}),e})();function eA(e,n){return e.providers&&!e._injector&&(e._injector=cx(e.providers,n,`Route: ${e.path}`)),e._injector??n}function qC(e){const n=e.children&&e.children.map(qC),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==vn&&(t.component=GC),t}function tl(e){return e.outlet||vn}function tA(e,n){const t=e.filter(i=>tl(i)===n);return t.push(...e.filter(i=>tl(i)!==n)),t}function dy(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class lV{constructor(n,t,i,o){this.routeReuseStrategy=n,this.futureState=t,this.currState=i,this.forwardEvent=o}activate(n){const t=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,i,n),jC(this.futureState.root),this.activateChildRoutes(t,i,n)}deactivateChildRoutes(n,t,i){const o=Wm(t);n.children.forEach(l=>{const u=l.value.outlet;this.deactivateRoutes(l,o[u],i),delete o[u]}),Oo(o,(l,u)=>{this.deactivateRouteAndItsChildren(l,i)})}deactivateRoutes(n,t,i){const o=n.value,l=t?t.value:null;if(o===l)if(o.component){const u=i.getContext(o.outlet);u&&this.deactivateChildRoutes(n,t,u.children)}else this.deactivateChildRoutes(n,t,i);else l&&this.deactivateRouteAndItsChildren(t,i)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const i=t.getContext(n.value.outlet),o=i&&n.value.component?i.children:t,l=Wm(n);for(const u of Object.keys(l))this.deactivateRouteAndItsChildren(l[u],o);if(i&&i.outlet){const u=i.outlet.detach(),m=i.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:u,route:n,contexts:m})}}deactivateRouteAndOutlet(n,t){const i=t.getContext(n.value.outlet),o=i&&n.value.component?i.children:t,l=Wm(n);for(const u of Object.keys(l))this.deactivateRouteAndItsChildren(l[u],o);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(n,t,i){const o=Wm(t);n.children.forEach(l=>{this.activateRoutes(l,o[l.value.outlet],i),this.forwardEvent(new H3(l.value.snapshot))}),n.children.length&&this.forwardEvent(new U3(n.value.snapshot))}activateRoutes(n,t,i){const o=n.value,l=t?t.value:null;if(jC(o),o===l)if(o.component){const u=i.getOrCreateContext(o.outlet);this.activateChildRoutes(n,t,u.children)}else this.activateChildRoutes(n,t,i);else if(o.component){const u=i.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const m=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),u.children.onOutletReAttached(m.contexts),u.attachRef=m.componentRef,u.route=m.route.value,u.outlet&&u.outlet.attach(m.componentRef,m.route.value),jC(m.route.value),this.activateChildRoutes(n,null,u.children)}else{const m=dy(o.snapshot),y=m?.get(Qh)??null;u.attachRef=null,u.route=o,u.resolver=y,u.injector=m,u.outlet&&u.outlet.activateWith(o,u.injector),this.activateChildRoutes(n,null,u.children)}}else this.activateChildRoutes(n,null,i)}}class nA{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class Xx{constructor(n,t){this.component=n,this.route=t}}function cV(e,n,t){const i=e._root;return fy(i,n?n._root:null,t,[i.value])}function Zm(e,n){const t=Symbol(),i=n.get(e,t);return i===t?"function"!=typeof e||function Vd(e){return null!==bo(e)}(e)?n.get(e):e:i}function fy(e,n,t,i,o={canDeactivateChecks:[],canActivateChecks:[]}){const l=Wm(n);return e.children.forEach(u=>{(function hV(e,n,t,i,o={canDeactivateChecks:[],canActivateChecks:[]}){const l=e.value,u=n?n.value:null,m=t?t.getContext(e.value.outlet):null;if(u&&l.routeConfig===u.routeConfig){const y=function dV(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!op(e.url,n.url);case"pathParamsOrQueryParamsChange":return!op(e.url,n.url)||!Vc(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!UC(e,n)||!Vc(e.queryParams,n.queryParams);default:return!UC(e,n)}}(u,l,l.routeConfig.runGuardsAndResolvers);y?o.canActivateChecks.push(new nA(i)):(l.data=u.data,l._resolvedData=u._resolvedData),fy(e,n,l.component?m?m.children:null:t,i,o),y&&m&&m.outlet&&m.outlet.isActivated&&o.canDeactivateChecks.push(new Xx(m.outlet.component,u))}else u&&py(n,m,o),o.canActivateChecks.push(new nA(i)),fy(e,null,l.component?m?m.children:null:t,i,o)})(u,l[u.value.outlet],t,i.concat([u.value]),o),delete l[u.value.outlet]}),Oo(l,(u,m)=>py(u,t.getContext(m),o)),o}function py(e,n,t){const i=Wm(e),o=e.value;Oo(i,(l,u)=>{py(l,o.component?n?n.children.getContext(u):null:n,t)}),t.canDeactivateChecks.push(new Xx(o.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,o))}function my(e){return"function"==typeof e}function ZC(e){return e instanceof Fx||"EmptyError"===e?.name}const Yx=Symbol("INITIAL_VALUE");function Xm(){return Nc(e=>_I(e.map(n=>n.pipe(jm(1),function r3(...e){const n=fl(e);return gi((t,i)=>{(n?TC(e,t,n):TC(e,t)).subscribe(i)})}(Yx)))).pipe(ht(n=>{for(const t of n)if(!0!==t){if(t===Yx)return Yx;if(!1===t||t instanceof bd)return t}return!0}),Bc(n=>n!==Yx),jm(1)))}function iA(e){return function hn(...e){return cl(e)}(to(n=>{if(sp(n))throw YI(0,n)}),ht(n=>!0===n))}const XC={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function rA(e,n,t,i,o){const l=YC(e,n,t);return l.matched?function IV(e,n,t,i){const o=n.canMatch;return o&&0!==o.length?Ht(o.map(u=>{const m=Zm(u,e);return xd(function yV(e){return e&&my(e.canMatch)}(m)?m.canMatch(n,t):e.runInContext(()=>m(n,t)))})).pipe(Xm(),iA()):Ht(!0)}(i=eA(n,i),n,t).pipe(ht(u=>!0===u?l:{...XC})):Ht(l)}function YC(e,n,t){if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...XC}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const o=(n.matcher||u3)(t,e,n);if(!o)return{...XC};const l={};Oo(o.posParams,(m,y)=>{l[y]=m.path});const u=o.consumed.length>0?{...l,...o.consumed[o.consumed.length-1].parameters}:l;return{matched:!0,consumedSegments:o.consumed,remainingSegments:t.slice(o.consumed.length),parameters:u,positionalParamSegments:o.posParams??{}}}function Kx(e,n,t,i){if(t.length>0&&function kV(e,n,t){return t.some(i=>Jx(e,n,i)&&tl(i)!==vn)}(e,t,i)){const l=new Sn(n,function PV(e,n,t,i){const o={};o[vn]=i,i._sourceSegment=e,i._segmentIndexShift=n.length;for(const l of t)if(""===l.path&&tl(l)!==vn){const u=new Sn([],{});u._sourceSegment=e,u._segmentIndexShift=n.length,o[tl(l)]=u}return o}(e,n,i,new Sn(t,e.children)));return l._sourceSegment=e,l._segmentIndexShift=n.length,{segmentGroup:l,slicedSegments:[]}}if(0===t.length&&function RV(e,n,t){return t.some(i=>Jx(e,n,i))}(e,t,i)){const l=new Sn(e.segments,function AV(e,n,t,i,o){const l={};for(const u of i)if(Jx(e,t,u)&&!o[tl(u)]){const m=new Sn([],{});m._sourceSegment=e,m._segmentIndexShift=n.length,l[tl(u)]=m}return{...o,...l}}(e,n,t,i,e.children));return l._sourceSegment=e,l._segmentIndexShift=n.length,{segmentGroup:l,slicedSegments:t}}const o=new Sn(e.segments,e.children);return o._sourceSegment=e,o._segmentIndexShift=n.length,{segmentGroup:o,slicedSegments:t}}function Jx(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}function oA(e,n,t,i){return!!(tl(e)===i||i!==vn&&Jx(n,t,e))&&("**"===e.path||YC(n,e,t).matched)}function sA(e,n,t){return 0===n.length&&!e.children[t]}const Qx=!1;class eb{constructor(n){this.segmentGroup=n||null}}class aA{constructor(n){this.urlTree=n}}function gy(e){return ny(new eb(e))}function lA(e){return ny(new aA(e))}class zV{constructor(n,t,i,o,l){this.injector=n,this.configLoader=t,this.urlSerializer=i,this.urlTree=o,this.config=l,this.allowRedirects=!0}apply(){const n=Kx(this.urlTree.root,[],[],this.config).segmentGroup,t=new Sn(n.segments,n.children);return this.expandSegmentGroup(this.injector,this.config,t,vn).pipe(ht(l=>this.createUrlTree(Hx(l),this.urlTree.queryParams,this.urlTree.fragment))).pipe(vd(l=>{if(l instanceof aA)return this.allowRedirects=!1,this.match(l.urlTree);throw l instanceof eb?this.noMatchError(l):l}))}match(n){return this.expandSegmentGroup(this.injector,this.config,n.root,vn).pipe(ht(o=>this.createUrlTree(Hx(o),n.queryParams,n.fragment))).pipe(vd(o=>{throw o instanceof eb?this.noMatchError(o):o}))}noMatchError(n){return new nt(4002,Qx)}createUrlTree(n,t,i){const o=kC(n);return new bd(o,t,i)}expandSegmentGroup(n,t,i,o){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(n,t,i).pipe(ht(l=>new Sn([],l))):this.expandSegment(n,i,t,i.segments,o,!0)}expandChildren(n,t,i){const o=[];for(const l of Object.keys(i.children))"primary"===l?o.unshift(l):o.push(l);return Li(o).pipe(yd(l=>{const u=i.children[l],m=tA(t,l);return this.expandSegmentGroup(n,m,u,l).pipe(ht(y=>({segment:y,outlet:l})))}),wI((l,u)=>(l[u.outlet]=u.segment,l),{}),CI())}expandSegment(n,t,i,o,l,u){return Li(i).pipe(yd(m=>this.expandSegmentAgainstRoute(n,t,i,m,o,l,u).pipe(vd(C=>{if(C instanceof eb)return Ht(null);throw C}))),_d(m=>!!m),vd((m,y)=>{if(ZC(m))return sA(t,o,l)?Ht(new Sn([],{})):gy(t);throw m}))}expandSegmentAgainstRoute(n,t,i,o,l,u,m){return oA(o,t,l,u)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(n,t,o,l,u):m&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,t,i,o,l,u):gy(t):gy(t)}expandSegmentAgainstRouteUsingRedirect(n,t,i,o,l,u){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,i,o,u):this.expandRegularSegmentAgainstRouteUsingRedirect(n,t,i,o,l,u)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,t,i,o){const l=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?lA(l):this.lineralizeSegments(i,l).pipe(Lt(u=>{const m=new Sn(u,{});return this.expandSegment(n,m,t,u,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,t,i,o,l,u){const{matched:m,consumedSegments:y,remainingSegments:C,positionalParamSegments:T}=YC(t,o,l);if(!m)return gy(t);const A=this.applyRedirectCommands(y,o.redirectTo,T);return o.redirectTo.startsWith("/")?lA(A):this.lineralizeSegments(o,A).pipe(Lt(z=>this.expandSegment(n,t,i,z.concat(C),u,!1)))}matchSegmentAgainstRoute(n,t,i,o,l){return"**"===i.path?(n=eA(i,n),i.loadChildren?(i._loadedRoutes?Ht({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(n,i)).pipe(ht(m=>(i._loadedRoutes=m.routes,i._loadedInjector=m.injector,new Sn(o,{})))):Ht(new Sn(o,{}))):rA(t,i,o,n).pipe(Nc(({matched:u,consumedSegments:m,remainingSegments:y})=>u?this.getChildConfig(n=i._injector??n,i,o).pipe(Lt(T=>{const A=T.injector??n,z=T.routes,{segmentGroup:V,slicedSegments:H}=Kx(t,m,y,z),X=new Sn(V.segments,V.children);if(0===H.length&&X.hasChildren())return this.expandChildren(A,z,X).pipe(ht(ve=>new Sn(m,ve)));if(0===z.length&&0===H.length)return Ht(new Sn(m,{}));const oe=tl(i)===l;return this.expandSegment(A,X,z,H,oe?vn:l,!0).pipe(ht(we=>new Sn(m.concat(we.segments),we.children)))})):gy(t)))}getChildConfig(n,t,i){return t.children?Ht({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?Ht({routes:t._loadedRoutes,injector:t._loadedInjector}):function MV(e,n,t,i){const o=n.canLoad;return void 0===o||0===o.length?Ht(!0):Ht(o.map(u=>{const m=Zm(u,e);return xd(function pV(e){return e&&my(e.canLoad)}(m)?m.canLoad(n,t):e.runInContext(()=>m(n,t)))})).pipe(Xm(),iA())}(n,t,i).pipe(Lt(o=>o?this.configLoader.loadChildren(n,t).pipe(to(l=>{t._loadedRoutes=l.routes,t._loadedInjector=l.injector})):function LV(e){return ny(KI(Qx,3))}())):Ht({routes:[],injector:n})}lineralizeSegments(n,t){let i=[],o=t.root;for(;;){if(i=i.concat(o.segments),0===o.numberOfChildren)return Ht(i);if(o.numberOfChildren>1||!o.children[vn])return n.redirectTo,ny(new nt(4e3,Qx));o=o.children[vn]}}applyRedirectCommands(n,t,i){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,i)}applyRedirectCreateUrlTree(n,t,i,o){const l=this.createSegmentGroup(n,t.root,i,o);return new bd(l,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const i={};return Oo(n,(o,l)=>{if("string"==typeof o&&o.startsWith(":")){const m=o.substring(1);i[l]=t[m]}else i[l]=o}),i}createSegmentGroup(n,t,i,o){const l=this.createSegments(n,t.segments,i,o);let u={};return Oo(t.children,(m,y)=>{u[y]=this.createSegmentGroup(n,m,i,o)}),new Sn(l,u)}createSegments(n,t,i,o){return t.map(l=>l.path.startsWith(":")?this.findPosParam(n,l,o):this.findOrReturn(l,i))}findPosParam(n,t,i){const o=i[t.path.substring(1)];if(!o)throw new nt(4001,Qx);return o}findOrReturn(n,t){let i=0;for(const o of t){if(o.path===n.path)return t.splice(i),o;i++}return n}}class BV{}class UV{constructor(n,t,i,o,l,u,m){this.injector=n,this.rootComponentType=t,this.config=i,this.urlTree=o,this.url=l,this.paramsInheritanceStrategy=u,this.urlSerializer=m}recognize(){const n=Kx(this.urlTree.root,[],[],this.config.filter(t=>void 0===t.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,vn).pipe(ht(t=>{if(null===t)return null;const i=new qx([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},vn,this.rootComponentType,null,this.urlTree.root,-1,{}),o=new Vu(i,t),l=new ZI(this.url,o);return this.inheritParamsAndData(l._root),l}))}inheritParamsAndData(n){const t=n.value,i=qI(t,this.paramsInheritanceStrategy);t.params=Object.freeze(i.params),t.data=Object.freeze(i.data),n.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(n,t,i,o){return 0===i.segments.length&&i.hasChildren()?this.processChildren(n,t,i):this.processSegment(n,t,i,i.segments,o)}processChildren(n,t,i){return Li(Object.keys(i.children)).pipe(yd(o=>{const l=i.children[o],u=tA(t,o);return this.processSegmentGroup(n,u,l,o)}),wI((o,l)=>o&&l?(o.push(...l),o):null),function a3(e,n=!1){return gi((t,i)=>{let o=0;t.subscribe(Yn(i,l=>{const u=e(l,o++);(u||n)&&i.next(l),!u&&i.complete()}))})}(o=>null!==o),zx(null),CI(),ht(o=>{if(null===o)return null;const l=uA(o);return function $V(e){e.sort((n,t)=>n.value.outlet===vn?-1:t.value.outlet===vn?1:n.value.outlet.localeCompare(t.value.outlet))}(l),l}))}processSegment(n,t,i,o,l){return Li(t).pipe(yd(u=>this.processSegmentAgainstRoute(u._injector??n,u,i,o,l)),_d(u=>!!u),vd(u=>{if(ZC(u))return sA(i,o,l)?Ht([]):Ht(null);throw u}))}processSegmentAgainstRoute(n,t,i,o,l){if(t.redirectTo||!oA(t,i,o,l))return Ht(null);let u;if("**"===t.path){const m=o.length>0?TI(o).parameters:{},y=dA(i)+o.length;u=Ht({snapshot:new qx(o,m,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,fA(t),tl(t),t.component??t._loadedComponent??null,t,hA(i),y,pA(t)),consumedSegments:[],remainingSegments:[]})}else u=rA(i,t,o,n).pipe(ht(({matched:m,consumedSegments:y,remainingSegments:C,parameters:T})=>{if(!m)return null;const A=dA(i)+y.length;return{snapshot:new qx(y,T,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,fA(t),tl(t),t.component??t._loadedComponent??null,t,hA(i),A,pA(t)),consumedSegments:y,remainingSegments:C}}));return u.pipe(Nc(m=>{if(null===m)return Ht(null);const{snapshot:y,consumedSegments:C,remainingSegments:T}=m;n=t._injector??n;const A=t._loadedInjector??n,z=function HV(e){return e.children?e.children:e.loadChildren?e._loadedRoutes:[]}(t),{segmentGroup:V,slicedSegments:H}=Kx(i,C,T,z.filter(oe=>void 0===oe.redirectTo));if(0===H.length&&V.hasChildren())return this.processChildren(A,z,V).pipe(ht(oe=>null===oe?null:[new Vu(y,oe)]));if(0===z.length&&0===H.length)return Ht([new Vu(y,[])]);const X=tl(t)===l;return this.processSegment(A,z,V,H,X?vn:l).pipe(ht(oe=>null===oe?null:[new Vu(y,oe)]))}))}}function GV(e){const n=e.value.routeConfig;return n&&""===n.path&&void 0===n.redirectTo}function uA(e){const n=[],t=new Set;for(const i of e){if(!GV(i)){n.push(i);continue}const o=n.find(l=>i.value.routeConfig===l.value.routeConfig);void 0!==o?(o.children.push(...i.children),t.add(o)):n.push(i)}for(const i of t){const o=uA(i.children);n.push(new Vu(i.value,o))}return n.filter(i=>!t.has(i))}function hA(e){let n=e;for(;n._sourceSegment;)n=n._sourceSegment;return n}function dA(e){let n=e,t=n._segmentIndexShift??0;for(;n._sourceSegment;)n=n._sourceSegment,t+=n._segmentIndexShift??0;return t-1}function fA(e){return e.data||{}}function pA(e){return e.resolve||{}}function mA(e){return"string"==typeof e.title||null===e.title}function KC(e){return Nc(n=>{const t=e(n);return t?Li(t).pipe(ht(()=>n)):Ht(n)})}const Ym=new Mt("ROUTES");let JC=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=cn(GS)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return Ht(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const i=xd(t.loadComponent()).pipe(ht(_A),to(l=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=l}),IC(()=>{this.componentLoaders.delete(t)})),o=new xI(i,()=>new ro).pipe(SC());return this.componentLoaders.set(t,o),o}loadChildren(t,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Ht({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const l=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(ht(m=>{this.onLoadEndListener&&this.onLoadEndListener(i);let y,C,T=!1;Array.isArray(m)?C=m:(y=m.create(t).injector,C=DI(y.get(Ym,[],Nt.Self|Nt.Optional)));return{routes:C.map(qC),injector:y}}),IC(()=>{this.childrenLoaders.delete(i)})),u=new xI(l,()=>new ro).pipe(SC());return this.childrenLoaders.set(i,u),u}loadModuleFactoryOrRoutes(t){return xd(t()).pipe(ht(_A),Lt(i=>i instanceof JT||Array.isArray(i)?Ht(i):Li(this.compiler.compileModuleAsync(i))))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function _A(e){return function QV(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let nb=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new ro,this.configLoader=cn(JC),this.environmentInjector=cn(Vs),this.urlSerializer=cn(oy),this.rootContexts=cn(hy),this.navigationId=0,this.afterPreactivation=()=>Ht(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=o=>this.events.next(new V3(o)),this.configLoader.onLoadStartListener=o=>this.events.next(new B3(o))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const i=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:i})}setupNavigations(t){return this.transitions=new va({id:0,targetPageId:0,currentUrlTree:t.currentUrlTree,currentRawUrl:t.currentUrlTree,extractedUrl:t.urlHandlingStrategy.extract(t.currentUrlTree),urlAfterRedirects:t.urlHandlingStrategy.extract(t.currentUrlTree),rawUrl:t.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:cy,restoredState:null,currentSnapshot:t.routerState.snapshot,targetSnapshot:null,currentRouterState:t.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Bc(i=>0!==i.id),ht(i=>({...i,extractedUrl:t.urlHandlingStrategy.extract(i.rawUrl)})),Nc(i=>{let o=!1,l=!1;return Ht(i).pipe(to(u=>{this.currentNavigation={id:u.id,initialUrl:u.rawUrl,extractedUrl:u.extractedUrl,trigger:u.source,extras:u.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Nc(u=>{const m=t.browserUrlTree.toString(),y=!t.navigated||u.extractedUrl.toString()!==m||m!==t.currentUrlTree.toString();if(!y&&"reload"!==(u.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const T="";return this.events.next(new Wx(u.id,t.serializeUrl(i.rawUrl),T,0)),t.rawUrlTree=u.rawUrl,u.resolve(null),so}if(t.urlHandlingStrategy.shouldProcessUrl(u.rawUrl))return yA(u.source)&&(t.browserUrlTree=u.extractedUrl),Ht(u).pipe(Nc(T=>{const A=this.transitions?.getValue();return this.events.next(new FC(T.id,this.urlSerializer.serialize(T.extractedUrl),T.source,T.restoredState)),A!==this.transitions?.getValue()?so:Promise.resolve(T)}),function NV(e,n,t,i){return Nc(o=>function FV(e,n,t,i,o){return new zV(e,n,t,i,o).apply()}(e,n,t,o.extractedUrl,i).pipe(ht(l=>({...o,urlAfterRedirects:l}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,t.config),to(T=>{this.currentNavigation={...this.currentNavigation,finalUrl:T.urlAfterRedirects},i.urlAfterRedirects=T.urlAfterRedirects}),function qV(e,n,t,i,o){return Lt(l=>function jV(e,n,t,i,o,l,u="emptyOnly"){return new UV(e,n,t,i,o,u,l).recognize().pipe(Nc(m=>null===m?function VV(e){return new fn(n=>n.error(e))}(new BV):Ht(m)))}(e,n,t,l.urlAfterRedirects,i.serialize(l.urlAfterRedirects),i,o).pipe(ht(u=>({...l,targetSnapshot:u}))))}(this.environmentInjector,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),to(T=>{if(i.targetSnapshot=T.targetSnapshot,"eager"===t.urlUpdateStrategy){if(!T.extras.skipLocationChange){const z=t.urlHandlingStrategy.merge(T.urlAfterRedirects,T.rawUrl);t.setBrowserUrl(z,T)}t.browserUrlTree=T.urlAfterRedirects}const A=new O3(T.id,this.urlSerializer.serialize(T.extractedUrl),this.urlSerializer.serialize(T.urlAfterRedirects),T.targetSnapshot);this.events.next(A)}));if(y&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){const{id:T,extractedUrl:A,source:z,restoredState:V,extras:H}=u,X=new FC(T,this.urlSerializer.serialize(A),z,V);this.events.next(X);const oe=WI(A,this.rootComponentType).snapshot;return Ht(i={...u,targetSnapshot:oe,urlAfterRedirects:A,extras:{...H,skipLocationChange:!1,replaceUrl:!1}})}{const T="";return this.events.next(new Wx(u.id,t.serializeUrl(i.extractedUrl),T,1)),t.rawUrlTree=u.rawUrl,u.resolve(null),so}}),to(u=>{const m=new L3(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(m)}),ht(u=>i={...u,guards:cV(u.targetSnapshot,u.currentSnapshot,this.rootContexts)}),function xV(e,n){return Lt(t=>{const{targetSnapshot:i,currentSnapshot:o,guards:{canActivateChecks:l,canDeactivateChecks:u}}=t;return 0===u.length&&0===l.length?Ht({...t,guardsResult:!0}):function bV(e,n,t,i){return Li(e).pipe(Lt(o=>function SV(e,n,t,i,o){const l=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return l&&0!==l.length?Ht(l.map(m=>{const y=dy(n)??o,C=Zm(m,y);return xd(function _V(e){return e&&my(e.canDeactivate)}(C)?C.canDeactivate(e,n,t,i):y.runInContext(()=>C(e,n,t,i))).pipe(_d())})).pipe(Xm()):Ht(!0)}(o.component,o.route,t,n,i)),_d(o=>!0!==o,!0))}(u,i,o,e).pipe(Lt(m=>m&&function fV(e){return"boolean"==typeof e}(m)?function wV(e,n,t,i){return Li(n).pipe(yd(o=>TC(function EV(e,n){return null!==e&&n&&n(new j3(e)),Ht(!0)}(o.route.parent,i),function CV(e,n){return null!==e&&n&&n(new $3(e)),Ht(!0)}(o.route,i),function TV(e,n,t){const i=n[n.length-1],l=n.slice(0,n.length-1).reverse().map(u=>function uV(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(u)).filter(u=>null!==u).map(u=>vI(()=>Ht(u.guards.map(y=>{const C=dy(u.node)??t,T=Zm(y,C);return xd(function gV(e){return e&&my(e.canActivateChild)}(T)?T.canActivateChild(i,e):C.runInContext(()=>T(i,e))).pipe(_d())})).pipe(Xm())));return Ht(l).pipe(Xm())}(e,o.path,t),function DV(e,n,t){const i=n.routeConfig?n.routeConfig.canActivate:null;if(!i||0===i.length)return Ht(!0);const o=i.map(l=>vI(()=>{const u=dy(n)??t,m=Zm(l,u);return xd(function mV(e){return e&&my(e.canActivate)}(m)?m.canActivate(n,e):u.runInContext(()=>m(n,e))).pipe(_d())}));return Ht(o).pipe(Xm())}(e,o.route,t))),_d(o=>!0!==o,!0))}(i,l,e,n):Ht(m)),ht(m=>({...t,guardsResult:m})))})}(this.environmentInjector,u=>this.events.next(u)),to(u=>{if(i.guardsResult=u.guardsResult,sp(u.guardsResult))throw YI(0,u.guardsResult);const m=new F3(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot,!!u.guardsResult);this.events.next(m)}),Bc(u=>!!u.guardsResult||(t.restoreHistory(u),this.cancelNavigationTransition(u,"",3),!1)),KC(u=>{if(u.guards.canActivateChecks.length)return Ht(u).pipe(to(m=>{const y=new z3(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(y)}),Nc(m=>{let y=!1;return Ht(m).pipe(function ZV(e,n){return Lt(t=>{const{targetSnapshot:i,guards:{canActivateChecks:o}}=t;if(!o.length)return Ht(t);let l=0;return Li(o).pipe(yd(u=>function XV(e,n,t,i){const o=e.routeConfig,l=e._resolve;return void 0!==o?.title&&!mA(o)&&(l[iy]=o.title),function YV(e,n,t,i){const o=function KV(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===o.length)return Ht({});const l={};return Li(o).pipe(Lt(u=>function JV(e,n,t,i){const o=dy(n)??i,l=Zm(e,o);return xd(l.resolve?l.resolve(n,t):o.runInContext(()=>l(n,t)))}(e[u],n,t,i).pipe(_d(),to(m=>{l[u]=m}))),MC(1),function l3(e){return ht(()=>e)}(l),vd(u=>ZC(u)?so:ny(u)))}(l,e,n,i).pipe(ht(u=>(e._resolvedData=u,e.data=qI(e,t).resolve,o&&mA(o)&&(e.data[iy]=o.title),null)))}(u.route,i,e,n)),to(()=>l++),MC(1),Lt(u=>l===o.length?Ht(t):so))})}(t.paramsInheritanceStrategy,this.environmentInjector),to({next:()=>y=!0,complete:()=>{y||(t.restoreHistory(m),this.cancelNavigationTransition(m,"",2))}}))}),to(m=>{const y=new N3(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(y)}))}),KC(u=>{const m=y=>{const C=[];y.routeConfig?.loadComponent&&!y.routeConfig._loadedComponent&&C.push(this.configLoader.loadComponent(y.routeConfig).pipe(to(T=>{y.component=T}),ht(()=>{})));for(const T of y.children)C.push(...m(T));return C};return _I(m(u.targetSnapshot.root)).pipe(zx(),jm(1))}),KC(()=>this.afterPreactivation()),ht(u=>{const m=function J3(e,n,t){const i=uy(e,n._root,t?t._root:void 0);return new GI(i,n)}(t.routeReuseStrategy,u.targetSnapshot,u.currentRouterState);return i={...u,targetRouterState:m}}),to(u=>{t.currentUrlTree=u.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(u.urlAfterRedirects,u.rawUrl),t.routerState=u.targetRouterState,"deferred"===t.urlUpdateStrategy&&(u.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,u),t.browserUrlTree=u.urlAfterRedirects)}),((e,n,t)=>ht(i=>(new lV(n,i.targetRouterState,i.currentRouterState,t).activate(e),i)))(this.rootContexts,t.routeReuseStrategy,u=>this.events.next(u)),jm(1),to({next:u=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,t.navigated=!0,this.events.next(new ap(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(t.currentUrlTree))),t.titleStrategy?.updateTitle(u.targetRouterState.snapshot),u.resolve(!0)},complete:()=>{o=!0}}),IC(()=>{o||l||this.cancelNavigationTransition(i,"",1),this.currentNavigation?.id===i.id&&(this.currentNavigation=null)}),vd(u=>{if(l=!0,QI(u)){JI(u)||(t.navigated=!0,t.restoreHistory(i,!0));const m=new Gx(i.id,this.urlSerializer.serialize(i.extractedUrl),u.message,u.cancellationCode);if(this.events.next(m),JI(u)){const y=t.urlHandlingStrategy.merge(u.url,t.rawUrlTree),C={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===t.urlUpdateStrategy||yA(i.source)};t.scheduleNavigation(y,cy,null,C,{resolve:i.resolve,reject:i.reject,promise:i.promise})}else i.resolve(!1)}else{t.restoreHistory(i,!0);const m=new zC(i.id,this.urlSerializer.serialize(i.extractedUrl),u,i.targetSnapshot??void 0);this.events.next(m);try{i.resolve(t.errorHandler(u))}catch(y){i.reject(y)}}return so}))}))}cancelNavigationTransition(t,i,o){const l=new Gx(t.id,this.urlSerializer.serialize(t.extractedUrl),i,o);this.events.next(l),t.resolve(!1)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function yA(e){return e!==cy}let vA=(()=>{class e{buildTitle(t){let i,o=t.root;for(;void 0!==o;)i=this.getResolvedTitleForRoute(o)??i,o=o.children.find(l=>l.outlet===vn);return i}getResolvedTitleForRoute(t){return t.data[iy]}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:function(){return cn(ej)},providedIn:"root"}),e})(),ej=(()=>{class e extends vA{constructor(t){super(),this.title=t}updateTitle(t){const i=this.buildTitle(t);void 0!==i&&this.title.setTitle(i)}}return e.\u0275fac=function(t){return new(t||e)(Dt(dI))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),tj=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:function(){return cn(ij)},providedIn:"root"}),e})();class nj{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let ij=(()=>{class e extends nj{}return e.\u0275fac=function(){let n;return function(i){return(n||(n=Xr(e)))(i||e)}}(),e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const ib=new Mt("",{providedIn:"root",factory:()=>({})});let oj=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:function(){return cn(sj)},providedIn:"root"}),e})(),sj=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,i){return t}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function aj(e){throw e}function lj(e,n,t){return n.parse("/")}const cj={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},uj={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Gs=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=cn(VF),this.isNgZoneEnabled=!1,this.options=cn(ib,{optional:!0})||{},this.errorHandler=this.options.errorHandler||aj,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||lj,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=cn(oj),this.routeReuseStrategy=cn(tj),this.urlCreationStrategy=cn(X3),this.titleStrategy=cn(vA),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=DI(cn(Ym,{optional:!0})??[]),this.navigationTransitions=cn(nb),this.urlSerializer=cn(oy),this.location=cn(eC),this.isNgZoneEnabled=cn(ir)instanceof ir&&ir.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new bd,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=WI(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId??0},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),cy,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const i="popstate"===t.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,i,t.state)},0)}))}navigateToSyncWithBrowser(t,i,o){const l={replaceUrl:!0},u=o?.navigationId?o:null;if(o){const y={...o};delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(l.state=y)}const m=this.parseUrl(t);this.scheduleNavigation(m,i,u,l)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(t){this.config=t.map(qC),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,i={}){const{relativeTo:o,queryParams:l,fragment:u,queryParamsHandling:m,preserveFragment:y}=i,C=y?this.currentUrlTree.fragment:u;let T=null;switch(m){case"merge":T={...this.currentUrlTree.queryParams,...l};break;case"preserve":T=this.currentUrlTree.queryParams;break;default:T=l||null}return null!==T&&(T=this.removeEmptyProps(T)),this.urlCreationStrategy.createUrlTree(o,this.routerState,this.currentUrlTree,t,T,C??null)}navigateByUrl(t,i={skipLocationChange:!1}){const o=sp(t)?t:this.parseUrl(t),l=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(l,cy,null,i)}navigate(t,i={skipLocationChange:!1}){return function hj(e){for(let n=0;n<e.length;n++){const t=e[n];if(null==t)throw new nt(4008,false)}}(t),this.navigateByUrl(this.createUrlTree(t,i),i)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let i;try{i=this.urlSerializer.parse(t)}catch(o){i=this.malformedUriErrorHandler(o,this.urlSerializer,t)}return i}isActive(t,i){let o;if(o=!0===i?{...cj}:!1===i?{...uj}:i,sp(t))return MI(this.currentUrlTree,t,o);const l=this.parseUrl(t);return MI(this.currentUrlTree,l,o)}removeEmptyProps(t){return Object.keys(t).reduce((i,o)=>{const l=t[o];return null!=l&&(i[o]=l),i},{})}scheduleNavigation(t,i,o,l,u){if(this.disposed)return Promise.resolve(!1);let m,y,C,T;return u?(m=u.resolve,y=u.reject,C=u.promise):C=new Promise((A,z)=>{m=A,y=z}),T="computed"===this.canceledNavigationResolution?o&&o.\u0275routerPageId?o.\u0275routerPageId:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:T,source:i,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:l,resolve:m,reject:y,promise:C,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),C.catch(A=>Promise.reject(A))}setBrowserUrl(t,i){const o=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(o)||i.extras.replaceUrl){const u={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId)};this.location.replaceState(o,"",u)}else{const l={...i.extras.state,...this.generateNgRouterState(i.id,i.targetPageId)};this.location.go(o,"",l)}}restoreHistory(t,i=!1){if("computed"===this.canceledNavigationResolution){const l=this.currentPageId-(this.browserPageId??this.currentPageId);0!==l?this.location.historyGo(l):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===l&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,i){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:i}:{navigationId:t}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Km=(()=>{class e{constructor(t,i,o,l,u,m){this.router=t,this.route=i,this.tabIndexAttribute=o,this.renderer=l,this.el=u,this.locationStrategy=m,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new ro;const y=u.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===y||"area"===y,this.isAnchorElement?this.subscription=t.events.subscribe(C=>{C instanceof ap&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(t){this._preserveFragment=Bm(t)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(t){this._skipLocationChange=Bm(t)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(t){this._replaceUrl=Bm(t)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(t){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){null!=t?(this.commands=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(t,i,o,l,u){return!!(null===this.urlTree||this.isAnchorElement&&(0!==t||i||o||l||u||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const t=null===this.href?null:function Kr(e,n,t){return function Wv(e,n){return"src"===n&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===n&&("base"===e||"link"===e)?Hv:Zh}(n,t)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",t)}applyAttributeValue(t,i){const o=this.renderer,l=this.el.nativeElement;null!==i?o.setAttribute(l,t,i):o.removeAttribute(l,t)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return e.\u0275fac=function(t){return new(t||e)(Qe(Gs),Qe(qm),function Ll(e){return function rv(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const t=e.attrs;if(t){const i=t.length;let o=0;for(;o<i;){const l=t[o];if(Vn(l))break;if(0===l)o+=2;else if("number"==typeof l)for(o++;o<i&&"string"==typeof t[o];)o++;else{if(l===n)return t[o+1];o+=2}}}return null}(gr(),e)}("tabindex"),Qe(jl),Qe(Ao),Qe(rp))},e.\u0275dir=Ft({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(t,i){1&t&&Un("click",function(l){return i.onClick(l.button,l.ctrlKey,l.shiftKey,l.altKey,l.metaKey)}),2&t&&Ge("target",i.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[Wr]}),e})();class xA{}let pj=(()=>{class e{constructor(t,i,o,l,u){this.router=t,this.injector=o,this.preloadingStrategy=l,this.loader=u}setUpPreloading(){this.subscription=this.router.events.pipe(Bc(t=>t instanceof ap),yd(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,i){const o=[];for(const l of i){l.providers&&!l._injector&&(l._injector=cx(l.providers,t,`Route: ${l.path}`));const u=l._injector??t,m=l._loadedInjector??u;(l.loadChildren&&!l._loadedRoutes&&void 0===l.canLoad||l.loadComponent&&!l._loadedComponent)&&o.push(this.preloadConfig(u,l)),(l.children||l._loadedRoutes)&&o.push(this.processRoutes(m,l.children??l._loadedRoutes))}return Li(o).pipe(Ia())}preloadConfig(t,i){return this.preloadingStrategy.preload(i,()=>{let o;o=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(t,i):Ht(null);const l=o.pipe(Lt(u=>null===u?Ht(void 0):(i._loadedRoutes=u.routes,i._loadedInjector=u.injector,this.processRoutes(u.injector??t,u.routes))));return i.loadComponent&&!i._loadedComponent?Li([l,this.loader.loadComponent(i)]).pipe(Ia()):l})}}return e.\u0275fac=function(t){return new(t||e)(Dt(Gs),Dt(GS),Dt(Vs),Dt(xA),Dt(JC))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const eE=new Mt("");let bA=(()=>{class e{constructor(t,i,o,l,u={}){this.urlSerializer=t,this.transitions=i,this.viewportScroller=o,this.zone=l,this.options=u,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},u.scrollPositionRestoration=u.scrollPositionRestoration||"disabled",u.anchorScrolling=u.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof FC?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof ap&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof $I&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new $I(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return e.\u0275fac=function(t){!function D_(){throw new Error("invalid")}()},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();var xa=(()=>((xa=xa||{})[xa.COMPLETE=0]="COMPLETE",xa[xa.FAILED=1]="FAILED",xa[xa.REDIRECTING=2]="REDIRECTING",xa))();const Jm=!1;function wd(e,n){return{\u0275kind:e,\u0275providers:n}}const tE=new Mt("",{providedIn:"root",factory:()=>!1});function CA(){const e=cn(Wa);return n=>{const t=e.get(gx);if(n!==t.components[0])return;const i=e.get(Gs),o=e.get(EA);1===e.get(nE)&&i.initialNavigation(),e.get(DA,null,Nt.Optional)?.setUpPreloading(),e.get(eE,null,Nt.Optional)?.init(),i.resetRootComponentType(t.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}const EA=new Mt(Jm?"bootstrap done indicator":"",{factory:()=>new ro}),nE=new Mt(Jm?"initial navigation":"",{providedIn:"root",factory:()=>1});function vj(){let e=[];return e=Jm?[{provide:Ff,multi:!0,useFactory:()=>{const n=cn(Gs);return()=>n.events.subscribe(t=>{console.group?.(`Router Event: ${t.constructor.name}`),console.log(function G3(e){if(!("type"in e))return`Unknown Router Event: ${e.constructor.name}`;switch(e.type){case 14:return`ActivationEnd(path: '${e.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${e.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${e.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${e.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state}, shouldActivate: ${e.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 2:return`NavigationCancel(id: ${e.id}, url: '${e.url}')`;case 16:return`NavigationSkipped(id: ${e.id}, url: '${e.url}')`;case 1:return`NavigationEnd(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${e.id}, url: '${e.url}', error: ${e.error})`;case 0:return`NavigationStart(id: ${e.id}, url: '${e.url}')`;case 6:return`ResolveEnd(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 5:return`ResolveStart(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 10:return`RouteConfigLoadEnd(path: ${e.route.path})`;case 9:return`RouteConfigLoadStart(path: ${e.route.path})`;case 4:return`RoutesRecognized(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 15:return`Scroll(anchor: '${e.anchor}', position: '${e.position?`${e.position[0]}, ${e.position[1]}`:null}')`}}(t)),console.log(t),console.groupEnd?.()})}}]:[],wd(1,e)}const DA=new Mt(Jm?"router preloader":"");function xj(e){return wd(0,[{provide:DA,useExisting:pj},{provide:xA,useExisting:e}])}const _y=!1,TA=new Mt(_y?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),bj=[eC,{provide:oy,useClass:AC},Gs,hy,{provide:qm,useFactory:function wA(e){return e.routerState.root},deps:[Gs]},JC,_y?{provide:tE,useValue:!0}:[]];function wj(){return new QS("Router",Gs)}let SA=(()=>{class e{constructor(t){}static forRoot(t,i){return{ngModule:e,providers:[bj,_y&&i?.enableTracing?vj().\u0275providers:[],{provide:Ym,multi:!0,useValue:t},{provide:TA,useFactory:Tj,deps:[[Gs,new Oh,new So]]},{provide:ib,useValue:i||{}},i?.useHash?{provide:rp,useClass:Sz}:{provide:rp,useClass:wM},{provide:eE,useFactory:()=>{const e=cn(HN),n=cn(ir),t=cn(ib),i=cn(nb),o=cn(oy);return t.scrollOffset&&e.setOffset(t.scrollOffset),new bA(o,i,e,n,t)}},i?.preloadingStrategy?xj(i.preloadingStrategy).\u0275providers:[],{provide:QS,multi:!0,useFactory:wj},i?.initialNavigation?Sj(i):[],[{provide:MA,useFactory:CA},{provide:JS,multi:!0,useExisting:MA}]]}}static forChild(t){return{ngModule:e,providers:[{provide:Ym,multi:!0,useValue:t}]}}}return e.\u0275fac=function(t){return new(t||e)(Dt(TA,8))},e.\u0275mod=ar({type:e}),e.\u0275inj=Ui({imports:[GC]}),e})();function Tj(e){if(_y&&e)throw new nt(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Sj(e){return["disabled"===e.initialNavigation?wd(3,[{provide:fx,multi:!0,useFactory:()=>{const n=cn(Gs);return()=>{n.setUpLocationChangeListener()}}},{provide:nE,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?wd(2,[{provide:nE,useValue:0},{provide:fx,multi:!0,deps:[Wa],useFactory:n=>{const t=n.get(Dz,Promise.resolve());return()=>t.then(()=>new Promise(i=>{const o=n.get(Gs),l=n.get(EA);(function mj(e,n){e.events.pipe(Bc(t=>t instanceof ap||t instanceof Gx||t instanceof zC||t instanceof Wx),ht(t=>t instanceof ap||t instanceof Wx?xa.COMPLETE:t instanceof Gx&&(0===t.code||1===t.code)?xa.REDIRECTING:xa.FAILED),Bc(t=>t!==xa.REDIRECTING),jm(1)).subscribe(()=>{n()})})(o,()=>{i(!0)}),n.get(nb).afterPreactivation=()=>(i(!0),l.closed?Ht(void 0):l),o.initialNavigation()}))}}]).\u0275providers:[]]}const MA=new Mt(_y?"Router Initializer":"");function IA(e,n,t,i,o,l,u){try{var m=e[l](u),y=m.value}catch(C){return void t(C)}m.done?n(y):Promise.resolve(y).then(i,o)}class rb{}class iE{}class ju{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?this.lazyInit="string"==typeof n?()=>{this.headers=new Map,n.split("\n").forEach(t=>{const i=t.indexOf(":");if(i>0){const o=t.slice(0,i),l=o.toLowerCase(),u=t.slice(i+1).trim();this.maybeSetNormalizedName(o,l),this.headers.has(l)?this.headers.get(l).push(u):this.headers.set(l,[u])}})}:()=>{this.headers=new Map,Object.entries(n).forEach(([t,i])=>{let o;if(o="string"==typeof i?[i]:"number"==typeof i?[i.toString()]:i.map(l=>l.toString()),o.length>0){const l=t.toLowerCase();this.headers.set(l,o),this.maybeSetNormalizedName(t,l)}})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const t=this.headers.get(n.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,t){return this.clone({name:n,value:t,op:"a"})}set(n,t){return this.clone({name:n,value:t,op:"s"})}delete(n,t){return this.clone({name:n,value:t,op:"d"})}maybeSetNormalizedName(n,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,n)}init(){this.lazyInit&&(this.lazyInit instanceof ju?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(t=>{this.headers.set(t,n.headers.get(t)),this.normalizedNames.set(t,n.normalizedNames.get(t))})}clone(n){const t=new ju;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof ju?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([n]),t}applyUpdate(n){const t=n.name.toLowerCase();switch(n.op){case"a":case"s":let i=n.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(n.name,t);const o=("a"===n.op?this.headers.get(t):void 0)||[];o.push(...i),this.headers.set(t,o);break;case"d":const l=n.value;if(l){let u=this.headers.get(t);if(!u)return;u=u.filter(m=>-1===l.indexOf(m)),0===u.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,u)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>n(this.normalizedNames.get(t),this.headers.get(t)))}}class Aj{encodeKey(n){return AA(n)}encodeValue(n){return AA(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const kj=/%(\d[a-f0-9])/gi,Rj={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function AA(e){return encodeURIComponent(e).replace(kj,(n,t)=>Rj[t]??n)}function ob(e){return`${e}`}class Cd{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new Aj,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Pj(e,n){const t=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(o=>{const l=o.indexOf("="),[u,m]=-1==l?[n.decodeKey(o),""]:[n.decodeKey(o.slice(0,l)),n.decodeValue(o.slice(l+1))],y=t.get(u)||[];y.push(m),t.set(u,y)}),t}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(t=>{const i=n.fromObject[t],o=Array.isArray(i)?i.map(ob):[ob(i)];this.map.set(t,o)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const t=this.map.get(n);return t?t[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,t){return this.clone({param:n,value:t,op:"a"})}appendAll(n){const t=[];return Object.keys(n).forEach(i=>{const o=n[i];Array.isArray(o)?o.forEach(l=>{t.push({param:i,value:l,op:"a"})}):t.push({param:i,value:o,op:"a"})}),this.clone(t)}set(n,t){return this.clone({param:n,value:t,op:"s"})}delete(n,t){return this.clone({param:n,value:t,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const t=this.encoder.encodeKey(n);return this.map.get(n).map(i=>t+"="+this.encoder.encodeValue(i)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const t=new Cd({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(n),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const t=("a"===n.op?this.map.get(n.param):void 0)||[];t.push(ob(n.value)),this.map.set(n.param,t);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let i=this.map.get(n.param)||[];const o=i.indexOf(ob(n.value));-1!==o&&i.splice(o,1),i.length>0?this.map.set(n.param,i):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class Oj{constructor(){this.map=new Map}set(n,t){return this.map.set(n,t),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function PA(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function kA(e){return typeof Blob<"u"&&e instanceof Blob}function RA(e){return typeof FormData<"u"&&e instanceof FormData}class yy{constructor(n,t,i,o){let l;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function Lj(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==i?i:null,l=o):l=i,l&&(this.reportProgress=!!l.reportProgress,this.withCredentials=!!l.withCredentials,l.responseType&&(this.responseType=l.responseType),l.headers&&(this.headers=l.headers),l.context&&(this.context=l.context),l.params&&(this.params=l.params)),this.headers||(this.headers=new ju),this.context||(this.context=new Oj),this.params){const u=this.params.toString();if(0===u.length)this.urlWithParams=t;else{const m=t.indexOf("?");this.urlWithParams=t+(-1===m?"?":m<t.length-1?"&":"")+u}}else this.params=new Cd,this.urlWithParams=t}serializeBody(){return null===this.body?null:PA(this.body)||kA(this.body)||RA(this.body)||function Fj(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Cd?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||RA(this.body)?null:kA(this.body)?this.body.type||null:PA(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Cd?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const t=n.method||this.method,i=n.url||this.url,o=n.responseType||this.responseType,l=void 0!==n.body?n.body:this.body,u=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,m=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let y=n.headers||this.headers,C=n.params||this.params;const T=n.context??this.context;return void 0!==n.setHeaders&&(y=Object.keys(n.setHeaders).reduce((A,z)=>A.set(z,n.setHeaders[z]),y)),n.setParams&&(C=Object.keys(n.setParams).reduce((A,z)=>A.set(z,n.setParams[z]),C)),new yy(t,i,l,{params:C,headers:y,context:T,reportProgress:m,responseType:o,withCredentials:u})}}var Br=(()=>((Br=Br||{})[Br.Sent=0]="Sent",Br[Br.UploadProgress=1]="UploadProgress",Br[Br.ResponseHeader=2]="ResponseHeader",Br[Br.DownloadProgress=3]="DownloadProgress",Br[Br.Response=4]="Response",Br[Br.User=5]="User",Br))();class rE{constructor(n,t=200,i="OK"){this.headers=n.headers||new ju,this.status=void 0!==n.status?n.status:t,this.statusText=n.statusText||i,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class oE extends rE{constructor(n={}){super(n),this.type=Br.ResponseHeader}clone(n={}){return new oE({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class sb extends rE{constructor(n={}){super(n),this.type=Br.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new sb({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class OA extends rE{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function sE(e,n){return{body:n,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let LA=(()=>{class e{constructor(t){this.handler=t}request(t,i,o={}){let l;if(t instanceof yy)l=t;else{let y,C;y=o.headers instanceof ju?o.headers:new ju(o.headers),o.params&&(C=o.params instanceof Cd?o.params:new Cd({fromObject:o.params})),l=new yy(t,i,void 0!==o.body?o.body:null,{headers:y,context:o.context,params:C,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials})}const u=Ht(l).pipe(yd(y=>this.handler.handle(y)));if(t instanceof yy||"events"===o.observe)return u;const m=u.pipe(Bc(y=>y instanceof sb));switch(o.observe||"body"){case"body":switch(l.responseType){case"arraybuffer":return m.pipe(ht(y=>{if(null!==y.body&&!(y.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return y.body}));case"blob":return m.pipe(ht(y=>{if(null!==y.body&&!(y.body instanceof Blob))throw new Error("Response is not a Blob.");return y.body}));case"text":return m.pipe(ht(y=>{if(null!==y.body&&"string"!=typeof y.body)throw new Error("Response is not a string.");return y.body}));default:return m.pipe(ht(y=>y.body))}case"response":return m;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(t,i={}){return this.request("DELETE",t,i)}get(t,i={}){return this.request("GET",t,i)}head(t,i={}){return this.request("HEAD",t,i)}jsonp(t,i){return this.request("JSONP",t,{params:(new Cd).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,i={}){return this.request("OPTIONS",t,i)}patch(t,i,o={}){return this.request("PATCH",t,sE(o,i))}post(t,i,o={}){return this.request("POST",t,sE(o,i))}put(t,i,o={}){return this.request("PUT",t,sE(o,i))}}return e.\u0275fac=function(t){return new(t||e)(Dt(rb))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();function FA(e,n){return n(e)}function zj(e,n){return(t,i)=>n.intercept(t,{handle:o=>e(o,i)})}const Bj=new Mt("HTTP_INTERCEPTORS"),vy=new Mt("HTTP_INTERCEPTOR_FNS");function Vj(){let e=null;return(n,t)=>(null===e&&(e=(cn(Bj,{optional:!0})??[]).reduceRight(zj,FA)),e(n,t))}let zA=(()=>{class e extends rb{constructor(t,i){super(),this.backend=t,this.injector=i,this.chain=null}handle(t){if(null===this.chain){const i=Array.from(new Set(this.injector.get(vy)));this.chain=i.reduceRight((o,l)=>function Nj(e,n,t){return(i,o)=>t.runInContext(()=>n(i,l=>e(l,o)))}(o,l,this.injector),FA)}return this.chain(t,i=>this.backend.handle(i))}}return e.\u0275fac=function(t){return new(t||e)(Dt(iE),Dt(Vs))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();const Hj=/^\)\]\}',?\n/;let BA=(()=>{class e{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new fn(i=>{const o=this.xhrFactory.build();if(o.open(t.method,t.urlWithParams),t.withCredentials&&(o.withCredentials=!0),t.headers.forEach((V,H)=>o.setRequestHeader(V,H.join(","))),t.headers.has("Accept")||o.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const V=t.detectContentTypeHeader();null!==V&&o.setRequestHeader("Content-Type",V)}if(t.responseType){const V=t.responseType.toLowerCase();o.responseType="json"!==V?V:"text"}const l=t.serializeBody();let u=null;const m=()=>{if(null!==u)return u;const V=o.statusText||"OK",H=new ju(o.getAllResponseHeaders()),X=function Gj(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(o)||t.url;return u=new oE({headers:H,status:o.status,statusText:V,url:X}),u},y=()=>{let{headers:V,status:H,statusText:X,url:oe}=m(),le=null;204!==H&&(le=typeof o.response>"u"?o.responseText:o.response),0===H&&(H=le?200:0);let we=H>=200&&H<300;if("json"===t.responseType&&"string"==typeof le){const ve=le;le=le.replace(Hj,"");try{le=""!==le?JSON.parse(le):null}catch(Re){le=ve,we&&(we=!1,le={error:Re,text:le})}}we?(i.next(new sb({body:le,headers:V,status:H,statusText:X,url:oe||void 0})),i.complete()):i.error(new OA({error:le,headers:V,status:H,statusText:X,url:oe||void 0}))},C=V=>{const{url:H}=m(),X=new OA({error:V,status:o.status||0,statusText:o.statusText||"Unknown Error",url:H||void 0});i.error(X)};let T=!1;const A=V=>{T||(i.next(m()),T=!0);let H={type:Br.DownloadProgress,loaded:V.loaded};V.lengthComputable&&(H.total=V.total),"text"===t.responseType&&o.responseText&&(H.partialText=o.responseText),i.next(H)},z=V=>{let H={type:Br.UploadProgress,loaded:V.loaded};V.lengthComputable&&(H.total=V.total),i.next(H)};return o.addEventListener("load",y),o.addEventListener("error",C),o.addEventListener("timeout",C),o.addEventListener("abort",C),t.reportProgress&&(o.addEventListener("progress",A),null!==l&&o.upload&&o.upload.addEventListener("progress",z)),o.send(l),i.next({type:Br.Sent}),()=>{o.removeEventListener("error",C),o.removeEventListener("abort",C),o.removeEventListener("load",y),o.removeEventListener("timeout",C),t.reportProgress&&(o.removeEventListener("progress",A),null!==l&&o.upload&&o.upload.removeEventListener("progress",z)),o.readyState!==o.DONE&&o.abort()}})}}return e.\u0275fac=function(t){return new(t||e)(Dt(HM))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();const aE=new Mt("XSRF_ENABLED"),VA=new Mt("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),jA=new Mt("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class UA{}let Zj=(()=>{class e{constructor(t,i,o){this.doc=t,this.platform=i,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=kM(t,this.cookieName),this.lastCookieString=t),this.lastToken}}return e.\u0275fac=function(t){return new(t||e)(Dt(xs),Dt(Nw),Dt(VA))},e.\u0275prov=At({token:e,factory:e.\u0275fac}),e})();function Xj(e,n){const t=e.url.toLowerCase();if(!cn(aE)||"GET"===e.method||"HEAD"===e.method||t.startsWith("http://")||t.startsWith("https://"))return n(e);const i=cn(UA).getToken(),o=cn(jA);return null!=i&&!e.headers.has(o)&&(e=e.clone({headers:e.headers.set(o,i)})),n(e)}var Cr=(()=>((Cr=Cr||{})[Cr.Interceptors=0]="Interceptors",Cr[Cr.LegacyInterceptors=1]="LegacyInterceptors",Cr[Cr.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",Cr[Cr.NoXsrfProtection=3]="NoXsrfProtection",Cr[Cr.JsonpSupport=4]="JsonpSupport",Cr[Cr.RequestsMadeViaParent=5]="RequestsMadeViaParent",Cr))();function Qm(e,n){return{\u0275kind:e,\u0275providers:n}}function Yj(...e){const n=[LA,BA,zA,{provide:rb,useExisting:zA},{provide:iE,useExisting:BA},{provide:vy,useValue:Xj,multi:!0},{provide:aE,useValue:!0},{provide:UA,useClass:Zj}];for(const t of e)n.push(...t.\u0275providers);return function B1(e){return{\u0275providers:e}}(n)}const $A=new Mt("LEGACY_INTERCEPTOR_FN");let Jj=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=ar({type:e}),e.\u0275inj=Ui({providers:[Yj(Qm(Cr.LegacyInterceptors,[{provide:$A,useFactory:Vj},{provide:vy,useExisting:$A,multi:!0}]))]}),e})(),eg=(()=>{class e{constructor(t){this.http=t,this.dataUrl="../assets/data/",this.cards=[]}getmenu(t){return this.http.get(this.dataUrl+t)}getsetting(t){return this.http.get(this.dataUrl+t)}getfooter(t){return this.http.get(this.dataUrl+t)}getist(t){return this.http.get(this.dataUrl+t)}getuser(t){return this.http.get(this.dataUrl+t)}getcard(t){return this.http.get(this.dataUrl+t)}getform(t){return this.http.get(this.dataUrl+t)}getpie(t){return this.http.get(this.dataUrl+t)}static#e=this.\u0275fac=function(i){return new(i||e)(Dt(LA))};static#t=this.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Qj=["addListener","removeListener"],eU=["addEventListener","removeEventListener"],tU=["on","off"];function lE(e,n,t,i){if(kn(t)&&(i=t,t=void 0),i)return lE(e,n,t).pipe(DC(i));const[o,l]=function rU(e){return kn(e.addEventListener)&&kn(e.removeEventListener)}(e)?eU.map(u=>m=>e[u](n,m,t)):function nU(e){return kn(e.addListener)&&kn(e.removeListener)}(e)?Qj.map(HA(e,n)):function iU(e){return kn(e.on)&&kn(e.off)}(e)?tU.map(HA(e,n)):[];if(!o&&_e(e))return Lt(u=>lE(u,n,t))(xn(e));if(!o)throw new TypeError("Invalid event target");return new fn(u=>{const m=(...y)=>u.next(1<y.length?y:y[0]);return o(m),()=>l(m)})}function HA(e,n){return t=>i=>e[t](n,i)}class sU extends Ue{constructor(n,t){super()}schedule(n,t=0){return this}}const ab={setInterval(e,n,...t){const{delegate:i}=ab;return i?.setInterval?i.setInterval(e,n,...t):setInterval(e,n,...t)},clearInterval(e){const{delegate:n}=ab;return(n?.clearInterval||clearInterval)(e)},delegate:void 0},GA={now:()=>(GA.delegate||Date).now(),delegate:void 0};class xy{constructor(n,t=xy.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,i){return new this.schedulerActionCtor(this,n).schedule(i,t)}}xy.now=GA.now;const cE=new class lU extends xy{constructor(n,t=xy.now){super(n,t),this.actions=[],this._active=!1}flush(n){const{actions:t}=this;if(this._active)return void t.push(n);let i;this._active=!0;do{if(i=n.execute(n.state,n.delay))break}while(n=t.shift());if(this._active=!1,i){for(;n=t.shift();)n.unsubscribe();throw i}}}(class aU extends sU{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var i;if(this.closed)return this;this.state=n;const o=this.id,l=this.scheduler;return null!=o&&(this.id=this.recycleAsyncId(l,o,t)),this.pending=!0,this.delay=t,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(l,this.id,t),this}requestAsyncId(n,t,i=0){return ab.setInterval(n.flush.bind(n,this),i)}recycleAsyncId(n,t,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return t;null!=t&&ab.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(n,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let o,i=!1;try{this.work(n)}catch(l){i=!0,o=l||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:i}=t;this.work=this.state=this.scheduler=null,this.pending=!1,p(i,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}}),cU=cE;function pU(e,n=cE){return function uU(e){return gi((n,t)=>{let i=!1,o=null;n.subscribe(Yn(t,l=>{i=!0,o=l})),xn(e).subscribe(Yn(t,()=>{if(i){i=!1;const l=o;o=null,t.next(l)}},ns))})}(function fU(e=0,n=cE){return e<0&&(e=0),function dU(e=0,n,t=cU){let i=-1;return null!=n&&(os(n)?t=n:i=n),new fn(o=>{let l=function hU(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;l<0&&(l=0);let u=0;return t.schedule(function(){o.closed||(o.next(u++),0<=i?this.schedule(void 0,i):o.complete())},l)})}(e,e,n)}(e,n))}function mU(e,n,t,i){const o=window&&!!window.document&&window.document.documentElement;let l=o&&n?window:t;if(e&&(l=e&&o&&"string"==typeof e?function gU(e,n,t){return(t?window.document:n).querySelector(e)}(e,t.nativeElement,i):e,!l))throw new Error("ngx-infinite-scroll {resolveContainerElement()}: selector for");return l}function uE(e){return e&&!e.firstChange}const yU={clientHeight:"clientHeight",offsetHeight:"offsetHeight",scrollHeight:"scrollHeight",pageYOffset:"pageYOffset",offsetTop:"offsetTop",scrollTop:"scrollTop",top:"top"},vU={clientHeight:"clientWidth",offsetHeight:"offsetWidth",scrollHeight:"scrollWidth",pageYOffset:"pageXOffset",offsetTop:"offsetLeft",scrollTop:"scrollLeft",top:"left"};class xU{constructor(n=!0){this.vertical=n,this.propsMap=n?yU:vU}clientHeightKey(){return this.propsMap.clientHeight}offsetHeightKey(){return this.propsMap.offsetHeight}scrollHeightKey(){return this.propsMap.scrollHeight}pageYOffsetKey(){return this.propsMap.pageYOffset}offsetTopKey(){return this.propsMap.offsetTop}scrollTopKey(){return this.propsMap.scrollTop}topKey(){return this.propsMap.top}}function EU(e){return["Window","global"].some(t=>Object.prototype.toString.call(e).includes(t))}function hE(e,n){return e?n.document.documentElement:null}function WA(e,n){const t=function SU({container:e,isWindow:n,axis:t}){const{offsetHeightKey:i,clientHeightKey:o}=qA(t);return ZA(e,n,i,o)}(n);return n.isWindow?function DU(e,n,t){const{axis:i,container:o,isWindow:l}=t,{offsetHeightKey:u,clientHeightKey:m}=qA(i),y=e+XA(hE(l,o),i,l),C=ZA(n.nativeElement,l,u,m),T=function MU(e,n,t){const i=n.topKey();if(e.getBoundingClientRect)return e.getBoundingClientRect()[i]+XA(e,n,t)}(n.nativeElement,i,l)+C;return{height:e,scrolled:y,totalToScroll:T}}(t,e,n):function TU(e,n,t){const{axis:i,container:o}=t;return{height:e,scrolled:o[i.scrollTopKey()],totalToScroll:o[i.scrollHeightKey()]}}(t,0,n)}function qA(e){return{offsetHeightKey:e.offsetHeightKey(),clientHeightKey:e.clientHeightKey()}}function ZA(e,n,t,i){if(isNaN(e[t])){const o=hE(n,e);return o?o[i]:0}return e[t]}function XA(e,n,t){const i=n.pageYOffsetKey(),o=n.scrollTopKey(),l=n.offsetTopKey();return isNaN(window[i])?hE(t,e)[o]:e.ownerDocument?e.ownerDocument.defaultView[i]:e[l]}function IU(e,n,t){let i,o;if(e.totalToScroll<=0)return!1;const l=e.height+e.scrolled;return t?(i=(e.totalToScroll-l)/e.totalToScroll,o=n.down/10):(i=e.scrolled/(e.scrolled+(e.totalToScroll-l)),o=n.up/10),i<=o}function zU(e){const{scrollContainer:n,scrollWindow:t,element:i,fromRoot:o}=e,l=function wU({windowElement:e,axis:n}){return function CU(e,n){return Object.assign({},e,{container:e.isWindow||n&&!n.nativeElement?n:n.nativeElement})}({axis:n,isWindow:EU(e)},e)}({axis:new xU(!e.horizontal),windowElement:mU(n,t,i,o)}),{totalToScroll:u}=WA(i,l),m={lastScrollPosition:0,lastTotalToScroll:0,totalToScroll:u,triggered:{down:0,up:0}},C={up:e.upDistance,down:e.downDistance};return function NU(e){let n=lE(e.container,"scroll");return e.throttle&&(n=n.pipe(pU(e.throttle))),n}({container:l.container,throttle:e.throttle}).pipe(ht(({target:T})=>({contentHeight:T.scrollHeight,scrolledFromTop:T.scrollTop,viewportHeight:T.clientHeight})),function oU(){return gi((e,n)=>{let t,i=!1;e.subscribe(Yn(n,o=>{const l=t;t=o,i&&n.next([l,o]),i=!0}))})}(),to(T=>console.log(T)),Lt(T=>Ht(WA(i,l))),ht(T=>function BU(e,n,t){const{scrollDown:i,fire:o}=function PU(e,n,t){const i=function AU(e,n){return e<n.scrolled}(e,n);return{fire:IU(n,t,i),scrollDown:i}}(e,n,t);return{scrollDown:i,fire:o,stats:n}}(m.lastScrollPosition,T,C)),to(({stats:T})=>function FU(e,n,t){(function kU(e,n){n.lastScrollPosition=e})(n,e),function RU(e,n){n.lastTotalToScroll!==e&&(n.lastTotalToScroll=n.totalToScroll,n.totalToScroll=e)}(t,e)}(m,T.scrolled,T.totalToScroll)),Bc(({fire:T,scrollDown:A,stats:{totalToScroll:z}})=>function bU(e,n,t){return(e||n)&&!t}(e.alwaysCallback,T,function LU(e,n,t){return t?n.triggered.down===e:n.triggered.up===e}(z,m,A))),to(({scrollDown:T,stats:{totalToScroll:A}})=>{!function OU(e,n,t,i){i?n.triggered.down=e:n.triggered.up=e}(A,m,0,T)}),ht(VU))}const lb={DOWN:"[NGX_ISE] DOWN",UP:"[NGX_ISE] UP"};function VU(e){const{scrollDown:n,stats:{scrolled:t}}=e;return{type:n?lb.DOWN:lb.UP,payload:{currentScrollPosition:t}}}let jU=(()=>{class e{constructor(t,i){this.element=t,this.zone=i,this.scrolled=new Mi,this.scrolledUp=new Mi,this.infiniteScrollDistance=2,this.infiniteScrollUpDistance=1.5,this.infiniteScrollThrottle=150,this.infiniteScrollDisabled=!1,this.infiniteScrollContainer=null,this.scrollWindow=!0,this.immediateCheck=!1,this.horizontal=!1,this.alwaysCallback=!1,this.fromRoot=!1}ngAfterViewInit(){this.infiniteScrollDisabled||this.setup()}ngOnChanges({infiniteScrollContainer:t,infiniteScrollDisabled:i,infiniteScrollDistance:o}){const l=uE(t),u=uE(i),m=uE(o),y=!u&&!this.infiniteScrollDisabled||u&&!i.currentValue||m;(l||u||m)&&(this.destroyScroller(),y&&this.setup())}setup(){(function _U(){return typeof window<"u"})()&&this.zone.runOutsideAngular(()=>{this.disposeScroller=zU({fromRoot:this.fromRoot,alwaysCallback:this.alwaysCallback,disable:this.infiniteScrollDisabled,downDistance:this.infiniteScrollDistance,element:this.element,horizontal:this.horizontal,scrollContainer:this.infiniteScrollContainer,scrollWindow:this.scrollWindow,throttle:this.infiniteScrollThrottle,upDistance:this.infiniteScrollUpDistance}).subscribe(t=>this.zone.run(()=>this.handleOnScroll(t)))})}handleOnScroll({type:t,payload:i}){switch(t){case lb.DOWN:return this.scrolled.emit(i);case lb.UP:return this.scrolledUp.emit(i);default:return}}ngOnDestroy(){this.destroyScroller()}destroyScroller(){this.disposeScroller&&this.disposeScroller.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Qe(Ao),Qe(ir))},e.\u0275dir=Ft({type:e,selectors:[["","infiniteScroll",""],["","infinite-scroll",""],["","data-infinite-scroll",""]],inputs:{infiniteScrollDistance:"infiniteScrollDistance",infiniteScrollUpDistance:"infiniteScrollUpDistance",infiniteScrollThrottle:"infiniteScrollThrottle",infiniteScrollDisabled:"infiniteScrollDisabled",infiniteScrollContainer:"infiniteScrollContainer",scrollWindow:"scrollWindow",immediateCheck:"immediateCheck",horizontal:"horizontal",alwaysCallback:"alwaysCallback",fromRoot:"fromRoot"},outputs:{scrolled:"scrolled",scrolledUp:"scrolledUp"},features:[Wr]}),e})(),UU=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=ar({type:e}),e.\u0275inj=Ui({}),e})();const $U=function(e){return{id:e}};function HU(e,n){if(1&e&&(ft(0,"div",6),Xt(1,"img",7),ft(2,"div",8)(3,"span"),si(4,"Vote: 32131"),gt()(),ft(5,"div",9)(6,"div",10)(7,"div",11),si(8),gt(),ft(9,"div",12),si(10),gt()(),ft(11,"div",13),Xt(12,"i",14)(13,"i",15)(14,"i",16),gt()()()),2&e){const t=n.$implicit;xt("routerLink","/detail")("queryParams",function aS(e,n,t,i){return lS(Ze(),_r(),e,n,t,i)}(5,$U,t.id)),Rt(1),xt("src",t.img,Zh),Rt(7),Ro(t.title),Rt(2),zc("",null==t||null==t.subtitle?null:t.subtitle.substring(0,30),"...")}}let GU=(()=>{class e{constructor(t){this.data=t,this.cards=[],this.page=1,this.pagesize=24}ngOnInit(){this.getSettings()}getSettings(){var t=this;return function Ij(e){return function(){var n=this,t=arguments;return new Promise(function(i,o){var l=e.apply(n,t);function u(y){IA(l,i,o,u,m,"next",y)}function m(y){IA(l,i,o,u,m,"throw",y)}u(void 0)})}}(function*(){t.data.getcard("1-main-page/card_json.json").subscribe(i=>{t.cards=t.data.cards.concat(i),t.tempCard=t.cards.slice(t.page-1,t.pagesize)})})()}onScroll(){this.cards.length/24<=this.page||(this.page++,this.cards.length-this.tempCard.length>=24?this.tempCard=this.tempCard.concat(this.cards.slice((this.page-1)*this.pagesize,this.page*this.pagesize)):(this.tempCard=this.tempCard.concat(this.cards.slice((this.page-1)*this.pagesize,this.cards.length)),this.page++))}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(eg))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-home"]],decls:6,vars:4,consts:[["infiniteScroll","",1,"home",3,"infiniteScrollDistance","scrollWindow","scrolled"],[1,"cards"],[1,"card",3,"routerLink"],["src","../../assets/plus.png","alt","",1,"card-img"],["class","card",3,"routerLink","queryParams",4,"ngFor","ngForOf"],[1,"pagination"],[1,"card",3,"routerLink","queryParams"],["alt","",1,"card-img",3,"src"],[1,"card-top"],[1,"card-desc"],[1,"leftside"],[2,"font-size","10px","font-weight","700"],[2,"font-size","9px","margin-top","4px"],[1,"rightside"],[1,"fa","fa-bell","icon",2,"color","red"],[1,"fa","fa-bell","icon"],[1,"fa","fa-bell","icon",2,"color","rgb(0, 162, 255)"]],template:function(i,o){1&i&&(ft(0,"div",0),Un("scrolled",function(){return o.onScroll()}),ft(1,"div",1)(2,"div",2),Xt(3,"img",3),gt(),qt(4,HU,15,7,"div",4),gt()(),Xt(5,"div",5)),2&i&&(xt("infiniteScrollDistance",1)("scrollWindow",!1),Rt(2),xt("routerLink","/new"),Rt(2),xt("ngForOf",o.tempCard))},dependencies:[Vm,Km,jU],styles:[".home[_ngcontent-%COMP%]{padding:0 40px;position:relative;height:100%;overflow-y:scroll}.cards[_ngcontent-%COMP%]{display:flex;justify-content:space-around;height:100%;padding-top:30px;flex-wrap:wrap;margin-bottom:50px}.card[_ngcontent-%COMP%]{width:230px;height:135px;margin:19px;position:relative;border-radius:8px;border:1px solid rgb(31,151,255)}.card[_ngcontent-%COMP%]:hover{cursor:pointer}.card-img[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;border-radius:8px}.card-desc[_ngcontent-%COMP%]{position:absolute;width:100%;height:30%;background-color:#0009;bottom:0;border-radius:8px;display:flex;justify-content:space-between}.leftside[_ngcontent-%COMP%]{width:60%;flex-direction:column;justify-content:center;color:#b3b3b3;padding-left:3px}.rightside[_ngcontent-%COMP%]{width:40%;display:flex;align-items:end;justify-content:end}.icon[_ngcontent-%COMP%]{font-size:11px;padding:4px;margin:4px;background-color:#848484;color:#1fff1f;border-radius:5px;width:11px}.card-top[_ngcontent-%COMP%]{position:absolute;width:30%;height:11%;background-color:#0009;top:1px;right:1px;border-radius:3px;display:flex;justify-content:center;align-items:center}.card-top[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:8px;color:#b3b3b3}.pagination[_ngcontent-%COMP%]{width:100%;height:55px;position:absolute;bottom:50px}.home[_ngcontent-%COMP%]::-webkit-scrollbar{width:10px}.home[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#101213}.home[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#3f3e3e}.home[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}"]})}return e})();const YA=typeof window>"u"?function(e){return e()}:window.requestAnimationFrame;function KA(e,n,t){const i=t||(u=>Array.prototype.slice.call(u));let o=!1,l=[];return function(...u){l=i(u),o||(o=!0,YA.call(window,()=>{o=!1,e.apply(n,l)}))}}const dE=e=>"start"===e?"left":"end"===e?"right":"center",Jo=(e,n,t)=>"start"===e?n:"end"===e?t:(n+t)/2;function Uu(){}const ZU=function(){let e=0;return function(){return e++}}();function oi(e){return null===e||typeof e>"u"}function Ai(e){if(Array.isArray&&Array.isArray(e))return!0;const n=Object.prototype.toString.call(e);return"[object"===n.slice(0,7)&&"Array]"===n.slice(-6)}function $n(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}const Er=e=>("number"==typeof e||e instanceof Number)&&isFinite(+e);function nl(e,n){return Er(e)?e:n}function Dn(e,n){return typeof e>"u"?n:e}const JA=(e,n)=>"string"==typeof e&&e.endsWith("%")?parseFloat(e)/100*n:+e;function Pi(e,n,t){if(e&&"function"==typeof e.call)return e.apply(t,n)}function pi(e,n,t,i){let o,l,u;if(Ai(e))if(l=e.length,i)for(o=l-1;o>=0;o--)n.call(t,e[o],o);else for(o=0;o<l;o++)n.call(t,e[o],o);else if($n(e))for(u=Object.keys(e),l=u.length,o=0;o<l;o++)n.call(t,e[u[o]],u[o])}function cb(e,n){let t,i,o,l;if(!e||!n||e.length!==n.length)return!1;for(t=0,i=e.length;t<i;++t)if(o=e[t],l=n[t],o.datasetIndex!==l.datasetIndex||o.index!==l.index)return!1;return!0}function ub(e){if(Ai(e))return e.map(ub);if($n(e)){const n=Object.create(null),t=Object.keys(e),i=t.length;let o=0;for(;o<i;++o)n[t[o]]=ub(e[t[o]]);return n}return e}function QA(e){return-1===["__proto__","prototype","constructor"].indexOf(e)}function YU(e,n,t,i){if(!QA(e))return;const o=n[e],l=t[e];$n(o)&&$n(l)?by(o,l,i):n[e]=ub(l)}function by(e,n,t){const i=Ai(n)?n:[n],o=i.length;if(!$n(e))return e;const l=(t=t||{}).merger||YU;for(let u=0;u<o;++u){if(!$n(n=i[u]))continue;const m=Object.keys(n);for(let y=0,C=m.length;y<C;++y)l(m[y],e,n,t)}return e}function wy(e,n){return by(e,n,{merger:KU})}function KU(e,n,t){if(!QA(e))return;const i=n[e],o=t[e];$n(i)&&$n(o)?wy(i,o):Object.prototype.hasOwnProperty.call(n,e)||(n[e]=ub(o))}const JU="",QU=".";function e2(e,n){const t=e.indexOf(QU,n);return-1===t?e.length:t}function Ed(e,n){if(n===JU)return e;let t=0,i=e2(n,t);for(;e&&i>t;)e=e[n.slice(t,i)],t=i+1,i=e2(n,t);return e}function fE(e){return e.charAt(0).toUpperCase()+e.slice(1)}const il=e=>typeof e<"u",Dd=e=>"function"==typeof e,t2=(e,n)=>{if(e.size!==n.size)return!1;for(const t of e)if(!n.has(t))return!1;return!0},qi=Math.PI,Ei=2*qi,t5=Ei+qi,hb=Number.POSITIVE_INFINITY,n5=qi/180,fr=qi/2,Cy=qi/4,n2=2*qi/3,rl=Math.log10,Uc=Math.sign;function i2(e){const n=Math.round(e);e=Dy(e,n,e/1e3)?n:e;const t=Math.pow(10,Math.floor(rl(e))),i=e/t;return(i<=1?1:i<=2?2:i<=5?5:10)*t}function Ey(e){return!isNaN(parseFloat(e))&&isFinite(e)}function Dy(e,n,t){return Math.abs(e-n)<t}function r2(e,n,t){let i,o,l;for(i=0,o=e.length;i<o;i++)l=e[i][t],isNaN(l)||(n.min=Math.min(n.min,l),n.max=Math.max(n.max,l))}function Yl(e){return e*(qi/180)}function pE(e){return e*(180/qi)}function o2(e){if(!Er(e))return;let n=1,t=0;for(;Math.round(e*n)/n!==e;)n*=10,t++;return t}function s2(e,n){const t=n.x-e.x,i=n.y-e.y,o=Math.sqrt(t*t+i*i);let l=Math.atan2(i,t);return l<-.5*qi&&(l+=Ei),{angle:l,distance:o}}function mE(e,n){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))}function o5(e,n){return(e-n+t5)%Ei-qi}function ba(e){return(e%Ei+Ei)%Ei}function Ty(e,n,t,i){const o=ba(e),l=ba(n),u=ba(t),m=ba(l-o),y=ba(u-o),C=ba(o-l),T=ba(o-u);return o===l||o===u||i&&l===u||m>y&&C<T}function _o(e,n,t){return Math.max(n,Math.min(t,e))}function $u(e,n,t,i=1e-6){return e>=Math.min(n,t)-i&&e<=Math.max(n,t)+i}const db=e=>0===e||1===e,a2=(e,n,t)=>-Math.pow(2,10*(e-=1))*Math.sin((e-n)*Ei/t),l2=(e,n,t)=>Math.pow(2,-10*e)*Math.sin((e-n)*Ei/t)+1,Sy={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>1-Math.cos(e*fr),easeOutSine:e=>Math.sin(e*fr),easeInOutSine:e=>-.5*(Math.cos(qi*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>db(e)?e:e<.5?.5*Math.pow(2,10*(2*e-1)):.5*(2-Math.pow(2,-10*(2*e-1))),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>db(e)?e:a2(e,.075,.3),easeOutElastic:e=>db(e)?e:l2(e,.075,.3),easeInOutElastic:e=>db(e)?e:e<.5?.5*a2(2*e,.1125,.45):.5+.5*l2(2*e-1,.1125,.45),easeInBack:e=>e*e*(2.70158*e-1.70158),easeOutBack:e=>(e-=1)*e*(2.70158*e+1.70158)+1,easeInOutBack(e){let n=1.70158;return(e/=.5)<1?e*e*((1+(n*=1.525))*e-n)*.5:.5*((e-=2)*e*((1+(n*=1.525))*e+n)+2)},easeInBounce:e=>1-Sy.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?.5*Sy.easeInBounce(2*e):.5*Sy.easeOutBounce(2*e-1)+.5};function My(e){return e+.5|0}const Td=(e,n,t)=>Math.max(Math.min(e,t),n);function Iy(e){return Td(My(2.55*e),0,255)}function Sd(e){return Td(My(255*e),0,255)}function Hu(e){return Td(My(e/2.55)/100,0,1)}function c2(e){return Td(My(100*e),0,100)}const ol={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},gE=[..."0123456789ABCDEF"],a5=e=>gE[15&e],l5=e=>gE[(240&e)>>4]+gE[15&e],fb=e=>(240&e)>>4==(15&e),f5=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function u2(e,n,t){const i=n*Math.min(t,1-t),o=(l,u=(l+e/30)%12)=>t-i*Math.max(Math.min(u-3,9-u,1),-1);return[o(0),o(8),o(4)]}function p5(e,n,t){const i=(o,l=(o+e/60)%6)=>t-t*n*Math.max(Math.min(l,4-l,1),0);return[i(5),i(3),i(1)]}function m5(e,n,t){const i=u2(e,1,.5);let o;for(n+t>1&&(o=1/(n+t),n*=o,t*=o),o=0;o<3;o++)i[o]*=1-n-t,i[o]+=n;return i}function _E(e){const t=e.r/255,i=e.g/255,o=e.b/255,l=Math.max(t,i,o),u=Math.min(t,i,o),m=(l+u)/2;let y,C,T;return l!==u&&(T=l-u,C=m>.5?T/(2-l-u):T/(l+u),y=function g5(e,n,t,i,o){return e===o?(n-t)/i+(n<t?6:0):n===o?(t-e)/i+2:(e-n)/i+4}(t,i,o,T,l),y=60*y+.5),[0|y,C||0,m]}function yE(e,n,t,i){return(Array.isArray(n)?e(n[0],n[1],n[2]):e(n,t,i)).map(Sd)}function vE(e,n,t){return yE(u2,e,n,t)}function h2(e){return(e%360+360)%360}const d2={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},f2={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let pb;const E5=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,xE=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,tg=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function mb(e,n,t){if(e){let i=_E(e);i[n]=Math.max(0,Math.min(i[n]+i[n]*t,0===n?360:1)),i=vE(i),e.r=i[0],e.g=i[1],e.b=i[2]}}function p2(e,n){return e&&Object.assign(n||{},e)}function m2(e){var n={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(n={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(n.a=Sd(e[3]))):(n=p2(e,{r:0,g:0,b:0,a:1})).a=Sd(n.a),n}function M5(e){return"r"===e.charAt(0)?function D5(e){const n=E5.exec(e);let i,o,l,t=255;if(n){if(n[7]!==i){const u=+n[7];t=n[8]?Iy(u):Td(255*u,0,255)}return i=+n[1],o=+n[3],l=+n[5],i=255&(n[2]?Iy(i):Td(i,0,255)),o=255&(n[4]?Iy(o):Td(o,0,255)),l=255&(n[6]?Iy(l):Td(l,0,255)),{r:i,g:o,b:l,a:t}}}(e):function v5(e){const n=f5.exec(e);let i,t=255;if(!n)return;n[5]!==i&&(t=n[6]?Iy(+n[5]):Sd(+n[5]));const o=h2(+n[2]),l=+n[3]/100,u=+n[4]/100;return i="hwb"===n[1]?function _5(e,n,t){return yE(m5,e,n,t)}(o,l,u):"hsv"===n[1]?function y5(e,n,t){return yE(p5,e,n,t)}(o,l,u):vE(o,l,u),{r:i[0],g:i[1],b:i[2],a:t}}(e)}class gb{constructor(n){if(n instanceof gb)return n;const t=typeof n;let i;"object"===t?i=m2(n):"string"===t&&(i=function u5(e){var t,n=e.length;return"#"===e[0]&&(4===n||5===n?t={r:255&17*ol[e[1]],g:255&17*ol[e[2]],b:255&17*ol[e[3]],a:5===n?17*ol[e[4]]:255}:(7===n||9===n)&&(t={r:ol[e[1]]<<4|ol[e[2]],g:ol[e[3]]<<4|ol[e[4]],b:ol[e[5]]<<4|ol[e[6]],a:9===n?ol[e[7]]<<4|ol[e[8]]:255})),t}(n)||function C5(e){pb||(pb=function w5(){const e={},n=Object.keys(f2),t=Object.keys(d2);let i,o,l,u,m;for(i=0;i<n.length;i++){for(u=m=n[i],o=0;o<t.length;o++)l=t[o],m=m.replace(l,d2[l]);l=parseInt(f2[u],16),e[m]=[l>>16&255,l>>8&255,255&l]}return e}(),pb.transparent=[0,0,0,0]);const n=pb[e.toLowerCase()];return n&&{r:n[0],g:n[1],b:n[2],a:4===n.length?n[3]:255}}(n)||M5(n)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var n=p2(this._rgb);return n&&(n.a=Hu(n.a)),n}set rgb(n){this._rgb=m2(n)}rgbString(){return this._valid?function T5(e){return e&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${Hu(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`)}(this._rgb):void 0}hexString(){return this._valid?function d5(e){var n=(e=>fb(e.r)&&fb(e.g)&&fb(e.b)&&fb(e.a))(e)?a5:l5;return e?"#"+n(e.r)+n(e.g)+n(e.b)+((e,n)=>e<255?n(e):"")(e.a,n):void 0}(this._rgb):void 0}hslString(){return this._valid?function b5(e){if(!e)return;const n=_E(e),t=n[0],i=c2(n[1]),o=c2(n[2]);return e.a<255?`hsla(${t}, ${i}%, ${o}%, ${Hu(e.a)})`:`hsl(${t}, ${i}%, ${o}%)`}(this._rgb):void 0}mix(n,t){if(n){const i=this.rgb,o=n.rgb;let l;const u=t===l?.5:t,m=2*u-1,y=i.a-o.a,C=((m*y==-1?m:(m+y)/(1+m*y))+1)/2;l=1-C,i.r=255&C*i.r+l*o.r+.5,i.g=255&C*i.g+l*o.g+.5,i.b=255&C*i.b+l*o.b+.5,i.a=u*i.a+(1-u)*o.a,this.rgb=i}return this}interpolate(n,t){return n&&(this._rgb=function S5(e,n,t){const i=tg(Hu(e.r)),o=tg(Hu(e.g)),l=tg(Hu(e.b));return{r:Sd(xE(i+t*(tg(Hu(n.r))-i))),g:Sd(xE(o+t*(tg(Hu(n.g))-o))),b:Sd(xE(l+t*(tg(Hu(n.b))-l))),a:e.a+t*(n.a-e.a)}}(this._rgb,n._rgb,t)),this}clone(){return new gb(this.rgb)}alpha(n){return this._rgb.a=Sd(n),this}clearer(n){return this._rgb.a*=1-n,this}greyscale(){const n=this._rgb,t=My(.3*n.r+.59*n.g+.11*n.b);return n.r=n.g=n.b=t,this}opaquer(n){return this._rgb.a*=1+n,this}negate(){const n=this._rgb;return n.r=255-n.r,n.g=255-n.g,n.b=255-n.b,this}lighten(n){return mb(this._rgb,2,n),this}darken(n){return mb(this._rgb,2,-n),this}saturate(n){return mb(this._rgb,1,n),this}desaturate(n){return mb(this._rgb,1,-n),this}rotate(n){return function x5(e,n){var t=_E(e);t[0]=h2(t[0]+n),t=vE(t),e.r=t[0],e.g=t[1],e.b=t[2]}(this._rgb,n),this}}function g2(e){return new gb(e)}function _2(e){if(e&&"object"==typeof e){const n=e.toString();return"[object CanvasPattern]"===n||"[object CanvasGradient]"===n}return!1}function y2(e){return _2(e)?e:g2(e)}function bE(e){return _2(e)?e:g2(e).saturate(.5).darken(.1).hexString()}const lp=Object.create(null),wE=Object.create(null);function Ay(e,n){if(!n)return e;const t=n.split(".");for(let i=0,o=t.length;i<o;++i){const l=t[i];e=e[l]||(e[l]=Object.create(null))}return e}function CE(e,n,t){return"string"==typeof n?by(Ay(e,n),t):by(Ay(e,""),n)}var zn=new class I5{constructor(n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,i)=>bE(i.backgroundColor),this.hoverBorderColor=(t,i)=>bE(i.borderColor),this.hoverColor=(t,i)=>bE(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(n)}set(n,t){return CE(this,n,t)}get(n){return Ay(this,n)}describe(n,t){return CE(wE,n,t)}override(n,t){return CE(lp,n,t)}route(n,t,i,o){const l=Ay(this,n),u=Ay(this,i),m="_"+t;Object.defineProperties(l,{[m]:{value:l[t],writable:!0},[t]:{enumerable:!0,get(){const y=this[m],C=u[o];return $n(y)?Object.assign({},C,y):Dn(y,C)},set(y){this[m]=y}}})}}({_scriptable:e=>!e.startsWith("on"),_indexable:e=>"events"!==e,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function _b(e,n,t,i,o){let l=n[o];return l||(l=n[o]=e.measureText(o).width,t.push(o)),l>i&&(i=l),i}function P5(e,n,t,i){let o=(i=i||{}).data=i.data||{},l=i.garbageCollect=i.garbageCollect||[];i.font!==n&&(o=i.data={},l=i.garbageCollect=[],i.font=n),e.save(),e.font=n;let u=0;const m=t.length;let y,C,T,A,z;for(y=0;y<m;y++)if(A=t[y],null!=A&&!0!==Ai(A))u=_b(e,o,l,u,A);else if(Ai(A))for(C=0,T=A.length;C<T;C++)z=A[C],null!=z&&!Ai(z)&&(u=_b(e,o,l,u,z));e.restore();const V=l.length/2;if(V>t.length){for(y=0;y<V;y++)delete o[l[y]];l.splice(0,V)}return u}function cp(e,n,t){const i=e.currentDevicePixelRatio,o=0!==t?Math.max(t/2,.5):0;return Math.round((n-o)*i)/i+o}function v2(e,n){(n=n||e.getContext("2d")).save(),n.resetTransform(),n.clearRect(0,0,e.width,e.height),n.restore()}function yb(e,n,t,i){let o,l,u,m,y;const C=n.pointStyle,T=n.rotation,A=n.radius;let z=(T||0)*n5;if(C&&"object"==typeof C&&(o=C.toString(),"[object HTMLImageElement]"===o||"[object HTMLCanvasElement]"===o))return e.save(),e.translate(t,i),e.rotate(z),e.drawImage(C,-C.width/2,-C.height/2,C.width,C.height),void e.restore();if(!(isNaN(A)||A<=0)){switch(e.beginPath(),C){default:e.arc(t,i,A,0,Ei),e.closePath();break;case"triangle":e.moveTo(t+Math.sin(z)*A,i-Math.cos(z)*A),z+=n2,e.lineTo(t+Math.sin(z)*A,i-Math.cos(z)*A),z+=n2,e.lineTo(t+Math.sin(z)*A,i-Math.cos(z)*A),e.closePath();break;case"rectRounded":y=.516*A,m=A-y,l=Math.cos(z+Cy)*m,u=Math.sin(z+Cy)*m,e.arc(t-l,i-u,y,z-qi,z-fr),e.arc(t+u,i-l,y,z-fr,z),e.arc(t+l,i+u,y,z,z+fr),e.arc(t-u,i+l,y,z+fr,z+qi),e.closePath();break;case"rect":if(!T){m=Math.SQRT1_2*A,e.rect(t-m,i-m,2*m,2*m);break}z+=Cy;case"rectRot":l=Math.cos(z)*A,u=Math.sin(z)*A,e.moveTo(t-l,i-u),e.lineTo(t+u,i-l),e.lineTo(t+l,i+u),e.lineTo(t-u,i+l),e.closePath();break;case"crossRot":z+=Cy;case"cross":l=Math.cos(z)*A,u=Math.sin(z)*A,e.moveTo(t-l,i-u),e.lineTo(t+l,i+u),e.moveTo(t+u,i-l),e.lineTo(t-u,i+l);break;case"star":l=Math.cos(z)*A,u=Math.sin(z)*A,e.moveTo(t-l,i-u),e.lineTo(t+l,i+u),e.moveTo(t+u,i-l),e.lineTo(t-u,i+l),z+=Cy,l=Math.cos(z)*A,u=Math.sin(z)*A,e.moveTo(t-l,i-u),e.lineTo(t+l,i+u),e.moveTo(t+u,i-l),e.lineTo(t-u,i+l);break;case"line":l=Math.cos(z)*A,u=Math.sin(z)*A,e.moveTo(t-l,i-u),e.lineTo(t+l,i+u);break;case"dash":e.moveTo(t,i),e.lineTo(t+Math.cos(z)*A,i+Math.sin(z)*A)}e.fill(),n.borderWidth>0&&e.stroke()}}function Py(e,n,t){return t=t||.5,!n||e&&e.x>n.left-t&&e.x<n.right+t&&e.y>n.top-t&&e.y<n.bottom+t}function vb(e,n){e.save(),e.beginPath(),e.rect(n.left,n.top,n.right-n.left,n.bottom-n.top),e.clip()}function xb(e){e.restore()}function k5(e,n,t,i,o){if(!n)return e.lineTo(t.x,t.y);if("middle"===o){const l=(n.x+t.x)/2;e.lineTo(l,n.y),e.lineTo(l,t.y)}else"after"===o!=!!i?e.lineTo(n.x,t.y):e.lineTo(t.x,n.y);e.lineTo(t.x,t.y)}function R5(e,n,t,i){if(!n)return e.lineTo(t.x,t.y);e.bezierCurveTo(i?n.cp1x:n.cp2x,i?n.cp1y:n.cp2y,i?t.cp2x:t.cp1x,i?t.cp2y:t.cp1y,t.x,t.y)}function up(e,n,t,i,o,l={}){const u=Ai(n)?n:[n],m=l.strokeWidth>0&&""!==l.strokeColor;let y,C;for(e.save(),e.font=o.string,function O5(e,n){n.translation&&e.translate(n.translation[0],n.translation[1]),oi(n.rotation)||e.rotate(n.rotation),n.color&&(e.fillStyle=n.color),n.textAlign&&(e.textAlign=n.textAlign),n.textBaseline&&(e.textBaseline=n.textBaseline)}(e,l),y=0;y<u.length;++y)C=u[y],m&&(l.strokeColor&&(e.strokeStyle=l.strokeColor),oi(l.strokeWidth)||(e.lineWidth=l.strokeWidth),e.strokeText(C,t,i,l.maxWidth)),e.fillText(C,t,i,l.maxWidth),L5(e,t,i,C,l),i+=o.lineHeight;e.restore()}function L5(e,n,t,i,o){if(o.strikethrough||o.underline){const l=e.measureText(i),u=n-l.actualBoundingBoxLeft,m=n+l.actualBoundingBoxRight,C=t+l.actualBoundingBoxDescent,T=o.strikethrough?(t-l.actualBoundingBoxAscent+C)/2:C;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=o.decorationWidth||2,e.moveTo(u,T),e.lineTo(m,T),e.stroke()}}function ky(e,n){const{x:t,y:i,w:o,h:l,radius:u}=n;e.arc(t+u.topLeft,i+u.topLeft,u.topLeft,-fr,qi,!0),e.lineTo(t,i+l-u.bottomLeft),e.arc(t+u.bottomLeft,i+l-u.bottomLeft,u.bottomLeft,qi,fr,!0),e.lineTo(t+o-u.bottomRight,i+l),e.arc(t+o-u.bottomRight,i+l-u.bottomRight,u.bottomRight,fr,0,!0),e.lineTo(t+o,i+u.topRight),e.arc(t+o-u.topRight,i+u.topRight,u.topRight,0,-fr,!0),e.lineTo(t+u.topLeft,i)}const F5=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),z5=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function N5(e,n){const t=(""+e).match(F5);if(!t||"normal"===t[1])return 1.2*n;switch(e=+t[2],t[3]){case"px":return e;case"%":e/=100}return n*e}const B5=e=>+e||0;function EE(e,n){const t={},i=$n(n),o=i?Object.keys(n):n,l=$n(e)?i?u=>Dn(e[u],e[n[u]]):u=>e[u]:()=>e;for(const u of o)t[u]=B5(l(u));return t}function x2(e){return EE(e,{top:"y",right:"x",bottom:"y",left:"x"})}function hp(e){return EE(e,["topLeft","topRight","bottomLeft","bottomRight"])}function Qo(e){const n=x2(e);return n.width=n.left+n.right,n.height=n.top+n.bottom,n}function no(e,n){let t=Dn((e=e||{}).size,(n=n||zn.font).size);"string"==typeof t&&(t=parseInt(t,10));let i=Dn(e.style,n.style);i&&!(""+i).match(z5)&&(console.warn('Invalid font style specified: "'+i+'"'),i="");const o={family:Dn(e.family,n.family),lineHeight:N5(Dn(e.lineHeight,n.lineHeight),t),size:t,style:i,weight:Dn(e.weight,n.weight),string:""};return o.string=function A5(e){return!e||oi(e.size)||oi(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}(o),o}function Ry(e,n,t,i){let l,u,m,o=!0;for(l=0,u=e.length;l<u;++l)if(m=e[l],void 0!==m&&(void 0!==n&&"function"==typeof m&&(m=m(n),o=!1),void 0!==t&&Ai(m)&&(m=m[t%m.length],o=!1),void 0!==m))return i&&!o&&(i.cacheable=!1),m}function Md(e,n){return Object.assign(Object.create(e),n)}function DE(e,n,t){t=t||(u=>e[u]<n);let l,i=e.length-1,o=0;for(;i-o>1;)l=o+i>>1,t(l)?o=l:i=l;return{lo:o,hi:i}}const Gu=(e,n,t)=>DE(e,t,i=>e[i][n]<t),j5=(e,n,t)=>DE(e,t,i=>e[i][n]>=t),b2=["push","pop","shift","splice","unshift"];function w2(e,n){const t=e._chartjs;if(!t)return;const i=t.listeners,o=i.indexOf(n);-1!==o&&i.splice(o,1),!(i.length>0)&&(b2.forEach(l=>{delete e[l]}),delete e._chartjs)}function C2(e){const n=new Set;let t,i;for(t=0,i=e.length;t<i;++t)n.add(e[t]);return n.size===i?e:Array.from(n)}function TE(e,n=[""],t=e,i,o=(()=>e[0])){il(i)||(i=M2("_fallback",e));const l={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:t,_fallback:i,_getTarget:o,override:u=>TE([u,...e],n,t,i)};return new Proxy(l,{deleteProperty:(u,m)=>(delete u[m],delete u._keys,delete e[0][m],!0),get:(u,m)=>D2(u,m,()=>function K5(e,n,t,i){let o;for(const l of n)if(o=M2(H5(l,e),t),il(o))return SE(e,o)?ME(t,i,e,o):o}(m,n,e,u)),getOwnPropertyDescriptor:(u,m)=>Reflect.getOwnPropertyDescriptor(u._scopes[0],m),getPrototypeOf:()=>Reflect.getPrototypeOf(e[0]),has:(u,m)=>I2(u).includes(m),ownKeys:u=>I2(u),set(u,m,y){const C=u._storage||(u._storage=o());return u[m]=C[m]=y,delete u._keys,!0}})}function ng(e,n,t,i){const o={_cacheable:!1,_proxy:e,_context:n,_subProxy:t,_stack:new Set,_descriptors:E2(e,i),setContext:l=>ng(e,l,t,i),override:l=>ng(e.override(l),n,t,i)};return new Proxy(o,{deleteProperty:(l,u)=>(delete l[u],delete e[u],!0),get:(l,u,m)=>D2(l,u,()=>function G5(e,n,t){const{_proxy:i,_context:o,_subProxy:l,_descriptors:u}=e;let m=i[n];return Dd(m)&&u.isScriptable(n)&&(m=function W5(e,n,t,i){const{_proxy:o,_context:l,_subProxy:u,_stack:m}=t;if(m.has(e))throw new Error("Recursion detected: "+Array.from(m).join("->")+"->"+e);return m.add(e),n=n(l,u||i),m.delete(e),SE(e,n)&&(n=ME(o._scopes,o,e,n)),n}(n,m,e,t)),Ai(m)&&m.length&&(m=function q5(e,n,t,i){const{_proxy:o,_context:l,_subProxy:u,_descriptors:m}=t;if(il(l.index)&&i(e))n=n[l.index%n.length];else if($n(n[0])){const y=n,C=o._scopes.filter(T=>T!==y);n=[];for(const T of y){const A=ME(C,o,e,T);n.push(ng(A,l,u&&u[e],m))}}return n}(n,m,e,u.isIndexable)),SE(n,m)&&(m=ng(m,o,l&&l[n],u)),m}(l,u,m)),getOwnPropertyDescriptor:(l,u)=>l._descriptors.allKeys?Reflect.has(e,u)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,u),getPrototypeOf:()=>Reflect.getPrototypeOf(e),has:(l,u)=>Reflect.has(e,u),ownKeys:()=>Reflect.ownKeys(e),set:(l,u,m)=>(e[u]=m,delete l[u],!0)})}function E2(e,n={scriptable:!0,indexable:!0}){const{_scriptable:t=n.scriptable,_indexable:i=n.indexable,_allKeys:o=n.allKeys}=e;return{allKeys:o,scriptable:t,indexable:i,isScriptable:Dd(t)?t:()=>t,isIndexable:Dd(i)?i:()=>i}}const H5=(e,n)=>e?e+fE(n):n,SE=(e,n)=>$n(n)&&"adapters"!==e&&(null===Object.getPrototypeOf(n)||n.constructor===Object);function D2(e,n,t){if(Object.prototype.hasOwnProperty.call(e,n))return e[n];const i=t();return e[n]=i,i}function T2(e,n,t){return Dd(e)?e(n,t):e}const Z5=(e,n)=>!0===e?n:"string"==typeof e?Ed(n,e):void 0;function X5(e,n,t,i,o){for(const l of n){const u=Z5(t,l);if(u){e.add(u);const m=T2(u._fallback,t,o);if(il(m)&&m!==t&&m!==i)return m}else if(!1===u&&il(i)&&t!==i)return null}return!1}function ME(e,n,t,i){const o=n._rootScopes,l=T2(n._fallback,t,i),u=[...e,...o],m=new Set;m.add(i);let y=S2(m,u,t,l||t,i);return!(null===y||il(l)&&l!==t&&(y=S2(m,u,l,y,i),null===y))&&TE(Array.from(m),[""],o,l,()=>function Y5(e,n,t){const i=e._getTarget();n in i||(i[n]={});const o=i[n];return Ai(o)&&$n(t)?t:o}(n,t,i))}function S2(e,n,t,i,o){for(;t;)t=X5(e,n,t,i,o);return t}function M2(e,n){for(const t of n){if(!t)continue;const i=t[e];if(il(i))return i}}function I2(e){let n=e._keys;return n||(n=e._keys=function J5(e){const n=new Set;for(const t of e)for(const i of Object.keys(t).filter(o=>!o.startsWith("_")))n.add(i);return Array.from(n)}(e._scopes)),n}function A2(e,n,t,i){const{iScale:o}=e,{key:l="r"}=this._parsing,u=new Array(i);let m,y,C,T;for(m=0,y=i;m<y;++m)C=m+t,T=n[C],u[m]={r:o.parse(Ed(T,l),C)};return u}const Q5=Number.EPSILON||1e-14,ig=(e,n)=>n<e.length&&!e[n].skip&&e[n],P2=e=>"x"===e?"y":"x";function e4(e,n,t,i){const o=e.skip?n:e,l=n,u=t.skip?n:t,m=mE(l,o),y=mE(u,l);let C=m/(m+y),T=y/(m+y);C=isNaN(C)?0:C,T=isNaN(T)?0:T;const A=i*C,z=i*T;return{previous:{x:l.x-A*(u.x-o.x),y:l.y-A*(u.y-o.y)},next:{x:l.x+z*(u.x-o.x),y:l.y+z*(u.y-o.y)}}}function bb(e,n,t){return Math.max(Math.min(e,t),n)}function o4(e,n,t,i,o){let l,u,m,y;if(n.spanGaps&&(e=e.filter(C=>!C.skip)),"monotone"===n.cubicInterpolationMode)!function i4(e,n="x"){const t=P2(n),i=e.length,o=Array(i).fill(0),l=Array(i);let u,m,y,C=ig(e,0);for(u=0;u<i;++u)if(m=y,y=C,C=ig(e,u+1),y){if(C){const T=C[n]-y[n];o[u]=0!==T?(C[t]-y[t])/T:0}l[u]=m?C?Uc(o[u-1])!==Uc(o[u])?0:(o[u-1]+o[u])/2:o[u-1]:o[u]}(function t4(e,n,t){const i=e.length;let o,l,u,m,y,C=ig(e,0);for(let T=0;T<i-1;++T)if(y=C,C=ig(e,T+1),y&&C){if(Dy(n[T],0,Q5)){t[T]=t[T+1]=0;continue}o=t[T]/n[T],l=t[T+1]/n[T],m=Math.pow(o,2)+Math.pow(l,2),!(m<=9)&&(u=3/Math.sqrt(m),t[T]=o*u*n[T],t[T+1]=l*u*n[T])}})(e,o,l),function n4(e,n,t="x"){const i=P2(t),o=e.length;let l,u,m,y=ig(e,0);for(let C=0;C<o;++C){if(u=m,m=y,y=ig(e,C+1),!m)continue;const T=m[t],A=m[i];u&&(l=(T-u[t])/3,m[`cp1${t}`]=T-l,m[`cp1${i}`]=A-l*n[C]),y&&(l=(y[t]-T)/3,m[`cp2${t}`]=T+l,m[`cp2${i}`]=A+l*n[C])}}(e,l,n)}(e,o);else{let C=i?e[e.length-1]:e[0];for(l=0,u=e.length;l<u;++l)m=e[l],y=e4(C,m,e[Math.min(l+1,u-(i?0:1))%u],n.tension),m.cp1x=y.previous.x,m.cp1y=y.previous.y,m.cp2x=y.next.x,m.cp2y=y.next.y,C=m}n.capBezierPoints&&function r4(e,n){let t,i,o,l,u,m=Py(e[0],n);for(t=0,i=e.length;t<i;++t)u=l,l=m,m=t<i-1&&Py(e[t+1],n),l&&(o=e[t],u&&(o.cp1x=bb(o.cp1x,n.left,n.right),o.cp1y=bb(o.cp1y,n.top,n.bottom)),m&&(o.cp2x=bb(o.cp2x,n.left,n.right),o.cp2y=bb(o.cp2y,n.top,n.bottom)))}(e,t)}function k2(){return typeof window<"u"&&typeof document<"u"}function IE(e){let n=e.parentNode;return n&&"[object ShadowRoot]"===n.toString()&&(n=n.host),n}function wb(e,n,t){let i;return"string"==typeof e?(i=parseInt(e,10),-1!==e.indexOf("%")&&(i=i/100*n.parentNode[t])):i=e,i}const Cb=e=>window.getComputedStyle(e,null),a4=["top","right","bottom","left"];function dp(e,n,t){const i={};t=t?"-"+t:"";for(let o=0;o<4;o++){const l=a4[o];i[l]=parseFloat(e[n+"-"+l+t])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const l4=(e,n,t)=>(e>0||n>0)&&(!t||!t.shadowRoot);function fp(e,n){if("native"in e)return e;const{canvas:t,currentDevicePixelRatio:i}=n,o=Cb(t),l="border-box"===o.boxSizing,u=dp(o,"padding"),m=dp(o,"border","width"),{x:y,y:C,box:T}=function c4(e,n){const t=e.touches,i=t&&t.length?t[0]:e,{offsetX:o,offsetY:l}=i;let m,y,u=!1;if(l4(o,l,e.target))m=o,y=l;else{const C=n.getBoundingClientRect();m=i.clientX-C.left,y=i.clientY-C.top,u=!0}return{x:m,y,box:u}}(e,t),A=u.left+(T&&m.left),z=u.top+(T&&m.top);let{width:V,height:H}=n;return l&&(V-=u.width+m.width,H-=u.height+m.height),{x:Math.round((y-A)/V*t.width/i),y:Math.round((C-z)/H*t.height/i)}}const AE=e=>Math.round(10*e)/10;function R2(e,n,t){const i=n||1,o=Math.floor(e.height*i),l=Math.floor(e.width*i);e.height=o/i,e.width=l/i;const u=e.canvas;return u.style&&(t||!u.style.height&&!u.style.width)&&(u.style.height=`${e.height}px`,u.style.width=`${e.width}px`),(e.currentDevicePixelRatio!==i||u.height!==o||u.width!==l)&&(e.currentDevicePixelRatio=i,u.height=o,u.width=l,e.ctx.setTransform(i,0,0,i,0,0),!0)}const d4=function(){let e=!1;try{const n={get passive(){return e=!0,!1}};window.addEventListener("test",null,n),window.removeEventListener("test",null,n)}catch{}return e}();function O2(e,n){const t=function s4(e,n){return Cb(e).getPropertyValue(n)}(e,n),i=t&&t.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function pp(e,n,t,i){return{x:e.x+t*(n.x-e.x),y:e.y+t*(n.y-e.y)}}function f4(e,n,t,i){return{x:e.x+t*(n.x-e.x),y:"middle"===i?t<.5?e.y:n.y:"after"===i?t<1?e.y:n.y:t>0?n.y:e.y}}function p4(e,n,t,i){const o={x:e.cp2x,y:e.cp2y},l={x:n.cp1x,y:n.cp1y},u=pp(e,o,t),m=pp(o,l,t),y=pp(l,n,t),C=pp(u,m,t),T=pp(m,y,t);return pp(C,T,t)}const L2=new Map;function Oy(e,n,t){return function m4(e,n){n=n||{};const t=e+JSON.stringify(n);let i=L2.get(t);return i||(i=new Intl.NumberFormat(e,n),L2.set(t,i)),i}(n,t).format(e)}const g4=function(e,n){return{x:t=>e+e+n-t,setWidth(t){n=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,i)=>t-i,leftForLtr:(t,i)=>t-i}},_4=function(){return{x:e=>e,setWidth(e){},textAlign:e=>e,xPlus:(e,n)=>e+n,leftForLtr:(e,n)=>e}};function rg(e,n,t){return e?g4(n,t):_4()}function F2(e,n){let t,i;("ltr"===n||"rtl"===n)&&(t=e.canvas.style,i=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",n,"important"),e.prevTextDirection=i)}function z2(e,n){void 0!==n&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",n[0],n[1]))}function N2(e){return"angle"===e?{between:Ty,compare:o5,normalize:ba}:{between:$u,compare:(n,t)=>n-t,normalize:n=>n}}function B2({start:e,end:n,count:t,loop:i,style:o}){return{start:e%t,end:n%t,loop:i&&(n-e+1)%t==0,style:o}}function V2(e,n,t){if(!t)return[e];const{property:i,start:o,end:l}=t,u=n.length,{compare:m,between:y,normalize:C}=N2(i),{start:T,end:A,loop:z,style:V}=function y4(e,n,t){const{property:i,start:o,end:l}=t,{between:u,normalize:m}=N2(i),y=n.length;let z,V,{start:C,end:T,loop:A}=e;if(A){for(C+=y,T+=y,z=0,V=y;z<V&&u(m(n[C%y][i]),o,l);++z)C--,T--;C%=y,T%=y}return T<C&&(T+=y),{start:C,end:T,loop:A,style:e.style}}(e,n,t),H=[];let le,we,ve,X=!1,oe=null;for(let kt=T,Ot=T;kt<=A;++kt)we=n[kt%u],!we.skip&&(le=C(we[i]),le!==ve&&(X=y(le,o,l),null===oe&&(X||y(o,ve,le)&&0!==m(o,ve))&&(oe=0===m(le,o)?kt:Ot),null!==oe&&(!X||0===m(l,le)||y(l,ve,le))&&(H.push(B2({start:oe,end:kt,loop:z,count:u,style:V})),oe=null),Ot=kt,ve=le));return null!==oe&&H.push(B2({start:oe,end:A,loop:z,count:u,style:V})),H}function j2(e,n){const t=[],i=e.segments;for(let o=0;o<i.length;o++){const l=V2(i[o],e.points,n);l.length&&t.push(...l)}return t}function $2(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function C4(e,n){return n&&JSON.stringify(e)!==JSON.stringify(n)}var Wu=new class E4{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(n,t,i,o){const u=t.duration;t.listeners[o].forEach(m=>m({chart:n,initial:t.initial,numSteps:u,currentStep:Math.min(i-t.start,u)}))}_refresh(){this._request||(this._running=!0,this._request=YA.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(n=Date.now()){let t=0;this._charts.forEach((i,o)=>{if(!i.running||!i.items.length)return;const l=i.items;let y,u=l.length-1,m=!1;for(;u>=0;--u)y=l[u],y._active?(y._total>i.duration&&(i.duration=y._total),y.tick(n),m=!0):(l[u]=l[l.length-1],l.pop());m&&(o.draw(),this._notify(o,i,n,"progress")),l.length||(i.running=!1,this._notify(o,i,n,"complete"),i.initial=!1),t+=l.length}),this._lastDate=n,0===t&&(this._running=!1)}_getAnims(n){const t=this._charts;let i=t.get(n);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(n,i)),i}listen(n,t,i){this._getAnims(n).listeners[t].push(i)}add(n,t){!t||!t.length||this._getAnims(n).items.push(...t)}has(n){return this._getAnims(n).items.length>0}start(n){const t=this._charts.get(n);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((i,o)=>Math.max(i,o._duration),0),this._refresh())}running(n){if(!this._running)return!1;const t=this._charts.get(n);return!(!t||!t.running||!t.items.length)}stop(n){const t=this._charts.get(n);if(!t||!t.items.length)return;const i=t.items;let o=i.length-1;for(;o>=0;--o)i[o].cancel();t.items=[],this._notify(n,t,Date.now(),"complete")}remove(n){return this._charts.delete(n)}};const H2="transparent",D4={boolean:(e,n,t)=>t>.5?n:e,color(e,n,t){const i=y2(e||H2),o=i.valid&&y2(n||H2);return o&&o.valid?o.mix(i,t).hexString():n},number:(e,n,t)=>e+(n-e)*t};class T4{constructor(n,t,i,o){const l=t[i];o=Ry([n.to,o,l,n.from]);const u=Ry([n.from,l,o]);this._active=!0,this._fn=n.fn||D4[n.type||typeof u],this._easing=Sy[n.easing]||Sy.linear,this._start=Math.floor(Date.now()+(n.delay||0)),this._duration=this._total=Math.floor(n.duration),this._loop=!!n.loop,this._target=t,this._prop=i,this._from=u,this._to=o,this._promises=void 0}active(){return this._active}update(n,t,i){if(this._active){this._notify(!1);const o=this._target[this._prop],l=i-this._start,u=this._duration-l;this._start=i,this._duration=Math.floor(Math.max(u,n.duration)),this._total+=l,this._loop=!!n.loop,this._to=Ry([n.to,t,o,n.from]),this._from=Ry([n.from,o,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(n){const t=n-this._start,i=this._duration,o=this._prop,l=this._from,u=this._loop,m=this._to;let y;if(this._active=l!==m&&(u||t<i),!this._active)return this._target[o]=m,void this._notify(!0);t<0?this._target[o]=l:(y=t/i%2,y=u&&y>1?2-y:y,y=this._easing(Math.min(1,Math.max(0,y))),this._target[o]=this._fn(l,m,y))}wait(){const n=this._promises||(this._promises=[]);return new Promise((t,i)=>{n.push({res:t,rej:i})})}_notify(n){const t=n?"res":"rej",i=this._promises||[];for(let o=0;o<i.length;o++)i[o][t]()}}zn.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const I4=Object.keys(zn.animation);zn.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>"onProgress"!==e&&"onComplete"!==e&&"fn"!==e}),zn.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),zn.describe("animations",{_fallback:"animation"}),zn.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>0|e}}}});class G2{constructor(n,t){this._chart=n,this._properties=new Map,this.configure(t)}configure(n){if(!$n(n))return;const t=this._properties;Object.getOwnPropertyNames(n).forEach(i=>{const o=n[i];if(!$n(o))return;const l={};for(const u of I4)l[u]=o[u];(Ai(o.properties)&&o.properties||[i]).forEach(u=>{(u===i||!t.has(u))&&t.set(u,l)})})}_animateOptions(n,t){const i=t.options,o=function P4(e,n){if(!n)return;let t=e.options;if(t)return t.$shared&&(e.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t;e.options=n}(n,i);if(!o)return[];const l=this._createAnimations(o,i);return i.$shared&&function A4(e,n){const t=[],i=Object.keys(n);for(let o=0;o<i.length;o++){const l=e[i[o]];l&&l.active()&&t.push(l.wait())}return Promise.all(t)}(n.options.$animations,i).then(()=>{n.options=i},()=>{}),l}_createAnimations(n,t){const i=this._properties,o=[],l=n.$animations||(n.$animations={}),u=Object.keys(t),m=Date.now();let y;for(y=u.length-1;y>=0;--y){const C=u[y];if("$"===C.charAt(0))continue;if("options"===C){o.push(...this._animateOptions(n,t));continue}const T=t[C];let A=l[C];const z=i.get(C);if(A){if(z&&A.active()){A.update(z,T,m);continue}A.cancel()}z&&z.duration?(l[C]=A=new T4(z,n,C,T),o.push(A)):n[C]=T}return o}update(n,t){if(0===this._properties.size)return void Object.assign(n,t);const i=this._createAnimations(n,t);return i.length?(Wu.add(this._chart,i),!0):void 0}}function W2(e,n){const t=e&&e.options||{},i=t.reverse,o=void 0===t.min?n:0,l=void 0===t.max?n:0;return{start:i?l:o,end:i?o:l}}function q2(e,n){const t=[],i=e._getSortedDatasetMetas(n);let o,l;for(o=0,l=i.length;o<l;++o)t.push(i[o].index);return t}function Z2(e,n,t,i={}){const o=e.keys,l="single"===i.mode;let u,m,y,C;if(null!==n){for(u=0,m=o.length;u<m;++u){if(y=+o[u],y===t){if(i.all)continue;break}C=e.values[y],Er(C)&&(l||0===n||Uc(n)===Uc(C))&&(n+=C)}return n}}function X2(e,n){const t=e&&e.options.stacked;return t||void 0===t&&void 0!==n.stack}function z4(e,n,t){const i=e[n]||(e[n]={});return i[t]||(i[t]={})}function Y2(e,n,t,i){for(const o of n.getMatchingVisibleMetas(i).reverse()){const l=e[o.index];if(t&&l>0||!t&&l<0)return o.index}return null}function K2(e,n){const{chart:t,_cachedMeta:i}=e,o=t._stacks||(t._stacks={}),{iScale:l,vScale:u,index:m}=i,y=l.axis,C=u.axis,T=function L4(e,n,t){return`${e.id}.${n.id}.${t.stack||t.type}`}(l,u,i),A=n.length;let z;for(let V=0;V<A;++V){const H=n[V],{[y]:X,[C]:oe}=H;z=(H._stacks||(H._stacks={}))[C]=z4(o,T,X),z[m]=oe,z._top=Y2(z,u,!0,i.type),z._bottom=Y2(z,u,!1,i.type)}}function PE(e,n){const t=e.scales;return Object.keys(t).filter(i=>t[i].axis===n).shift()}function Ly(e,n){const t=e.controller.index,i=e.vScale&&e.vScale.axis;if(i){n=n||e._parsed;for(const o of n){const l=o._stacks;if(!l||void 0===l[i]||void 0===l[i][t])return;delete l[i][t]}}}const kE=e=>"reset"===e||"none"===e,J2=(e,n)=>n?e:Object.assign({},e);let qu=(()=>{class e{constructor(t,i){this.chart=t,this._ctx=t.ctx,this.index=i,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=X2(t.vScale,t),this.addElements()}updateIndex(t){this.index!==t&&Ly(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,i=this._cachedMeta,o=this.getDataset(),l=(z,V,H,X)=>"x"===z?V:"r"===z?X:H,u=i.xAxisID=Dn(o.xAxisID,PE(t,"x")),m=i.yAxisID=Dn(o.yAxisID,PE(t,"y")),y=i.rAxisID=Dn(o.rAxisID,PE(t,"r")),C=i.indexAxis,T=i.iAxisID=l(C,u,m,y),A=i.vAxisID=l(C,m,u,y);i.xScale=this.getScaleForId(u),i.yScale=this.getScaleForId(m),i.rScale=this.getScaleForId(y),i.iScale=this.getScaleForId(T),i.vScale=this.getScaleForId(A)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const i=this._cachedMeta;return t===i.iScale?i.vScale:i.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&w2(this._data,this),t._stacked&&Ly(t)}_dataCheck(){const t=this.getDataset(),i=t.data||(t.data=[]),o=this._data;if($n(i))this._data=function O4(e){const n=Object.keys(e),t=new Array(n.length);let i,o,l;for(i=0,o=n.length;i<o;++i)l=n[i],t[i]={x:l,y:e[l]};return t}(i);else if(o!==i){if(o){w2(o,this);const l=this._cachedMeta;Ly(l),l._parsed=[]}i&&Object.isExtensible(i)&&function $5(e,n){e._chartjs?e._chartjs.listeners.push(n):(Object.defineProperty(e,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[n]}}),b2.forEach(t=>{const i="_onData"+fE(t),o=e[t];Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value(...l){const u=o.apply(this,l);return e._chartjs.listeners.forEach(m=>{"function"==typeof m[i]&&m[i](...l)}),u}})}))}(i,this),this._syncList=[],this._data=i}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const i=this._cachedMeta,o=this.getDataset();let l=!1;this._dataCheck();const u=i._stacked;i._stacked=X2(i.vScale,i),i.stack!==o.stack&&(l=!0,Ly(i),i.stack=o.stack),this._resyncElements(t),(l||u!==i._stacked)&&K2(this,i._parsed)}configure(){const t=this.chart.config,i=t.datasetScopeKeys(this._type),o=t.getOptionScopes(this.getDataset(),i,!0);this.options=t.createResolver(o,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,i){const{_cachedMeta:o,_data:l}=this,{iScale:u,_stacked:m}=o,y=u.axis;let A,z,V,C=0===t&&i===l.length||o._sorted,T=t>0&&o._parsed[t-1];if(!1===this._parsing)o._parsed=l,o._sorted=!0,V=l;else{V=Ai(l[t])?this.parseArrayData(o,l,t,i):$n(l[t])?this.parseObjectData(o,l,t,i):this.parsePrimitiveData(o,l,t,i);const H=()=>null===z[y]||T&&z[y]<T[y];for(A=0;A<i;++A)o._parsed[A+t]=z=V[A],C&&(H()&&(C=!1),T=z);o._sorted=C}m&&K2(this,V)}parsePrimitiveData(t,i,o,l){const{iScale:u,vScale:m}=t,y=u.axis,C=m.axis,T=u.getLabels(),A=u===m,z=new Array(l);let V,H,X;for(V=0,H=l;V<H;++V)X=V+o,z[V]={[y]:A||u.parse(T[X],X),[C]:m.parse(i[X],X)};return z}parseArrayData(t,i,o,l){const{xScale:u,yScale:m}=t,y=new Array(l);let C,T,A,z;for(C=0,T=l;C<T;++C)A=C+o,z=i[A],y[C]={x:u.parse(z[0],A),y:m.parse(z[1],A)};return y}parseObjectData(t,i,o,l){const{xScale:u,yScale:m}=t,{xAxisKey:y="x",yAxisKey:C="y"}=this._parsing,T=new Array(l);let A,z,V,H;for(A=0,z=l;A<z;++A)V=A+o,H=i[V],T[A]={x:u.parse(Ed(H,y),V),y:m.parse(Ed(H,C),V)};return T}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,i,o){const u=this._cachedMeta,m=i[t.axis];return Z2({keys:q2(this.chart,!0),values:i._stacks[t.axis]},m,u.index,{mode:o})}updateRangeFromParsed(t,i,o,l){const u=o[i.axis];let m=null===u?NaN:u;const y=l&&o._stacks[i.axis];l&&y&&(l.values=y,m=Z2(l,u,this._cachedMeta.index)),t.min=Math.min(t.min,m),t.max=Math.max(t.max,m)}getMinMax(t,i){const o=this._cachedMeta,l=o._parsed,u=o._sorted&&t===o.iScale,m=l.length,y=this._getOtherScale(t),C=((e,n,t)=>e&&!n.hidden&&n._stacked&&{keys:q2(this.chart,!0),values:null})(i,o),T={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:A,max:z}=function F4(e){const{min:n,max:t,minDefined:i,maxDefined:o}=e.getUserBounds();return{min:i?n:Number.NEGATIVE_INFINITY,max:o?t:Number.POSITIVE_INFINITY}}(y);let V,H;function X(){H=l[V];const oe=H[y.axis];return!Er(H[t.axis])||A>oe||z<oe}for(V=0;V<m&&(X()||(this.updateRangeFromParsed(T,t,H,C),!u));++V);if(u)for(V=m-1;V>=0;--V)if(!X()){this.updateRangeFromParsed(T,t,H,C);break}return T}getAllParsedValues(t){const i=this._cachedMeta._parsed,o=[];let l,u,m;for(l=0,u=i.length;l<u;++l)m=i[l][t.axis],Er(m)&&o.push(m);return o}getMaxOverflow(){return!1}getLabelAndValue(t){const i=this._cachedMeta,o=i.iScale,l=i.vScale,u=this.getParsed(t);return{label:o?""+o.getLabelForValue(u[o.axis]):"",value:l?""+l.getLabelForValue(u[l.axis]):""}}_update(t){const i=this._cachedMeta;this.update(t||"default"),i._clip=function R4(e){let n,t,i,o;return $n(e)?(n=e.top,t=e.right,i=e.bottom,o=e.left):n=t=i=o=e,{top:n,right:t,bottom:i,left:o,disabled:!1===e}}(Dn(this.options.clip,function k4(e,n,t){if(!1===t)return!1;const i=W2(e,t),o=W2(n,t);return{top:o.end,right:i.end,bottom:o.start,left:i.start}}(i.xScale,i.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,o=this._cachedMeta,l=o.data||[],u=this.chart.chartArea,m=[],y=this._drawStart||0,C=this._drawCount||l.length-y,T=this.options.drawActiveElementsOnTop;let A;for(o.dataset&&o.dataset.draw(t,u,y,C),A=y;A<y+C;++A){const z=l[A];z.hidden||(z.active&&T?m.push(z):z.draw(t,u))}for(A=0;A<m.length;++A)m[A].draw(t,u)}getStyle(t,i){const o=i?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(o):this.resolveDataElementOptions(t||0,o)}getContext(t,i,o){const l=this.getDataset();let u;if(t>=0&&t<this._cachedMeta.data.length){const m=this._cachedMeta.data[t];u=m.$context||(m.$context=function B4(e,n,t){return Md(e,{active:!1,dataIndex:n,parsed:void 0,raw:void 0,element:t,index:n,mode:"default",type:"data"})}(this.getContext(),t,m)),u.parsed=this.getParsed(t),u.raw=l.data[t],u.index=u.dataIndex=t}else u=this.$context||(this.$context=function N4(e,n){return Md(e,{active:!1,dataset:void 0,datasetIndex:n,index:n,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),u.dataset=l,u.index=u.datasetIndex=this.index;return u.active=!!i,u.mode=o,u}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,i){return this._resolveElementOptions(this.dataElementType.id,i,t)}_resolveElementOptions(t,i="default",o){const l="active"===i,u=this._cachedDataOpts,m=t+"-"+i,y=u[m],C=this.enableOptionSharing&&il(o);if(y)return J2(y,C);const T=this.chart.config,A=T.datasetElementScopeKeys(this._type,t),z=l?[`${t}Hover`,"hover",t,""]:[t,""],V=T.getOptionScopes(this.getDataset(),A),H=Object.keys(zn.elements[t]),oe=T.resolveNamedOptions(V,H,()=>this.getContext(o,l),z);return oe.$shared&&(oe.$shared=C,u[m]=Object.freeze(J2(oe,C))),oe}_resolveAnimations(t,i,o){const l=this.chart,u=this._cachedDataOpts,m=`animation-${i}`,y=u[m];if(y)return y;let C;if(!1!==l.options.animation){const A=this.chart.config,z=A.datasetAnimationScopeKeys(this._type,i),V=A.getOptionScopes(this.getDataset(),z);C=A.createResolver(V,this.getContext(t,o,i))}const T=new G2(l,C&&C.animations);return C&&C._cacheable&&(u[m]=Object.freeze(T)),T}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,i){return!i||kE(t)||this.chart._animationsDisabled}updateElement(t,i,o,l){kE(l)?Object.assign(t,o):this._resolveAnimations(i,l).update(t,o)}updateSharedOptions(t,i,o){t&&!kE(i)&&this._resolveAnimations(void 0,i).update(t,o)}_setStyle(t,i,o,l){t.active=l;const u=this.getStyle(i,l);this._resolveAnimations(i,o,l).update(t,{options:!l&&this.getSharedOptions(u)||u})}removeHoverStyle(t,i,o){this._setStyle(t,o,"active",!1)}setHoverStyle(t,i,o){this._setStyle(t,o,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const i=this._data,o=this._cachedMeta.data;for(const[y,C,T]of this._syncList)this[y](C,T);this._syncList=[];const l=o.length,u=i.length,m=Math.min(u,l);m&&this.parse(0,m),u>l?this._insertElements(l,u-l,t):u<l&&this._removeElements(u,l-u)}_insertElements(t,i,o=!0){const l=this._cachedMeta,u=l.data,m=t+i;let y;const C=T=>{for(T.length+=i,y=T.length-1;y>=m;y--)T[y]=T[y-i]};for(C(u),y=t;y<m;++y)u[y]=new this.dataElementType;this._parsing&&C(l._parsed),this.parse(t,i),o&&this.updateElements(u,t,i,"reset")}updateElements(t,i,o,l){}_removeElements(t,i){const o=this._cachedMeta;if(this._parsing){const l=o._parsed.splice(t,i);o._stacked&&Ly(o,l)}o.data.splice(t,i)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[i,o,l]=t;this[i](o,l)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,i){i&&this._sync(["_removeElements",t,i]);const o=arguments.length-2;o&&this._sync(["_insertElements",t,o])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return e.defaults={},e})();function U4(e){const n=e.iScale,t=function j4(e,n){if(!e._cache.$bar){const t=e.getMatchingVisibleMetas(n);let i=[];for(let o=0,l=t.length;o<l;o++)i=i.concat(t[o].controller.getAllParsedValues(e));e._cache.$bar=C2(i.sort((o,l)=>o-l))}return e._cache.$bar}(n,e.type);let o,l,u,m,i=n._length;const y=()=>{32767===u||-32768===u||(il(m)&&(i=Math.min(i,Math.abs(u-m)||i)),m=u)};for(o=0,l=t.length;o<l;++o)u=n.getPixelForValue(t[o]),y();for(m=void 0,o=0,l=n.ticks.length;o<l;++o)u=n.getPixelForTick(o),y();return i}function Q2(e,n,t,i){return Ai(e)?function G4(e,n,t,i){const o=t.parse(e[0],i),l=t.parse(e[1],i),u=Math.min(o,l),m=Math.max(o,l);let y=u,C=m;Math.abs(u)>Math.abs(m)&&(y=m,C=u),n[t.axis]=C,n._custom={barStart:y,barEnd:C,start:o,end:l,min:u,max:m}}(e,n,t,i):n[t.axis]=t.parse(e,i),n}function eP(e,n,t,i){const o=e.iScale,l=e.vScale,u=o.getLabels(),m=o===l,y=[];let C,T,A,z;for(C=t,T=t+i;C<T;++C)z=n[C],A={},A[o.axis]=m||o.parse(u[C],C),y.push(Q2(z,A,l,C));return y}function RE(e){return e&&void 0!==e.barStart&&void 0!==e.barEnd}function Z4(e,n,t,i){let o=n.borderSkipped;const l={};if(!o)return void(e.borderSkipped=l);const{start:u,end:m,reverse:y,top:C,bottom:T}=function q4(e){let n,t,i,o,l;return e.horizontal?(n=e.base>e.x,t="left",i="right"):(n=e.base<e.y,t="bottom",i="top"),n?(o="end",l="start"):(o="start",l="end"),{start:t,end:i,reverse:n,top:o,bottom:l}}(e);"middle"===o&&t&&(e.enableBorderRadius=!0,(t._top||0)===i?o=C:(t._bottom||0)===i?o=T:(l[tP(T,u,m,y)]=!0,o=C)),l[tP(o,u,m,y)]=!0,e.borderSkipped=l}function tP(e,n,t,i){return i?(e=function X4(e,n,t){return e===n?t:e===t?n:e}(e,n,t),e=nP(e,t,n)):e=nP(e,n,t),e}function nP(e,n,t){return"start"===e?n:"end"===e?t:e}function Y4(e,{inflateAmount:n},t){e.inflateAmount="auto"===n?1===t?.33:0:n}qu.prototype.datasetElementType=null,qu.prototype.dataElementType=null;let K4=(()=>{class e extends qu{parsePrimitiveData(t,i,o,l){return eP(t,i,o,l)}parseArrayData(t,i,o,l){return eP(t,i,o,l)}parseObjectData(t,i,o,l){const{iScale:u,vScale:m}=t,{xAxisKey:y="x",yAxisKey:C="y"}=this._parsing,T="x"===u.axis?y:C,A="x"===m.axis?y:C,z=[];let V,H,X,oe;for(V=o,H=o+l;V<H;++V)oe=i[V],X={},X[u.axis]=u.parse(Ed(oe,T),V),z.push(Q2(Ed(oe,A),X,m,V));return z}updateRangeFromParsed(t,i,o,l){super.updateRangeFromParsed(t,i,o,l);const u=o._custom;u&&i===this._cachedMeta.vScale&&(t.min=Math.min(t.min,u.min),t.max=Math.max(t.max,u.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const i=this._cachedMeta,{iScale:o,vScale:l}=i,u=this.getParsed(t),m=u._custom,y=RE(m)?"["+m.start+", "+m.end+"]":""+l.getLabelForValue(u[l.axis]);return{label:""+o.getLabelForValue(u[o.axis]),value:y}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(t){const i=this._cachedMeta;this.updateElements(i.data,0,i.data.length,t)}updateElements(t,i,o,l){const u="reset"===l,{index:m,_cachedMeta:{vScale:y}}=this,C=y.getBasePixel(),T=y.isHorizontal(),A=this._getRuler(),z=this.resolveDataElementOptions(i,l),V=this.getSharedOptions(z),H=this.includeOptions(l,V);this.updateSharedOptions(V,l,z);for(let X=i;X<i+o;X++){const oe=this.getParsed(X),le=u||oi(oe[y.axis])?{base:C,head:C}:this._calculateBarValuePixels(X),we=this._calculateBarIndexPixels(X,A),ve=(oe._stacks||{})[y.axis],Re={horizontal:T,base:le.base,enableBorderRadius:!ve||RE(oe._custom)||m===ve._top||m===ve._bottom,x:T?le.head:we.center,y:T?we.center:le.head,height:T?we.size:Math.abs(le.size),width:T?Math.abs(le.size):we.size};H&&(Re.options=V||this.resolveDataElementOptions(X,t[X].active?"active":l));const Fe=Re.options||t[X].options;Z4(Re,Fe,ve,m),Y4(Re,Fe,A.ratio),this.updateElement(t[X],X,Re,l)}}_getStacks(t,i){const l=this._cachedMeta.iScale,u=l.getMatchingVisibleMetas(this._type),m=l.options.stacked,y=u.length,C=[];let T,A;for(T=0;T<y;++T)if(A=u[T],A.controller.options.grouped){if(typeof i<"u"){const z=A.controller.getParsed(i)[A.controller._cachedMeta.vScale.axis];if(oi(z)||isNaN(z))continue}if((!1===m||-1===C.indexOf(A.stack)||void 0===m&&void 0===A.stack)&&C.push(A.stack),A.index===t)break}return C.length||C.push(void 0),C}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,i,o){const l=this._getStacks(t,o),u=void 0!==i?l.indexOf(i):-1;return-1===u?l.length-1:u}_getRuler(){const t=this.options,i=this._cachedMeta,o=i.iScale,l=[];let u,m;for(u=0,m=i.data.length;u<m;++u)l.push(o.getPixelForValue(this.getParsed(u)[o.axis],u));const y=t.barThickness;return{min:y||U4(i),pixels:l,start:o._startPixel,end:o._endPixel,stackCount:this._getStackCount(),scale:o,grouped:t.grouped,ratio:y?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:i,_stacked:o},options:{base:l,minBarLength:u}}=this,m=l||0,y=this.getParsed(t),C=y._custom,T=RE(C);let H,X,A=y[i.axis],z=0,V=o?this.applyStack(i,y,o):A;V!==A&&(z=V-A,V=A),T&&(A=C.barStart,V=C.barEnd-C.barStart,0!==A&&Uc(A)!==Uc(C.barEnd)&&(z=0),z+=A);const oe=oi(l)||T?z:l;let le=i.getPixelForValue(oe);if(H=this.chart.getDataVisibility(t)?i.getPixelForValue(z+V):le,X=H-le,Math.abs(X)<u){X=function W4(e,n,t){return 0!==e?Uc(e):(n.isHorizontal()?1:-1)*(n.min>=t?1:-1)}(X,i,m)*u,A===m&&(le-=X/2);const we=i.getPixelForDecimal(0),ve=i.getPixelForDecimal(1),Re=Math.min(we,ve),Fe=Math.max(we,ve);le=Math.max(Math.min(le,Fe),Re),H=le+X}if(le===i.getPixelForValue(m)){const we=Uc(X)*i.getLineWidthForValue(m)/2;le+=we,X-=we}return{size:X,base:le,head:H,center:H+X/2}}_calculateBarIndexPixels(t,i){const o=i.scale,l=this.options,u=l.skipNull,m=Dn(l.maxBarThickness,1/0);let y,C;if(i.grouped){const T=u?this._getStackCount(t):i.stackCount,A="flex"===l.barThickness?function H4(e,n,t,i){const o=n.pixels,l=o[e];let u=e>0?o[e-1]:null,m=e<o.length-1?o[e+1]:null;const y=t.categoryPercentage;null===u&&(u=l-(null===m?n.end-n.start:m-l)),null===m&&(m=l+l-u);const C=l-(l-Math.min(u,m))/2*y;return{chunk:Math.abs(m-u)/2*y/i,ratio:t.barPercentage,start:C}}(t,i,l,T):function $4(e,n,t,i){const o=t.barThickness;let l,u;return oi(o)?(l=n.min*t.categoryPercentage,u=t.barPercentage):(l=o*i,u=1),{chunk:l/i,ratio:u,start:n.pixels[e]-l/2}}(t,i,l,T),z=this._getStackIndex(this.index,this._cachedMeta.stack,u?t:void 0);y=A.start+A.chunk*z+A.chunk/2,C=Math.min(m,A.chunk*A.ratio)}else y=o.getPixelForValue(this.getParsed(t)[o.axis],t),C=Math.min(m,i.min*i.ratio);return{base:y-C/2,head:y+C/2,center:y,size:C}}draw(){const t=this._cachedMeta,i=t.vScale,o=t.data,l=o.length;let u=0;for(;u<l;++u)null!==this.getParsed(u)[i.axis]&&o[u].draw(this._ctx)}}return e.id="bar",e.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},e.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}},e})(),J4=(()=>{class e extends qu{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,i,o,l){const u=super.parsePrimitiveData(t,i,o,l);for(let m=0;m<u.length;m++)u[m]._custom=this.resolveDataElementOptions(m+o).radius;return u}parseArrayData(t,i,o,l){const u=super.parseArrayData(t,i,o,l);for(let m=0;m<u.length;m++)u[m]._custom=Dn(i[o+m][2],this.resolveDataElementOptions(m+o).radius);return u}parseObjectData(t,i,o,l){const u=super.parseObjectData(t,i,o,l);for(let m=0;m<u.length;m++){const y=i[o+m];u[m]._custom=Dn(y&&y.r&&+y.r,this.resolveDataElementOptions(m+o).radius)}return u}getMaxOverflow(){const t=this._cachedMeta.data;let i=0;for(let o=t.length-1;o>=0;--o)i=Math.max(i,t[o].size(this.resolveDataElementOptions(o))/2);return i>0&&i}getLabelAndValue(t){const i=this._cachedMeta,{xScale:o,yScale:l}=i,u=this.getParsed(t),m=o.getLabelForValue(u.x),y=l.getLabelForValue(u.y),C=u._custom;return{label:i.label,value:"("+m+", "+y+(C?", "+C:"")+")"}}update(t){const i=this._cachedMeta.data;this.updateElements(i,0,i.length,t)}updateElements(t,i,o,l){const u="reset"===l,{iScale:m,vScale:y}=this._cachedMeta,C=this.resolveDataElementOptions(i,l),T=this.getSharedOptions(C),A=this.includeOptions(l,T),z=m.axis,V=y.axis;for(let H=i;H<i+o;H++){const X=t[H],oe=!u&&this.getParsed(H),le={},we=le[z]=u?m.getPixelForDecimal(.5):m.getPixelForValue(oe[z]),ve=le[V]=u?y.getBasePixel():y.getPixelForValue(oe[V]);le.skip=isNaN(we)||isNaN(ve),A&&(le.options=this.resolveDataElementOptions(H,X.active?"active":l),u&&(le.options.radius=0)),this.updateElement(X,H,le,l)}this.updateSharedOptions(T,l,C)}resolveDataElementOptions(t,i){const o=this.getParsed(t);let l=super.resolveDataElementOptions(t,i);l.$shared&&(l=Object.assign({},l,{$shared:!1}));const u=l.radius;return"active"!==i&&(l.radius=0),l.radius+=Dn(o&&o._custom,u),l}}return e.id="bubble",e.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},e.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}},e})(),iP=(()=>{class e extends qu{constructor(t,i){super(t,i),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,i){const o=this.getDataset().data,l=this._cachedMeta;if(!1===this._parsing)l._parsed=o;else{let m,y,u=C=>+o[C];if($n(o[t])){const{key:C="value"}=this._parsing;u=T=>+Ed(o[T],C)}for(m=t,y=t+i;m<y;++m)l._parsed[m]=u(m)}}_getRotation(){return Yl(this.options.rotation-90)}_getCircumference(){return Yl(this.options.circumference)}_getRotationExtents(){let t=Ei,i=-Ei;for(let o=0;o<this.chart.data.datasets.length;++o)if(this.chart.isDatasetVisible(o)){const l=this.chart.getDatasetMeta(o).controller,u=l._getRotation(),m=l._getCircumference();t=Math.min(t,u),i=Math.max(i,u+m)}return{rotation:t,circumference:i-t}}update(t){const i=this.chart,{chartArea:o}=i,l=this._cachedMeta,u=l.data,m=this.getMaxBorderWidth()+this.getMaxOffset(u)+this.options.spacing,y=Math.max((Math.min(o.width,o.height)-m)/2,0),C=Math.min(((e,n)=>"string"==typeof e&&e.endsWith("%")?parseFloat(e)/100:e/n)(this.options.cutout,y),1),T=this._getRingWeight(this.index),{circumference:A,rotation:z}=this._getRotationExtents(),{ratioX:V,ratioY:H,offsetX:X,offsetY:oe}=function Q4(e,n,t){let i=1,o=1,l=0,u=0;if(n<Ei){const m=e,y=m+n,C=Math.cos(m),T=Math.sin(m),A=Math.cos(y),z=Math.sin(y),V=(ve,Re,Fe)=>Ty(ve,m,y,!0)?1:Math.max(Re,Re*t,Fe,Fe*t),H=(ve,Re,Fe)=>Ty(ve,m,y,!0)?-1:Math.min(Re,Re*t,Fe,Fe*t),X=V(0,C,A),oe=V(fr,T,z),le=H(qi,C,A),we=H(qi+fr,T,z);i=(X-le)/2,o=(oe-we)/2,l=-(X+le)/2,u=-(oe+we)/2}return{ratioX:i,ratioY:o,offsetX:l,offsetY:u}}(z,A,C),ve=Math.max(Math.min((o.width-m)/V,(o.height-m)/H)/2,0),Re=JA(this.options.radius,ve),lt=(Re-Math.max(Re*C,0))/this._getVisibleDatasetWeightTotal();this.offsetX=X*Re,this.offsetY=oe*Re,l.total=this.calculateTotal(),this.outerRadius=Re-lt*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-lt*T,0),this.updateElements(u,0,u.length,t)}_circumference(t,i){const o=this.options,l=this._cachedMeta,u=this._getCircumference();return i&&o.animation.animateRotate||!this.chart.getDataVisibility(t)||null===l._parsed[t]||l.data[t].hidden?0:this.calculateCircumference(l._parsed[t]*u/Ei)}updateElements(t,i,o,l){const u="reset"===l,m=this.chart,y=m.chartArea,A=(y.left+y.right)/2,z=(y.top+y.bottom)/2,V=u&&m.options.animation.animateScale,H=V?0:this.innerRadius,X=V?0:this.outerRadius,oe=this.resolveDataElementOptions(i,l),le=this.getSharedOptions(oe),we=this.includeOptions(l,le);let Re,ve=this._getRotation();for(Re=0;Re<i;++Re)ve+=this._circumference(Re,u);for(Re=i;Re<i+o;++Re){const Fe=this._circumference(Re,u),lt=t[Re],bt={x:A+this.offsetX,y:z+this.offsetY,startAngle:ve,endAngle:ve+Fe,circumference:Fe,outerRadius:X,innerRadius:H};we&&(bt.options=le||this.resolveDataElementOptions(Re,lt.active?"active":l)),ve+=Fe,this.updateElement(lt,Re,bt,l)}this.updateSharedOptions(le,l,oe)}calculateTotal(){const t=this._cachedMeta,i=t.data;let l,o=0;for(l=0;l<i.length;l++){const u=t._parsed[l];null!==u&&!isNaN(u)&&this.chart.getDataVisibility(l)&&!i[l].hidden&&(o+=Math.abs(u))}return o}calculateCircumference(t){const i=this._cachedMeta.total;return i>0&&!isNaN(t)?Ei*(Math.abs(t)/i):0}getLabelAndValue(t){const o=this.chart,l=o.data.labels||[],u=Oy(this._cachedMeta._parsed[t],o.options.locale);return{label:l[t]||"",value:u}}getMaxBorderWidth(t){let i=0;const o=this.chart;let l,u,m,y,C;if(!t)for(l=0,u=o.data.datasets.length;l<u;++l)if(o.isDatasetVisible(l)){m=o.getDatasetMeta(l),t=m.data,y=m.controller;break}if(!t)return 0;for(l=0,u=t.length;l<u;++l)C=y.resolveDataElementOptions(l),"inner"!==C.borderAlign&&(i=Math.max(i,C.borderWidth||0,C.hoverBorderWidth||0));return i}getMaxOffset(t){let i=0;for(let o=0,l=t.length;o<l;++o){const u=this.resolveDataElementOptions(o);i=Math.max(i,u.offset||0,u.hoverOffset||0)}return i}_getRingWeightOffset(t){let i=0;for(let o=0;o<t;++o)this.chart.isDatasetVisible(o)&&(i+=this._getRingWeight(o));return i}_getRingWeight(t){return Math.max(Dn(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return e.id="doughnut",e.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},e.descriptors={_scriptable:n=>"spacing"!==n,_indexable:n=>"spacing"!==n},e.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(n){const t=n.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:i}}=n.legend.options;return t.labels.map((o,l)=>{const m=n.getDatasetMeta(0).controller.getStyle(l);return{text:o,fillStyle:m.backgroundColor,strokeStyle:m.borderColor,lineWidth:m.borderWidth,pointStyle:i,hidden:!n.getDataVisibility(l),index:l}})}return[]}},onClick(n,t,i){i.chart.toggleDataVisibility(t.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label(n){let t=n.label;const i=": "+n.formattedValue;return Ai(t)?(t=t.slice(),t[0]+=i):t+=i,t}}}}},e})(),rP=(()=>{class e extends qu{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const i=this._cachedMeta,{dataset:o,data:l=[],_dataset:u}=i,m=this.chart._animationsDisabled;let{start:y,count:C}=function e$(e,n,t){const i=n.length;let o=0,l=i;if(e._sorted){const{iScale:u,_parsed:m}=e,y=u.axis,{min:C,max:T,minDefined:A,maxDefined:z}=u.getUserBounds();A&&(o=_o(Math.min(Gu(m,u.axis,C).lo,t?i:Gu(n,y,u.getPixelForValue(C)).lo),0,i-1)),l=z?_o(Math.max(Gu(m,u.axis,T).hi+1,t?0:Gu(n,y,u.getPixelForValue(T)).hi+1),o,i)-o:i-o}return{start:o,count:l}}(i,l,m);this._drawStart=y,this._drawCount=C,function t$(e){const{xScale:n,yScale:t,_scaleRanges:i}=e,o={xmin:n.min,xmax:n.max,ymin:t.min,ymax:t.max};if(!i)return e._scaleRanges=o,!0;const l=i.xmin!==n.min||i.xmax!==n.max||i.ymin!==t.min||i.ymax!==t.max;return Object.assign(i,o),l}(i)&&(y=0,C=l.length),o._chart=this.chart,o._datasetIndex=this.index,o._decimated=!!u._decimated,o.points=l;const T=this.resolveDatasetElementOptions(t);this.options.showLine||(T.borderWidth=0),T.segment=this.options.segment,this.updateElement(o,void 0,{animated:!m,options:T},t),this.updateElements(l,y,C,t)}updateElements(t,i,o,l){const u="reset"===l,{iScale:m,vScale:y,_stacked:C,_dataset:T}=this._cachedMeta,A=this.resolveDataElementOptions(i,l),z=this.getSharedOptions(A),V=this.includeOptions(l,z),H=m.axis,X=y.axis,{spanGaps:oe,segment:le}=this.options,we=Ey(oe)?oe:Number.POSITIVE_INFINITY,ve=this.chart._animationsDisabled||u||"none"===l;let Re=i>0&&this.getParsed(i-1);for(let Fe=i;Fe<i+o;++Fe){const lt=t[Fe],bt=this.getParsed(Fe),kt=ve?lt:{},Ot=oi(bt[X]),mi=kt[H]=m.getPixelForValue(bt[H],Fe),Zn=kt[X]=u||Ot?y.getBasePixel():y.getPixelForValue(C?this.applyStack(y,bt,C):bt[X],Fe);kt.skip=isNaN(mi)||isNaN(Zn)||Ot,kt.stop=Fe>0&&Math.abs(bt[H]-Re[H])>we,le&&(kt.parsed=bt,kt.raw=T.data[Fe]),V&&(kt.options=z||this.resolveDataElementOptions(Fe,lt.active?"active":l)),ve||this.updateElement(lt,Fe,kt,l),Re=bt}this.updateSharedOptions(z,l,A)}getMaxOverflow(){const t=this._cachedMeta,i=t.dataset,o=i.options&&i.options.borderWidth||0,l=t.data||[];if(!l.length)return o;const u=l[0].size(this.resolveDataElementOptions(0)),m=l[l.length-1].size(this.resolveDataElementOptions(l.length-1));return Math.max(o,u,m)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}return e.id="line",e.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},e.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}},e})();var n$=Object.freeze({__proto__:null,BarController:K4,BubbleController:J4,DoughnutController:iP,LineController:rP,PolarAreaController:(()=>{class e extends qu{constructor(t,i){super(t,i),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const o=this.chart,l=o.data.labels||[],u=Oy(this._cachedMeta._parsed[t].r,o.options.locale);return{label:l[t]||"",value:u}}parseObjectData(t,i,o,l){return A2.bind(this)(t,i,o,l)}update(t){const i=this._cachedMeta.data;this._updateRadius(),this.updateElements(i,0,i.length,t)}getMinMax(){const i={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return this._cachedMeta.data.forEach((o,l)=>{const u=this.getParsed(l).r;!isNaN(u)&&this.chart.getDataVisibility(l)&&(u<i.min&&(i.min=u),u>i.max&&(i.max=u))}),i}_updateRadius(){const t=this.chart,i=t.chartArea,o=t.options,l=Math.min(i.right-i.left,i.bottom-i.top),u=Math.max(l/2,0),y=(u-Math.max(o.cutoutPercentage?u/100*o.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=u-y*this.index,this.innerRadius=this.outerRadius-y}updateElements(t,i,o,l){const u="reset"===l,m=this.chart,C=m.options.animation,T=this._cachedMeta.rScale,A=T.xCenter,z=T.yCenter,V=T.getIndexAngle(0)-.5*qi;let X,H=V;const oe=360/this.countVisibleElements();for(X=0;X<i;++X)H+=this._computeAngle(X,l,oe);for(X=i;X<i+o;X++){const le=t[X];let we=H,ve=H+this._computeAngle(X,l,oe),Re=m.getDataVisibility(X)?T.getDistanceFromCenterForValue(this.getParsed(X).r):0;H=ve,u&&(C.animateScale&&(Re=0),C.animateRotate&&(we=ve=V));const Fe={x:A,y:z,innerRadius:0,outerRadius:Re,startAngle:we,endAngle:ve,options:this.resolveDataElementOptions(X,le.active?"active":l)};this.updateElement(le,X,Fe,l)}}countVisibleElements(){let i=0;return this._cachedMeta.data.forEach((o,l)=>{!isNaN(this.getParsed(l).r)&&this.chart.getDataVisibility(l)&&i++}),i}_computeAngle(t,i,o){return this.chart.getDataVisibility(t)?Yl(this.resolveDataElementOptions(t,i).angle||o):0}}return e.id="polarArea",e.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},e.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(n){const t=n.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:i}}=n.legend.options;return t.labels.map((o,l)=>{const m=n.getDatasetMeta(0).controller.getStyle(l);return{text:o,fillStyle:m.backgroundColor,strokeStyle:m.borderColor,lineWidth:m.borderWidth,pointStyle:i,hidden:!n.getDataVisibility(l),index:l}})}return[]}},onClick(n,t,i){i.chart.toggleDataVisibility(t.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label:n=>n.chart.data.labels[n.dataIndex]+": "+n.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}},e})(),PieController:(()=>{class e extends iP{}return e.id="pie",e.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"},e})(),RadarController:(()=>{class e extends qu{getLabelAndValue(t){const i=this._cachedMeta.vScale,o=this.getParsed(t);return{label:i.getLabels()[t],value:""+i.getLabelForValue(o[i.axis])}}parseObjectData(t,i,o,l){return A2.bind(this)(t,i,o,l)}update(t){const i=this._cachedMeta,o=i.dataset,l=i.data||[],u=i.iScale.getLabels();if(o.points=l,"resize"!==t){const m=this.resolveDatasetElementOptions(t);this.options.showLine||(m.borderWidth=0),this.updateElement(o,void 0,{_loop:!0,_fullLoop:u.length===l.length,options:m},t)}this.updateElements(l,0,l.length,t)}updateElements(t,i,o,l){const u=this._cachedMeta.rScale,m="reset"===l;for(let y=i;y<i+o;y++){const C=t[y],T=this.resolveDataElementOptions(y,C.active?"active":l),A=u.getPointPositionForValue(y,this.getParsed(y).r),z=m?u.xCenter:A.x,V=m?u.yCenter:A.y,H={x:z,y:V,angle:A.angle,skip:isNaN(z)||isNaN(V),options:T};this.updateElement(C,y,H,l)}}}return e.id="radar",e.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},e.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}},e})(),ScatterController:(()=>{class e extends rP{}return e.id="scatter",e.defaults={showLine:!1,fill:!1},e.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:n=>"("+n.label+", "+n.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}},e})()});function mp(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var i$={_date:(()=>{class e{constructor(t){this.options=t||{}}formats(){return mp()}parse(t,i){return mp()}format(t,i){return mp()}add(t,i,o){return mp()}diff(t,i,o){return mp()}startOf(t,i,o){return mp()}endOf(t,i){return mp()}}return e.override=function(n){Object.assign(e.prototype,n)},e})()};function r$(e,n,t,i){const{controller:o,data:l,_sorted:u}=e,m=o._cachedMeta.iScale;if(m&&n===m.axis&&"r"!==n&&u&&l.length){const y=m._reversePixels?j5:Gu;if(!i)return y(l,n,t);if(o._sharedOptions){const C=l[0],T="function"==typeof C.getRange&&C.getRange(n);if(T){const A=y(l,n,t-T),z=y(l,n,t+T);return{lo:A.lo,hi:z.hi}}}}return{lo:0,hi:l.length-1}}function Fy(e,n,t,i,o){const l=e.getSortedVisibleDatasetMetas(),u=t[n];for(let m=0,y=l.length;m<y;++m){const{index:C,data:T}=l[m],{lo:A,hi:z}=r$(l[m],n,u,o);for(let V=A;V<=z;++V){const H=T[V];H.skip||i(H,C,V)}}}function OE(e,n,t,i,o){const l=[];return!o&&!e.isPointInArea(n)||Fy(e,t,n,function(m,y,C){!o&&!Py(m,e.chartArea,0)||m.inRange(n.x,n.y,i)&&l.push({element:m,datasetIndex:y,index:C})},!0),l}function LE(e,n,t,i,o,l){return l||e.isPointInArea(n)?"r"!==t||i?function a$(e,n,t,i,o,l){let u=[];const m=function o$(e){const n=-1!==e.indexOf("x"),t=-1!==e.indexOf("y");return function(i,o){const l=n?Math.abs(i.x-o.x):0,u=t?Math.abs(i.y-o.y):0;return Math.sqrt(Math.pow(l,2)+Math.pow(u,2))}}(t);let y=Number.POSITIVE_INFINITY;return Fy(e,t,n,function C(T,A,z){const V=T.inRange(n.x,n.y,o);if(i&&!V)return;const H=T.getCenterPoint(o);if(!l&&!e.isPointInArea(H)&&!V)return;const oe=m(n,H);oe<y?(u=[{element:T,datasetIndex:A,index:z}],y=oe):oe===y&&u.push({element:T,datasetIndex:A,index:z})}),u}(e,n,t,i,o,l):function s$(e,n,t,i){let o=[];return Fy(e,t,n,function l(u,m,y){const{startAngle:C,endAngle:T}=u.getProps(["startAngle","endAngle"],i),{angle:A}=s2(u,{x:n.x,y:n.y});Ty(A,C,T)&&o.push({element:u,datasetIndex:m,index:y})}),o}(e,n,t,o):[]}function oP(e,n,t,i,o){const l=[],u="x"===t?"inXRange":"inYRange";let m=!1;return Fy(e,t,n,(y,C,T)=>{y[u](n[t],o)&&(l.push({element:y,datasetIndex:C,index:T}),m=m||y.inRange(n.x,n.y,o))}),i&&!m?[]:l}var l$={evaluateInteractionItems:Fy,modes:{index(e,n,t,i){const o=fp(n,e),l=t.axis||"x",u=t.includeInvisible||!1,m=t.intersect?OE(e,o,l,i,u):LE(e,o,l,!1,i,u),y=[];return m.length?(e.getSortedVisibleDatasetMetas().forEach(C=>{const T=m[0].index,A=C.data[T];A&&!A.skip&&y.push({element:A,datasetIndex:C.index,index:T})}),y):[]},dataset(e,n,t,i){const o=fp(n,e),l=t.axis||"xy",u=t.includeInvisible||!1;let m=t.intersect?OE(e,o,l,i,u):LE(e,o,l,!1,i,u);if(m.length>0){const y=m[0].datasetIndex,C=e.getDatasetMeta(y).data;m=[];for(let T=0;T<C.length;++T)m.push({element:C[T],datasetIndex:y,index:T})}return m},point:(e,n,t,i)=>OE(e,fp(n,e),t.axis||"xy",i,t.includeInvisible||!1),nearest:(e,n,t,i)=>LE(e,fp(n,e),t.axis||"xy",t.intersect,i,t.includeInvisible||!1),x:(e,n,t,i)=>oP(e,fp(n,e),"x",t.intersect,i),y:(e,n,t,i)=>oP(e,fp(n,e),"y",t.intersect,i)}};const sP=["left","top","right","bottom"];function zy(e,n){return e.filter(t=>t.pos===n)}function aP(e,n){return e.filter(t=>-1===sP.indexOf(t.pos)&&t.box.axis===n)}function Ny(e,n){return e.sort((t,i)=>{const o=n?i:t,l=n?t:i;return o.weight===l.weight?o.index-l.index:o.weight-l.weight})}function lP(e,n,t,i){return Math.max(e[t],n[t])+Math.max(e[i],n[i])}function cP(e,n){e.top=Math.max(e.top,n.top),e.left=Math.max(e.left,n.left),e.bottom=Math.max(e.bottom,n.bottom),e.right=Math.max(e.right,n.right)}function f$(e,n,t,i){const{pos:o,box:l}=t,u=e.maxPadding;if(!$n(o)){t.size&&(e[o]-=t.size);const A=i[t.stack]||{size:0,count:1};A.size=Math.max(A.size,t.horizontal?l.height:l.width),t.size=A.size/A.count,e[o]+=t.size}l.getPadding&&cP(u,l.getPadding());const m=Math.max(0,n.outerWidth-lP(u,e,"left","right")),y=Math.max(0,n.outerHeight-lP(u,e,"top","bottom")),C=m!==e.w,T=y!==e.h;return e.w=m,e.h=y,t.horizontal?{same:C,other:T}:{same:T,other:C}}function m$(e,n){const t=n.maxPadding;return function i(o){const l={left:0,top:0,right:0,bottom:0};return o.forEach(u=>{l[u]=Math.max(n[u],t[u])}),l}(e?["left","right"]:["top","bottom"])}function By(e,n,t,i){const o=[];let l,u,m,y,C,T;for(l=0,u=e.length,C=0;l<u;++l){m=e[l],y=m.box,y.update(m.width||n.w,m.height||n.h,m$(m.horizontal,n));const{same:A,other:z}=f$(n,t,m,i);C|=A&&o.length,T=T||z,y.fullSize||o.push(m)}return C&&By(o,n,t,i)||T}function Eb(e,n,t,i,o){e.top=t,e.left=n,e.right=n+i,e.bottom=t+o,e.width=i,e.height=o}function uP(e,n,t,i){const o=t.padding;let{x:l,y:u}=n;for(const m of e){const y=m.box,C=i[m.stack]||{count:1,placed:0,weight:1},T=m.stackWeight/C.weight||1;if(m.horizontal){const A=n.w*T,z=C.size||y.height;il(C.start)&&(u=C.start),y.fullSize?Eb(y,o.left,u,t.outerWidth-o.right-o.left,z):Eb(y,n.left+C.placed,u,A,z),C.start=u,C.placed+=A,u=y.bottom}else{const A=n.h*T,z=C.size||y.width;il(C.start)&&(l=C.start),y.fullSize?Eb(y,l,o.top,z,t.outerHeight-o.bottom-o.top):Eb(y,l,n.top+C.placed,z,A),C.start=l,C.placed+=A,l=y.right}}n.x=l,n.y=u}zn.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var es={addBox(e,n){e.boxes||(e.boxes=[]),n.fullSize=n.fullSize||!1,n.position=n.position||"top",n.weight=n.weight||0,n._layers=n._layers||function(){return[{z:0,draw(t){n.draw(t)}}]},e.boxes.push(n)},removeBox(e,n){const t=e.boxes?e.boxes.indexOf(n):-1;-1!==t&&e.boxes.splice(t,1)},configure(e,n,t){n.fullSize=t.fullSize,n.position=t.position,n.weight=t.weight},update(e,n,t,i){if(!e)return;const o=Qo(e.options.layout.padding),l=Math.max(n-o.width,0),u=Math.max(t-o.height,0),m=function d$(e){const n=function c$(e){const n=[];let t,i,o,l,u,m;for(t=0,i=(e||[]).length;t<i;++t)o=e[t],({position:l,options:{stack:u,stackWeight:m=1}}=o),n.push({index:t,box:o,pos:l,horizontal:o.isHorizontal(),weight:o.weight,stack:u&&l+u,stackWeight:m});return n}(e),t=Ny(n.filter(C=>C.box.fullSize),!0),i=Ny(zy(n,"left"),!0),o=Ny(zy(n,"right")),l=Ny(zy(n,"top"),!0),u=Ny(zy(n,"bottom")),m=aP(n,"x"),y=aP(n,"y");return{fullSize:t,leftAndTop:i.concat(l),rightAndBottom:o.concat(y).concat(u).concat(m),chartArea:zy(n,"chartArea"),vertical:i.concat(o).concat(y),horizontal:l.concat(u).concat(m)}}(e.boxes),y=m.vertical,C=m.horizontal;pi(e.boxes,X=>{"function"==typeof X.beforeLayout&&X.beforeLayout()});const T=y.reduce((X,oe)=>oe.box.options&&!1===oe.box.options.display?X:X+1,0)||1,A=Object.freeze({outerWidth:n,outerHeight:t,padding:o,availableWidth:l,availableHeight:u,vBoxMaxWidth:l/2/T,hBoxMaxHeight:u/2}),z=Object.assign({},o);cP(z,Qo(i));const V=Object.assign({maxPadding:z,w:l,h:u,x:o.left,y:o.top},o),H=function h$(e,n){const t=function u$(e){const n={};for(const t of e){const{stack:i,pos:o,stackWeight:l}=t;if(!i||!sP.includes(o))continue;const u=n[i]||(n[i]={count:0,placed:0,weight:0,size:0});u.count++,u.weight+=l}return n}(e),{vBoxMaxWidth:i,hBoxMaxHeight:o}=n;let l,u,m;for(l=0,u=e.length;l<u;++l){m=e[l];const{fullSize:y}=m.box,C=t[m.stack],T=C&&m.stackWeight/C.weight;m.horizontal?(m.width=T?T*i:y&&n.availableWidth,m.height=o):(m.width=i,m.height=T?T*o:y&&n.availableHeight)}return t}(y.concat(C),A);By(m.fullSize,V,A,H),By(y,V,A,H),By(C,V,A,H)&&By(y,V,A,H),function p$(e){const n=e.maxPadding;function t(i){const o=Math.max(n[i]-e[i],0);return e[i]+=o,o}e.y+=t("top"),e.x+=t("left"),t("right"),t("bottom")}(V),uP(m.leftAndTop,V,A,H),V.x+=V.w,V.y+=V.h,uP(m.rightAndBottom,V,A,H),e.chartArea={left:V.left,top:V.top,right:V.left+V.w,bottom:V.top+V.h,height:V.h,width:V.w},pi(m.chartArea,X=>{const oe=X.box;Object.assign(oe,e.chartArea),oe.update(V.w,V.h,{left:0,top:0,right:0,bottom:0})})}};class hP{acquireContext(n,t){}releaseContext(n){return!1}addEventListener(n,t,i){}removeEventListener(n,t,i){}getDevicePixelRatio(){return 1}getMaximumSize(n,t,i,o){return t=Math.max(0,t||n.width),i=i||n.height,{width:t,height:Math.max(0,o?Math.floor(t/o):i)}}isAttached(n){return!0}updateConfig(n){}}class g$ extends hP{acquireContext(n){return n&&n.getContext&&n.getContext("2d")||null}updateConfig(n){n.options.animation=!1}}const Db="$chartjs",_$={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},dP=e=>null===e||""===e,fP=!!d4&&{passive:!0};function x$(e,n,t){e.canvas.removeEventListener(n,t,fP)}function Tb(e,n){for(const t of e)if(t===n||t.contains(n))return!0}function w$(e,n,t){const i=e.canvas,o=new MutationObserver(l=>{let u=!1;for(const m of l)u=u||Tb(m.addedNodes,i),u=u&&!Tb(m.removedNodes,i);u&&t()});return o.observe(document,{childList:!0,subtree:!0}),o}function C$(e,n,t){const i=e.canvas,o=new MutationObserver(l=>{let u=!1;for(const m of l)u=u||Tb(m.removedNodes,i),u=u&&!Tb(m.addedNodes,i);u&&t()});return o.observe(document,{childList:!0,subtree:!0}),o}const Vy=new Map;let pP=0;function mP(){const e=window.devicePixelRatio;e!==pP&&(pP=e,Vy.forEach((n,t)=>{t.currentDevicePixelRatio!==e&&n()}))}function T$(e,n,t){const i=e.canvas,o=i&&IE(i);if(!o)return;const l=KA((m,y)=>{const C=o.clientWidth;t(m,y),C<o.clientWidth&&t()},window),u=new ResizeObserver(m=>{const y=m[0],C=y.contentRect.width,T=y.contentRect.height;0===C&&0===T||l(C,T)});return u.observe(o),function E$(e,n){Vy.size||window.addEventListener("resize",mP),Vy.set(e,n)}(e,l),u}function FE(e,n,t){t&&t.disconnect(),"resize"===n&&function D$(e){Vy.delete(e),Vy.size||window.removeEventListener("resize",mP)}(e)}function S$(e,n,t){const i=e.canvas,o=KA(l=>{null!==e.ctx&&t(function b$(e,n){const t=_$[e.type]||e.type,{x:i,y:o}=fp(e,n);return{type:t,chart:n,native:e,x:void 0!==i?i:null,y:void 0!==o?o:null}}(l,e))},e,l=>{const u=l[0];return[u,u.offsetX,u.offsetY]});return function v$(e,n,t){e.addEventListener(n,t,fP)}(i,n,o),o}class M$ extends hP{acquireContext(n,t){const i=n&&n.getContext&&n.getContext("2d");return i&&i.canvas===n?(function y$(e,n){const t=e.style,i=e.getAttribute("height"),o=e.getAttribute("width");if(e[Db]={initial:{height:i,width:o,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",dP(o)){const l=O2(e,"width");void 0!==l&&(e.width=l)}if(dP(i))if(""===e.style.height)e.height=e.width/(n||2);else{const l=O2(e,"height");void 0!==l&&(e.height=l)}}(n,t),i):null}releaseContext(n){const t=n.canvas;if(!t[Db])return!1;const i=t[Db].initial;["height","width"].forEach(l=>{const u=i[l];oi(u)?t.removeAttribute(l):t.setAttribute(l,u)});const o=i.style||{};return Object.keys(o).forEach(l=>{t.style[l]=o[l]}),t.width=t.width,delete t[Db],!0}addEventListener(n,t,i){this.removeEventListener(n,t),(n.$proxies||(n.$proxies={}))[t]=({attach:w$,detach:C$,resize:T$}[t]||S$)(n,t,i)}removeEventListener(n,t){const i=n.$proxies||(n.$proxies={}),o=i[t];o&&(({attach:FE,detach:FE,resize:FE}[t]||x$)(n,t,o),i[t]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(n,t,i,o){return function h4(e,n,t,i){const o=Cb(e),l=dp(o,"margin"),u=wb(o.maxWidth,e,"clientWidth")||hb,m=wb(o.maxHeight,e,"clientHeight")||hb,y=function u4(e,n,t){let i,o;if(void 0===n||void 0===t){const l=IE(e);if(l){const u=l.getBoundingClientRect(),m=Cb(l),y=dp(m,"border","width"),C=dp(m,"padding");n=u.width-C.width-y.width,t=u.height-C.height-y.height,i=wb(m.maxWidth,l,"clientWidth"),o=wb(m.maxHeight,l,"clientHeight")}else n=e.clientWidth,t=e.clientHeight}return{width:n,height:t,maxWidth:i||hb,maxHeight:o||hb}}(e,n,t);let{width:C,height:T}=y;if("content-box"===o.boxSizing){const A=dp(o,"border","width"),z=dp(o,"padding");C-=z.width+A.width,T-=z.height+A.height}return C=Math.max(0,C-l.width),T=Math.max(0,i?Math.floor(C/i):T-l.height),C=AE(Math.min(C,u,y.maxWidth)),T=AE(Math.min(T,m,y.maxHeight)),C&&!T&&(T=AE(C/2)),{width:C,height:T}}(n,t,i,o)}isAttached(n){const t=IE(n);return!(!t||!t.isConnected)}}class Kl{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(n){const{x:t,y:i}=this.getProps(["x","y"],n);return{x:t,y:i}}hasValue(){return Ey(this.x)&&Ey(this.y)}getProps(n,t){const i=this.$animations;if(!t||!i)return this;const o={};return n.forEach(l=>{o[l]=i[l]&&i[l].active()?i[l]._to:this[l]}),o}}Kl.defaults={},Kl.defaultRoutes=void 0;const gP={values:e=>Ai(e)?e:""+e,numeric(e,n,t){if(0===e)return"0";const i=this.chart.options.locale;let o,l=e;if(t.length>1){const C=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(C<1e-4||C>1e15)&&(o="scientific"),l=function A$(e,n){let t=n.length>3?n[2].value-n[1].value:n[1].value-n[0].value;return Math.abs(t)>=1&&e!==Math.floor(e)&&(t=e-Math.floor(e)),t}(e,t)}const u=rl(Math.abs(l)),m=Math.max(Math.min(-1*Math.floor(u),20),0),y={notation:o,minimumFractionDigits:m,maximumFractionDigits:m};return Object.assign(y,this.options.ticks.format),Oy(e,i,y)},logarithmic(e,n,t){if(0===e)return"0";const i=e/Math.pow(10,Math.floor(rl(e)));return 1===i||2===i||5===i?gP.numeric.call(this,e,n,t):""}};var Sb={formatters:gP};function Mb(e,n,t,i,o){const l=Dn(i,0),u=Math.min(Dn(o,e.length),e.length);let y,C,T,m=0;for(t=Math.ceil(t),o&&(y=o-i,t=y/Math.floor(y/t)),T=l;T<0;)m++,T=Math.round(l+m*t);for(C=Math.max(l,0);C<u;C++)C===T&&(n.push(e[C]),m++,T=Math.round(l+m*t))}zn.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,n)=>n.lineWidth,tickColor:(e,n)=>n.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Sb.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),zn.route("scale.ticks","color","","color"),zn.route("scale.grid","color","","borderColor"),zn.route("scale.grid","borderColor","","borderColor"),zn.route("scale.title","color","","color"),zn.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&"callback"!==e&&"parser"!==e,_indexable:e=>"borderDash"!==e&&"tickBorderDash"!==e}),zn.describe("scales",{_fallback:"scale"}),zn.describe("scale.ticks",{_scriptable:e=>"backdropPadding"!==e&&"callback"!==e,_indexable:e=>"backdropPadding"!==e});const z$=e=>"left"===e?"right":"right"===e?"left":e,_P=(e,n,t)=>"top"===n||"left"===n?e[n]+t:e[n]-t;function yP(e,n){const t=[],i=e.length/n,o=e.length;let l=0;for(;l<o;l+=i)t.push(e[Math.floor(l)]);return t}function N$(e,n,t){const i=e.ticks.length,o=Math.min(n,i-1),l=e._startPixel,u=e._endPixel,m=1e-6;let C,y=e.getPixelForTick(o);if(!(t&&(C=1===i?Math.max(y-l,u-y):0===n?(e.getPixelForTick(1)-y)/2:(y-e.getPixelForTick(o-1))/2,y+=o<n?C:-C,y<l-m||y>u+m)))return y}function jy(e){return e.drawTicks?e.tickLength:0}function vP(e,n){if(!e.display)return 0;const t=no(e.font,n),i=Qo(e.padding);return(Ai(e.text)?e.text.length:1)*t.lineHeight+i.height}function U$(e,n,t){let i=dE(e);return(t&&"right"!==n||!t&&"right"===n)&&(i=z$(i)),i}class gp extends Kl{constructor(n){super(),this.id=n.id,this.type=n.type,this.options=void 0,this.ctx=n.ctx,this.chart=n.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(n){this.options=n.setContext(this.getContext()),this.axis=n.axis,this._userMin=this.parse(n.min),this._userMax=this.parse(n.max),this._suggestedMin=this.parse(n.suggestedMin),this._suggestedMax=this.parse(n.suggestedMax)}parse(n,t){return n}getUserBounds(){let{_userMin:n,_userMax:t,_suggestedMin:i,_suggestedMax:o}=this;return n=nl(n,Number.POSITIVE_INFINITY),t=nl(t,Number.NEGATIVE_INFINITY),i=nl(i,Number.POSITIVE_INFINITY),o=nl(o,Number.NEGATIVE_INFINITY),{min:nl(n,i),max:nl(t,o),minDefined:Er(n),maxDefined:Er(t)}}getMinMax(n){let u,{min:t,max:i,minDefined:o,maxDefined:l}=this.getUserBounds();if(o&&l)return{min:t,max:i};const m=this.getMatchingVisibleMetas();for(let y=0,C=m.length;y<C;++y)u=m[y].controller.getMinMax(this,n),o||(t=Math.min(t,u.min)),l||(i=Math.max(i,u.max));return t=l&&t>i?i:t,i=o&&t>i?t:i,{min:nl(t,nl(i,t)),max:nl(i,nl(t,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const n=this.chart.data;return this.options.labels||(this.isHorizontal()?n.xLabels:n.yLabels)||n.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Pi(this.options.beforeUpdate,[this])}update(n,t,i){const{beginAtZero:o,grace:l,ticks:u}=this.options,m=u.sampleSize;this.beforeUpdate(),this.maxWidth=n,this.maxHeight=t,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function V5(e,n,t){const{min:i,max:o}=e,l=JA(n,(o-i)/2),u=(m,y)=>t&&0===m?0:m+y;return{min:u(i,-Math.abs(l)),max:u(o,l)}}(this,l,o),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const y=m<this.ticks.length;this._convertTicksToLabels(y?yP(this.ticks,m):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),u.display&&(u.autoSkip||"auto"===u.source)&&(this.ticks=function P$(e,n){const t=e.options.ticks,i=t.maxTicksLimit||function k$(e){const n=e.options.offset,t=e._tickSize();return Math.floor(Math.min(e._length/t+(n?0:1),e._maxLength/t))}(e),o=t.major.enabled?function O$(e){const n=[];let t,i;for(t=0,i=e.length;t<i;t++)e[t].major&&n.push(t);return n}(n):[],l=o.length,u=o[0],m=o[l-1],y=[];if(l>i)return function L$(e,n,t,i){let u,o=0,l=t[0];for(i=Math.ceil(i),u=0;u<e.length;u++)u===l&&(n.push(e[u]),o++,l=t[o*i])}(n,y,o,l/i),y;const C=function R$(e,n,t){const i=function F$(e){const n=e.length;let t,i;if(n<2)return!1;for(i=e[0],t=1;t<n;++t)if(e[t]-e[t-1]!==i)return!1;return i}(e),o=n.length/t;if(!i)return Math.max(o,1);const l=function i5(e){const n=[],t=Math.sqrt(e);let i;for(i=1;i<t;i++)e%i==0&&(n.push(i),n.push(e/i));return t===(0|t)&&n.push(t),n.sort((o,l)=>o-l).pop(),n}(i);for(let u=0,m=l.length-1;u<m;u++){const y=l[u];if(y>o)return y}return Math.max(o,1)}(o,n,i);if(l>0){let T,A;const z=l>1?Math.round((m-u)/(l-1)):null;for(Mb(n,y,C,oi(z)?0:u-z,u),T=0,A=l-1;T<A;T++)Mb(n,y,C,o[T],o[T+1]);return Mb(n,y,C,m,oi(z)?n.length:m+z),y}return Mb(n,y,C),y}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),y&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,i,n=this.options.reverse;this.isHorizontal()?(t=this.left,i=this.right):(t=this.top,i=this.bottom,n=!n),this._startPixel=t,this._endPixel=i,this._reversePixels=n,this._length=i-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Pi(this.options.afterUpdate,[this])}beforeSetDimensions(){Pi(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Pi(this.options.afterSetDimensions,[this])}_callHooks(n){this.chart.notifyPlugins(n,this.getContext()),Pi(this.options[n],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Pi(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(n){const t=this.options.ticks;let i,o,l;for(i=0,o=n.length;i<o;i++)l=n[i],l.label=Pi(t.callback,[l.value,i,n],this)}afterTickToLabelConversion(){Pi(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Pi(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const n=this.options,t=n.ticks,i=this.ticks.length,o=t.minRotation||0,l=t.maxRotation;let m,y,C,u=o;if(!this._isVisible()||!t.display||o>=l||i<=1||!this.isHorizontal())return void(this.labelRotation=o);const T=this._getLabelSizes(),A=T.widest.width,z=T.highest.height,V=_o(this.chart.width-A,0,this.maxWidth);m=n.offset?this.maxWidth/i:V/(i-1),A+6>m&&(m=V/(i-(n.offset?.5:1)),y=this.maxHeight-jy(n.grid)-t.padding-vP(n.title,this.chart.options.font),C=Math.sqrt(A*A+z*z),u=pE(Math.min(Math.asin(_o((T.highest.height+6)/m,-1,1)),Math.asin(_o(y/C,-1,1))-Math.asin(_o(z/C,-1,1)))),u=Math.max(o,Math.min(l,u))),this.labelRotation=u}afterCalculateLabelRotation(){Pi(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Pi(this.options.beforeFit,[this])}fit(){const n={width:0,height:0},{chart:t,options:{ticks:i,title:o,grid:l}}=this,u=this._isVisible(),m=this.isHorizontal();if(u){const y=vP(o,t.options.font);if(m?(n.width=this.maxWidth,n.height=jy(l)+y):(n.height=this.maxHeight,n.width=jy(l)+y),i.display&&this.ticks.length){const{first:C,last:T,widest:A,highest:z}=this._getLabelSizes(),V=2*i.padding,H=Yl(this.labelRotation),X=Math.cos(H),oe=Math.sin(H);m?n.height=Math.min(this.maxHeight,n.height+(i.mirror?0:oe*A.width+X*z.height)+V):n.width=Math.min(this.maxWidth,n.width+(i.mirror?0:X*A.width+oe*z.height)+V),this._calculatePadding(C,T,oe,X)}}this._handleMargins(),m?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=n.height):(this.width=n.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(n,t,i,o){const{ticks:{align:l,padding:u},position:m}=this.options,y=0!==this.labelRotation,C="top"!==m&&"x"===this.axis;if(this.isHorizontal()){const T=this.getPixelForTick(0)-this.left,A=this.right-this.getPixelForTick(this.ticks.length-1);let z=0,V=0;y?C?(z=o*n.width,V=i*t.height):(z=i*n.height,V=o*t.width):"start"===l?V=t.width:"end"===l?z=n.width:"inner"!==l&&(z=n.width/2,V=t.width/2),this.paddingLeft=Math.max((z-T+u)*this.width/(this.width-T),0),this.paddingRight=Math.max((V-A+u)*this.width/(this.width-A),0)}else{let T=t.height/2,A=n.height/2;"start"===l?(T=0,A=n.height):"end"===l&&(T=t.height,A=0),this.paddingTop=T+u,this.paddingBottom=A+u}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Pi(this.options.afterFit,[this])}isHorizontal(){const{axis:n,position:t}=this.options;return"top"===t||"bottom"===t||"x"===n}isFullSize(){return this.options.fullSize}_convertTicksToLabels(n){let t,i;for(this.beforeTickToLabelConversion(),this.generateTickLabels(n),t=0,i=n.length;t<i;t++)oi(n[t].label)&&(n.splice(t,1),i--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let n=this._labelSizes;if(!n){const t=this.options.ticks.sampleSize;let i=this.ticks;t<i.length&&(i=yP(i,t)),this._labelSizes=n=this._computeLabelSizes(i,i.length)}return n}_computeLabelSizes(n,t){const{ctx:i,_longestTextCache:o}=this,l=[],u=[];let C,T,A,z,V,H,X,oe,le,we,ve,m=0,y=0;for(C=0;C<t;++C){if(z=n[C].label,V=this._resolveTickFontOptions(C),i.font=H=V.string,X=o[H]=o[H]||{data:{},gc:[]},oe=V.lineHeight,le=we=0,oi(z)||Ai(z)){if(Ai(z))for(T=0,A=z.length;T<A;++T)ve=z[T],!oi(ve)&&!Ai(ve)&&(le=_b(i,X.data,X.gc,le,ve),we+=oe)}else le=_b(i,X.data,X.gc,le,z),we=oe;l.push(le),u.push(we),m=Math.max(le,m),y=Math.max(we,y)}!function B$(e,n){pi(e,t=>{const i=t.gc,o=i.length/2;let l;if(o>n){for(l=0;l<o;++l)delete t.data[i[l]];i.splice(0,o)}})}(o,t);const Re=l.indexOf(m),Fe=u.indexOf(y),lt=bt=>({width:l[bt]||0,height:u[bt]||0});return{first:lt(0),last:lt(t-1),widest:lt(Re),highest:lt(Fe),widths:l,heights:u}}getLabelForValue(n){return n}getPixelForValue(n,t){return NaN}getValueForPixel(n){}getPixelForTick(n){const t=this.ticks;return n<0||n>t.length-1?null:this.getPixelForValue(t[n].value)}getPixelForDecimal(n){this._reversePixels&&(n=1-n);const t=this._startPixel+n*this._length;return function s5(e){return _o(e,-32768,32767)}(this._alignToPixels?cp(this.chart,t,0):t)}getDecimalForPixel(n){const t=(n-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:n,max:t}=this;return n<0&&t<0?t:n>0&&t>0?n:0}getContext(n){const t=this.ticks||[];if(n>=0&&n<t.length){const i=t[n];return i.$context||(i.$context=function j$(e,n,t){return Md(e,{tick:t,index:n,type:"tick"})}(this.getContext(),n,i))}return this.$context||(this.$context=function V$(e,n){return Md(e,{scale:n,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const n=this.options.ticks,t=Yl(this.labelRotation),i=Math.abs(Math.cos(t)),o=Math.abs(Math.sin(t)),l=this._getLabelSizes(),u=n.autoSkipPadding||0,m=l?l.widest.width+u:0,y=l?l.highest.height+u:0;return this.isHorizontal()?y*i>m*o?m/i:y/o:y*o<m*i?y/i:m/o}_isVisible(){const n=this.options.display;return"auto"!==n?!!n:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(n){const t=this.axis,i=this.chart,o=this.options,{grid:l,position:u}=o,m=l.offset,y=this.isHorizontal(),T=this.ticks.length+(m?1:0),A=jy(l),z=[],V=l.setContext(this.getContext()),H=V.drawBorder?V.borderWidth:0,X=H/2,oe=function(Pn){return cp(i,Pn,H)};let le,we,ve,Re,Fe,lt,bt,kt,Ot,mi,Zn,Xn;if("top"===u)le=oe(this.bottom),lt=this.bottom-A,kt=le-X,mi=oe(n.top)+X,Xn=n.bottom;else if("bottom"===u)le=oe(this.top),mi=n.top,Xn=oe(n.bottom)-X,lt=le+X,kt=this.top+A;else if("left"===u)le=oe(this.right),Fe=this.right-A,bt=le-X,Ot=oe(n.left)+X,Zn=n.right;else if("right"===u)le=oe(this.left),Ot=n.left,Zn=oe(n.right)-X,Fe=le+X,bt=this.left+A;else if("x"===t){if("center"===u)le=oe((n.top+n.bottom)/2+.5);else if($n(u)){const Pn=Object.keys(u)[0];le=oe(this.chart.scales[Pn].getPixelForValue(u[Pn]))}mi=n.top,Xn=n.bottom,lt=le+X,kt=lt+A}else if("y"===t){if("center"===u)le=oe((n.left+n.right)/2);else if($n(u)){const Pn=Object.keys(u)[0];le=oe(this.chart.scales[Pn].getPixelForValue(u[Pn]))}Fe=le-X,bt=Fe-A,Ot=n.left,Zn=n.right}const Vr=Dn(o.ticks.maxTicksLimit,T),Es=Math.max(1,Math.ceil(T/Vr));for(we=0;we<T;we+=Es){const Pn=l.setContext(this.getContext(we)),Di=Pn.lineWidth,tv=Pn.color,bp=l.borderDash||[],nv=Pn.borderDashOffset,pg=Pn.tickWidth,a1=Pn.tickColor,mg=Pn.tickBorderDash||[],iv=Pn.tickBorderDashOffset;ve=N$(this,we,m),void 0!==ve&&(Re=cp(i,ve,Di),y?Fe=bt=Ot=Zn=Re:lt=kt=mi=Xn=Re,z.push({tx1:Fe,ty1:lt,tx2:bt,ty2:kt,x1:Ot,y1:mi,x2:Zn,y2:Xn,width:Di,color:tv,borderDash:bp,borderDashOffset:nv,tickWidth:pg,tickColor:a1,tickBorderDash:mg,tickBorderDashOffset:iv}))}return this._ticksLength=T,this._borderValue=le,z}_computeLabelItems(n){const t=this.axis,i=this.options,{position:o,ticks:l}=i,u=this.isHorizontal(),m=this.ticks,{align:y,crossAlign:C,padding:T,mirror:A}=l,z=jy(i.grid),V=z+T,H=A?-T:V,X=-Yl(this.labelRotation),oe=[];let le,we,ve,Re,Fe,lt,bt,kt,Ot,mi,Zn,Xn,Vr="middle";if("top"===o)lt=this.bottom-H,bt=this._getXAxisLabelAlignment();else if("bottom"===o)lt=this.top+H,bt=this._getXAxisLabelAlignment();else if("left"===o){const Pn=this._getYAxisLabelAlignment(z);bt=Pn.textAlign,Fe=Pn.x}else if("right"===o){const Pn=this._getYAxisLabelAlignment(z);bt=Pn.textAlign,Fe=Pn.x}else if("x"===t){if("center"===o)lt=(n.top+n.bottom)/2+V;else if($n(o)){const Pn=Object.keys(o)[0];lt=this.chart.scales[Pn].getPixelForValue(o[Pn])+V}bt=this._getXAxisLabelAlignment()}else if("y"===t){if("center"===o)Fe=(n.left+n.right)/2-V;else if($n(o)){const Pn=Object.keys(o)[0];Fe=this.chart.scales[Pn].getPixelForValue(o[Pn])}bt=this._getYAxisLabelAlignment(z).textAlign}"y"===t&&("start"===y?Vr="top":"end"===y&&(Vr="bottom"));const Es=this._getLabelSizes();for(le=0,we=m.length;le<we;++le){ve=m[le],Re=ve.label;const Pn=l.setContext(this.getContext(le));kt=this.getPixelForTick(le)+l.labelOffset,Ot=this._resolveTickFontOptions(le),mi=Ot.lineHeight,Zn=Ai(Re)?Re.length:1;const Di=Zn/2,tv=Pn.color,bp=Pn.textStrokeColor,nv=Pn.textStrokeWidth;let a1,pg=bt;if(u?(Fe=kt,"inner"===bt&&(pg=le===we-1?this.options.reverse?"left":"right":0===le?this.options.reverse?"right":"left":"center"),Xn="top"===o?"near"===C||0!==X?-Zn*mi+mi/2:"center"===C?-Es.highest.height/2-Di*mi+mi:mi/2-Es.highest.height:"near"===C||0!==X?mi/2:"center"===C?Es.highest.height/2-Di*mi:Es.highest.height-Zn*mi,A&&(Xn*=-1)):(lt=kt,Xn=(1-Zn)*mi/2),Pn.showLabelBackdrop){const mg=Qo(Pn.backdropPadding),iv=Es.heights[le],MD=Es.widths[le];let ID=lt+Xn-mg.top,AD=Fe-mg.left;switch(Vr){case"middle":ID-=iv/2;break;case"bottom":ID-=iv}switch(bt){case"center":AD-=MD/2;break;case"right":AD-=MD}a1={left:AD,top:ID,width:MD+mg.width,height:iv+mg.height,color:Pn.backdropColor}}oe.push({rotation:X,label:Re,font:Ot,color:tv,strokeColor:bp,strokeWidth:nv,textOffset:Xn,textAlign:pg,textBaseline:Vr,translation:[Fe,lt],backdrop:a1})}return oe}_getXAxisLabelAlignment(){const{position:n,ticks:t}=this.options;if(-Yl(this.labelRotation))return"top"===n?"left":"right";let o="center";return"start"===t.align?o="left":"end"===t.align?o="right":"inner"===t.align&&(o="inner"),o}_getYAxisLabelAlignment(n){const{position:t,ticks:{crossAlign:i,mirror:o,padding:l}}=this.options,m=n+l,y=this._getLabelSizes().widest.width;let C,T;return"left"===t?o?(T=this.right+l,"near"===i?C="left":"center"===i?(C="center",T+=y/2):(C="right",T+=y)):(T=this.right-m,"near"===i?C="right":"center"===i?(C="center",T-=y/2):(C="left",T=this.left)):"right"===t?o?(T=this.left+l,"near"===i?C="right":"center"===i?(C="center",T-=y/2):(C="left",T-=y)):(T=this.left+m,"near"===i?C="left":"center"===i?(C="center",T+=y/2):(C="right",T=this.right)):C="right",{textAlign:C,x:T}}_computeLabelArea(){if(this.options.ticks.mirror)return;const n=this.chart,t=this.options.position;return"left"===t||"right"===t?{top:0,left:this.left,bottom:n.height,right:this.right}:"top"===t||"bottom"===t?{top:this.top,left:0,bottom:this.bottom,right:n.width}:void 0}drawBackground(){const{ctx:n,options:{backgroundColor:t},left:i,top:o,width:l,height:u}=this;t&&(n.save(),n.fillStyle=t,n.fillRect(i,o,l,u),n.restore())}getLineWidthForValue(n){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const o=this.ticks.findIndex(l=>l.value===n);return o>=0?t.setContext(this.getContext(o)).lineWidth:0}drawGrid(n){const t=this.options.grid,i=this.ctx,o=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(n));let l,u;const m=(y,C,T)=>{!T.width||!T.color||(i.save(),i.lineWidth=T.width,i.strokeStyle=T.color,i.setLineDash(T.borderDash||[]),i.lineDashOffset=T.borderDashOffset,i.beginPath(),i.moveTo(y.x,y.y),i.lineTo(C.x,C.y),i.stroke(),i.restore())};if(t.display)for(l=0,u=o.length;l<u;++l){const y=o[l];t.drawOnChartArea&&m({x:y.x1,y:y.y1},{x:y.x2,y:y.y2},y),t.drawTicks&&m({x:y.tx1,y:y.ty1},{x:y.tx2,y:y.ty2},{color:y.tickColor,width:y.tickWidth,borderDash:y.tickBorderDash,borderDashOffset:y.tickBorderDashOffset})}}drawBorder(){const{chart:n,ctx:t,options:{grid:i}}=this,o=i.setContext(this.getContext()),l=i.drawBorder?o.borderWidth:0;if(!l)return;const u=i.setContext(this.getContext(0)).lineWidth,m=this._borderValue;let y,C,T,A;this.isHorizontal()?(y=cp(n,this.left,l)-l/2,C=cp(n,this.right,u)+u/2,T=A=m):(T=cp(n,this.top,l)-l/2,A=cp(n,this.bottom,u)+u/2,y=C=m),t.save(),t.lineWidth=o.borderWidth,t.strokeStyle=o.borderColor,t.beginPath(),t.moveTo(y,T),t.lineTo(C,A),t.stroke(),t.restore()}drawLabels(n){if(!this.options.ticks.display)return;const i=this.ctx,o=this._computeLabelArea();o&&vb(i,o);const l=this._labelItems||(this._labelItems=this._computeLabelItems(n));let u,m;for(u=0,m=l.length;u<m;++u){const y=l[u],C=y.font,T=y.label;y.backdrop&&(i.fillStyle=y.backdrop.color,i.fillRect(y.backdrop.left,y.backdrop.top,y.backdrop.width,y.backdrop.height)),up(i,T,0,y.textOffset,C,y)}o&&xb(i)}drawTitle(){const{ctx:n,options:{position:t,title:i,reverse:o}}=this;if(!i.display)return;const l=no(i.font),u=Qo(i.padding),m=i.align;let y=l.lineHeight/2;"bottom"===t||"center"===t||$n(t)?(y+=u.bottom,Ai(i.text)&&(y+=l.lineHeight*(i.text.length-1))):y+=u.top;const{titleX:C,titleY:T,maxWidth:A,rotation:z}=function $$(e,n,t,i){const{top:o,left:l,bottom:u,right:m,chart:y}=e,{chartArea:C,scales:T}=y;let z,V,H,A=0;const X=u-o,oe=m-l;if(e.isHorizontal()){if(V=Jo(i,l,m),$n(t)){const le=Object.keys(t)[0];H=T[le].getPixelForValue(t[le])+X-n}else H="center"===t?(C.bottom+C.top)/2+X-n:_P(e,t,n);z=m-l}else{if($n(t)){const le=Object.keys(t)[0];V=T[le].getPixelForValue(t[le])-oe+n}else V="center"===t?(C.left+C.right)/2-oe+n:_P(e,t,n);H=Jo(i,u,o),A="left"===t?-fr:fr}return{titleX:V,titleY:H,maxWidth:z,rotation:A}}(this,y,t,m);up(n,i.text,0,0,l,{color:i.color,maxWidth:A,rotation:z,textAlign:U$(m,t,o),textBaseline:"middle",translation:[C,T]})}draw(n){this._isVisible()&&(this.drawBackground(),this.drawGrid(n),this.drawBorder(),this.drawTitle(),this.drawLabels(n))}_layers(){const n=this.options,t=n.ticks&&n.ticks.z||0,i=Dn(n.grid&&n.grid.z,-1);return this._isVisible()&&this.draw===gp.prototype.draw?[{z:i,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:i+1,draw:()=>{this.drawBorder()}},{z:t,draw:o=>{this.drawLabels(o)}}]:[{z:t,draw:o=>{this.draw(o)}}]}getMatchingVisibleMetas(n){const t=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",o=[];let l,u;for(l=0,u=t.length;l<u;++l){const m=t[l];m[i]===this.id&&(!n||m.type===n)&&o.push(m)}return o}_resolveTickFontOptions(n){return no(this.options.ticks.setContext(this.getContext(n)).font)}_maxDigits(){const n=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/n}}class Ib{constructor(n,t,i){this.type=n,this.scope=t,this.override=i,this.items=Object.create(null)}isForType(n){return Object.prototype.isPrototypeOf.call(this.type.prototype,n.prototype)}register(n){const t=Object.getPrototypeOf(n);let i;(function W$(e){return"id"in e&&"defaults"in e})(t)&&(i=this.register(t));const o=this.items,l=n.id,u=this.scope+"."+l;if(!l)throw new Error("class does not have id: "+n);return l in o||(o[l]=n,function H$(e,n,t){const i=by(Object.create(null),[t?zn.get(t):{},zn.get(n),e.defaults]);zn.set(n,i),e.defaultRoutes&&function G$(e,n){Object.keys(n).forEach(t=>{const i=t.split("."),o=i.pop(),l=[e].concat(i).join("."),u=n[t].split("."),m=u.pop(),y=u.join(".");zn.route(l,o,y,m)})}(n,e.defaultRoutes),e.descriptors&&zn.describe(n,e.descriptors)}(n,u,i),this.override&&zn.override(n.id,n.overrides)),u}get(n){return this.items[n]}unregister(n){const t=this.items,i=n.id,o=this.scope;i in t&&delete t[i],o&&i in zn[o]&&(delete zn[o][i],this.override&&delete lp[i])}}var Zu=new class q${constructor(){this.controllers=new Ib(qu,"datasets",!0),this.elements=new Ib(Kl,"elements"),this.plugins=new Ib(Object,"plugins"),this.scales=new Ib(gp,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...n){this._each("register",n)}remove(...n){this._each("unregister",n)}addControllers(...n){this._each("register",n,this.controllers)}addElements(...n){this._each("register",n,this.elements)}addPlugins(...n){this._each("register",n,this.plugins)}addScales(...n){this._each("register",n,this.scales)}getController(n){return this._get(n,this.controllers,"controller")}getElement(n){return this._get(n,this.elements,"element")}getPlugin(n){return this._get(n,this.plugins,"plugin")}getScale(n){return this._get(n,this.scales,"scale")}removeControllers(...n){this._each("unregister",n,this.controllers)}removeElements(...n){this._each("unregister",n,this.elements)}removePlugins(...n){this._each("unregister",n,this.plugins)}removeScales(...n){this._each("unregister",n,this.scales)}_each(n,t,i){[...t].forEach(o=>{const l=i||this._getRegistryForType(o);i||l.isForType(o)||l===this.plugins&&o.id?this._exec(n,l,o):pi(o,u=>{const m=i||this._getRegistryForType(u);this._exec(n,m,u)})})}_exec(n,t,i){const o=fE(n);Pi(i["before"+o],[],i),t[n](i),Pi(i["after"+o],[],i)}_getRegistryForType(n){for(let t=0;t<this._typedRegistries.length;t++){const i=this._typedRegistries[t];if(i.isForType(n))return i}return this.plugins}_get(n,t,i){const o=t.get(n);if(void 0===o)throw new Error('"'+n+'" is not a registered '+i+".");return o}};class Z${constructor(){this._init=[]}notify(n,t,i,o){"beforeInit"===t&&(this._init=this._createDescriptors(n,!0),this._notify(this._init,n,"install"));const l=o?this._descriptors(n).filter(o):this._descriptors(n),u=this._notify(l,n,t,i);return"afterDestroy"===t&&(this._notify(l,n,"stop"),this._notify(this._init,n,"uninstall")),u}_notify(n,t,i,o){o=o||{};for(const l of n){const u=l.plugin;if(!1===Pi(u[i],[t,o,l.options],u)&&o.cancelable)return!1}return!0}invalidate(){oi(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(n){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(n);return this._notifyStateChanges(n),t}_createDescriptors(n,t){const i=n&&n.config,o=Dn(i.options&&i.options.plugins,{}),l=function X$(e){const n=[],t=Object.keys(Zu.plugins.items);for(let o=0;o<t.length;o++)n.push(Zu.getPlugin(t[o]));const i=e.plugins||[];for(let o=0;o<i.length;o++){const l=i[o];-1===n.indexOf(l)&&n.push(l)}return n}(i);return!1!==o||t?function K$(e,n,t,i){const o=[],l=e.getContext();for(let u=0;u<n.length;u++){const m=n[u],C=Y$(t[m.id],i);null!==C&&o.push({plugin:m,options:J$(e.config,m,C,l)})}return o}(n,l,o,t):[]}_notifyStateChanges(n){const t=this._oldCache||[],i=this._cache,o=(l,u)=>l.filter(m=>!u.some(y=>m.plugin.id===y.plugin.id));this._notify(o(t,i),n,"stop"),this._notify(o(i,t),n,"start")}}function Y$(e,n){return n||!1!==e?!0===e?{}:e:null}function J$(e,n,t,i){const o=e.pluginScopeKeys(n),l=e.getOptionScopes(t,o);return e.createResolver(l,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function zE(e,n){return((n.datasets||{})[e]||{}).indexAxis||n.indexAxis||(zn.datasets[e]||{}).indexAxis||"x"}function NE(e,n){return"x"===e||"y"===e?e:n.axis||function t6(e){return"top"===e||"bottom"===e?"x":"left"===e||"right"===e?"y":void 0}(n.position)||e.charAt(0).toLowerCase()}function xP(e){const n=e.options||(e.options={});n.plugins=Dn(n.plugins,{}),n.scales=function n6(e,n){const t=lp[e.type]||{scales:{}},i=n.scales||{},o=zE(e.type,n),l=Object.create(null),u=Object.create(null);return Object.keys(i).forEach(m=>{const y=i[m];if(!$n(y))return console.error(`Invalid scale configuration for scale: ${m}`);if(y._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${m}`);const C=NE(m,y),T=function e6(e,n){return e===n?"_index_":"_value_"}(C,o),A=t.scales||{};l[C]=l[C]||m,u[m]=wy(Object.create(null),[{axis:C},y,A[C],A[T]])}),e.data.datasets.forEach(m=>{const y=m.type||e.type,C=m.indexAxis||zE(y,n),A=(lp[y]||{}).scales||{};Object.keys(A).forEach(z=>{const V=function Q$(e,n){let t=e;return"_index_"===e?t=n:"_value_"===e&&(t="x"===n?"y":"x"),t}(z,C),H=m[V+"AxisID"]||l[V]||V;u[H]=u[H]||Object.create(null),wy(u[H],[{axis:V},i[H],A[z]])})}),Object.keys(u).forEach(m=>{const y=u[m];wy(y,[zn.scales[y.type],zn.scale])}),u}(e,n)}function bP(e){return(e=e||{}).datasets=e.datasets||[],e.labels=e.labels||[],e}const wP=new Map,CP=new Set;function Ab(e,n){let t=wP.get(e);return t||(t=n(),wP.set(e,t),CP.add(t)),t}const Uy=(e,n,t)=>{const i=Ed(n,t);void 0!==i&&e.add(i)};class r6{constructor(n){this._config=function i6(e){return(e=e||{}).data=bP(e.data),xP(e),e}(n),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(n){this._config.type=n}get data(){return this._config.data}set data(n){this._config.data=bP(n)}get options(){return this._config.options}set options(n){this._config.options=n}get plugins(){return this._config.plugins}update(){const n=this._config;this.clearCache(),xP(n)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(n){return Ab(n,()=>[[`datasets.${n}`,""]])}datasetAnimationScopeKeys(n,t){return Ab(`${n}.transition.${t}`,()=>[[`datasets.${n}.transitions.${t}`,`transitions.${t}`],[`datasets.${n}`,""]])}datasetElementScopeKeys(n,t){return Ab(`${n}-${t}`,()=>[[`datasets.${n}.elements.${t}`,`datasets.${n}`,`elements.${t}`,""]])}pluginScopeKeys(n){const t=n.id;return Ab(`${this.type}-plugin-${t}`,()=>[[`plugins.${t}`,...n.additionalOptionScopes||[]]])}_cachedScopes(n,t){const i=this._scopeCache;let o=i.get(n);return(!o||t)&&(o=new Map,i.set(n,o)),o}getOptionScopes(n,t,i){const{options:o,type:l}=this,u=this._cachedScopes(n,i),m=u.get(t);if(m)return m;const y=new Set;t.forEach(T=>{n&&(y.add(n),T.forEach(A=>Uy(y,n,A))),T.forEach(A=>Uy(y,o,A)),T.forEach(A=>Uy(y,lp[l]||{},A)),T.forEach(A=>Uy(y,zn,A)),T.forEach(A=>Uy(y,wE,A))});const C=Array.from(y);return 0===C.length&&C.push(Object.create(null)),CP.has(t)&&u.set(t,C),C}chartOptionScopes(){const{options:n,type:t}=this;return[n,lp[t]||{},zn.datasets[t]||{},{type:t},zn,wE]}resolveNamedOptions(n,t,i,o=[""]){const l={$shared:!0},{resolver:u,subPrefixes:m}=EP(this._resolverCache,n,o);let y=u;(function s6(e,n){const{isScriptable:t,isIndexable:i}=E2(e);for(const o of n){const l=t(o),u=i(o),m=(u||l)&&e[o];if(l&&(Dd(m)||o6(m))||u&&Ai(m))return!0}return!1})(u,t)&&(l.$shared=!1,y=ng(u,i=Dd(i)?i():i,this.createResolver(n,i,m)));for(const C of t)l[C]=y[C];return l}createResolver(n,t,i=[""],o){const{resolver:l}=EP(this._resolverCache,n,i);return $n(t)?ng(l,t,void 0,o):l}}function EP(e,n,t){let i=e.get(n);i||(i=new Map,e.set(n,i));const o=t.join();let l=i.get(o);return l||(l={resolver:TE(n,t),subPrefixes:t.filter(m=>!m.toLowerCase().includes("hover"))},i.set(o,l)),l}const o6=e=>$n(e)&&Object.getOwnPropertyNames(e).reduce((n,t)=>n||Dd(e[t]),!1),l6=["top","bottom","left","right","chartArea"];function DP(e,n){return"top"===e||"bottom"===e||-1===l6.indexOf(e)&&"x"===n}function TP(e,n){return function(t,i){return t[e]===i[e]?t[n]-i[n]:t[e]-i[e]}}function SP(e){const n=e.chart,t=n.options.animation;n.notifyPlugins("afterRender"),Pi(t&&t.onComplete,[e],n)}function c6(e){const n=e.chart,t=n.options.animation;Pi(t&&t.onProgress,[e],n)}function MP(e){return k2()&&"string"==typeof e?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const Pb={},IP=e=>{const n=MP(e);return Object.values(Pb).filter(t=>t.canvas===n).pop()};function u6(e,n,t){const i=Object.keys(e);for(const o of i){const l=+o;if(l>=n){const u=e[o];delete e[o],(t>0||l>n)&&(e[l+t]=u)}}}class og{constructor(n,t){const i=this.config=new r6(t),o=MP(n),l=IP(o);if(l)throw new Error("Canvas is already in use. Chart with ID '"+l.id+"' must be destroyed before the canvas can be reused.");const u=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||function I$(e){return!k2()||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas?g$:M$}(o)),this.platform.updateConfig(i);const m=this.platform.acquireContext(o,u.aspectRatio),y=m&&m.canvas,C=y&&y.height,T=y&&y.width;this.id=ZU(),this.ctx=m,this.canvas=y,this.width=T,this.height=C,this._options=u,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Z$,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function WU(e,n){let t;return function(...i){return n?(clearTimeout(t),t=setTimeout(e,n,i)):e.apply(this,i),n}}(A=>this.update(A),u.resizeDelay||0),this._dataChanges=[],Pb[this.id]=this,m&&y?(Wu.listen(this,"complete",SP),Wu.listen(this,"progress",c6),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:n,maintainAspectRatio:t},width:i,height:o,_aspectRatio:l}=this;return oi(n)?t&&l?l:o?i/o:null:n}get data(){return this.config.data}set data(n){this.config.data=n}get options(){return this._options}set options(n){this.config.options=n}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():R2(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return v2(this.canvas,this.ctx),this}stop(){return Wu.stop(this),this}resize(n,t){Wu.running(this)?this._resizeBeforeDraw={width:n,height:t}:this._resize(n,t)}_resize(n,t){const i=this.options,u=this.platform.getMaximumSize(this.canvas,n,t,i.maintainAspectRatio&&this.aspectRatio),m=i.devicePixelRatio||this.platform.getDevicePixelRatio(),y=this.width?"resize":"attach";this.width=u.width,this.height=u.height,this._aspectRatio=this.aspectRatio,R2(this,m,!0)&&(this.notifyPlugins("resize",{size:u}),Pi(i.onResize,[this,u],this),this.attached&&this._doResize(y)&&this.render())}ensureScalesHaveIDs(){pi(this.options.scales||{},(i,o)=>{i.id=o})}buildOrUpdateScales(){const n=this.options,t=n.scales,i=this.scales,o=Object.keys(i).reduce((u,m)=>(u[m]=!1,u),{});let l=[];t&&(l=l.concat(Object.keys(t).map(u=>{const m=t[u],y=NE(u,m),C="r"===y,T="x"===y;return{options:m,dposition:C?"chartArea":T?"bottom":"left",dtype:C?"radialLinear":T?"category":"linear"}}))),pi(l,u=>{const m=u.options,y=m.id,C=NE(y,m),T=Dn(m.type,u.dtype);(void 0===m.position||DP(m.position,C)!==DP(u.dposition))&&(m.position=u.dposition),o[y]=!0;let A=null;y in i&&i[y].type===T?A=i[y]:(A=new(Zu.getScale(T))({id:y,type:T,ctx:this.ctx,chart:this}),i[A.id]=A),A.init(m,n)}),pi(o,(u,m)=>{u||delete i[m]}),pi(i,u=>{es.configure(this,u,u.options),es.addBox(this,u)})}_updateMetasets(){const n=this._metasets,t=this.data.datasets.length,i=n.length;if(n.sort((o,l)=>o.index-l.index),i>t){for(let o=t;o<i;++o)this._destroyDatasetMeta(o);n.splice(t,i-t)}this._sortedMetasets=n.slice(0).sort(TP("order","index"))}_removeUnreferencedMetasets(){const{_metasets:n,data:{datasets:t}}=this;n.length>t.length&&delete this._stacks,n.forEach((i,o)=>{0===t.filter(l=>l===i._dataset).length&&this._destroyDatasetMeta(o)})}buildOrUpdateControllers(){const n=[],t=this.data.datasets;let i,o;for(this._removeUnreferencedMetasets(),i=0,o=t.length;i<o;i++){const l=t[i];let u=this.getDatasetMeta(i);const m=l.type||this.config.type;if(u.type&&u.type!==m&&(this._destroyDatasetMeta(i),u=this.getDatasetMeta(i)),u.type=m,u.indexAxis=l.indexAxis||zE(m,this.options),u.order=l.order||0,u.index=i,u.label=""+l.label,u.visible=this.isDatasetVisible(i),u.controller)u.controller.updateIndex(i),u.controller.linkScales();else{const y=Zu.getController(m),{datasetElementType:C,dataElementType:T}=zn.datasets[m];Object.assign(y.prototype,{dataElementType:Zu.getElement(T),datasetElementType:C&&Zu.getElement(C)}),u.controller=new y(this,i),n.push(u.controller)}}return this._updateMetasets(),n}_resetElements(){pi(this.data.datasets,(n,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(n){const t=this.config;t.update();const i=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),o=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:n,cancelable:!0}))return;const l=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let u=0;for(let C=0,T=this.data.datasets.length;C<T;C++){const{controller:A}=this.getDatasetMeta(C),z=!o&&-1===l.indexOf(A);A.buildOrUpdateElements(z),u=Math.max(+A.getMaxOverflow(),u)}u=this._minPadding=i.layout.autoPadding?u:0,this._updateLayout(u),o||pi(l,C=>{C.reset()}),this._updateDatasets(n),this.notifyPlugins("afterUpdate",{mode:n}),this._layers.sort(TP("z","_idx"));const{_active:m,_lastEvent:y}=this;y?this._eventHandler(y,!0):m.length&&this._updateHoverStyles(m,m,!0),this.render()}_updateScales(){pi(this.scales,n=>{es.removeBox(this,n)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const n=this.options,t=new Set(Object.keys(this._listeners)),i=new Set(n.events);(!t2(t,i)||!!this._responsiveListeners!==n.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:n}=this,t=this._getUniformDataChanges()||[];for(const{method:i,start:o,count:l}of t)u6(n,o,"_removeElements"===i?-l:l)}_getUniformDataChanges(){const n=this._dataChanges;if(!n||!n.length)return;this._dataChanges=[];const t=this.data.datasets.length,i=l=>new Set(n.filter(u=>u[0]===l).map((u,m)=>m+","+u.splice(1).join(","))),o=i(0);for(let l=1;l<t;l++)if(!t2(o,i(l)))return;return Array.from(o).map(l=>l.split(",")).map(l=>({method:l[1],start:+l[2],count:+l[3]}))}_updateLayout(n){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;es.update(this,this.width,this.height,n);const t=this.chartArea,i=t.width<=0||t.height<=0;this._layers=[],pi(this.boxes,o=>{i&&"chartArea"===o.position||(o.configure&&o.configure(),this._layers.push(...o._layers()))},this),this._layers.forEach((o,l)=>{o._idx=l}),this.notifyPlugins("afterLayout")}_updateDatasets(n){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:n,cancelable:!0})){for(let t=0,i=this.data.datasets.length;t<i;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,i=this.data.datasets.length;t<i;++t)this._updateDataset(t,Dd(n)?n({datasetIndex:t}):n);this.notifyPlugins("afterDatasetsUpdate",{mode:n})}}_updateDataset(n,t){const i=this.getDatasetMeta(n),o={meta:i,index:n,mode:t,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",o)&&(i.controller._update(t),o.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",o))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(Wu.has(this)?this.attached&&!Wu.running(this)&&Wu.start(this):(this.draw(),SP({chart:this})))}draw(){let n;if(this._resizeBeforeDraw){const{width:i,height:o}=this._resizeBeforeDraw;this._resize(i,o),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const t=this._layers;for(n=0;n<t.length&&t[n].z<=0;++n)t[n].draw(this.chartArea);for(this._drawDatasets();n<t.length;++n)t[n].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(n){const t=this._sortedMetasets,i=[];let o,l;for(o=0,l=t.length;o<l;++o){const u=t[o];(!n||u.visible)&&i.push(u)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const n=this.getSortedVisibleDatasetMetas();for(let t=n.length-1;t>=0;--t)this._drawDataset(n[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(n){const t=this.ctx,i=n._clip,o=!i.disabled,l=this.chartArea,u={meta:n,index:n.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",u)&&(o&&vb(t,{left:!1===i.left?0:l.left-i.left,right:!1===i.right?this.width:l.right+i.right,top:!1===i.top?0:l.top-i.top,bottom:!1===i.bottom?this.height:l.bottom+i.bottom}),n.controller.draw(),o&&xb(t),u.cancelable=!1,this.notifyPlugins("afterDatasetDraw",u))}isPointInArea(n){return Py(n,this.chartArea,this._minPadding)}getElementsAtEventForMode(n,t,i,o){const l=l$.modes[t];return"function"==typeof l?l(this,n,i,o):[]}getDatasetMeta(n){const t=this.data.datasets[n],i=this._metasets;let o=i.filter(l=>l&&l._dataset===t).pop();return o||(o={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:n,_dataset:t,_parsed:[],_sorted:!1},i.push(o)),o}getContext(){return this.$context||(this.$context=Md(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(n){const t=this.data.datasets[n];if(!t)return!1;const i=this.getDatasetMeta(n);return"boolean"==typeof i.hidden?!i.hidden:!t.hidden}setDatasetVisibility(n,t){this.getDatasetMeta(n).hidden=!t}toggleDataVisibility(n){this._hiddenIndices[n]=!this._hiddenIndices[n]}getDataVisibility(n){return!this._hiddenIndices[n]}_updateVisibility(n,t,i){const o=i?"show":"hide",l=this.getDatasetMeta(n),u=l.controller._resolveAnimations(void 0,o);il(t)?(l.data[t].hidden=!i,this.update()):(this.setDatasetVisibility(n,i),u.update(l,{visible:i}),this.update(m=>m.datasetIndex===n?o:void 0))}hide(n,t){this._updateVisibility(n,t,!1)}show(n,t){this._updateVisibility(n,t,!0)}_destroyDatasetMeta(n){const t=this._metasets[n];t&&t.controller&&t.controller._destroy(),delete this._metasets[n]}_stop(){let n,t;for(this.stop(),Wu.remove(this),n=0,t=this.data.datasets.length;n<t;++n)this._destroyDatasetMeta(n)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:n,ctx:t}=this;this._stop(),this.config.clearCache(),n&&(this.unbindEvents(),v2(n,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete Pb[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...n){return this.canvas.toDataURL(...n)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const n=this._listeners,t=this.platform,i=(l,u)=>{t.addEventListener(this,l,u),n[l]=u},o=(l,u,m)=>{l.offsetX=u,l.offsetY=m,this._eventHandler(l)};pi(this.options.events,l=>i(l,o))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const n=this._responsiveListeners,t=this.platform,i=(y,C)=>{t.addEventListener(this,y,C),n[y]=C},o=(y,C)=>{n[y]&&(t.removeEventListener(this,y,C),delete n[y])},l=(y,C)=>{this.canvas&&this.resize(y,C)};let u;const m=()=>{o("attach",m),this.attached=!0,this.resize(),i("resize",l),i("detach",u)};u=()=>{this.attached=!1,o("resize",l),this._stop(),this._resize(0,0),i("attach",m)},t.isAttached(this.canvas)?m():u()}unbindEvents(){pi(this._listeners,(n,t)=>{this.platform.removeEventListener(this,t,n)}),this._listeners={},pi(this._responsiveListeners,(n,t)=>{this.platform.removeEventListener(this,t,n)}),this._responsiveListeners=void 0}updateHoverStyle(n,t,i){const o=i?"set":"remove";let l,u,m,y;for("dataset"===t&&(l=this.getDatasetMeta(n[0].datasetIndex),l.controller["_"+o+"DatasetHoverStyle"]()),m=0,y=n.length;m<y;++m){u=n[m];const C=u&&this.getDatasetMeta(u.datasetIndex).controller;C&&C[o+"HoverStyle"](u.element,u.datasetIndex,u.index)}}getActiveElements(){return this._active||[]}setActiveElements(n){const t=this._active||[],i=n.map(({datasetIndex:l,index:u})=>{const m=this.getDatasetMeta(l);if(!m)throw new Error("No dataset found at index "+l);return{datasetIndex:l,element:m.data[u],index:u}});!cb(i,t)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,t))}notifyPlugins(n,t,i){return this._plugins.notify(this,n,t,i)}_updateHoverStyles(n,t,i){const o=this.options.hover,l=(y,C)=>y.filter(T=>!C.some(A=>T.datasetIndex===A.datasetIndex&&T.index===A.index)),u=l(t,n),m=i?n:l(n,t);u.length&&this.updateHoverStyle(u,o.mode,!1),m.length&&o.mode&&this.updateHoverStyle(m,o.mode,!0)}_eventHandler(n,t){const i={event:n,replay:t,cancelable:!0,inChartArea:this.isPointInArea(n)},o=u=>(u.options.events||this.options.events).includes(n.native.type);if(!1===this.notifyPlugins("beforeEvent",i,o))return;const l=this._handleEvent(n,t,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,o),(l||i.changed)&&this.render(),this}_handleEvent(n,t,i){const{_active:o=[],options:l}=this,m=this._getActiveElements(n,o,i,t),y=function e5(e){return"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type}(n),C=function h6(e,n,t,i){return t&&"mouseout"!==e.type?i?n:e:null}(n,this._lastEvent,i,y);i&&(this._lastEvent=null,Pi(l.onHover,[n,m,this],this),y&&Pi(l.onClick,[n,m,this],this));const T=!cb(m,o);return(T||t)&&(this._active=m,this._updateHoverStyles(m,o,t)),this._lastEvent=C,T}_getActiveElements(n,t,i,o){if("mouseout"===n.type)return[];if(!i)return t;const l=this.options.hover;return this.getElementsAtEventForMode(n,l.mode,l,o)}}const AP=()=>pi(og.instances,e=>e._plugins.invalidate()),Id=!0;function PP(e,n,t){const{startAngle:i,pixelMargin:o,x:l,y:u,outerRadius:m,innerRadius:y}=n;let C=o/m;e.beginPath(),e.arc(l,u,m,i-C,t+C),y>o?(C=o/y,e.arc(l,u,y,t+C,i-C,!0)):e.arc(l,u,o,t+fr,i-fr),e.closePath(),e.clip()}function sg(e,n,t,i){return{x:t+e*Math.cos(n),y:i+e*Math.sin(n)}}function BE(e,n,t,i,o){const{x:l,y:u,startAngle:m,pixelMargin:y,innerRadius:C}=n,T=Math.max(n.outerRadius+i+t-y,0),A=C>0?C+i+t+y:0;let z=0;const V=o-m;if(i){const bp=((C>0?C-i:0)+(T>0?T-i:0))/2;z=(V-(0!==bp?V*bp/(bp+i):V))/2}const X=(V-Math.max(.001,V*T-t/qi)/T)/2,oe=m+X+z,le=o-X-z,{outerStart:we,outerEnd:ve,innerStart:Re,innerEnd:Fe}=function f6(e,n,t,i){const o=function d6(e){return EE(e,["outerStart","outerEnd","innerStart","innerEnd"])}(e.options.borderRadius),l=(t-n)/2,u=Math.min(l,i*n/2),m=y=>{const C=(t-Math.min(l,y))*i/2;return _o(y,0,Math.min(l,C))};return{outerStart:m(o.outerStart),outerEnd:m(o.outerEnd),innerStart:_o(o.innerStart,0,u),innerEnd:_o(o.innerEnd,0,u)}}(n,A,T,le-oe),lt=T-we,bt=T-ve,kt=oe+we/lt,Ot=le-ve/bt,mi=A+Re,Zn=A+Fe,Xn=oe+Re/mi,Vr=le-Fe/Zn;if(e.beginPath(),e.arc(l,u,T,kt,Ot),ve>0){const Di=sg(bt,Ot,l,u);e.arc(Di.x,Di.y,ve,Ot,le+fr)}const Es=sg(Zn,le,l,u);if(e.lineTo(Es.x,Es.y),Fe>0){const Di=sg(Zn,Vr,l,u);e.arc(Di.x,Di.y,Fe,le+fr,Vr+Math.PI)}if(e.arc(l,u,A,le-Fe/A,oe+Re/A,!0),Re>0){const Di=sg(mi,Xn,l,u);e.arc(Di.x,Di.y,Re,Xn+Math.PI,oe-fr)}const Pn=sg(lt,oe,l,u);if(e.lineTo(Pn.x,Pn.y),we>0){const Di=sg(lt,kt,l,u);e.arc(Di.x,Di.y,we,oe-fr,kt)}e.closePath()}Object.defineProperties(og,{defaults:{enumerable:Id,value:zn},instances:{enumerable:Id,value:Pb},overrides:{enumerable:Id,value:lp},registry:{enumerable:Id,value:Zu},version:{enumerable:Id,value:"3.8.0"},getChart:{enumerable:Id,value:IP},register:{enumerable:Id,value:(...e)=>{Zu.add(...e),AP()}},unregister:{enumerable:Id,value:(...e)=>{Zu.remove(...e),AP()}}});class kb extends Kl{constructor(n){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,n&&Object.assign(this,n)}inRange(n,t,i){const o=this.getProps(["x","y"],i),{angle:l,distance:u}=s2(o,{x:n,y:t}),{startAngle:m,endAngle:y,innerRadius:C,outerRadius:T,circumference:A}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),z=this.options.spacing/2,H=Dn(A,y-m)>=Ei||Ty(l,m,y),X=$u(u,C+z,T+z);return H&&X}getCenterPoint(n){const{x:t,y:i,startAngle:o,endAngle:l,innerRadius:u,outerRadius:m}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],n),{offset:y,spacing:C}=this.options,T=(o+l)/2,A=(u+m+C+y)/2;return{x:t+Math.cos(T)*A,y:i+Math.sin(T)*A}}tooltipPosition(n){return this.getCenterPoint(n)}draw(n){const{options:t,circumference:i}=this,o=(t.offset||0)/2,l=(t.spacing||0)/2;if(this.pixelMargin="inner"===t.borderAlign?.33:0,this.fullCircles=i>Ei?Math.floor(i/Ei):0,0===i||this.innerRadius<0||this.outerRadius<0)return;n.save();let u=0;if(o){u=o/2;const y=(this.startAngle+this.endAngle)/2;n.translate(Math.cos(y)*u,Math.sin(y)*u),this.circumference>=qi&&(u=o)}n.fillStyle=t.backgroundColor,n.strokeStyle=t.borderColor;const m=function p6(e,n,t,i){const{fullCircles:o,startAngle:l,circumference:u}=n;let m=n.endAngle;if(o){BE(e,n,t,i,l+Ei);for(let y=0;y<o;++y)e.fill();isNaN(u)||(m=l+u%Ei,u%Ei==0&&(m+=Ei))}return BE(e,n,t,i,m),e.fill(),m}(n,this,u,l);(function g6(e,n,t,i,o){const{options:l}=n,{borderWidth:u,borderJoinStyle:m}=l,y="inner"===l.borderAlign;u&&(y?(e.lineWidth=2*u,e.lineJoin=m||"round"):(e.lineWidth=u,e.lineJoin=m||"bevel"),n.fullCircles&&function m6(e,n,t){const{x:i,y:o,startAngle:l,pixelMargin:u,fullCircles:m}=n,y=Math.max(n.outerRadius-u,0),C=n.innerRadius+u;let T;for(t&&PP(e,n,l+Ei),e.beginPath(),e.arc(i,o,C,l+Ei,l,!0),T=0;T<m;++T)e.stroke();for(e.beginPath(),e.arc(i,o,y,l,l+Ei),T=0;T<m;++T)e.stroke()}(e,n,y),y&&PP(e,n,o),BE(e,n,t,i,o),e.stroke())})(n,this,u,l,m),n.restore()}}function kP(e,n,t=n){e.lineCap=Dn(t.borderCapStyle,n.borderCapStyle),e.setLineDash(Dn(t.borderDash,n.borderDash)),e.lineDashOffset=Dn(t.borderDashOffset,n.borderDashOffset),e.lineJoin=Dn(t.borderJoinStyle,n.borderJoinStyle),e.lineWidth=Dn(t.borderWidth,n.borderWidth),e.strokeStyle=Dn(t.borderColor,n.borderColor)}function _6(e,n,t){e.lineTo(t.x,t.y)}function RP(e,n,t={}){const i=e.length,{start:o=0,end:l=i-1}=t,{start:u,end:m}=n,y=Math.max(o,u),C=Math.min(l,m);return{count:i,start:y,loop:n.loop,ilen:C<y&&!(o<u&&l<u||o>m&&l>m)?i+C-y:C-y}}function v6(e,n,t,i){const{points:o,options:l}=n,{count:u,start:m,loop:y,ilen:C}=RP(o,t,i),T=function y6(e){return e.stepped?k5:e.tension||"monotone"===e.cubicInterpolationMode?R5:_6}(l);let V,H,X,{move:A=!0,reverse:z}=i||{};for(V=0;V<=C;++V)H=o[(m+(z?C-V:V))%u],!H.skip&&(A?(e.moveTo(H.x,H.y),A=!1):T(e,X,H,z,l.stepped),X=H);return y&&(H=o[(m+(z?C:0))%u],T(e,X,H,z,l.stepped)),!!y}function x6(e,n,t,i){const o=n.points,{count:l,start:u,ilen:m}=RP(o,t,i),{move:y=!0,reverse:C}=i||{};let z,V,H,X,oe,le,T=0,A=0;const we=Re=>(u+(C?m-Re:Re))%l,ve=()=>{X!==oe&&(e.lineTo(T,oe),e.lineTo(T,X),e.lineTo(T,le))};for(y&&(V=o[we(0)],e.moveTo(V.x,V.y)),z=0;z<=m;++z){if(V=o[we(z)],V.skip)continue;const Re=V.x,Fe=V.y,lt=0|Re;lt===H?(Fe<X?X=Fe:Fe>oe&&(oe=Fe),T=(A*T+Re)/++A):(ve(),e.lineTo(Re,Fe),H=lt,A=0,X=oe=Fe),le=Fe}ve()}function VE(e){const n=e.options;return e._decimated||e._loop||n.tension||"monotone"===n.cubicInterpolationMode||n.stepped||n.borderDash&&n.borderDash.length?v6:x6}kb.id="arc",kb.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0},kb.defaultRoutes={backgroundColor:"backgroundColor"};const E6="function"==typeof Path2D;let Rb=(()=>{class e extends Kl{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,i){const o=this.options;!o.tension&&"monotone"!==o.cubicInterpolationMode||o.stepped||this._pointsUpdated||(o4(this._points,o,t,o.spanGaps?this._loop:this._fullLoop,i),this._pointsUpdated=!0)}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function b4(e,n){const t=e.points,i=e.options.spanGaps,o=t.length;if(!o)return[];const l=!!e._loop,{start:u,end:m}=function v4(e,n,t,i){let o=0,l=n-1;if(t&&!i)for(;o<n&&!e[o].skip;)o++;for(;o<n&&e[o].skip;)o++;for(o%=n,t&&(l+=o);l>o&&e[l%n].skip;)l--;return l%=n,{start:o,end:l}}(t,o,l,i);return function U2(e,n,t,i){return i&&i.setContext&&t?function w4(e,n,t,i){const o=e._chart.getContext(),l=$2(e.options),{_datasetIndex:u,options:{spanGaps:m}}=e,y=t.length,C=[];let T=l,A=n[0].start,z=A;function V(H,X,oe,le){const we=m?-1:1;if(H!==X){for(H+=y;t[H%y].skip;)H-=we;for(;t[X%y].skip;)X+=we;H%y!=X%y&&(C.push({start:H%y,end:X%y,loop:oe,style:le}),T=le,A=X%y)}}for(const H of n){A=m?A:H.start;let oe,X=t[A%y];for(z=A+1;z<=H.end;z++){const le=t[z%y];oe=$2(i.setContext(Md(o,{type:"segment",p0:X,p1:le,p0DataIndex:(z-1)%y,p1DataIndex:z%y,datasetIndex:u}))),C4(oe,T)&&V(A,z-1,H.loop,T),X=le,T=oe}A<z-1&&V(A,z-1,H.loop,T)}return C}(e,n,t,i):n}(e,!0===i?[{start:u,end:m,loop:l}]:function x4(e,n,t,i){const o=e.length,l=[];let y,u=n,m=e[n];for(y=n+1;y<=t;++y){const C=e[y%o];C.skip||C.stop?m.skip||(l.push({start:n%o,end:(y-1)%o,loop:i=!1}),n=u=C.stop?y:null):(u=y,m.skip&&(n=y)),m=C}return null!==u&&l.push({start:n%o,end:u%o,loop:i}),l}(t,u,m<u?m+o:m,!!e._fullLoop&&0===u&&m===o-1),t,n)}(this,this.options.segment))}first(){const t=this.segments;return t.length&&this.points[t[0].start]}last(){const t=this.segments,o=t.length;return o&&this.points[t[o-1].end]}interpolate(t,i){const o=this.options,l=t[i],u=this.points,m=j2(this,{property:i,start:l,end:l});if(!m.length)return;const y=[],C=function b6(e){return e.stepped?f4:e.tension||"monotone"===e.cubicInterpolationMode?p4:pp}(o);let T,A;for(T=0,A=m.length;T<A;++T){const{start:z,end:V}=m[T],H=u[z],X=u[V];if(H===X){y.push(H);continue}const le=C(H,X,Math.abs((l-H[i])/(X[i]-H[i])),o.stepped);le[i]=t[i],y.push(le)}return 1===y.length?y[0]:y}pathSegment(t,i,o){return VE(this)(t,this,i,o)}path(t,i,o){const l=this.segments,u=VE(this);let m=this._loop;i=i||0,o=o||this.points.length-i;for(const y of l)m&=u(t,this,y,{start:i,end:i+o-1});return!!m}draw(t,i,o,l){(this.points||[]).length&&(this.options||{}).borderWidth&&(t.save(),function D6(e,n,t,i){E6&&!n.options.segment?function w6(e,n,t,i){let o=n._path;o||(o=n._path=new Path2D,n.path(o,t,i)&&o.closePath()),kP(e,n.options),e.stroke(o)}(e,n,t,i):function C6(e,n,t,i){const{segments:o,options:l}=n,u=VE(n);for(const m of o)kP(e,l,m.style),e.beginPath(),u(e,n,m,{start:t,end:t+i-1})&&e.closePath(),e.stroke()}(e,n,t,i)}(t,this,o,l),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return e.id="line",e.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},e.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},e.descriptors={_scriptable:!0,_indexable:n=>"borderDash"!==n&&"fill"!==n},e})();function OP(e,n,t,i){const o=e.options,{[t]:l}=e.getProps([t],i);return Math.abs(n-l)<o.radius+o.hitRadius}let T6=(()=>{class e extends Kl{constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,i,o){const l=this.options,{x:u,y:m}=this.getProps(["x","y"],o);return Math.pow(t-u,2)+Math.pow(i-m,2)<Math.pow(l.hitRadius+l.radius,2)}inXRange(t,i){return OP(this,t,"x",i)}inYRange(t,i){return OP(this,t,"y",i)}getCenterPoint(t){const{x:i,y:o}=this.getProps(["x","y"],t);return{x:i,y:o}}size(t){let i=(t=t||this.options||{}).radius||0;return i=Math.max(i,i&&t.hoverRadius||0),2*(i+(i&&t.borderWidth||0))}draw(t,i){const o=this.options;this.skip||o.radius<.1||!Py(this,i,this.size(o)/2)||(t.strokeStyle=o.borderColor,t.lineWidth=o.borderWidth,t.fillStyle=o.backgroundColor,yb(t,o,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}return e.id="point",e.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},e.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},e})();function LP(e,n){const{x:t,y:i,base:o,width:l,height:u}=e.getProps(["x","y","base","width","height"],n);let m,y,C,T,A;return e.horizontal?(A=u/2,m=Math.min(t,o),y=Math.max(t,o),C=i-A,T=i+A):(A=l/2,m=t-A,y=t+A,C=Math.min(i,o),T=Math.max(i,o)),{left:m,top:C,right:y,bottom:T}}function Ad(e,n,t,i){return e?0:_o(n,t,i)}function jE(e,n,t,i){const o=null===n,l=null===t,m=e&&!(o&&l)&&LP(e,i);return m&&(o||$u(n,m.left,m.right))&&(l||$u(t,m.top,m.bottom))}function P6(e,n){e.rect(n.x,n.y,n.w,n.h)}function UE(e,n,t={}){const i=e.x!==t.x?-n:0,o=e.y!==t.y?-n:0;return{x:e.x+i,y:e.y+o,w:e.w+((e.x+e.w!==t.x+t.w?n:0)-i),h:e.h+((e.y+e.h!==t.y+t.h?n:0)-o),radius:e.radius}}class Ob extends Kl{constructor(n){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,n&&Object.assign(this,n)}draw(n){const{inflateAmount:t,options:{borderColor:i,backgroundColor:o}}=this,{inner:l,outer:u}=function I6(e){const n=LP(e),t=n.right-n.left,i=n.bottom-n.top,o=function S6(e,n,t){const o=e.borderSkipped,l=x2(e.options.borderWidth);return{t:Ad(o.top,l.top,0,t),r:Ad(o.right,l.right,0,n),b:Ad(o.bottom,l.bottom,0,t),l:Ad(o.left,l.left,0,n)}}(e,t/2,i/2),l=function M6(e,n,t){const{enableBorderRadius:i}=e.getProps(["enableBorderRadius"]),o=e.options.borderRadius,l=hp(o),u=Math.min(n,t),m=e.borderSkipped,y=i||$n(o);return{topLeft:Ad(!y||m.top||m.left,l.topLeft,0,u),topRight:Ad(!y||m.top||m.right,l.topRight,0,u),bottomLeft:Ad(!y||m.bottom||m.left,l.bottomLeft,0,u),bottomRight:Ad(!y||m.bottom||m.right,l.bottomRight,0,u)}}(e,t/2,i/2);return{outer:{x:n.left,y:n.top,w:t,h:i,radius:l},inner:{x:n.left+o.l,y:n.top+o.t,w:t-o.l-o.r,h:i-o.t-o.b,radius:{topLeft:Math.max(0,l.topLeft-Math.max(o.t,o.l)),topRight:Math.max(0,l.topRight-Math.max(o.t,o.r)),bottomLeft:Math.max(0,l.bottomLeft-Math.max(o.b,o.l)),bottomRight:Math.max(0,l.bottomRight-Math.max(o.b,o.r))}}}}(this),m=function A6(e){return e.topLeft||e.topRight||e.bottomLeft||e.bottomRight}(u.radius)?ky:P6;n.save(),(u.w!==l.w||u.h!==l.h)&&(n.beginPath(),m(n,UE(u,t,l)),n.clip(),m(n,UE(l,-t,u)),n.fillStyle=i,n.fill("evenodd")),n.beginPath(),m(n,UE(l,t)),n.fillStyle=o,n.fill(),n.restore()}inRange(n,t,i){return jE(this,n,t,i)}inXRange(n,t){return jE(this,n,null,t)}inYRange(n,t){return jE(this,null,n,t)}getCenterPoint(n){const{x:t,y:i,base:o,horizontal:l}=this.getProps(["x","y","base","horizontal"],n);return{x:l?(t+o)/2:t,y:l?i:(i+o)/2}}getRange(n){return"x"===n?this.width/2:this.height/2}}Ob.id="bar",Ob.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},Ob.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var k6=Object.freeze({__proto__:null,ArcElement:kb,LineElement:Rb,PointElement:T6,BarElement:Ob});function FP(e){if(e._decimated){const n=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{value:n})}}function zP(e){e.data.datasets.forEach(n=>{FP(n)})}var F6={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,n,t)=>{if(!t.enabled)return void zP(e);const i=e.width;e.data.datasets.forEach((o,l)=>{const{_data:u,indexAxis:m}=o,y=e.getDatasetMeta(l),C=u||o.data;if("y"===Ry([m,e.options.indexAxis])||!y.controller.supportsDecimation)return;const T=e.scales[y.xAxisID];if("linear"!==T.type&&"time"!==T.type||e.options.parsing)return;let H,{start:A,count:z}=function L6(e,n){const t=n.length;let o,i=0;const{iScale:l}=e,{min:u,max:m,minDefined:y,maxDefined:C}=l.getUserBounds();return y&&(i=_o(Gu(n,l.axis,u).lo,0,t-1)),o=C?_o(Gu(n,l.axis,m).hi+1,i,t)-i:t-i,{start:i,count:o}}(y,C);if(z<=(t.threshold||4*i))FP(o);else{switch(oi(u)&&(o._data=C,delete o.data,Object.defineProperty(o,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(X){this._data=X}})),t.algorithm){case"lttb":H=function R6(e,n,t,i,o){const l=o.samples||i;if(l>=t)return e.slice(n,n+t);const u=[],m=(t-2)/(l-2);let y=0;const C=n+t-1;let A,z,V,H,X,T=n;for(u[y++]=e[T],A=0;A<l-2;A++){let we,oe=0,le=0;const ve=Math.floor((A+1)*m)+1+n,Re=Math.min(Math.floor((A+2)*m)+1,t)+n,Fe=Re-ve;for(we=ve;we<Re;we++)oe+=e[we].x,le+=e[we].y;oe/=Fe,le/=Fe;const lt=Math.floor(A*m)+1+n,bt=Math.min(Math.floor((A+1)*m)+1,t)+n,{x:kt,y:Ot}=e[T];for(V=H=-1,we=lt;we<bt;we++)H=.5*Math.abs((kt-oe)*(e[we].y-Ot)-(kt-e[we].x)*(le-Ot)),H>V&&(V=H,z=e[we],X=we);u[y++]=z,T=X}return u[y++]=e[C],u}(C,A,z,i,t);break;case"min-max":H=function O6(e,n,t,i){let u,m,y,C,T,A,z,V,H,X,o=0,l=0;const oe=[],we=e[n].x,Re=e[n+t-1].x-we;for(u=n;u<n+t;++u){m=e[u],y=(m.x-we)/Re*i,C=m.y;const Fe=0|y;if(Fe===T)C<H?(H=C,A=u):C>X&&(X=C,z=u),o=(l*o+m.x)/++l;else{const lt=u-1;if(!oi(A)&&!oi(z)){const bt=Math.min(A,z),kt=Math.max(A,z);bt!==V&&bt!==lt&&oe.push({...e[bt],x:o}),kt!==V&&kt!==lt&&oe.push({...e[kt],x:o})}u>0&&lt!==V&&oe.push(e[lt]),oe.push(m),T=Fe,l=0,H=X=C,A=z=V=u}}return oe}(C,A,z,i);break;default:throw new Error(`Unsupported decimation algorithm '${t.algorithm}'`)}o._decimated=H}})},destroy(e){zP(e)}};function $E(e,n,t,i){if(i)return;let o=n[e],l=t[e];return"angle"===e&&(o=ba(o),l=ba(l)),{property:e,start:o,end:l}}function HE(e,n,t){for(;n>e;n--){const i=t[n];if(!isNaN(i.x)&&!isNaN(i.y))break}return n}function NP(e,n,t,i){return e&&n?i(e[t],n[t]):e?e[t]:n?n[t]:0}function BP(e,n){let t=[],i=!1;return Ai(e)?(i=!0,t=e):t=function N6(e,n){const{x:t=null,y:i=null}=e||{},o=n.points,l=[];return n.segments.forEach(({start:u,end:m})=>{m=HE(u,m,o);const y=o[u],C=o[m];null!==i?(l.push({x:y.x,y:i}),l.push({x:C.x,y:i})):null!==t&&(l.push({x:t,y:y.y}),l.push({x:t,y:C.y}))}),l}(e,n),t.length?new Rb({points:t,options:{tension:0},_loop:i,_fullLoop:i}):null}function B6(e,n,t){let o=e[n].fill;const l=[n];let u;if(!t)return o;for(;!1!==o&&-1===l.indexOf(o);){if(!Er(o))return o;if(u=e[o],!u)return!1;if(u.visible)return o;l.push(o),o=u.fill}return!1}function V6(e,n,t){const i=function H6(e){const n=e.options,t=n.fill;let i=Dn(t&&t.target,t);return void 0===i&&(i=!!n.backgroundColor),!1!==i&&null!==i&&(!0===i?"origin":i)}(e);if($n(i))return!isNaN(i.value)&&i;let o=parseFloat(i);return Er(o)&&Math.floor(o)===o?function j6(e,n,t,i){return("-"===e||"+"===e)&&(t=n+t),!(t===n||t<0||t>=i)&&t}(i[0],n,o,t):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function q6(e,n,t){const i=[];for(let o=0;o<t.length;o++){const l=t[o],{first:u,last:m,point:y}=Z6(l,n,"x");if(!(!y||u&&m))if(u)i.unshift(y);else if(e.push(y),!m)break}e.push(...i)}function Z6(e,n,t){const i=e.interpolate(n,t);if(!i)return{};const o=i[t],l=e.segments,u=e.points;let m=!1,y=!1;for(let C=0;C<l.length;C++){const T=l[C],A=u[T.start][t],z=u[T.end][t];if($u(o,A,z)){m=o===A,y=o===z;break}}return{first:m,last:y,point:i}}class VP{constructor(n){this.x=n.x,this.y=n.y,this.radius=n.radius}pathSegment(n,t,i){const{x:o,y:l,radius:u}=this;return n.arc(o,l,u,(t=t||{start:0,end:Ei}).end,t.start,!0),!i.bounds}interpolate(n){const{x:t,y:i,radius:o}=this,l=n.angle;return{x:t+Math.cos(l)*o,y:i+Math.sin(l)*o,angle:l}}}function GE(e,n,t){const i=function X6(e){const{chart:n,fill:t,line:i}=e;if(Er(t))return function Y6(e,n){const t=e.getDatasetMeta(n);return t&&e.isDatasetVisible(n)?t.dataset:null}(n,t);if("stack"===t)return function G6(e){const{scale:n,index:t,line:i}=e,o=[],l=i.segments,u=i.points,m=function W6(e,n){const t=[],i=e.getMatchingVisibleMetas("line");for(let o=0;o<i.length;o++){const l=i[o];if(l.index===n)break;l.hidden||t.unshift(l.dataset)}return t}(n,t);m.push(BP({x:null,y:n.bottom},i));for(let y=0;y<l.length;y++){const C=l[y];for(let T=C.start;T<=C.end;T++)q6(o,u[T],m)}return new Rb({points:o,options:{}})}(e);if("shape"===t)return!0;const o=function K6(e){return(e.scale||{}).getPointPositionForValue?function Q6(e){const{scale:n,fill:t}=e,i=n.options,o=n.getLabels().length,l=i.reverse?n.max:n.min,u=function $6(e,n,t){let i;return i="start"===e?t:"end"===e?n.options.reverse?n.min:n.max:$n(e)?e.value:n.getBaseValue(),i}(t,n,l),m=[];if(i.grid.circular){const y=n.getPointPositionForValue(0,l);return new VP({x:y.x,y:y.y,radius:n.getDistanceFromCenterForValue(u)})}for(let y=0;y<o;++y)m.push(n.getPointPositionForValue(y,u));return m}(e):function J6(e){const{scale:n={},fill:t}=e,i=function U6(e,n){let t=null;return"start"===e?t=n.bottom:"end"===e?t=n.top:$n(e)?t=n.getPixelForValue(e.value):n.getBasePixel&&(t=n.getBasePixel()),t}(t,n);if(Er(i)){const o=n.isHorizontal();return{x:o?i:null,y:o?null:i}}return null}(e)}(e);return o instanceof VP?o:BP(o,i)}(n),{line:o,scale:l,axis:u}=n,m=o.options,y=m.fill,C=m.backgroundColor,{above:T=C,below:A=C}=y||{};i&&o.points.length&&(vb(e,t),function eH(e,n){const{line:t,target:i,above:o,below:l,area:u,scale:m}=n,y=t._loop?"angle":n.axis;e.save(),"x"===y&&l!==o&&(jP(e,i,u.top),UP(e,{line:t,target:i,color:o,scale:m,property:y}),e.restore(),e.save(),jP(e,i,u.bottom)),UP(e,{line:t,target:i,color:l,scale:m,property:y}),e.restore()}(e,{line:o,target:i,above:T,below:A,area:t,scale:l,axis:u}),xb(e))}function jP(e,n,t){const{segments:i,points:o}=n;let l=!0,u=!1;e.beginPath();for(const m of i){const{start:y,end:C}=m,T=o[y],A=o[HE(y,C,o)];l?(e.moveTo(T.x,T.y),l=!1):(e.lineTo(T.x,t),e.lineTo(T.x,T.y)),u=!!n.pathSegment(e,m,{move:u}),u?e.closePath():e.lineTo(A.x,t)}e.lineTo(n.first().x,t),e.closePath(),e.clip()}function UP(e,n){const{line:t,target:i,property:o,color:l,scale:u}=n,m=function z6(e,n,t){const i=e.segments,o=e.points,l=n.points,u=[];for(const m of i){let{start:y,end:C}=m;C=HE(y,C,o);const T=$E(t,o[y],o[C],m.loop);if(!n.segments){u.push({source:m,target:T,start:o[y],end:o[C]});continue}const A=j2(n,T);for(const z of A){const V=$E(t,l[z.start],l[z.end],z.loop),H=V2(m,o,V);for(const X of H)u.push({source:X,target:z,start:{[t]:NP(T,V,"start",Math.max)},end:{[t]:NP(T,V,"end",Math.min)}})}}return u}(t,i,o);for(const{source:y,target:C,start:T,end:A}of m){const{style:{backgroundColor:z=l}={}}=y,V=!0!==i;e.save(),e.fillStyle=z,tH(e,u,V&&$E(o,T,A)),e.beginPath();const H=!!t.pathSegment(e,y);let X;if(V){H?e.closePath():$P(e,i,A,o);const oe=!!i.pathSegment(e,C,{move:H,reverse:!0});X=H&&oe,X||$P(e,i,T,o)}e.closePath(),e.fill(X?"evenodd":"nonzero"),e.restore()}}function tH(e,n,t){const{top:i,bottom:o}=n.chart.chartArea,{property:l,start:u,end:m}=t||{};"x"===l&&(e.beginPath(),e.rect(u,i,m-u,o-i),e.clip())}function $P(e,n,t,i){const o=n.interpolate(t,i);o&&e.lineTo(o.x,o.y)}var nH={id:"filler",afterDatasetsUpdate(e,n,t){const i=(e.data.datasets||[]).length,o=[];let l,u,m,y;for(u=0;u<i;++u)l=e.getDatasetMeta(u),m=l.dataset,y=null,m&&m.options&&m instanceof Rb&&(y={visible:e.isDatasetVisible(u),index:u,fill:V6(m,u,i),chart:e,axis:l.controller.options.indexAxis,scale:l.vScale,line:m}),l.$filler=y,o.push(y);for(u=0;u<i;++u)y=o[u],y&&!1!==y.fill&&(y.fill=B6(o,u,t.propagate))},beforeDraw(e,n,t){const i="beforeDraw"===t.drawTime,o=e.getSortedVisibleDatasetMetas(),l=e.chartArea;for(let u=o.length-1;u>=0;--u){const m=o[u].$filler;m&&(m.line.updateControlPoints(l,m.axis),i&&GE(e.ctx,m,l))}},beforeDatasetsDraw(e,n,t){if("beforeDatasetsDraw"!==t.drawTime)return;const i=e.getSortedVisibleDatasetMetas();for(let o=i.length-1;o>=0;--o){const l=i[o].$filler;l&&GE(e.ctx,l,e.chartArea)}},beforeDatasetDraw(e,n,t){const i=n.meta.$filler;!i||!1===i.fill||"beforeDatasetDraw"!==t.drawTime||GE(e.ctx,i,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const HP=(e,n)=>{let{boxHeight:t=n,boxWidth:i=n}=e;return e.usePointStyle&&(t=Math.min(t,n),i=Math.min(i,n)),{boxWidth:i,boxHeight:t,itemHeight:Math.max(n,t)}};class GP extends Kl{constructor(n){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=n.chart,this.options=n.options,this.ctx=n.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(n,t,i){this.maxWidth=n,this.maxHeight=t,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const n=this.options.labels||{};let t=Pi(n.generateLabels,[this.chart],this)||[];n.filter&&(t=t.filter(i=>n.filter(i,this.chart.data))),n.sort&&(t=t.sort((i,o)=>n.sort(i,o,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:n,ctx:t}=this;if(!n.display)return void(this.width=this.height=0);const i=n.labels,o=no(i.font),l=o.size,u=this._computeTitleHeight(),{boxWidth:m,itemHeight:y}=HP(i,l);let C,T;t.font=o.string,this.isHorizontal()?(C=this.maxWidth,T=this._fitRows(u,l,m,y)+10):(T=this.maxHeight,C=this._fitCols(u,l,m,y)+10),this.width=Math.min(C,n.maxWidth||this.maxWidth),this.height=Math.min(T,n.maxHeight||this.maxHeight)}_fitRows(n,t,i,o){const{ctx:l,maxWidth:u,options:{labels:{padding:m}}}=this,y=this.legendHitBoxes=[],C=this.lineWidths=[0],T=o+m;let A=n;l.textAlign="left",l.textBaseline="middle";let z=-1,V=-T;return this.legendItems.forEach((H,X)=>{const oe=i+t/2+l.measureText(H.text).width;(0===X||C[C.length-1]+oe+2*m>u)&&(A+=T,C[C.length-(X>0?0:1)]=0,V+=T,z++),y[X]={left:0,top:V,row:z,width:oe,height:o},C[C.length-1]+=oe+m}),A}_fitCols(n,t,i,o){const{ctx:l,maxHeight:u,options:{labels:{padding:m}}}=this,y=this.legendHitBoxes=[],C=this.columnSizes=[],T=u-n;let A=m,z=0,V=0,H=0,X=0;return this.legendItems.forEach((oe,le)=>{const we=i+t/2+l.measureText(oe.text).width;le>0&&V+o+2*m>T&&(A+=z+m,C.push({width:z,height:V}),H+=z+m,X++,z=V=0),y[le]={left:H,top:V,col:X,width:we,height:o},z=Math.max(z,we),V+=o+m}),A+=z,C.push({width:z,height:V}),A}adjustHitBoxes(){if(!this.options.display)return;const n=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:i,labels:{padding:o},rtl:l}}=this,u=rg(l,this.left,this.width);if(this.isHorizontal()){let m=0,y=Jo(i,this.left+o,this.right-this.lineWidths[m]);for(const C of t)m!==C.row&&(m=C.row,y=Jo(i,this.left+o,this.right-this.lineWidths[m])),C.top+=this.top+n+o,C.left=u.leftForLtr(u.x(y),C.width),y+=C.width+o}else{let m=0,y=Jo(i,this.top+n+o,this.bottom-this.columnSizes[m].height);for(const C of t)C.col!==m&&(m=C.col,y=Jo(i,this.top+n+o,this.bottom-this.columnSizes[m].height)),C.top=y,C.left+=this.left+o,C.left=u.leftForLtr(u.x(C.left),C.width),y+=C.height+o}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const n=this.ctx;vb(n,this),this._draw(),xb(n)}}_draw(){const{options:n,columnSizes:t,lineWidths:i,ctx:o}=this,{align:l,labels:u}=n,m=zn.color,y=rg(n.rtl,this.left,this.width),C=no(u.font),{color:T,padding:A}=u,z=C.size,V=z/2;let H;this.drawTitle(),o.textAlign=y.textAlign("left"),o.textBaseline="middle",o.lineWidth=.5,o.font=C.string;const{boxWidth:X,boxHeight:oe,itemHeight:le}=HP(u,z),Re=this.isHorizontal(),Fe=this._computeTitleHeight();H=Re?{x:Jo(l,this.left+A,this.right-i[0]),y:this.top+A+Fe,line:0}:{x:this.left+A,y:Jo(l,this.top+Fe+A,this.bottom-t[0].height),line:0},F2(this.ctx,n.textDirection);const lt=le+A;this.legendItems.forEach((bt,kt)=>{o.strokeStyle=bt.fontColor||T,o.fillStyle=bt.fontColor||T;const Ot=o.measureText(bt.text).width,mi=y.textAlign(bt.textAlign||(bt.textAlign=u.textAlign)),Zn=X+V+Ot;let Xn=H.x,Vr=H.y;y.setWidth(this.width),Re?kt>0&&Xn+Zn+A>this.right&&(Vr=H.y+=lt,H.line++,Xn=H.x=Jo(l,this.left+A,this.right-i[H.line])):kt>0&&Vr+lt>this.bottom&&(Xn=H.x=Xn+t[H.line].width+A,H.line++,Vr=H.y=Jo(l,this.top+Fe+A,this.bottom-t[H.line].height)),function(bt,kt,Ot){if(isNaN(X)||X<=0||isNaN(oe)||oe<0)return;o.save();const mi=Dn(Ot.lineWidth,1);if(o.fillStyle=Dn(Ot.fillStyle,m),o.lineCap=Dn(Ot.lineCap,"butt"),o.lineDashOffset=Dn(Ot.lineDashOffset,0),o.lineJoin=Dn(Ot.lineJoin,"miter"),o.lineWidth=mi,o.strokeStyle=Dn(Ot.strokeStyle,m),o.setLineDash(Dn(Ot.lineDash,[])),u.usePointStyle){const Zn={radius:X*Math.SQRT2/2,pointStyle:Ot.pointStyle,rotation:Ot.rotation,borderWidth:mi},Xn=y.xPlus(bt,X/2);yb(o,Zn,Xn,kt+V)}else{const Zn=kt+Math.max((z-oe)/2,0),Xn=y.leftForLtr(bt,X),Vr=hp(Ot.borderRadius);o.beginPath(),Object.values(Vr).some(Es=>0!==Es)?ky(o,{x:Xn,y:Zn,w:X,h:oe,radius:Vr}):o.rect(Xn,Zn,X,oe),o.fill(),0!==mi&&o.stroke()}o.restore()}(y.x(Xn),Vr,bt),Xn=((e,n,t,i)=>e===(i?"left":"right")?t:"center"===e?(n+t)/2:n)(mi,Xn+X+V,Re?Xn+Zn:this.right,n.rtl),function(bt,kt,Ot){up(o,Ot.text,bt,kt+le/2,C,{strikethrough:Ot.hidden,textAlign:y.textAlign(Ot.textAlign)})}(y.x(Xn),Vr,bt),Re?H.x+=Zn+A:H.y+=lt}),z2(this.ctx,n.textDirection)}drawTitle(){const n=this.options,t=n.title,i=no(t.font),o=Qo(t.padding);if(!t.display)return;const l=rg(n.rtl,this.left,this.width),u=this.ctx,m=t.position,C=o.top+i.size/2;let T,A=this.left,z=this.width;if(this.isHorizontal())z=Math.max(...this.lineWidths),T=this.top+C,A=Jo(n.align,A,this.right-z);else{const H=this.columnSizes.reduce((X,oe)=>Math.max(X,oe.height),0);T=C+Jo(n.align,this.top,this.bottom-H-n.labels.padding-this._computeTitleHeight())}const V=Jo(m,A,A+z);u.textAlign=l.textAlign(dE(m)),u.textBaseline="middle",u.strokeStyle=t.color,u.fillStyle=t.color,u.font=i.string,up(u,t.text,V,T,i)}_computeTitleHeight(){const n=this.options.title,t=no(n.font),i=Qo(n.padding);return n.display?t.lineHeight+i.height:0}_getLegendItemAt(n,t){let i,o,l;if($u(n,this.left,this.right)&&$u(t,this.top,this.bottom))for(l=this.legendHitBoxes,i=0;i<l.length;++i)if(o=l[i],$u(n,o.left,o.left+o.width)&&$u(t,o.top,o.top+o.height))return this.legendItems[i];return null}handleEvent(n){const t=this.options;if(!function rH(e,n){return!(("mousemove"!==e&&"mouseout"!==e||!n.onHover&&!n.onLeave)&&(!n.onClick||"click"!==e&&"mouseup"!==e))}(n.type,t))return;const i=this._getLegendItemAt(n.x,n.y);if("mousemove"===n.type||"mouseout"===n.type){const o=this._hoveredItem,l=((e,n)=>null!==e&&null!==n&&e.datasetIndex===n.datasetIndex&&e.index===n.index)(o,i);o&&!l&&Pi(t.onLeave,[n,o,this],this),this._hoveredItem=i,i&&!l&&Pi(t.onHover,[n,i,this],this)}else i&&Pi(t.onClick,[n,i,this],this)}}var oH={id:"legend",_element:GP,start(e,n,t){const i=e.legend=new GP({ctx:e.ctx,options:t,chart:e});es.configure(e,i,t),es.addBox(e,i)},stop(e){es.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,n,t){const i=e.legend;es.configure(e,i,t),i.options=t},afterUpdate(e){const n=e.legend;n.buildLabels(),n.adjustHitBoxes()},afterEvent(e,n){n.replay||e.legend.handleEvent(n.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,n,t){const i=n.datasetIndex,o=t.chart;o.isDatasetVisible(i)?(o.hide(i),n.hidden=!0):(o.show(i),n.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const n=e.data.datasets,{labels:{usePointStyle:t,pointStyle:i,textAlign:o,color:l}}=e.legend.options;return e._getSortedDatasetMetas().map(u=>{const m=u.controller.getStyle(t?0:void 0),y=Qo(m.borderWidth);return{text:n[u.index].label,fillStyle:m.backgroundColor,fontColor:l,hidden:!u.visible,lineCap:m.borderCapStyle,lineDash:m.borderDash,lineDashOffset:m.borderDashOffset,lineJoin:m.borderJoinStyle,lineWidth:(y.width+y.height)/4,strokeStyle:m.borderColor,pointStyle:i||m.pointStyle,rotation:m.rotation,textAlign:o||m.textAlign,borderRadius:0,datasetIndex:u.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class WE extends Kl{constructor(n){super(),this.chart=n.chart,this.options=n.options,this.ctx=n.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(n,t){const i=this.options;if(this.left=0,this.top=0,!i.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=n,this.height=this.bottom=t;const o=Ai(i.text)?i.text.length:1;this._padding=Qo(i.padding);const l=o*no(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=l:this.width=l}isHorizontal(){const n=this.options.position;return"top"===n||"bottom"===n}_drawArgs(n){const{top:t,left:i,bottom:o,right:l,options:u}=this,m=u.align;let C,T,A,y=0;return this.isHorizontal()?(T=Jo(m,i,l),A=t+n,C=l-i):("left"===u.position?(T=i+n,A=Jo(m,o,t),y=-.5*qi):(T=l-n,A=Jo(m,t,o),y=.5*qi),C=o-t),{titleX:T,titleY:A,maxWidth:C,rotation:y}}draw(){const n=this.ctx,t=this.options;if(!t.display)return;const i=no(t.font),l=i.lineHeight/2+this._padding.top,{titleX:u,titleY:m,maxWidth:y,rotation:C}=this._drawArgs(l);up(n,t.text,0,0,i,{color:t.color,maxWidth:y,rotation:C,textAlign:dE(t.align),textBaseline:"middle",translation:[u,m]})}}var aH={id:"title",_element:WE,start(e,n,t){!function sH(e,n){const t=new WE({ctx:e.ctx,options:n,chart:e});es.configure(e,t,n),es.addBox(e,t),e.titleBlock=t}(e,t)},stop(e){es.removeBox(e,e.titleBlock),delete e.titleBlock},beforeUpdate(e,n,t){const i=e.titleBlock;es.configure(e,i,t),i.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Lb=new WeakMap;var lH={id:"subtitle",start(e,n,t){const i=new WE({ctx:e.ctx,options:t,chart:e});es.configure(e,i,t),es.addBox(e,i),Lb.set(e,i)},stop(e){es.removeBox(e,Lb.get(e)),Lb.delete(e)},beforeUpdate(e,n,t){const i=Lb.get(e);es.configure(e,i,t),i.options=t},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const $y={average(e){if(!e.length)return!1;let n,t,i=0,o=0,l=0;for(n=0,t=e.length;n<t;++n){const u=e[n].element;if(u&&u.hasValue()){const m=u.tooltipPosition();i+=m.x,o+=m.y,++l}}return{x:i/l,y:o/l}},nearest(e,n){if(!e.length)return!1;let l,u,m,t=n.x,i=n.y,o=Number.POSITIVE_INFINITY;for(l=0,u=e.length;l<u;++l){const y=e[l].element;if(y&&y.hasValue()){const T=mE(n,y.getCenterPoint());T<o&&(o=T,m=y)}}if(m){const y=m.tooltipPosition();t=y.x,i=y.y}return{x:t,y:i}}};function $c(e,n){return n&&(Ai(n)?Array.prototype.push.apply(e,n):e.push(n)),e}function Xu(e){return("string"==typeof e||e instanceof String)&&e.indexOf("\n")>-1?e.split("\n"):e}function cH(e,n){const{element:t,datasetIndex:i,index:o}=n,l=e.getDatasetMeta(i).controller,{label:u,value:m}=l.getLabelAndValue(o);return{chart:e,label:u,parsed:l.getParsed(o),raw:e.data.datasets[i].data[o],formattedValue:m,dataset:l.getDataset(),dataIndex:o,datasetIndex:i,element:t}}function WP(e,n){const t=e.chart.ctx,{body:i,footer:o,title:l}=e,{boxWidth:u,boxHeight:m}=n,y=no(n.bodyFont),C=no(n.titleFont),T=no(n.footerFont),A=l.length,z=o.length,V=i.length,H=Qo(n.padding);let X=H.height,oe=0,le=i.reduce((Re,Fe)=>Re+Fe.before.length+Fe.lines.length+Fe.after.length,0);le+=e.beforeBody.length+e.afterBody.length,A&&(X+=A*C.lineHeight+(A-1)*n.titleSpacing+n.titleMarginBottom),le&&(X+=V*(n.displayColors?Math.max(m,y.lineHeight):y.lineHeight)+(le-V)*y.lineHeight+(le-1)*n.bodySpacing),z&&(X+=n.footerMarginTop+z*T.lineHeight+(z-1)*n.footerSpacing);let we=0;const ve=function(Re){oe=Math.max(oe,t.measureText(Re).width+we)};return t.save(),t.font=C.string,pi(e.title,ve),t.font=y.string,pi(e.beforeBody.concat(e.afterBody),ve),we=n.displayColors?u+2+n.boxPadding:0,pi(i,Re=>{pi(Re.before,ve),pi(Re.lines,ve),pi(Re.after,ve)}),we=0,t.font=T.string,pi(e.footer,ve),t.restore(),oe+=H.width,{width:oe,height:X}}function dH(e,n,t,i){const{x:o,width:l}=t,{width:u,chartArea:{left:m,right:y}}=e;let C="center";return"center"===i?C=o<=(m+y)/2?"left":"right":o<=l/2?C="left":o>=u-l/2&&(C="right"),function hH(e,n,t,i){const{x:o,width:l}=i,u=t.caretSize+t.caretPadding;if("left"===e&&o+l+u>n.width||"right"===e&&o-l-u<0)return!0}(C,e,n,t)&&(C="center"),C}function qP(e,n,t){const i=t.yAlign||n.yAlign||function uH(e,n){const{y:t,height:i}=n;return t<i/2?"top":t>e.height-i/2?"bottom":"center"}(e,t);return{xAlign:t.xAlign||n.xAlign||dH(e,n,t,i),yAlign:i}}function ZP(e,n,t,i){const{caretSize:o,caretPadding:l,cornerRadius:u}=e,{xAlign:m,yAlign:y}=t,C=o+l,{topLeft:T,topRight:A,bottomLeft:z,bottomRight:V}=hp(u);let H=function fH(e,n){let{x:t,width:i}=e;return"right"===n?t-=i:"center"===n&&(t-=i/2),t}(n,m);const X=function pH(e,n,t){let{y:i,height:o}=e;return"top"===n?i+=t:i-="bottom"===n?o+t:o/2,i}(n,y,C);return"center"===y?"left"===m?H+=C:"right"===m&&(H-=C):"left"===m?H-=Math.max(T,z)+o:"right"===m&&(H+=Math.max(A,V)+o),{x:_o(H,0,i.width-n.width),y:_o(X,0,i.height-n.height)}}function Fb(e,n,t){const i=Qo(t.padding);return"center"===n?e.x+e.width/2:"right"===n?e.x+e.width-i.right:e.x+i.left}function XP(e){return $c([],Xu(e))}function YP(e,n){const t=n&&n.dataset&&n.dataset.tooltip&&n.dataset.tooltip.callbacks;return t?e.override(t):e}let KP=(()=>{class e extends Kl{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart||t._chart,this._chart=this.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const i=this.chart,o=this.options.setContext(this.getContext()),l=o.enabled&&i.options.animation&&o.animations,u=new G2(this.chart,l);return l._cacheable&&(this._cachedAnimations=Object.freeze(u)),u}getContext(){return this.$context||(this.$context=function mH(e,n,t){return Md(e,{tooltip:n,tooltipItems:t,type:"tooltip"})}(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,i){const{callbacks:o}=i,l=o.beforeTitle.apply(this,[t]),u=o.title.apply(this,[t]),m=o.afterTitle.apply(this,[t]);let y=[];return y=$c(y,Xu(l)),y=$c(y,Xu(u)),y=$c(y,Xu(m)),y}getBeforeBody(t,i){return XP(i.callbacks.beforeBody.apply(this,[t]))}getBody(t,i){const{callbacks:o}=i,l=[];return pi(t,u=>{const m={before:[],lines:[],after:[]},y=YP(o,u);$c(m.before,Xu(y.beforeLabel.call(this,u))),$c(m.lines,y.label.call(this,u)),$c(m.after,Xu(y.afterLabel.call(this,u))),l.push(m)}),l}getAfterBody(t,i){return XP(i.callbacks.afterBody.apply(this,[t]))}getFooter(t,i){const{callbacks:o}=i,l=o.beforeFooter.apply(this,[t]),u=o.footer.apply(this,[t]),m=o.afterFooter.apply(this,[t]);let y=[];return y=$c(y,Xu(l)),y=$c(y,Xu(u)),y=$c(y,Xu(m)),y}_createItems(t){const i=this._active,o=this.chart.data,l=[],u=[],m=[];let C,T,y=[];for(C=0,T=i.length;C<T;++C)y.push(cH(this.chart,i[C]));return t.filter&&(y=y.filter((A,z,V)=>t.filter(A,z,V,o))),t.itemSort&&(y=y.sort((A,z)=>t.itemSort(A,z,o))),pi(y,A=>{const z=YP(t.callbacks,A);l.push(z.labelColor.call(this,A)),u.push(z.labelPointStyle.call(this,A)),m.push(z.labelTextColor.call(this,A))}),this.labelColors=l,this.labelPointStyles=u,this.labelTextColors=m,this.dataPoints=y,y}update(t,i){const o=this.options.setContext(this.getContext()),l=this._active;let u,m=[];if(l.length){const y=$y[o.position].call(this,l,this._eventPosition);m=this._createItems(o),this.title=this.getTitle(m,o),this.beforeBody=this.getBeforeBody(m,o),this.body=this.getBody(m,o),this.afterBody=this.getAfterBody(m,o),this.footer=this.getFooter(m,o);const C=this._size=WP(this,o),T=Object.assign({},y,C),A=qP(this.chart,o,T),z=ZP(o,T,A,this.chart);this.xAlign=A.xAlign,this.yAlign=A.yAlign,u={opacity:1,x:z.x,y:z.y,width:C.width,height:C.height,caretX:y.x,caretY:y.y}}else 0!==this.opacity&&(u={opacity:0});this._tooltipItems=m,this.$context=void 0,u&&this._resolveAnimations().update(this,u),t&&o.external&&o.external.call(this,{chart:this.chart,tooltip:this,replay:i})}drawCaret(t,i,o,l){const u=this.getCaretPosition(t,o,l);i.lineTo(u.x1,u.y1),i.lineTo(u.x2,u.y2),i.lineTo(u.x3,u.y3)}getCaretPosition(t,i,o){const{xAlign:l,yAlign:u}=this,{caretSize:m,cornerRadius:y}=o,{topLeft:C,topRight:T,bottomLeft:A,bottomRight:z}=hp(y),{x:V,y:H}=t,{width:X,height:oe}=i;let le,we,ve,Re,Fe,lt;return"center"===u?(Fe=H+oe/2,"left"===l?(le=V,we=le-m,Re=Fe+m,lt=Fe-m):(le=V+X,we=le+m,Re=Fe-m,lt=Fe+m),ve=le):(we="left"===l?V+Math.max(C,A)+m:"right"===l?V+X-Math.max(T,z)-m:this.caretX,"top"===u?(Re=H,Fe=Re-m,le=we-m,ve=we+m):(Re=H+oe,Fe=Re+m,le=we+m,ve=we-m),lt=Re),{x1:le,x2:we,x3:ve,y1:Re,y2:Fe,y3:lt}}drawTitle(t,i,o){const l=this.title,u=l.length;let m,y,C;if(u){const T=rg(o.rtl,this.x,this.width);for(t.x=Fb(this,o.titleAlign,o),i.textAlign=T.textAlign(o.titleAlign),i.textBaseline="middle",m=no(o.titleFont),y=o.titleSpacing,i.fillStyle=o.titleColor,i.font=m.string,C=0;C<u;++C)i.fillText(l[C],T.x(t.x),t.y+m.lineHeight/2),t.y+=m.lineHeight+y,C+1===u&&(t.y+=o.titleMarginBottom-y)}}_drawColorBox(t,i,o,l,u){const m=this.labelColors[o],y=this.labelPointStyles[o],{boxHeight:C,boxWidth:T,boxPadding:A}=u,z=no(u.bodyFont),V=Fb(this,"left",u),H=l.x(V),oe=i.y+(C<z.lineHeight?(z.lineHeight-C)/2:0);if(u.usePointStyle){const le={radius:Math.min(T,C)/2,pointStyle:y.pointStyle,rotation:y.rotation,borderWidth:1},we=l.leftForLtr(H,T)+T/2,ve=oe+C/2;t.strokeStyle=u.multiKeyBackground,t.fillStyle=u.multiKeyBackground,yb(t,le,we,ve),t.strokeStyle=m.borderColor,t.fillStyle=m.backgroundColor,yb(t,le,we,ve)}else{t.lineWidth=m.borderWidth||1,t.strokeStyle=m.borderColor,t.setLineDash(m.borderDash||[]),t.lineDashOffset=m.borderDashOffset||0;const le=l.leftForLtr(H,T-A),we=l.leftForLtr(l.xPlus(H,1),T-A-2),ve=hp(m.borderRadius);Object.values(ve).some(Re=>0!==Re)?(t.beginPath(),t.fillStyle=u.multiKeyBackground,ky(t,{x:le,y:oe,w:T,h:C,radius:ve}),t.fill(),t.stroke(),t.fillStyle=m.backgroundColor,t.beginPath(),ky(t,{x:we,y:oe+1,w:T-2,h:C-2,radius:ve}),t.fill()):(t.fillStyle=u.multiKeyBackground,t.fillRect(le,oe,T,C),t.strokeRect(le,oe,T,C),t.fillStyle=m.backgroundColor,t.fillRect(we,oe+1,T-2,C-2))}t.fillStyle=this.labelTextColors[o]}drawBody(t,i,o){const{body:l}=this,{bodySpacing:u,bodyAlign:m,displayColors:y,boxHeight:C,boxWidth:T,boxPadding:A}=o,z=no(o.bodyFont);let V=z.lineHeight,H=0;const X=rg(o.rtl,this.x,this.width),oe=function(Ot){i.fillText(Ot,X.x(t.x+H),t.y+V/2),t.y+=V+u},le=X.textAlign(m);let we,ve,Re,Fe,lt,bt,kt;for(i.textAlign=m,i.textBaseline="middle",i.font=z.string,t.x=Fb(this,le,o),i.fillStyle=o.bodyColor,pi(this.beforeBody,oe),H=y&&"right"!==le?"center"===m?T/2+A:T+2+A:0,Fe=0,bt=l.length;Fe<bt;++Fe){for(we=l[Fe],ve=this.labelTextColors[Fe],i.fillStyle=ve,pi(we.before,oe),Re=we.lines,y&&Re.length&&(this._drawColorBox(i,t,Fe,X,o),V=Math.max(z.lineHeight,C)),lt=0,kt=Re.length;lt<kt;++lt)oe(Re[lt]),V=z.lineHeight;pi(we.after,oe)}H=0,V=z.lineHeight,pi(this.afterBody,oe),t.y-=u}drawFooter(t,i,o){const l=this.footer,u=l.length;let m,y;if(u){const C=rg(o.rtl,this.x,this.width);for(t.x=Fb(this,o.footerAlign,o),t.y+=o.footerMarginTop,i.textAlign=C.textAlign(o.footerAlign),i.textBaseline="middle",m=no(o.footerFont),i.fillStyle=o.footerColor,i.font=m.string,y=0;y<u;++y)i.fillText(l[y],C.x(t.x),t.y+m.lineHeight/2),t.y+=m.lineHeight+o.footerSpacing}}drawBackground(t,i,o,l){const{xAlign:u,yAlign:m}=this,{x:y,y:C}=t,{width:T,height:A}=o,{topLeft:z,topRight:V,bottomLeft:H,bottomRight:X}=hp(l.cornerRadius);i.fillStyle=l.backgroundColor,i.strokeStyle=l.borderColor,i.lineWidth=l.borderWidth,i.beginPath(),i.moveTo(y+z,C),"top"===m&&this.drawCaret(t,i,o,l),i.lineTo(y+T-V,C),i.quadraticCurveTo(y+T,C,y+T,C+V),"center"===m&&"right"===u&&this.drawCaret(t,i,o,l),i.lineTo(y+T,C+A-X),i.quadraticCurveTo(y+T,C+A,y+T-X,C+A),"bottom"===m&&this.drawCaret(t,i,o,l),i.lineTo(y+H,C+A),i.quadraticCurveTo(y,C+A,y,C+A-H),"center"===m&&"left"===u&&this.drawCaret(t,i,o,l),i.lineTo(y,C+z),i.quadraticCurveTo(y,C,y+z,C),i.closePath(),i.fill(),l.borderWidth>0&&i.stroke()}_updateAnimationTarget(t){const i=this.chart,o=this.$animations,l=o&&o.x,u=o&&o.y;if(l||u){const m=$y[t.position].call(this,this._active,this._eventPosition);if(!m)return;const y=this._size=WP(this,t),C=Object.assign({},m,this._size),T=qP(i,t,C),A=ZP(t,C,T,i);(l._to!==A.x||u._to!==A.y)&&(this.xAlign=T.xAlign,this.yAlign=T.yAlign,this.width=y.width,this.height=y.height,this.caretX=m.x,this.caretY=m.y,this._resolveAnimations().update(this,A))}}_willRender(){return!!this.opacity}draw(t){const i=this.options.setContext(this.getContext());let o=this.opacity;if(!o)return;this._updateAnimationTarget(i);const l={width:this.width,height:this.height},u={x:this.x,y:this.y};o=Math.abs(o)<.001?0:o;const m=Qo(i.padding);i.enabled&&(this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length)&&(t.save(),t.globalAlpha=o,this.drawBackground(u,t,l,i),F2(t,i.textDirection),u.y+=m.top,this.drawTitle(u,t,i),this.drawBody(u,t,i),this.drawFooter(u,t,i),z2(t,i.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,i){const o=this._active,l=t.map(({datasetIndex:y,index:C})=>{const T=this.chart.getDatasetMeta(y);if(!T)throw new Error("Cannot find a dataset at index "+y);return{datasetIndex:y,element:T.data[C],index:C}}),u=!cb(o,l),m=this._positionChanged(l,i);(u||m)&&(this._active=l,this._eventPosition=i,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,i,o=!0){if(i&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const l=this.options,u=this._active||[],m=this._getActiveElements(t,u,i,o),y=this._positionChanged(m,t),C=i||!cb(m,u)||y;return C&&(this._active=m,(l.enabled||l.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,i))),C}_getActiveElements(t,i,o,l){const u=this.options;if("mouseout"===t.type)return[];if(!l)return i;const m=this.chart.getElementsAtEventForMode(t,u.mode,u,o);return u.reverse&&m.reverse(),m}_positionChanged(t,i){const{caretX:o,caretY:l,options:u}=this,m=$y[u.position].call(this,t,i);return!1!==m&&(o!==m.x||l!==m.y)}}return e.positioners=$y,e})();var gH={id:"tooltip",_element:KP,positioners:$y,afterInit(e,n,t){t&&(e.tooltip=new KP({chart:e,options:t}))},beforeUpdate(e,n,t){e.tooltip&&e.tooltip.initialize(t)},reset(e,n,t){e.tooltip&&e.tooltip.initialize(t)},afterDraw(e){const n=e.tooltip;if(n&&n._willRender()){const t={tooltip:n};if(!1===e.notifyPlugins("beforeTooltipDraw",t))return;n.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",t)}},afterEvent(e,n){e.tooltip&&e.tooltip.handleEvent(n.event,n.replay,n.inChartArea)&&(n.changed=!0)},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,n)=>n.bodyFont.size,boxWidth:(e,n)=>n.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:Uu,title(e){if(e.length>0){const n=e[0],t=n.chart.data.labels,i=t?t.length:0;if(this&&this.options&&"dataset"===this.options.mode)return n.dataset.label||"";if(n.label)return n.label;if(i>0&&n.dataIndex<i)return t[n.dataIndex]}return""},afterTitle:Uu,beforeBody:Uu,beforeLabel:Uu,label(e){if(this&&this.options&&"dataset"===this.options.mode)return e.label+": "+e.formattedValue||e.formattedValue;let n=e.dataset.label||"";n&&(n+=": ");const t=e.formattedValue;return oi(t)||(n+=t),n},labelColor(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:Uu,afterBody:Uu,beforeFooter:Uu,footer:Uu,afterFooter:Uu}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>"filter"!==e&&"itemSort"!==e&&"external"!==e,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},_H=Object.freeze({__proto__:null,Decimation:F6,Filler:nH,Legend:oH,SubTitle:lH,Title:aH,Tooltip:gH});class zb extends gp{constructor(n){super(n),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(n){const t=this._addedLabels;if(t.length){const i=this.getLabels();for(const{index:o,label:l}of t)i[o]===l&&i.splice(o,1);this._addedLabels=[]}super.init(n)}parse(n,t){if(oi(n))return null;const i=this.getLabels();return t=isFinite(t)&&i[t]===n?t:function vH(e,n,t,i){const o=e.indexOf(n);return-1===o?((e,n,t,i)=>("string"==typeof n?(t=e.push(n)-1,i.unshift({index:t,label:n})):isNaN(n)&&(t=null),t))(e,n,t,i):o!==e.lastIndexOf(n)?t:o}(i,n,Dn(t,n),this._addedLabels),((e,n)=>null===e?null:_o(Math.round(e),0,n))(t,i.length-1)}determineDataLimits(){const{minDefined:n,maxDefined:t}=this.getUserBounds();let{min:i,max:o}=this.getMinMax(!0);"ticks"===this.options.bounds&&(n||(i=0),t||(o=this.getLabels().length-1)),this.min=i,this.max=o}buildTicks(){const n=this.min,t=this.max,i=this.options.offset,o=[];let l=this.getLabels();l=0===n&&t===l.length-1?l:l.slice(n,t+1),this._valueRange=Math.max(l.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let u=n;u<=t;u++)o.push({value:u});return o}getLabelForValue(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(n){return"number"!=typeof n&&(n=this.parse(n)),null===n?NaN:this.getPixelForDecimal((n-this._startValue)/this._valueRange)}getPixelForTick(n){const t=this.ticks;return n<0||n>t.length-1?null:this.getPixelForValue(t[n].value)}getValueForPixel(n){return Math.round(this._startValue+this.getDecimalForPixel(n)*this._valueRange)}getBasePixel(){return this.bottom}}function JP(e,n,{horizontal:t,minRotation:i}){const o=Yl(i),l=(t?Math.sin(o):Math.cos(o))||.001;return Math.min(n/l,.75*n*(""+e).length)}zb.id="category",zb.defaults={ticks:{callback:zb.prototype.getLabelForValue}};class Nb extends gp{constructor(n){super(n),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(n,t){return oi(n)||("number"==typeof n||n instanceof Number)&&!isFinite(+n)?null:+n}handleTickRangeOptions(){const{beginAtZero:n}=this.options,{minDefined:t,maxDefined:i}=this.getUserBounds();let{min:o,max:l}=this;const u=y=>o=t?o:y,m=y=>l=i?l:y;if(n){const y=Uc(o),C=Uc(l);y<0&&C<0?m(0):y>0&&C>0&&u(0)}if(o===l){let y=1;(l>=Number.MAX_SAFE_INTEGER||o<=Number.MIN_SAFE_INTEGER)&&(y=Math.abs(.05*l)),m(l+y),n||u(o-y)}this.min=o,this.max=l}getTickLimit(){const n=this.options.ticks;let o,{maxTicksLimit:t,stepSize:i}=n;return i?(o=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,o>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${o} ticks. Limiting to 1000.`),o=1e3)):(o=this.computeTickLimit(),t=t||11),t&&(o=Math.min(t,o)),o}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const n=this.options,t=n.ticks;let i=this.getTickLimit();i=Math.max(2,i);const u=function bH(e,n){const t=[],{bounds:o,step:l,min:u,max:m,precision:y,count:C,maxTicks:T,maxDigits:A,includeBounds:z}=e,V=l||1,H=T-1,{min:X,max:oe}=n,le=!oi(u),we=!oi(m),ve=!oi(C),Re=(oe-X)/(A+1);let lt,bt,kt,Ot,Fe=i2((oe-X)/H/V)*V;if(Fe<1e-14&&!le&&!we)return[{value:X},{value:oe}];Ot=Math.ceil(oe/Fe)-Math.floor(X/Fe),Ot>H&&(Fe=i2(Ot*Fe/H/V)*V),oi(y)||(lt=Math.pow(10,y),Fe=Math.ceil(Fe*lt)/lt),"ticks"===o?(bt=Math.floor(X/Fe)*Fe,kt=Math.ceil(oe/Fe)*Fe):(bt=X,kt=oe),le&&we&&l&&function r5(e,n){const t=Math.round(e);return t-n<=e&&t+n>=e}((m-u)/l,Fe/1e3)?(Ot=Math.round(Math.min((m-u)/Fe,T)),Fe=(m-u)/Ot,bt=u,kt=m):ve?(bt=le?u:bt,kt=we?m:kt,Ot=C-1,Fe=(kt-bt)/Ot):(Ot=(kt-bt)/Fe,Ot=Dy(Ot,Math.round(Ot),Fe/1e3)?Math.round(Ot):Math.ceil(Ot));const mi=Math.max(o2(Fe),o2(bt));lt=Math.pow(10,oi(y)?mi:y),bt=Math.round(bt*lt)/lt,kt=Math.round(kt*lt)/lt;let Zn=0;for(le&&(z&&bt!==u?(t.push({value:u}),bt<u&&Zn++,Dy(Math.round((bt+Zn*Fe)*lt)/lt,u,JP(u,Re,e))&&Zn++):bt<u&&Zn++);Zn<Ot;++Zn)t.push({value:Math.round((bt+Zn*Fe)*lt)/lt});return we&&z&&kt!==m?t.length&&Dy(t[t.length-1].value,m,JP(m,Re,e))?t[t.length-1].value=m:t.push({value:m}):(!we||kt===m)&&t.push({value:kt}),t}({maxTicks:i,bounds:n.bounds,min:n.min,max:n.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:!1!==t.includeBounds},this._range||this);return"ticks"===n.bounds&&r2(u,this,"value"),n.reverse?(u.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),u}configure(){const n=this.ticks;let t=this.min,i=this.max;if(super.configure(),this.options.offset&&n.length){const o=(i-t)/Math.max(n.length-1,1)/2;t-=o,i+=o}this._startValue=t,this._endValue=i,this._valueRange=i-t}getLabelForValue(n){return Oy(n,this.chart.options.locale,this.options.ticks.format)}}class qE extends Nb{determineDataLimits(){const{min:n,max:t}=this.getMinMax(!0);this.min=Er(n)?n:0,this.max=Er(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const n=this.isHorizontal(),t=n?this.width:this.height,i=Yl(this.options.ticks.minRotation),o=(n?Math.sin(i):Math.cos(i))||.001,l=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,l.lineHeight/o))}getPixelForValue(n){return null===n?NaN:this.getPixelForDecimal((n-this._startValue)/this._valueRange)}getValueForPixel(n){return this._startValue+this.getDecimalForPixel(n)*this._valueRange}}function QP(e){return e/Math.pow(10,Math.floor(rl(e)))==1}qE.id="linear",qE.defaults={ticks:{callback:Sb.formatters.numeric}};class ZE extends gp{constructor(n){super(n),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(n,t){const i=Nb.prototype.parse.apply(this,[n,t]);if(0!==i)return Er(i)&&i>0?i:null;this._zero=!0}determineDataLimits(){const{min:n,max:t}=this.getMinMax(!0);this.min=Er(n)?Math.max(0,n):null,this.max=Er(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:n,maxDefined:t}=this.getUserBounds();let i=this.min,o=this.max;const l=y=>i=n?i:y,u=y=>o=t?o:y,m=(y,C)=>Math.pow(10,Math.floor(rl(y))+C);i===o&&(i<=0?(l(1),u(10)):(l(m(i,-1)),u(m(o,1)))),i<=0&&l(m(o,-1)),o<=0&&u(m(i,1)),this._zero&&this.min!==this._suggestedMin&&i===m(this.min,0)&&l(m(i,-1)),this.min=i,this.max=o}buildTicks(){const n=this.options,i=function wH(e,n){const t=Math.floor(rl(n.max)),i=Math.ceil(n.max/Math.pow(10,t)),o=[];let l=nl(e.min,Math.pow(10,Math.floor(rl(n.min)))),u=Math.floor(rl(l)),m=Math.floor(l/Math.pow(10,u)),y=u<0?Math.pow(10,Math.abs(u)):1;do{o.push({value:l,major:QP(l)}),++m,10===m&&(m=1,++u,y=u>=0?1:y),l=Math.round(m*Math.pow(10,u)*y)/y}while(u<t||u===t&&m<i);const C=nl(e.max,l);return o.push({value:C,major:QP(l)}),o}({min:this._userMin,max:this._userMax},this);return"ticks"===n.bounds&&r2(i,this,"value"),n.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(n){return void 0===n?"0":Oy(n,this.chart.options.locale,this.options.ticks.format)}configure(){const n=this.min;super.configure(),this._startValue=rl(n),this._valueRange=rl(this.max)-rl(n)}getPixelForValue(n){return(void 0===n||0===n)&&(n=this.min),null===n||isNaN(n)?NaN:this.getPixelForDecimal(n===this.min?0:(rl(n)-this._startValue)/this._valueRange)}getValueForPixel(n){const t=this.getDecimalForPixel(n);return Math.pow(10,this._startValue+t*this._valueRange)}}function XE(e){const n=e.ticks;if(n.display&&e.display){const t=Qo(n.backdropPadding);return Dn(n.font&&n.font.size,zn.font.size)+t.height}return 0}function CH(e,n,t){return t=Ai(t)?t:[t],{w:P5(e,n.string,t),h:t.length*n.lineHeight}}function ek(e,n,t,i,o){return e===i||e===o?{start:n-t/2,end:n+t/2}:e<i||e>o?{start:n-t,end:n}:{start:n,end:n+t}}function DH(e,n,t,i,o){const l=Math.abs(Math.sin(t)),u=Math.abs(Math.cos(t));let m=0,y=0;i.start<n.l?(m=(n.l-i.start)/l,e.l=Math.min(e.l,n.l-m)):i.end>n.r&&(m=(i.end-n.r)/l,e.r=Math.max(e.r,n.r+m)),o.start<n.t?(y=(n.t-o.start)/u,e.t=Math.min(e.t,n.t-y)):o.end>n.b&&(y=(o.end-n.b)/u,e.b=Math.max(e.b,n.b+y))}function SH(e){return 0===e||180===e?"center":e<180?"left":"right"}function MH(e,n,t){return"right"===t?e-=n:"center"===t&&(e-=n/2),e}function IH(e,n,t){return 90===t||270===t?e-=n/2:(t>270||t<90)&&(e-=n),e}function tk(e,n,t,i){const{ctx:o}=e;if(t)o.arc(e.xCenter,e.yCenter,n,0,Ei);else{let l=e.getPointPosition(0,n);o.moveTo(l.x,l.y);for(let u=1;u<i;u++)l=e.getPointPosition(u,n),o.lineTo(l.x,l.y)}}ZE.id="logarithmic",ZE.defaults={ticks:{callback:Sb.formatters.logarithmic,major:{enabled:!0}}};class Hy extends Nb{constructor(n){super(n),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const n=this._padding=Qo(XE(this.options)/2),t=this.width=this.maxWidth-n.width,i=this.height=this.maxHeight-n.height;this.xCenter=Math.floor(this.left+t/2+n.left),this.yCenter=Math.floor(this.top+i/2+n.top),this.drawingArea=Math.floor(Math.min(t,i)/2)}determineDataLimits(){const{min:n,max:t}=this.getMinMax(!1);this.min=Er(n)&&!isNaN(n)?n:0,this.max=Er(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/XE(this.options))}generateTickLabels(n){Nb.prototype.generateTickLabels.call(this,n),this._pointLabels=this.getLabels().map((t,i)=>{const o=Pi(this.options.pointLabels.callback,[t,i],this);return o||0===o?o:""}).filter((t,i)=>this.chart.getDataVisibility(i))}fit(){const n=this.options;n.display&&n.pointLabels.display?function EH(e){const n={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},t=Object.assign({},n),i=[],o=[],l=e._pointLabels.length,u=e.options.pointLabels,m=u.centerPointLabels?qi/l:0;for(let y=0;y<l;y++){const C=u.setContext(e.getPointLabelContext(y));o[y]=C.padding;const T=e.getPointPosition(y,e.drawingArea+o[y],m),A=no(C.font),z=CH(e.ctx,A,e._pointLabels[y]);i[y]=z;const V=ba(e.getIndexAngle(y)+m),H=Math.round(pE(V));DH(t,n,V,ek(H,T.x,z.w,0,180),ek(H,T.y,z.h,90,270))}e.setCenterPoint(n.l-t.l,t.r-n.r,n.t-t.t,t.b-n.b),e._pointLabelItems=function TH(e,n,t){const i=[],o=e._pointLabels.length,l=e.options,u=XE(l)/2,m=e.drawingArea,y=l.pointLabels.centerPointLabels?qi/o:0;for(let C=0;C<o;C++){const T=e.getPointPosition(C,m+u+t[C],y),A=Math.round(pE(ba(T.angle+fr))),z=n[C],V=IH(T.y,z.h,A),H=SH(A),X=MH(T.x,z.w,H);i.push({x:T.x,y:V,textAlign:H,left:X,top:V,right:X+z.w,bottom:V+z.h})}return i}(e,i,o)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(n,t,i,o){this.xCenter+=Math.floor((n-t)/2),this.yCenter+=Math.floor((i-o)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(n,t,i,o))}getIndexAngle(n){return ba(n*(Ei/(this._pointLabels.length||1))+Yl(this.options.startAngle||0))}getDistanceFromCenterForValue(n){if(oi(n))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-n)*t:(n-this.min)*t}getValueForDistanceFromCenter(n){if(oi(n))return NaN;const t=n/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(n){const t=this._pointLabels||[];if(n>=0&&n<t.length){const i=t[n];return function kH(e,n,t){return Md(e,{label:t,index:n,type:"pointLabel"})}(this.getContext(),n,i)}}getPointPosition(n,t,i=0){const o=this.getIndexAngle(n)-fr+i;return{x:Math.cos(o)*t+this.xCenter,y:Math.sin(o)*t+this.yCenter,angle:o}}getPointPositionForValue(n,t){return this.getPointPosition(n,this.getDistanceFromCenterForValue(t))}getBasePosition(n){return this.getPointPositionForValue(n||0,this.getBaseValue())}getPointLabelPosition(n){const{left:t,top:i,right:o,bottom:l}=this._pointLabelItems[n];return{left:t,top:i,right:o,bottom:l}}drawBackground(){const{backgroundColor:n,grid:{circular:t}}=this.options;if(n){const i=this.ctx;i.save(),i.beginPath(),tk(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),i.closePath(),i.fillStyle=n,i.fill(),i.restore()}}drawGrid(){const n=this.ctx,t=this.options,{angleLines:i,grid:o}=t,l=this._pointLabels.length;let u,m,y;if(t.pointLabels.display&&function AH(e,n){const{ctx:t,options:{pointLabels:i}}=e;for(let o=n-1;o>=0;o--){const l=i.setContext(e.getPointLabelContext(o)),u=no(l.font),{x:m,y,textAlign:C,left:T,top:A,right:z,bottom:V}=e._pointLabelItems[o],{backdropColor:H}=l;if(!oi(H)){const X=hp(l.borderRadius),oe=Qo(l.backdropPadding);t.fillStyle=H;const le=T-oe.left,we=A-oe.top,ve=z-T+oe.width,Re=V-A+oe.height;Object.values(X).some(Fe=>0!==Fe)?(t.beginPath(),ky(t,{x:le,y:we,w:ve,h:Re,radius:X}),t.fill()):t.fillRect(le,we,ve,Re)}up(t,e._pointLabels[o],m,y+u.lineHeight/2,u,{color:l.color,textAlign:C,textBaseline:"middle"})}}(this,l),o.display&&this.ticks.forEach((C,T)=>{0!==T&&(m=this.getDistanceFromCenterForValue(C.value),function PH(e,n,t,i){const o=e.ctx,l=n.circular,{color:u,lineWidth:m}=n;!l&&!i||!u||!m||t<0||(o.save(),o.strokeStyle=u,o.lineWidth=m,o.setLineDash(n.borderDash),o.lineDashOffset=n.borderDashOffset,o.beginPath(),tk(e,t,l,i),o.closePath(),o.stroke(),o.restore())}(this,o.setContext(this.getContext(T-1)),m,l))}),i.display){for(n.save(),u=l-1;u>=0;u--){const C=i.setContext(this.getPointLabelContext(u)),{color:T,lineWidth:A}=C;!A||!T||(n.lineWidth=A,n.strokeStyle=T,n.setLineDash(C.borderDash),n.lineDashOffset=C.borderDashOffset,m=this.getDistanceFromCenterForValue(t.ticks.reverse?this.min:this.max),y=this.getPointPosition(u,m),n.beginPath(),n.moveTo(this.xCenter,this.yCenter),n.lineTo(y.x,y.y),n.stroke())}n.restore()}}drawBorder(){}drawLabels(){const n=this.ctx,t=this.options,i=t.ticks;if(!i.display)return;const o=this.getIndexAngle(0);let l,u;n.save(),n.translate(this.xCenter,this.yCenter),n.rotate(o),n.textAlign="center",n.textBaseline="middle",this.ticks.forEach((m,y)=>{if(0===y&&!t.reverse)return;const C=i.setContext(this.getContext(y)),T=no(C.font);if(l=this.getDistanceFromCenterForValue(this.ticks[y].value),C.showLabelBackdrop){n.font=T.string,u=n.measureText(m.label).width,n.fillStyle=C.backdropColor;const A=Qo(C.backdropPadding);n.fillRect(-u/2-A.left,-l-T.size/2-A.top,u+A.width,T.size+A.height)}up(n,m.label,0,-l,T,{color:C.color})}),n.restore()}drawTitle(){}}Hy.id="radialLinear",Hy.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Sb.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:e=>e,padding:5,centerPointLabels:!1}},Hy.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},Hy.descriptors={angleLines:{_fallback:"grid"}};const Bb={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Ws=Object.keys(Bb);function RH(e,n){return e-n}function nk(e,n){if(oi(n))return null;const t=e._adapter,{parser:i,round:o,isoWeekday:l}=e._parseOpts;let u=n;return"function"==typeof i&&(u=i(u)),Er(u)||(u="string"==typeof i?t.parse(u,i):t.parse(u)),null===u?null:(o&&(u="week"!==o||!Ey(l)&&!0!==l?t.startOf(u,o):t.startOf(u,"isoWeek",l)),+u)}function ik(e,n,t,i){const o=Ws.length;for(let l=Ws.indexOf(e);l<o-1;++l){const u=Bb[Ws[l]];if(u.common&&Math.ceil((t-n)/((u.steps?u.steps:Number.MAX_SAFE_INTEGER)*u.size))<=i)return Ws[l]}return Ws[o-1]}function rk(e,n,t){if(t){if(t.length){const{lo:i,hi:o}=DE(t,n);e[t[i]>=n?t[i]:t[o]]=!0}}else e[n]=!0}function ok(e,n,t){const i=[],o={},l=n.length;let u,m;for(u=0;u<l;++u)m=n[u],o[m]=u,i.push({value:m,major:!1});return 0!==l&&t?function FH(e,n,t,i){const o=e._adapter,l=+o.startOf(n[0].value,i),u=n[n.length-1].value;let m,y;for(m=l;m<=u;m=+o.add(m,1,i))y=t[m],y>=0&&(n[y].major=!0);return n}(e,i,o,t):i}let YE=(()=>{class e extends gp{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,i){const o=t.time||(t.time={}),l=this._adapter=new i$._date(t.adapters.date);wy(o.displayFormats,l.formats()),this._parseOpts={parser:o.parser,round:o.round,isoWeekday:o.isoWeekday},super.init(t),this._normalized=i.normalized}parse(t,i){return void 0===t?null:nk(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,i=this._adapter,o=t.time.unit||"day";let{min:l,max:u,minDefined:m,maxDefined:y}=this.getUserBounds();function C(T){!m&&!isNaN(T.min)&&(l=Math.min(l,T.min)),!y&&!isNaN(T.max)&&(u=Math.max(u,T.max))}(!m||!y)&&(C(this._getLabelBounds()),("ticks"!==t.bounds||"labels"!==t.ticks.source)&&C(this.getMinMax(!1))),l=Er(l)&&!isNaN(l)?l:+i.startOf(Date.now(),o),u=Er(u)&&!isNaN(u)?u:+i.endOf(Date.now(),o)+1,this.min=Math.min(l,u-1),this.max=Math.max(l+1,u)}_getLabelBounds(){const t=this.getLabelTimestamps();let i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;return t.length&&(i=t[0],o=t[t.length-1]),{min:i,max:o}}buildTicks(){const t=this.options,i=t.time,o=t.ticks,l="labels"===o.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&l.length&&(this.min=this._userMin||l[0],this.max=this._userMax||l[l.length-1]);const u=this.min,y=function U5(e,n,t){let i=0,o=e.length;for(;i<o&&e[i]<n;)i++;for(;o>i&&e[o-1]>t;)o--;return i>0||o<e.length?e.slice(i,o):e}(l,u,this.max);return this._unit=i.unit||(o.autoSkip?ik(i.minUnit,this.min,this.max,this._getLabelCapacity(u)):function OH(e,n,t,i,o){for(let l=Ws.length-1;l>=Ws.indexOf(t);l--){const u=Ws[l];if(Bb[u].common&&e._adapter.diff(o,i,u)>=n-1)return u}return Ws[t?Ws.indexOf(t):0]}(this,y.length,i.minUnit,this.min,this.max)),this._majorUnit=o.major.enabled&&"year"!==this._unit?function LH(e){for(let n=Ws.indexOf(e)+1,t=Ws.length;n<t;++n)if(Bb[Ws[n]].common)return Ws[n]}(this._unit):void 0,this.initOffsets(l),t.reverse&&y.reverse(),ok(this,y,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t){let l,u,i=0,o=0;this.options.offset&&t.length&&(l=this.getDecimalForValue(t[0]),i=1===t.length?1-l:(this.getDecimalForValue(t[1])-l)/2,u=this.getDecimalForValue(t[t.length-1]),o=1===t.length?u:(u-this.getDecimalForValue(t[t.length-2]))/2);const m=t.length<3?.5:.25;i=_o(i,0,m),o=_o(o,0,m),this._offsets={start:i,end:o,factor:1/(i+1+o)}}_generate(){const t=this._adapter,i=this.min,o=this.max,l=this.options,u=l.time,m=u.unit||ik(u.minUnit,i,o,this._getLabelCapacity(i)),y=Dn(u.stepSize,1),C="week"===m&&u.isoWeekday,T=Ey(C)||!0===C,A={};let V,H,z=i;if(T&&(z=+t.startOf(z,"isoWeek",C)),z=+t.startOf(z,T?"day":m),t.diff(o,i,m)>1e5*y)throw new Error(i+" and "+o+" are too far apart with stepSize of "+y+" "+m);const X="data"===l.ticks.source&&this.getDataTimestamps();for(V=z,H=0;V<o;V=+t.add(V,y,m),H++)rk(A,V,X);return(V===o||"ticks"===l.bounds||1===H)&&rk(A,V,X),Object.keys(A).sort((oe,le)=>oe-le).map(oe=>+oe)}getLabelForValue(t){const o=this.options.time;return this._adapter.format(t,o.tooltipFormat?o.tooltipFormat:o.displayFormats.datetime)}_tickFormatFunction(t,i,o,l){const u=this.options,m=u.time.displayFormats,y=this._unit,C=this._majorUnit,A=C&&m[C],z=o[i],H=this._adapter.format(t,l||(C&&A&&z&&z.major?A:y&&m[y])),X=u.ticks.callback;return X?Pi(X,[H,i,o],this):H}generateTickLabels(t){let i,o,l;for(i=0,o=t.length;i<o;++i)l=t[i],l.label=this._tickFormatFunction(l.value,i,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const i=this._offsets,o=this.getDecimalForValue(t);return this.getPixelForDecimal((i.start+o)*i.factor)}getValueForPixel(t){const i=this._offsets,o=this.getDecimalForPixel(t)/i.factor-i.end;return this.min+o*(this.max-this.min)}_getLabelSize(t){const i=this.options.ticks,o=this.ctx.measureText(t).width,l=Yl(this.isHorizontal()?i.maxRotation:i.minRotation),u=Math.cos(l),m=Math.sin(l),y=this._resolveTickFontOptions(0).size;return{w:o*u+y*m,h:o*m+y*u}}_getLabelCapacity(t){const i=this.options.time,o=i.displayFormats,l=o[i.unit]||o.millisecond,u=this._tickFormatFunction(t,0,ok(this,[t],this._majorUnit),l),m=this._getLabelSize(u),y=Math.floor(this.isHorizontal()?this.width/m.w:this.height/m.h)-1;return y>0?y:1}getDataTimestamps(){let i,o,t=this._cache.data||[];if(t.length)return t;const l=this.getMatchingVisibleMetas();if(this._normalized&&l.length)return this._cache.data=l[0].controller.getAllParsedValues(this);for(i=0,o=l.length;i<o;++i)t=t.concat(l[i].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let i,o;if(t.length)return t;const l=this.getLabels();for(i=0,o=l.length;i<o;++i)t.push(nk(this,l[i]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return C2(t.sort(RH))}}return e.id="time",e.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}},e})();function Vb(e,n,t){let l,u,m,y,i=0,o=e.length-1;t?(n>=e[i].pos&&n<=e[o].pos&&({lo:i,hi:o}=Gu(e,"pos",n)),({pos:l,time:m}=e[i]),({pos:u,time:y}=e[o])):(n>=e[i].time&&n<=e[o].time&&({lo:i,hi:o}=Gu(e,"time",n)),({time:l,pos:m}=e[i]),({time:u,pos:y}=e[o]));const C=u-l;return C?m+(y-m)*(n-l)/C:m}class KE extends YE{constructor(n){super(n),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const n=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(n);this._minPos=Vb(t,this.min),this._tableRange=Vb(t,this.max)-this._minPos,super.initOffsets(n)}buildLookupTable(n){const{min:t,max:i}=this,o=[],l=[];let u,m,y,C,T;for(u=0,m=n.length;u<m;++u)C=n[u],C>=t&&C<=i&&o.push(C);if(o.length<2)return[{time:t,pos:0},{time:i,pos:1}];for(u=0,m=o.length;u<m;++u)T=o[u+1],y=o[u-1],C=o[u],Math.round((T+y)/2)!==C&&l.push({time:C,pos:u/(m-1)});return l}_getTimestampsForTable(){let n=this._cache.all||[];if(n.length)return n;const t=this.getDataTimestamps(),i=this.getLabelTimestamps();return n=t.length&&i.length?this.normalize(t.concat(i)):t.length?t:i,n=this._cache.all=n,n}getDecimalForValue(n){return(Vb(this._table,n)-this._minPos)/this._tableRange}getValueForPixel(n){const t=this._offsets,i=this.getDecimalForPixel(n)/t.factor-t.end;return Vb(this._table,i*this._tableRange+this._minPos,!0)}}KE.id="timeseries",KE.defaults=YE.defaults;const NH=[n$,k6,_H,Object.freeze({__proto__:null,CategoryScale:zb,LinearScale:qE,LogarithmicScale:ZE,RadialLinearScale:Hy,TimeScale:YE,TimeSeriesScale:KE})];function sk(e,n=rs){return e=e??BH,gi((t,i)=>{let o,l=!0;t.subscribe(Yn(i,u=>{const m=n(u);(l||!e(o,m))&&(l=!1,o=m,i.next(u))}))})}function BH(e,n){return e===n}const jb=function UH(e,n){return e===n||e!=e&&n!=n},Ub=function $H(e,n){for(var t=e.length;t--;)if(jb(e[t][0],n))return t;return-1};var GH=Array.prototype.splice;function ag(e){var n=-1,t=null==e?0:e.length;for(this.clear();++n<t;){var i=e[n];this.set(i[0],i[1])}}ag.prototype.clear=function VH(){this.__data__=[],this.size=0},ag.prototype.delete=function WH(e){var n=this.__data__,t=Ub(n,e);return!(t<0||(t==n.length-1?n.pop():GH.call(n,t,1),--this.size,0))},ag.prototype.get=function ZH(e){var n=this.__data__,t=Ub(n,e);return t<0?void 0:n[t][1]},ag.prototype.has=function YH(e){return Ub(this.__data__,e)>-1},ag.prototype.set=function JH(e,n){var t=this.__data__,i=Ub(t,e);return i<0?(++this.size,t.push([e,n])):t[i][1]=n,this};const $b=ag,ak="object"==typeof global&&global&&global.Object===Object&&global;var c8="object"==typeof self&&self&&self.Object===Object&&self;const lg=ak||c8||Function("return this")();var h8=lg.Symbol,lk=Object.prototype,d8=lk.hasOwnProperty,f8=lk.toString,Gy=h8?h8.toStringTag:void 0;var _8=Object.prototype.toString;var ck=h8?h8.toStringTag:void 0;const Gb=function w8(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ck&&ck in Object(e)?function p8(e){var n=d8.call(e,Gy),t=e[Gy];try{e[Gy]=void 0;var i=!0}catch{}var o=f8.call(e);return i&&(n?e[Gy]=t:delete e[Gy]),o}(e):function y8(e){return _8.call(e)}(e)},_p=function C8(e){var n=typeof e;return null!=e&&("object"==n||"function"==n)};const JE=function M8(e){if(!_p(e))return!1;var n=Gb(e);return"[object Function]"==n||"[object GeneratorFunction]"==n||"[object AsyncFunction]"==n||"[object Proxy]"==n};var e,I8=lg["__core-js_shared__"],uk=(e=/[^.]+$/.exec(I8&&I8.keys&&I8.keys.IE_PROTO||""))?"Symbol(src)_1."+e:"";var R8=Function.prototype.toString;var z8=/^\[object .+?Constructor\]$/,U8=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const H8=function $8(e){return!(!_p(e)||function A8(e){return!!uk&&uk in e}(e))&&(JE(e)?U8:z8).test(function O8(e){if(null!=e){try{return R8.call(e)}catch{}try{return e+""}catch{}}return""}(e))},eD=function q8(e,n){var t=function G8(e,n){return e?.[n]}(e,n);return H8(t)?t:void 0},hk=eD(lg,"Map"),Wy=eD(Object,"create");var nG=Object.prototype.hasOwnProperty;var sG=Object.prototype.hasOwnProperty;function cg(e){var n=-1,t=null==e?0:e.length;for(this.clear();++n<t;){var i=e[n];this.set(i[0],i[1])}}cg.prototype.clear=function Y8(){this.__data__=Wy?Wy(null):{},this.size=0},cg.prototype.delete=function J8(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n},cg.prototype.get=function iG(e){var n=this.__data__;if(Wy){var t=n[e];return"__lodash_hash_undefined__"===t?void 0:t}return nG.call(n,e)?n[e]:void 0},cg.prototype.has=function aG(e){var n=this.__data__;return Wy?void 0!==n[e]:sG.call(n,e)},cg.prototype.set=function uG(e,n){var t=this.__data__;return this.size+=this.has(e)?0:1,t[e]=Wy&&void 0===n?"__lodash_hash_undefined__":n,this};const dk=cg,Wb=function gG(e,n){var t=e.__data__;return function pG(e){var n=typeof e;return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==e:null===e}(n)?t["string"==typeof n?"string":"hash"]:t.map};function ug(e){var n=-1,t=null==e?0:e.length;for(this.clear();++n<t;){var i=e[n];this.set(i[0],i[1])}}ug.prototype.clear=function dG(){this.size=0,this.__data__={hash:new dk,map:new(hk||$b),string:new dk}},ug.prototype.delete=function _G(e){var n=Wb(this,e).delete(e);return this.size-=n?1:0,n},ug.prototype.get=function vG(e){return Wb(this,e).get(e)},ug.prototype.has=function bG(e){return Wb(this,e).has(e)},ug.prototype.set=function CG(e,n){var t=Wb(this,e),i=t.size;return t.set(e,n),this.size+=t.size==i?0:1,this};const DG=ug;function hg(e){var n=this.__data__=new $b(e);this.size=n.size}hg.prototype.clear=function e8(){this.__data__=new $b,this.size=0},hg.prototype.delete=function n8(e){var n=this.__data__,t=n.delete(e);return this.size=n.size,t},hg.prototype.get=function r8(e){return this.__data__.get(e)},hg.prototype.has=function s8(e){return this.__data__.has(e)},hg.prototype.set=function SG(e,n){var t=this.__data__;if(t instanceof $b){var i=t.__data__;if(!hk||i.length<199)return i.push([e,n]),this.size=++t.size,this;t=this.__data__=new DG(i)}return t.set(e,n),this.size=t.size,this};const IG=hg;var AG=function(){try{var e=eD(Object,"defineProperty");return e({},"",{}),e}catch{}}();const qb=AG,tD=function PG(e,n,t){"__proto__"==n&&qb?qb(e,n,{configurable:!0,enumerable:!0,value:t,writable:!0}):e[n]=t},nD=function kG(e,n,t){(void 0!==t&&!jb(e[n],t)||void 0===t&&!(n in e))&&tD(e,n,t)};var OG=function RG(e){return function(n,t,i){for(var o=-1,l=Object(n),u=i(n),m=u.length;m--;){var y=u[e?m:++o];if(!1===t(l[y],y,l))break}return n}}();const LG=OG;var fk="object"==typeof exports&&exports&&!exports.nodeType&&exports,pk=fk&&"object"==typeof module&&module&&!module.nodeType&&module,mk=pk&&pk.exports===fk?lg.Buffer:void 0,gk=mk?mk.allocUnsafe:void 0;const _k=lg.Uint8Array,$G=function UG(e,n){var t=n?function VG(e){var n=new e.constructor(e.byteLength);return new _k(n).set(new _k(e)),n}(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.length)};var yk=Object.create,WG=function(){function e(){}return function(n){if(!_p(n))return{};if(yk)return yk(n);e.prototype=n;var t=new e;return e.prototype=void 0,t}}();const qG=WG;var XG=function ZG(e,n){return function(t){return e(n(t))}}(Object.getPrototypeOf,Object);const vk=XG;var YG=Object.prototype;const xk=function KG(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||YG)},qy=function eW(e){return null!=e&&"object"==typeof e};const bk=function nW(e){return qy(e)&&"[object Arguments]"==Gb(e)};var wk=Object.prototype,iW=wk.hasOwnProperty,rW=wk.propertyIsEnumerable,oW=bk(function(){return arguments}())?bk:function(e){return qy(e)&&iW.call(e,"callee")&&!rW.call(e,"callee")};const iD=oW,rD=Array.isArray;const Ck=function lW(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},oD=function cW(e){return null!=e&&Ck(e.length)&&!JE(e)};var Ek="object"==typeof exports&&exports&&!exports.nodeType&&exports,Dk=Ek&&"object"==typeof module&&module&&!module.nodeType&&module,Tk=Dk&&Dk.exports===Ek?lg.Buffer:void 0;const Sk=(Tk?Tk.isBuffer:void 0)||function dW(){return!1};var Mk=Function.prototype.toString,xW=Object.prototype.hasOwnProperty,bW=Mk.call(Object);var Vi={};Vi["[object Float32Array]"]=Vi["[object Float64Array]"]=Vi["[object Int8Array]"]=Vi["[object Int16Array]"]=Vi["[object Int32Array]"]=Vi["[object Uint8Array]"]=Vi["[object Uint8ClampedArray]"]=Vi["[object Uint16Array]"]=Vi["[object Uint32Array]"]=!0,Vi["[object Arguments]"]=Vi["[object Array]"]=Vi["[object ArrayBuffer]"]=Vi["[object Boolean]"]=Vi["[object DataView]"]=Vi["[object Date]"]=Vi["[object Error]"]=Vi["[object Function]"]=Vi["[object Map]"]=Vi["[object Number]"]=Vi["[object Object]"]=Vi["[object RegExp]"]=Vi["[object Set]"]=Vi["[object String]"]=Vi["[object WeakMap]"]=!1;var Ik="object"==typeof exports&&exports&&!exports.nodeType&&exports,Zy=Ik&&"object"==typeof module&&module&&!module.nodeType&&module,sD=Zy&&Zy.exports===Ik&&ak.process,QW=function(){try{return Zy&&Zy.require&&Zy.require("util").types||sD&&sD.binding&&sD.binding("util")}catch{}}(),Pk=QW&&QW.isTypedArray;const kk=Pk?function YW(e){return function(n){return e(n)}}(Pk):function ZW(e){return qy(e)&&Ck(e.length)&&!!Vi[Gb(e)]},aD=function tq(e,n){if(("constructor"!==n||"function"!=typeof e[n])&&"__proto__"!=n)return e[n]};var iq=Object.prototype.hasOwnProperty;const oq=function rq(e,n,t){var i=e[n];(!iq.call(e,n)||!jb(i,t)||void 0===t&&!(n in e))&&tD(e,n,t)};var hq=/^(?:0|[1-9]\d*)$/;const Rk=function dq(e,n){var t=typeof e;return!!(n=n??9007199254740991)&&("number"==t||"symbol"!=t&&hq.test(e))&&e>-1&&e%1==0&&e<n};var pq=Object.prototype.hasOwnProperty;const gq=function mq(e,n){var t=rD(e),i=!t&&iD(e),o=!t&&!i&&Sk(e),l=!t&&!i&&!o&&kk(e),u=t||i||o||l,m=u?function lq(e,n){for(var t=-1,i=Array(e);++t<e;)i[t]=n(t);return i}(e.length,String):[],y=m.length;for(var C in e)(n||pq.call(e,C))&&(!u||!("length"==C||o&&("offset"==C||"parent"==C)||l&&("buffer"==C||"byteLength"==C||"byteOffset"==C)||Rk(C,y)))&&m.push(C);return m};var xq=Object.prototype.hasOwnProperty;const wq=function bq(e){if(!_p(e))return function _q(e){var n=[];if(null!=e)for(var t in Object(e))n.push(t);return n}(e);var n=xk(e),t=[];for(var i in e)"constructor"==i&&(n||!xq.call(e,i))||t.push(i);return t},Ok=function Cq(e){return oD(e)?gq(e,!0):wq(e)},Dq=function Eq(e){return function sq(e,n,t,i){var o=!t;t||(t={});for(var l=-1,u=n.length;++l<u;){var m=n[l],y=i?i(t[m],e[m],m,t,e):void 0;void 0===y&&(y=e[m]),o?tD(t,m,y):oq(t,m,y)}return t}(e,Ok(e))},Sq=function Tq(e,n,t,i,o,l,u){var m=aD(e,t),y=aD(n,t),C=u.get(y);if(C)nD(e,t,C);else{var T=l?l(m,y,t+"",e,n,u):void 0,A=void 0===T;if(A){var z=rD(y),V=!z&&Sk(y),H=!z&&!V&&kk(y);T=y,z||V||H?rD(m)?T=m:function uW(e){return qy(e)&&oD(e)}(m)?T=function HG(e,n){var t=-1,i=e.length;for(n||(n=Array(i));++t<i;)n[t]=e[t];return n}(m):V?(A=!1,T=function zG(e,n){if(n)return e.slice();var t=e.length,i=gk?gk(t):new e.constructor(t);return e.copy(i),i}(y,!0)):H?(A=!1,T=$G(y,!0)):T=[]:function wW(e){if(!qy(e)||"[object Object]"!=Gb(e))return!1;var n=vk(e);if(null===n)return!0;var t=xW.call(n,"constructor")&&n.constructor;return"function"==typeof t&&t instanceof t&&Mk.call(t)==bW}(y)||iD(y)?(T=m,iD(m)?T=Dq(m):(!_p(m)||JE(m))&&(T=function JG(e){return"function"!=typeof e.constructor||xk(e)?{}:qG(vk(e))}(y))):A=!1}A&&(u.set(y,T),o(T,y,i,l,u),u.delete(y)),nD(e,t,T)}},Mq=function Lk(e,n,t,i,o){e!==n&&LG(n,function(l,u){if(o||(o=new IG),_p(l))Sq(e,n,u,t,Lk,i,o);else{var m=i?i(aD(e,u),l,u+"",e,n,o):void 0;void 0===m&&(m=l),nD(e,u,m)}},Ok)},Fk=function Iq(e){return e},Pq=function Aq(e,n,t){switch(t.length){case 0:return e.call(n);case 1:return e.call(n,t[0]);case 2:return e.call(n,t[0],t[1]);case 3:return e.call(n,t[0],t[1],t[2])}return e.apply(n,t)};var zk=Math.max;const Lq=function Oq(e){return function(){return e}};var Fq=qb?function(e,n){return qb(e,"toString",{configurable:!0,enumerable:!1,value:Lq(n),writable:!0})}:Fk,Nq=800,Bq=16,Vq=Date.now,Uq=function jq(e){var n=0,t=0;return function(){var i=Vq(),o=Bq-(i-t);if(t=i,o>0){if(++n>=Nq)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}(Fq);const $q=Uq,Gq=function Hq(e,n){return $q(function kq(e,n,t){return n=zk(void 0===n?e.length-1:n,0),function(){for(var i=arguments,o=-1,l=zk(i.length-n,0),u=Array(l);++o<l;)u[o]=i[n+o];o=-1;for(var m=Array(n+1);++o<n;)m[o]=i[o];return m[n]=t(u),Pq(e,this,m)}}(e,n,Fk),e+"")};var Xq=function Zq(e){return Gq(function(n,t){var i=-1,o=t.length,l=o>1?t[o-1]:void 0,u=o>2?t[2]:void 0;for(l=e.length>3&&"function"==typeof l?(o--,l):void 0,u&&function Wq(e,n,t){if(!_p(t))return!1;var i=typeof n;return!!("number"==i?oD(t)&&Rk(n,t.length):"string"==i&&n in t)&&jb(t[n],e)}(t[0],t[1],u)&&(l=o<3?void 0:l,o=1),n=Object(n);++i<o;){var m=t[i];m&&e(n,m,i,l)}return n})}(function(e,n,t){Mq(e,n,t)});const Nk=Xq;let Yq=(()=>{class e{constructor(){this.colorschemesOptions=new va(void 0)}setColorschemesOptions(t){this.pColorschemesOptions=t,this.colorschemesOptions.next(t)}getColorschemesOptions(){return this.pColorschemesOptions}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Kq=(()=>{class e{constructor(t,i,o){this.zone=i,this.themeService=o,this.type="bar",this.plugins=[],this.chartClick=new Mi,this.chartHover=new Mi,this.subs=[],this.ctx=t.nativeElement.getContext("2d"),this.subs.push(this.themeService.colorschemesOptions.pipe(sk()).subscribe(l=>this.themeChanged(l)))}ngOnChanges(t){const i=["type"],o=Object.getOwnPropertyNames(t);if(o.some(l=>i.includes(l))||o.every(l=>t[l].isFirstChange()))this.render();else{const l=this.getChartConfiguration();this.chart&&(Object.assign(this.chart.config.data,l.data),this.chart.config.plugins&&Object.assign(this.chart.config.plugins,l.plugins),this.chart.config.options&&Object.assign(this.chart.config.options,l.options)),this.update()}}ngOnDestroy(){this.chart&&(this.chart.destroy(),this.chart=void 0),this.subs.forEach(t=>t.unsubscribe())}render(){return this.chart&&this.chart.destroy(),og.register(...this.plugins),this.zone.runOutsideAngular(()=>this.chart=new og(this.ctx,this.getChartConfiguration()))}update(t){this.chart&&this.zone.runOutsideAngular(()=>this.chart?.update(t))}hideDataset(t,i){this.chart&&(this.chart.getDatasetMeta(t).hidden=i,this.update())}isDatasetHidden(t){return this.chart?.getDatasetMeta(t)?.hidden}toBase64Image(){return this.chart?.toBase64Image()}themeChanged(t){this.themeOverrides=t,this.chart&&(this.chart.config.options&&Object.assign(this.chart.config.options,this.getChartOptions()),this.update())}getChartOptions(){return Nk({onHover:(t,i)=>{!this.chartHover.observed&&!this.chartHover.observers?.length||this.zone.run(()=>this.chartHover.emit({event:t,active:i}))},onClick:(t,i)=>{!this.chartClick.observed&&!this.chartClick.observers?.length||this.zone.run(()=>this.chartClick.emit({event:t,active:i}))}},this.themeOverrides,this.options,{plugins:{legend:{display:this.legend}}})}getChartConfiguration(){return{type:this.type,data:this.getChartData(),options:this.getChartOptions()}}getChartData(){return this.data?this.data:{labels:this.labels||[],datasets:this.datasets||[]}}}return e.\u0275fac=function(t){return new(t||e)(Qe(Ao),Qe(ir),Qe(Yq))},e.\u0275dir=Ft({type:e,selectors:[["canvas","baseChart",""]],inputs:{type:"type",legend:"legend",data:"data",options:"options",plugins:"plugins",labels:"labels",datasets:"datasets"},outputs:{chartClick:"chartClick",chartHover:"chartHover"},exportAs:["base-chart"],features:[Wr]}),e})();const Jq=[[255,99,132],[54,162,235],[255,206,86],[231,233,237],[75,192,192],[151,187,205],[220,220,220],[247,70,74],[70,191,189],[253,180,92],[148,159,177],[77,83,96]],Qq={datasets:{line:{backgroundColor:e=>bs(ws(e.datasetIndex),.4),borderColor:e=>bs(ws(e.datasetIndex),1),pointBackgroundColor:e=>bs(ws(e.datasetIndex),1),pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:e=>bs(ws(e.datasetIndex),.8)},bar:{backgroundColor:e=>bs(ws(e.datasetIndex),.6),borderColor:e=>bs(ws(e.datasetIndex),1),hoverBackgroundColor:e=>bs(ws(e.datasetIndex),.8),hoverBorderColor:e=>bs(ws(e.datasetIndex),1)},get radar(){return this.line},doughnut:{backgroundColor:e=>bs(ws(e.dataIndex),.6),borderColor:"#fff",hoverBackgroundColor:e=>bs(ws(e.dataIndex),1),hoverBorderColor:e=>bs(ws(e.dataIndex),1)},get pie(){return this.doughnut},polarArea:{backgroundColor:e=>bs(ws(e.dataIndex),.6),borderColor:e=>bs(ws(e.dataIndex),1),hoverBackgroundColor:e=>bs(ws(e.dataIndex),.8),hoverBorderColor:e=>bs(ws(e.dataIndex),1)},get bubble(){return this.doughnut},get scatter(){return this.doughnut},get area(){return this.polarArea}}};function bs(e,n){return"rgba("+e.concat(n).join(",")+")"}function lD(e,n){return Math.floor(Math.random()*(n-e+1))+e}function ws(e=0){return Jq[e]||function e9(){return[lD(0,255),lD(0,255),lD(0,255)]}()}let Bk=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();og.register(...NH);let t9=(()=>{class e{constructor(t){t?.plugins&&og.register(...t?.plugins);const i=Nk(Qq,t?.defaults||{});zn.set(i)}static forRoot(t){return{ngModule:e,providers:[{provide:Bk,useValue:t}]}}}return e.\u0275fac=function(t){return new(t||e)(Dt(Bk,8))},e.\u0275mod=ar({type:e}),e.\u0275inj=Ui({imports:[[]]}),e})();var Vk=Ku(898);let jk=(()=>{class e{constructor(t){this.data=t}ngOnInit(){this.getSettings(),this.map=new Vk.Map({accessToken:"pk.eyJ1IjoidnVxYXJhaG1hZGxpIiwiYSI6ImNsbnFzbjhvbzEwc2Uya29jbHZjZjl4MTcifQ.34q-bkR2bTN0BHb2FXAIzQ",container:"map",style:"mapbox://styles/mapbox/satellite-streets-v12",center:[28.858942999999787,41.11145899999985],zoom:8.5});let t=!1;this.map.on("load",()=>{this.json.features.forEach((i,o)=>{t=!t,this.map.addSource("maine"+o,{type:"geojson",data:i}),this.map.addLayer({id:"maine"+o,type:"fill",source:"maine"+o,layout:{},paint:{"fill-color":t?"#e69d00":"#e1ff00","fill-opacity":.7}})})})}getSettings(){this.data.getist("istanbul-nufus-geojson.geojson").subscribe(t=>{this.json=t})}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(eg))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-map"]],decls:1,vars:0,consts:[["id","map",1,"match-parent"]],template:function(i,o){1&i&&Xt(0,"div",0)},styles:[".match-parent[_ngcontent-%COMP%]{width:100%;height:100%}"]})}return e})();function n9(e,n){if(1&e&&(ft(0,"div",6)(1,"div"),si(2),gt(),Xt(3,"canvas",9),gt()),2&e){const t=go();Rt(2),zc(" ",t.bardsc.title," "),Rt(1),xt("data",t.barChartDataD)("options",t.barChartOptions)("plugins",t.barChartPlugins)("legend",t.barChartLegend)("type","bar")}}function i9(e,n){if(1&e&&(ft(0,"div",6)(1,"div"),si(2),gt(),Xt(3,"canvas",9),gt()),2&e){const t=go();Rt(2),zc(" ",t.barasc.title," "),Rt(1),xt("data",t.barChartData)("options",t.barChartOptions)("plugins",t.barChartPlugins)("legend",t.barChartLegend)("type","bar")}}function r9(e,n){if(1&e&&(ft(0,"div",6)(1,"div"),si(2),gt(),Xt(3,"canvas",10),gt()),2&e){const t=go();Rt(2),zc(" ",t.pie.title," "),Rt(1),xt("type","pie")("datasets",t.pieChartDatasets)("labels",t.pieChartLabels)("options",t.pieChartOptions)("plugins",t.pieChartPlugins)("legend",t.pieChartLegend)}}function o9(e,n){if(1&e&&(ft(0,"div"),si(1),gt()),2&e){const t=go();Rt(1),zc(" ",t.AllData.title," ")}}function s9(e,n){if(1&e&&(ft(0,"th"),si(1),gt()),2&e){const t=n.$implicit;nx("width","answer"==t.field?"300px":""),Rt(1),Ro(t.title)}}function a9(e,n){if(1&e&&(ft(0,"tr")(1,"td"),si(2),gt(),ft(3,"td"),si(4),gt(),ft(5,"td"),si(6),gt()()),2&e){const t=n.$implicit;Rt(2),Ro(t.id),Rt(2),Ro(t.label),Rt(2),Ro(t.answer)}}let l9=(()=>{class e{ngAfterViewInit(){}constructor(t){this.data=t,this.pieChartOptions={responsive:!1},this.pieChartLegend=!0,this.pieChartPlugins=[],this.barChartLegend=!0,this.barChartPlugins=[],this.barChartOptions={responsive:!1}}ngOnInit(){this.getpie(),this.getbarasc(),this.getbardsc(),this.gettable()}getpie(){this.data.getpie("./../../assets/data/3-item-view/all-pie-chart.json").subscribe(t=>{this.pie=t,this.pieChartLabels=this.pie.data.map(i=>i.label),this.pieChartDatasets=[{data:this.pie.data.map(i=>i.vote)}]})}gettable(){this.data.getpie("./../../assets/data/3-item-view/list-of-results.json").subscribe(t=>{this.AllData=t})}getbarasc(){this.data.getpie("./../../assets/data/3-item-view/top-10-ascending.json").subscribe(t=>{this.barasc=t,this.barChartData={labels:this.barasc.data.map(i=>i.label),datasets:[{data:this.barasc.data.map(i=>i.vote),label:"",backgroundColor:["green","green"]}]}})}getbardsc(){this.data.getpie("./../../assets/data/3-item-view/top-10-desc.json").subscribe(t=>{this.bardsc=t,this.barChartDataD={labels:this.bardsc.data.map(i=>i.label),datasets:[{data:this.bardsc.data.map(i=>i.vote),label:"",backgroundColor:["red","red"]}]}})}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(eg))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-item-details"]],decls:13,vars:6,consts:[[1,"detail"],[1,"left"],[2,"width","100%","height","100%"],[1,"right"],["class","title",4,"ngIf"],[4,"ngIf"],[1,"title"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["baseChart","",1,"c2",3,"data","options","plugins","legend","type"],["baseChart","",1,"c1",3,"type","datasets","labels","options","plugins","legend"]],template:function(i,o){1&i&&(ft(0,"div",0)(1,"div",1),Xt(2,"app-map",2),gt(),ft(3,"div",3),qt(4,n9,4,6,"div",4),qt(5,i9,4,6,"div",4),qt(6,r9,4,7,"div",4),qt(7,o9,2,1,"div",5),ft(8,"div",6)(9,"table")(10,"tr"),qt(11,s9,2,3,"th",7),gt(),qt(12,a9,7,3,"tr",8),gt()()()()),2&i&&(Rt(4),xt("ngIf",o.bardsc),Rt(1),xt("ngIf",o.barasc),Rt(1),xt("ngIf",o.pie),Rt(1),xt("ngIf",o.AllData),Rt(4),xt("ngForOf",null==o.AllData?null:o.AllData.columns),Rt(1),xt("ngForOf",null==o.AllData?null:o.AllData.data))},dependencies:[Vm,J_,Kq,jk],styles:[".detail[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden!important;width:100%;height:100%;display:flex;justify-content:space-between;padding:10px}.right[_ngcontent-%COMP%], .left[_ngcontent-%COMP%]{box-sizing:border-box;height:calc(100% - 20px);background-color:#191c1d;border-radius:8px}.right[_ngcontent-%COMP%]{width:calc(30% - 10px);height:100%;padding:15px;display:flex;flex-direction:column;overflow-y:scroll}.left[_ngcontent-%COMP%]{width:calc(70% - 10px);height:100%;border:3px solid rgb(22,22,22)}.map-container[_ngcontent-%COMP%]{width:100%;height:100%}.c1[_ngcontent-%COMP%]{margin-top:4px;padding:20px;width:100%;height:100%;background-color:#101213;border-radius:5px}.c2[_ngcontent-%COMP%]{margin-top:4px;padding:5px;width:100%;background-color:#101213;border-radius:5px}.title[_ngcontent-%COMP%]{margin-bottom:5px}.right[_ngcontent-%COMP%]::-webkit-scrollbar{width:10px}.right[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#101213}.right[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#3f3e3e}.right[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:13px;padding-left:10px}"]})}return e})(),Uk=(()=>{class e{constructor(t,i){this._renderer=t,this._elementRef=i,this.onChange=o=>{},this.onTouched=()=>{}}setProperty(t,i){this._renderer.setProperty(this._elementRef.nativeElement,t,i)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return e.\u0275fac=function(t){return new(t||e)(Qe(jl),Qe(Ao))},e.\u0275dir=Ft({type:e}),e})(),yp=(()=>{class e extends Uk{}return e.\u0275fac=function(){let n;return function(i){return(n||(n=Xr(e)))(i||e)}}(),e.\u0275dir=Ft({type:e,features:[ri]}),e})();const Hc=new Mt("NgValueAccessor"),h9={provide:Hc,useExisting:Hn(()=>Zb),multi:!0},f9=new Mt("CompositionEventMode");let Zb=(()=>{class e extends Uk{constructor(t,i,o){super(t,i),this._compositionMode=o,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function d9(){const e=zu()?zu().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return e.\u0275fac=function(t){return new(t||e)(Qe(jl),Qe(Ao),Qe(f9,8))},e.\u0275dir=Ft({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,i){1&t&&Un("input",function(l){return i._handleInput(l.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(l){return i._compositionEnd(l.target.value)})},features:[Wi([h9]),ri]}),e})();const p9=!1;function Pd(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function Hk(e){return null!=e&&"number"==typeof e.length}const ts=new Mt("NgValidators"),kd=new Mt("NgAsyncValidators"),m9=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class g9{static min(n){return function Gk(e){return n=>{if(Pd(n.value)||Pd(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t<e?{min:{min:e,actual:n.value}}:null}}(n)}static max(n){return function Wk(e){return n=>{if(Pd(n.value)||Pd(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t>e?{max:{max:e,actual:n.value}}:null}}(n)}static required(n){return function qk(e){return Pd(e.value)?{required:!0}:null}(n)}static requiredTrue(n){return function Zk(e){return!0===e.value?null:{required:!0}}(n)}static email(n){return function Xk(e){return Pd(e.value)||m9.test(e.value)?null:{email:!0}}(n)}static minLength(n){return function Yk(e){return n=>Pd(n.value)||!Hk(n.value)?null:n.value.length<e?{minlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static maxLength(n){return function Kk(e){return n=>Hk(n.value)&&n.value.length>e?{maxlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static pattern(n){return function Jk(e){if(!e)return Xb;let n,t;return"string"==typeof e?(t="","^"!==e.charAt(0)&&(t+="^"),t+=e,"$"!==e.charAt(e.length-1)&&(t+="$"),n=new RegExp(t)):(t=e.toString(),n=e),i=>{if(Pd(i.value))return null;const o=i.value;return n.test(o)?null:{pattern:{requiredPattern:t,actualValue:o}}}}(n)}static nullValidator(n){return null}static compose(n){return rR(n)}static composeAsync(n){return oR(n)}}function Xb(e){return null}function Qk(e){return null!=e}function eR(e){const n=fi(e)?Li(e):e;if(p9&&!Gi(n)){let t="Expected async validator to return Promise or Observable.";throw"object"==typeof e&&(t+=" Are you using a synchronous validator where an async validator is expected?"),new nt(-1101,t)}return n}function tR(e){let n={};return e.forEach(t=>{n=null!=t?{...n,...t}:n}),0===Object.keys(n).length?null:n}function nR(e,n){return n.map(t=>t(e))}function iR(e){return e.map(n=>function _9(e){return!e.validate}(n)?n:t=>n.validate(t))}function rR(e){if(!e)return null;const n=e.filter(Qk);return 0==n.length?null:function(t){return tR(nR(t,n))}}function cD(e){return null!=e?rR(iR(e)):null}function oR(e){if(!e)return null;const n=e.filter(Qk);return 0==n.length?null:function(t){return function c9(...e){const n=rh(e),{args:t,keys:i}=mI(e),o=new fn(l=>{const{length:u}=t;if(!u)return void l.complete();const m=new Array(u);let y=u,C=u;for(let T=0;T<u;T++){let A=!1;xn(t[T]).subscribe(Yn(l,z=>{A||(A=!0,C--),m[T]=z},()=>y--,void 0,()=>{(!y||!A)&&(C||l.next(i?gI(i,m):m),l.complete())}))}});return n?o.pipe(DC(n)):o}(nR(t,n).map(eR)).pipe(ht(tR))}}function uD(e){return null!=e?oR(iR(e)):null}function sR(e,n){return null===e?[n]:Array.isArray(e)?[...e,n]:[e,n]}function aR(e){return e._rawValidators}function lR(e){return e._rawAsyncValidators}function hD(e){return e?Array.isArray(e)?e:[e]:[]}function Yb(e,n){return Array.isArray(e)?e.includes(n):e===n}function cR(e,n){const t=hD(n);return hD(e).forEach(o=>{Yb(t,o)||t.push(o)}),t}function uR(e,n){return hD(n).filter(t=>!Yb(e,t))}class hR{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=cD(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=uD(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n){this.control&&this.control.reset(n)}hasError(n,t){return!!this.control&&this.control.hasError(n,t)}getError(n,t){return this.control?this.control.getError(n,t):null}}class Cs extends hR{get formDirective(){return null}get path(){return null}}class Rd extends hR{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class dR{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let fR=(()=>{class e extends dR{constructor(t){super(t)}}return e.\u0275fac=function(t){return new(t||e)(Qe(Rd,2))},e.\u0275dir=Ft({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,i){2&t&&ix("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[ri]}),e})(),pR=(()=>{class e extends dR{constructor(t){super(t)}}return e.\u0275fac=function(t){return new(t||e)(Qe(Cs,10))},e.\u0275dir=Ft({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(t,i){2&t&&ix("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[ri]}),e})();function mR(e,n){return e?`with name: '${n}'`:`at index: ${n}`}const pD=!1,Xy="VALID",Jb="INVALID",dg="PENDING",Yy="DISABLED";function mD(e){return(Qb(e)?e.validators:e)||null}function gD(e,n){return(Qb(n)?n.asyncValidators:e)||null}function Qb(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function gR(e,n,t){const i=e.controls;if(!(n?Object.keys(i):i).length)throw new nt(1e3,pD?function b9(e){return`\n    There are no form controls registered with this ${e?"group":"array"} yet. If you're using ngModel,\n    you may want to check next tick (e.g. use setTimeout).\n  `}(n):"");if(!i[t])throw new nt(1001,pD?function w9(e,n){return`Cannot find form control ${mR(e,n)}`}(n,t):"")}function _R(e,n,t){e._forEachChild((i,o)=>{if(void 0===t[o])throw new nt(1002,pD?function C9(e,n){return`Must supply a value for form control ${mR(e,n)}`}(n,o):"")})}class e1{constructor(n,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===Xy}get invalid(){return this.status===Jb}get pending(){return this.status==dg}get disabled(){return this.status===Yy}get enabled(){return this.status!==Yy}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(cR(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(cR(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(uR(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(uR(n,this._rawAsyncValidators))}hasValidator(n){return Yb(this._rawValidators,n)}hasAsyncValidator(n){return Yb(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=dg,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=Yy,this.errors=null,this._forEachChild(i=>{i.disable({...n,onlySelf:!0})}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(i=>i(!0))}enable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=Xy,this._forEachChild(i=>{i.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Xy||this.status===dg)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Yy:Xy}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=dg,this._hasOwnPendingAsyncValidator=!0;const t=eR(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(!1!==t.emitEvent)}get(n){let t=n;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((i,o)=>i&&i._find(o),this)}getError(n,t){const i=t?this.get(t):this;return i&&i.errors?i.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new Mi,this.statusChanges=new Mi}_calculateStatus(){return this._allControlsDisabled()?Yy:this.errors?Jb:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(dg)?dg:this._anyControlsHaveStatus(Jb)?Jb:Xy}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){Qb(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function E9(e){return Array.isArray(e)?cD(e):e||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function D9(e){return Array.isArray(e)?uD(e):e||null}(this._rawAsyncValidators)}}class Ky extends e1{constructor(n,t,i){super(mD(t),gD(i,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,i={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,i={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){_R(this,!0,n),Object.keys(n).forEach(i=>{gR(this,!0,i),this.controls[i].setValue(n[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(Object.keys(n).forEach(i=>{const o=this.controls[i];o&&o.patchValue(n[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((i,o)=>{i.reset(n[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(n,t,i)=>(n[i]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,i)=>!!i._syncPendingControls()||t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{const i=this.controls[t];i&&n(i,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[t,i]of Object.entries(this.controls))if(this.contains(t)&&n(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,i,o)=>((i.enabled||this.disabled)&&(t[o]=i.value),t))}_reduceChildren(n,t){let i=n;return this._forEachChild((o,l)=>{i=t(i,o,l)}),i}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}class yR extends Ky{}const vp=new Mt("CallSetDisabledState",{providedIn:"root",factory:()=>Jy}),Jy="always";function Qy(e,n,t=Jy){_D(e,n),n.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&n.valueAccessor.setDisabledState?.(e.disabled),function S9(e,n){n.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&vR(e,n)})}(e,n),function I9(e,n){const t=(i,o)=>{n.valueAccessor.writeValue(i),o&&n.viewToModelUpdate(i)};e.registerOnChange(t),n._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,n),function M9(e,n){n.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&vR(e,n),"submit"!==e.updateOn&&e.markAsTouched()})}(e,n),function T9(e,n){if(n.valueAccessor.setDisabledState){const t=i=>{n.valueAccessor.setDisabledState(i)};e.registerOnDisabledChange(t),n._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,n)}function n1(e,n,t=!0){const i=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(i),n.valueAccessor.registerOnTouched(i)),r1(e,n),e&&(n._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function i1(e,n){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function _D(e,n){const t=aR(e);null!==n.validator?e.setValidators(sR(t,n.validator)):"function"==typeof t&&e.setValidators([t]);const i=lR(e);null!==n.asyncValidator?e.setAsyncValidators(sR(i,n.asyncValidator)):"function"==typeof i&&e.setAsyncValidators([i]);const o=()=>e.updateValueAndValidity();i1(n._rawValidators,o),i1(n._rawAsyncValidators,o)}function r1(e,n){let t=!1;if(null!==e){if(null!==n.validator){const o=aR(e);if(Array.isArray(o)&&o.length>0){const l=o.filter(u=>u!==n.validator);l.length!==o.length&&(t=!0,e.setValidators(l))}}if(null!==n.asyncValidator){const o=lR(e);if(Array.isArray(o)&&o.length>0){const l=o.filter(u=>u!==n.asyncValidator);l.length!==o.length&&(t=!0,e.setAsyncValidators(l))}}}const i=()=>{};return i1(n._rawValidators,i),i1(n._rawAsyncValidators,i),t}function vR(e,n){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function wR(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function CR(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const fg=class extends e1{constructor(n=null,t,i){super(mD(t),gD(i,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Qb(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=CR(n)?n.value:n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){wR(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){wR(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){CR(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};let IR=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=ar({type:e}),e.\u0275inj=Ui({}),e})();const wD=new Mt("NgModelWithFormControlWarning"),H9={provide:Cs,useExisting:Hn(()=>o1)};let o1=(()=>{class e extends Cs{constructor(t,i,o){super(),this.callSetDisabledState=o,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Mi,this._setValidators(t),this._setAsyncValidators(i)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(r1(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const i=this.form.get(t.path);return Qy(i,t,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),i}getControl(t){return this.form.get(t.path)}removeControl(t){n1(t.control||null,t,!1),function R9(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,i){this.form.get(t.path).setValue(i)}onSubmit(t){return this.submitted=!0,function bR(e,n){e._syncPendingControls(),n.forEach(t=>{const i=t.control;"submit"===i.updateOn&&i._pendingChange&&(t.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const i=t.control,o=this.form.get(t.path);i!==o&&(n1(i||null,t),(e=>e instanceof fg)(o)&&(Qy(o,t,this.callSetDisabledState),t.control=o))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const i=this.form.get(t.path);(function xR(e,n){_D(e,n)})(i,t),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const i=this.form.get(t.path);i&&function A9(e,n){return r1(e,n)}(i,t)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){_D(this.form,this),this._oldForm&&r1(this._oldForm,this)}_checkFormPresent(){}}return e.\u0275fac=function(t){return new(t||e)(Qe(ts,10),Qe(kd,10),Qe(vp,8))},e.\u0275dir=Ft({type:e,selectors:[["","formGroup",""]],hostBindings:function(t,i){1&t&&Un("submit",function(l){return i.onSubmit(l)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Wi([H9]),ri,Wr]}),e})();const q9={provide:Rd,useExisting:Hn(()=>DD)};let DD=(()=>{class e extends Rd{set isDisabled(t){}constructor(t,i,o,l,u){super(),this._ngModelWarningConfig=u,this._added=!1,this.update=new Mi,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(i),this._setAsyncValidators(o),this.valueAccessor=function xD(e,n){if(!n)return null;let t,i,o;return Array.isArray(n),n.forEach(l=>{l.constructor===Zb?t=l:function k9(e){return Object.getPrototypeOf(e.constructor)===yp}(l)?i=l:o=l}),o||i||t||null}(0,l)}ngOnChanges(t){this._added||this._setUpControl(),function vD(e,n){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(n,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function t1(e,n){return[...n.path,e]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return e._ngModelWarningSentOnce=!1,e.\u0275fac=function(t){return new(t||e)(Qe(Cs,13),Qe(ts,10),Qe(kd,10),Qe(Hc,10),Qe(wD,8))},e.\u0275dir=Ft({type:e,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Wi([q9]),ri,Wr]}),e})();const Z9={provide:Hc,useExisting:Hn(()=>s1),multi:!0};function OR(e,n){return null==e?`${n}`:(n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let s1=(()=>{class e extends yp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const o=OR(this._getOptionId(t),t);this.setProperty("value",o)}registerOnChange(t){this.onChange=i=>{this.value=this._getOptionValue(i),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const i of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(i),t))return i;return null}_getOptionValue(t){const i=function X9(e){return e.split(":")[0]}(t);return this._optionMap.has(i)?this._optionMap.get(i):t}}return e.\u0275fac=function(){let n;return function(i){return(n||(n=Xr(e)))(i||e)}}(),e.\u0275dir=Ft({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(t,i){1&t&&Un("change",function(l){return i.onChange(l.target.value)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[Wi([Z9]),ri]}),e})(),LR=(()=>{class e{constructor(t,i,o){this._element=t,this._renderer=i,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(OR(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(Qe(Ao),Qe(jl),Qe(s1,9))},e.\u0275dir=Ft({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const Y9={provide:Hc,useExisting:Hn(()=>TD),multi:!0};function FR(e,n){return null==e?`${n}`:("string"==typeof n&&(n=`'${n}'`),n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let TD=(()=>{class e extends yp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let i;if(this.value=t,Array.isArray(t)){const o=t.map(l=>this._getOptionId(l));i=(l,u)=>{l._setSelected(o.indexOf(u.toString())>-1)}}else i=(o,l)=>{o._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(t){this.onChange=i=>{const o=[],l=i.selectedOptions;if(void 0!==l){const u=l;for(let m=0;m<u.length;m++){const C=this._getOptionValue(u[m].value);o.push(C)}}else{const u=i.options;for(let m=0;m<u.length;m++){const y=u[m];if(y.selected){const C=this._getOptionValue(y.value);o.push(C)}}}this.value=o,t(o)}}_registerOption(t){const i=(this._idCounter++).toString();return this._optionMap.set(i,t),i}_getOptionId(t){for(const i of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(i)._value,t))return i;return null}_getOptionValue(t){const i=function K9(e){return e.split(":")[0]}(t);return this._optionMap.has(i)?this._optionMap.get(i)._value:t}}return e.\u0275fac=function(){let n;return function(i){return(n||(n=Xr(e)))(i||e)}}(),e.\u0275dir=Ft({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(t,i){1&t&&Un("change",function(l){return i.onChange(l.target)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[Wi([Y9]),ri]}),e})(),zR=(()=>{class e{constructor(t,i,o){this._element=t,this._renderer=i,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue(FR(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(FR(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(Qe(Ao),Qe(jl),Qe(TD,9))},e.\u0275dir=Ft({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})(),qR=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=ar({type:e}),e.\u0275inj=Ui({imports:[IR]}),e})();class ZR extends e1{constructor(n,t,i){super(mD(t),gD(i,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[this._adjustIndex(n)]}push(n,t={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(n,t,i={}){this.controls.splice(n,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(n,t={}){let i=this._adjustIndex(n);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(n,t,i={}){let o=this._adjustIndex(n);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),t&&(this.controls.splice(o,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,t={}){_R(this,!1,n),n.forEach((i,o)=>{gR(this,!1,o),this.at(o).setValue(i,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(n.forEach((i,o)=>{this.at(o)&&this.at(o).patchValue(i,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n=[],t={}){this._forEachChild((i,o)=>{i.reset(n[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((t,i)=>!!i._syncPendingControls()||t,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((t,i)=>{n(t,i)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(t=>t.enabled&&n(t))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}}function XR(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let sZ=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new e;return t.useNonNullable=!0,t}group(t,i=null){const o=this._reduceControls(t);let l={};return XR(i)?l=i:null!==i&&(l.validators=i.validator,l.asyncValidators=i.asyncValidator),new Ky(o,l)}record(t,i=null){const o=this._reduceControls(t);return new yR(o,i)}control(t,i,o){let l={};return this.useNonNullable?(XR(i)?l=i:(l.validators=i,l.asyncValidators=o),new fg(t,{...l,nonNullable:!0})):new fg(t,i,o)}array(t,i,o){const l=t.map(u=>this._createControl(u));return new ZR(l,i,o)}_reduceControls(t){const i={};return Object.keys(t).forEach(o=>{i[o]=this._createControl(t[o])}),i}_createControl(t){return t instanceof fg||t instanceof e1?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),aZ=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:vp,useValue:t.callSetDisabledState??Jy}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=ar({type:e}),e.\u0275inj=Ui({imports:[qR]}),e})(),lZ=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:wD,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:vp,useValue:t.callSetDisabledState??Jy}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=ar({type:e}),e.\u0275inj=Ui({imports:[qR]}),e})();function cZ(e,n){if(1&e&&Xt(0,"input",17),2&e){const t=go().$implicit;xt("formControlName",t.field)("placeholder",t.placeholder)("type","text")}}function uZ(e,n){if(1&e&&Xt(0,"textarea",18),2&e){const t=go().$implicit;xt("formControlName",t.field)("placeholder",t.placeholder)}}function hZ(e,n){if(1&e&&(ft(0,"option",22),si(1),gt()),2&e){const t=n.$implicit;xt("value",t.value),Rt(1),Ro(t.label)}}function dZ(e,n){if(1&e&&(ft(0,"select",19)(1,"option",20),si(2,"Option List"),gt(),qt(3,hZ,2,2,"option",21),gt()),2&e){const t=go().$implicit;xt("formControlName",t.field),Rt(3),xt("ngForOf",t.data)}}function fZ(e,n){if(1&e){const t=xr();ft(0,"div",23),Xt(1,"input",24)(2,"input",25,26),ft(4,"button",27),Un("click",function(){return at(t),Al(Fn(3).click())}),si(5,"color"),gt(),ft(6,"button",28),Un("click",function(){return at(t),Al(go(3).add())}),si(7,"Add list"),gt()()}if(2&e){const t=go().$implicit,i=go(2);Rt(1),xt("formControlName",t.field)("type","text"),Rt(1),xt("type","color"),Rt(4),xt("disabled",i.addForm.invalid)}}function pZ(e,n){if(1&e&&(wn(0),ft(1,"label",12),si(2),gt(),qt(3,cZ,1,3,"input",13),qt(4,uZ,1,2,"textarea",14),qt(5,dZ,4,2,"select",15),qt(6,fZ,8,4,"div",16),xi()),2&e){const t=n.$implicit;Rt(2),Ro(t.label),Rt(1),xt("ngIf","input-text"==t.type),Rt(1),xt("ngIf","textarea"==t.type),Rt(1),xt("ngIf","select"==t.type),Rt(1),xt("ngIf","SpecialComponent1"==t.type)}}function mZ(e,n){if(1&e&&(ft(0,"tr")(1,"td"),si(2),gt(),ft(3,"td"),si(4),gt(),ft(5,"td")(6,"button",29),Xt(7,"img",30),gt(),ft(8,"button",29),Xt(9,"img",31),gt()()()),2&e){const t=n.$implicit;Rt(1),nx("color",t.color),Rt(1),Ro(t.color),Rt(2),Ro(t.answers)}}function gZ(e,n){if(1&e){const t=xr();ft(0,"div",1)(1,"div",2)(2,"div",3),si(3),gt(),qt(4,pZ,7,5,"ng-container",4),ft(5,"table",5)(6,"tr")(7,"th",6),si(8,"color"),gt(),ft(9,"th",7),si(10,"Answers"),gt(),ft(11,"th",6),si(12,"Operation"),gt()(),qt(13,mZ,10,4,"tr",4),gt(),ft(14,"div",8)(15,"button",9),Un("click",function(){return at(t),Al(go().pushData())}),si(16,"Save"),gt()()(),ft(17,"div",10),Xt(18,"app-map",11),gt()()}if(2&e){const t=go();Rt(1),xt("formGroup",t.addForm),Rt(2),zc(" ",t.form.title,""),Rt(1),xt("ngForOf",null==t.form?null:t.form.fields),Rt(3),xt("width","20%"),Rt(2),xt("width","60%"),Rt(2),xt("width","20%"),Rt(2),xt("ngForOf",t.dataSouce),Rt(2),xt("disabled",t.addForm.invalid)}}const _Z=[{path:"",component:GU},{path:"detail",component:l9},{path:"new",component:(()=>{class e{constructor(t,i,o){this.data=t,this.fb=i,this.router=o,this.dataSouce=[],this.addForm=this.fb.group({color:[,]}),this.getForm()}ngOnInit(){}add(){this.dataSouce.push(this.addForm.value)}getForm(){this.data.getform("/2-create-form/form-settings.json").subscribe(t=>{this.form=t,this.form?.fields.forEach(i=>{this.addForm.addControl(i.field,new fg("",g9.required))})})}pushData(){this.data.cards.unshift({id:1,img:"../../../assets/Screenshot 2023-10-15 081136.png",subtitle:this.addForm.value.title,title:this.addForm.value.desc,url:"/survey/how-many-car-you-have-in-your-family"}),this.router.navigate(["/"])}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(eg),Qe(sZ),Qe(Gs))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-new-item"]],decls:1,vars:1,consts:[["class","new",4,"ngIf"],[1,"new"],[1,"left",3,"formGroup"],[1,"title"],[4,"ngFor","ngForOf"],["cellspacing","0","cellpadding","0"],[3,"width"],[2,"text-align","start",3,"width"],[2,"position","relative"],[2,"width","50px","position","absolute","top","5px","right","5px",3,"disabled","click"],[1,"right"],[2,"width","100%","height","100%"],["for",""],[3,"formControlName","placeholder","type",4,"ngIf"],["style","height: 40px;","name","","id","","cols","30","rows","5",3,"formControlName","placeholder",4,"ngIf"],["name","","id","",3,"formControlName",4,"ngIf"],["style","display: flex; justify-content: space-between",4,"ngIf"],[3,"formControlName","placeholder","type"],["name","","id","","cols","30","rows","5",2,"height","40px",3,"formControlName","placeholder"],["name","","id","",3,"formControlName"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[2,"display","flex","justify-content","space-between"],["placeholder","Write Answers",2,"width","56%",3,"formControlName","type"],["formControlName","color",2,"opacity","0",";width","0",3,"type"],["color",""],[1,"color",2,"width","20%",3,"click"],[2,"width","20%",3,"disabled","click"],[2,"width","17px","margin","0 2px","height","20px","background-color","rgb(27, 27, 27)"],["src","../../assets/pencil_orange.svg","alt","",2,"width","9px","margin-left","-2px"],["src","../../assets/red-bin.svg","alt","",2,"width","9px","margin-left","-2px"]],template:function(i,o){1&i&&qt(0,gZ,19,8,"div",0),2&i&&xt("ngIf",o.form)},dependencies:[Vm,J_,LR,zR,Zb,s1,fR,pR,o1,DD,jk],styles:[".new[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden!important;width:100%;height:100%;display:flex;justify-content:space-between;padding:10px}.right[_ngcontent-%COMP%], .left[_ngcontent-%COMP%]{box-sizing:border-box;height:calc(100% - 20px);background-color:#191c1d;border-radius:8px}.left[_ngcontent-%COMP%]{width:calc(25% - 30px);height:100%;padding:15px;display:flex;flex-direction:column}.left[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .left[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .left[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:#2d3436;border-radius:5px;height:25px}.right[_ngcontent-%COMP%]{width:calc(75% - 20px);height:100%;border:3px solid rgb(22,22,22)}.title[_ngcontent-%COMP%]{font-size:25px;font-weight:700;margin-bottom:20px}label[_ngcontent-%COMP%]{margin:10px 0 3px;font-size:12px}button[_ngcontent-%COMP%]{border:#2d3436;border-radius:5px;height:25px;font-size:13px}.color[_ngcontent-%COMP%]{background-color:#ff0}table[_ngcontent-%COMP%]{margin-top:5px;width:100%;border:none!important;font-size:9px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border:none!important;padding:5px 0;height:30px!important}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border:none!important}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#565e61;border:none!important}"]})}return e})()}];let yZ=(()=>{class e{static#e=this.\u0275fac=function(i){return new(i||e)};static#t=this.\u0275mod=ar({type:e});static#n=this.\u0275inj=Ui({imports:[SA.forRoot(_Z),SA]})}return e})();function vZ(e,n){if(1&e&&(ft(0,"a",6),si(1),gt()),2&e){const t=n.$implicit;xt("routerLink",t.path),Rt(1),Ro(t.label)}}function xZ(e,n){if(1&e&&(ft(0,"div",1)(1,"div",2),si(2),gt(),ft(3,"div",3),qt(4,vZ,2,2,"a",4),gt(),ft(5,"div",5),si(6),gt()()),2&e){const t=go();Rt(2),zc(" Mail ",t.setting.mail," "),Rt(2),xt("ngForOf",t.menu),Rt(2),Ro(t.setting.copyright)}}let bZ=(()=>{class e{constructor(t){this.data=t}ngOnInit(){this.getSettings(),this.getMenu()}getSettings(){this.data.getsetting("settings.json").subscribe(t=>{this.setting=t})}getMenu(){this.data.getfooter("footer-menu.json").subscribe(t=>{this.menu=t})}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(eg))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-footer"]],decls:1,vars:1,consts:[["class","footer",4,"ngIf"],[1,"footer"],[1,"email"],[1,"menu"],[3,"routerLink",4,"ngFor","ngForOf"],[1,"copy"],[3,"routerLink"]],template:function(i,o){1&i&&qt(0,xZ,7,3,"div",0),2&i&&xt("ngIf",o.setting)},dependencies:[Vm,J_,Km],styles:[".footer[_ngcontent-%COMP%]{height:50px;display:flex;justify-content:space-between;margin-bottom:-30px!important}.footer[_ngcontent-%COMP%]   .email[_ngcontent-%COMP%]{width:20%;display:flex;align-items:center}.footer[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{width:23%}.footer[_ngcontent-%COMP%]   .copy[_ngcontent-%COMP%]{width:20%;display:flex;align-items:center}.footer[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.footer[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}"]})}return e})();const wZ=new Mt("DARK_MODE_OPTIONS"),CZ={darkModeClass:"dark-mode",lightModeClass:"light-mode",preloadingClass:"dark-mode-preloading",storageKey:"dark-mode",element:document.body};let TZ=(()=>{class e{matchMedia(t){return window.matchMedia(t)}prefersDarkMode(){return this.matchMedia("(prefers-color-scheme: dark)").matches}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),SZ=(()=>{class e{constructor(t,i,o){this.rendererFactory=t,this.mediaQueryService=i,this.providedOptions=o,this.options={...CZ,...this.providedOptions||{}},this.renderer=this.rendererFactory.createRenderer(null,null),this.darkModeSubject$=new va(this.getInitialDarkModeValue()),this.darkModeSubject$.getValue()?this.enable():this.disable(),this.removePreloadingClass()}get darkMode$(){return this.darkModeSubject$.asObservable().pipe(sk())}toggle(){this.darkModeSubject$.getValue()?this.disable():this.enable()}enable(){const{element:t,darkModeClass:i,lightModeClass:o}=this.options;this.renderer.removeClass(t,o),this.renderer.addClass(t,i),this.saveDarkModeToStorage(!0),this.darkModeSubject$.next(!0)}disable(){const{element:t,darkModeClass:i,lightModeClass:o}=this.options;this.renderer.removeClass(t,i),this.renderer.addClass(t,o),this.saveDarkModeToStorage(!1),this.darkModeSubject$.next(!1)}getInitialDarkModeValue(){const t=this.getDarkModeFromStorage();return function EZ(e){return null==e}(t)?this.mediaQueryService.prefersDarkMode():t}saveDarkModeToStorage(t){localStorage.setItem(this.options.storageKey,JSON.stringify({darkMode:t}))}getDarkModeFromStorage(){const t=localStorage.getItem(this.options.storageKey);if(t)try{return JSON.parse(t)?.darkMode}catch{console.error("Invalid darkMode localStorage item:",t,"falling back to color scheme media query")}return null}removePreloadingClass(){setTimeout(()=>{this.renderer.removeClass(this.options.element,this.options.preloadingClass)})}}return e.\u0275fac=function(t){return new(t||e)(Dt(u_),Dt(TZ),Dt(wZ,8))},e.\u0275prov=At({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),MZ=(()=>{class e{constructor(t){this.darkModeService=t,this.darkMode$=this.darkModeService.darkMode$}onToggle(){this.darkModeService.toggle()}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(SZ))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-dark-mode-toggle"]],decls:5,vars:3,consts:[[1,"icon",3,"click"],["type","checkbox",2,"display","none",3,"checked","change"],["t",""],[1,"fa","fa-moon-o",2,"font-size","14px","padding","5px"]],template:function(i,o){if(1&i){const l=xr();ft(0,"div",0),Un("click",function(){return at(l),Al(Fn(2).click())}),ft(1,"input",1,2),Un("change",function(){return o.onToggle()}),function fS(e,n){const t=yn();let i;const o=e+Kn;t.firstCreatePass?(i=function tF(e,n){if(n)for(let t=n.length-1;t>=0;t--){const i=n[t];if(e===i.name)return i}}(n,t.pipeRegistry),t.data[o]=i,i.onDestroy&&(t.destroyHooks??(t.destroyHooks=[])).push(o,i.onDestroy)):i=t.data[o];const l=i.factory||(i.factory=aa(i.type)),u=co(Qe);try{const m=cr(!1),y=l();return cr(m),function ni(e,n,t,i){t>=e.data.length&&(e.data[t]=null,e.blueprint[t]=null),n[t]=i}(t,Ze(),o,y),y}finally{co(u)}}(3,"async"),gt(),Xt(4,"i",3),gt()}2&i&&(Rt(1),xt("checked",pS(3,1,o.darkMode$)))},dependencies:[BM],encapsulation:2})}return e})();function IZ(e,n){if(1&e&&(ft(0,"a",17),si(1),gt()),2&e){const t=n.$implicit;xt("routerLink",t.path),Rt(1),Ro(t.label)}}function AZ(e,n){if(1&e&&(ft(0,"div",1)(1,"div",2),Xt(2,"img",3),ft(3,"span",4),si(4),gt()(),ft(5,"div",5),qt(6,IZ,2,2,"a",6),gt(),ft(7,"div",7)(8,"div",8)(9,"div",9),Xt(10,"i",10),gt(),ft(11,"div",9),Xt(12,"i",10),gt(),Xt(13,"app-dark-mode-toggle"),gt(),ft(14,"div",11)(15,"div",12)(16,"span",13),si(17),gt(),ft(18,"span",14),si(19),gt()(),ft(20,"div",15),Xt(21,"i",16)(22,"img",3),gt()()()()),2&e){const t=go();Rt(2),xt("src",t.setting.logo,Zh),Rt(2),Ro(t.setting.logo_title),Rt(2),xt("ngForOf",t.menu),Rt(11),Ro(t.user.name),Rt(2),Ro("Vote:"+t.user.vote+" Survey:"+t.user.survey),Rt(3),xt("src",t.user.img,Zh)}}let PZ=(()=>{class e{constructor(t){this.data=t}ngOnInit(){this.getSettings(),this.getMenu(),this.getUser()}getSettings(){this.data.getsetting("settings.json").subscribe(t=>{this.setting=t})}getMenu(){this.data.getmenu("menu.json").subscribe(t=>{this.menu=t})}getUser(){this.data.getuser("user.json").subscribe(t=>{this.user=t})}static#e=this.\u0275fac=function(i){return new(i||e)(Qe(eg))};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-header"]],decls:1,vars:1,consts:[["class","header-container",4,"ngIf"],[1,"header-container"],["routerLink","/",1,"logo"],["alt","",3,"src"],[1,"logo-text"],[1,"menu-list"],[3,"routerLink",4,"ngFor","ngForOf"],[1,"user"],[1,"icons"],[1,"icon"],[1,"fa","fa-bell",2,"font-size","14px","padding","5px"],[1,"detail"],[1,"names"],[2,"font-weight","400"],[2,"font-size","15px"],[1,"img"],[1,"fa","fa-angle-down",2,"padding-right","5px"],[3,"routerLink"]],template:function(i,o){1&i&&qt(0,AZ,23,6,"div",0),2&i&&xt("ngIf",o.setting&&o.user)},dependencies:[Vm,J_,Km,MZ],styles:[".header-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;height:50px}.header-container[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:200px;display:flex;align-items:center;padding:10px}.header-container[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]:hover{cursor:pointer}.header-container[_ngcontent-%COMP%]   .logo-text[_ngcontent-%COMP%]{margin-left:10px}.header-container[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{justify-content:space-between;display:flex;align-items:center;width:350px}.header-container[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]{display:flex;justify-content:start}.menu-list[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:500px}.menu-list[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.detail[_ngcontent-%COMP%]{display:flex;justify-content:end}.detail[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]{display:flex;align-items:end;flex-direction:column;padding-right:5px}.detail[_ngcontent-%COMP%]   .img[_ngcontent-%COMP%]{width:50px;height:40px;display:flex;align-items:center}.detail[_ngcontent-%COMP%]   .img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:15px;width:30px;height:30px}"]})}return e})(),kZ=(()=>{class e{constructor(){this.title="map-project"}static#e=this.\u0275fac=function(i){return new(i||e)};static#t=this.\u0275cmp=ks({type:e,selectors:[["app-root"]],decls:4,vars:0,consts:[[1,"main"]],template:function(i,o){1&i&&(Xt(0,"app-header"),ft(1,"div",0),Xt(2,"router-outlet"),gt(),Xt(3,"app-footer"))},dependencies:[HC,bZ,PZ],styles:[".main[_ngcontent-%COMP%]{height:calc(100vh - 100px)!important;overflow-y:hidden}"]})}return e})(),RZ=(()=>{class e{static#e=this.\u0275fac=function(i){return new(i||e)};static#t=this.\u0275mod=ar({type:e,bootstrap:[kZ]});static#n=this.\u0275inj=Ui({imports:[jB,jM,yZ,Jj,aZ,lZ,t9,UU]})}return e})();VB().bootstrapModule(RZ).catch(e=>console.error(e))},898:function(gg){gg.exports=function(){"use strict";var Yu,Ku,kn;function Od(p,Ue){if(Yu)if(Ku){var Ds="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Yu+")(sharedChunk); ("+Ku+")(sharedChunk); self.onerror = null;",Lo={};Yu(Lo),kn=Ue(Lo),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(kn.workerUrl=window.URL.createObjectURL(new Blob([Ds],{type:"text/javascript"})))}else Ku=Ue;else Yu=Ue}return Od(0,function(p){var Ue=typeof self<"u"?self:{},Ds="2.15.0";let Lo;const Kt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Lo){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Lo=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch{Lo=s}}return Lo},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Kt.API_URL)return null;try{const s=new URL(Kt.API_URL);return"api.mapbox.cn"===s.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===s.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Zt={supported:!1,testSupport:function(s){!ns&&jr&&(qs?Gc(s):Zi=s)}};let Zi,jr,ns=!1,qs=!1;function Gc(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,jr),s.isContextLost())return;Zt.supported=!0}catch{}s.deleteTexture(r),ns=!0}Ue.document&&(jr=Ue.document.createElement("img"),jr.onload=function(){Zi&&Gc(Zi),Zi=null,qs=!0},jr.onerror=function(){ns=!0,Zi=null},jr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Jl="01";function yo(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Fo=io;function io(s,r,a,h){this.cx=3*s,this.bx=3*(a-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=r,this.p2x=a,this.p2y=h}io.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,r){if(void 0===r&&(r=1e-6),s<0)return 0;if(s>1)return 1;for(var a=s,h=0;h<8;h++){var f=this.sampleCurveX(a)-s;if(Math.abs(f)<r)return a;var _=this.sampleCurveDerivativeX(a);if(Math.abs(_)<1e-6)break;a-=f/_}var x=0,w=1;for(a=s,h=0;h<20&&(f=this.sampleCurveX(a),!(Math.abs(f-s)<r));h++)s>f?x=a:w=a,a=.5*(w-x)+x;return a},solve:function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))}};var sl=yo(Fo),Zs=is;function is(s,r){this.x=s,this.y=r}is.prototype={clone:function(){return new is(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,a=s.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),a=Math.sin(s),h=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=h,this},_rotateAround:function(s,r){var a=Math.cos(s),h=Math.sin(s),f=r.y+h*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-h*(this.y-r.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},is.convert=function(s){return s instanceof is?s:Array.isArray(s)?new is(s[0],s[1]):s};var st=yo(Zs);const Ld=Math.PI/180,al=180/Math.PI;function an(s){return s*Ld}function or(s){return s*al}const Wc=[[0,0],[1,0],[1,1],[0,1]];function Ju(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,a=r*s;return 4*(s<.5?a:3*(s-r)+a-.75)}function ll(s,r,a,h){const f=new sl(s,r,a,h);return function(_){return f.solve(_)}}const rs=ll(.25,.1,.25,1);function hn(s,r,a){return Math.min(a,Math.max(r,s))}function cl(s,r,a){return(a=hn((a-s)/(r-s),0,1))*a*(3-2*a)}function fn(s,r,a){const h=a-r,f=((s-r)%h+h)%h+r;return f===r?a:f}function Xi(s,r,a){if(!s.length)return a(null,[]);let h=s.length;const f=new Array(s.length);let _=null;s.forEach((x,w)=>{r(x,(D,S)=>{D&&(_=D),f[w]=S,0==--h&&a(_,f)})})}function wa(s){const r=[];for(const a in s)r.push(s[a]);return r}function ki(s,...r){for(const a of r)for(const h in a)s[h]=a[h];return s}let Ca=1;function ro(){return Ca++}function Xs(){return function s(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function Ts(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function gi(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Yn(s,r){s.forEach(a=>{r[a]&&(r[a]=r[a].bind(r))})}function Ql(s,r){return-1!==s.indexOf(r,s.length-r.length)}function ht(s,r,a){const h={};for(const f in s)h[f]=r.call(a||this,s[f],f,s);return h}function Ea(s,r,a){const h={};for(const f in s)r.call(a||this,s[f],f,s)&&(h[f]=s[f]);return h}function vo(s){return Array.isArray(s)?s.map(vo):"object"==typeof s&&s?ht(s,vo):s}const ul={};function ui(s){ul[s]||(typeof console<"u"&&console.warn(s),ul[s]=!0)}function zo(s,r,a){return(a.y-s.y)*(r.x-s.x)>(r.y-s.y)*(a.x-s.x)}function Qu(s){let r=0;for(let a,h,f=0,_=s.length,x=_-1;f<_;x=f++)a=s[f],h=s[x],r+=(h.x-a.x)*(a.y+h.y);return r}function Da(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function No(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,h,f,_)=>{const x=f||_;return r[h]=!x||x.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}let eh=null;function qc(s){if(null==eh){const r=s.navigator?s.navigator.userAgent:null;eh=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return eh}function Zc(s){try{const r=Ue[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ys(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]}const ec="mapbox-tiles";let oo,Ks,tc=500,th=50;function Xc(){try{return Ue.caches}catch{}}function hl(){Xc()&&!oo&&(oo=Ue.caches.open(ec))}function nc(s){const r=s.indexOf("?");if(r<0)return s;const h=function(f){const _=f.indexOf("?");return _>0?f.slice(_+1).split("&"):[]}(s).filter(f=>{const _=f.split("=");return"language"===_[0]||"worldview"===_[0]});return h.length?`${s.slice(0,r)}?${h.join("&")}`:s.slice(0,r)}let Bo=1/0;const Ta={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ta);class Sa extends Error{constructor(r,a,h){401===a&&De(h)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=a,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ma=Da()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ue.location.protocol?Ue.parent:Ue).location.href,dl=function(s,r){if(!(/^file:/.test(a=s.url)||/^file:/.test(Ma())&&!/^\w+:/.test(a))){if(Ue.fetch&&Ue.Request&&Ue.AbortController&&Ue.Request.prototype.hasOwnProperty("signal"))return function(h,f){const _=new Ue.AbortController,x=new Ue.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Ma(),referrerPolicy:h.referrerPolicy,signal:_.signal});let w=!1,D=!1;const S=(P=x.url).indexOf("sku=")>0&&De(P);var P;"json"===h.type&&x.headers.set("Accept","application/json");const R=(N,B,$)=>{if(D)return;if(N&&"SecurityError"!==N.message&&ui(N.toString()),B&&$)return O(B);const Z=Date.now();Ue.fetch(x).then(te=>{if(te.ok){const ce=S?te.clone():null;return O(te,ce,Z)}return f(new Sa(te.statusText,te.status,h.url))}).catch(te=>{"AbortError"!==te.name&&f(new Error(`${te.message} ${h.url}`))})},O=(N,B,$)=>{("arrayBuffer"===h.type?N.arrayBuffer():"json"===h.type?N.json():N.text()).then(Z=>{D||(B&&$&&function(te,ce,ne){if(hl(),!oo)return;const ae={status:ce.status,statusText:ce.statusText,headers:new Ue.Headers};ce.headers.forEach((Me,Ee)=>ae.headers.set(Ee,Me));const pe=No(ce.headers.get("Cache-Control")||"");if(pe["no-store"])return;pe["max-age"]&&ae.headers.set("Expires",new Date(ne+1e3*pe["max-age"]).toUTCString());const he=ae.headers.get("Expires");he&&(new Date(he).getTime()-ne<42e4||function(Me,Ee){if(void 0===Ks)try{new Response(new ReadableStream),Ks=!0}catch{Ks=!1}Ks?Ee(Me.body):Me.blob().then(Ee)}(ce,Me=>{const Ee=new Ue.Response(Me,ae);hl(),oo&&oo.then(Oe=>Oe.put(nc(te.url),Ee)).catch(Oe=>ui(Oe.message))}))}(x,B,$),w=!0,f(null,Z,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(Z=>{D||f(new Error(Z.message))})};return S?function(N,B){if(hl(),!oo)return B(null);const $=nc(N.url);oo.then(Z=>{Z.match($).then(te=>{const ce=function(ne){if(!ne)return!1;const ae=new Date(ne.headers.get("Expires")||0),pe=No(ne.headers.get("Cache-Control")||"");return ae>Date.now()&&!pe["no-cache"]}(te);Z.delete($),ce&&Z.put($,te.clone()),B(null,te,ce)}).catch(B)}).catch(B)}(x,R):R(null,null),{cancel:()=>{D=!0,w||_.abort()}}}(s,r);if(Da()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var a;return function(h,f){const _=new Ue.XMLHttpRequest;_.open(h.method||"GET",h.url,!0),"arrayBuffer"===h.type&&(_.responseType="arraybuffer");for(const x in h.headers)_.setRequestHeader(x,h.headers[x]);return"json"===h.type&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials="include"===h.credentials,_.onerror=()=>{f(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||0===_.status)&&null!==_.response){let x=_.response;if("json"===h.type)try{x=JSON.parse(_.response)}catch(w){return f(w)}f(null,x,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else f(new Sa(_.statusText,_.status,h.url))},_.send(h.body),{cancel:()=>_.abort()}}(s,r)},ic=function(s,r){return dl(ki(s,{type:"arrayBuffer"}),r)};function nh(s){const r=Ue.document.createElement("a");return r.href=s,r.protocol===Ue.document.location.protocol&&r.host===Ue.document.location.host}const ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let G,W;G=[],W=0;const se=function(s,r){if(Zt.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),W>=Kt.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return G.push(_),_}W++;let a=!1;const h=()=>{if(!a)for(a=!0,W--;G.length&&W<Kt.MAX_PARALLEL_IMAGE_REQUESTS;){const _=G.shift(),{requestParameters:x,callback:w,cancelled:D}=_;D||(_.cancel=se(x,w).cancel)}},f=ic(s,(_,x,w,D)=>{h(),_?r(_):x&&(Ue.createImageBitmap?function(S,P){const R=new Ue.Blob([new Uint8Array(S)],{type:"image/png"});Ue.createImageBitmap(R).then(O=>{P(null,O)}).catch(O=>{P(new Error(`Could not load image because of ${O.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(S,P)=>r(S,P,w,D)):function(S,P){const R=new Ue.Image,O=Ue.URL;R.onload=()=>{P(null,R),O.revokeObjectURL(R.src),R.onload=null,Ue.requestAnimationFrame(()=>{R.src=ue})},R.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new Ue.Blob([new Uint8Array(S)],{type:"image/png"});R.src=S.byteLength?O.createObjectURL(N):ue}(x,(S,P)=>r(S,P,w,D)))});return{cancel:()=>{f.cancel(),h()}}},me="NO_ACCESS_TOKEN";function ye(s){return 0===s.indexOf("mapbox:")}function De(s){return Kt.API_URL_REGEX.test(s)}function Ce(s){return Kt.API_CDN_URL_REGEX.test(s)}function _e(s){return Kt.API_STYLE_REGEX.test(s)&&!ke(s)}function ke(s){return Kt.API_SPRITE_REGEX.test(s)}const tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function it(s){const r=s.match(tt);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Je(s){const r=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${r}`}const Gt="mapbox.eventData";function en(s){if(!s)return null;const r=s.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(Ue.atob(r[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ut{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const a=en(Kt.ACCESS_TOKEN);let h="";return h=a&&a.u?Ue.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(f,_)=>String.fromCharCode(Number("0x"+_)))):Kt.ACCESS_TOKEN||"",r?`${Gt}.${r}:${h}`:`${Gt}:${h}`}fetchEventData(){const r=Zc("localStorage"),a=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{const f=Ue.localStorage.getItem(a);f&&(this.eventData=JSON.parse(f));const _=Ue.localStorage.getItem(h);_&&(this.anonId=_)}catch{ui("Unable to read from LocalStorage")}}saveEventData(){const r=Zc("localStorage"),a=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{Ue.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&Ue.localStorage.setItem(a,JSON.stringify(this.eventData))}catch{ui("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,a,h,f){if(!Kt.EVENTS_URL)return;const _=it(Kt.EVENTS_URL);_.params.push(`access_token=${f||Kt.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(r).toISOString()},w=a?ki(x,a):x,D={url:Je(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};var P;this.pendingRequest=(P=S=>{this.pendingRequest=null,h(S),this.saveEventData(),this.processRequests(f)},dl(ki(D,{method:"POST"}),P))}queueRequest(r,a){this.queue.push(r),this.processRequests(a)}}const tn=new class extends Ut{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,r){Kt.EVENTS_URL&&Kt.ACCESS_TOKEN&&Array.isArray(s)&&s.some(a=>ye(a)||De(a))&&this.queueRequest(Date.now(),r)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=en(Kt.ACCESS_TOKEN),a=r?r.u:Kt.ACCESS_TOKEN;let h=a!==this.eventData.tokenU;gi(this.anonId)||(this.anonId=Xs(),h=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),x=new Date(f),w=(f-this.eventData.lastSuccess)/864e5;h=h||w>=1||w<-1||_.getDate()!==x.getDate()}else h=!0;h?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ds,skuId:Jl,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=f,this.eventData.tokenU=a)},s):this.processRequests()}},pn=tn.postTurnstileEvent.bind(tn),xn=new class extends Ut{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,r,a,h){this.skuToken=r,this.errorCb=h,Kt.EVENTS_URL&&(a||Kt.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(me)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),gi(this.anonId)||(this.anonId=Xs()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ds,skuId:Jl,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):r&&(this.success[r]=!0)},s))}},Ri=xn.postMapLoadEvent.bind(xn),Dr=new class extends Ut{constructor(){super("gljs.performance")}postPerformanceEvent(s,r){Kt.EVENTS_URL&&(s||Kt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},s)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,performanceData:a}=this.queue.shift(),h=function(f){const _=Ue.performance.getEntriesByType("resource"),x=Ue.performance.getEntriesByType("mark"),w=function(O){const N={};if(O)for(const B in O)if("other"!==B)for(const $ of O[B]){const Z=`${B}ResolveRangeMin`,te=`${B}ResolveRangeMax`,ce=`${B}RequestCount`,ne=`${B}RequestCachedCount`;N[Z]=Math.min(N[Z]||1/0,$.startTime),N[te]=Math.max(N[te]||-1/0,$.responseEnd);const ae=pe=>{void 0===N[pe]&&(N[pe]=0),++N[pe]};void 0!==$.transferSize&&0===$.transferSize&&ae(ne),ae(ce)}return N}(function(O,N){const B={};if(O)for(const $ of O){const Z=N($);void 0===B[Z]&&(B[Z]=[]),B[Z].push($)}return B}(_,wp)),D=Ue.devicePixelRatio,S=Ue.navigator.connection||Ue.navigator.mozConnection||Ue.navigator.webkitConnection,P={counters:[],metadata:[],attributes:[]},R=(O,N,B)=>{null!=B&&O.push({name:N,value:B.toString()})};for(const O in w)R(P.counters,O,w[O]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(R(P.counters,"interactionRangeMin",f.interactionRange[0]),R(P.counters,"interactionRangeMax",f.interactionRange[1])),x)for(const O of Object.keys(rc)){const N=rc[O],B=x.find($=>$.name===N);B&&R(P.counters,N,B.startTime)}return R(P.counters,"visibilityHidden",f.visibilityHidden),R(P.attributes,"style",function(O){if(O)for(const N of O){const B=N.name.split("?")[0];if(_e(B)){const $=B.split("/").slice(-2);if(2===$.length)return`mapbox://styles/${$[0]}/${$[1]}`}}}(_)),R(P.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),R(P.attributes,"fogEnabled",f.fogEnabled?"true":"false"),R(P.attributes,"projection",f.projection),R(P.attributes,"zoom",f.zoom),R(P.metadata,"devicePixelRatio",D),R(P.metadata,"connectionEffectiveType",S?S.effectiveType:void 0),R(P.metadata,"navigatorUserAgent",Ue.navigator.userAgent),R(P.metadata,"screenWidth",Ue.screen.width),R(P.metadata,"screenHeight",Ue.screen.height),R(P.metadata,"windowWidth",Ue.innerWidth),R(P.metadata,"windowHeight",Ue.innerHeight),R(P.metadata,"mapWidth",f.width/D),R(P.metadata,"mapHeight",f.height/D),R(P.metadata,"webglRenderer",f.renderer),R(P.metadata,"webglVendor",f.vendor),R(P.metadata,"sdkVersion",Ds),R(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(a);for(const f of h.metadata);for(const f of h.counters);for(const f of h.attributes);this.postEvent(r,h,()=>{},s)}},ji=Dr.postPerformanceEvent.bind(Dr),Ss=new class extends Ut{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,r,a,h){if(!Kt.API_URL||!Kt.SESSION_PATH)return;const f=it(Kt.API_URL+Kt.SESSION_PATH);f.params.push(`sku=${r||""}`),f.params.push(`access_token=${h||Kt.ACCESS_TOKEN||""}`);const _={url:Je(f),headers:{"Content-Type":"text/plain"}};var w;this.pendingRequest=(w=x=>{this.pendingRequest=null,a(x),this.saveEventData(),this.processRequests(h)},dl(ki(_,{method:"GET"}),w))}getSessionAPI(s,r,a,h){this.skuToken=r,this.errorCb=h,Kt.SESSION_PATH&&Kt.API_URL&&(a||Kt.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(me)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||this.getSession(a,this.skuToken,h=>{h?this.errorCb(h):r&&(this.success[r]=!0)},s)}},Yi=Ss.getSessionAPI.bind(Ss),Ur=new Set,rc={create:"create",load:"load",fullLoad:"fullLoad"},Js={mark(s){Ue.performance.mark(s)},measure(s,r,a){Ue.performance.measure(s,r,a)}};function wp(s){const r=s.name.split("?")[0];return Ce(r)&&r.includes("mapbox-gl.js")?"javascript":Ce(r)&&r.includes("mapbox-gl.css")?"css":Kt.API_FONTS_REGEX.test(r)?"fontRange":ke(r)?"sprite":_e(r)?"style":Kt.API_TILEJSON_REGEX.test(r)?"tilejson":"other"}const Lt=Ue.performance;function Ia(s){const r=s?s.url.toString():void 0;return Lt.getEntriesByName(r)}let so,Cp,ih,os;const ss={now:()=>void 0!==ih?ih:Ue.performance.now(),setNow(s){ih=s},restoreNow(){ih=void 0},frame(s){const r=Ue.requestAnimationFrame(s);return{cancel:()=>Ue.cancelAnimationFrame(r)}},getImageData(s,r=0){const{width:a,height:h}=s;os||(os=Ue.document.createElement("canvas"));const f=os.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(a>os.width||h>os.height)&&(os.width=a,os.height=h),f.clearRect(-r,-r,a+2*r,h+2*r),f.drawImage(s,0,0,a,h),f.getImageData(-r,-r,a+2*r,h+2*r)},resolveURL:s=>(so||(so=Ue.document.createElement("a")),so.href=s,so.href),get devicePixelRatio(){return Ue.devicePixelRatio},get prefersReducedMotion(){return!!Ue.matchMedia&&(null==Cp&&(Cp=Ue.matchMedia("(prefers-reduced-motion: reduce)")),Cp.matches)}};function rh(s,r,a){a[s]&&-1!==a[s].indexOf(r)||(a[s]=a[s]||[],a[s].push(r))}function fl(s,r,a){if(a&&a[s]){const h=a[s].indexOf(r);-1!==h&&a[s].splice(h,1)}}class pl{constructor(r,a={}){ki(this,a),this.type=r}}class Ms extends pl{constructor(r,a={}){super("error",ki({error:r},a))}}class oc{on(r,a){return this._listeners=this._listeners||{},rh(r,a,this._listeners),this}off(r,a){return fl(r,a,this._listeners),fl(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},rh(r,a,this._oneTimeListeners),this):new Promise(h=>this.once(r,h))}fire(r,a){"string"==typeof r&&(r=new pl(r,a||{}));const h=r.type;if(this.listens(h)){r.target=this;const f=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const w of f)w.call(this,r);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const w of _)fl(h,w,this._oneTimeListeners),w.call(this,r);const x=this._eventedParent;x&&(ki(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),x.fire(r))}else r instanceof Ms&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}var ze=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Qs(s,...r){for(const a of r)for(const h in a)s[h]=a[h];return s}function Oi(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function sr(s){if(Array.isArray(s))return s.map(sr);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const a in s)r[a]=sr(s[a]);return r}return Oi(s)}class Fd extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}var Is=Fd;class zd{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[h,f]of a)this.bindings[h]=f}concat(r){return new zd(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var Li=zd;const sc={kind:"null"},ct={kind:"number"},ln={kind:"string"},yt={kind:"boolean"},$r={kind:"color"},Tn={kind:"object"},nn={kind:"value"},xo={kind:"collator"},Hn={kind:"formatted"},Pt={kind:"resolvedImage"};function ao(s,r){return{kind:"array",itemType:s,N:r}}function ii(s){if("array"===s.kind){const r=ii(s.itemType);return"number"==typeof s.N?`array<${r}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${r}>`}return s.kind}const yg=[sc,ct,ln,yt,$r,Hn,Tn,ao(nn),Pt];function As(s,r){if("error"===r.kind)return null;if("array"===s.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!As(s.itemType,r.itemType))&&("number"!=typeof s.N||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if("value"===s.kind)for(const a of yg)if(!As(a,r))return null}return`Expected ${ii(s)} but found ${ii(r)} instead.`}function nt(s,r){return r.some(a=>a.kind===s.kind)}function Aa(s,r){return r.some(a=>"null"===a?null===s:"array"===a?Array.isArray(s):"object"===a?s&&!Array.isArray(s)&&"object"==typeof s:a===typeof s)}var Jt,Nn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Yc(s){return(s=Math.round(s))<0?0:s>255?255:s}function oh(s){return Yc("%"===s[s.length-1]?parseFloat(s)/100*255:parseInt(s))}function sh(s){return(r="%"===s[s.length-1]?parseFloat(s)/100:parseFloat(s))<0?0:r>1?1:r;var r}function ea(s,r,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?s+(r-s)*a*6:2*a<1?r:3*a<2?s+(r-s)*(2/3-a)*6:s}try{Jt={}.parseCSSColor=function(s){var r,a=s.replace(/ /g,"").toLowerCase();if(a in Nn)return Nn[a].slice();if("#"===a[0])return 4===a.length?(r=parseInt(a.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:7===a.length&&(r=parseInt(a.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var h=a.indexOf("("),f=a.indexOf(")");if(-1!==h&&f+1===a.length){var _=a.substr(0,h),x=a.substr(h+1,f-(h+1)).split(","),w=1;switch(_){case"rgba":if(4!==x.length)return null;w=sh(x.pop());case"rgb":return 3!==x.length?null:[oh(x[0]),oh(x[1]),oh(x[2]),w];case"hsla":if(4!==x.length)return null;w=sh(x.pop());case"hsl":if(3!==x.length)return null;var D=(parseFloat(x[0])%360+360)%360/360,S=sh(x[1]),P=sh(x[2]),R=P<=.5?P*(S+1):P+S-P*S,O=2*P-R;return[Yc(255*ea(O,R,D+1/3)),Yc(255*ea(O,R,D)),Yc(255*ea(O,R,D-1/3)),w];default:return null}}return null}}catch{}class ai{constructor(r,a,h,f=1){this.r=r,this.g=a,this.b=h,this.a=f}static parse(r){if(!r)return;if(r instanceof ai)return r;if("string"!=typeof r)return;const a=Jt(r);return a?new ai(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[r,a,h,f]=this.toArray();return`rgba(${Math.round(r)},${Math.round(a)},${Math.round(h)},${f})`}toArray(){const{r,g:a,b:h,a:f}=this;return 0===f?[0,0,0,0]:[255*r/f,255*a/f,255*h/f,f]}toArray01(){const{r,g:a,b:h,a:f}=this;return 0===f?[0,0,0,0]:[r/f,a/f,h/f,f]}toArray01PremultipliedAlpha(){const{r,g:a,b:h,a:f}=this;return[r,a,h,f]}}ai.black=new ai(0,0,0,1),ai.white=new ai(1,1,1,1),ai.transparent=new ai(0,0,0,0),ai.red=new ai(1,0,0,1),ai.blue=new ai(0,0,1,1);var Fi=ai;class Nd{constructor(r,a,h){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ep{constructor(r,a,h,f,_){this.text=r.normalize?r.normalize():r,this.image=a,this.scale=h,this.fontStack=f,this.textColor=_}}class zi{constructor(r){this.sections=r}static fromString(r){return new zi([new Ep(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof zi?r:zi.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const a of this.sections){if(a.image){r.push(["image",a.image.name]);continue}r.push(a.text);const h={};a.fontStack&&(h["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(h["font-scale"]=a.scale),a.textColor&&(h["text-color"]=["rgba"].concat(a.textColor.toArray())),r.push(h)}return r}}class as{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new as({name:r,available:!1}):null}serialize(){return["image",this.name]}}function vg(s,r,a,h){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid rgba value [${[s,r,a,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof h?[s,r,a,h]:[s,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ah(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof Fi||s instanceof Nd||s instanceof zi||s instanceof as)return!0;if(Array.isArray(s)){for(const r of s)if(!ah(r))return!1;return!0}if("object"==typeof s){for(const r in s)if(!ah(s[r]))return!1;return!0}return!1}function Ti(s){if(null===s)return sc;if("string"==typeof s)return ln;if("boolean"==typeof s)return yt;if("number"==typeof s)return ct;if(s instanceof Fi)return $r;if(s instanceof Nd)return xo;if(s instanceof zi)return Hn;if(s instanceof as)return Pt;if(Array.isArray(s)){const r=s.length;let a;for(const h of s){const f=Ti(h);if(a){if(a===f)continue;a=nn;break}a=f}return ao(a||nn,r)}return Tn}function Kc(s){const r=typeof s;return null===s?"":"string"===r||"number"===r||"boolean"===r?String(s):s instanceof Fi||s instanceof zi||s instanceof as?s.toString():JSON.stringify(s)}class Dp{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(2!==r.length)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!ah(r[1]))return a.error("invalid value");const h=r[1];let f=Ti(h);const _=a.expectedType;return"array"!==f.kind||0!==f.N||!_||"array"!==_.kind||"number"==typeof _.N&&0!==_.N||(f=_),new Dp(f,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Fi?["rgba"].concat(this.value.toArray()):this.value instanceof zi?this.value.serialize():this.value}}var ml=Dp,Tr=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const lo={string:ln,number:ct,boolean:yt,object:Tn};class Rn{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let h,f=1;const _=r[0];if("array"===_){let w,D;if(r.length>2){const S=r[1];if("string"!=typeof S||!(S in lo)||"object"===S)return a.error('The item type argument of "array" must be one of string, number, boolean',1);w=lo[S],f++}else w=nn;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);D=r[2],f++}h=ao(w,D)}else h=lo[_];const x=[];for(;f<r.length;f++){const w=a.parse(r[f],f,nn);if(!w)return null;x.push(w)}return new Rn(h,x)}evaluate(r){for(let a=0;a<this.args.length;a++){const h=this.args[a].evaluate(r);if(!As(this.type,Ti(h)))return h;if(a===this.args.length-1)throw new Tr(`Expected value to be of type ${ii(this.type)}, but found ${ii(Ti(h))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,a=[r.kind];if("array"===r.kind){const h=r.itemType;if("string"===h.kind||"number"===h.kind||"boolean"===h.kind){a.push(h.kind);const f=r.N;("number"==typeof f||this.args.length>1)&&a.push(f)}}return a.concat(this.args.map(h=>h.serialize()))}}var Pa=Rn;class gl{constructor(r){this.type=Hn,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&"object"==typeof h)return a.error("First argument must be an image or text section.");const f=[];let _=!1;for(let x=1;x<=r.length-1;++x){const w=r[x];if(_&&"object"==typeof w&&!Array.isArray(w)){_=!1;let D=null;if(w["font-scale"]&&(D=a.parse(w["font-scale"],1,ct),!D))return null;let S=null;if(w["text-font"]&&(S=a.parse(w["text-font"],1,ao(ln)),!S))return null;let P=null;if(w["text-color"]&&(P=a.parse(w["text-color"],1,$r),!P))return null;const R=f[f.length-1];R.scale=D,R.font=S,R.textColor=P}else{const D=a.parse(r[x],1,nn);if(!D)return null;const S=D.type.kind;if("string"!==S&&"value"!==S&&"null"!==S&&"resolvedImage"!==S)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,f.push({content:D,scale:null,font:null,textColor:null})}}return new gl(f)}evaluate(r){return new zi(this.sections.map(a=>{const h=a.content.evaluate(r);return Ti(h)===Pt?new Ep("",h,null,null,null):new Ep(Kc(h),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const a of this.sections){r.push(a.content.serialize());const h={};a.scale&&(h["font-scale"]=a.scale.serialize()),a.font&&(h["text-font"]=a.font.serialize()),a.textColor&&(h["text-color"]=a.textColor.serialize()),r.push(h)}return r}}class Bd{constructor(r){this.type=Pt,this.input=r}static parse(r,a){if(2!==r.length)return a.error("Expected two arguments.");const h=a.parse(r[1],1,ln);return h?new Bd(h):a.error("No image name provided.")}evaluate(r){const a=this.input.evaluate(r),h=as.fromString(a);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(a)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const At={"to-boolean":yt,"to-color":$r,"to-number":ct,"to-string":ln};class Tp{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const h=r[0];if(("to-boolean"===h||"to-string"===h)&&2!==r.length)return a.error("Expected one argument.");const f=At[h],_=[];for(let x=1;x<r.length;x++){const w=a.parse(r[x],x,nn);if(!w)return null;_.push(w)}return new Tp(f,_)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let a,h;for(const f of this.args){if(a=f.evaluate(r),h=null,a instanceof Fi)return a;if("string"==typeof a){const _=r.parseColor(a);if(_)return _}else if(Array.isArray(a)&&(h=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:vg(a[0],a[1],a[2],a[3]),!h))return new Fi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Tr(h||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const h of this.args){if(a=h.evaluate(r),null===a)return 0;const f=Number(a);if(!isNaN(f))return f}throw new Tr(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?zi.fromString(Kc(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?as.fromString(Kc(this.args[0].evaluate(r))):Kc(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new gl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Bd(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(a=>{r.push(a.serialize())}),r}}var Ui=Tp;const bo=["Unknown","Point","LineString","Polygon"];var Vd=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?bo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:a,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*r-s[0])+this.featureDistanceData.bearing[1]*(h*r-s[1])}return 0}parseColor(s){let r=this._parseColorCache[s];return r||(r=this._parseColorCache[s]=Fi.parse(s)),r}};class ka{constructor(r,a,h,f){this.name=r,this.type=a,this._evaluate=h,this.args=f}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,a){const h=r[0],f=ka.definitions[h];if(!f)return a.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(f)?f[0]:f.type,x=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=x.filter(([S])=>!Array.isArray(S)||S.length===r.length-1);let D=null;for(const[S,P]of w){D=new Dt(a.registry,a.path,null,a.scope);const R=[];let O=!1;for(let N=1;N<r.length;N++){const B=r[N],$=Array.isArray(S)?S[N-1]:S.type,Z=D.parse(B,1+R.length,$);if(!Z){O=!0;break}R.push(Z)}if(!O)if(Array.isArray(S)&&S.length!==R.length)D.error(`Expected ${S.length} arguments, but found ${R.length} instead.`);else{for(let N=0;N<R.length;N++){const B=Array.isArray(S)?S[N]:S.type,$=R[N];D.concat(N+1).checkSubtype(B,$.type)}if(0===D.errors.length)return new ka(h,_,P,R)}}if(1===w.length)a.errors.push(...D.errors);else{const S=(w.length?w:x).map(([R])=>{return O=R,Array.isArray(O)?`(${O.map(ii).join(", ")})`:`(${ii(O.type)}...)`;var O}).join(" | "),P=[];for(let R=1;R<r.length;R++){const O=a.parse(r[R],1+P.length);if(!O)return null;P.push(ii(O.type))}a.error(`Expected arguments of type ${S}, but found (${P.join(", ")}) instead.`)}return null}static register(r,a){ka.definitions=a;for(const h in a)r[h]=ka}}var ta=ka;class ac{constructor(r,a,h){this.type=xo,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(2!==r.length)return a.error("Expected one argument.");const h=r[1];if("object"!=typeof h||Array.isArray(h))return a.error("Collator options argument must be an object.");const f=a.parse(void 0!==h["case-sensitive"]&&h["case-sensitive"],1,yt);if(!f)return null;const _=a.parse(void 0!==h["diacritic-sensitive"]&&h["diacritic-sensitive"],1,yt);if(!_)return null;let x=null;return h.locale&&(x=a.parse(h.locale,1,ln),!x)?null:new ac(f,_,x)}evaluate(r){return new Nd(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const Vo=8192;function lc(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function _l(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function Jc(s,r){const a=(180+s[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,f=Math.pow(2,r.z);return[Math.round(a*f*Vo),Math.round(h*f*Vo)]}function Nt(s,r,a){const h=s[0]-r[0],f=s[1]-r[1],_=s[0]-a[0],x=s[1]-a[1];return h*x-_*f==0&&h*_<=0&&f*x<=0}function cc(s,r){let a=!1;for(let x=0,w=r.length;x<w;x++){const D=r[x];for(let S=0,P=D.length;S<P-1;S++){if(Nt(s,D[S],D[S+1]))return!1;(f=D[S])[1]>(h=s)[1]!=(_=D[S+1])[1]>h[1]&&h[0]<(_[0]-f[0])*(h[1]-f[1])/(_[1]-f[1])+f[0]&&(a=!a)}}var h,f,_;return a}function jd(s,r){for(let a=0;a<r.length;a++)if(cc(s,r[a]))return!0;return!1}function co(s,r,a,h){const f=h[0]-a[0],_=h[1]-a[1],x=(s[0]-a[0])*_-f*(s[1]-a[1]),w=(r[0]-a[0])*_-f*(r[1]-a[1]);return x>0&&w<0||x<0&&w>0}function yl(s,r,a){for(const S of a)for(let P=0;P<S.length-1;++P)if((w=[(x=S[P+1])[0]-(_=S[P])[0],x[1]-_[1]])[0]*(D=[(f=r)[0]-(h=s)[0],f[1]-h[1]])[1]-w[1]*D[0]!=0&&co(h,f,_,x)&&co(_,x,h,f))return!0;var h,f,_,x,w,D;return!1}function Mn(s,r){for(let a=0;a<s.length;++a)if(!cc(s[a],r))return!1;for(let a=0;a<s.length-1;++a)if(yl(s[a],s[a+1],r))return!1;return!0}function hi(s,r){for(let a=0;a<r.length;a++)if(Mn(s,r[a]))return!0;return!1}function Sp(s,r,a){const h=[];for(let f=0;f<s.length;f++){const _=[];for(let x=0;x<s[f].length;x++){const w=Jc(s[f][x],a);lc(r,w),_.push(w)}h.push(_)}return h}function xg(s,r,a){const h=[];for(let f=0;f<s.length;f++){const _=Sp(s[f],r,a);h.push(_)}return h}function Mp(s,r,a,h){if(s[0]<a[0]||s[0]>a[2]){const f=.5*h;let _=s[0]-a[0]>f?-h:a[0]-s[0]>f?h:0;0===_&&(_=s[0]-a[2]>f?-h:a[2]-s[0]>f?h:0),s[0]+=_}lc(r,s)}function uc(s,r,a,h){const f=Math.pow(2,h.z)*Vo,_=[h.x*Vo,h.y*Vo],x=[];if(!s)return x;for(const w of s)for(const D of w){const S=[D.x+_[0],D.y+_[1]];Mp(S,r,a,f),x.push(S)}return x}function Qc(s,r,a,h){const f=Math.pow(2,h.z)*Vo,_=[h.x*Vo,h.y*Vo],x=[];if(!s)return x;for(const D of s){const S=[];for(const P of D){const R=[P.x+_[0],P.y+_[1]];lc(r,R),S.push(R)}x.push(S)}if(r[2]-r[0]<=f/2){(w=r)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const D of x)for(const S of D)Mp(S,r,a,f)}var w;return x}class na{constructor(r,a){this.type=yt,this.geojson=r,this.geometries=a}static parse(r,a){if(2!==r.length)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ah(r[1])){const h=r[1];if("FeatureCollection"===h.type)for(let f=0;f<h.features.length;++f){const _=h.features[f].geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new na(h,h.features[f].geometry)}else if("Feature"===h.type){const f=h.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new na(h,h.geometry)}else if("Polygon"===h.type||"MultiPolygon"===h.type)return new na(h,h)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(a,h){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(!x)return!1;if("Polygon"===h.type){const w=Sp(h.coordinates,_,x),D=uc(a.geometry(),f,_,x);if(!_l(f,_))return!1;for(const S of D)if(!cc(S,w))return!1}if("MultiPolygon"===h.type){const w=xg(h.coordinates,_,x),D=uc(a.geometry(),f,_,x);if(!_l(f,_))return!1;for(const S of D)if(!jd(S,w))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(a,h){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(!x)return!1;if("Polygon"===h.type){const w=Sp(h.coordinates,_,x),D=Qc(a.geometry(),f,_,x);if(!_l(f,_))return!1;for(const S of D)if(!Mn(S,w))return!1}if("MultiPolygon"===h.type){const w=xg(h.coordinates,_,x),D=Qc(a.geometry(),f,_,x);if(!_l(f,_))return!1;for(const S of D)if(!hi(S,w))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var lh=na;function hc(s){if(s instanceof ta&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof lh)return!1;let r=!0;return s.eachChild(a=>{r&&!hc(a)&&(r=!1)}),r}function ia(s){if(s instanceof ta&&"feature-state"===s.name)return!1;let r=!0;return s.eachChild(a=>{r&&!ia(a)&&(r=!1)}),r}function Ra(s,r){if(s instanceof ta&&r.indexOf(s.name)>=0)return!1;let a=!0;return s.eachChild(h=>{a&&!Ra(h,r)&&(a=!1)}),a}class Oa{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(2!==r.length||"string"!=typeof r[1])return a.error("'var' expression requires exactly one string literal argument.");const h=r[1];return a.scope.has(h)?new Oa(h,a.scope.get(h)):a.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var vl=Oa;class eu{constructor(r,a=[],h,f=new Li,_=[]){this.registry=r,this.path=a,this.key=a.map(x=>`[${x}]`).join(""),this.scope=f,this.errors=_,this.expectedType=h}parse(r,a,h,f,_={}){return a?this.concat(a,h,f)._parse(r,_):this._parse(r,_)}_parse(r,a){function h(f,_,x){return"assert"===x?new Pa(_,[f]):"coerce"===x?new Ui(_,[f]):f}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=r[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[f];if(_){let x=_.parse(r,this);if(!x)return null;if(this.expectedType){const w=this.expectedType,D=x.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==D.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==D.kind&&"string"!==D.kind){if(this.checkSubtype(w,D))return null}else x=h(x,w,a.typeAnnotation||"coerce");else x=h(x,w,a.typeAnnotation||"assert")}if(!(x instanceof ml)&&"resolvedImage"!==x.type.kind&&ch(x)){const w=new Vd;try{x=new ml(x.type,x.evaluate(w))}catch(D){return this.error(D.message),null}}return x}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,h){const f="number"==typeof r?this.path.concat(r):this.path,_=h?this.scope.concat(h):this.scope;return new eu(this.registry,f,a||null,_,this.errors)}error(r,...a){const h=`${this.key}${a.map(f=>`[${f}]`).join("")}`;this.errors.push(new Is(h,r))}checkSubtype(r,a){const h=As(r,a);return h&&this.error(h),h}}var Dt=eu;function ch(s){if(s instanceof vl)return ch(s.boundExpression);if(s instanceof ta&&"error"===s.name||s instanceof ac||s instanceof lh)return!1;const r=s instanceof Ui||s instanceof Pa;let a=!0;return s.eachChild(h=>{a=r?a&&ch(h):a&&h instanceof ml}),!!a&&hc(s)&&Ra(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function cn(s,r){const a=s.length-1;let h,f,_=0,x=a,w=0;for(;_<=x;)if(w=Math.floor((_+x)/2),h=s[w],f=s[w+1],h<=r){if(w===a||r<f)return w;_=w+1}else{if(!(h>r))throw new Tr("Input is not a number.");x=w-1}return 0}class xl{constructor(r,a,h){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[f,_]of h)this.labels.push(f),this.outputs.push(_)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const h=a.parse(r[1],1,ct);if(!h)return null;const f=[];let _=null;a.expectedType&&"value"!==a.expectedType.kind&&(_=a.expectedType);for(let x=1;x<r.length;x+=2){const w=1===x?-1/0:r[x],D=r[x+1],S=x,P=x+1;if("number"!=typeof w)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(f.length&&f[f.length-1][0]>=w)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const R=a.parse(D,P,_);if(!R)return null;_=_||R.type,f.push([w,R])}return new xl(_,h,f)}evaluate(r){const a=this.labels,h=this.outputs;if(1===a.length)return h[0].evaluate(r);const f=this.input.evaluate(r);if(f<=a[0])return h[0].evaluate(r);const _=a.length;return f>=a[_-1]?h[_-1].evaluate(r):h[cn(a,f)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&r.push(this.labels[a]),r.push(this.outputs[a].serialize());return r}}var tu=xl;function mn(s,r,a){return s*(1-a)+r*a}var nu=Object.freeze({__proto__:null,array:function(s,r,a){return s.map((h,f)=>mn(h,r[f],a))},color:function(s,r,a){return new Fi(mn(s.r,r.r,a),mn(s.g,r.g,a),mn(s.b,r.b,a),mn(s.a,r.a,a))},number:mn});const Ip=.95047,Ud=1.08883,Ps=4/29,Sr=6/29,jo=3*Sr*Sr,ra=Sr*Sr*Sr,Bn=Math.PI/180,uh=180/Math.PI;function iu(s){return s>ra?Math.pow(s,1/3):s/jo+Ps}function ru(s){return s>Sr?s*s*s:jo*(s-Ps)}function hh(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Uo(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function dc(s){const r=Uo(s.r),a=Uo(s.g),h=Uo(s.b),f=iu((.4124564*r+.3575761*a+.1804375*h)/Ip),_=iu((.2126729*r+.7151522*a+.072175*h)/1);return{l:116*_-16,a:500*(f-_),b:200*(_-iu((.0193339*r+.119192*a+.9503041*h)/Ud)),alpha:s.a}}function Ap(s){let r=(s.l+16)/116,a=isNaN(s.a)?r:r+s.a/500,h=isNaN(s.b)?r:r-s.b/200;return r=1*ru(r),a=Ip*ru(a),h=Ud*ru(h),new Fi(hh(3.2404542*a-1.5371385*r-.4985314*h),hh(-.969266*a+1.8760108*r+.041556*h),hh(.0556434*a-.2040259*r+1.0572252*h),s.alpha)}function ks(s,r,a){const h=r-s;return s+a*(h>180||h<-180?h-360*Math.round(h/360):h)}const ou={forward:dc,reverse:Ap,interpolate:function(s,r,a){return{l:mn(s.l,r.l,a),a:mn(s.a,r.a,a),b:mn(s.b,r.b,a),alpha:mn(s.alpha,r.alpha,a)}}},fc={forward:function(s){const{l:r,a,b:h}=dc(s),f=Math.atan2(h,a)*uh;return{h:f<0?f+360:f,c:Math.sqrt(a*a+h*h),l:r,alpha:s.a}},reverse:function(s){const r=s.h*Bn,a=s.c;return Ap({l:s.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:s.alpha})},interpolate:function(s,r,a){return{h:ks(s.h,r.h,a),c:mn(s.c,r.c,a),l:mn(s.l,r.l,a),alpha:mn(s.alpha,r.alpha,a)}}};var $d=Object.freeze({__proto__:null,hcl:fc,lab:ou});class ar{constructor(r,a,h,f,_){this.type=r,this.operator=a,this.interpolation=h,this.input=f,this.labels=[],this.outputs=[];for(const[x,w]of _)this.labels.push(x),this.outputs.push(w)}static interpolationFactor(r,a,h,f){let _=0;if("exponential"===r.name)_=Hd(a,r.base,h,f);else if("linear"===r.name)_=Hd(a,1,h,f);else if("cubic-bezier"===r.name){const x=r.controlPoints;_=new sl(x[0],x[1],x[2],x[3]).solve(Hd(a,1,h,f))}return _}static parse(r,a){let[h,f,_,...x]=r;if(!Array.isArray(f)||0===f.length)return a.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const S=f[1];if("number"!=typeof S)return a.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:S}}else{if("cubic-bezier"!==f[0])return a.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const S=f.slice(1);if(4!==S.length||S.some(P=>"number"!=typeof P||P<0||P>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:S}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(_=a.parse(_,2,ct),!_)return null;const w=[];let D=null;"interpolate-hcl"===h||"interpolate-lab"===h?D=$r:a.expectedType&&"value"!==a.expectedType.kind&&(D=a.expectedType);for(let S=0;S<x.length;S+=2){const P=x[S],R=x[S+1],O=S+3,N=S+4;if("number"!=typeof P)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(w.length&&w[w.length-1][0]>=P)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const B=a.parse(R,N,D);if(!B)return null;D=D||B.type,w.push([P,B])}return"number"===D.kind||"color"===D.kind||"array"===D.kind&&"number"===D.itemType.kind&&"number"==typeof D.N?new ar(D,h,f,_,w):a.error(`Type ${ii(D)} is not interpolatable.`)}evaluate(r){const a=this.labels,h=this.outputs;if(1===a.length)return h[0].evaluate(r);const f=this.input.evaluate(r);if(f<=a[0])return h[0].evaluate(r);const _=a.length;if(f>=a[_-1])return h[_-1].evaluate(r);const x=cn(a,f),w=ar.interpolationFactor(this.interpolation,f,a[x],a[x+1]),D=h[x].evaluate(r),S=h[x+1].evaluate(r);return"interpolate"===this.operator?nu[this.type.kind.toLowerCase()](D,S,w):"interpolate-hcl"===this.operator?fc.reverse(fc.interpolate(fc.forward(D),fc.forward(S),w)):ou.reverse(ou.interpolate(ou.forward(D),ou.forward(S),w))}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,r,this.input.serialize()];for(let h=0;h<this.labels.length;h++)a.push(this.labels[h],this.outputs[h].serialize());return a}}function Hd(s,r,a,h){const f=h-a,_=s-a;return 0===f?0:1===r?_/f:(Math.pow(r,_)-1)/(Math.pow(r,f)-1)}var ls=ar;class Ft{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let h=null;const f=a.expectedType;f&&"value"!==f.kind&&(h=f);const _=[];for(const w of r.slice(1)){const D=a.parse(w,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!D)return null;h=h||D.type,_.push(D)}const x=f&&_.some(w=>As(f,w.type));return new Ft(x?nn:h,_)}evaluate(r){let a,h=null,f=0;for(const _ of this.args){if(f++,h=_.evaluate(r),h&&h instanceof as&&!h.available&&(a||(a=h),h=null,f===this.args.length))return a;if(null!==h)break}return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(a=>{r.push(a.serialize())}),r}}var Mr=Ft;class In{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let _=1;_<r.length-1;_+=2){const x=r[_];if("string"!=typeof x)return a.error(`Expected string, but found ${typeof x} instead.`,_);if(/[^a-zA-Z0-9_]/.test(x))return a.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=a.parse(r[_+1],_+1);if(!w)return null;h.push([x,w])}const f=a.parse(r[r.length-1],r.length-1,a.expectedType,h);return f?new In(h,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[a,h]of this.bindings)r.push(a,h.serialize());return r.push(this.result.serialize()),r}}var pr=In;class Ir{constructor(r,a,h){this.type=r,this.index=a,this.input=h}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,ct),f=a.parse(r[2],2,ao(a.expectedType||nn));return h&&f?new Ir(f.type.itemType,h,f):null}evaluate(r){const a=this.index.evaluate(r),h=this.input.evaluate(r);if(a<0)throw new Tr(`Array index out of bounds: ${a} < 0.`);if(a>=h.length)throw new Tr(`Array index out of bounds: ${a} > ${h.length-1}.`);if(a!==Math.floor(a))throw new Tr(`Array index must be an integer, but found ${a} instead.`);return h[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var pc=Ir;class Hr{constructor(r,a){this.type=yt,this.needle=r,this.haystack=a}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,nn),f=a.parse(r[2],2,nn);return h&&f?nt(h.type,[yt,ln,ct,sc,nn])?new Hr(h,f):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(h.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(null==h)return!1;if(!Aa(a,["boolean","string","number","null"]))throw new Tr(`Expected first argument to be of type boolean, string, number or null, but found ${ii(Ti(a))} instead.`);if(!Aa(h,["string","array"]))throw new Tr(`Expected second argument to be of type array or string, but found ${ii(Ti(h))} instead.`);return h.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var su=Hr;class mc{constructor(r,a,h){this.type=ct,this.needle=r,this.haystack=a,this.fromIndex=h}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,nn),f=a.parse(r[2],2,nn);if(!h||!f)return null;if(!nt(h.type,[yt,ln,ct,sc,nn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(h.type)} instead`);if(4===r.length){const _=a.parse(r[3],3,ct);return _?new mc(h,f,_):null}return new mc(h,f)}evaluate(r){const a=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!Aa(a,["boolean","string","number","null"]))throw new Tr(`Expected first argument to be of type boolean, string, number or null, but found ${ii(Ti(a))} instead.`);if(!Aa(h,["string","array"]))throw new Tr(`Expected second argument to be of type array or string, but found ${ii(Ti(h))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(r);return h.indexOf(a,f)}return h.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var au=mc;class cs{constructor(r,a,h,f,_,x){this.inputType=r,this.type=a,this.input=h,this.cases=f,this.outputs=_,this.otherwise=x}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let h,f;a.expectedType&&"value"!==a.expectedType.kind&&(f=a.expectedType);const _={},x=[];for(let S=2;S<r.length-1;S+=2){let P=r[S];const R=r[S+1];Array.isArray(P)||(P=[P]);const O=a.concat(S);if(0===P.length)return O.error("Expected at least one branch label.");for(const B of P){if("number"!=typeof B&&"string"!=typeof B)return O.error("Branch labels must be numbers or strings.");if("number"==typeof B&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof B&&Math.floor(B)!==B)return O.error("Numeric branch labels must be integer values.");if(h){if(O.checkSubtype(h,Ti(B)))return null}else h=Ti(B);if(void 0!==_[String(B)])return O.error("Branch labels must be unique.");_[String(B)]=x.length}const N=a.parse(R,S,f);if(!N)return null;f=f||N.type,x.push(N)}const w=a.parse(r[1],1,nn);if(!w)return null;const D=a.parse(r[r.length-1],r.length-1,f);return D?"value"!==w.type.kind&&a.concat(1).checkSubtype(h,w.type)?null:new cs(h,f,w,_,x,D):null}evaluate(r){const a=this.input.evaluate(r);return(Ti(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),h=[],f={};for(const x of a){const w=f[this.cases[x]];void 0===w?(f[this.cases[x]]=h.length,h.push([this.cases[x],[x]])):h[w][1].push(x)}const _=x=>"number"===this.inputType.kind?Number(x):x;for(const[x,w]of h)r.push(1===w.length?_(w[0]):w.map(_)),r.push(this.outputs[x].serialize());return r.push(this.otherwise.serialize()),r}}var wt=cs;class un{constructor(r,a,h){this.type=r,this.branches=a,this.otherwise=h}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let h;a.expectedType&&"value"!==a.expectedType.kind&&(h=a.expectedType);const f=[];for(let x=1;x<r.length-1;x+=2){const w=a.parse(r[x],x,yt);if(!w)return null;const D=a.parse(r[x+1],x+1,h);if(!D)return null;f.push([w,D]),h=h||D.type}const _=a.parse(r[r.length-1],r.length-1,h);return _?new un(h,f,_):null}evaluate(r){for(const[a,h]of this.branches)if(a.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,h]of this.branches)r(a),r(h);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(a=>{r.push(a.serialize())}),r}}var bi=un;class Gr{constructor(r,a,h,f){this.type=r,this.input=a,this.beginIndex=h,this.endIndex=f}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,nn),f=a.parse(r[2],2,ct);if(!h||!f)return null;if(!nt(h.type,[ao(nn),ln,nn]))return a.error(`Expected first argument to be of type array or string, but found ${ii(h.type)} instead`);if(4===r.length){const _=a.parse(r[3],3,ct);return _?new Gr(h.type,h,f,_):null}return new Gr(h.type,h,f)}evaluate(r){const a=this.input.evaluate(r),h=this.beginIndex.evaluate(r);if(!Aa(a,["string","array"]))throw new Tr(`Expected first argument to be of type array or string, but found ${ii(Ti(a))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(r);return a.slice(h,f)}return a.slice(h)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var La=Gr;function Ki(s,r){return"=="===s||"!="===s?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function bl(s,r,a,h){return 0===h.compare(r,a)}function li(s,r,a){const h="=="!==s&&"!="!==s;return class YR{constructor(_,x,w){this.type=yt,this.lhs=_,this.rhs=x,this.collator=w,this.hasUntypedArgument="value"===_.type.kind||"value"===x.type.kind}static parse(_,x){if(3!==_.length&&4!==_.length)return x.error("Expected two or three arguments.");const w=_[0];let D=x.parse(_[1],1,nn);if(!D)return null;if(!Ki(w,D.type))return x.concat(1).error(`"${w}" comparisons are not supported for type '${ii(D.type)}'.`);let S=x.parse(_[2],2,nn);if(!S)return null;if(!Ki(w,S.type))return x.concat(2).error(`"${w}" comparisons are not supported for type '${ii(S.type)}'.`);if(D.type.kind!==S.type.kind&&"value"!==D.type.kind&&"value"!==S.type.kind)return x.error(`Cannot compare types '${ii(D.type)}' and '${ii(S.type)}'.`);h&&("value"===D.type.kind&&"value"!==S.type.kind?D=new Pa(S.type,[D]):"value"!==D.type.kind&&"value"===S.type.kind&&(S=new Pa(D.type,[S])));let P=null;if(4===_.length){if("string"!==D.type.kind&&"string"!==S.type.kind&&"value"!==D.type.kind&&"value"!==S.type.kind)return x.error("Cannot use collator to compare non-string types.");if(P=x.parse(_[3],3,xo),!P)return null}return new YR(D,S,P)}evaluate(_){const x=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const D=Ti(x),S=Ti(w);if(D.kind!==S.kind||"string"!==D.kind&&"number"!==D.kind)throw new Tr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${D.kind}, ${S.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const D=Ti(x),S=Ti(w);if("string"!==D.kind||"string"!==S.kind)return r(_,x,w)}return this.collator?a(_,x,w,this.collator.evaluate(_)):r(_,x,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[s];return this.eachChild(x=>{_.push(x.serialize())}),_}}}const dh=li("==",function(s,r,a){return r===a},bl),fh=li("!=",function(s,r,a){return r!==a},function(s,r,a,h){return!bl(0,r,a,h)}),_n=li("<",function(s,r,a){return r<a},function(s,r,a,h){return h.compare(r,a)<0}),Gd=li(">",function(s,r,a){return r>a},function(s,r,a,h){return h.compare(r,a)>0}),lu=li("<=",function(s,r,a){return r<=a},function(s,r,a,h){return h.compare(r,a)<=0}),Wd=li(">=",function(s,r,a){return r>=a},function(s,r,a,h){return h.compare(r,a)>=0});class oa{constructor(r,a,h,f,_,x){this.type=ln,this.number=r,this.locale=a,this.currency=h,this.unit=f,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(r,a){if(3!==r.length)return a.error("Expected two arguments.");const h=a.parse(r[1],1,ct);if(!h)return null;const f=r[2];if("object"!=typeof f||Array.isArray(f))return a.error("NumberFormat options argument must be an object.");let _=null;if(f.locale&&(_=a.parse(f.locale,1,ln),!_))return null;let x=null;if(f.currency&&(x=a.parse(f.currency,1,ln),!x))return null;let w=null;if(f.unit&&(w=a.parse(f.unit,1,ln),!w))return null;let D=null;if(f["min-fraction-digits"]&&(D=a.parse(f["min-fraction-digits"],1,ct),!D))return null;let S=null;return f["max-fraction-digits"]&&(S=a.parse(f["max-fraction-digits"],1,ct),!S)?null:new oa(h,_,x,w,D,S)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Ni{constructor(r){this.type=ct,this.input=r}static parse(r,a){if(2!==r.length)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=a.parse(r[1],1);return h?"array"!==h.type.kind&&"string"!==h.type.kind&&"value"!==h.type.kind?a.error(`Expected argument of type string or array, but found ${ii(h.type)} instead.`):new Ni(h):null}evaluate(r){const a=this.input.evaluate(r);if("string"==typeof a||Array.isArray(a))return a.length;throw new Tr(`Expected value to be of type string or array, but found ${ii(Ti(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(a=>{r.push(a.serialize())}),r}}const gc={"==":dh,"!=":fh,">":Gd,"<":_n,">=":Wd,"<=":lu,array:Pa,at:pc,boolean:Pa,case:bi,coalesce:Mr,collator:ac,format:gl,image:Bd,in:su,"index-of":au,interpolate:ls,"interpolate-hcl":ls,"interpolate-lab":ls,length:Ni,let:pr,literal:ml,match:wt,number:Pa,"number-format":oa,object:Pa,slice:La,step:tu,string:Pa,"to-boolean":Ui,"to-color":Ui,"to-number":Ui,"to-string":Ui,var:vl,within:lh};function wl(s,[r,a,h,f]){r=r.evaluate(s),a=a.evaluate(s),h=h.evaluate(s);const _=f?f.evaluate(s):1,x=vg(r,a,h,_);if(x)throw new Tr(x);return new Fi(r/255*_,a/255*_,h/255*_,_)}function lr(s,r){return s in r}function Fa(s,r){const a=r[s];return void 0===a?null:a}function wo(s){return{type:s}}ta.register(gc,{error:[{kind:"error"},[ln],(s,[r])=>{throw new Tr(r.evaluate(s))}],typeof:[ln,[nn],(s,[r])=>ii(Ti(r.evaluate(s)))],"to-rgba":[ao(ct,4),[$r],(s,[r])=>r.evaluate(s).toArray()],rgb:[$r,[ct,ct,ct],wl],rgba:[$r,[ct,ct,ct,ct],wl],has:{type:yt,overloads:[[[ln],(s,[r])=>lr(r.evaluate(s),s.properties())],[[ln,Tn],(s,[r,a])=>lr(r.evaluate(s),a.evaluate(s))]]},get:{type:nn,overloads:[[[ln],(s,[r])=>Fa(r.evaluate(s),s.properties())],[[ln,Tn],(s,[r,a])=>Fa(r.evaluate(s),a.evaluate(s))]]},"feature-state":[nn,[ln],(s,[r])=>Fa(r.evaluate(s),s.featureState||{})],properties:[Tn,[],s=>s.properties()],"geometry-type":[ln,[],s=>s.geometryType()],id:[nn,[],s=>s.id()],zoom:[ct,[],s=>s.globals.zoom],pitch:[ct,[],s=>s.globals.pitch||0],"distance-from-center":[ct,[],s=>s.distanceFromCenter()],"heatmap-density":[ct,[],s=>s.globals.heatmapDensity||0],"line-progress":[ct,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[ct,[],s=>s.globals.skyRadialProgress||0],accumulated:[nn,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[ct,wo(ct),(s,r)=>{let a=0;for(const h of r)a+=h.evaluate(s);return a}],"*":[ct,wo(ct),(s,r)=>{let a=1;for(const h of r)a*=h.evaluate(s);return a}],"-":{type:ct,overloads:[[[ct,ct],(s,[r,a])=>r.evaluate(s)-a.evaluate(s)],[[ct],(s,[r])=>-r.evaluate(s)]]},"/":[ct,[ct,ct],(s,[r,a])=>r.evaluate(s)/a.evaluate(s)],"%":[ct,[ct,ct],(s,[r,a])=>r.evaluate(s)%a.evaluate(s)],ln2:[ct,[],()=>Math.LN2],pi:[ct,[],()=>Math.PI],e:[ct,[],()=>Math.E],"^":[ct,[ct,ct],(s,[r,a])=>Math.pow(r.evaluate(s),a.evaluate(s))],sqrt:[ct,[ct],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[ct,[ct],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[ct,[ct],(s,[r])=>Math.log(r.evaluate(s))],log2:[ct,[ct],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[ct,[ct],(s,[r])=>Math.sin(r.evaluate(s))],cos:[ct,[ct],(s,[r])=>Math.cos(r.evaluate(s))],tan:[ct,[ct],(s,[r])=>Math.tan(r.evaluate(s))],asin:[ct,[ct],(s,[r])=>Math.asin(r.evaluate(s))],acos:[ct,[ct],(s,[r])=>Math.acos(r.evaluate(s))],atan:[ct,[ct],(s,[r])=>Math.atan(r.evaluate(s))],min:[ct,wo(ct),(s,r)=>Math.min(...r.map(a=>a.evaluate(s)))],max:[ct,wo(ct),(s,r)=>Math.max(...r.map(a=>a.evaluate(s)))],abs:[ct,[ct],(s,[r])=>Math.abs(r.evaluate(s))],round:[ct,[ct],(s,[r])=>{const a=r.evaluate(s);return a<0?-Math.round(-a):Math.round(a)}],floor:[ct,[ct],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[ct,[ct],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[yt,[ln,nn],(s,[r,a])=>s.properties()[r.value]===a.value],"filter-id-==":[yt,[nn],(s,[r])=>s.id()===r.value],"filter-type-==":[yt,[ln],(s,[r])=>s.geometryType()===r.value],"filter-<":[yt,[ln,nn],(s,[r,a])=>{const h=s.properties()[r.value],f=a.value;return typeof h==typeof f&&h<f}],"filter-id-<":[yt,[nn],(s,[r])=>{const a=s.id(),h=r.value;return typeof a==typeof h&&a<h}],"filter->":[yt,[ln,nn],(s,[r,a])=>{const h=s.properties()[r.value],f=a.value;return typeof h==typeof f&&h>f}],"filter-id->":[yt,[nn],(s,[r])=>{const a=s.id(),h=r.value;return typeof a==typeof h&&a>h}],"filter-<=":[yt,[ln,nn],(s,[r,a])=>{const h=s.properties()[r.value],f=a.value;return typeof h==typeof f&&h<=f}],"filter-id-<=":[yt,[nn],(s,[r])=>{const a=s.id(),h=r.value;return typeof a==typeof h&&a<=h}],"filter->=":[yt,[ln,nn],(s,[r,a])=>{const h=s.properties()[r.value],f=a.value;return typeof h==typeof f&&h>=f}],"filter-id->=":[yt,[nn],(s,[r])=>{const a=s.id(),h=r.value;return typeof a==typeof h&&a>=h}],"filter-has":[yt,[nn],(s,[r])=>r.value in s.properties()],"filter-has-id":[yt,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[yt,[ao(ln)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[yt,[ao(nn)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[yt,[ln,ao(nn)],(s,[r,a])=>a.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[yt,[ln,ao(nn)],(s,[r,a])=>function(h,f,_,x){for(;_<=x;){const w=_+x>>1;if(f[w]===h)return!0;f[w]>h?x=w-1:_=w+1}return!1}(s.properties()[r.value],a.value,0,a.value.length-1)],all:{type:yt,overloads:[[[yt,yt],(s,[r,a])=>r.evaluate(s)&&a.evaluate(s)],[wo(yt),(s,r)=>{for(const a of r)if(!a.evaluate(s))return!1;return!0}]]},any:{type:yt,overloads:[[[yt,yt],(s,[r,a])=>r.evaluate(s)||a.evaluate(s)],[wo(yt),(s,r)=>{for(const a of r)if(a.evaluate(s))return!0;return!1}]]},"!":[yt,[yt],(s,[r])=>!r.evaluate(s)],"is-supported-script":[yt,[ln],(s,[r])=>{const a=s.globals&&s.globals.isSupportedScript;return!a||a(r.evaluate(s))}],upcase:[ln,[ln],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[ln,[ln],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[ln,wo(nn),(s,r)=>r.map(a=>Kc(a.evaluate(s))).join("")],"resolved-locale":[ln,[xo],(s,[r])=>r.evaluate(s).resolvedLocale()]});var Kn=gc;function bg(s){return{result:"success",value:s}}function sa(s){return{result:"error",value:s}}function Cl(s){return"data-driven"===s["property-type"]}function El(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Dl(s){return!!s.expression&&s.expression.interpolated}function gn(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function Ji(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function wg(s){return s}function Ar(s,r){const a="color"===r.type,h=s.stops&&"object"==typeof s.stops[0][0],f=h||!(h||void 0!==s.property),_=s.type||(Dl(r)?"exponential":"interval");if(a&&((s=Qs({},s)).stops&&(s.stops=s.stops.map(S=>[S[0],Fi.parse(S[1])])),s.default=Fi.parse(s.default?s.default:r.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!$d[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let x,w,D;if("exponential"===_)x=$o;else if("interval"===_)x=za;else if("categorical"===_){x=ph,w=Object.create(null);for(const S of s.stops)w[S[0]]=S[1];D=typeof s.stops[0][0]}else{if("identity"!==_)throw new Error(`Unknown function type "${_}"`);x=Ho}if(h){const S={},P=[];for(let N=0;N<s.stops.length;N++){const B=s.stops[N],$=B[0].zoom;void 0===S[$]&&(S[$]={zoom:$,type:s.type,property:s.property,default:s.default,stops:[]},P.push($)),S[$].stops.push([B[0].value,B[1]])}const R=[];for(const N of P)R.push([S[N].zoom,Ar(S[N],r)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:ls.interpolationFactor.bind(void 0,O),zoomStops:R.map(N=>N[0]),evaluate:({zoom:N},B)=>$o({stops:R,base:s.base},r,N).evaluate(N,B)}}if(f){const S="exponential"===_?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:ls.interpolationFactor.bind(void 0,S),zoomStops:s.stops.map(P=>P[0]),evaluate:({zoom:P})=>x(s,r,P,w,D)}}return{kind:"source",evaluate(S,P){const R=P&&P.properties?P.properties[s.property]:void 0;return void 0===R?Pr(s.default,r.default):x(s,r,R,w,D)}}}function Pr(s,r,a){return void 0!==s?s:void 0!==r?r:void 0!==a?a:void 0}function ph(s,r,a,h,f){return Pr(typeof a===f?h[a]:void 0,s.default,r.default)}function za(s,r,a){if("number"!==gn(a))return Pr(s.default,r.default);const h=s.stops.length;if(1===h||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[h-1][0])return s.stops[h-1][1];const f=cn(s.stops.map(_=>_[0]),a);return s.stops[f][1]}function $o(s,r,a){const h=void 0!==s.base?s.base:1;if("number"!==gn(a))return Pr(s.default,r.default);const f=s.stops.length;if(1===f||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[f-1][0])return s.stops[f-1][1];const _=cn(s.stops.map(P=>P[0]),a),x=function(P,R,O,N){const B=N-O,$=P-O;return 0===B?0:1===R?$/B:(Math.pow(R,$)-1)/(Math.pow(R,B)-1)}(a,h,s.stops[_][0],s.stops[_+1][0]),w=s.stops[_][1],D=s.stops[_+1][1];let S=nu[r.type]||wg;if(s.colorSpace&&"rgb"!==s.colorSpace){const P=$d[s.colorSpace];S=(R,O)=>P.reverse(P.interpolate(P.forward(R),P.forward(O),x))}return"function"==typeof w.evaluate?{evaluate(...P){const R=w.evaluate.apply(void 0,P),O=D.evaluate.apply(void 0,P);if(void 0!==R&&void 0!==O)return S(R,O,x)}}:S(w,D,x)}function Ho(s,r,a){return"color"===r.type?a=Fi.parse(a):"formatted"===r.type?a=zi.fromString(a.toString()):"resolvedImage"===r.type?a=as.fromString(a.toString()):gn(a)===r.type||"enum"===r.type&&r.values[a]||(a=void 0),Pr(a,s.default,r.default)}class mh{constructor(r,a){var h;this.expression=r,this._warningHistory={},this._evaluator=new Vd,this._defaultValue=a?"color"===(h=a).type&&(Ji(h.default)||Array.isArray(h.default))?new Fi(0,0,0,0):"color"===h.type?Fi.parse(h.default)||null:void 0===h.default?null:h.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(r,a,h,f,_,x,w,D){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=h,this._evaluator.canonical=f||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(r,a,h,f,_,x,w,D){this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=h||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=D||null;try{const S=this.expression.evaluate(this._evaluator);if(null==S||"number"==typeof S&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Tr(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function cu(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in Kn}function _c(s,r){const a=new Dt(Kn,[],r?function(f){const _={color:$r,string:ln,number:ct,enum:ln,boolean:yt,formatted:Hn,resolvedImage:Pt};return"array"===f.type?ao(_[f.value]||nn,f.length):_[f.type]}(r):void 0),h=a.parse(s,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return h?bg(new mh(h,r)):sa(a.errors)}class qd{constructor(r,a){this.kind=r,this._styleExpression=a,this.isStateDependent="constant"!==r&&!ia(a.expression)}evaluateWithoutErrorHandling(r,a,h,f,_,x){return this._styleExpression.evaluateWithoutErrorHandling(r,a,h,f,_,x)}evaluate(r,a,h,f,_,x){return this._styleExpression.evaluate(r,a,h,f,_,x)}}class gh{constructor(r,a,h,f){this.kind=r,this.zoomStops=h,this._styleExpression=a,this.isStateDependent="camera"!==r&&!ia(a.expression),this.interpolationType=f}evaluateWithoutErrorHandling(r,a,h,f,_,x){return this._styleExpression.evaluateWithoutErrorHandling(r,a,h,f,_,x)}evaluate(r,a,h,f,_,x){return this._styleExpression.evaluate(r,a,h,f,_,x)}interpolationFactor(r,a,h){return this.interpolationType?ls.interpolationFactor(this.interpolationType,r,a,h):0}}function _h(s,r){if("error"===(s=_c(s,r)).result)return s;const a=s.value.expression,h=hc(a);if(!h&&!Cl(r))return sa([new Is("","data expressions not supported")]);const f=Ra(a,["zoom","pitch","distance-from-center"]);if(!f&&!El(r))return sa([new Is("","zoom expressions not supported")]);const _=Xd(a);return _||f?_ instanceof Is?sa([_]):_ instanceof ls&&!Dl(r)?sa([new Is("",'"interpolate" expressions cannot be used with this property')]):bg(_?new gh(h?"camera":"composite",s.value,_.labels,_ instanceof ls?_.interpolation:void 0):new qd(h?"constant":"source",s.value)):sa([new Is("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Zd{constructor(r,a){this._parameters=r,this._specification=a,Qs(this,Ar(this._parameters,this._specification))}static deserialize(r){return new Zd(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Xd(s){let r=null;if(s instanceof pr)r=Xd(s.result);else if(s instanceof Mr){for(const a of s.args)if(r=Xd(a),r)break}else(s instanceof tu||s instanceof ls)&&s.input instanceof ta&&"zoom"===s.input.name&&(r=s);return r instanceof Is||s.eachChild(a=>{const h=Xd(a);h instanceof Is?r=h:!r&&h?r=new Is("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new Is("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class ut{constructor(r,a,h,f){this.message=(r?`${r}: `:"")+h,f&&(this.identifier=f),null!=a&&a.__line__&&(this.line=a.__line__)}}function Rs(s){const r=s.key,a=s.value,h=s.valueSpec||{},f=s.objectElementValidators||{},_=s.style,x=s.styleSpec;let w=[];const D=gn(a);if("object"!==D)return[new ut(r,a,`object expected, ${D} found`)];for(const S in a){const P=S.split(".")[0];let R;f[P]?R=f[P]:h[P]?R=kr:f["*"]?R=f["*"]:h["*"]&&(R=kr),R?w=w.concat(R({key:(r&&`${r}.`)+S,value:a[S],valueSpec:h[P]||h["*"],style:_,styleSpec:x,object:a,objectKey:S},a)):w.push(new ut(r,a[S],`unknown property "${S}"`))}for(const S in h)f[S]||h[S].required&&void 0===h[S].default&&void 0===a[S]&&w.push(new ut(r,a,`missing required property "${S}"`));return w}function Cg(s){const r=s.value,a=s.valueSpec,h=s.style,f=s.styleSpec,_=s.key,x=s.arrayElementValidator||kr;if("array"!==gn(r))return[new ut(_,r,`array expected, ${gn(r)} found`)];if(a.length&&r.length!==a.length)return[new ut(_,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new ut(_,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let w={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};f.$version<7&&(w.function=a.function),"object"===gn(a.value)&&(w=a.value);let D=[];for(let S=0;S<r.length;S++)D=D.concat(x({array:r,arrayIndex:S,value:r[S],valueSpec:w,style:h,styleSpec:f,key:`${_}[${S}]`}));return D}function yh(s){const r=s.key,a=s.value,h=s.valueSpec;let f=gn(a);if("number"===f&&a!=a&&(f="NaN"),"number"!==f)return[new ut(r,a,`number expected, ${f} found`)];if("minimum"in h){let _=h.minimum;if("array"===gn(h.minimum)&&(_=h.minimum[s.arrayIndex]),a<_)return[new ut(r,a,`${a} is less than the minimum value ${_}`)]}if("maximum"in h){let _=h.maximum;if("array"===gn(h.maximum)&&(_=h.maximum[s.arrayIndex]),a>_)return[new ut(r,a,`${a} is greater than the maximum value ${_}`)]}return[]}function vh(s){const r=s.valueSpec,a=Oi(s.value.type);let h,f,_,x={};const w="categorical"!==a&&void 0===s.value.property,D=!w,S="array"===gn(s.value.stops)&&"array"===gn(s.value.stops[0])&&"object"===gn(s.value.stops[0][0]),P=Rs({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(N){if("identity"===a)return[new ut(N.key,N.value,'identity function may not have a "stops" property')];let B=[];const $=N.value;return B=B.concat(Cg({key:N.key,value:$,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:R})),"array"===gn($)&&0===$.length&&B.push(new ut(N.key,$,"array must have at least one stop")),B},default:function(N){return kr({key:N.key,value:N.value,valueSpec:r,style:N.style,styleSpec:N.styleSpec})}}});return"identity"===a&&w&&P.push(new ut(s.key,s.value,'missing required property "property"')),"identity"===a||s.value.stops||P.push(new ut(s.key,s.value,'missing required property "stops"')),"exponential"===a&&s.valueSpec.expression&&!Dl(s.valueSpec)&&P.push(new ut(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(D&&!Cl(s.valueSpec)?P.push(new ut(s.key,s.value,"property functions not supported")):w&&!El(s.valueSpec)&&P.push(new ut(s.key,s.value,"zoom functions not supported"))),"categorical"!==a&&!S||void 0!==s.value.property||P.push(new ut(s.key,s.value,'"property" property is required')),P;function R(N){let B=[];const $=N.value,Z=N.key;if("array"!==gn($))return[new ut(Z,$,`array expected, ${gn($)} found`)];if(2!==$.length)return[new ut(Z,$,`array length 2 expected, length ${$.length} found`)];if(S){if("object"!==gn($[0]))return[new ut(Z,$,`object expected, ${gn($[0])} found`)];if(void 0===$[0].zoom)return[new ut(Z,$,"object stop key must have zoom")];if(void 0===$[0].value)return[new ut(Z,$,"object stop key must have value")];const te=Oi($[0].zoom);if("number"!=typeof te)return[new ut(Z,$[0].zoom,"stop zoom values must be numbers")];if(_&&_>te)return[new ut(Z,$[0].zoom,"stop zoom values must appear in ascending order")];te!==_&&(_=te,f=void 0,x={}),B=B.concat(Rs({key:`${Z}[0]`,value:$[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:yh,value:O}}))}else B=B.concat(O({key:`${Z}[0]`,value:$[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},$));return cu(sr($[1]))?B.concat([new ut(`${Z}[1]`,$[1],"expressions are not allowed in function stops.")]):B.concat(kr({key:`${Z}[1]`,value:$[1],valueSpec:r,style:N.style,styleSpec:N.styleSpec}))}function O(N,B){const $=gn(N.value),Z=Oi(N.value),te=null!==N.value?N.value:B;if(h){if($!==h)return[new ut(N.key,te,`${$} stop domain type must match previous stop domain type ${h}`)]}else h=$;if("number"!==$&&"string"!==$&&"boolean"!==$&&"number"!=typeof Z&&"string"!=typeof Z&&"boolean"!=typeof Z)return[new ut(N.key,te,"stop domain value must be a number, string, or boolean")];if("number"!==$&&"categorical"!==a){let ce=`number expected, ${$} found`;return Cl(r)&&void 0===a&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ut(N.key,te,ce)]}return"categorical"!==a||"number"!==$||"number"==typeof Z&&isFinite(Z)&&Math.floor(Z)===Z?"categorical"!==a&&"number"===$&&"number"==typeof Z&&"number"==typeof f&&void 0!==f&&Z<f?[new ut(N.key,te,"stop domain values must appear in ascending order")]:(f=Z,"categorical"===a&&Z in x?[new ut(N.key,te,"stop domain values must be unique")]:(x[Z]=!0,[])):[new ut(N.key,te,`integer expected, found ${String(Z)}`)]}}function mr(s){const r=("property"===s.expressionContext?_h:_c)(sr(s.value),s.valueSpec);if("error"===r.result)return r.value.map(h=>new ut(`${s.key}${h.key}`,s.value,h.message));const a=r.value.expression||r.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!a.outputDefined())return[new ut(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!ia(a))return[new ut(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext)return xh(a,s);if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!Ra(a,["zoom","feature-state"]))return[new ut(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!hc(a))return[new ut(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xh(s,r){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const f of r.valueSpec.expression.parameters)a.delete(f);if(0===a.size)return[];const h=[];return s instanceof ta&&a.has(s.name)?[new ut(r.key,r.value,`["${s.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(s.eachChild(f=>{h.push(...xh(f,r))}),h)}function Yd(s){const r=s.key,a=s.value,h=s.valueSpec,f=[];return Array.isArray(h.values)?-1===h.values.indexOf(Oi(a))&&f.push(new ut(r,a,`expected one of [${h.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(h.values).indexOf(Oi(a))&&f.push(new ut(r,a,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(a)} found`)),f}function bh(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!bh(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function uu(s,r="fill"){if(null==s)return{filter:()=>!0,needGeometry:!1,needFeature:!1};bh(s)||(s=Tl(s));const a=s;let h=!0;try{h=function(S){if(!hu(S))return S;let P=sr(S);return Kd(P),P=Eg(P),P}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const f=ze[`filter_${r}`],_=_c(h,f);let x=null;if("error"===_.result)throw new Error(_.value.map(S=>`${S.key}: ${S.message}`).join(", "));x=(S,P,R)=>_.value.evaluate(S,P,{},R);let w=null,D=null;if(h!==a){const S=_c(a,f);if("error"===S.result)throw new Error(S.value.map(P=>`${P.key}: ${P.message}`).join(", "));w=(P,R,O,N,B)=>S.value.evaluate(P,R,{},O,void 0,void 0,N,B),D=!hc(S.value.expression)}return{filter:x,dynamicFilter:w||void 0,needGeometry:Wr(h),needFeature:!!D}}function Eg(s){if(!Array.isArray(s))return s;const r=function(a){if(aa.has(a[0]))for(let h=1;h<a.length;h++)if(hu(a[h]))return!0;return a}(s);return!0===r?r:r.map(a=>Eg(a))}function Kd(s){let r=!1;const a=[];if("case"===s[0]){for(let h=1;h<s.length-1;h+=2)r=r||hu(s[h]),a.push(s[h+1]);a.push(s[s.length-1])}else if("match"===s[0]){r=r||hu(s[1]);for(let h=2;h<s.length-1;h+=2)a.push(s[h+1]);a.push(s[s.length-1])}else if("step"===s[0]){r=r||hu(s[1]);for(let h=1;h<s.length-1;h+=2)a.push(s[h+1])}r&&(s.length=0,s.push("any",...a));for(let h=1;h<s.length;h++)Kd(s[h])}function hu(s){if(!Array.isArray(s))return!1;if("pitch"===(r=s[0])||"distance-from-center"===r)return!0;var r;for(let a=1;a<s.length;a++)if(hu(s[a]))return!0;return!1}const aa=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Dg(s,r){return s<r?-1:s>r?1:0}function Wr(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let r=1;r<s.length;r++)if(Wr(s[r]))return!0;return!1}function Tl(s){if(!s)return!0;const r=s[0];return s.length<=1?"any"!==r:"=="===r?Jd(s[1],s[2],"=="):"!="===r?du(Jd(s[1],s[2],"==")):"<"===r||">"===r||"<="===r||">="===r?Jd(s[1],s[2],r):"any"===r?(a=s.slice(1),["any"].concat(a.map(Tl))):"all"===r?["all"].concat(s.slice(1).map(Tl)):"none"===r?["all"].concat(s.slice(1).map(Tl).map(du)):"in"===r?Qd(s[1],s.slice(2)):"!in"===r?du(Qd(s[1],s.slice(2))):"has"===r?wh(s[1]):"!has"===r?du(wh(s[1])):"within"!==r||s;var a}function Jd(s,r,a){switch(s){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,s,r]}}function Qd(s,r){if(0===r.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",s,["literal",r.sort(Dg)]]:["filter-in-small",s,["literal",r]]}}function wh(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function du(s){return["!",s]}function fu(s){return bh(sr(s.value))?mr(Qs({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):Sl(s)}function Sl(s){const r=s.value,a=s.key;if("array"!==gn(r))return[new ut(a,r,`array expected, ${gn(r)} found`)];const h=s.styleSpec;let f,_=[];if(r.length<1)return[new ut(a,r,"filter array must have at least 1 element")];switch(_=_.concat(Yd({key:`${a}[0]`,value:r[0],valueSpec:h.filter_operator,style:s.style,styleSpec:s.styleSpec})),Oi(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Oi(r[1])&&_.push(new ut(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&_.push(new ut(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(f=gn(r[1]),"string"!==f&&_.push(new ut(`${a}[1]`,r[1],`string expected, ${f} found`)));for(let x=2;x<r.length;x++)f=gn(r[x]),"$type"===Oi(r[1])?_=_.concat(Yd({key:`${a}[${x}]`,value:r[x],valueSpec:h.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&_.push(new ut(`${a}[${x}]`,r[x],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)_=_.concat(Sl({key:`${a}[${x}]`,value:r[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":f=gn(r[1]),2!==r.length?_.push(new ut(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==f&&_.push(new ut(`${a}[1]`,r[1],`string expected, ${f} found`));break;case"within":f=gn(r[1]),2!==r.length?_.push(new ut(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==f&&_.push(new ut(`${a}[1]`,r[1],`object expected, ${f} found`))}return _}function ef(s,r){const a=s.key,h=s.style,f=s.styleSpec,_=s.value,x=s.objectKey,w=f[`${r}_${s.layerType}`];if(!w)return[];const D=x.match(/^(.*)-transition$/);if("paint"===r&&D&&w[D[1]]&&w[D[1]].transition)return kr({key:a,value:_,valueSpec:f.transition,style:h,styleSpec:f});const S=s.valueSpec||w[x];if(!S)return[new ut(a,_,`unknown property "${x}"`)];let P;if("string"===gn(_)&&Cl(S)&&!S.tokens&&(P=/^{([^}]+)}$/.exec(_))){const O=`\`{ "type": "identity", "property": ${P?JSON.stringify(P[1]):'"_"'} }\``;return[new ut(a,_,`"${x}" does not support interpolation syntax\nUse an identity property function instead: ${O}.`)]}const R=[];return"symbol"===s.layerType&&("text-field"===x&&h&&!h.glyphs&&R.push(new ut(a,_,'use of "text-field" requires a style "glyphs" property')),"text-font"===x&&Ji(sr(_))&&"identity"===Oi(_.type)&&R.push(new ut(a,_,'"text-font" does not support identity functions'))),R.concat(kr({key:s.key,value:_,valueSpec:S,style:h,styleSpec:f,expressionContext:"property",propertyType:r,propertyKey:x}))}function Co(s){return ef(s,"paint")}function Ch(s){return ef(s,"layout")}function tf(s){let r=[];const a=s.value,h=s.key,f=s.style,_=s.styleSpec;a.type||a.ref||r.push(new ut(h,a,'either "type" or "ref" is required'));let x=Oi(a.type);const w=Oi(a.ref);if(a.id){const D=Oi(a.id);for(let S=0;S<s.arrayIndex;S++){const P=f.layers[S];Oi(P.id)===D&&r.push(new ut(h,a.id,`duplicate layer id "${a.id}", previously used at line ${P.id.__line__}`))}}if("ref"in a){let D;["type","source","source-layer","filter","layout"].forEach(S=>{S in a&&r.push(new ut(h,a[S],`"${S}" is prohibited for ref layers`))}),f.layers.forEach(S=>{Oi(S.id)===w&&(D=S)}),D?D.ref?r.push(new ut(h,a.ref,"ref cannot reference another ref layer")):x=Oi(D.type):"string"==typeof w&&r.push(new ut(h,a.ref,`ref layer "${w}" not found`))}else if("background"!==x&&"sky"!==x)if(a.source){const D=f.sources&&f.sources[a.source],S=D&&Oi(D.type);D?"vector"===S&&"raster"===x?r.push(new ut(h,a.source,`layer "${a.id}" requires a raster source`)):"raster"===S&&"raster"!==x?r.push(new ut(h,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==S||a["source-layer"]?"raster-dem"===S&&"hillshade"!==x?r.push(new ut(h,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==x||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||"geojson"===S&&D.lineMetrics||r.push(new ut(h,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new ut(h,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new ut(h,a.source,`source "${a.source}" not found`))}else r.push(new ut(h,a,'missing required property "source"'));return r=r.concat(Rs({key:h,value:a,valueSpec:_.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>kr({key:`${h}.type`,value:a.type,valueSpec:_.layer.type,style:s.style,styleSpec:s.styleSpec,object:a,objectKey:"type"}),filter:D=>fu(Qs({layerType:x},D)),layout:D=>Rs({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":S=>Ch(Qs({layerType:x},S))}}),paint:D=>Rs({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":S=>Co(Qs({layerType:x},S))}})}})),r}function _i(s){const r=s.value,a=s.key,h=gn(r);return"string"!==h?[new ut(a,r,`string expected, ${h} found`)]:[]}const Pp={promoteId:function({key:s,value:r}){if("string"===gn(r))return _i({key:s,value:r});{const a=[];for(const h in r)a.push(..._i({key:`${s}.${h}`,value:r[h]}));return a}}};function pu(s){const r=s.value,a=s.key,h=s.styleSpec,f=s.style;if(!r.type)return[new ut(a,r,'"type" is required')];const _=Oi(r.type);let x;switch(_){case"vector":case"raster":case"raster-dem":return x=Rs({key:a,value:r,valueSpec:h[`source_${_.replace("-","_")}`],style:s.style,styleSpec:h,objectElementValidators:Pp}),x;case"geojson":if(x=Rs({key:a,value:r,valueSpec:h.source_geojson,style:f,styleSpec:h,objectElementValidators:Pp}),r.cluster)for(const w in r.clusterProperties){const[D,S]=r.clusterProperties[w],P="string"==typeof D?[D,["accumulated"],["get",w]]:D;x.push(...mr({key:`${a}.${w}.map`,value:S,expressionContext:"cluster-map"})),x.push(...mr({key:`${a}.${w}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return x;case"video":return Rs({key:a,value:r,valueSpec:h.source_video,style:f,styleSpec:h});case"image":return Rs({key:a,value:r,valueSpec:h.source_image,style:f,styleSpec:h});case"canvas":return[new ut(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Yd({key:`${a}.type`,value:r.type,valueSpec:{values:Eo(h)},style:f,styleSpec:h})}}function Eo(s){return s.source.reduce((r,a)=>{const h=s[a];return"enum"===h.type.type&&(r=r.concat(Object.keys(h.type.values))),r},[])}function kp(s){const r=s.value,a=s.styleSpec,h=a.light,f=s.style;let _=[];const x=gn(r);if(void 0===r)return _;if("object"!==x)return _=_.concat([new ut("light",r,`object expected, ${x} found`)]),_;for(const w in r){const D=w.match(/^(.*)-transition$/);_=_.concat(D&&h[D[1]]&&h[D[1]].transition?kr({key:w,value:r[w],valueSpec:a.transition,style:f,styleSpec:a}):h[w]?kr({key:w,value:r[w],valueSpec:h[w],style:f,styleSpec:a}):[new ut(w,r[w],`unknown property "${w}"`)])}return _}function Eh(s){const r=s.value,a=s.key,h=s.style,f=s.styleSpec,_=f.terrain;let x=[];const w=gn(r);if(void 0===r)return x;if("object"!==w)return x=x.concat([new ut("terrain",r,`object expected, ${w} found`)]),x;for(const D in r){const S=D.match(/^(.*)-transition$/);x=x.concat(S&&_[S[1]]&&_[S[1]].transition?kr({key:D,value:r[D],valueSpec:f.transition,style:h,styleSpec:f}):_[D]?kr({key:D,value:r[D],valueSpec:_[D],style:h,styleSpec:f}):[new ut(D,r[D],`unknown property "${D}"`)])}if(r.source){const D=h.sources&&h.sources[r.source],S=D&&Oi(D.type);D?"raster-dem"!==S&&x.push(new ut(a,r.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):x.push(new ut(a,r.source,`source "${r.source}" not found`))}else x.push(new ut(a,r,'terrain is missing required property "source"'));return x}function Ml(s){const r=s.value,a=s.style,h=s.styleSpec,f=h.fog;let _=[];const x=gn(r);if(void 0===r)return _;if("object"!==x)return _=_.concat([new ut("fog",r,`object expected, ${x} found`)]),_;for(const w in r){const D=w.match(/^(.*)-transition$/);_=_.concat(D&&f[D[1]]&&f[D[1]].transition?kr({key:w,value:r[w],valueSpec:h.transition,style:a,styleSpec:h}):f[w]?kr({key:w,value:r[w],valueSpec:f[w],style:a,styleSpec:h}):[new ut(w,r[w],`unknown property "${w}"`)])}return _}const qr={"*":()=>[],array:Cg,boolean:function(s){const r=s.value,a=s.key,h=gn(r);return"boolean"!==h?[new ut(a,r,`boolean expected, ${h} found`)]:[]},number:yh,color:function(s){const r=s.key,a=s.value,h=gn(a);return"string"!==h?[new ut(r,a,`color expected, ${h} found`)]:null===Jt(a)?[new ut(r,a,`color expected, "${a}" found`)]:[]},enum:Yd,filter:fu,function:vh,layer:tf,object:Rs,source:pu,light:kp,terrain:Eh,fog:Ml,string:_i,formatted:function(s){return 0===_i(s).length?[]:mr(s)},resolvedImage:function(s){return 0===_i(s).length?[]:mr(s)},projection:function(s){const r=s.value,a=s.styleSpec,h=a.projection,f=s.style;let _=[];const x=gn(r);if("object"===x)for(const w in r)_=_.concat(kr({key:w,value:r[w],valueSpec:h[w],style:f,styleSpec:a}));else"string"!==x&&(_=_.concat([new ut("projection",r,`object or string expected, ${x} found`)]));return _}};function kr(s){const r=s.value,a=s.valueSpec,h=s.styleSpec;return a.expression&&Ji(Oi(r))?vh(s):a.expression&&cu(sr(r))?mr(s):a.type&&qr[a.type]?qr[a.type](s):Rs(Qs({},s,{valueSpec:a.type?h[a.type]:a}))}function Dh(s){const r=s.value,a=s.key,h=_i(s);return h.length||(-1===r.indexOf("{fontstack}")&&h.push(new ut(a,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&h.push(new ut(a,r,'"glyphs" url must include a "{range}" token'))),h}function Rp(s,r=ze){return uo(kr({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,objectElementValidators:{glyphs:Dh,"*":()=>[]}}))}const Na=s=>uo(Co(s)),Op=s=>uo(Ch(s));function uo(s){return s.slice().sort((r,a)=>r.line&&a.line?r.line-a.line:0)}function rn(s,r){let a=!1;if(r&&r.length)for(const h of r)s.fire(new Ms(new Error(h.message))),a=!0;return a}var Lp=Ls,Os=3;function Ls(s,r,a){var h=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var f=new Int32Array(this.arrayBuffer);s=f[0],this.d=(r=f[1])+2*(a=f[2]);for(var _=0;_<this.d*this.d;_++){var x=f[Os+_],w=f[Os+_+1];h.push(x===w?null:f.subarray(x,w))}var D=f[Os+h.length+1];this.keys=f.subarray(f[Os+h.length],D),this.bboxes=f.subarray(D),this.insert=this._insertReadonly}else{this.d=r+2*a;for(var S=0;S<this.d*this.d;S++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=s,this.padding=a,this.scale=r/s,this.uid=0;var P=a/r*s;this.min=-P,this.max=s+P}Ls.prototype.insert=function(s,r,a,h,f){this._forEachCell(r,a,h,f,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(f)},Ls.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ls.prototype._insertCell=function(s,r,a,h,f,_){this.cells[f].push(_)},Ls.prototype.query=function(s,r,a,h,f){var _=this.min,x=this.max;if(s<=_&&r<=_&&x<=a&&x<=h&&!f)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(s,r,a,h,this._queryCell,w,{},f),w},Ls.prototype._queryCell=function(s,r,a,h,f,_,x,w){var D=this.cells[f];if(null!==D)for(var S=this.keys,P=this.bboxes,R=0;R<D.length;R++){var O=D[R];if(void 0===x[O]){var N=4*O;(w?w(P[N+0],P[N+1],P[N+2],P[N+3]):s<=P[N+2]&&r<=P[N+3]&&a>=P[N+0]&&h>=P[N+1])?(x[O]=!0,_.push(S[O])):x[O]=!1}}},Ls.prototype._forEachCell=function(s,r,a,h,f,_,x,w){for(var D=this._convertToCellCoord(s),S=this._convertToCellCoord(r),P=this._convertToCellCoord(a),R=this._convertToCellCoord(h),O=D;O<=P;O++)for(var N=S;N<=R;N++){var B=this.d*N+O;if((!w||w(this._convertFromCellCoord(O),this._convertFromCellCoord(N),this._convertFromCellCoord(O+1),this._convertFromCellCoord(N+1)))&&f.call(this,s,r,a,h,B,_,x,w))return}},Ls.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Ls.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Ls.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,r=Os+this.cells.length+1+1,a=0,h=0;h<this.cells.length;h++)a+=this.cells[h].length;var f=new Int32Array(r+a+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var _=r,x=0;x<s.length;x++){var w=s[x];f[Os+x]=_,f.set(w,_),_+=w.length}return f[Os+s.length]=_,f.set(this.keys,_),f[Os+s.length+1]=_+=this.keys.length,f.set(this.bboxes,_),_+=this.bboxes.length,f.buffer};var Il=yo(Lp);const Th={};function pt(s,r,a={}){Object.defineProperty(s,"_classRegistryKey",{value:r,writeable:!1}),Th[r]={klass:s,omit:a.omit||[]}}pt(Object,"Object"),Il.serialize=function(s,r){const a=s.toArrayBuffer();return r&&r.push(a),{buffer:a}},Il.deserialize=function(s){return new Il(s.buffer)},Object.defineProperty(Il,"name",{value:"Grid"}),pt(Il,"Grid"),pt(Fi,"Color"),pt(Error,"Error"),pt(Sa,"AJAXError"),pt(as,"ResolvedImage"),pt(Zd,"StylePropertyFunction"),pt(mh,"StyleExpression",{omit:["_evaluator"]}),pt(gh,"ZoomDependentExpression"),pt(qd,"ZoomConstantExpression"),pt(ta,"CompoundExpression",{omit:["_evaluate"]});for(const s in Kn)Th[Kn[s]._classRegistryKey]||pt(Kn[s],`Expression${s}`);function nf(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function rf(s){return Ue.ImageBitmap&&s instanceof Ue.ImageBitmap}function Ze(s,r){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(nf(s)||rf(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const a=s;return r&&r.push(a.buffer),a}if(s instanceof Ue.ImageData)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const a=[];for(const h of s)a.push(Ze(h,r));return a}if("object"==typeof s){const a=s.constructor,h=a._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const f=a.serialize?a.serialize(s,r):{};if(!a.serialize){for(const _ in s)s.hasOwnProperty(_)&&(Th[h].omit.indexOf(_)>=0||(f[_]=Ze(s[_],r)));s instanceof Error&&(f.message=s.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==h&&(f.$name=h),f}throw new Error("can't serialize object of type "+typeof s)}function yn(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||nf(s)||rf(s)||ArrayBuffer.isView(s)||s instanceof Ue.ImageData)return s;if(Array.isArray(s))return s.map(yn);if("object"==typeof s){const r=s.$name||"Object",{klass:a}=Th[r];if(!a)throw new Error(`can't deserialize unregistered class ${r}`);if(a.deserialize)return a.deserialize(s);const h=Object.create(a.prototype);for(const f of Object.keys(s))"$name"!==f&&(h[f]=yn(s[f]));return h}throw new Error("can't deserialize object of type "+typeof s)}const at={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Al(s){for(const r of s)if(Pl(r.charCodeAt(0)))return!0;return!1}function gr(s){for(const r of s)if(!sf(r.charCodeAt(0)))return!1;return!0}function sf(s){return!(at.Arabic(s)||at["Arabic Supplement"](s)||at["Arabic Extended-A"](s)||at["Arabic Presentation Forms-A"](s)||at["Arabic Presentation Forms-B"](s))}function Pl(s){return!(746!==s&&747!==s&&(s<4352||!(at["Bopomofo Extended"](s)||at.Bopomofo(s)||at["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||at["CJK Compatibility Ideographs"](s)||at["CJK Compatibility"](s)||at["CJK Radicals Supplement"](s)||at["CJK Strokes"](s)||!(!at["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||at["CJK Unified Ideographs Extension A"](s)||at["CJK Unified Ideographs"](s)||at["Enclosed CJK Letters and Months"](s)||at["Hangul Compatibility Jamo"](s)||at["Hangul Jamo Extended-A"](s)||at["Hangul Jamo Extended-B"](s)||at["Hangul Jamo"](s)||at["Hangul Syllables"](s)||at.Hiragana(s)||at["Ideographic Description Characters"](s)||at.Kanbun(s)||at["Kangxi Radicals"](s)||at["Katakana Phonetic Extensions"](s)||at.Katakana(s)&&12540!==s||!(!at["Halfwidth and Fullwidth Forms"](s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!at["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||at["Unified Canadian Aboriginal Syllabics"](s)||at["Unified Canadian Aboriginal Syllabics Extended"](s)||at["Vertical Forms"](s)||at["Yijing Hexagram Symbols"](s)||at["Yi Syllables"](s)||at["Yi Radicals"](s))))}function us(s){return!(Pl(s)||(r=s,at["Latin-1 Supplement"](r)&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||at["General Punctuation"](r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||at["Letterlike Symbols"](r)||at["Number Forms"](r)||at["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||at["Control Pictures"](r)&&9251!==r||at["Optical Character Recognition"](r)||at["Enclosed Alphanumerics"](r)||at["Geometric Shapes"](r)||at["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||at["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||at["CJK Symbols and Punctuation"](r)||at.Katakana(r)||at["Private Use Area"](r)||at["CJK Compatibility Forms"](r)||at["Small Form Variants"](r)||at["Halfwidth and Fullwidth Forms"](r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r}function Sh(s){return s>=1424&&s<=2303||at["Arabic Presentation Forms-A"](s)||at["Arabic Presentation Forms-B"](s)}function af(s,r){return!(!r&&Sh(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||at.Khmer(s))}function Tg(s){for(const r of s)if(Sh(r.charCodeAt(0)))return!0;return!1}const Fp="deferred",Mh="loading",_r="loaded";let ho=null,g="unavailable",c=null;const d=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(g="error"),ho&&ho(s)};function v(){b.fire(new pl("pluginStateChange",{pluginStatus:g,pluginURL:c}))}const b=new oc,E=function(){return g},M=function(){if(g!==Fp||!c)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");g=Mh,v(),c&&ic({url:c},s=>{s?d(s):(g=_r,v())})},I={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>g===_r||null!=I.applyArabicShaping,isLoading:()=>g===Mh,setState(s){g=s.pluginStatus,c=s.pluginURL},isParsed:()=>null!=I.applyArabicShaping&&null!=I.processBidirectionalText&&null!=I.processStyledBidirectionalText,getPluginURL:()=>c};class k{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return function(a,h){for(const f of a)if(!af(f.charCodeAt(0),h))return!1;return!0}(r,I.isLoaded())}}class F{constructor(r,a){this.property=r,this.value=a,this.expression=function(h,f){if(Ji(h))return new Zd(h,f);if(cu(h)){const _=_h(h,f);if("error"===_.result)throw new Error(_.value.map(x=>`${x.key}: ${x.message}`).join(", "));return _.value}{let _=h;return"string"==typeof h&&"color"===f.type&&(_=Fi.parse(h)),{kind:"constant",evaluate:()=>_}}}(void 0===a?r.specification.default:a,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,a,h){return this.property.possiblyEvaluate(this,r,a,h)}}class L{constructor(r){this.property=r,this.value=new F(r,void 0)}transitioned(r,a){return new q(this.property,this.value,a,ki({},r.transition,this.transition),r.now)}untransitioned(){return new q(this.property,this.value,null,{},0)}}class j{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return vo(this._values[r].value.value)}setValue(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new L(this._values[r].property)),this._values[r].value=new F(this._values[r].property,null===a?void 0:vo(a))}getTransition(r){return vo(this._values[r].transition)}setTransition(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new L(this._values[r].property)),this._values[r].transition=vo(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const h=this.getValue(a);void 0!==h&&(r[a]=h);const f=this.getTransition(a);void 0!==f&&(r[`${a}-transition`]=f)}return r}transitioned(r,a){const h=new K(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].transitioned(r,a._values[f]);return h}untransitioned(){const r=new K(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class q{constructor(r,a,h,f,_){const x=f.delay||0,w=f.duration||0;_=_||0,this.property=r,this.value=a,this.begin=_+x,this.end=this.begin+w,r.specification.transition&&(f.delay||f.duration)&&(this.prior=h)}possiblyEvaluate(r,a,h){const f=r.now||0,_=this.value.possiblyEvaluate(r,a,h),x=this.prior;if(x){if(f>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(f<this.begin)return x.possiblyEvaluate(r,a,h);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(r,a,h),_,Ju(w))}}return _}}class K{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,h){const f=new ee(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(r,a,h);return f}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Q{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return vo(this._values[r].value)}setValue(r,a){this._values[r]=new F(this._values[r].property,null===a?void 0:vo(a))}serialize(){const r={};for(const a of Object.keys(this._values)){const h=this.getValue(a);void 0!==h&&(r[a]=h)}return r}possiblyEvaluate(r,a,h){const f=new ee(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(r,a,h);return f}}class J{constructor(r,a,h){this.property=r,this.value=a,this.parameters=h}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,a,h,f){return this.property.evaluate(this.value,this.parameters,r,a,h,f)}}class ee{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class U{constructor(r){this.specification=r}possiblyEvaluate(r,a){return r.expression.evaluate(a)}interpolate(r,a,h){const f=nu[this.specification.type];return f?f(r,a,h):r}}class Y{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,h,f){return new J(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(a,null,{},h,f)}:r.expression,a)}interpolate(r,a,h){if("constant"!==r.value.kind||"constant"!==a.value.kind)return r;if(void 0===r.value.value||void 0===a.value.value)return new J(this,{kind:"constant",value:void 0},r.parameters);const f=nu[this.specification.type];return f?new J(this,{kind:"constant",value:f(r.value.value,a.value.value,h)},r.parameters):r}evaluate(r,a,h,f,_,x){return"constant"===r.kind?r.value:r.evaluate(a,h,f,_,x)}}class ie{constructor(r){this.specification=r}possiblyEvaluate(r,a,h,f){return!!r.expression.evaluate(a,null,{},h,f)}interpolate(){return!1}}class re{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new k(0,{});for(const h in r){const f=r[h];f.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new F(f,void 0),x=this.defaultTransitionablePropertyValues[h]=new L(f);this.defaultTransitioningPropertyValues[h]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate(a)}}}function fe(s,r){return 256*(s=hn(Math.floor(s),0,255))+hn(Math.floor(r),0,255)}pt(Y,"DataDrivenProperty"),pt(U,"DataConstantProperty"),pt(ie,"ColorRampProperty");const ge={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class de{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class be{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&(r.isTransferred=!0,a.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xe(s,r=1){let a=0,h=0;return{members:s.map(f=>{const _=ge[f.type].BYTES_PER_ELEMENT,x=a=Ie(a,Math.max(r,_)),w=f.components||1;return h=Math.max(h,_),a+=_*w,{name:f.name,type:f.type,components:w,offset:x}}),size:Ie(a,Math.max(h,r)),alignment:r}}function Ie(s,r){return Math.ceil(s/r)*r}class Xe extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const h=this.length;return this.resize(h+1),this.emplace(h,r,a)}emplace(r,a,h){const f=2*r;return this.int16[f+0]=a,this.int16[f+1]=h,r}}Xe.prototype.bytesPerElement=4,pt(Xe,"StructArrayLayout2i4");class Te extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,h)}emplace(r,a,h,f){const _=3*r;return this.int16[_+0]=a,this.int16[_+1]=h,this.int16[_+2]=f,r}}Te.prototype.bytesPerElement=6,pt(Te,"StructArrayLayout3i6");class je extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,h,f)}emplace(r,a,h,f,_){const x=4*r;return this.int16[x+0]=a,this.int16[x+1]=h,this.int16[x+2]=f,this.int16[x+3]=_,r}}je.prototype.bytesPerElement=8,pt(je,"StructArrayLayout4i8");class Pe extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,x,w){const D=this.length;return this.resize(D+1),this.emplace(D,r,a,h,f,_,x,w)}emplace(r,a,h,f,_,x,w,D){const S=6*r,P=12*r,R=3*r;return this.int16[S+0]=a,this.int16[S+1]=h,this.uint8[P+4]=f,this.uint8[P+5]=_,this.uint8[P+6]=x,this.uint8[P+7]=w,this.float32[R+2]=D,r}}Pe.prototype.bytesPerElement=12,pt(Pe,"StructArrayLayout2i4ub1f12");class We extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,h,f)}emplace(r,a,h,f,_){const x=4*r;return this.float32[x+0]=a,this.float32[x+1]=h,this.float32[x+2]=f,this.float32[x+3]=_,r}}We.prototype.bytesPerElement=16,pt(We,"StructArrayLayout4f16");class Se extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,h,f,_)}emplace(r,a,h,f,_,x){const w=6*r,D=3*r;return this.uint16[w+0]=a,this.uint16[w+1]=h,this.uint16[w+2]=f,this.uint16[w+3]=_,this.float32[D+2]=x,r}}Se.prototype.bytesPerElement=12,pt(Se,"StructArrayLayout4ui1f12");class Ne extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,h,f)}emplace(r,a,h,f,_){const x=4*r;return this.uint16[x+0]=a,this.uint16[x+1]=h,this.uint16[x+2]=f,this.uint16[x+3]=_,r}}Ne.prototype.bytesPerElement=8,pt(Ne,"StructArrayLayout4ui8");class Ye extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,a,h,f,_,x)}emplace(r,a,h,f,_,x,w){const D=6*r;return this.int16[D+0]=a,this.int16[D+1]=h,this.int16[D+2]=f,this.int16[D+3]=_,this.int16[D+4]=x,this.int16[D+5]=w,r}}Ye.prototype.bytesPerElement=12,pt(Ye,"StructArrayLayout6i12");class $e extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,x,w,D,S,P,R,O){const N=this.length;return this.resize(N+1),this.emplace(N,r,a,h,f,_,x,w,D,S,P,R,O)}emplace(r,a,h,f,_,x,w,D,S,P,R,O,N){const B=12*r;return this.int16[B+0]=a,this.int16[B+1]=h,this.int16[B+2]=f,this.int16[B+3]=_,this.uint16[B+4]=x,this.uint16[B+5]=w,this.uint16[B+6]=D,this.uint16[B+7]=S,this.int16[B+8]=P,this.int16[B+9]=R,this.int16[B+10]=O,this.int16[B+11]=N,r}}$e.prototype.bytesPerElement=24,pt($e,"StructArrayLayout4i4ui4i24");class qe extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,a,h,f,_,x)}emplace(r,a,h,f,_,x,w){const D=10*r,S=5*r;return this.int16[D+0]=a,this.int16[D+1]=h,this.int16[D+2]=f,this.float32[S+2]=_,this.float32[S+3]=x,this.float32[S+4]=w,r}}qe.prototype.bytesPerElement=20,pt(qe,"StructArrayLayout3i3f20");class _t extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}_t.prototype.bytesPerElement=4,pt(_t,"StructArrayLayout1ul4");class zt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,x,w,D,S,P,R,O,N){const B=this.length;return this.resize(B+1),this.emplace(B,r,a,h,f,_,x,w,D,S,P,R,O,N)}emplace(r,a,h,f,_,x,w,D,S,P,R,O,N,B){const $=20*r,Z=10*r;return this.int16[$+0]=a,this.int16[$+1]=h,this.int16[$+2]=f,this.int16[$+3]=_,this.int16[$+4]=x,this.float32[Z+3]=w,this.float32[Z+4]=D,this.float32[Z+5]=S,this.float32[Z+6]=P,this.int16[$+14]=R,this.uint32[Z+8]=O,this.uint16[$+18]=N,this.uint16[$+19]=B,r}}zt.prototype.bytesPerElement=40,pt(zt,"StructArrayLayout5i4f1i1ul2ui40");class mt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,x,w){const D=this.length;return this.resize(D+1),this.emplace(D,r,a,h,f,_,x,w)}emplace(r,a,h,f,_,x,w,D){const S=8*r;return this.int16[S+0]=a,this.int16[S+1]=h,this.int16[S+2]=f,this.int16[S+4]=_,this.int16[S+5]=x,this.int16[S+6]=w,this.int16[S+7]=D,r}}mt.prototype.bytesPerElement=16,pt(mt,"StructArrayLayout3i2i2i16");class Tt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,h,f,_)}emplace(r,a,h,f,_,x){const w=4*r,D=8*r;return this.float32[w+0]=a,this.float32[w+1]=h,this.float32[w+2]=f,this.int16[D+6]=_,this.int16[D+7]=x,r}}Tt.prototype.bytesPerElement=16,pt(Tt,"StructArrayLayout2f1f2i16");class dn extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,h,f)}emplace(r,a,h,f,_){const x=12*r,w=3*r;return this.uint8[x+0]=a,this.uint8[x+1]=h,this.float32[w+1]=f,this.float32[w+2]=_,r}}dn.prototype.bytesPerElement=12,pt(dn,"StructArrayLayout2ub2f12");class sn extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,h)}emplace(r,a,h,f){const _=3*r;return this.float32[_+0]=a,this.float32[_+1]=h,this.float32[_+2]=f,r}}sn.prototype.bytesPerElement=12,pt(sn,"StructArrayLayout3f12");class vt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,h)}emplace(r,a,h,f){const _=3*r;return this.uint16[_+0]=a,this.uint16[_+1]=h,this.uint16[_+2]=f,r}}vt.prototype.bytesPerElement=6,pt(vt,"StructArrayLayout3ui6");class On extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,x,w,D,S,P,R,O,N,B,$,Z,te,ce,ne,ae,pe){const he=this.length;return this.resize(he+1),this.emplace(he,r,a,h,f,_,x,w,D,S,P,R,O,N,B,$,Z,te,ce,ne,ae,pe)}emplace(r,a,h,f,_,x,w,D,S,P,R,O,N,B,$,Z,te,ce,ne,ae,pe,he){const Me=30*r,Ee=15*r,Oe=60*r;return this.int16[Me+0]=a,this.int16[Me+1]=h,this.int16[Me+2]=f,this.float32[Ee+2]=_,this.float32[Ee+3]=x,this.uint16[Me+8]=w,this.uint16[Me+9]=D,this.uint32[Ee+5]=S,this.uint32[Ee+6]=P,this.uint32[Ee+7]=R,this.uint16[Me+16]=O,this.uint16[Me+17]=N,this.uint16[Me+18]=B,this.float32[Ee+10]=$,this.float32[Ee+11]=Z,this.uint8[Oe+48]=te,this.uint8[Oe+49]=ce,this.uint8[Oe+50]=ne,this.uint32[Ee+13]=ae,this.int16[Me+28]=pe,this.uint8[Oe+58]=he,r}}On.prototype.bytesPerElement=60,pt(On,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Jn extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,x,w,D,S,P,R,O,N,B,$,Z,te,ce,ne,ae,pe,he,Me,Ee,Oe,Ge,Ae,Be,Ve,He){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,r,a,h,f,_,x,w,D,S,P,R,O,N,B,$,Z,te,ce,ne,ae,pe,he,Me,Ee,Oe,Ge,Ae,Be,Ve,He)}emplace(r,a,h,f,_,x,w,D,S,P,R,O,N,B,$,Z,te,ce,ne,ae,pe,he,Me,Ee,Oe,Ge,Ae,Be,Ve,He,Ke){const Le=38*r,rt=19*r;return this.int16[Le+0]=a,this.int16[Le+1]=h,this.int16[Le+2]=f,this.float32[rt+2]=_,this.float32[rt+3]=x,this.int16[Le+8]=w,this.int16[Le+9]=D,this.int16[Le+10]=S,this.int16[Le+11]=P,this.int16[Le+12]=R,this.int16[Le+13]=O,this.uint16[Le+14]=N,this.uint16[Le+15]=B,this.uint16[Le+16]=$,this.uint16[Le+17]=Z,this.uint16[Le+18]=te,this.uint16[Le+19]=ce,this.uint16[Le+20]=ne,this.uint16[Le+21]=ae,this.uint16[Le+22]=pe,this.uint16[Le+23]=he,this.uint16[Le+24]=Me,this.uint16[Le+25]=Ee,this.uint16[Le+26]=Oe,this.uint16[Le+27]=Ge,this.uint16[Le+28]=Ae,this.uint32[rt+15]=Be,this.float32[rt+16]=Ve,this.float32[rt+17]=He,this.float32[rt+18]=Ke,r}}Jn.prototype.bytesPerElement=76,pt(Jn,"StructArrayLayout3i2f6i15ui1ul3f76");class Ln extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Ln.prototype.bytesPerElement=4,pt(Ln,"StructArrayLayout1f4");class Vn extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,h,f,_)}emplace(r,a,h,f,_,x){const w=5*r;return this.float32[w+0]=a,this.float32[w+1]=h,this.float32[w+2]=f,this.float32[w+3]=_,this.float32[w+4]=x,r}}Vn.prototype.bytesPerElement=20,pt(Vn,"StructArrayLayout5f20");class yr extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,h,f)}emplace(r,a,h,f,_){const x=6*r;return this.uint32[3*r+0]=a,this.uint16[x+2]=h,this.uint16[x+3]=f,this.uint16[x+4]=_,r}}yr.prototype.bytesPerElement=12,pt(yr,"StructArrayLayout1ul3ui12");class Si extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const h=this.length;return this.resize(h+1),this.emplace(h,r,a)}emplace(r,a,h){const f=2*r;return this.uint16[f+0]=a,this.uint16[f+1]=h,r}}Si.prototype.bytesPerElement=4,pt(Si,"StructArrayLayout2ui4");class Do extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}Do.prototype.bytesPerElement=2,pt(Do,"StructArrayLayout1ui2");class hs extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const h=this.length;return this.resize(h+1),this.emplace(h,r,a)}emplace(r,a,h){const f=2*r;return this.float32[f+0]=a,this.float32[f+1]=h,r}}hs.prototype.bytesPerElement=8,pt(hs,"StructArrayLayout2f8");class Qn extends de{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Qn.prototype.size=40;class Gn extends zt{get(r){return new Qn(this,r)}}pt(Gn,"CollisionBoxArray");class bn extends de{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}bn.prototype.size=60;class wi extends On{get(r){return new bn(this,r)}}pt(wi,"PlacedSymbolArray");class cr extends de{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}cr.prototype.size=76;class ci extends Jn{get(r){return new cr(this,r)}}pt(ci,"SymbolInstanceArray");class Zr extends Ln{getoffsetX(r){return this.float32[1*r+0]}}pt(Zr,"GlyphOffsetArray");class mu extends Xe{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}pt(mu,"SymbolLineVertexArray");class kl extends de{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}kl.prototype.size=12;class fo extends yr{get(r){return new kl(this,r)}}pt(fo,"FeatureIndexArray");class la extends Si{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}pt(la,"FillExtrusionCentroidArray");const ds=xe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ca=xe([{name:"a_dash",components:4,type:"Uint16"}]);var gu={exports:{}},Sg=function(s,r){var a,h,f,_,x,w,D,S;for(h=s.length-(a=3&s.length),f=r,x=3432918353,w=461845907,S=0;S<h;)D=255&s.charCodeAt(S)|(255&s.charCodeAt(++S))<<8|(255&s.charCodeAt(++S))<<16|(255&s.charCodeAt(++S))<<24,++S,f=27492+(65535&(_=5*(65535&(f=(f^=D=(65535&(D=(D=(65535&D)*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*w+(((D>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(D=0,a){case 3:D^=(255&s.charCodeAt(S+2))<<16;case 2:D^=(255&s.charCodeAt(S+1))<<8;case 1:f^=D=(65535&(D=(D=(65535&(D^=255&s.charCodeAt(S)))*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*w+(((D>>>16)*w&65535)<<16)&4294967295}return f^=s.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0},ov=function(s,r){for(var a,h=s.length,f=r^h,_=0;h>=4;)a=1540483477*(65535&(a=255&s.charCodeAt(_)|(255&s.charCodeAt(++_))<<8|(255&s.charCodeAt(++_))<<16|(255&s.charCodeAt(++_))<<24))+((1540483477*(a>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:f^=(255&s.charCodeAt(_+2))<<16;case 2:f^=(255&s.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&s.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};gu.exports=Sg,gu.exports.murmur3=Sg,gu.exports.murmur2=ov;var zp=yo(gu.exports);class lf{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,a,h,f){this.ids.push(sv(r)),this.positions.push(a,h,f)}getPositions(r){const a=sv(r);let h=0,f=this.ids.length-1;for(;h<f;){const x=h+f>>1;this.ids[x]>=a?f=x:h=x+1}const _=[];for(;this.ids[h]===a;)_.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return _}static serialize(r,a){const h=new Float64Array(r.ids),f=new Uint32Array(r.positions);return Ih(h,f,0,h.length-1),a&&a.push(h.buffer,f.buffer),{ids:h,positions:f}}static deserialize(r){const a=new lf;return a.ids=r.ids,a.positions=r.positions,a.indexed=!0,a}}function sv(s){const r=+s;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:zp(String(s))}function Ih(s,r,a,h){for(;a<h;){const f=s[a+h>>1];let _=a-1,x=h+1;for(;;){do{_++}while(s[_]<f);do{x--}while(s[x]>f);if(_>=x)break;Ba(s,_,x),Ba(r,3*_,3*x),Ba(r,3*_+1,3*x+1),Ba(r,3*_+2,3*x+2)}x-a<h-x?(Ih(s,r,a,x),a=x+1):(Ih(s,r,x+1,h),h=x)}}function Ba(s,r,a){const h=s[r];s[r]=s[a],s[a]=h}pt(lf,"FeaturePositionMap");class Ol{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,a),this.initialized=!0),!!this.location}}class cf extends Ol{constructor(r){super(r),this.current=0}set(r,a,h){this.fetchUniformLocation(r,a)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class Mg extends Ol{constructor(r){super(r),this.current=[0,0,0,0]}set(r,a,h){this.fetchUniformLocation(r,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class yu extends Ol{constructor(r){super(r),this.current=Fi.transparent}set(r,a,h){this.fetchUniformLocation(r,a)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const l1=new Float32Array(16),Xr=new Float32Array(9),Ig=new Float32Array(4);function Ag(s){return[fe(255*s.r,255*s.g),fe(255*s.b,255*s.a)]}class Ah{constructor(r,a,h){this.value=r,this.uniformNames=a.map(f=>`u_${f}`),this.type=h}setUniform(r,a,h,f,_){a.set(r,_,f.constantOr(this.value))}getBinding(r,a){return"color"===this.type?new yu(r):new cf(r)}}class Ll{constructor(r,a){this.uniformNames=a.map(h=>`u_${h}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,a,h,f,_){const x="u_pattern"===_||"u_dash"===_?this.pattern:"u_pixel_ratio"===_?this.pixelRatio:null;x&&a.set(r,_,x)}getBinding(r,a){return"u_pattern"===a||"u_dash"===a?new Mg(r):new cf(r)}}class Go{constructor(r,a,h,f){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=a.map(_=>({name:`a_${_}`,type:"Float32",components:"color"===h?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(r,a,h,f,_,x){const w=this.paintVertexArray.length,D=this.expression.evaluate(new k(0),a,{},_,f,x);this.paintVertexArray.resize(r),this._setPaintValue(w,r,D)}updatePaintArray(r,a,h,f,_){const x=this.expression.evaluate({zoom:0},h,f,void 0,_);this._setPaintValue(r,a,x)}_setPaintValue(r,a,h){if("color"===this.type){const f=Ag(h);for(let _=r;_<a;_++)this.paintVertexArray.emplace(_,f[0],f[1])}else{for(let f=r;f<a;f++)this.paintVertexArray.emplace(f,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class po{constructor(r,a,h,f,_,x){this.expression=r,this.uniformNames=a.map(w=>`u_${w}_t`),this.type=h,this.useIntegerZoom=f,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=a.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===h?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(r,a,h,f,_,x){const w=this.expression.evaluate(new k(this.zoom),a,{},_,f,x),D=this.expression.evaluate(new k(this.zoom+1),a,{},_,f,x),S=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(S,r,w,D)}updatePaintArray(r,a,h,f,_){const x=this.expression.evaluate({zoom:this.zoom},h,f,void 0,_),w=this.expression.evaluate({zoom:this.zoom+1},h,f,void 0,_);this._setPaintValue(r,a,x,w)}_setPaintValue(r,a,h,f){if("color"===this.type){const _=Ag(h),x=Ag(f);for(let w=r;w<a;w++)this.paintVertexArray.emplace(w,_[0],_[1],x[0],x[1])}else{for(let _=r;_<a;_++)this.paintVertexArray.emplace(_,h,f);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(f))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a,h,f,_){const x=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,w=hn(this.expression.interpolationFactor(x,this.zoom,this.zoom+1),0,1);a.set(r,_,w)}getBinding(r,a){return new cf(r)}}class fs{constructor(r,a,h,f,_){this.expression=r,this.layerId=_,this.paintVertexAttributes=("array"===h?ca:ds).members;for(let x=0;x<a.length;++x);this.paintVertexArray=new f}populatePaintArray(r,a,h){const f=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(f,r,a.patterns&&a.patterns[this.layerId],h)}updatePaintArray(r,a,h,f,_,x){this._setPaintValues(r,a,h.patterns&&h.patterns[this.layerId],x)}_setPaintValues(r,a,h,f){if(!f||!h)return;const _=f[h];if(!_)return;const{tl:x,br:w,pixelRatio:D}=_;for(let S=r;S<a;S++)this.paintVertexArray.emplace(S,x[0],x[1],w[0],w[1],D)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fl{constructor(r,a,h=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const _ in r.paint._values){if(!h(_))continue;const x=r.paint.get(_);if(!(x instanceof J&&Cl(x.property.specification)))continue;const w=PD(_,r.type),D=x.value,S=x.property.specification.type,P=!!x.property.useIntegerZoom,R="line-dasharray"===_||_.endsWith("pattern"),O="line-dasharray"===_&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==D.kind||O)if("source"===D.kind||O||R){const N=u1(_,S,"source");this.binders[_]=R?new fs(D,w,S,N,r.id):new Go(D,w,S,N),f.push(`/a_${_}`)}else{const N=u1(_,S,"composite");this.binders[_]=new po(D,w,S,P,a,N),f.push(`/z_${_}`)}else this.binders[_]=R?new Ll(D.value,w):new Ah(D.value,w,S),f.push(`/u_${_}`)}this.cacheKey=f.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof Go||a instanceof po?a.maxValue:0}populatePaintArrays(r,a,h,f,_,x){for(const w in this.binders){const D=this.binders[w];(D instanceof Go||D instanceof po||D instanceof fs)&&D.populatePaintArray(r,a,h,f,_,x)}}setConstantPatternPositions(r){for(const a in this.binders){const h=this.binders[a];h instanceof Ll&&h.setConstantPatternPositions(r)}}updatePaintArrays(r,a,h,f,_,x){let w=!1;for(const D in r){const S=a.getPositions(D);for(const P of S){const R=h.feature(P.index);for(const O in this.binders){const N=this.binders[O];if((N instanceof Go||N instanceof po||N instanceof fs)&&!0===N.expression.isStateDependent){const B=f.paint.get(O);N.expression=B.value,N.updatePaintArray(P.start,P.end,R,r[D],_,x),w=!0}}}}return w}defines(){const r=[];for(const a in this.binders){const h=this.binders[a];(h instanceof Ah||h instanceof Ll)&&r.push(...h.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return r}getBinderAttributes(){const r=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof Go||h instanceof po||h instanceof fs)for(let f=0;f<h.paintVertexAttributes.length;f++)r.push(h.paintVertexAttributes[f].name)}return r}getBinderUniforms(){const r=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof Ah||h instanceof Ll||h instanceof po)for(const f of h.uniformNames)r.push(f)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const a=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof Ah||f instanceof Ll||f instanceof po)for(const _ of f.uniformNames)a.push({name:_,property:h,binding:f.getBinding(r,_)})}return a}setUniforms(r,a,h,f,_){for(const{name:x,property:w,binding:D}of h)this.binders[w].setUniform(r,D,_,f.get(w),x)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Go||a instanceof po||a instanceof fs)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(r){for(const a in this.binders){const h=this.binders[a];(h instanceof Go||h instanceof po||h instanceof fs)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof Go||a instanceof po||a instanceof fs)&&a.destroy()}}}class zl{constructor(r,a,h=(()=>!0)){this.programConfigurations={};for(const f of r)this.programConfigurations[f.id]=new Fl(f,a,h);this.needsUpload=!1,this._featureMap=new lf,this._bufferOffset=0}populatePaintArrays(r,a,h,f,_,x,w){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(r,a,f,_,x,w);void 0!==a.id&&this._featureMap.add(a.id,h,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,h,f,_){for(const x of h)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(r,this._featureMap,a,x,f,_)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const Ph={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function PD(s,r){return Ph[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const c1={"line-pattern":{source:Se,composite:Se},"fill-pattern":{source:Se,composite:Se},"fill-extrusion-pattern":{source:Se,composite:Se},"line-dasharray":{source:Ne,composite:Ne}},Mt={color:{source:hs,composite:We},number:{source:Ln,composite:hs}};function u1(s,r,a){const h=c1[s];return h&&h[a]||Mt[r][a]}pt(Ah,"ConstantBinder"),pt(Ll,"PatternConstantBinder"),pt(Go,"SourceExpressionBinder"),pt(fs,"PatternCompositeBinder"),pt(po,"CompositeExpressionBinder"),pt(Fl,"ProgramConfiguration",{omit:["_buffers"]}),pt(zl,"ProgramConfigurationSet");const h1="-transition";class Va extends oc{constructor(r,a){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new Q(a.layout)),a.paint)){this._transitionablePaint=new j(a.paint);for(const h in r.paint)this.setPaintProperty(h,r.paint[h],{validate:!1});for(const h in r.layout)this.setLayoutProperty(h,r.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ee(a.paint)}}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a,h={}){null!=a&&this._validate(Op,`layers.${this.id}.layout.${r}`,r,a,h)||("visibility"!==r?this._unevaluatedLayout.setValue(r,a):this.visibility=a)}getPaintProperty(r){return Ql(r,h1)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a,h={}){if(null!=a&&this._validate(Na,`layers.${this.id}.paint.${r}`,r,a,h))return!1;if(Ql(r,h1))return this._transitionablePaint.setTransition(r.slice(0,-11),a||void 0),!1;{const f=this._transitionablePaint._values[r],_=f.value.isDataDriven(),x=f.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);const w=this._transitionablePaint._values[r].value,D=w.isDataDriven(),S=Ql(r,"pattern")||"line-dasharray"===r;return D||_||S||this._handleOverridablePaintPropertyUpdate(r,x,w)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,a,h){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Ea(r,(a,h)=>!(void 0===a||"layout"===h&&!Object.keys(a).length||"paint"===h&&!Object.keys(a).length))}_validate(r,a,h,f,_={}){return(!_||!1!==_.validate)&&rn(this,r.call(Rp,{key:a,layerType:this.type,objectKey:h,value:f,styleSpec:ze,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof J&&Cl(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=uu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const kD=xe([{name:"a_pos",components:2,type:"Int16"}],4),RD=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $i{constructor(r=[]){this.segments=r}prepareSegment(r,a,h,f){let _=this.segments[this.segments.length-1];return r>$i.MAX_VERTEX_ARRAY_LENGTH&&ui(`Max vertices per segment is ${$i.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!_||_.vertexLength+r>$i.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==f)&&(_={vertexOffset:a.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},void 0!==f&&(_.sortKey=f),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,h,f){return new $i([{vertexOffset:r,primitiveOffset:a,vertexLength:h,primitiveLength:f,vaos:{},sortKey:0}])}}$i.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pt($i,"SegmentVector");var St=8192;class Fs{constructor(r,a){r&&(a?this.setSouthWest(r).setNorthEast(a):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof jn?new jn(r.lng,r.lat):jn.convert(r),this}setSouthWest(r){return this._sw=r instanceof jn?new jn(r.lng,r.lat):jn.convert(r),this}extend(r){const a=this._sw,h=this._ne;let f,_;if(r instanceof jn)f=r,_=r;else{if(!(r instanceof Fs))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(Fs.convert(r)):this.extend(jn.convert(r)):"object"==typeof r&&null!==r&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(jn.convert(r)):this;if(f=r._sw,_=r._ne,!f||!_)return this}return a||h?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new jn(f.lng,f.lat),this._ne=new jn(_.lng,_.lat)),this}getCenter(){return new jn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new jn(this.getWest(),this.getNorth())}getSouthEast(){return new jn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:a,lat:h}=jn.convert(r);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(r){return!r||r instanceof Fs?r:new Fs(r)}}var Pg=1e-6,ps=typeof Float32Array<"u"?Float32Array:Array;function ur(){var s=new ps(9);return ps!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Np(s,r,a){var h=r[0],f=r[1],_=r[2],x=r[3],w=r[4],D=r[5],S=r[6],P=r[7],R=r[8],O=a[0],N=a[1],B=a[2],$=a[3],Z=a[4],te=a[5],ce=a[6],ne=a[7],ae=a[8];return s[0]=O*h+N*x+B*S,s[1]=O*f+N*w+B*P,s[2]=O*_+N*D+B*R,s[3]=$*h+Z*x+te*S,s[4]=$*f+Z*w+te*P,s[5]=$*_+Z*D+te*R,s[6]=ce*h+ne*x+ae*S,s[7]=ce*f+ne*w+ae*P,s[8]=ce*_+ne*D+ae*R,s}function To(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function kg(s,r){var a=r[0],h=r[1],f=r[2],_=r[3],x=r[4],w=r[5],D=r[6],S=r[7],P=r[8],R=r[9],O=r[10],N=r[11],B=r[12],$=r[13],Z=r[14],te=r[15],ce=a*w-h*x,ne=a*D-f*x,ae=a*S-_*x,pe=h*D-f*w,he=h*S-_*w,Me=f*S-_*D,Ee=P*$-R*B,Oe=P*Z-O*B,Ge=P*te-N*B,Ae=R*Z-O*$,Be=R*te-N*$,Ve=O*te-N*Z,He=ce*Ve-ne*Be+ae*Ae+pe*Ge-he*Oe+Me*Ee;return He?(s[0]=(w*Ve-D*Be+S*Ae)*(He=1/He),s[1]=(f*Be-h*Ve-_*Ae)*He,s[2]=($*Me-Z*he+te*pe)*He,s[3]=(O*he-R*Me-N*pe)*He,s[4]=(D*Ge-x*Ve-S*Oe)*He,s[5]=(a*Ve-f*Ge+_*Oe)*He,s[6]=(Z*ae-B*Me-te*ne)*He,s[7]=(P*Me-O*ae+N*ne)*He,s[8]=(x*Be-w*Ge+S*Ee)*He,s[9]=(h*Ge-a*Be-_*Ee)*He,s[10]=(B*he-$*ae+te*ce)*He,s[11]=(R*ae-P*he-N*ce)*He,s[12]=(w*Oe-x*Ae-D*Ee)*He,s[13]=(a*Ae-h*Oe+f*Ee)*He,s[14]=($*ne-B*pe-Z*ce)*He,s[15]=(P*pe-R*ne+O*ce)*He,s):null}function Rr(s,r,a){var h=r[0],f=r[1],_=r[2],x=r[3],w=r[4],D=r[5],S=r[6],P=r[7],R=r[8],O=r[9],N=r[10],B=r[11],$=r[12],Z=r[13],te=r[14],ce=r[15],ne=a[0],ae=a[1],pe=a[2],he=a[3];return s[0]=ne*h+ae*w+pe*R+he*$,s[1]=ne*f+ae*D+pe*O+he*Z,s[2]=ne*_+ae*S+pe*N+he*te,s[3]=ne*x+ae*P+pe*B+he*ce,s[4]=(ne=a[4])*h+(ae=a[5])*w+(pe=a[6])*R+(he=a[7])*$,s[5]=ne*f+ae*D+pe*O+he*Z,s[6]=ne*_+ae*S+pe*N+he*te,s[7]=ne*x+ae*P+pe*B+he*ce,s[8]=(ne=a[8])*h+(ae=a[9])*w+(pe=a[10])*R+(he=a[11])*$,s[9]=ne*f+ae*D+pe*O+he*Z,s[10]=ne*_+ae*S+pe*N+he*te,s[11]=ne*x+ae*P+pe*B+he*ce,s[12]=(ne=a[12])*h+(ae=a[13])*w+(pe=a[14])*R+(he=a[15])*$,s[13]=ne*f+ae*D+pe*O+he*Z,s[14]=ne*_+ae*S+pe*N+he*te,s[15]=ne*x+ae*P+pe*B+he*ce,s}function ua(s,r,a){var h,f,_,x,w,D,S,P,R,O,N,B,$=a[0],Z=a[1],te=a[2];return r===s?(s[12]=r[0]*$+r[4]*Z+r[8]*te+r[12],s[13]=r[1]*$+r[5]*Z+r[9]*te+r[13],s[14]=r[2]*$+r[6]*Z+r[10]*te+r[14],s[15]=r[3]*$+r[7]*Z+r[11]*te+r[15]):(f=r[1],_=r[2],x=r[3],w=r[4],D=r[5],S=r[6],P=r[7],R=r[8],O=r[9],N=r[10],B=r[11],s[0]=h=r[0],s[1]=f,s[2]=_,s[3]=x,s[4]=w,s[5]=D,s[6]=S,s[7]=P,s[8]=R,s[9]=O,s[10]=N,s[11]=B,s[12]=h*$+w*Z+R*te+r[12],s[13]=f*$+D*Z+O*te+r[13],s[14]=_*$+S*Z+N*te+r[14],s[15]=x*$+P*Z+B*te+r[15]),s}function yc(s,r,a){var h=a[0],f=a[1],_=a[2];return s[0]=r[0]*h,s[1]=r[1]*h,s[2]=r[2]*h,s[3]=r[3]*h,s[4]=r[4]*f,s[5]=r[5]*f,s[6]=r[6]*f,s[7]=r[7]*f,s[8]=r[8]*_,s[9]=r[9]*_,s[10]=r[10]*_,s[11]=r[11]*_,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function kh(s,r,a){var h=Math.sin(a),f=Math.cos(a),_=r[4],x=r[5],w=r[6],D=r[7],S=r[8],P=r[9],R=r[10],O=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=_*f+S*h,s[5]=x*f+P*h,s[6]=w*f+R*h,s[7]=D*f+O*h,s[8]=S*f-_*h,s[9]=P*f-x*h,s[10]=R*f-w*h,s[11]=O*f-D*h,s}function vc(s,r,a){var h=Math.sin(a),f=Math.cos(a),_=r[0],x=r[1],w=r[2],D=r[3],S=r[8],P=r[9],R=r[10],O=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=_*f-S*h,s[1]=x*f-P*h,s[2]=w*f-R*h,s[3]=D*f-O*h,s[8]=_*h+S*f,s[9]=x*h+P*f,s[10]=w*h+R*f,s[11]=D*h+O*f,s}function av(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function d1(s,r,a){var h,f,_,x=a[0],w=a[1],D=a[2],S=Math.hypot(x,w,D);return S<Pg?null:(x*=S=1/S,w*=S,D*=S,h=Math.sin(r),f=Math.cos(r),s[0]=x*x*(_=1-f)+f,s[1]=w*x*_+D*h,s[2]=D*x*_-w*h,s[3]=0,s[4]=x*w*_-D*h,s[5]=w*w*_+f,s[6]=D*w*_+x*h,s[7]=0,s[8]=x*D*_+w*h,s[9]=w*D*_-x*h,s[10]=D*D*_+f,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var f1=Rr;function lv(){var s=new ps(3);return ps!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Wo(s){var r=new ps(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function vu(s){return Math.hypot(s[0],s[1],s[2])}function ha(s,r,a){var h=new ps(3);return h[0]=s,h[1]=r,h[2]=a,h}function xc(s,r,a){return s[0]=r[0]+a[0],s[1]=r[1]+a[1],s[2]=r[2]+a[2],s}function Bp(s,r,a){return s[0]=r[0]-a[0],s[1]=r[1]-a[1],s[2]=r[2]-a[2],s}function cv(s,r,a){return s[0]=r[0]*a[0],s[1]=r[1]*a[1],s[2]=r[2]*a[2],s}function uf(s,r,a){return s[0]=Math.min(r[0],a[0]),s[1]=Math.min(r[1],a[1]),s[2]=Math.min(r[2],a[2]),s}function hf(s,r,a){return s[0]=Math.max(r[0],a[0]),s[1]=Math.max(r[1],a[1]),s[2]=Math.max(r[2],a[2]),s}function ms(s,r,a){return s[0]=r[0]*a,s[1]=r[1]*a,s[2]=r[2]*a,s}function df(s,r,a,h){return s[0]=r[0]+a[0]*h,s[1]=r[1]+a[1]*h,s[2]=r[2]+a[2]*h,s}function mo(s,r){var a=r[0],h=r[1],f=r[2],_=a*a+h*h+f*f;return _>0&&(_=1/Math.sqrt(_)),s[0]=r[0]*_,s[1]=r[1]*_,s[2]=r[2]*_,s}function qo(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function Rh(s,r,a){var h=r[0],f=r[1],_=r[2],x=a[0],w=a[1],D=a[2];return s[0]=f*D-_*w,s[1]=_*x-h*D,s[2]=h*w-f*x,s}function yi(s,r,a){var h=r[0],f=r[1],_=r[2],x=a[3]*h+a[7]*f+a[11]*_+a[15];return s[0]=(a[0]*h+a[4]*f+a[8]*_+a[12])/(x=x||1),s[1]=(a[1]*h+a[5]*f+a[9]*_+a[13])/x,s[2]=(a[2]*h+a[6]*f+a[10]*_+a[14])/x,s}function Oh(s,r,a){var h=a[0],f=a[1],_=a[2],x=r[0],w=r[1],D=r[2],S=f*D-_*w,P=_*x-h*D,R=h*w-f*x,O=f*R-_*P,N=_*S-h*R,B=h*P-f*S,$=2*a[3];return P*=$,R*=$,N*=2,B*=2,s[0]=x+(S*=$)+(O*=2),s[1]=w+P+N,s[2]=D+R+B,s}var Lh,So=Bp,p1=cv,uv=vu;function Fh(s,r,a){return s[0]=r[0]*a,s[1]=r[1]*a,s[2]=r[2]*a,s[3]=r[3]*a,s}function ff(s,r){var a=r[0],h=r[1],f=r[2],_=r[3],x=a*a+h*h+f*f+_*_;return x>0&&(x=1/Math.sqrt(x)),s[0]=a*x,s[1]=h*x,s[2]=f*x,s[3]=_*x,s}function bc(s,r,a){var h=r[0],f=r[1],_=r[2],x=r[3];return s[0]=a[0]*h+a[4]*f+a[8]*_+a[12]*x,s[1]=a[1]*h+a[5]*f+a[9]*_+a[13]*x,s[2]=a[2]*h+a[6]*f+a[10]*_+a[14]*x,s[3]=a[3]*h+a[7]*f+a[11]*_+a[15]*x,s}function hv(){var s=new ps(4);return ps!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function dv(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function xu(s,r,a){a*=.5;var h=r[0],f=r[1],_=r[2],x=r[3],w=Math.sin(a),D=Math.cos(a);return s[0]=h*D+x*w,s[1]=f*D+_*w,s[2]=_*D-f*w,s[3]=x*D-h*w,s}function zh(s,r,a){a*=.5;var h=r[0],f=r[1],_=r[2],x=r[3],w=Math.sin(a),D=Math.cos(a);return s[0]=h*D-_*w,s[1]=f*D+x*w,s[2]=_*D+h*w,s[3]=x*D-f*w,s}lv(),Lh=new ps(4),ps!=Float32Array&&(Lh[0]=0,Lh[1]=0,Lh[2]=0,Lh[3]=0);var m1=ff;lv(),ha(1,0,0),ha(0,1,0),hv(),hv(),ur();const OD=xe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Rg}=OD,fv=xe([{name:"a_pos_3",components:3,type:"Int16"}]);var Vp=xe([{name:"a_pos",type:"Int16",components:2}]);class Og{constructor(r,a){this.pos=r,this.dir=a}intersectsPlane(r,a,h){const f=qo(a,this.dir);if(Math.abs(f)<1e-6)return!1;const _=((r[0]-this.pos[0])*a[0]+(r[1]-this.pos[1])*a[1]+(r[2]-this.pos[2])*a[2])/f;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,h[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(r,a,h){if($=(N=this.pos)[0],Z=N[1],te=N[2],ce=(B=r)[0],ne=B[1],ae=B[2],Math.abs($-ce)<=Pg*Math.max(1,Math.abs($),Math.abs(ce))&&Math.abs(Z-ne)<=Pg*Math.max(1,Math.abs(Z),Math.abs(ne))&&Math.abs(te-ae)<=Pg*Math.max(1,Math.abs(te),Math.abs(ae))||0===a)return h[0]=h[1]=h[2]=0,!1;var N,B,$,Z,te,ce,ne,ae;const[f,_,x]=this.dir,w=this.pos[0]-r[0],D=this.pos[1]-r[1],S=this.pos[2]-r[2],P=f*f+_*_+x*x,R=2*(w*f+D*_+S*x),O=R*R-4*P*(w*w+D*D+S*S-a*a);if(O<0){const N=Math.max(-R/2,0),B=w+f*N,$=D+_*N,Z=S+x*N,te=Math.hypot(B,$,Z);return h[0]=B*a/te,h[1]=$*a/te,h[2]=Z*a/te,!1}{const N=(-R-Math.sqrt(O))/(2*P);if(N<0){const B=Math.hypot(w,D,S);return h[0]=w*a/B,h[1]=D*a/B,h[2]=S*a/B,!1}return h[0]=w+f*N,h[1]=D+_*N,h[2]=S+x*N,!0}}}class Lg{constructor(r,a,h,f,_){this.TL=r,this.TR=a,this.BR=h,this.BL=f,this.horizon=_}static fromInvProjectionMatrix(r,a,h){const f=[-1,1,1],_=[1,1,1],x=[1,-1,1],w=[-1,-1,1],D=yi(f,f,r),S=yi(_,_,r),P=yi(x,x,r),R=yi(w,w,r);return new Lg(D,S,P,R,a/h)}}class Fg{constructor(r,a){this.points=r,this.planes=a}static fromInvProjectionMatrix(r,a,h,f){const _=Math.pow(2,h),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const S=bc([],D,r),P=1/S[3]/a*_;return(R=S)[0]=(O=S)[0]*(N=[P,P,f?1/S[3]:P,P])[0],R[1]=O[1]*N[1],R[2]=O[2]*N[2],R[3]=O[3]*N[3],R;var R,O,N}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const S=mo([],Rh([],So([],x[D[0]],x[D[1]]),So([],x[D[2]],x[D[1]]))),P=-qo(S,x[D[1]]);return S.concat(P)});return new Fg(x,w)}}class vr{static fromPoints(r){const a=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const f of r)uf(a,a,f),hf(h,h,f);return new vr(a,h)}static applyTransform(r,a){const h=r.getCorners();for(let f=0;f<h.length;++f)yi(h[f],h[f],a);return vr.fromPoints(h)}constructor(r,a){this.min=r,this.max=a,this.center=ms([],xc([],this.min,this.max),.5)}quadrant(r){const a=[r%2==0,r<2],h=Wo(this.min),f=Wo(this.max);for(let _=0;_<a.length;_++)h[_]=a[_]?this.min[_]:this.center[_],f[_]=a[_]?this.center[_]:this.max[_];return f[2]=this.max[2],new vr(h,f)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,a=this.max;return[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]],[r[0],r[1],a[2]],[a[0],r[1],a[2]],[a[0],a[1],a[2]],[r[0],a[1],a[2]]]}intersects(r){const a=this.getCorners();let h=!0;for(let f=0;f<r.planes.length;f++){const _=r.planes[f];let x=0;for(let w=0;w<a.length;w++)x+=qo(_,a[w])+_[3]>=0;if(0===x)return 0;x!==a.length&&(h=!1)}if(h)return 2;for(let f=0;f<3;f++){let _=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let w=0;w<r.points.length;w++){const D=r.points[w][f]-this.min[f];_=Math.min(_,D),x=Math.max(x,D)}if(x<0||_>this.max[f]-this.min[f])return 0}return 1}}const jp=5,pv=6,da=St/Math.PI/2,LD=16383,Up=[64,32,16],zs=-da,Ns=da,zg=[new vr([zs,zs,zs],[Ns,Ns,Ns]),new vr([zs,zs,zs],[0,0,Ns]),new vr([0,zs,zs],[Ns,0,Ns]),new vr([zs,0,zs],[0,Ns,Ns]),new vr([0,0,zs],[Ns,Ns,Ns])];function Ng(s){return s*da/_f}function g1(s,r,a,h=!0){const f=ms([],s._camera.position,s.worldSize),_=[r,a,1,1];bc(_,_,s.pixelMatrixInverse),Fh(_,_,1/_[3]);const x=mo([],So([],_,f)),w=s.globeMatrix,D=[w[12],w[13],w[14]],S=So([],D,f),P=vu(S),R=mo([],S),O=s.worldSize/(2*Math.PI),N=qo(R,x),B=Math.asin(O/P);if(B<Math.acos(N)){if(!h)return null;const Ge=[],Ae=[];ms(Ge,x,P/N),mo(Ae,So(Ae,Ge,S)),mo(x,xc(x,S,ms(x,Ae,Math.tan(B)*P)))}const $=[];new Og(f,x).closestPointOnSphere(D,O,$);const Z=mo([],Ys(w,0)),te=mo([],Ys(w,1)),ce=mo([],Ys(w,2)),ne=qo(Z,$),ae=qo(te,$),pe=qo(ce,$),he=or(Math.asin(-ae/O));let Me=or(Math.atan2(ne,pe));Me=s.center.lng+function(Ge,Ae){const Be=(Ae-Ge+180)%360-180;return Be<-180?Be+360:Be}(s.center.lng,Me);const Ee=Ci(Me),Oe=hn(Zo(he),0,1);return new Vh(Ee,Oe)}class Bg{constructor(r,a,h){this.a=So([],r,h),this.b=So([],a,h),this.center=h;const f=mo([],this.a),_=mo([],this.b);this.angle=Math.acos(qo(f,_))}}function mv(s,r){if(0===s.angle)return null;let a;return a=0===s.a[r]?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[r]/s.a[r]/Math.sin(s.angle)-1/Math.tan(s.angle)),a<0||a>1?null:function(h,f,_,x){const w=Math.sin(_);return h*(Math.sin((1-x)*_)/w)+f*(Math.sin(x*_)/w)}(s.a[r],s.b[r],s.angle,hn(a,0,1))+s.center[r]}function Nl(s){if(s.z<=1)return zg[s.z+2*s.y+s.x];const r=mf(pf(s));return vr.fromPoints(r)}function Nh(s,r,a){return ms(s,s,1-a),df(s,s,r,a)}function _1(s,r){const a=Cc(r.zoom);if(0===a)return Nl(s);const h=pf(s),f=mf(h),_=Ci(h.getWest())*r.worldSize,x=Ci(h.getEast())*r.worldSize,w=Zo(h.getNorth())*r.worldSize,D=Zo(h.getSouth())*r.worldSize,S=[_,w,0],P=[x,w,0],R=[_,D,0],O=[x,D,0],N=kg([],r.globeMatrix);return yi(S,S,N),yi(P,P,N),yi(R,R,N),yi(O,O,N),f[0]=Nh(f[0],R,a),f[1]=Nh(f[1],O,a),f[2]=Nh(f[2],P,a),f[3]=Nh(f[3],S,a),vr.fromPoints(f)}function y1(s,r,a){for(const h of s)yi(h,h,r),ms(h,h,a)}function pf({x:s,y:r,z:a}){const h=1/(1<<a),f=new jn(Xo(s*h),Or((r+1)*h)),_=new jn(Xo((s+1)*h),Or(r*h));return new Fs(f,_)}function mf(s){const r=an(s.getNorth()),a=an(s.getSouth()),h=Math.cos(r),f=Math.cos(a),_=Math.sin(r),x=Math.sin(a),w=s.getWest(),D=s.getEast();return[bu(f,x,w),bu(f,x,D),bu(h,_,D),bu(h,_,w)]}function bu(s,r,a,h=da){return a=an(a),[s*Math.sin(a)*h,-r*h,s*Math.cos(a)*h]}function wu(s,r,a){return bu(Math.cos(an(s)),Math.sin(an(s)),r,a)}function Bh(s,r,a,h){const f=1<<a.z,_=(s/St+a.x)/f;return wu(Or((r/St+a.y)/f),Xo(_),h)}function Yr({min:s,max:r}){return LD/Math.max(r[0]-s[0],r[1]-s[1],r[2]-s[2])}const gv=new Float64Array(16);function gf(s){const r=Yr(s),a=av(gv,[r,r,r]);return ua(a,a,((h=[])[0]=-(f=s.min)[0],h[1]=-f[1],h[2]=-f[2],h));var h,f}function Vg(s){const r=(h=s.min,(a=gv)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=h[0],a[13]=h[1],a[14]=h[2],a[15]=1,a);var a,h;const f=1/Yr(s);return yc(r,r,[f,f,f])}function jg(s,r,a,h,f){const _=function(D){const S=St/(2*Math.PI);return D/(2*Math.PI)/S}(a),x=[s,r,-a/(2*Math.PI)],w=To(new Float64Array(16));return ua(w,w,x),yc(w,w,[_,_,_]),kh(w,w,an(-f)),vc(w,w,an(-h)),w}function Cc(s){return cl(jp,pv,s)}function _v(s,r){const a=wu(r.lat,r.lng);return x=(f=Bp([],function(B){const $=wu(B._center.lat,B._center.lng);let Z=Rh([],ha(0,1,0),$);const te=d1([],-B.angle,$);Z=yi(Z,Z,te),d1(te,-B._pitch,Z);const ce=mo([],$);return ms(ce,ce,Ng(B.cameraToCenterDistance/B.pixelsPerMeter)),yi(ce,ce,te),xc([],$,ce)}(s),a))[0],w=f[1],D=f[2],S=(_=a)[0],P=_[1],R=_[2],N=(O=Math.sqrt(x*x+w*w+D*D)*Math.sqrt(S*S+P*P+R*R))&&qo(f,_)/O,Math.acos(Math.min(Math.max(N,-1),1));var f,_,x,w,D,S,P,R,O,N}function Ug(s,r){return _v(s,r)>Math.PI/2*1.01}const yv=an(85),vv=Math.cos(yv),x1=Math.sin(yv),_f=6371008.8,Mo=2*Math.PI*_f;class ja{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ja(fn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,h=this.lat*a,f=r.lat*a,_=Math.sin(h)*Math.sin(f)+Math.cos(h)*Math.cos(f)*Math.cos((r.lng-this.lng)*a);return _f*Math.acos(Math.min(_,1))}toBounds(r=0){const a=360*r/40075017,h=a/Math.cos(Math.PI/180*this.lat);return new Fs(new ja(this.lng-h,this.lat-a),new ja(this.lng+h,this.lat+a))}toEcef(r){const a=Ng(r);return wu(this.lat,this.lng,da+a)}static convert(r){if(r instanceof ja)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new ja(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new ja(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var jn=ja;function yf(s){return Mo*Math.cos(s*Math.PI/180)}function Ci(s){return(180+s)/360}function Zo(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Bs(s,r){return s/yf(r)}function Xo(s){return 360*s-180}function Or(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function $g(s,r){return s*yf(Or(r))}const Lr=85.051129;function Hg(s){return 1/Math.cos(s*Math.PI/180)}class Vh{constructor(r,a,h=0){this.x=+r,this.y=+a,this.z=+h}static fromLngLat(r,a=0){const h=jn.convert(r);return new Vh(Ci(h.lng),Zo(h.lat),Bs(a,h.lat))}toLngLat(){return new jn(Xo(this.x),Or(this.y))}toAltitude(){return $g(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Mo*Hg(Or(this.y))}}function $p(s,r,a,h,f,_,x,w,D){const S=(r+h)/2,P=(a+f)/2,R=new st(S,P);w(R),function(O,N,B,$,Z,te){const ce=B-Z,ne=$-te;return Math.abs(($-N)*ce-(B-O)*ne)/Math.hypot(ce,ne)}(R.x,R.y,_.x,_.y,x.x,x.y)>=D?($p(s,r,a,S,P,_,R,w,D),$p(s,S,P,h,f,R,x,w,D)):s.push(x)}function xv(s,r,a){let h=s[0],f=h.x,_=h.y;r(h);const x=[h];for(let w=1;w<s.length;w++){const D=s[w],{x:S,y:P}=D;r(D),$p(x,f,_,S,P,h,D,r,a),f=S,_=P,h=D}return x}function Gg(s,r,a,h){if(h(r,a)){const f=r.add(a)._mult(.5);Gg(s,r,f,h),Gg(s,f,a,h)}else s.push(a)}function Wg(s,r){let a=s[0];const h=[a];for(let f=1;f<s.length;f++){const _=s[f];Gg(h,a,_,r),a=_}return h}const vf=Math.pow(2,14)-1,bv=-vf-1;function xf(s,r){const a=Math.round(s.x*r),h=Math.round(s.y*r);return s.x=hn(a,bv,vf),s.y=hn(h,bv,vf),(a<s.x||a>s.x+1||h<s.y||h>s.y+1)&&ui("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function Bl(s,r,a){const h=s.loadGeometry(),f=s.extent,_=St/f;if(r&&a&&a.projection.isReprojectedInTileSpace){const x=1<<r.z,{scale:w,x:D,y:S,projection:P}=a,R=O=>{const N=Xo((r.x+O.x/f)/x),B=Or((r.y+O.y/f)/x),$=P.project(N,B);O.x=($.x*w-D)*f,O.y=($.y*w-S)*f};for(let O=0;O<h.length;O++)if(1!==s.type)h[O]=xv(h[O],R,1);else{const N=[];for(const B of h[O])B.x<0||B.x>=f||B.y<0||B.y>=f||(R(B),N.push(B));h[O]=N}}for(const x of h)for(const w of x)xf(w,_);return h}function Cu(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?Bl(s):[]}}function jh(s,r,a,h,f){s.emplaceBack(2*r+(h+1)/2,2*a+(f+1)/2)}function Uh(s,r,a){s.emplaceBack(r.x,r.y,r.z,16384*a[0],16384*a[1],16384*a[2])}class Hp{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new Xe,this.indexArray=new vt,this.segments=new $i,this.programConfigurations=new zl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,h,f){const _=this.layers[0],x=[];let w=null;"circle"===_.type&&(w=_.layout.get("circle-sort-key"));for(const{feature:S,id:P,index:R,sourceLayerIndex:O}of r){const N=this.layers[0]._featureFilter.needGeometry,B=Cu(S,N);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),B,h))continue;const $=w?w.evaluate(B,{},h):void 0,Z={id:P,properties:S.properties,type:S.type,sourceLayerIndex:O,index:R,geometry:N?B.geometry:Bl(S,h,f),patterns:{},sortKey:$};x.push(Z)}w&&x.sort((S,P)=>S.sortKey-P.sortKey);let D=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new Ye,D=f.projection);for(const S of x){const{geometry:P,index:R,sourceLayerIndex:O}=S,N=r[R].feature;this.addFeature(S,P,R,a.availableImages,h,D),a.featureIndex.insert(N,P,R,O,this.index)}}update(r,a,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,kD.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,RD.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,a,h,f,_,x){for(const w of a)for(const D of w){const S=D.x,P=D.y;if(S<0||S>=St||P<0||P>=St)continue;if(x){const N=x.projectTilePoint(S,P,_),B=x.upVector(_,S,P),$=this.globeExtVertexArray;Uh($,N,B),Uh($,N,B),Uh($,N,B),Uh($,N,B)}const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),O=R.vertexLength;jh(this.layoutVertexArray,S,P,-1,-1),jh(this.layoutVertexArray,S,P,1,-1),jh(this.layoutVertexArray,S,P,1,1),jh(this.layoutVertexArray,S,P,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{},f,_)}}function Eu(s,r){for(let a=0;a<s.length;a++)if(Du(r,s[a]))return!0;for(let a=0;a<r.length;a++)if(Du(s,r[a]))return!0;return!!bf(s,r)}function qg(s,r,a){return!!Du(s,r)||!!Xg(r,s,a)}function Zg(s,r){if(1===s.length)return Cv(r,s[0]);for(let a=0;a<r.length;a++){const h=r[a];for(let f=0;f<h.length;f++)if(Du(s,h[f]))return!0}for(let a=0;a<s.length;a++)if(Cv(r,s[a]))return!0;for(let a=0;a<r.length;a++)if(bf(s,r[a]))return!0;return!1}function b1(s,r,a){if(s.length>1){if(bf(s,r))return!0;for(let h=0;h<r.length;h++)if(Xg(r[h],s,a))return!0}for(let h=0;h<s.length;h++)if(Xg(s[h],r,a))return!0;return!1}function bf(s,r){if(0===s.length||0===r.length)return!1;for(let a=0;a<s.length-1;a++){const h=s[a],f=s[a+1];for(let _=0;_<r.length-1;_++)if(w1(h,f,r[_],r[_+1]))return!0}return!1}function w1(s,r,a,h){return zo(s,a,h)!==zo(r,a,h)&&zo(s,r,a)!==zo(s,r,h)}function Xg(s,r,a){const h=a*a;if(1===r.length)return s.distSqr(r[0])<h;for(let f=1;f<r.length;f++)if(wv(s,r[f-1],r[f])<h)return!0;return!1}function wv(s,r,a){const h=r.distSqr(a);if(0===h)return s.distSqr(r);const f=((s.x-r.x)*(a.x-r.x)+(s.y-r.y)*(a.y-r.y))/h;return s.distSqr(f<0?r:f>1?a:a.sub(r)._mult(f)._add(r))}function Cv(s,r){let a,h,f,_=!1;for(let x=0;x<s.length;x++){a=s[x];for(let w=0,D=a.length-1;w<a.length;D=w++)h=a[w],f=a[D],h.y>r.y!=f.y>r.y&&r.x<(f.x-h.x)*(r.y-h.y)/(f.y-h.y)+h.x&&(_=!_)}return _}function Du(s,r){let a=!1;for(let h=0,f=s.length-1;h<s.length;f=h++){const _=s[h],x=s[f];_.y>r.y!=x.y>r.y&&r.x<(x.x-_.x)*(r.y-_.y)/(x.y-_.y)+_.x&&(a=!a)}return a}function Ev(s,r,a,h,f){for(const x of s)if(r<=x.x&&a<=x.y&&h>=x.x&&f>=x.y)return!0;const _=[new st(r,a),new st(r,f),new st(h,f),new st(h,a)];if(s.length>2)for(const x of _)if(Du(s,x))return!0;for(let x=0;x<s.length-1;x++)if(Dv(s[x],s[x+1],_))return!0;return!1}function Dv(s,r,a){const h=a[0],f=a[2];if(s.x<h.x&&r.x<h.x||s.x>f.x&&r.x>f.x||s.y<h.y&&r.y<h.y||s.y>f.y&&r.y>f.y)return!1;const _=zo(s,r,a[0]);return _!==zo(s,r,a[1])||_!==zo(s,r,a[2])||_!==zo(s,r,a[3])}function Ec(s,r,a){const h=r.paint.get(s).value;return"constant"===h.kind?h.value:a.programConfigurations.get(r.id).getMaxValue(s)}function wf(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Gp(s,r,a,h,f){if(!r[0]&&!r[1])return s;const _=st.convert(r)._mult(f);"viewport"===a&&_._rotate(-h);const x=[];for(let w=0;w<s.length;w++)x.push(s[w].sub(_));return x}function Tv(s,r,a,h){const f=st.convert(s)._mult(h);return"viewport"===r&&f._rotate(-a),f}pt(Hp,"CircleBucket",{omit:["layers"]});const C1=new re({"circle-sort-key":new Y(ze.layout_circle["circle-sort-key"])});var Sv={paint:new re({"circle-radius":new Y(ze.paint_circle["circle-radius"]),"circle-color":new Y(ze.paint_circle["circle-color"]),"circle-blur":new Y(ze.paint_circle["circle-blur"]),"circle-opacity":new Y(ze.paint_circle["circle-opacity"]),"circle-translate":new U(ze.paint_circle["circle-translate"]),"circle-translate-anchor":new U(ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new U(ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new U(ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Y(ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Y(ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Y(ze.paint_circle["circle-stroke-opacity"])}),layout:C1};function Yg(s,r,a,h,f,_,x,w,D){if(_&&s.queryGeometry.isAboveHorizon)return!1;_&&(D*=s.pixelToTileUnitsFactor);const S=s.tileID.canonical,P=a.projection.upVectorScale(S,a.center.lat,a.worldSize).metersToTile;for(const R of r)for(const O of R){const N=O.add(w),B=f&&a.elevation?a.elevation.exaggeration()*f.getElevationAt(N.x,N.y,!0):0,$=a.projection.projectTilePoint(N.x,N.y,S);if(B>0){const ne=a.projection.upVector(S,N.x,N.y);$.x+=ne[0]*P*B,$.y+=ne[1]*P*B,$.z+=ne[2]*P*B}const Z=_?N:Tu($.x,$.y,$.z,h),te=_?s.tilespaceRays.map(ne=>E1(ne,B)):s.queryGeometry.screenGeometry,ce=bc([],[$.x,$.y,$.z,1],h);if(!x&&_?D*=ce[3]/a.cameraToCenterDistance:x&&!_&&(D*=a.cameraToCenterDistance/ce[3]),_){const ne=Or((O.y/St+S.y)/(1<<S.z));D/=a.projection.pixelsPerMeter(ne,1)/Bs(1,ne)}if(qg(te,Z,D))return!0}return!1}function Tu(s,r,a,h){const f=bc([],[s,r,a,1],h);return new st(f[0]/f[3],f[1]/f[3])}const Kg=ha(0,0,0),Mv=ha(0,0,1);function E1(s,r){const a=lv();return Kg[2]=r,s.intersectsPlane(Kg,Mv,a),new st(a[0],a[1])}class D1 extends Hp{}function Cf(s,{width:r,height:a},h,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==r*a*h)throw new RangeError("mismatched image size")}else f=new Uint8Array(r*a*h);return s.width=r,s.height=a,s.data=f,s}function Iv(s,r,a){const{width:h,height:f}=r;h===s.width&&f===s.height||(Wp(s,r,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,h),height:Math.min(s.height,f)},a),s.width=h,s.height=f,s.data=r.data)}function Wp(s,r,a,h,f,_){if(0===f.width||0===f.height)return r;if(f.width>s.width||f.height>s.height||a.x>s.width-f.width||a.y>s.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>r.width||f.height>r.height||h.x>r.width-f.width||h.y>r.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,w=r.data;for(let D=0;D<f.height;D++){const S=((a.y+D)*s.width+a.x)*_,P=((h.y+D)*r.width+h.x)*_;for(let R=0;R<f.width*_;R++)w[P+R]=x[S+R]}return r}pt(D1,"HeatmapBucket",{omit:["layers"]});class Ua{constructor(r,a){Cf(this,r,1,a)}resize(r){Iv(this,new Ua(r),1)}clone(){return new Ua({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,h,f,_){Wp(r,a,h,f,_,1)}}class Io{constructor(r,a){Cf(this,r,4,a)}resize(r){Iv(this,new Io(r),4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Io({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,h,f,_){Wp(r,a,h,f,_,4)}}pt(Ua,"AlphaImage"),pt(Io,"RGBAImage");var Jg={paint:new re({"heatmap-radius":new Y(ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Y(ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new U(ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ie(ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new U(ze.paint_heatmap["heatmap-opacity"])})};function qp(s){const r={},a=s.resolution||256,h=s.clips?s.clips.length:1,f=s.image||new Io({width:a,height:h}),_=(x,w,D)=>{r[s.evaluationKey]=D;const S=s.expression.evaluate(r);f.data[x+w+0]=Math.floor(255*S.r/S.a),f.data[x+w+1]=Math.floor(255*S.g/S.a),f.data[x+w+2]=Math.floor(255*S.b/S.a),f.data[x+w+3]=Math.floor(255*S.a)};if(s.clips)for(let x=0,w=0;x<h;++x,w+=4*a)for(let D=0,S=0;D<a;D++,S+=4){const P=D/(a-1),{start:R,end:O}=s.clips[x];_(w,S,R*(1-P)+O*P)}else for(let x=0,w=0;x<a;x++,w+=4)_(0,w,x/(a-1));return f}var Zp={paint:new re({"hillshade-illumination-direction":new U(ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new U(ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new U(ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new U(ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new U(ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new U(ze.paint_hillshade["hillshade-accent-color"])})};const Xp=xe([{name:"a_pos",components:2,type:"Int16"}],4),{members:Av}=Xp;var Ef={exports:{}};function $h(s,r,a){a=a||2;var h,f,_,x,w,D,S,P=r&&r.length,R=P?r[0]*a:s.length,O=Yp(s,0,R,a,!0),N=[];if(!O||O.next===O.prev)return N;if(P&&(O=function($,Z,te,ce){var ne,ae,pe,he=[];for(ne=0,ae=Z.length;ne<ae;ne++)(pe=Yp($,Z[ne]*ce,ne<ae-1?Z[ne+1]*ce:$.length,ce,!1))===pe.next&&(pe.steiner=!0),he.push(Hh(pe));for(he.sort(kv),ne=0;ne<he.length;ne++)te=Rv(he[ne],te);return te}(s,r,O,a)),s.length>80*a){h=_=s[0],f=x=s[1];for(var B=a;B<R;B+=a)(w=s[B])<h&&(h=w),(D=s[B+1])<f&&(f=D),w>_&&(_=w),D>x&&(x=D);S=0!==(S=Math.max(_-h,x-f))?32767/S:0}return Df(O,N,a,h,f,S,0),N}function Yp(s,r,a,h,f){var _,x;if(f===im(s,r,a,h)>0)for(_=r;_<a;_+=h)x=Qg(_,s[_],s[_+1],x);else for(_=a-h;_>=r;_-=h)x=Qg(_,s[_],s[_+1],x);return x&&Jp(x,x.next)&&(Wh(x),x=x.next),x}function fa(s,r){if(!s)return s;r||(r=s);var a,h=s;do{if(a=!1,h.steiner||!Jp(h,h.next)&&0!==Hi(h.prev,h,h.next))h=h.next;else{if(Wh(h),(h=r=h.prev)===h.next)break;a=!0}}while(a||h!==r);return r}function Df(s,r,a,h,f,_,x){if(s){!x&&_&&function(P,R,O,N){var B=P;do{0===B.z&&(B.z=Tf(B.x,B.y,R,O,N)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next}while(B!==P);B.prevZ.nextZ=null,B.prevZ=null,function($){var Z,te,ce,ne,ae,pe,he,Me,Ee=1;do{for(te=$,$=null,ae=null,pe=0;te;){for(pe++,ce=te,he=0,Z=0;Z<Ee&&(he++,ce=ce.nextZ);Z++);for(Me=Ee;he>0||Me>0&&ce;)0!==he&&(0===Me||!ce||te.z<=ce.z)?(ne=te,te=te.nextZ,he--):(ne=ce,ce=ce.nextZ,Me--),ae?ae.nextZ=ne:$=ne,ne.prevZ=ae,ae=ne;te=ce}ae.nextZ=null,Ee*=2}while(pe>1)}(B)}(s,h,f,_);for(var w,D,S=s;s.prev!==s.next;)if(w=s.prev,D=s.next,_?T1(s,h,f,_):Pv(s))r.push(w.i/a|0),r.push(s.i/a|0),r.push(D.i/a|0),Wh(s),s=D.next,S=D.next;else if((s=D)===S){x?1===x?Df(s=S1(fa(s),r,a),r,a,h,f,_,2):2===x&&M1(s,r,a,h,f,_):Df(fa(s),r,a,h,f,_,1);break}}}function Pv(s){var r=s.prev,a=s,h=s.next;if(Hi(r,a,h)>=0)return!1;for(var f=r.x,_=a.x,x=h.x,w=r.y,D=a.y,S=h.y,P=f<_?f<x?f:x:_<x?_:x,R=w<D?w<S?w:S:D<S?D:S,O=f>_?f>x?f:x:_>x?_:x,N=w>D?w>S?w:S:D>S?D:S,B=h.next;B!==r;){if(B.x>=P&&B.x<=O&&B.y>=R&&B.y<=N&&Gh(f,w,_,D,x,S,B.x,B.y)&&Hi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function T1(s,r,a,h){var f=s.prev,_=s,x=s.next;if(Hi(f,_,x)>=0)return!1;for(var w=f.x,D=_.x,S=x.x,P=f.y,R=_.y,O=x.y,N=w<D?w<S?w:S:D<S?D:S,B=P<R?P<O?P:O:R<O?R:O,$=w>D?w>S?w:S:D>S?D:S,Z=P>R?P>O?P:O:R>O?R:O,te=Tf(N,B,r,a,h),ce=Tf($,Z,r,a,h),ne=s.prevZ,ae=s.nextZ;ne&&ne.z>=te&&ae&&ae.z<=ce;){if(ne.x>=N&&ne.x<=$&&ne.y>=B&&ne.y<=Z&&ne!==f&&ne!==x&&Gh(w,P,D,R,S,O,ne.x,ne.y)&&Hi(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,ae.x>=N&&ae.x<=$&&ae.y>=B&&ae.y<=Z&&ae!==f&&ae!==x&&Gh(w,P,D,R,S,O,ae.x,ae.y)&&Hi(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;ne&&ne.z>=te;){if(ne.x>=N&&ne.x<=$&&ne.y>=B&&ne.y<=Z&&ne!==f&&ne!==x&&Gh(w,P,D,R,S,O,ne.x,ne.y)&&Hi(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;ae&&ae.z<=ce;){if(ae.x>=N&&ae.x<=$&&ae.y>=B&&ae.y<=Z&&ae!==f&&ae!==x&&Gh(w,P,D,R,S,O,ae.x,ae.y)&&Hi(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function S1(s,r,a){var h=s;do{var f=h.prev,_=h.next.next;!Jp(f,_)&&Qp(f,h,h.next,_)&&Dc(f,_)&&Dc(_,f)&&(r.push(f.i/a|0),r.push(h.i/a|0),r.push(_.i/a|0),Wh(h),Wh(h.next),h=s=_),h=h.next}while(h!==s);return fa(h)}function M1(s,r,a,h,f,_){var x=s;do{for(var w=x.next.next;w!==x.prev;){if(x.i!==w.i&&I1(x,w)){var D=tm(x,w);return x=fa(x,x.next),D=fa(D,D.next),Df(x,r,a,h,f,_,0),void Df(D,r,a,h,f,_,0)}w=w.next}x=x.next}while(x!==s)}function kv(s,r){return s.x-r.x}function Rv(s,r){var a=function(f,_){var x,w=_,D=f.x,S=f.y,P=-1/0;do{if(S<=w.y&&S>=w.next.y&&w.next.y!==w.y){var R=w.x+(S-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(R<=D&&R>P&&(P=R,x=w.x<w.next.x?w:w.next,R===D))return x}w=w.next}while(w!==_);if(!x)return null;var O,N=x,B=x.x,$=x.y,Z=1/0;w=x;do{D>=w.x&&w.x>=B&&D!==w.x&&Gh(S<$?D:P,S,B,$,S<$?P:D,S,w.x,w.y)&&(O=Math.abs(S-w.y)/(D-w.x),Dc(w,f)&&(O<Z||O===Z&&(w.x>x.x||w.x===x.x&&Kp(x,w)))&&(x=w,Z=O)),w=w.next}while(w!==N);return x}(s,r);if(!a)return r;var h=tm(a,s);return fa(h,h.next),fa(a,a.next)}function Kp(s,r){return Hi(s.prev,s,r.prev)<0&&Hi(r.next,s,s.next)<0}function Tf(s,r,a,h,f){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-a)*f|0)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*f|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Hh(s){var r=s,a=s;do{(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next}while(r!==s);return a}function Gh(s,r,a,h,f,_,x,w){return(f-x)*(r-w)>=(s-x)*(_-w)&&(s-x)*(h-w)>=(a-x)*(r-w)&&(a-x)*(_-w)>=(f-x)*(h-w)}function I1(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!function(a,h){var f=a;do{if(f.i!==a.i&&f.next.i!==a.i&&f.i!==h.i&&f.next.i!==h.i&&Qp(f,f.next,a,h))return!0;f=f.next}while(f!==a);return!1}(s,r)&&(Dc(s,r)&&Dc(r,s)&&function(a,h){var f=a,_=!1,x=(a.x+h.x)/2,w=(a.y+h.y)/2;do{f.y>w!=f.next.y>w&&f.next.y!==f.y&&x<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(_=!_),f=f.next}while(f!==a);return _}(s,r)&&(Hi(s.prev,s,r.prev)||Hi(s,r.prev,r))||Jp(s,r)&&Hi(s.prev,s,s.next)>0&&Hi(r.prev,r,r.next)>0)}function Hi(s,r,a){return(r.y-s.y)*(a.x-r.x)-(r.x-s.x)*(a.y-r.y)}function Jp(s,r){return s.x===r.x&&s.y===r.y}function Qp(s,r,a,h){var f=Sf(Hi(s,r,a)),_=Sf(Hi(s,r,h)),x=Sf(Hi(a,h,s)),w=Sf(Hi(a,h,r));return f!==_&&x!==w||!(0!==f||!em(s,a,r))||!(0!==_||!em(s,h,r))||!(0!==x||!em(a,s,h))||!(0!==w||!em(a,r,h))}function em(s,r,a){return r.x<=Math.max(s.x,a.x)&&r.x>=Math.min(s.x,a.x)&&r.y<=Math.max(s.y,a.y)&&r.y>=Math.min(s.y,a.y)}function Sf(s){return s>0?1:s<0?-1:0}function Dc(s,r){return Hi(s.prev,s,s.next)<0?Hi(s,r,s.next)>=0&&Hi(s,s.prev,r)>=0:Hi(s,r,s.prev)<0||Hi(s,s.next,r)<0}function tm(s,r){var a=new nm(s.i,s.x,s.y),h=new nm(r.i,r.x,r.y),f=s.next,_=r.prev;return s.next=r,r.prev=s,a.next=f,f.prev=a,h.next=a,a.prev=h,_.next=h,h.prev=_,h}function Qg(s,r,a,h){var f=new nm(s,r,a);return h?(f.next=h.next,f.prev=h,h.next.prev=f,h.next=f):(f.prev=f,f.next=f),f}function Wh(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function nm(s,r,a){this.i=s,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function im(s,r,a,h){for(var f=0,_=r,x=a-h;_<a;_+=h)f+=(s[x]-s[_])*(s[_+1]+s[x+1]),x=_;return f}Ef.exports=$h,Ef.exports.default=$h,$h.deviation=function(s,r,a,h){var f=r&&r.length,_=Math.abs(im(s,0,f?r[0]*a:s.length,a));if(f)for(var x=0,w=r.length;x<w;x++)_-=Math.abs(im(s,r[x]*a,x<w-1?r[x+1]*a:s.length,a));var D=0;for(x=0;x<h.length;x+=3){var S=h[x]*a,P=h[x+1]*a,R=h[x+2]*a;D+=Math.abs((s[S]-s[R])*(s[P+1]-s[S+1])-(s[S]-s[P])*(s[R+1]-s[S+1]))}return 0===_&&0===D?0:Math.abs((D-_)/_)},$h.flatten=function(s){for(var r=s[0][0].length,a={vertices:[],holes:[],dimensions:r},h=0,f=0;f<s.length;f++){for(var _=0;_<s[f].length;_++)for(var x=0;x<r;x++)a.vertices.push(s[f][_][x]);f>0&&a.holes.push(h+=s[f-1].length)}return a};var e_=yo(Ef.exports);function A1(s,r,a,h,f){Ov(s,r,a||0,h||s.length-1,f||P1)}function Ov(s,r,a,h,f){for(;h>a;){if(h-a>600){var _=h-a+1,x=r-a+1,w=Math.log(_),D=.5*Math.exp(2*w/3),S=.5*Math.sqrt(w*D*(_-D)/_)*(x-_/2<0?-1:1);Ov(s,r,Math.max(a,Math.floor(r-x*D/_+S)),Math.min(h,Math.floor(r+(_-x)*D/_+S)),f)}var P=s[r],R=a,O=h;for(Mf(s,a,r),f(s[h],P)>0&&Mf(s,a,h);R<O;){for(Mf(s,R,O),R++,O--;f(s[R],P)<0;)R++;for(;f(s[O],P)>0;)O--}0===f(s[a],P)?Mf(s,a,O):Mf(s,++O,h),O<=r&&(a=O+1),r<=O&&(h=O-1)}}function Mf(s,r,a){var h=s[r];s[r]=s[a],s[a]=h}function P1(s,r){return s<r?-1:s>r?1:0}function $a(s,r){const a=s.length;if(a<=1)return[s];const h=[];let f,_;for(let x=0;x<a;x++){const w=Qu(s[x]);0!==w&&(s[x].area=Math.abs(w),void 0===_&&(_=w<0),_===w<0?(f&&h.push(f),f=[s[x]]):f.push(s[x]))}if(f&&h.push(f),r>1)for(let x=0;x<h.length;x++)h[x].length<=r||(A1(h[x],r,1,h[x].length-1,If),h[x]=h[x].slice(0,r));return h}function If(s,r){return r.area-s.area}function t_(s,r,a){const h=a.patternDependencies;let f=!1;for(const _ of r){const x=_.paint.get(`${s}-pattern`);x.isConstant()||(f=!0);const w=x.constantOr(null);w&&(f=!0,h[w]=!0)}return f}function Lv(s,r,a,h,f){const _=f.patternDependencies;for(const x of r){const w=x.paint.get(`${s}-pattern`).value;if("constant"!==w.kind){let D=w.evaluate({zoom:h},a,{},f.availableImages);D=D&&D.name?D.name:D,_[D]=!0,a.patterns[x.id]=D}}return a}class n_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xe,this.indexArray=new vt,this.indexArray2=new Si,this.programConfigurations=new zl(r.layers,r.zoom),this.segments=new $i,this.segments2=new $i,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=r.projection}populate(r,a,h,f){this.hasPattern=t_("fill",this.layers,a);const _=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:w,id:D,index:S,sourceLayerIndex:P}of r){const R=this.layers[0]._featureFilter.needGeometry,O=Cu(w,R);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),O,h))continue;const N=_?_.evaluate(O,{},h,a.availableImages):void 0,B={id:D,properties:w.properties,type:w.type,sourceLayerIndex:P,index:S,geometry:R?O.geometry:Bl(w,h,f),patterns:{},sortKey:N};x.push(B)}_&&x.sort((w,D)=>w.sortKey-D.sortKey);for(const w of x){const{geometry:D,index:S,sourceLayerIndex:P}=w;if(this.hasPattern){const R=Lv("fill",this.layers,w,this.zoom,a);this.patternFeatures.push(R)}else this.addFeature(w,D,S,h,{},a.availableImages);a.featureIndex.insert(r[S].feature,D,S,P,this.index)}}update(r,a,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,h,f)}addFeatures(r,a,h,f,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,a,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Av),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,a,h,f,_,x=[]){for(const w of $a(a,500)){let D=0;for(const B of w)D+=B.length;const S=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),P=S.vertexLength,R=[],O=[];for(const B of w){if(0===B.length)continue;B!==w[0]&&O.push(R.length/2);const $=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),Z=$.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(Z+B.length-1,Z),R.push(B[0].x),R.push(B[0].y);for(let te=1;te<B.length;te++)this.layoutVertexArray.emplaceBack(B[te].x,B[te].y),this.indexArray2.emplaceBack(Z+te-1,Z+te),R.push(B[te].x),R.push(B[te].y);$.vertexLength+=B.length,$.primitiveLength+=B.length}const N=e_(R,O);for(let B=0;B<N.length;B+=3)this.indexArray.emplaceBack(P+N[B],P+N[B+1],P+N[B+2]);S.vertexLength+=D,S.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,x,f)}}pt(n_,"FillBucket",{omit:["layers","patternFeatures"]});const FD=new re({"fill-sort-key":new Y(ze.layout_fill["fill-sort-key"])});var zD={paint:new re({"fill-antialias":new U(ze.paint_fill["fill-antialias"]),"fill-opacity":new Y(ze.paint_fill["fill-opacity"]),"fill-color":new Y(ze.paint_fill["fill-color"]),"fill-outline-color":new Y(ze.paint_fill["fill-outline-color"]),"fill-translate":new U(ze.paint_fill["fill-translate"]),"fill-translate-anchor":new U(ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new Y(ze.paint_fill["fill-pattern"])}),layout:FD};const ND=xe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Fv=xe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),k1=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:R1}=ND;var rm={},O1=Zs,om=Yo;function Yo(s,r,a,h,f){this.properties={},this.extent=a,this.type=0,this._pbf=s,this._geometry=-1,this._keys=h,this._values=f,s.readFields(Af,this,r)}function Af(s,r,a){1==s?r.id=a.readVarint():2==s?function(h,f){for(var _=h.readVarint()+h.pos;h.pos<_;){var x=f._keys[h.readVarint()],w=f._values[h.readVarint()];f.properties[x]=w}}(a,r):3==s?r.type=a.readVarint():4==s&&(r._geometry=a.pos)}function zv(s){for(var r,a,h=0,f=0,_=s.length,x=_-1;f<_;x=f++)h+=((a=s[x]).x-(r=s[f]).x)*(r.y+a.y);return h}Yo.types=["Unknown","Point","LineString","Polygon"],Yo.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,a=s.readVarint()+s.pos,h=1,f=0,_=0,x=0,w=[];s.pos<a;){if(f<=0){var D=s.readVarint();h=7&D,f=D>>3}if(f--,1===h||2===h)_+=s.readSVarint(),x+=s.readSVarint(),1===h&&(r&&w.push(r),r=[]),r.push(new O1(_,x));else{if(7!==h)throw new Error("unknown command "+h);r&&r.push(r[0].clone())}}return r&&w.push(r),w},Yo.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,a=1,h=0,f=0,_=0,x=1/0,w=-1/0,D=1/0,S=-1/0;s.pos<r;){if(h<=0){var P=s.readVarint();a=7&P,h=P>>3}if(h--,1===a||2===a)(f+=s.readSVarint())<x&&(x=f),f>w&&(w=f),(_+=s.readSVarint())<D&&(D=_),_>S&&(S=_);else if(7!==a)throw new Error("unknown command "+a)}return[x,D,w,S]},Yo.prototype.toGeoJSON=function(s,r,a){var h,f,_=this.extent*Math.pow(2,a),x=this.extent*s,w=this.extent*r,D=this.loadGeometry(),S=Yo.types[this.type];function P(N){for(var B=0;B<N.length;B++){var $=N[B];N[B]=[360*($.x+x)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+w)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(h=0;h<D.length;h++)R[h]=D[h][0];P(D=R);break;case 2:for(h=0;h<D.length;h++)P(D[h]);break;case 3:for(D=function(N){var B=N.length;if(B<=1)return[N];for(var $,Z,te=[],ce=0;ce<B;ce++){var ne=zv(N[ce]);0!==ne&&(void 0===Z&&(Z=ne<0),Z===ne<0?($&&te.push($),$=[N[ce]]):$.push(N[ce]))}return $&&te.push($),te}(D),h=0;h<D.length;h++)for(f=0;f<D[h].length;f++)P(D[h][f])}1===D.length?D=D[0]:S="Multi"+S;var O={type:"Feature",geometry:{type:S,coordinates:D},properties:this.properties};return"id"in this&&(O.id=this.id),O};var Nv=om,i_=L1;function L1(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(BD,this,r),this.length=this._features.length}function BD(s,r,a){15===s?r.version=a.readVarint():1===s?r.name=a.readString():5===s?r.extent=a.readVarint():2===s?r._features.push(a.pos):3===s?r._keys.push(a.readString()):4===s&&r._values.push(function(h){for(var f=null,_=h.readVarint()+h.pos;h.pos<_;){var x=h.readVarint()>>3;f=1===x?h.readString():2===x?h.readFloat():3===x?h.readDouble():4===x?h.readVarint64():5===x?h.readVarint():6===x?h.readSVarint():7===x?h.readBoolean():null}return f}(a))}L1.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new Nv(this._pbf,r,this.extent,this._keys,this._values)};var VD=i_;function r_(s,r,a){if(3===s){var h=new VD(a,a.readVarint()+a.pos);h.length&&(r[h.name]=h)}}var Pf=rm.VectorTile=function(s,r){this.layers=s.readFields(r_,{},r)},o_=rm.VectorTileFeature=om;function s_(s,r,a,h){const f=[],_=0===h?(x,w,D,S,P,R)=>{x.push(new st(R,D+(R-w)/(S-w)*(P-D)))}:(x,w,D,S,P,R)=>{x.push(new st(w+(R-D)/(P-D)*(S-w),R))};for(const x of s){const w=[];for(const D of x){if(D.length<=2)continue;const S=[];for(let O=0;O<D.length-1;O++){const N=D[O].x,B=D[O].y,$=D[O+1].x,Z=D[O+1].y,te=0===h?N:B,ce=0===h?$:Z;te<r?ce>r&&_(S,N,B,$,Z,r):te>a?ce<a&&_(S,N,B,$,Z,a):S.push(D[O]),ce<r&&te>=r&&_(S,N,B,$,Z,r),ce>a&&te<=a&&_(S,N,B,$,Z,a)}let P=D[D.length-1];const R=0===h?P.x:P.y;R>=r&&R<=a&&S.push(P),S.length&&(P=S[S.length-1],S[0].x===P.x&&S[0].y===P.y||S.push(S[0]),w.push(S))}w.length&&f.push(w)}return f}rm.VectorTileLayer=i_;const Bv=o_.types,F1=Math.pow(2,13);function kf(s,r,a,h,f,_,x,w){s.emplaceBack((r<<1)+x,(a<<1)+_,(Math.floor(h*F1)<<1)+f,Math.round(w))}function Rf(s,r,a){s.emplaceBack(r.x,r.y,r.z,16384*a[0],16384*a[1],16384*a[2])}class Vv{constructor(){this.acc=new st(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new st(r.x,r.y),this.max=new st(r.x,r.y))}append(r,a){this.currentPolyCount.edges++,this.acc._add(r);const h=this.min,f=this.max;r.x<h.x?h.x=r.x:r.x>f.x&&(f.x=r.x),r.y<h.y?h.y=r.y:r.y>f.y&&(f.y=r.y),((0===r.x||r.x===St)&&r.x===a.x)!=((0===r.y||r.y===St)&&r.y===a.y)&&this.processBorderOverlap(r,a),a.x<0!=r.x<0&&this.addBorderIntersection(0,mn(a.y,r.y,(0-a.x)/(r.x-a.x))),a.x>St!=r.x>St&&this.addBorderIntersection(1,mn(a.y,r.y,(St-a.x)/(r.x-a.x))),a.y<0!=r.y<0&&this.addBorderIntersection(2,mn(a.x,r.x,(0-a.y)/(r.y-a.y))),a.y>St!=r.y>St&&this.addBorderIntersection(3,mn(a.x,r.x,(St-a.y)/(r.y-a.y)))}addBorderIntersection(r,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[r];a<h[0]&&(h[0]=a),a>h[1]&&(h[1]=a)}processBorderOverlap(r,a){if(r.x===a.x){if(r.y===a.y)return;const h=0===r.x?0:1;this.addBorderIntersection(h,a.y),this.addBorderIntersection(h,r.y)}else{const h=0===r.y?2:3;this.addBorderIntersection(h,a.x),this.addBorderIntersection(h,r.x)}}centroid(){const r=this.polyCount.reduce((a,h)=>a+h.edges,0);return 0!==r?this.acc.div(r)._round():new st(0,0)}span(){return new st(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,a)=>r+ +(a[0]!==Number.MAX_VALUE),0)}}class qh{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new je,this.centroidVertexArray=new la,this.indexArray=new vt,this.programConfigurations=new zl(r.layers,r.zoom),this.segments=new $i,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=r.enableTerrain}populate(r,a,h,f){this.features=[],this.hasPattern=t_("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(_){const x=Math.exp(Math.PI*(1-_.y/(1<<_.z)*2));return 80150034*x/(x*x+1)/St/(1<<_.z)}(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:_,id:x,index:w,sourceLayerIndex:D}of r){const S=this.layers[0]._featureFilter.needGeometry,P=Cu(_,S);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),P,h))continue;const R={id:x,sourceLayerIndex:D,index:w,geometry:S?P.geometry:Bl(_,h,f),properties:_.properties,type:_.type,patterns:{}},O=this.layoutVertexArray.length;this.hasPattern?this.features.push(Lv("fill-extrusion",this.layers,R,this.zoom,a)):this.addFeature(R,R.geometry,w,h,{},a.availableImages,f),a.featureIndex.insert(_,R.geometry,w,D,this.index,O)}this.sortBorders()}addFeatures(r,a,h,f,_){for(const x of this.features){const{geometry:w}=x;this.addFeature(x,w,x.index,a,h,f,_)}this.sortBorders()}update(r,a,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,R1),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,k1.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Fv.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,h,f,_,x,w){const D=[new st(0,0),new st(St,St)],S=w.projection,P="globe"===S.name,R=this.enableTerrain&&!P?new Vv:null,O="Polygon"===Bv[r.type];P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ye);const N=$a(a,500);for(let te=N.length-1;te>=0;te--){const ce=N[te];(0===ce.length||(B=ce[0]).every(ne=>ne.x<=0)||B.every(ne=>ne.x>=St)||B.every(ne=>ne.y<=0)||B.every(ne=>ne.y>=St))&&N.splice(te,1)}var B;let $;if(P)$=Zh(N,D,f);else{$=[];for(const te of N)$.push({polygon:te,bounds:D})}const Z=O?this.edgeRadius:0;for(const{polygon:te,bounds:ce}of $){let ne=0,ae=0;for(const he of te)O&&!he[0].equals(he[he.length-1])&&he.push(he[0]),ae+=O?he.length-1:he.length;const pe=this.segments.prepareSegment((O?5:4)*ae,this.layoutVertexArray,this.indexArray);if(O){const he=[],Me=[];ne=pe.vertexLength;for(const Oe of te){let Ge,Ae;Oe.length&&Oe!==te[0]&&Me.push(he.length/2),Ge=Oe[1].sub(Oe[0])._perp()._unit();for(let Be=1;Be<Oe.length;Be++){const Ve=Oe[Be],He=Oe[Be===Oe.length-1?1:Be+1];let{x:Ke,y:Le}=Ve;if(Z){Ae=He.sub(Ve)._perp()._unit();const rt=Ge.add(Ae)._unit(),dt=Z*Math.min(4,1/(Ge.x*rt.x+Ge.y*rt.y));Ke+=dt*rt.x,Le+=dt*rt.y,Ge=Ae}kf(this.layoutVertexArray,Ke,Le,0,0,1,1,0),pe.vertexLength++,he.push(Ve.x,Ve.y),P&&Rf(this.layoutVertexExtArray,S.projectTilePoint(Ke,Le,f),S.upVector(f,Ke,Le))}}const Ee=e_(he,Me);for(let Oe=0;Oe<Ee.length;Oe+=3)this.indexArray.emplaceBack(ne+Ee[Oe],ne+Ee[Oe+2],ne+Ee[Oe+1]),pe.primitiveLength++}for(const he of te){R&&he.length&&R.startRing(he[0]);let Me,Ee,Oe,Ge=he.length>4&&Qi(he[he.length-2],he[0],he[1]),Ae=Z?z1(he[he.length-2],he[0],he[1],Z):0;Ee=he[1].sub(he[0])._perp()._unit();let Be=!0;for(let Ve=1,He=0;Ve<he.length;Ve++){let Ke=he[Ve-1],Le=he[Ve];const rt=he[Ve===he.length-1?1:Ve+1];if(R&&O&&R.currentPolyCount.top++,jv(Le,Ke,ce)){Z&&(Ee=rt.sub(Le)._perp()._unit(),Be=!Be);continue}R&&R.append(Le,Ke);const dt=Le.sub(Ke)._perp(),ot=dt.x/(Math.abs(dt.x)+Math.abs(dt.y)),Bt=dt.y>0?1:0,et=Ke.dist(Le);if(He+et>32768&&(He=0),Z){Oe=rt.sub(Le)._perp()._unit();let jt=sm(Ke,Le,rt,Of(Ee,Oe),Z);isNaN(jt)&&(jt=0);const It=Le.sub(Ke)._unit();Ke=Ke.add(It.mult(Ae))._round(),Le=Le.add(It.mult(-jt))._round(),Ae=jt,Ee=Oe}const Et=pe.vertexLength,Vt=he.length>4&&Qi(Ke,Le,rt);let Cn=Uv(He,Ge,Be);if(kf(this.layoutVertexArray,Ke.x,Ke.y,ot,Bt,0,0,Cn),kf(this.layoutVertexArray,Ke.x,Ke.y,ot,Bt,0,1,Cn),He+=et,Cn=Uv(He,Vt,!Be),Ge=Vt,kf(this.layoutVertexArray,Le.x,Le.y,ot,Bt,0,0,Cn),kf(this.layoutVertexArray,Le.x,Le.y,ot,Bt,0,1,Cn),pe.vertexLength+=4,this.indexArray.emplaceBack(Et+0,Et+1,Et+2),this.indexArray.emplaceBack(Et+1,Et+3,Et+2),pe.primitiveLength+=2,Z){const jt=ne+(1===Ve?he.length-2:Ve-2),It=1===Ve?ne:jt+1;if(this.indexArray.emplaceBack(Et+1,jt,Et+3),this.indexArray.emplaceBack(jt,It,Et+3),pe.primitiveLength+=2,void 0===Me&&(Me=Et),!jv(rt,he[Ve],ce)){const ti=Ve===he.length-1?Me:pe.vertexLength;this.indexArray.emplaceBack(Et+2,Et+3,ti),this.indexArray.emplaceBack(Et+3,ti+1,ti),this.indexArray.emplaceBack(Et+3,It,ti+1),pe.primitiveLength+=3}Be=!Be}if(P){const jt=this.layoutVertexExtArray,It=S.projectTilePoint(Ke.x,Ke.y,f),ti=S.projectTilePoint(Le.x,Le.y,f),$t=S.upVector(f,Ke.x,Ke.y),Wt=S.upVector(f,Le.x,Le.y);Rf(jt,It,$t),Rf(jt,It,$t),Rf(jt,ti,Wt),Rf(jt,ti,Wt)}}O&&(ne+=he.length-1)}}if(R&&R.polyCount.length>0){if(R.borders){R.vertexArrayOffset=this.centroidVertexArray.length;const te=R.borders,ce=this.featuresOnBorder.push(R)-1;for(let ne=0;ne<4;ne++)te[ne][0]!==Number.MAX_VALUE&&this.borders[ne].push(ce)}this.encodeCentroid(R.borders?void 0:R.centroid(),R)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,x,f)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((a,h)=>this.featuresOnBorder[a].borders[r][0]-this.featuresOnBorder[h].borders[r][0])}encodeCentroid(r,a,h=!0){let f,_;if(r)if(0!==r.y){const w=a.span()._mult(this.tileToMeter);f=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(w.x/10)),_=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else f=Math.ceil(7*(r.x+450)),_=0;else f=0,_=+h;let x=h?this.centroidVertexArray.length:a.vertexArrayOffset;for(const w of a.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let D=0;D<w.top;D++)this.centroidVertexArray.emplace(x++,f,_);for(let D=0;D<2*w.edges;D++)this.centroidVertexArray.emplace(x++,0,_),this.centroidVertexArray.emplace(x++,f,_)}}}function Of(s,r){const a=s.add(r)._unit();return s.x*a.x+s.y*a.y}function z1(s,r,a,h){const f=r.sub(s)._perp()._unit(),_=a.sub(r)._perp()._unit();return sm(s,r,a,Of(f,_),h)}function sm(s,r,a,h,f){const _=Math.sqrt(1-h*h);return Math.min(s.dist(r)/3,r.dist(a)/3,f*_/h)}function jv(s,r,a){return s.x<a[0].x&&r.x<a[0].x||s.x>a[1].x&&r.x>a[1].x||s.y<a[0].y&&r.y<a[0].y||s.y>a[1].y&&r.y>a[1].y}function Qi(s,r,a){if(s.x<0||s.x>=St||r.x<0||r.x>=St||a.x<0||a.x>=St)return!1;const h=a.sub(r),f=h.perp(),_=s.sub(r);return(h.x*_.x+h.y*_.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(_.x*_.x+_.y*_.y))>-.866&&f.x*_.x+f.y*_.y<0}function Uv(s,r,a){const h=r?2|s:-3&s;return a?1|h:-2&h}function $v(){const s=Math.PI/32,r=Math.tan(s),a=_f;return a*Math.sqrt(1+2*r*r)-a}function Zh(s,r,a){const h=1<<a.z,f=Xo(a.x/h),_=Xo((a.x+1)/h),x=Or(a.y/h),w=Or((a.y+1)/h);return function(D,S,P,R,O=0,N){const B=[];if(!D.length||!P||!R)return B;const $=(he,Me)=>{for(const Ee of he)B.push({polygon:Ee,bounds:Me})},Z=Math.ceil(Math.log2(P)),te=Math.ceil(Math.log2(R)),ce=Z-te,ne=[];for(let he=0;he<Math.abs(ce);he++)ne.push(ce>0?0:1);for(let he=0;he<Math.min(Z,te);he++)ne.push(0),ne.push(1);let ae=D;if(ae=s_(ae,S[0].y-O,S[1].y+O,1),ae=s_(ae,S[0].x-O,S[1].x+O,0),!ae.length)return B;const pe=[];for(ne.length?pe.push({polygons:ae,bounds:S,depth:0}):$(ae,S);pe.length;){const he=pe.pop(),Me=he.depth,Ee=ne[Me],Oe=he.bounds[0],Ge=he.bounds[1],Ae=0===Ee?Oe.x:Oe.y,Be=0===Ee?Ge.x:Ge.y,Ve=N?N(Ee,Ae,Be):.5*(Ae+Be),He=s_(he.polygons,Ae-O,Ve+O,Ee),Ke=s_(he.polygons,Ve-O,Be+O,Ee);if(He.length){const Le=[Oe,new st(0===Ee?Ve:Ge.x,1===Ee?Ve:Ge.y)];ne.length>Me+1?pe.push({polygons:He,bounds:Le,depth:Me+1}):$(He,Le)}if(Ke.length){const Le=[new st(0===Ee?Ve:Oe.x,1===Ee?Ve:Oe.y),Ge];ne.length>Me+1?pe.push({polygons:Ke,bounds:Le,depth:Me+1}):$(Ke,Le)}}return B}(s,r,Math.ceil((_-f)/11.25),Math.ceil((x-w)/11.25),1,(D,S,P)=>{if(0===D)return.5*(S+P);{const R=Or((a.y+S/St)/h);return(Zo(.5*(Or((a.y+P/St)/h)+R))*h-a.y)*St}})}pt(qh,"FillExtrusionBucket",{omit:["layers","features"]}),pt(Vv,"PartMetadata");const Hv=new re({"fill-extrusion-edge-radius":new U(ze["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var N1={paint:new re({"fill-extrusion-opacity":new U(ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Y(ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new U(ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new U(ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Y(ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Y(ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Y(ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new U(ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new U(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new U(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new U(ze["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Hv};function Gv(s,r,a){var h=2*Math.PI*6378137/256/Math.pow(2,a);return[s*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}class am{constructor(r,a,h){this.z=r,this.x=a,this.y=h,this.key=lm(0,r,r,a,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,a){const h=(x=this.y,w=this.z,D=Gv(256*(_=this.x),256*(x=Math.pow(2,w)-x-1),w),S=Gv(256*(_+1),256*(x+1),w),D[0]+","+D[1]+","+S[0]+","+S[1]),f=function(_,x,w){let D,S="";for(let P=_;P>0;P--)D=1<<P-1,S+=(x&D?1:0)+(w&D?2:0);return S}(this.z,this.x,this.y);var _,x,w,D,S;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Wv{constructor(r,a){this.wrap=r,this.canonical=a,this.key=lm(r,a.z,a.z,a.x,a.y)}}class Kr{constructor(r,a,h,f,_){this.overscaledZ=r,this.wrap=a,this.canonical=new am(h,+f,+_),this.key=0===a&&r===h?this.canonical.key:lm(a,r,h,f,_)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const a=this.canonical.z-r;return r>this.canonical.z?new Kr(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Kr(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a=!0){if(this.overscaledZ===r&&a)return this.key;if(r>this.canonical.z)return lm(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-r;return lm(this.wrap*+a,r,r,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new Kr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,h=2*this.canonical.x,f=2*this.canonical.y;return[new Kr(a,this.wrap,a,h,f),new Kr(a,this.wrap,a,h+1,f),new Kr(a,this.wrap,a,h,f+1),new Kr(a,this.wrap,a,h+1,f+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Kr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Kr(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Wv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function lm(s,r,a,h,f){const _=1<<Math.min(a,22);let x=_*(f%_)+h%_;return s&&a<22&&(x+=_*_*((s<0?-2*s-1:2*s)%(1<<2*(22-a)))),16*(32*x+a)+(r-a)}pt(am,"CanonicalTileID"),pt(Kr,"OverscaledTileID",{omit:["projMatrix"]});class Lf extends st{constructor(r,a,h){super(r,a),this.z=h}}function Vl(s,r){return s.x*r.x+s.y*r.y}function Ff(s,r){if(1===s.length){let a=0;const h=r[a++];let f;for(;!f||h.equals(f);)if(f=r[a++],!f)return 1/0;for(;a<r.length;a++){const _=r[a],x=s[0],w=f.sub(h),D=_.sub(h),S=x.sub(h),P=Vl(w,w),R=Vl(w,D),O=Vl(D,D),N=Vl(S,w),B=Vl(S,D),$=P*O-R*R,Z=(O*N-R*B)/$,te=(P*B-R*N)/$,ce=h.z*(1-Z-te)+f.z*Z+_.z*te;if(isFinite(ce))return ce}return 1/0}{let a=1/0;for(const h of r)a=Math.min(a,h.z);return a}}function a_(s,r,a,h,f,_,x,w){const D=x*f.getElevationAt(s,r,!0,!0),S=0!==_[0],P=S?0===_[1]?x*(_[0]/7-450):x*function(R,O,N){const B=Math.floor(O[0]/8),$=Math.floor(O[1]/8),Z=10*(O[0]-8*B),te=10*(O[1]-8*$),ce=R.getElevationAt(B,$,!0,!0),ne=R.getMeterToDEM(N),ae=Math.floor(.5*(Z*ne-1)),pe=Math.floor(.5*(te*ne-1)),he=R.tileCoordToPixel(B,$),Me=2*ae+1,Ee=2*pe+1,Oe=(dt=Me,ot=Ee,[(Ke=R).getElevationAtPixel(Le=he.x-ae,rt=he.y-pe,!0),Ke.getElevationAtPixel(Le+ot,rt,!0),Ke.getElevationAtPixel(Le,rt+ot,!0),Ke.getElevationAtPixel(Le+dt,rt+ot,!0)]),Ge=Math.abs(Oe[0]-Oe[1]),Ae=Math.abs(Oe[2]-Oe[3]),Be=Math.abs(Oe[0]-Oe[2])+Math.abs(Oe[1]-Oe[3]),Ve=Math.min(.25,.5*ne*(Ge+Ae)/Me),He=Math.min(.25,.5*ne*Be/Ee);var Ke,Le,rt,dt,ot;return ce+Math.max(Ve*Z,He*te)}(f,_,w):D;return{base:D+(0===a)?-1:a,top:S?Math.max(P+h,D+a+2):D+h}}const qv=xe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Zv}=qv,B1=xe([{name:"a_packed",components:4,type:"Float32"}]),{members:V1}=B1,Xv=o_.types,Yv=Math.cos(Math.PI/180*37.5);class Xh{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Pe,this.layoutVertexArray2=new We,this.indexArray=new vt,this.programConfigurations=new zl(r.layers,r.zoom),this.segments=new $i,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,h,f){this.hasPattern=t_("line",this.layers,a);const _=this.layers[0].layout.get("line-sort-key"),x=[];for(const{feature:P,id:R,index:O,sourceLayerIndex:N}of r){const B=this.layers[0]._featureFilter.needGeometry,$=Cu(P,B);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),$,h))continue;const Z=_?_.evaluate($,{},h):void 0,te={id:R,properties:P.properties,type:P.type,sourceLayerIndex:N,index:O,geometry:B?$.geometry:Bl(P,h,f),patterns:{},sortKey:Z};x.push(te)}_&&x.sort((P,R)=>P.sortKey-R.sortKey);const{lineAtlas:w,featureIndex:D}=a,S=this.addConstantDashes(w);for(const P of x){const{geometry:R,index:O,sourceLayerIndex:N}=P;if(S&&this.addFeatureDashes(P,w),this.hasPattern){const B=Lv("line",this.layers,P,this.zoom,a);this.patternFeatures.push(B)}else this.addFeature(P,R,O,h,w.positions,a.availableImages);D.insert(r[O].feature,R,O,N,this.index)}}addConstantDashes(r){let a=!1;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==_.kind)a=!0;else{const x=_.value,w=f.value;if(!w)continue;r.addDash(w,x)}}return a}addFeatureDashes(r,a){const h=this.zoom;for(const f of this.layers){const _=f.paint.get("line-dasharray").value,x=f.layout.get("line-cap").value;if("constant"===_.kind&&"constant"===x.kind)continue;let w,D;if("constant"===_.kind){if(w=_.value,!w)continue}else w=_.evaluate({zoom:h},r);D="constant"===x.kind?x.value:x.evaluate({zoom:h},r),a.addDash(w,D),r.patterns[f.id]=a.getKey(w,D)}}update(r,a,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,h,f)}addFeatures(r,a,h,f,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,a,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,V1)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Zv),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,a,h,f,_,x){const w=this.layers[0].layout,D=w.get("line-join").evaluate(r,{}),S=w.get("line-cap").evaluate(r,{}),P=w.get("line-miter-limit"),R=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const O of a)this.addLine(O,r,D,S,P,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,x,f)}addLine(r,a,h,f,_,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<r.length-1;te++)this.totalDistance+=r[te].dist(r[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===Xv[a.type];let D=r.length;for(;D>=2&&r[D-1].equals(r[D-2]);)D--;let S=0;for(;S<D-1&&r[S].equals(r[S+1]);)S++;if(D<(w?3:2))return;"bevel"===h&&(_=1.05);const P=this.overscaling<=16?15*St/(512*this.overscaling):0,R=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let O,N,B,$,Z;this.e1=this.e2=-1,w&&(O=r[D-2],Z=r[S].sub(O)._unit()._perp());for(let te=S;te<D;te++){if(B=te===D-1?w?r[S+1]:void 0:r[te+1],B&&r[te].equals(B))continue;Z&&($=Z),O&&(N=O),O=r[te],Z=B?B.sub(O)._unit()._perp():$,$=$||Z;let ce=$.add(Z);0===ce.x&&0===ce.y||ce._unit();const ne=$.x*Z.x+$.y*Z.y,ae=ce.x*Z.x+ce.y*Z.y,pe=0!==ae?1/ae:1/0,he=2*Math.sqrt(2-2*ae),Me=ae<Yv&&N&&B,Ee=$.x*Z.y-$.y*Z.x>0;if(Me&&te>S){const Ae=O.dist(N);if(Ae>2*P){const Be=O.sub(O.sub(N)._mult(P/Ae)._round());this.updateDistance(N,Be),this.addCurrentVertex(Be,$,0,0,R),N=Be}}const Oe=N&&B;let Ge=Oe?h:w?"butt":f;if(Oe&&"round"===Ge&&(pe<x?Ge="miter":pe<=2&&(Ge="fakeround")),"miter"===Ge&&pe>_&&(Ge="bevel"),"bevel"===Ge&&(pe>2&&(Ge="flipbevel"),pe<_&&(Ge="miter")),N&&this.updateDistance(N,O),"miter"===Ge)ce._mult(pe),this.addCurrentVertex(O,ce,0,0,R);else if("flipbevel"===Ge){if(pe>100)ce=Z.mult(-1);else{const Ae=pe*$.add(Z).mag()/$.sub(Z).mag();ce._perp()._mult(Ae*(Ee?-1:1))}this.addCurrentVertex(O,ce,0,0,R),this.addCurrentVertex(O,ce.mult(-1),0,0,R)}else if("bevel"===Ge||"fakeround"===Ge){const Ae=-Math.sqrt(pe*pe-1),Be=Ee?Ae:0,Ve=Ee?0:Ae;if(N&&this.addCurrentVertex(O,$,Be,Ve,R),"fakeround"===Ge){const He=Math.round(180*he/Math.PI/20);for(let Ke=1;Ke<He;Ke++){let Le=Ke/He;if(.5!==Le){const dt=Le-.5;Le+=Le*dt*(Le-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*dt*dt+(.848013+ne*(.215638*ne-1.06021)))}const rt=Z.sub($)._mult(Le)._add($)._unit()._mult(Ee?-1:1);this.addHalfVertex(O,rt.x,rt.y,!1,Ee,0,R)}}B&&this.addCurrentVertex(O,Z,-Be,-Ve,R)}else if("butt"===Ge)this.addCurrentVertex(O,ce,0,0,R);else if("square"===Ge){const Ae=N?1:-1;N||this.addCurrentVertex(O,ce,Ae,Ae,R),this.addCurrentVertex(O,ce,0,0,R),N&&this.addCurrentVertex(O,ce,Ae,Ae,R)}else"round"===Ge&&(N&&(this.addCurrentVertex(O,$,0,0,R),this.addCurrentVertex(O,$,1,1,R,!0)),B&&(this.addCurrentVertex(O,Z,-1,-1,R,!0),this.addCurrentVertex(O,Z,0,0,R)));if(Me&&te<D-1){const Ae=O.dist(B);if(Ae>2*P){const Be=O.add(B.sub(O)._mult(P/Ae)._round());this.updateDistance(O,Be),this.addCurrentVertex(Be,Z,0,0,R),O=Be}}}}addCurrentVertex(r,a,h,f,_,x=!1){const w=a.y*f-a.x,D=-a.y-a.x*f;this.addHalfVertex(r,a.x+a.y*h,a.y-a.x*h,x,!1,h,_),this.addHalfVertex(r,w,D,x,!0,-f,_)}addHalfVertex({x:r,y:a},h,f,_,x,w,D){this.layoutVertexArray.emplaceBack((r<<1)+(_?1:0),(a<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*f)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),D.primitiveLength++),x?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,a){this.distance+=r.dist(a),this.updateScaledDistance()}}pt(Xh,"LineBucket",{omit:["layers","patternFeatures"]});const jD=new re({"line-cap":new Y(ze.layout_line["line-cap"]),"line-join":new Y(ze.layout_line["line-join"]),"line-miter-limit":new U(ze.layout_line["line-miter-limit"]),"line-round-limit":new U(ze.layout_line["line-round-limit"]),"line-sort-key":new Y(ze.layout_line["line-sort-key"])});var cm={paint:new re({"line-opacity":new Y(ze.paint_line["line-opacity"]),"line-color":new Y(ze.paint_line["line-color"]),"line-translate":new U(ze.paint_line["line-translate"]),"line-translate-anchor":new U(ze.paint_line["line-translate-anchor"]),"line-width":new Y(ze.paint_line["line-width"]),"line-gap-width":new Y(ze.paint_line["line-gap-width"]),"line-offset":new Y(ze.paint_line["line-offset"]),"line-blur":new Y(ze.paint_line["line-blur"]),"line-dasharray":new Y(ze.paint_line["line-dasharray"]),"line-pattern":new Y(ze.paint_line["line-pattern"]),"line-gradient":new ie(ze.paint_line["line-gradient"]),"line-trim-offset":new U(ze.paint_line["line-trim-offset"])}),layout:jD};const Kv=new class extends Y{possiblyEvaluate(s,r){return r=new k(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(s,r)}evaluate(s,r,a,h){return r=ki({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(s,r,a,h)}}(cm.paint.properties["line-width"].specification);function um(s,r){return r>0?r+2*s:s}Kv.useIntegerZoom=!0;const Jv=xe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Qv=xe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Su=xe([{name:"a_projected_pos",components:4,type:"Float32"}],4);xe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const j1=xe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),l_=xe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zf=xe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),U1=xe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xe([{name:"triangle",components:3,type:"Uint16"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),xe([{type:"Float32",name:"offsetX"}]),xe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var er=24;const Ko=128;function Vs(s,r){const{expression:a}=r;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new k(s+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:h,interpolationType:f}=a;let _=0;for(;_<h.length&&h[_]<=s;)_++;_=Math.max(0,_-1);let x=_;for(;x<h.length&&h[x]<s+1;)x++;x=Math.min(h.length-1,x);const w=h[_],D=h[x];return"composite"===a.kind?{kind:"composite",minZoom:w,maxZoom:D,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:D,minSize:a.evaluate(new k(w)),maxSize:a.evaluate(new k(D)),interpolationType:f}}}function Nf(s,{uSize:r,uSizeT:a},{lowerSize:h,upperSize:f}){return"source"===s.kind?h/Ko:"composite"===s.kind?mn(h/Ko,f/Ko,a):r}function Tc(s,r){let a=0,h=0;if("constant"===s.kind)h=s.layoutSize;else if("source"!==s.kind){const{interpolationType:f,minZoom:_,maxZoom:x}=s,w=f?hn(ls.interpolationFactor(f,r,_,x),0,1):0;"camera"===s.kind?h=mn(s.minSize,s.maxSize,w):a=w}return{uSizeT:a,uSize:h}}var $1=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ko,evaluateSizeForFeature:Nf,evaluateSizeForZoom:Tc,getSizeData:Vs});function H1(s,r,a){return s.sections.forEach(h=>{h.text=function(f,_,x){const w=_.layout.get("text-transform").evaluate(x,{});return"uppercase"===w?f=f.toLocaleUpperCase():"lowercase"===w&&(f=f.toLocaleLowerCase()),I.applyArabicShaping&&(f=I.applyArabicShaping(f)),f}(h.text,r,a)}),s}const Yh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Kh(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function G1(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var e0=ei,t0=function(s,r,a,h,f){var _,x,w=8*f-h-1,D=(1<<w)-1,S=D>>1,P=-7,R=a?f-1:0,O=a?-1:1,N=s[r+R];for(R+=O,_=N&(1<<-P)-1,N>>=-P,P+=w;P>0;_=256*_+s[r+R],R+=O,P-=8);for(x=_&(1<<-P)-1,_>>=-P,P+=h;P>0;x=256*x+s[r+R],R+=O,P-=8);if(0===_)_=1-S;else{if(_===D)return x?NaN:1/0*(N?-1:1);x+=Math.pow(2,h),_-=S}return(N?-1:1)*x*Math.pow(2,_-h)},hm=function(s,r,a,h,f,_){var x,w,D,S=8*_-f-1,P=(1<<S)-1,R=P>>1,O=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,N=h?0:_-1,B=h?1:-1,$=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(w=isNaN(r)?1:0,x=P):(x=Math.floor(Math.log(r)/Math.LN2),r*(D=Math.pow(2,-x))<1&&(x--,D*=2),(r+=x+R>=1?O/D:O*Math.pow(2,1-R))*D>=2&&(x++,D/=2),x+R>=P?(w=0,x=P):x+R>=1?(w=(r*D-1)*Math.pow(2,f),x+=R):(w=r*Math.pow(2,R-1)*Math.pow(2,f),x=0));f>=8;s[a+N]=255&w,N+=B,w/=256,f-=8);for(x=x<<f|w,S+=f;S>0;s[a+N]=255&x,N+=B,x/=256,S-=8);s[a+N-B]|=128*$};function ei(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}ei.Varint=0,ei.Fixed64=1,ei.Bytes=2,ei.Fixed32=5;var dm=4294967296,n0=1/dm,c_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Sc(s){return s.type===ei.Bytes?s.readVarint()+s.pos:s.pos+1}function Qh(s,r,a){var h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(h);for(var f=a.pos-1;f>=s;f--)a.buf[f+h]=a.buf[f]}function W1(s,r){for(var a=0;a<s.length;a++)r.writeVarint(s[a])}function ed(s,r){for(var a=0;a<s.length;a++)r.writeSVarint(s[a])}function Ao(s,r){for(var a=0;a<s.length;a++)r.writeFloat(s[a])}function q1(s,r){for(var a=0;a<s.length;a++)r.writeDouble(s[a])}function u_(s,r){for(var a=0;a<s.length;a++)r.writeBoolean(s[a])}function jl(s,r){for(var a=0;a<s.length;a++)r.writeFixed32(s[a])}function Z1(s,r){for(var a=0;a<s.length;a++)r.writeSFixed32(s[a])}function X1(s,r){for(var a=0;a<s.length;a++)r.writeFixed64(s[a])}function Bf(s,r){for(var a=0;a<s.length;a++)r.writeSFixed64(s[a])}function fm(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function Mc(s,r,a){s[a]=r,s[a+1]=r>>>8,s[a+2]=r>>>16,s[a+3]=r>>>24}function pm(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}ei.prototype={destroy:function(){this.buf=null},readFields:function(s,r,a){for(a=a||this.length;this.pos<a;){var h=this.readVarint(),f=h>>3,_=this.pos;this.type=7&h,s(f,r,this),this.pos===_&&this.skip(h)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=fm(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=pm(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=fm(this.buf,this.pos)+fm(this.buf,this.pos+4)*dm;return this.pos+=8,s},readSFixed64:function(){var s=fm(this.buf,this.pos)+pm(this.buf,this.pos+4)*dm;return this.pos+=8,s},readFloat:function(){var s=t0(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=t0(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,a,h=this.buf;return r=127&(a=h[this.pos++]),a<128?r:(r|=(127&(a=h[this.pos++]))<<7,a<128?r:(r|=(127&(a=h[this.pos++]))<<14,a<128?r:(r|=(127&(a=h[this.pos++]))<<21,a<128?r:function(f,_,x){var w,D,S=x.buf;if(w=(112&(D=S[x.pos++]))>>4,D<128||(w|=(127&(D=S[x.pos++]))<<3,D<128)||(w|=(127&(D=S[x.pos++]))<<10,D<128)||(w|=(127&(D=S[x.pos++]))<<17,D<128)||(w|=(127&(D=S[x.pos++]))<<24,D<128)||(w|=(1&(D=S[x.pos++]))<<31,D<128))return function Jh(s,r,a){return a?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}(f,w,_);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=h[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&c_?c_.decode(this.buf.subarray(r,s)):function(a,h,f){for(var _="",x=h;x<f;){var w,D,S,P=a[x],R=null,O=P>239?4:P>223?3:P>191?2:1;if(x+O>f)break;1===O?P<128&&(R=P):2===O?128==(192&(w=a[x+1]))&&(R=(31&P)<<6|63&w)<=127&&(R=null):3===O?(D=a[x+2],128==(192&(w=a[x+1]))&&128==(192&D)&&((R=(15&P)<<12|(63&w)<<6|63&D)<=2047||R>=55296&&R<=57343)&&(R=null)):4===O&&(D=a[x+2],S=a[x+3],128==(192&(w=a[x+1]))&&128==(192&D)&&128==(192&S)&&((R=(15&P)<<18|(63&w)<<12|(63&D)<<6|63&S)<=65535||R>=1114112)&&(R=null)),null===R?(R=65533,O=1):R>65535&&(R-=65536,_+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),_+=String.fromCharCode(R),x+=O}return _}(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==ei.Bytes)return s.push(this.readVarint(r));var a=Sc(this);for(s=s||[];this.pos<a;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==ei.Bytes)return s.push(this.readSVarint());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==ei.Bytes)return s.push(this.readBoolean());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==ei.Bytes)return s.push(this.readFloat());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==ei.Bytes)return s.push(this.readDouble());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==ei.Bytes)return s.push(this.readFixed32());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==ei.Bytes)return s.push(this.readSFixed32());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==ei.Bytes)return s.push(this.readFixed64());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==ei.Bytes)return s.push(this.readSFixed64());var r=Sc(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===ei.Varint)for(;this.buf[this.pos++]>127;);else if(r===ei.Bytes)this.pos=this.readVarint()+this.pos;else if(r===ei.Fixed32)this.pos+=4;else{if(r!==ei.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Mc(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Mc(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Mc(this.buf,-1&s,this.pos),Mc(this.buf,Math.floor(s*n0),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Mc(this.buf,-1&s,this.pos),Mc(this.buf,Math.floor(s*n0),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(r,a){var h,f,_,w;if(r>=0?(h=r%4294967296|0,f=r/4294967296|0):(f=~(-r/4294967296),4294967295^(h=~(-r%4294967296))?h=h+1|0:(h=0,f=f+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),_=h,(w=a).buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,w.buf[w.pos]=127&(_>>>=7),function(_,x){var w=(7&_)<<4;x.buf[x.pos++]|=w|((_>>>=3)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_)))))}(f,a)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=function(h,f,_){for(var x,w,D=0;D<f.length;D++){if((x=f.charCodeAt(D))>55295&&x<57344){if(!w){x>56319||D+1===f.length?(h[_++]=239,h[_++]=191,h[_++]=189):w=x;continue}if(x<56320){h[_++]=239,h[_++]=191,h[_++]=189,w=x;continue}x=w-55296<<10|x-56320|65536,w=null}else w&&(h[_++]=239,h[_++]=191,h[_++]=189,w=null);x<128?h[_++]=x:(x<2048?h[_++]=x>>6|192:(x<65536?h[_++]=x>>12|224:(h[_++]=x>>18|240,h[_++]=x>>12&63|128),h[_++]=x>>6&63|128),h[_++]=63&x|128)}return _}(this.buf,s,this.pos);var a=this.pos-r;a>=128&&Qh(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(s){this.realloc(4),hm(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),hm(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=s[a]},writeRawMessage:function(s,r){this.pos++;var a=this.pos;s(r,this);var h=this.pos-a;h>=128&&Qh(a,h,this),this.pos=a-1,this.writeVarint(h),this.pos+=h},writeMessage:function(s,r,a){this.writeTag(s,ei.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,W1,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,ed,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,u_,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,Ao,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,q1,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,jl,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,Z1,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,X1,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,Bf,r)},writeBytesField:function(s,r){this.writeTag(s,ei.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,ei.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,ei.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,ei.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,ei.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,ei.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,ei.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,ei.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,ei.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,ei.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,Boolean(r))}};var mm=yo(e0);const Vf=3;function td(s,r,a){r.glyphs=[],1===s&&a.readMessage(Y1,r)}function Y1(s,r,a){if(3===s){const{id:h,bitmap:f,width:_,height:x,left:w,top:D,advance:S}=a.readMessage(K1,{});r.glyphs.push({id:h,bitmap:new Ua({width:_+2*Vf,height:x+2*Vf},f),metrics:{width:_,height:x,left:w,top:D,advance:S}})}else 4===s?r.ascender=a.readSVarint():5===s&&(r.descender=a.readSVarint())}function K1(s,r,a){1===s?r.id=a.readVarint():2===s?r.bitmap=a.readBytes():3===s?r.width=a.readVarint():4===s?r.height=a.readVarint():5===s?r.left=a.readSVarint():6===s?r.top=a.readSVarint():7===s&&(r.advance=a.readVarint())}const r0=Vf;function h_(s){let r=0,a=0;for(const x of s)r+=x.w*x.h,a=Math.max(a,x.w);s.sort((x,w)=>w.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let f=0,_=0;for(const x of s)for(let w=h.length-1;w>=0;w--){const D=h[w];if(!(x.w>D.w||x.h>D.h)){if(x.x=D.x,x.y=D.y,_=Math.max(_,x.y+x.h),f=Math.max(f,x.x+x.w),x.w===D.w&&x.h===D.h){const S=h.pop();w<h.length&&(h[w]=S)}else x.h===D.h?(D.x+=x.w,D.w-=x.w):x.w===D.w?(D.y+=x.h,D.h-=x.h):(h.push({x:D.x+x.w,y:D.y,w:D.w-x.w,h:x.h}),D.y+=x.h,D.h-=x.h);break}}return{w:f,h:_,fill:r/(f*_)||0}}const Po=1;class d_{constructor(r,{pixelRatio:a,version:h,stretchX:f,stretchY:_,content:x}){this.paddedRect=r,this.pixelRatio=a,this.stretchX=f,this.stretchY=_,this.content=x,this.version=h}get tl(){return[this.paddedRect.x+Po,this.paddedRect.y+Po]}get br(){return[this.paddedRect.x+this.paddedRect.w-Po,this.paddedRect.y+this.paddedRect.h-Po]}get displaySize(){return[(this.paddedRect.w-2*Po)/this.pixelRatio,(this.paddedRect.h-2*Po)/this.pixelRatio]}}class o0{constructor(r,a){const h={},f={};this.haveRenderCallbacks=[];const _=[];this.addImages(r,h,_),this.addImages(a,f,_);const{w:x,h:w}=h_(_),D=new Io({width:x||1,height:w||1});for(const S in r){const P=r[S],R=h[S].paddedRect;Io.copy(P.data,D,{x:0,y:0},{x:R.x+Po,y:R.y+Po},P.data)}for(const S in a){const P=a[S],R=f[S].paddedRect,O=R.x+Po,N=R.y+Po,B=P.data.width,$=P.data.height;Io.copy(P.data,D,{x:0,y:0},{x:O,y:N},P.data),Io.copy(P.data,D,{x:0,y:$-1},{x:O,y:N-1},{width:B,height:1}),Io.copy(P.data,D,{x:0,y:0},{x:O,y:N+$},{width:B,height:1}),Io.copy(P.data,D,{x:B-1,y:0},{x:O-1,y:N},{width:1,height:$}),Io.copy(P.data,D,{x:0,y:0},{x:O+B,y:N},{width:1,height:$})}this.image=D,this.iconPositions=h,this.patternPositions=f}addImages(r,a,h){for(const f in r){const _=r[f],x={x:0,y:0,w:_.data.width+2*Po,h:_.data.height+2*Po};h.push(x),a[f]=new d_(x,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>r.hasImage(h)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in r.updatedImages)this.patchUpdatedImage(this.iconPositions[h],r.getImage(h),a),this.patchUpdatedImage(this.patternPositions[h],r.getImage(h),a)}patchUpdatedImage(r,a,h){if(!r||!a||r.version===a.version)return;r.version=a.version;const[f,_]=r.tl;h.update(a.data,void 0,{x:f,y:_})}}pt(d_,"ImagePosition"),pt(o0,"ImageAtlas");const Fr={horizontal:1,vertical:2,horizontalOnly:3},Ha=-17;class jf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,a){const h=new jf;return h.scale=r||1,h.fontStack=a,h}static forImage(r){const a=new jf;return a.imageName=r,a}}class nd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a){const h=new nd;for(let f=0;f<r.sections.length;f++){const _=r.sections[f];_.image?h.addImageSection(_):h.addTextSection(_,a)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(a,h){let f="";for(let _=0;_<a.length;_++){const x=a.charCodeAt(_+1)||null,w=a.charCodeAt(_-1)||null;f+=!h&&(x&&us(x)&&!Yh[a[_+1]]||w&&us(w)&&!Yh[a[_-1]])||!Yh[a[_]]?a[_]:Yh[a[_]]}return f}(this.text,r)}trim(){let r=0;for(let h=0;h<this.text.length&&f_[this.text.charCodeAt(h)];h++)r++;let a=this.text.length;for(let h=this.text.length-1;h>=0&&h>=r&&f_[this.text.charCodeAt(h)];h--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const h=new nd;return h.text=this.text.substring(r,a),h.sectionIndex=this.sectionIndex.slice(r,a),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(jf.forText(r.scale,r.fontStack||a));const h=this.sections.length-1;for(let f=0;f<r.text.length;++f)this.sectionIndex.push(h)}addImageSection(r){const a=r.image?r.image.name:"";if(0===a.length)return void ui("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(jf.forImage(a)),this.sectionIndex.push(this.sections.length-1)):ui("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function s0(s,r,a,h,f,_,x,w,D,S,P,R,O,N,B){const $=nd.fromFeature(s,f);R===Fr.vertical&&$.verticalizePunctuation(O);let Z=[];const te=function(he,Me,Ee,Oe,Ge,Ae){if(!he)return[];const Be=[],Ve=function(rt,dt,ot,Bt,et,Et){let Vt=0;for(let Cn=0;Cn<rt.length();Cn++){const jt=rt.getSection(Cn);Vt+=J1(rt.getCharCode(Cn),jt,Bt,et,dt,Et)}return Vt/Math.max(1,Math.ceil(Vt/ot))}(he,Me,Ee,Oe,Ge,Ae),He=he.text.indexOf("\u200b")>=0;let Ke=0;for(let rt=0;rt<he.length();rt++){const dt=he.getSection(rt),ot=he.getCharCode(rt);if(f_[ot]||(Ke+=J1(ot,dt,Oe,Ge,Me,Ae)),rt<he.length()-1){const Bt=!((Le=ot)<11904||!(at["Bopomofo Extended"](Le)||at.Bopomofo(Le)||at["CJK Compatibility Forms"](Le)||at["CJK Compatibility Ideographs"](Le)||at["CJK Compatibility"](Le)||at["CJK Radicals Supplement"](Le)||at["CJK Strokes"](Le)||at["CJK Symbols and Punctuation"](Le)||at["CJK Unified Ideographs Extension A"](Le)||at["CJK Unified Ideographs"](Le)||at["Enclosed CJK Letters and Months"](Le)||at["Halfwidth and Fullwidth Forms"](Le)||at.Hiragana(Le)||at["Ideographic Description Characters"](Le)||at["Kangxi Radicals"](Le)||at["Katakana Phonetic Extensions"](Le)||at.Katakana(Le)||at["Vertical Forms"](Le)||at["Yi Radicals"](Le)||at["Yi Syllables"](Le)));(a0[ot]||Bt||dt.imageName)&&Be.push(c0(rt+1,Ke,Ve,Be,l0(ot,he.getCharCode(rt+1),Bt&&He),!1))}}var Le;return m_(c0(he.length(),Ke,Ve,Be,0,!0))}($,S,_,r,h,N),{processBidirectionalText:ce,processStyledBidirectionalText:ne}=I;if(ce&&1===$.sections.length){const he=ce($.toString(),te);for(const Me of he){const Ee=new nd;Ee.text=Me,Ee.sections=$.sections;for(let Oe=0;Oe<Me.length;Oe++)Ee.sectionIndex.push(0);Z.push(Ee)}}else if(ne){const he=ne($.text,$.sectionIndex,te);for(const Me of he){const Ee=new nd;Ee.text=Me[0],Ee.sectionIndex=Me[1],Ee.sections=$.sections,Z.push(Ee)}}else Z=function(he,Me){const Ee=[],Oe=he.text;let Ge=0;for(const Ae of Me)Ee.push(he.substring(Ge,Ae)),Ge=Ae;return Ge<Oe.length&&Ee.push(he.substring(Ge,Oe.length)),Ee}($,te);const ae=[],pe={positionedLines:ae,text:$.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,Me,Ee,Oe,Ge,Ae,Be,Ve,He,Ke,Le,rt){let dt=0,ot=0,Bt=0;const et="right"===Ve?1:"left"===Ve?0:.5;let Et=!1;for(const $t of Ge){const Wt=$t.getSections();for(const Wn of Wt){if(Wn.imageName)continue;const qt=Me[Wn.fontStack];if(qt&&(Et=void 0!==qt.ascender&&void 0!==qt.descender,!Et))break}if(!Et)break}let Vt=0;for(const $t of Ge){$t.trim();const Wt=$t.getMaxScale(),Wn=(Wt-1)*er,qt={positionedGlyphs:[],lineOffset:0};he.positionedLines[Vt]=qt;const ni=qt.positionedGlyphs;let Fn=0;if(!$t.length()){ot+=Ae,++Vt;continue}let xt=0,di=0;for(let ft=0;ft<$t.length();ft++){const gt=$t.getSection(ft),Xt=$t.getSectionIndex(ft),vi=$t.getCharCode(ft);let wn=gt.scale,xi=null,qn=null,xr=null,fi=er,hr=0;const Gi=!(He===Fr.horizontal||!Le&&!Pl(vi)||Le&&(f_[vi]||(Cn=vi,at.Arabic(Cn)||at["Arabic Supplement"](Cn)||at["Arabic Extended-A"](Cn)||at["Arabic Presentation Forms-A"](Cn)||at["Arabic Presentation Forms-B"](Cn))));if(gt.imageName){const Un=Oe[gt.imageName];if(!Un)continue;xr=gt.imageName,he.iconsInText=he.iconsInText||!0,qn=Un.paddedRect;const tr=Un.displaySize;wn=wn*er/rt,xi={width:tr[0],height:tr[1],left:Po,top:-r0,advance:Gi?tr[1]:tr[0],localGlyph:!1},hr=Et?-xi.height*wn:Ha+Wt*er-tr[1]*wn,fi=xi.advance;const _a=(Gi?tr[0]:tr[1])*wn-er*Wt;_a>0&&_a>Fn&&(Fn=_a)}else{const Un=Ee[gt.fontStack];if(!Un)continue;Un[vi]&&(qn=Un[vi]);const tr=Me[gt.fontStack];if(!tr)continue;const _a=tr.glyphs[vi];if(!_a)continue;if(xi=_a.metrics,fi=8203!==vi?er:0,Et){const Ru=void 0!==tr.ascender?Math.abs(tr.ascender):0,fd=void 0!==tr.descender?Math.abs(tr.descender):0,pd=(Ru+fd)*wn;xt<pd&&(xt=pd,di=(Ru-fd)/2*wn),hr=-Ru*wn}else hr=Ha+(Wt-wn)*er}Gi?(he.verticalizable=!0,ni.push({glyph:vi,imageName:xr,x:dt,y:ot+hr,vertical:Gi,scale:wn,localGlyph:xi.localGlyph,fontStack:gt.fontStack,sectionIndex:Xt,metrics:xi,rect:qn}),dt+=fi*wn+Ke):(ni.push({glyph:vi,imageName:xr,x:dt,y:ot+hr,vertical:Gi,scale:wn,localGlyph:xi.localGlyph,fontStack:gt.fontStack,sectionIndex:Xt,metrics:xi,rect:qn}),dt+=xi.advance*wn+Ke)}0!==ni.length&&(Bt=Math.max(dt-Ke,Bt),Et?u0(ni,et,Fn,di,Ae*Wt/2):u0(ni,et,Fn,0,Ae/2)),dt=0;const Bi=Ae*Wt+Fn;qt.lineOffset=Math.max(Fn,Wn),ot+=Bi,++Vt}var Cn;const jt=ot,{horizontalAlign:It,verticalAlign:ti}=g_(Be);(function($t,Wt,Wn,qt,ni,Fn){const xt=(Wt-Wn)*ni,di=-Fn*qt;for(const Bi of $t)for(const ft of Bi.positionedGlyphs)ft.x+=xt,ft.y+=di})(he.positionedLines,et,It,ti,Bt,jt),he.top+=-ti*jt,he.bottom=he.top+jt,he.left+=-It*Bt,he.right=he.left+Bt,he.hasBaseline=Et}(pe,r,a,h,Z,x,w,D,R,S,O,B),!function(he){for(const Me of he)if(0!==Me.positionedGlyphs.length)return!1;return!0}(ae)&&pe}const f_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},a0={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function J1(s,r,a,h,f,_){if(r.imageName){const x=h[r.imageName];return x?x.displaySize[0]*r.scale*er/_+f:0}{const x=a[r.fontStack],w=x&&x.glyphs[s];return w?w.metrics.advance*r.scale+f:0}}function p_(s,r,a,h){const f=Math.pow(s-r,2);return h?s<r?f/2:2*f:f+Math.abs(a)*a}function l0(s,r,a){let h=0;return 10===s&&(h-=1e4),a&&(h+=150),40!==s&&65288!==s||(h+=50),41!==r&&65289!==r||(h+=50),h}function c0(s,r,a,h,f,_){let x=null,w=p_(r,a,f,_);for(const D of h){const S=p_(r-D.x,a,f,_)+D.badness;S<=w&&(x=D,w=S)}return{index:s,x:r,priorBreak:x,badness:w}}function m_(s){return s?m_(s.priorBreak).concat(s.index):[]}function g_(s){let r=.5,a=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function u0(s,r,a,h,f){if(!(r||a||h||f))return;const _=s.length-1,x=s[_],w=(x.x+x.metrics.advance*x.scale)*r;for(let D=0;D<=_;D++)s[D].x-=w,s[D].y+=a+h+f}function pa(s,r,a){const{horizontalAlign:h,verticalAlign:f}=g_(a),_=r[0]-s.displaySize[0]*h,x=r[1]-s.displaySize[1]*f;return{image:s,top:x,bottom:x+s.displaySize[1],left:_,right:_+s.displaySize[0]}}function h0(s,r,a,h,f,_){const x=s.image;let w;if(x.content){const Z=x.content,te=x.pixelRatio||1;w=[Z[0]/te,Z[1]/te,x.displaySize[0]-Z[2]/te,x.displaySize[1]-Z[3]/te]}const D=r.left*_,S=r.right*_;let P,R,O,N;"width"===a||"both"===a?(N=f[0]+D-h[3],R=f[0]+S+h[1]):(N=f[0]+(D+S-x.displaySize[0])/2,R=N+x.displaySize[0]);const B=r.top*_,$=r.bottom*_;return"height"===a||"both"===a?(P=f[1]+B-h[0],O=f[1]+$+h[2]):(P=f[1]+(B+$-x.displaySize[1])/2,O=P+x.displaySize[1]),{image:x,top:P,right:R,bottom:O,left:N,collisionPadding:w}}class Ga extends st{constructor(r,a,h,f,_){super(r,a),this.angle=f,this.z=h,void 0!==_&&(this.segment=_)}clone(){return new Ga(this.x,this.y,this.z,this.angle,this.segment)}}function d0(s,r,a,h,f){if(void 0===r.segment)return!0;let _=r,x=r.segment+1,w=0;for(;w>-a/2;){if(x--,x<0)return!1;w-=s[x].dist(_),_=s[x]}w+=s[x].dist(s[x+1]),x++;const D=[];let S=0;for(;w<a/2;){const P=s[x],R=s[x+1];if(!R)return!1;let O=s[x-1].angleTo(P)-P.angleTo(R);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:w,angleDelta:O}),S+=O;w-D[0].distance>h;)S-=D.shift().angleDelta;if(S>f)return!1;x++,w+=P.dist(R)}return!0}function f0(s){let r=0;for(let a=0;a<s.length-1;a++)r+=s[a].dist(s[a+1]);return r}function p0(s,r,a){return s?.6*r*a:0}function m0(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function g0(s,r,a,h,f,_){const x=p0(a,f,_),w=m0(a,h)*_;let D=0;const S=f0(s)/2;for(let P=0;P<s.length-1;P++){const R=s[P],O=s[P+1],N=R.dist(O);if(D+N>S){const B=(S-D)/N,$=mn(R.x,O.x,B),Z=mn(R.y,O.y,B),te=new Ga($,Z,0,O.angleTo(R),P);return!x||d0(s,te,w,x,r)?te:void 0}D+=N}}function Q1(s,r,a,h,f,_,x,w,D){const S=p0(h,_,x),P=m0(h,f),R=P*x,O=0===s[0].x||s[0].x===D||0===s[0].y||s[0].y===D;return r-R<r/4&&(r=R+r/4),_0(s,O?r/2*w%r:(P/2+2*_)*x*w%r,r,S,a,R,O,!1,D)}function _0(s,r,a,h,f,_,x,w,D){const S=_/2,P=f0(s);let R=0,O=r-a,N=[];for(let B=0;B<s.length-1;B++){const $=s[B],Z=s[B+1],te=$.dist(Z),ce=Z.angleTo($);for(;O+a<R+te;){O+=a;const ne=(O-R)/te,ae=mn($.x,Z.x,ne),pe=mn($.y,Z.y,ne);if(ae>=0&&ae<D&&pe>=0&&pe<D&&O-S>=0&&O+S<=P){const he=new Ga(ae,pe,0,ce,B);he._round(),h&&!d0(s,he,_,h,f)||N.push(he)}}R+=te}return w||N.length||x||(N=_0(s,R/2,a,h,f,_,x,!0,D)),N}function y0(s,r,a,h,f){const _=[];for(let x=0;x<s.length;x++){const w=s[x];let D;for(let S=0;S<w.length-1;S++){let P=w[S],R=w[S+1];P.x<r&&R.x<r||(P.x<r?P=new st(r,P.y+(r-P.x)/(R.x-P.x)*(R.y-P.y))._round():R.x<r&&(R=new st(r,P.y+(r-P.x)/(R.x-P.x)*(R.y-P.y))._round()),P.y<a&&R.y<a||(P.y<a?P=new st(P.x+(a-P.y)/(R.y-P.y)*(R.x-P.x),a)._round():R.y<a&&(R=new st(P.x+(a-P.y)/(R.y-P.y)*(R.x-P.x),a)._round()),P.x>=h&&R.x>=h||(P.x>=h?P=new st(h,P.y+(h-P.x)/(R.x-P.x)*(R.y-P.y))._round():R.x>=h&&(R=new st(h,P.y+(h-P.x)/(R.x-P.x)*(R.y-P.y))._round()),P.y>=f&&R.y>=f||(P.y>=f?P=new st(P.x+(f-P.y)/(R.y-P.y)*(R.x-P.x),f)._round():R.y>=f&&(R=new st(P.x+(f-P.y)/(R.y-P.y)*(R.x-P.x),f)._round()),D&&P.equals(D[D.length-1])||(D=[P],_.push(D)),D.push(R)))))}}return _}pt(Ga,"Anchor");const Qt=1e20;function Rt(s,r,a,h,f,_,x,w,D){for(let S=r;S<r+h;S++)__(s,a*_+S,_,f,x,w,D);for(let S=a;S<a+f;S++)__(s,S*_+r,1,h,x,w,D)}function __(s,r,a,h,f,_,x){_[0]=0,x[0]=-Qt,x[1]=Qt,f[0]=s[r];for(let w=1,D=0,S=0;w<h;w++){f[w]=s[r+w*a];const P=w*w;do{const R=_[D];S=(f[w]-f[R]+P-R*R)/(w-R)/2}while(S<=x[D]&&--D>-1);D++,_[D]=w,x[D]=S,x[D+1]=Qt}for(let w=0,D=0;w<h;w++){for(;x[D+1]<w;)D++;const S=_[D],P=w-S;s[r+w*a]=f[S]+P*P}}const js=2,y_={none:0,ideographs:1,all:2};class id{constructor(r,a,h){this.requestManager=r,this.localGlyphMode=a,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,a){const h=[];for(const f in r)for(const _ of r[f])h.push({stack:f,id:_});Xi(h,({stack:f,id:_},x)=>{let w=this.entries[f];w||(w=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=w.glyphs[_];if(void 0!==D)return void x(null,{stack:f,id:_,glyph:D});if(D=this._tinySDF(w,f,_),D)return w.glyphs[_]=D,void x(null,{stack:f,id:_,glyph:D});const S=Math.floor(_/256);if(256*S>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[S])return void x(null,{stack:f,id:_,glyph:D});let P=w.requests[S];P||(P=w.requests[S]=[],id.loadGlyphRange(f,S,this.url,this.requestManager,(R,O)=>{if(O){w.ascender=O.ascender,w.descender=O.descender;for(const N in O.glyphs)this._doesCharSupportLocalGlyph(+N)||(w.glyphs[+N]=O.glyphs[+N]);w.ranges[S]=!0}for(const N of P)N(R,O);delete w.requests[S]})),P.push((R,O)=>{R?x(R):O&&x(null,{stack:f,id:_,glyph:O.glyphs[_]||null})})},(f,_)=>{if(f)a(f);else if(_){const x={};for(const{stack:w,id:D,glyph:S}of _)void 0===x[w]&&(x[w]={}),void 0===x[w].glyphs&&(x[w].glyphs={}),x[w].glyphs[D]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},x[w].ascender=this.entries[w].ascender,x[w].descender=this.entries[w].descender;a(null,x)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==y_.none&&(this.localGlyphMode===y_.all?!!this.localFontFamily:!!this.localFontFamily&&(at["CJK Unified Ideographs"](r)||at["Hangul Syllables"](r)||at.Hiragana(r)||at.Katakana(r)||at["CJK Symbols and Punctuation"](r)))}_tinySDF(r,a,h){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let _=r.tinySDF;if(!_){let $="400";/bold/i.test(a)?$="900":/medium/i.test(a)?$="500":/light/i.test(a)&&($="200"),_=r.tinySDF=new id.TinySDF({fontFamily:f,fontWeight:$,fontSize:24*js,buffer:3*js,radius:8*js}),_.fontWeight=$}if(this.localGlyphs[_.fontWeight][h])return this.localGlyphs[_.fontWeight][h];const x=String.fromCharCode(h),{data:w,width:D,height:S,glyphWidth:P,glyphHeight:R,glyphLeft:O,glyphTop:N,glyphAdvance:B}=_.draw(x);return this.localGlyphs[_.fontWeight][h]={id:h,bitmap:new Ua({width:D,height:S},w),metrics:{width:P/js,height:R/js,left:O/js,top:N/js-27,advance:B/js,localGlyph:!0}}}}id.loadGlyphRange=function(s,r,a,h,f){const _=256*r,x=_+255,w=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",s).replace("{range}",`${_}-${x}`),Ta.Glyphs);ic(w,(D,S)=>{if(D)f(D);else if(S){const P={},R=new mm(S).readFields(td,{});for(const O of R.glyphs)P[O.id]=O;f(null,{glyphs:P,ascender:R.ascender,descender:R.descender})}})},id.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:a=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:_="normal",fontStyle:x="normal"}={}){this.buffer=r,this.cutoff=h,this.radius=a;const w=this.size=s+4*r,D=this._createCanvas(w),S=this.ctx=D.getContext("2d",{willReadFrequently:!0});S.font=`${x} ${_} ${s}px ${f}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:_}=this.ctx.measureText(s),x=Math.ceil(a),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-f))),D=Math.min(this.size-this.buffer,x+Math.ceil(h)),S=w+2*this.buffer,P=D+2*this.buffer,R=Math.max(S*P,0),O=new Uint8ClampedArray(R),N={data:O,width:S,height:P,glyphWidth:w,glyphHeight:D,glyphTop:x,glyphLeft:0,glyphAdvance:r};if(0===w||0===D)return N;const{ctx:B,buffer:$,gridInner:Z,gridOuter:te}=this;B.clearRect($,$,w,D),B.fillText(s,$,$+x);const ce=B.getImageData($,$,w,D);te.fill(Qt,0,R),Z.fill(0,0,R);for(let ne=0;ne<D;ne++)for(let ae=0;ae<w;ae++){const pe=ce.data[4*(ne*w+ae)+3]/255;if(0===pe)continue;const he=(ne+$)*S+ae+$;if(1===pe)te[he]=0,Z[he]=Qt;else{const Me=.5-pe;te[he]=Me>0?Me*Me:0,Z[he]=Me<0?Me*Me:0}}Rt(te,0,0,S,P,S,this.f,this.v,this.z),Rt(Z,$,$,w,D,S,this.f,this.v,this.z);for(let ne=0;ne<R;ne++){const ae=Math.sqrt(te[ne])-Math.sqrt(Z[ne]);O[ne]=Math.round(255-255*(ae/this.radius+this.cutoff))}return N}};const Mu=Po;function v0(s,r,a,h){const f=[],_=s.image,x=_.pixelRatio,w=_.paddedRect.w-2*Mu,D=_.paddedRect.h-2*Mu,S=s.right-s.left,P=s.bottom-s.top,R=_.stretchX||[[0,w]],O=_.stretchY||[[0,D]],N=(Ae,Be)=>Ae+Be[1]-Be[0],B=R.reduce(N,0),$=O.reduce(N,0),Z=w-B,te=D-$;let ce=0,ne=B,ae=0,pe=$,he=0,Me=Z,Ee=0,Oe=te;if(_.content&&h){const Ae=_.content;ce=Uf(R,0,Ae[0]),ae=Uf(O,0,Ae[1]),ne=Uf(R,Ae[0],Ae[2]),pe=Uf(O,Ae[1],Ae[3]),he=Ae[0]-ce,Ee=Ae[1]-ae,Me=Ae[2]-Ae[0]-ne,Oe=Ae[3]-Ae[1]-pe}const Ge=(Ae,Be,Ve,He)=>{const Ke=gm(Ae.stretch-ce,ne,S,s.left),Le=v_(Ae.fixed-he,Me,Ae.stretch,B),rt=gm(Be.stretch-ae,pe,P,s.top),dt=v_(Be.fixed-Ee,Oe,Be.stretch,$),ot=gm(Ve.stretch-ce,ne,S,s.left),Bt=v_(Ve.fixed-he,Me,Ve.stretch,B),et=gm(He.stretch-ae,pe,P,s.top),Et=v_(He.fixed-Ee,Oe,He.stretch,$),Vt=new st(Ke,rt),Cn=new st(ot,rt),jt=new st(ot,et),It=new st(Ke,et),ti=new st(Le/x,dt/x),$t=new st(Bt/x,Et/x),Wt=r*Math.PI/180;if(Wt){const ni=Math.sin(Wt),Fn=Math.cos(Wt),xt=[Fn,-ni,ni,Fn];Vt._matMult(xt),Cn._matMult(xt),It._matMult(xt),jt._matMult(xt)}const Wn=Ae.stretch+Ae.fixed,qt=Be.stretch+Be.fixed;return{tl:Vt,tr:Cn,bl:It,br:jt,tex:{x:_.paddedRect.x+Mu+Wn,y:_.paddedRect.y+Mu+qt,w:Ve.stretch+Ve.fixed-Wn,h:He.stretch+He.fixed-qt},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ti,pixelOffsetBR:$t,minFontScaleX:Me/x/S,minFontScaleY:Oe/x/P,isSDF:a}};if(h&&(_.stretchX||_.stretchY)){const Ae=x0(R,Z,B),Be=x0(O,te,$);for(let Ve=0;Ve<Ae.length-1;Ve++){const He=Ae[Ve],Ke=Ae[Ve+1];for(let Le=0;Le<Be.length-1;Le++)f.push(Ge(He,Be[Le],Ke,Be[Le+1]))}}else f.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:D+1}));return f}function Uf(s,r,a){let h=0;for(const f of s)h+=Math.max(r,Math.min(a,f[1]))-Math.max(r,Math.min(a,f[0]));return h}function x0(s,r,a){const h=[{fixed:-Mu,stretch:0}];for(const[f,_]of s){const x=h[h.length-1];h.push({fixed:f-x.stretch,stretch:x.stretch}),h.push({fixed:f-x.stretch,stretch:x.stretch+(_-f)})}return h.push({fixed:r+Mu,stretch:a}),h}function gm(s,r,a,h){return s/r*a+h}function v_(s,r,a,h){return s-r*a/h}function b0(s,r,a,h){const f=r+s.positionedLines[h].lineOffset;return 0===h?a+f/2:a+(f+(r+s.positionedLines[h-1].lineOffset))/2}class w0{constructor(r=[],a=Wa){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:h}=this,f=a[r];for(;r>0;){const _=r-1>>1,x=a[_];if(h(f,x)>=0)break;a[r]=x,r=_}a[r]=f}_down(r){const{data:a,compare:h}=this,f=this.length>>1,_=a[r];for(;r<f;){let x=1+(r<<1),w=a[x];const D=x+1;if(D<this.length&&h(a[D],w)<0&&(x=D,w=a[D]),h(w,_)>=0)break;a[r]=w,r=x}a[r]=_}}function Wa(s,r){return s<r?-1:s>r?1:0}function ew(s,r=1,a=!1){let h=1/0,f=1/0,_=-1/0,x=-1/0;const w=s[0];for(let N=0;N<w.length;N++){const B=w[N];(!N||B.x<h)&&(h=B.x),(!N||B.y<f)&&(f=B.y),(!N||B.x>_)&&(_=B.x),(!N||B.y>x)&&(x=B.y)}const D=Math.min(_-h,x-f);let S=D/2;const P=new w0([],x_);if(0===D)return new st(h,f);for(let N=h;N<_;N+=D)for(let B=f;B<x;B+=D)P.push(new Ic(N+S,B+S,S,s));let R=function(N){let B=0,$=0,Z=0;const te=N[0];for(let ce=0,ne=te.length,ae=ne-1;ce<ne;ae=ce++){const pe=te[ce],he=te[ae],Me=pe.x*he.y-he.x*pe.y;$+=(pe.x+he.x)*Me,Z+=(pe.y+he.y)*Me,B+=3*Me}return new Ic($/B,Z/B,0,N)}(s),O=P.length;for(;P.length;){const N=P.pop();(N.d>R.d||!R.d)&&(R=N,a&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,O)),N.max-R.d<=r||(S=N.h/2,P.push(new Ic(N.p.x-S,N.p.y-S,S,s)),P.push(new Ic(N.p.x+S,N.p.y-S,S,s)),P.push(new Ic(N.p.x-S,N.p.y+S,S,s)),P.push(new Ic(N.p.x+S,N.p.y+S,S,s)),O+=4)}return a&&(console.log(`num probes: ${O}`),console.log(`best distance: ${R.d}`)),R.p}function x_(s,r){return r.max-s.max}class Ic{constructor(r,a,h,f){this.p=new st(r,a),this.h=h,this.d=function(_,x){let w=!1,D=1/0;for(let S=0;S<x.length;S++){const P=x[S];for(let R=0,O=P.length,N=O-1;R<O;N=R++){const B=P[R],$=P[N];B.y>_.y!=$.y>_.y&&_.x<($.x-B.x)*(_.y-B.y)/($.y-B.y)+B.x&&(w=!w),D=Math.min(D,wv(_,B,$))}}return(w?1:-1)*Math.sqrt(D)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const rd=7,C0=Number.POSITIVE_INFINITY,UD=Math.sqrt(2);function tw(s,[r,a]){let h=0,f=0;if(a===C0){r<0&&(r=0);const _=r/UD;switch(s){case"top-right":case"top-left":f=_-rd;break;case"bottom-right":case"bottom-left":f=-_+rd;break;case"bottom":f=-r+rd;break;case"top":f=r-rd}switch(s){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=r;break;case"right":h=-r}}else{switch(r=Math.abs(r),a=Math.abs(a),s){case"top-right":case"top-left":case"top":f=a-rd;break;case"bottom-right":case"bottom-left":case"bottom":f=-a+rd}switch(s){case"top-right":case"bottom-right":case"right":h=-r;break;case"top-left":case"bottom-left":case"left":h=r}}return[h,f]}function nw(s,r,a,h,f,_,x,w,D,S){s.createArrays(),s.tilePixelRatio=St/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const P=s.layers[0].layout,R=s.layers[0]._unevaluatedLayout._values,O={};if("composite"===s.textSizeData.kind){const{minZoom:$,maxZoom:Z}=s.textSizeData;O.compositeTextSizes=[R["text-size"].possiblyEvaluate(new k($),w),R["text-size"].possiblyEvaluate(new k(Z),w)]}if("composite"===s.iconSizeData.kind){const{minZoom:$,maxZoom:Z}=s.iconSizeData;O.compositeIconSizes=[R["icon-size"].possiblyEvaluate(new k($),w),R["icon-size"].possiblyEvaluate(new k(Z),w)]}O.layoutTextSize=R["text-size"].possiblyEvaluate(new k(D+1),w),O.layoutIconSize=R["icon-size"].possiblyEvaluate(new k(D+1),w),O.textMaxSize=R["text-size"].possiblyEvaluate(new k(18),w);const N="map"===P.get("text-rotation-alignment")&&"point"!==P.get("symbol-placement"),B=P.get("text-size");for(const $ of s.features){const Z=P.get("text-font").evaluate($,{},w).join(","),te=B.evaluate($,{},w),ce=O.layoutTextSize.evaluate($,{},w),ne=(O.layoutIconSize.evaluate($,{},w),{horizontal:{},vertical:void 0}),ae=$.text;let pe,he=[0,0];if(ae){const Oe=ae.toString(),Ge=P.get("text-letter-spacing").evaluate($,{},w)*er,Ae=P.get("text-line-height").evaluate($,{},w)*er,Be=gr(Oe)?Ge:0,Ve=P.get("text-anchor").evaluate($,{},w),He=P.get("text-variable-anchor");if(!He){const ot=P.get("text-radial-offset").evaluate($,{},w);he=ot?tw(Ve,[ot*er,C0]):P.get("text-offset").evaluate($,{},w).map(Bt=>Bt*er)}let Ke=N?"center":P.get("text-justify").evaluate($,{},w);const Le="point"===P.get("symbol-placement"),rt=Le?P.get("text-max-width").evaluate($,{},w)*er:1/0,dt=ot=>{s.allowVerticalPlacement&&Al(Oe)&&(ne.vertical=s0(ae,r,a,f,Z,rt,Ae,Ve,ot,Be,he,Fr.vertical,!0,ce,te))};if(!N&&He){const ot="auto"===Ke?He.map(et=>_m(et)):[Ke];let Bt=!1;for(let et=0;et<ot.length;et++){const Et=ot[et];if(!ne.horizontal[Et])if(Bt)ne.horizontal[Et]=ne.horizontal[0];else{const Vt=s0(ae,r,a,f,Z,rt,Ae,"center",Et,Be,he,Fr.horizontal,!1,ce,te);Vt&&(ne.horizontal[Et]=Vt,Bt=1===Vt.positionedLines.length)}}dt("left")}else{if("auto"===Ke&&(Ke=_m(Ve)),Le||P.get("text-writing-mode").indexOf("horizontal")>=0||!Al(Oe)){const ot=s0(ae,r,a,f,Z,rt,Ae,Ve,Ke,Be,he,Fr.horizontal,!1,ce,te);ot&&(ne.horizontal[Ke]=ot)}dt(Le?"left":Ke)}}let Me=!1;if($.icon&&$.icon.name){const Oe=h[$.icon.name];Oe&&(pe=pa(f[$.icon.name],P.get("icon-offset").evaluate($,{},w),P.get("icon-anchor").evaluate($,{},w)),Me=Oe.sdf,void 0===s.sdfIcons?s.sdfIcons=Oe.sdf:s.sdfIcons!==Oe.sdf&&ui("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==s.pixelRatio||0!==P.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const Ee=b_(ne.horizontal)||ne.vertical;s.iconsInText||(s.iconsInText=!!Ee&&Ee.iconsInText),(Ee||pe)&&$D(s,$,ne,pe,h,O,ce,0,he,Me,x,w,S)}_&&s.generateCollisionDebugBuffers(D,s.collisionBoxArray)}function _m(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function $D(s,r,a,h,f,_,x,w,D,S,P,R,O){let N=_.textMaxSize.evaluate(r,{},R);void 0===N&&(N=x);const B=s.layers[0].layout,$=B.get("icon-offset").evaluate(r,{},R),Z=b_(a.horizontal)||a.vertical,te="globe"===O.name,ce=er,ne=x/ce,ae=s.tilePixelRatio*N/ce,pe=(Ve=s.overscaling,s.zoom>18&&Ve>2&&(Ve>>=1),Math.max(St/(512*Ve),1)*B.get("symbol-spacing")),he=B.get("text-padding")*s.tilePixelRatio,Me=B.get("icon-padding")*s.tilePixelRatio,Ee=an(B.get("text-max-angle")),Oe="map"===B.get("text-rotation-alignment")&&"point"!==B.get("symbol-placement"),Ge="map"===B.get("icon-rotation-alignment")&&"point"!==B.get("symbol-placement"),Ae=B.get("symbol-placement"),Be=pe/2;var Ve;const He=B.get("icon-text-fit");let Ke;h&&"none"!==He&&(s.allowVerticalPlacement&&a.vertical&&(Ke=h0(h,a.vertical,He,B.get("icon-text-fit-padding"),$,ne)),Z&&(h=h0(h,Z,He,B.get("icon-text-fit-padding"),$,ne)));const Le=(rt,dt,ot)=>{if(dt.x<0||dt.x>=St||dt.y<0||dt.y>=St)return;let Bt=null;if(te){const{x:et,y:Et,z:Vt}=O.projectTilePoint(dt.x,dt.y,ot);Bt={anchor:new Ga(et,Et,Vt,0,void 0),up:O.upVector(ot,dt.x,dt.y)}}!function(et,Et,Vt,Cn,jt,It,ti,$t,Wt,Wn,qt,ni,Fn,xt,di,Bi,ft,gt,Xt,vi,wn,xi,qn,xr,fi){const hr=et.addToLineVertexArray(Et,Cn);let Gi,Un,tr,_a,Ru,fd,pd,go=0,J0=0,Q0=0,ex=0,Mm=-1,ep=-1;const ya={};let z_=zp("");const Oc=Vt?Vt.anchor:Et;let Im=0,Am=0;if(void 0===Wt._unevaluatedLayout.getValue("text-radial-offset")?[Im,Am]=Wt.layout.get("text-offset").evaluate(wn,{},fi).map(Jr=>Jr*er):(Im=Wt.layout.get("text-radial-offset").evaluate(wn,{},fi)*er,Am=C0),et.allowVerticalPlacement&&jt.vertical){const Jr=jt.vertical;if(di)fd=w_(Jr),$t&&(pd=w_($t));else{const nr=Wt.layout.get("text-rotate").evaluate(wn,{},fi)+90;tr=Iu(Wn,Oc,Et,qt,ni,Fn,Jr,xt,nr,Bi),$t&&(_a=Iu(Wn,Oc,Et,qt,ni,Fn,$t,gt,nr))}}if(It){const Jr=Wt.layout.get("icon-rotate").evaluate(wn,{},fi),nr="none"!==Wt.layout.get("icon-text-fit"),tp=v0(It,Jr,qn,nr),N_=$t?v0($t,Jr,qn,nr):void 0;Un=Iu(Wn,Oc,Et,qt,ni,Fn,It,gt,Jr),go=4*tp.length;const km=et.iconSizeData;let _s=null;"source"===km.kind?(_s=[Ko*Wt.layout.get("icon-size").evaluate(wn,{},fi)],_s[0]>gs&&ui(`${et.layerIds[0]}: Value for "icon-size" is >= ${$f}. Reduce your "icon-size".`)):"composite"===km.kind&&(_s=[Ko*xi.compositeIconSizes[0].evaluate(wn,{},fi),Ko*xi.compositeIconSizes[1].evaluate(wn,{},fi)],(_s[0]>gs||_s[1]>gs)&&ui(`${et.layerIds[0]}: Value for "icon-size" is >= ${$f}. Reduce your "icon-size".`)),et.addSymbols(et.icon,tp,_s,vi,Xt,wn,!1,Vt,Et,hr.lineStartIndex,hr.lineLength,-1,xr,fi),Mm=et.icon.placedSymbolArray.length-1,N_&&(J0=4*N_.length,et.addSymbols(et.icon,N_,_s,vi,Xt,wn,Fr.vertical,Vt,Et,hr.lineStartIndex,hr.lineLength,-1,xr,fi),ep=et.icon.placedSymbolArray.length-1)}for(const Jr in jt.horizontal){const nr=jt.horizontal[Jr];Gi||(z_=zp(nr.text),di?Ru=w_(nr):Gi=Iu(Wn,Oc,Et,qt,ni,Fn,nr,xt,Wt.layout.get("text-rotate").evaluate(wn,{},fi),Bi));const tp=1===nr.positionedLines.length;if(Q0+=E0(et,Vt,Et,nr,ti,Wt,di,wn,Bi,hr,jt.vertical?Fr.horizontal:Fr.horizontalOnly,tp?Object.keys(jt.horizontal):[Jr],ya,Mm,xi,xr,fi),tp)break}jt.vertical&&(ex+=E0(et,Vt,Et,jt.vertical,ti,Wt,di,wn,Bi,hr,Fr.vertical,["vertical"],ya,ep,xi,xr,fi));let $l=-1;const Pm=(Jr,nr)=>Jr?Math.max(Jr,nr):nr;$l=Pm(Ru,$l),$l=Pm(fd,$l),$l=Pm(pd,$l);const tx=$l>-1?1:0;et.glyphOffsetArray.length>=qa.MAX_GLYPHS&&ui("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==wn.sortKey&&et.addToSortKeyRanges(et.symbolInstances.length,wn.sortKey),et.symbolInstances.emplaceBack(Oc.x,Oc.y,Oc.z,Et.x,Et.y,ya.right>=0?ya.right:-1,ya.center>=0?ya.center:-1,ya.left>=0?ya.left:-1,ya.vertical>=0?ya.vertical:-1,Mm,ep,z_,void 0!==Gi?Gi:et.collisionBoxArray.length,void 0!==Gi?Gi+1:et.collisionBoxArray.length,void 0!==tr?tr:et.collisionBoxArray.length,void 0!==tr?tr+1:et.collisionBoxArray.length,void 0!==Un?Un:et.collisionBoxArray.length,void 0!==Un?Un+1:et.collisionBoxArray.length,_a||et.collisionBoxArray.length,_a?_a+1:et.collisionBoxArray.length,qt,Q0,ex,go,J0,tx,0,Im,Am,$l)}(s,dt,Bt,rt,a,h,f,Ke,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,he,Oe,D,0,Me,Ge,$,r,_,S,P,R)};if("line"===Ae)for(const rt of y0(r.geometry,0,0,St,St)){const dt=Q1(rt,pe,Ee,a.vertical||Z,h,ce,ae,s.overscaling,St);for(const ot of dt)Z&&D0(s,Z.text,Be,ot)||Le(rt,ot,R)}else if("line-center"===Ae){for(const rt of r.geometry)if(rt.length>1){const dt=g0(rt,Ee,a.vertical||Z,h,ce,ae);dt&&Le(rt,dt,R)}}else if("Polygon"===r.type)for(const rt of $a(r.geometry,0)){const dt=ew(rt,16);Le(rt[0],new Ga(dt.x,dt.y,0,0,void 0),R)}else if("LineString"===r.type)for(const rt of r.geometry)Le(rt,new Ga(rt[0].x,rt[0].y,0,0,void 0),R);else if("Point"===r.type)for(const rt of r.geometry)for(const dt of rt)Le([dt],new Ga(dt.x,dt.y,0,0,void 0),R)}const $f=255,gs=$f*Ko;function E0(s,r,a,h,f,_,x,w,D,S,P,R,O,N,B,$,Z){const te=function(ae,pe,he,Me,Ee,Oe,Ge,Ae){const Be=[];if(0===pe.positionedLines.length)return Be;const Ve=Me.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,He=function(ot){const Bt=ot[0],et=ot[1],Et=Bt*et;return Et>0?[Bt,-et]:Et<0?[-Bt,et]:0===Bt?[et,Bt]:[et,-Bt]}(he);let Ke=Math.abs(pe.top-pe.bottom);for(const ot of pe.positionedLines)Ke-=ot.lineOffset;const Le=pe.positionedLines.length,rt=Ke/Le;let dt=pe.top-he[1];for(let ot=0;ot<Le;++ot){const Bt=pe.positionedLines[ot];dt=b0(pe,rt,dt,ot);for(const et of Bt.positionedGlyphs){if(!et.rect)continue;const Et=et.rect||{};let Vt=r0+1,Cn=!0,jt=1,It=0;if(et.imageName){const qn=Ge[et.imageName];if(!qn)continue;if(qn.sdf){ui("SDF images are not supported in formatted text and will be ignored.");continue}Cn=!1,jt=qn.pixelRatio,Vt=Po/jt}const ti=(Ee||Ae)&&et.vertical,$t=et.metrics.advance*et.scale/2,Wt=et.metrics,Wn=et.rect;if(null===Wn)continue;Ae&&pe.verticalizable&&(It=et.imageName?$t-et.metrics.width*et.scale/2:0);const qt=Ee?[et.x+$t,et.y]:[0,0];let ni=[0,0],Fn=[0,0],xt=!1;Ee||(ti?(Fn=[et.x+$t+He[0],et.y+He[1]-It],xt=!0):ni=[et.x+$t+he[0],et.y+he[1]-It]);const di=Wn.w*et.scale/(jt*(et.localGlyph?js:1)),Bi=Wn.h*et.scale/(jt*(et.localGlyph?js:1));let ft,gt,Xt,vi;if(ti){const qn=et.y-dt,xr=new st(-$t,$t-qn),fi=-Math.PI/2,hr=new st(...Fn);ft=new st(-$t+ni[0],ni[1]),ft._rotateAround(fi,xr)._add(hr),ft.x+=-qn+$t,ft.y-=(Wt.left-Vt)*et.scale;const Gi=et.imageName?Wt.advance*et.scale:er*et.scale,Un=String.fromCharCode(et.glyph);Kh(Un)?ft.x+=(1-Vt)*et.scale:G1(Un)?ft.x+=Gi-Wt.height*et.scale+(-Vt-1)*et.scale:ft.x+=et.imageName||Wt.width+2*Vt===Wn.w&&Wt.height+2*Vt===Wn.h?(Gi-Bi)/2:(Gi-(Wt.height+2*Vt)*et.scale)/2,gt=new st(ft.x,ft.y-di),Xt=new st(ft.x+Bi,ft.y),vi=new st(ft.x+Bi,ft.y-di)}else{const qn=(Wt.left-Vt)*et.scale-$t+ni[0],xr=(-Wt.top-Vt)*et.scale+ni[1],fi=qn+di,hr=xr+Bi;ft=new st(qn,xr),gt=new st(fi,xr),Xt=new st(qn,hr),vi=new st(fi,hr)}if(Ve){let qn;qn=Ee?new st(0,0):xt?new st(He[0],He[1]):new st(he[0],he[1]),ft._rotateAround(Ve,qn),gt._rotateAround(Ve,qn),Xt._rotateAround(Ve,qn),vi._rotateAround(Ve,qn)}const wn=new st(0,0),xi=new st(0,0);Be.push({tl:ft,tr:gt,bl:Xt,br:vi,tex:Et,writingMode:pe.writingMode,glyphOffset:qt,sectionIndex:et.sectionIndex,isSDF:Cn,pixelOffsetTL:wn,pixelOffsetBR:xi,minFontScaleX:0,minFontScaleY:0})}}return Be}(0,h,D,_,x,w,f,s.allowVerticalPlacement),ce=s.textSizeData;let ne=null;"source"===ce.kind?(ne=[Ko*_.layout.get("text-size").evaluate(w,{},Z)],ne[0]>gs&&ui(`${s.layerIds[0]}: Value for "text-size" is >= ${$f}. Reduce your "text-size".`)):"composite"===ce.kind&&(ne=[Ko*B.compositeTextSizes[0].evaluate(w,{},Z),Ko*B.compositeTextSizes[1].evaluate(w,{},Z)],(ne[0]>gs||ne[1]>gs)&&ui(`${s.layerIds[0]}: Value for "text-size" is >= ${$f}. Reduce your "text-size".`)),s.addSymbols(s.text,te,ne,D,x,w,P,r,a,S.lineStartIndex,S.lineLength,N,$,Z);for(const ae of R)O[ae]=s.text.placedSymbolArray.length-1;return 4*te.length}function b_(s){for(const r in s)return s[r];return null}function Iu(s,r,a,h,f,_,x,w,D,S){let P=x.top,R=x.bottom,O=x.left,N=x.right;const B=x.collisionPadding;if(B&&(O-=B[0],P-=B[1],N+=B[2],R+=B[3]),D){const $=new st(O,P),Z=new st(N,P),te=new st(O,R),ce=new st(N,R),ne=an(D);let ae=new st(0,0);S&&(ae=new st(S[0],S[1])),$._rotateAround(ne,ae),Z._rotateAround(ne,ae),te._rotateAround(ne,ae),ce._rotateAround(ne,ae),O=Math.min($.x,Z.x,te.x,ce.x),N=Math.max($.x,Z.x,te.x,ce.x),P=Math.min($.y,Z.y,te.y,ce.y),R=Math.max($.y,Z.y,te.y,ce.y)}return s.emplaceBack(r.x,r.y,r.z,a.x,a.y,O,P,N,R,w,h,f,_),s.length-1}function w_(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function D0(s,r,a,h){const f=s.compareText;if(r in f){const _=f[r];for(let x=_.length-1;x>=0;x--)if(h.dist(_[x])<a)return!0}else f[r]=[];return f[r].push(h),!1}function T0(s,r){const a=s.fovAboveCenter,h=s.elevation?s.elevation.getMinElevationBelowMSL()*r:0,f=(s._camera.position[2]*s.worldSize-h)/Math.cos(s._pitch),_=Math.sin(a)*f/Math.sin(Math.max(Math.PI/2-s._pitch-a,.01)),x=Math.sin(s._pitch)*_+f;return Math.min(1.01*x,f*(1/s._horizonShift))}function Au(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const a=Math.pow(2,-s.z),h=s.x*a,f=(s.x+1)*a,_=s.y*a,x=(s.y+1)*a,w=Xo(h),D=Xo(f),S=Or(_),P=Or(x),R=r.project(w,S),O=r.project(D,S),N=r.project(D,P),B=r.project(w,P);let $=Math.min(R.x,O.x,N.x,B.x),Z=Math.min(R.y,O.y,N.y,B.y),te=Math.max(R.x,O.x,N.x,B.x),ce=Math.max(R.y,O.y,N.y,B.y);const ne=a/16;function ae(he,Me,Ee,Oe,Ge,Ae){const Be=(Ee+Ge)/2,Ve=(Oe+Ae)/2,He=r.project(Xo(Be),Or(Ve)),Ke=Math.max(0,$-He.x,Z-He.y,He.x-te,He.y-ce);$=Math.min($,He.x),te=Math.max(te,He.x),Z=Math.min(Z,He.y),ce=Math.max(ce,He.y),Ke>ne&&(ae(he,He,Ee,Oe,Be,Ve),ae(He,Me,Be,Ve,Ge,Ae))}ae(R,O,h,_,f,_),ae(O,N,f,_,f,x),ae(N,B,f,x,h,x),ae(B,R,h,x,h,_),$-=ne,Z-=ne,te+=ne,ce+=ne;const pe=1/Math.max(te-$,ce-Z);return{scale:pe,x:$*pe,y:Z*pe,x2:te*pe,y2:ce*pe,projection:r}}const iw=To(new Float32Array(16));class Ac{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,a){return{x:0,y:0,z:0}}unproject(r,a){return new jn(0,0)}projectTilePoint(r,a,h){return{x:r,y:a,z:0}}locationPoint(r,a,h=!0){return r._coordinatePoint(r.locationCoordinate(a),h)}pixelsPerMeter(r,a){return Bs(1,r)*a}pixelSpaceConversion(r,a,h){return 1}farthestPixelDistance(r){return T0(r,r.pixelsPerMeter)}pointCoordinate(r,a,h,f){const _=r.horizonLineFromTop(!1),x=new st(a,Math.max(_,h));return r.rayIntersectionCoordinate(r.pointRayIntersection(x,f))}pointCoordinate3D(r,a,h){const f=new st(a,h);if(r.elevation)return r.elevation.pointCoordinate(f);{const _=this.pointCoordinate(r,f.x,f.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(r,a){if(r.elevation)return!this.pointCoordinate3D(r,a.x,a.y);const h=r.horizonLineFromTop();return a.y<h}createInversionMatrix(r,a){return iw}createTileMatrix(r,a,h){let f,_,x;const w=h.canonical,D=To(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=Au(w,this);f=1,_=S.x+h.wrap*S.scale,x=S.y,yc(D,D,[f/S.scale,f/S.scale,r.pixelsPerMeter/a])}else f=a/r.zoomScale(w.z),_=(w.x+Math.pow(2,w.z)*h.wrap)*f,x=w.y*f;return ua(D,D,[_,x,0]),yc(D,D,[f/St,f/St,1]),D}upVector(r,a,h){return[0,0,1]}upVectorScale(r,a,h){return{metersToTile:1}}}class rw extends Ac{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[a,h]=this.parallels=r.parallels||[29.5,45.5],f=Math.sin(an(a));this.n=(f+Math.sin(an(h)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(r,a){const{n:h,c:f,r0:_}=this,x=an(r-this.center[0]),w=an(a),D=Math.sqrt(f-2*h*Math.sin(w))/h;return{x:D*Math.sin(x*h),y:D*Math.cos(x*h)-_,z:0}}unproject(r,a){const{n:h,c:f,r0:_}=this,x=_+a;let w=Math.atan2(r,Math.abs(x))*Math.sign(x);x*h<0&&(w-=Math.PI*Math.sign(r)*Math.sign(x));const D=an(this.center[0])*h;w=fn(w,-Math.PI-D,Math.PI-D);const S=hn(or(w/h)+this.center[0],-180,180),P=Math.asin(hn((f-(r*r+x*x)*h*h)/(2*h),-1,1)),R=hn(or(P),-Lr,Lr);return new jn(S,R)}}const od=1.340264,Hf=-.081106,sd=893e-6,ad=.003796,ld=Math.sqrt(3)/2;class HD extends Ac{project(r,a){a=a/180*Math.PI,r=r/180*Math.PI;const h=Math.asin(ld*Math.sin(a)),f=h*h,_=f*f*f;return{x:.5*(r*Math.cos(h)/(ld*(od+3*Hf*f+_*(7*sd+9*ad*f)))/Math.PI+.5),y:1-.5*(h*(od+Hf*f+_*(sd+ad*f))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let h=a=(2*(1-a)-1)*Math.PI,f=h*h,_=f*f*f;for(let P,R,O,N=0;N<12&&(R=h*(od+Hf*f+_*(sd+ad*f))-a,O=od+3*Hf*f+_*(7*sd+9*ad*f),P=R/O,h=hn(h-P,-Math.PI/3,Math.PI/3),f=h*h,_=f*f*f,!(Math.abs(P)<1e-12));++N);const x=ld*r*(od+3*Hf*f+_*(7*sd+9*ad*f))/Math.cos(h),w=Math.asin(Math.sin(h)/ld),D=hn(180*x/Math.PI,-180,180),S=hn(180*w/Math.PI,-Lr,Lr);return new jn(D,S)}}class C_ extends Ac{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){return{x:.5+r/360,y:.5-a/360,z:0}}unproject(r,a){const h=360*(r-.5),f=hn(360*(.5-a),-Lr,Lr);return new jn(h,f)}}const cd=Math.PI/2;function E_(s){return Math.tan((cd+s)/2)}class Qe extends Ac{constructor(r){super(r),this.center=r.center||[0,30];const[a,h]=this.parallels=r.parallels||[30,30];let f=an(a),_=an(h);this.southernCenter=f+_<0,this.southernCenter&&(f=-f,_=-_);const x=Math.cos(f),w=E_(f);this.n=f===_?Math.sin(f):Math.log(x/Math.cos(_))/Math.log(E_(_)/w),this.f=x*Math.pow(E_(f),this.n)/this.n}project(r,a){a=an(a),this.southernCenter&&(a=-a),r=an(r-this.center[0]);const h=1e-6,{n:f,f:_}=this;_>0?a<-cd+h&&(a=-cd+h):a>cd-h&&(a=cd-h);const x=_/Math.pow(E_(a),f);let w=x*Math.sin(f*r),D=_-x*Math.cos(f*r);return w=.5*(w/Math.PI+.5),D=.5*(D/Math.PI+.5),{x:w,y:this.southernCenter?D:1-D,z:0}}unproject(r,a){r=(2*r-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:h,f}=this,_=f-a,x=Math.sign(_),w=Math.sign(h)*Math.sqrt(r*r+_*_);let D=Math.atan2(r,Math.abs(_))*x;_*h<0&&(D-=Math.PI*Math.sign(r)*x);const S=hn(or(D/h)+this.center[0],-180,180),P=hn(or(2*Math.atan(Math.pow(f/w,1/h))-cd),-Lr,Lr);return new jn(S,this.southernCenter?-P:P)}}class D_ extends Ac{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,a){return{x:Ci(r),y:Zo(a),z:0}}unproject(r,a){const h=Xo(r),f=Or(a);return new jn(h,f)}}const S0=an(Lr);class M0 extends Ac{project(r,a){const h=(a=an(a))*a,f=h*h;return{x:.5*((r=an(r))*(.8707-.131979*h+f*(f*(.003971*h-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+h*(.015085+f*(.028874*h-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let h=a=(2*(1-a)-1)*Math.PI,f=25,_=0,x=h*h;do{x=h*h;const S=x*x;_=(h*(1.007226+x*(.015085+S*(.028874*x-.044475-.005916*S)))-a)/(1.007226+x*(.045255+S*(.259866*x-.311325-.005916*11*S))),h=hn(h-_,-S0,S0)}while(Math.abs(_)>1e-6&&--f>0);x=h*h;const w=hn(or(r/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),D=or(h);return new jn(w,D)}}const I0=an(Lr);class ow extends Ac{project(r,a){a=an(a),r=an(r);const h=Math.cos(a),f=2/Math.PI,_=Math.acos(h*Math.cos(r/2)),x=Math.sin(_)/_,w=.5*(r*f+2*h*Math.sin(r/2)/x)||0,D=.5*(a+Math.sin(a)/x)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(D/Math.PI+1),z:0}}unproject(r,a){let h=r=(2*r-.5)*Math.PI,f=a=(2*(1-a)-1)*Math.PI,_=25;const x=1e-6;let w=0,D=0;do{const S=Math.cos(f),P=Math.sin(f),R=2*P*S,O=P*P,N=S*S,B=Math.cos(h/2),$=Math.sin(h/2),Z=2*B*$,te=$*$,ce=1-N*B*B,ne=ce?1/ce:0,ae=ce?Math.acos(S*B)*Math.sqrt(1/ce):0,pe=.5*(2*ae*S*$+2*h/Math.PI)-r,he=.5*(ae*P+f)-a,Me=.5*ne*(N*te+ae*S*B*O)+1/Math.PI,Ee=ne*(Z*R/4-ae*P*$),Oe=.125*ne*(R*$-ae*P*N*Z),Ge=.5*ne*(O*B+ae*te*S)+.5,Ae=Ee*Oe-Ge*Me;w=(he*Ee-pe*Ge)/Ae,D=(pe*Oe-he*Me)/Ae,h=hn(h-w,-Math.PI,Math.PI),f=hn(f-D,-I0,I0)}while((Math.abs(w)>x||Math.abs(D)>x)&&--_>0);return new jn(or(h),or(f))}}class Gf extends Ac{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(an(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){const{scale:h,cosPhi:f}=this;return{x:an(r)*f*h+.5,y:-Math.sin(an(a))/f*h+.5,z:0}}unproject(r,a){const{scale:h,cosPhi:f}=this,_=-(a-.5)/h,x=hn(or((r-.5)/h)/f,-180,180),w=Math.asin(hn(_*f,-1,1)),D=hn(or(w),-Lr,Lr);return new jn(x,D)}}class ud extends D_{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,a,h){const f=Bh(r,a,h);return yi(f,f,gf(Nl(h))),{x:f[0],y:f[1],z:f[2]}}locationPoint(r,a){const h=wu(a.lat,a.lng),f=mo([],h),_=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(a),r._centerAltitude):r._centerAltitude;df(h,h,f,Bs(1,0)*St*_);const x=To(new Float64Array(16));return Rr(x,r.pixelMatrix,r.globeMatrix),yi(h,h,x),new st(h[0],h[1])}pixelsPerMeter(r,a){return Bs(1,0)*a}pixelSpaceConversion(r,a,h){const f=Bs(1,r)*a,_=mn(Bs(1,45)*a,f,h);return this.pixelsPerMeter(r,a)/_}createTileMatrix(r,a,h){const f=Vg(Nl(h.canonical));return Rr(new Float64Array(16),r.globeMatrix,f)}createInversionMatrix(r,a){const{center:h}=r,f=gf(Nl(a));return vc(f,f,an(h.lng)),kh(f,f,an(h.lat)),yc(f,f,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(r,a,h,f){return g1(r,a,h,!0)||new Vh(0,0)}pointCoordinate3D(r,a,h){const f=this.pointCoordinate(r,a,h,0);return[f.x,f.y,f.z]}isPointAboveHorizon(r,a){return!g1(r,a.x,a.y,!1)}farthestPixelDistance(r){const a=function(f,_){const x=f.cameraToCenterDistance,w=f._centerAltitude*_,D=f._camera,S=f._camera.forward(),P=xc([],ms([],S,-x),[0,0,w]),R=f.worldSize/(2*Math.PI),O=[0,0,-R],N=f.width/f.height,B=Math.tan(f.fovAboveCenter),$=ms([],D.up(),B),Z=ms([],D.right(),B*N),te=mo([],xc([],xc([],S,$),Z)),ce=[];let ne;if(new Og(P,te).closestPointOnSphere(O,R,ce)){const ae=xc([],ce,O),pe=So([],ae,P);ne=Math.cos(f.fovAboveCenter)*vu(pe)}else{const ae=So([],P,O),pe=So([],O,P);mo(pe,pe);const he=vu(ae)-R;ne=Math.sqrt(he*(he+2*R));const Me=Math.acos(ne/(R+he))-Math.acos(qo(S,pe));ne*=Math.cos(Me)}return 1.01*ne}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),h=Cc(r.zoom);if(h>0){const f=T0(r,Bs(1,r.center.lat)*r.worldSize),_=r.worldSize/(2*Math.PI),x=Math.max(r.width,r.height)/r.worldSize*Math.PI;return mn(a,f+_*(1-Math.cos(x)),Math.pow(h,10))}return a}upVector(r,a,h){return Bh(a,h,r,1)}upVectorScale(r){return{metersToTile:Ng(Yr(Nl(r)))}}}function ym(s){const r=s.parallels,a=!!r&&Math.abs(r[0]+r[1])<.01;switch(s.name){case"mercator":return new D_(s);case"equirectangular":return new C_(s);case"naturalEarth":return new M0(s);case"equalEarth":return new HD(s);case"winkelTripel":return new ow(s);case"albers":return a?new Gf(s):new rw(s);case"lambertConformalConic":return a?new Gf(s):new Qe(s);case"globe":return new ud(s)}throw new Error(`Invalid projection name: ${s.name}`)}const Wf=o_.types,T_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Pu(s,r,a,h,f,_,x,w,D,S,P,R,O){const N=w?Math.min(gs,Math.round(w[0])):0,B=w?Math.min(gs,Math.round(w[1])):0;s.emplaceBack(r,a,Math.round(32*h),Math.round(32*f),_,x,(N<<1)+(D?1:0),B,16*S,16*P,256*R,256*O)}function qf(s,r,a,h,f,_,x){s.emplaceBack(r,a,h,f,_,x)}function hd(s,r,a,h,f){s.emplaceBack(r,a,h,f),s.emplaceBack(r,a,h,f),s.emplaceBack(r,a,h,f),s.emplaceBack(r,a,h,f)}function S_(s){for(const r of s.sections)if(Tg(r.text))return!0;return!1}class Zf{constructor(r){this.layoutVertexArray=new $e,this.indexArray=new vt,this.programConfigurations=r,this.segments=new $i,this.dynamicLayoutVertexArray=new We,this.opacityVertexArray=new _t,this.placedSymbolArray=new wi,this.globeExtVertexArray=new qe}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,a,h,f){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Jv.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Su.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,T_,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,Qv.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||f)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}pt(Zf,"SymbolBuffers");class vm{constructor(r,a,h){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new h,this.segments=new $i,this.collisionVertexArray=new dn,this.collisionVertexArrayExt=new sn}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,j1.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,l_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}pt(vm,"CollisionBuffers");class qa{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(x=>x.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=To([]),this.placementViewportMatrix=To([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vs(this.zoom,a["text-size"]),this.iconSizeData=Vs(this.zoom,a["icon-size"]);const h=this.layers[0].layout,f=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==_&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===_||"auto"===_&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(x=>Fr[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new Zf(new zl(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Zf(new zl(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new Zr,this.lineVertexArray=new mu,this.symbolInstances=new ci}calculateGlyphDependencies(r,a,h,f,_){for(let x=0;x<r.length;x++)if(a[r.charCodeAt(x)]=!0,f&&_){const w=Yh[r.charAt(x)];w&&(a[w.charCodeAt(0)]=!0)}}populate(r,a,h,f){const _=this.layers[0],x=_.layout,w="globe"===this.projection.name,D=x.get("text-font"),S=x.get("text-field"),P=x.get("icon-image"),R=("constant"!==S.value.kind||S.value.value instanceof zi&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&("constant"!==D.value.kind||D.value.value.length>0),O="constant"!==P.value.kind||!!P.value.value||Object.keys(P.parameters).length>0,N=x.get("symbol-sort-key");if(this.features=[],!R&&!O)return;const B=a.iconDependencies,$=a.glyphDependencies,Z=a.availableImages,te=new k(this.zoom);for(const{feature:ce,id:ne,index:ae,sourceLayerIndex:pe}of r){const he=_._featureFilter.needGeometry,Me=Cu(ce,he);if(!_._featureFilter.filter(te,Me,h))continue;if(he||(Me.geometry=Bl(ce,h,f)),w&&1!==ce.type&&h.z<=5){const Ae=Me.geometry,Be=.98078528056,Ve=(He,Ke)=>qo(Bh(He.x,He.y,h,1),Bh(Ke.x,Ke.y,h,1))<Be;for(let He=0;He<Ae.length;He++)Ae[He]=Wg(Ae[He],Ve)}let Ee,Oe;if(R){const Ae=_.getValueAndResolveTokens("text-field",Me,h,Z),Be=zi.factory(Ae);S_(Be)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===E()||this.hasRTLText&&I.isParsed())&&(Ee=H1(Be,_,Me))}if(O){const Ae=_.getValueAndResolveTokens("icon-image",Me,h,Z);Oe=Ae instanceof as?Ae:as.fromString(Ae)}if(!Ee&&!Oe)continue;const Ge=this.sortFeaturesByKey?N.evaluate(Me,{},h):void 0;if(this.features.push({id:ne,text:Ee,icon:Oe,index:ae,sourceLayerIndex:pe,geometry:Me.geometry,properties:ce.properties,type:Wf[ce.type],sortKey:Ge}),Oe&&(B[Oe.name]=!0),Ee){const Ae=D.evaluate(Me,{},h).join(","),Be="map"===x.get("text-rotation-alignment")&&"point"!==x.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fr.vertical)>=0;for(const Ve of Ee.sections)if(Ve.image)B[Ve.image.name]=!0;else{const He=Al(Ee.toString()),Ke=Ve.fontStack||Ae,Le=$[Ke]=$[Ke]||{};this.calculateGlyphDependencies(Ve.text,Le,Be,this.allowVerticalPlacement,He)}}}"line"===x.get("symbol-placement")&&(this.features=function(ce){const ne={},ae={},pe=[];let he=0;function Me(Ae){pe.push(ce[Ae]),he++}function Ee(Ae,Be,Ve){const He=ae[Ae];return delete ae[Ae],ae[Be]=He,pe[He].geometry[0].pop(),pe[He].geometry[0]=pe[He].geometry[0].concat(Ve[0]),He}function Oe(Ae,Be,Ve){const He=ne[Be];return delete ne[Be],ne[Ae]=He,pe[He].geometry[0].shift(),pe[He].geometry[0]=Ve[0].concat(pe[He].geometry[0]),He}function Ge(Ae,Be,Ve){const He=Ve?Be[0][Be[0].length-1]:Be[0][0];return`${Ae}:${He.x}:${He.y}`}for(let Ae=0;Ae<ce.length;Ae++){const Be=ce[Ae],Ve=Be.geometry,He=Be.text?Be.text.toString():null;if(!He){Me(Ae);continue}const Ke=Ge(He,Ve),Le=Ge(He,Ve,!0);if(Ke in ae&&Le in ne&&ae[Ke]!==ne[Le]){const rt=Oe(Ke,Le,Ve),dt=Ee(Ke,Le,pe[rt].geometry);delete ne[Ke],delete ae[Le],ae[Ge(He,pe[dt].geometry,!0)]=dt,pe[rt].geometry=null}else Ke in ae?Ee(Ke,Le,Ve):Le in ne?Oe(Ke,Le,Ve):(Me(Ae),ne[Ke]=he-1,ae[Le]=he-1)}return pe.filter(Ae=>Ae.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ce,ne)=>ce.sortKey-ne.sortKey)}update(r,a,h,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,a,this.layers,h,f),this.icon.programConfigurations.updatePaintArrays(r,a,this.layers,h,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ym(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const h=this.lineVertexArray.length;if(void 0!==r.segment)for(const{x:f,y:_}of a)this.lineVertexArray.emplaceBack(f,_);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,a,h,f,_,x,w,D,S,P,R,O,N,B){const $=r.indexArray,Z=r.layoutVertexArray,te=r.globeExtVertexArray,ce=r.segments.prepareSegment(4*a.length,Z,$,this.canOverlap?x.sortKey:void 0),ne=this.glyphOffsetArray.length,ae=ce.vertexLength,pe=this.allowVerticalPlacement&&w===Fr.vertical?Math.PI/2:0,he=x.text&&x.text.sections;for(let Ee=0;Ee<a.length;Ee++){const{tl:Oe,tr:Ge,bl:Ae,br:Be,tex:Ve,pixelOffsetTL:He,pixelOffsetBR:Ke,minFontScaleX:Le,minFontScaleY:rt,glyphOffset:dt,isSDF:ot,sectionIndex:Bt}=a[Ee],et=ce.vertexLength,Et=dt[1];if(Pu(Z,S.x,S.y,Oe.x,Et+Oe.y,Ve.x,Ve.y,h,ot,He.x,He.y,Le,rt),Pu(Z,S.x,S.y,Ge.x,Et+Ge.y,Ve.x+Ve.w,Ve.y,h,ot,Ke.x,He.y,Le,rt),Pu(Z,S.x,S.y,Ae.x,Et+Ae.y,Ve.x,Ve.y+Ve.h,h,ot,He.x,Ke.y,Le,rt),Pu(Z,S.x,S.y,Be.x,Et+Be.y,Ve.x+Ve.w,Ve.y+Ve.h,h,ot,Ke.x,Ke.y,Le,rt),D){const{x:Vt,y:Cn,z:jt}=D.anchor,[It,ti,$t]=D.up;qf(te,Vt,Cn,jt,It,ti,$t),qf(te,Vt,Cn,jt,It,ti,$t),qf(te,Vt,Cn,jt,It,ti,$t),qf(te,Vt,Cn,jt,It,ti,$t),hd(r.dynamicLayoutVertexArray,Vt,Cn,jt,pe)}else hd(r.dynamicLayoutVertexArray,S.x,S.y,S.z,pe);$.emplaceBack(et,et+1,et+2),$.emplaceBack(et+1,et+2,et+3),ce.vertexLength+=4,ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),Ee!==a.length-1&&Bt===a[Ee+1].sectionIndex||r.programConfigurations.populatePaintArrays(Z.length,x,x.index,{},N,B,he&&he[Bt])}const Me=D?D.anchor:S;r.placedSymbolArray.emplaceBack(Me.x,Me.y,Me.z,S.x,S.y,ne,this.glyphOffsetArray.length-ne,ae,P,R,S.segment,h?h[0]:0,h?h[1]:0,f[0],f[1],w,0,!1,0,O,0)}_commitLayoutVertex(r,a,h,f,_,x,w){r.emplaceBack(a,h,f,_,x,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(r,a,h,f,_,x,w){const D=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),S=D.vertexLength,P=w.tileAnchorX,R=w.tileAnchorY;for(let N=0;N<4;N++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(a,-r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(a,r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(a,r.padding,r.padding),h.collisionVertexArrayExt.emplaceBack(a,-r.padding,r.padding),this._commitLayoutVertex(h.layoutVertexArray,f,_,x,P,R,new st(r.x1,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,f,_,x,P,R,new st(r.x2,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,f,_,x,P,R,new st(r.x2,r.y2)),this._commitLayoutVertex(h.layoutVertexArray,f,_,x,P,R,new st(r.x1,r.y2)),D.vertexLength+=4;const O=h.indexArray;O.emplaceBack(S,S+1),O.emplaceBack(S+1,S+2),O.emplaceBack(S+2,S+3),O.emplaceBack(S+3,S),D.primitiveLength+=4}_addTextDebugCollisionBoxes(r,a,h,f,_,x){for(let w=f;w<_;w++){const D=h.get(w),S=this.getSymbolInstanceTextSize(r,x,a,w);this._addCollisionDebugVertices(D,S,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(r,a,h,f,_,x){for(let w=f;w<_;w++){const D=h.get(w),S=this.getSymbolInstanceIconSize(r,a,x.placedIconSymbolIndex);this._addCollisionDebugVertices(D,S,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,x)}}generateCollisionDebugBuffers(r,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vm(mt,zf.members,Si),this.iconCollisionBox=new vm(mt,zf.members,Si);const h=Tc(this.iconSizeData,r),f=Tc(this.textSizeData,r);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(f,r,a,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(f,r,a,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,r,a,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,r,a,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(r,a,h,f){const _=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:f),x=Nf(this.textSizeData,r,_)/er;return this.tilePixelRatio*x}getSymbolInstanceIconSize(r,a,h){const f=this.icon.placedSymbolArray.get(h),_=Nf(this.iconSizeData,r,f);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(r,a,h){r.emplaceBack(a,-h,-h),r.emplaceBack(a,h,-h),r.emplaceBack(a,h,h),r.emplaceBack(a,-h,h)}_updateTextDebugCollisionBoxes(r,a,h,f,_,x){for(let w=f;w<_;w++){const D=h.get(w),S=this.getSymbolInstanceTextSize(r,x,a,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,D.padding)}}_updateIconDebugCollisionBoxes(r,a,h,f,_,x){for(let w=f;w<_;w++){const D=h.get(w),S=this.getSymbolInstanceIconSize(r,a,x);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,D.padding)}}updateCollisionDebugBuffers(r,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Tc(this.iconSizeData,r),f=Tc(this.textSizeData,r);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(f,r,a,x.textBoxStartIndex,x.textBoxEndIndex,x),this._updateTextDebugCollisionBoxes(f,r,a,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._updateIconDebugCollisionBoxes(h,r,a,x.iconBoxStartIndex,x.iconBoxEndIndex,x.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(h,r,a,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,a,h,f,_,x,w,D,S){const P={};if(a<h){const{x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae,featureIndex:pe}=r.get(a);P.textBox={x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae},P.textFeatureIndex=pe}if(f<_){const{x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae,featureIndex:pe}=r.get(f);P.verticalTextBox={x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae},P.verticalTextFeatureIndex=pe}if(x<w){const{x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae,featureIndex:pe}=r.get(x);P.iconBox={x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae},P.iconFeatureIndex=pe}if(D<S){const{x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae,featureIndex:pe}=r.get(D);P.verticalIconBox={x1:R,y1:O,x2:N,y2:B,padding:$,projectedAnchorX:Z,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:ne,tileAnchorY:ae},P.verticalIconFeatureIndex=pe}return P}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,a){const h=r.placedSymbolArray.get(a),f=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<f;_+=4)r.indexArray.emplaceBack(_,_+1,_+2),r.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(r),h=Math.cos(r),f=[],_=[],x=[];for(let w=0;w<this.symbolInstances.length;++w){x.push(w);const D=this.symbolInstances.get(w);f.push(0|Math.round(a*D.tileAnchorX+h*D.tileAnchorY)),_.push(D.featureIndex)}return x.sort((w,D)=>f[w]-f[D]||_[D]-_[w]),x}addToSortKeyRanges(r,a){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===a?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const h=this.symbolInstances.get(a);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:S}=h;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&_!==f&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&x!==_&&x!==f&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}pt(qa,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),qa.MAX_GLYPHS=65535,qa.addDynamicAttributes=hd;const sw=new re({"symbol-placement":new U(ze.layout_symbol["symbol-placement"]),"symbol-spacing":new U(ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new U(ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Y(ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new U(ze.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new U(ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new U(ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new U(ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new U(ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new Y(ze.layout_symbol["icon-size"]),"icon-text-fit":new U(ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new U(ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new Y(ze.layout_symbol["icon-image"]),"icon-rotate":new Y(ze.layout_symbol["icon-rotate"]),"icon-padding":new U(ze.layout_symbol["icon-padding"]),"icon-keep-upright":new U(ze.layout_symbol["icon-keep-upright"]),"icon-offset":new Y(ze.layout_symbol["icon-offset"]),"icon-anchor":new Y(ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new U(ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new U(ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new U(ze.layout_symbol["text-rotation-alignment"]),"text-field":new Y(ze.layout_symbol["text-field"]),"text-font":new Y(ze.layout_symbol["text-font"]),"text-size":new Y(ze.layout_symbol["text-size"]),"text-max-width":new Y(ze.layout_symbol["text-max-width"]),"text-line-height":new Y(ze.layout_symbol["text-line-height"]),"text-letter-spacing":new Y(ze.layout_symbol["text-letter-spacing"]),"text-justify":new Y(ze.layout_symbol["text-justify"]),"text-radial-offset":new Y(ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new U(ze.layout_symbol["text-variable-anchor"]),"text-anchor":new Y(ze.layout_symbol["text-anchor"]),"text-max-angle":new U(ze.layout_symbol["text-max-angle"]),"text-writing-mode":new U(ze.layout_symbol["text-writing-mode"]),"text-rotate":new Y(ze.layout_symbol["text-rotate"]),"text-padding":new U(ze.layout_symbol["text-padding"]),"text-keep-upright":new U(ze.layout_symbol["text-keep-upright"]),"text-transform":new Y(ze.layout_symbol["text-transform"]),"text-offset":new Y(ze.layout_symbol["text-offset"]),"text-allow-overlap":new U(ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new U(ze.layout_symbol["text-ignore-placement"]),"text-optional":new U(ze.layout_symbol["text-optional"])});var M_={paint:new re({"icon-opacity":new Y(ze.paint_symbol["icon-opacity"]),"icon-color":new Y(ze.paint_symbol["icon-color"]),"icon-halo-color":new Y(ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new Y(ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Y(ze.paint_symbol["icon-halo-blur"]),"icon-translate":new U(ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new U(ze.paint_symbol["icon-translate-anchor"]),"text-opacity":new Y(ze.paint_symbol["text-opacity"]),"text-color":new Y(ze.paint_symbol["text-color"],{runtimeType:$r,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Y(ze.paint_symbol["text-halo-color"]),"text-halo-width":new Y(ze.paint_symbol["text-halo-width"]),"text-halo-blur":new Y(ze.paint_symbol["text-halo-blur"]),"text-translate":new U(ze.paint_symbol["text-translate"]),"text-translate-anchor":new U(ze.paint_symbol["text-translate-anchor"])}),layout:sw};class I_{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:sc,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pt(I_,"FormatSectionOverride",{omit:["defaultValue"]});class xm extends Va{constructor(r){super(r,M_)}recalculate(r,a){super.recalculate(r,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const f=[];for(const _ of h)f.indexOf(_)<0&&f.push(_);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,a,h,f){const _=this.layout.get(r).evaluate(a,{},h,f),x=this._unevaluatedLayout._values[r];return x.isDataDriven()||cu(x.value)||!_?_:(w=a.properties,_.replace(/{([^{}]+)}/g,(S,P)=>P in w?String(w[P]):""));var w}createBucket(r){return new qa(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of M_.paint.overridableProperties){if(!xm.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),h=new I_(a),f=new mh(h,a.property.specification);let _=null;_="constant"===a.value.kind||"source"===a.value.kind?new qd("source",f):new gh("composite",f,a.value.zoomStops,a.value._interpolationType),this.paint._values[r]=new J(a.property,_,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,h){return!(!this.layout||a.isDataDriven()||h.isDataDriven())&&xm.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const h=r.get("text-field"),f=M_.paint.properties[a];let _=!1;const x=w=>{for(const D of w)if(f.overrides&&f.overrides.hasOverride(D))return void(_=!0)};if("constant"===h.value.kind&&h.value.value instanceof zi)x(h.value.value.sections);else if("source"===h.value.kind){const w=S=>{_||(S instanceof ml&&Ti(S.value)===Hn?x(S.value.sections):S instanceof gl?x(S.sections):S.eachChild(w))},D=h.value;D._styleExpression&&w(D._styleExpression.expression)}return _}getProgramConfiguration(r){return new Fl(this,r)}}var A0={paint:new re({"background-color":new U(ze.paint_background["background-color"]),"background-pattern":new U(ze.paint_background["background-pattern"]),"background-opacity":new U(ze.paint_background["background-opacity"])})},P0={paint:new re({"raster-opacity":new U(ze.paint_raster["raster-opacity"]),"raster-hue-rotate":new U(ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new U(ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new U(ze.paint_raster["raster-brightness-max"]),"raster-saturation":new U(ze.paint_raster["raster-saturation"]),"raster-contrast":new U(ze.paint_raster["raster-contrast"]),"raster-resampling":new U(ze.paint_raster["raster-resampling"]),"raster-fade-duration":new U(ze.paint_raster["raster-fade-duration"])})};class aw extends Va{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var lw={paint:new re({"sky-type":new U(ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new U(ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new U(ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new U(ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new U(ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new ie(ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new U(ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new U(ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new U(ze.paint_sky["sky-opacity"])})};function ko(s,r,a){const h=[0,0,1],f=dv([]);return zh(f,f,a?-an(s)+Math.PI:an(s)),xu(f,f,-an(r)),Oh(h,h,f),mo(h,h)}const cw={circle:class extends Va{constructor(s){super(s,Sv)}createBucket(s){return new Hp(s)}queryRadius(s){const r=s;return Ec("circle-radius",this,r)+Ec("circle-stroke-width",this,r)+wf(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,a,h,f,_,x,w){const D=Tv(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a);return Yg(s,h,_,x,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),D,S)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new Fl(this,s)}},heatmap:class extends Va{createBucket(s){return new D1(s)}constructor(s){super(s,Jg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Ec("heatmap-radius",this,s)}queryIntersectsFeature(s,r,a,h,f,_,x,w){const D=this.paint.get("heatmap-radius").evaluate(r,a);return Yg(s,h,_,x,w,!0,!0,new st(0,0),D)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new Fl(this,s)}},hillshade:class extends Va{constructor(s){super(s,Zp)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Va{constructor(s){super(s,zD)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),a=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(s){return new Fl(this,s)}recalculate(s,r){super.recalculate(s,r);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new n_(s)}queryRadius(){return wf(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,a,h,f,_){return!s.queryGeometry.isAboveHorizon&&Zg(Gp(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends Va{constructor(s){super(s,N1)}createBucket(s){return new qh(s)}queryRadius(){return wf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new Fl(this,s)}queryIntersectsFeature(s,r,a,h,f,_,x,w,D){const S=Tv(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(r,a),R=this.paint.get("fill-extrusion-base").evaluate(r,a),O=[0,0],N=w&&_.elevation,B=_.elevation?_.elevation.exaggeration():1,$=s.tile.getBucket(this);if(N&&$ instanceof qh){const ae=$.centroidVertexArray,pe=D+1;pe<ae.length&&(O[0]=ae.geta_centroid_pos0(pe),O[1]=ae.geta_centroid_pos1(pe))}if(0===O[0]&&1===O[1])return!1;"globe"===_.projection.name&&(h=Zh([h],[new st(0,0),new st(St,St)],s.tileID.canonical).map(ae=>ae.polygon).flat());const Z=N?w:null,[te,ce]=(pe=h,he=R,Me=P,Ee=S,Oe=x,Ge=Z,Ae=O,Be=B,Ve=_.center.lat,"globe"===(ae=_).projection.name?function(Ke,Le,rt,dt,ot,Bt,et,Et,Vt,Cn,jt){const It=[],ti=[],$t=Ke.projection.upVectorScale(jt,Ke.center.lat,Ke.worldSize).metersToTile,Wt=[0,0,0,1],Wn=[0,0,0,1],qt=(Fn,xt,di,Bi)=>{Fn[0]=xt,Fn[1]=di,Fn[2]=Bi,Fn[3]=1},ni=$v();rt>0&&(rt+=ni),dt+=ni;for(const Fn of Le){const xt=[],di=[];for(const Bi of Fn){const ft=Bi.x+ot.x,gt=Bi.y+ot.y,Xt=Ke.projection.projectTilePoint(ft,gt,jt),vi=Ke.projection.upVector(jt,Bi.x,Bi.y);let wn=rt,xi=dt;if(et){const qn=a_(ft,gt,rt,dt,et,Et,Vt,Cn);wn+=qn.base,xi+=qn.top}0!==rt?qt(Wt,Xt.x+vi[0]*$t*wn,Xt.y+vi[1]*$t*wn,Xt.z+vi[2]*$t*wn):qt(Wt,Xt.x,Xt.y,Xt.z),qt(Wn,Xt.x+vi[0]*$t*xi,Xt.y+vi[1]*$t*xi,Xt.z+vi[2]*$t*xi),yi(Wt,Wt,Bt),yi(Wn,Wn,Bt),xt.push(new Lf(Wt[0],Wt[1],Wt[2])),di.push(new Lf(Wn[0],Wn[1],Wn[2]))}It.push(xt),ti.push(di)}return[It,ti]}(ae,pe,he,Me,Ee,Oe,Ge,Ae,Be,Ve,s.tileID.canonical):Ge?function(Ke,Le,rt,dt,ot,Bt,et,Et,Vt){const Cn=[],jt=[],It=[0,0,0,1];for(const ti of Ke){const $t=[],Wt=[];for(const Wn of ti){const qt=Wn.x+dt.x,ni=Wn.y+dt.y,Fn=a_(qt,ni,Le,rt,Bt,et,Et,Vt);It[0]=qt,It[1]=ni,It[2]=Fn.base,It[3]=1,bc(It,It,ot),It[3]=Math.max(It[3],1e-5);const xt=new Lf(It[0]/It[3],It[1]/It[3],It[2]/It[3]);It[0]=qt,It[1]=ni,It[2]=Fn.top,It[3]=1,bc(It,It,ot),It[3]=Math.max(It[3],1e-5);const di=new Lf(It[0]/It[3],It[1]/It[3],It[2]/It[3]);$t.push(xt),Wt.push(di)}Cn.push($t),jt.push(Wt)}return[Cn,jt]}(pe,he,Me,Ee,Oe,Ge,Ae,Be,Ve):function(Ke,Le,rt,dt,ot){const Bt=[],et=[],Et=ot[8]*Le,Vt=ot[9]*Le,Cn=ot[10]*Le,jt=ot[11]*Le,It=ot[8]*rt,ti=ot[9]*rt,$t=ot[10]*rt,Wt=ot[11]*rt;for(const Wn of Ke){const qt=[],ni=[];for(const Fn of Wn){const xt=Fn.x+dt.x,di=Fn.y+dt.y,Bi=ot[0]*xt+ot[4]*di+ot[12],ft=ot[1]*xt+ot[5]*di+ot[13],gt=ot[2]*xt+ot[6]*di+ot[14],Xt=ot[3]*xt+ot[7]*di+ot[15],vi=Bi+Et,wn=ft+Vt,xi=gt+Cn,qn=Math.max(Xt+jt,1e-5),xr=Bi+It,fi=ft+ti,hr=gt+$t,Gi=Math.max(Xt+Wt,1e-5);qt.push(new Lf(vi/qn,wn/qn,xi/qn)),ni.push(new Lf(xr/Gi,fi/Gi,hr/Gi))}Bt.push(qt),et.push(ni)}return[Bt,et]}(pe,he,Me,Ee,Oe)),ne=s.queryGeometry;var ae,pe,he,Me,Ee,Oe,Ge,Ae,Be,Ve;return function(ae,pe,he){let Me=1/0;Zg(he,pe)&&(Me=Ff(he,pe[0]));for(let Ee=0;Ee<pe.length;Ee++){const Oe=pe[Ee],Ge=ae[Ee];for(let Ae=0;Ae<Oe.length-1;Ae++){const Be=Oe[Ae],Ve=[Be,Oe[Ae+1],Ge[Ae+1],Ge[Ae],Be];Eu(he,Ve)&&(Me=Math.min(Me,Ff(he,Ve)))}}return Me!==1/0&&Me}(te,ce,ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},line:class extends Va{constructor(s){super(s,cm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof tu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=Kv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Xh(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new Fl(this,s)}queryRadius(s){const r=s,a=um(Ec("line-width",this,r),Ec("line-gap-width",this,r)),h=Ec("line-offset",this,r);return a/2+Math.abs(h)+wf(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,a,h,f,_){if(s.queryGeometry.isAboveHorizon)return!1;const x=Gp(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),w=s.pixelToTileUnitsFactor/2*um(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),D=this.paint.get("line-offset").evaluate(r,a);return D&&(h=function(S,P){const R=[],O=new st(0,0);for(let N=0;N<S.length;N++){const B=S[N],$=[];for(let Z=0;Z<B.length;Z++){const te=B[Z],ce=B[Z+1],ne=0===Z?O:te.sub(B[Z-1])._unit()._perp(),ae=Z===B.length-1?O:ce.sub(te)._unit()._perp(),pe=ne._add(ae)._unit();pe._mult(1/(pe.x*ae.x+pe.y*ae.y)),$.push(pe._mult(P)._add(te))}R.push($)}return R}(h,D*s.pixelToTileUnitsFactor)),function(S,P,R){for(let O=0;O<P.length;O++){const N=P[O];if(S.length>=3)for(let B=0;B<N.length;B++)if(Du(S,N[B]))return!0;if(b1(S,N,R))return!0}return!1}(x,h,w)}isTileClipped(){return!0}},symbol:xm,background:class extends Va{constructor(s){super(s,A0)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Va{constructor(s){super(s,P0)}getProgramIds(){return["raster"]}},sky:class extends Va{constructor(s){super(s,lw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=qp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(s,r){if("atmosphere"===this.paint.get("sky-type")){const h=this.paint.get("sky-atmosphere-sun"),f=!h,_=s.style.light,x=_.properties.get("position");return f&&"viewport"===_.properties.get("anchor")&&ui("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?ko(x.azimuthal,90-x.polar,r):ko(h[0],90-h[1],r)}const a=this.paint.get("sky-gradient-center");return ko(a[0],90-a[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}};class Xf{constructor(r,a,h,f){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(a,f)}update(r,a,h){const{width:f,height:_}=r,{context:x}=this,{gl:w}=x,{HTMLImageElement:D,HTMLCanvasElement:S,HTMLVideoElement:P,ImageData:R,ImageBitmap:O}=Ue;if(w.bindTexture(w.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!a||!1!==a.premultiply)),h||this.size&&this.size[0]===f&&this.size[1]===_){const{x:N,y:B}=h||{x:0,y:0};r instanceof D||r instanceof S||r instanceof P||r instanceof R||O&&r instanceof O?w.texSubImage2D(w.TEXTURE_2D,0,N,B,w.RGBA,w.UNSIGNED_BYTE,r):w.texSubImage2D(w.TEXTURE_2D,0,N,B,f,_,w.RGBA,w.UNSIGNED_BYTE,r.data)}else this.size=[f,_],r instanceof D||r instanceof S||r instanceof P||r instanceof R||O&&r instanceof O?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,r):w.texImage2D(w.TEXTURE_2D,0,this.format,f,_,0,this.format,w.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(r,a){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),r!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?r===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:r),this.filter=r),a!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class GD{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class A_{constructor(){this.tasks={},this.taskQueue=[],Yn(["process"],this),this.invoker=new GD(this.process),this.nextId=0}add(r,a){const h=this.nextId++,f=function({type:_,isSymbolTile:x,zoom:w}){return w=w||0,"message"===_?0:"maybePrepare"!==_||x?"parseTile"!==_||x?"parseTile"===_&&x?300-w:"maybePrepare"===_&&x?400-w:500:200-w:100-w}(a);if(0===f){Da();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:r,metadata:a,priority:f,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){Da();try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const a=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let r=null,a=1/0;for(let f=0;f<this.taskQueue.length;f++){const _=this.tasks[this.taskQueue[f]];_.priority<a&&(a=_.priority,r=f)}if(null===r)return null;const h=this.taskQueue[r];return this.taskQueue.splice(r,1),h}remove(){this.invoker.remove()}}class P_{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const h=r[a];this._stringToNumber[h]=a,this._numberToString[a]=h}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const uw=["tile","layer","source","sourceLayer","state"];class k0{constructor(r,a,h,f,_){this.type="Feature",this._vectorTileFeature=r,this._z=a,this._x=h,this._y=f,this.properties=r.properties,this.id=_}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(r.id=this.id);for(const a of uw)void 0!==this[a]&&(r[a]=this[a]);return r}}const Us=32,ma=33,Pc=new Uint16Array(8184);for(let s=0;s<2046;s++){let r=s+2,a=0,h=0,f=0,_=0,x=0,w=0;for(1&r?f=_=x=Us:a=h=w=Us;(r>>=1)>1;){const S=a+f>>1,P=h+_>>1;1&r?(f=a,_=h,a=x,h=w):(a=f,h=_,f=x,_=w),x=S,w=P}const D=4*s;Pc[D+0]=a,Pc[D+1]=h,Pc[D+2]=f,Pc[D+3]=_}const Za=new Uint16Array(2178),Xa=new Uint8Array(1089),bm=new Uint16Array(1089);function R0(s){return 0===s?-.03125:32===s?.03125:0}var O0=xe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const L0={type:2,extent:St,loadGeometry:()=>[[new st(0,0),new st(St+1,0),new st(St+1,St+1),new st(0,St+1),new st(0,0)]]};class k_{constructor(r,a,h,f,_){this.tileID=r,this.uid=ro(),this.uses=0,this.tileSize=a,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(r){const a=r+this.timeAdded;a<ss.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Au(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,a,h){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(f,_){const x={};if(!_)return x;for(const w of f){const D=w.layerIds.map(S=>_.getLayer(S)).filter(Boolean);if(0!==D.length){w.layers=D,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(S=>D.filter(P=>P.id===S)[0]));for(const S of D)x[S.id]=w}}return x}(r.buckets,a.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof qa){if(this.hasSymbolBuckets=!0,!h)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof qa&&_.hasRTLText){this.hasRTLText=!0,I.isLoading()||I.isLoaded()||"deferred"!==E()||M();break}}this.queryPadding=0;for(const f in this.buckets){const _=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(_))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Gn}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const h in this.buckets){const f=this.buckets[h];f.uploadPending()&&f.upload(r)}const a=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Xf(r,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Xf(r,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Xf(r,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,a,h,f,_,x,w,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:w,transform:x,params:_,tileTransform:this.tileTransform},r,a,h):{}}querySourceFeatures(r,a){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const f=h.loadVTLayers(),_=a?a.sourceLayer:"",x=f._geojsonTileLayer||f[_];if(!x)return;const w=uu(a&&a.filter),{z:D,x:S,y:P}=this.tileID.canonical,R={z:D,x:S,y:P};for(let O=0;O<x.length;O++){const N=x.feature(O);if(w.needGeometry){const Z=Cu(N,!0);if(!w.filter(new k(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!w.filter(new k(this.tileID.overscaledZ),N))continue;const B=h.getId(N,_),$=new k0(N,D,S,P,B);$.tile=R,r.push($)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const a=this.expirationTime;if(r.cacheControl){const h=No(r.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const h=Date.now();let f=!1;if(this.expirationTime>h)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{const _=this.expirationTime-a;_?this.expirationTime=h+Math.max(_,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!a)return;const h=this.latestFeatureIndex.loadVTLayers(),f=a.style.listImages();for(const _ in this.buckets){if(!a.style.hasLayer(_))continue;const x=this.buckets[_],w=x.layers[0].sourceLayer||"_geojsonTileLayer",D=h[w],S=r[w];if(!D||!S||0===Object.keys(S).length)continue;if(x.update(S,D,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),x instanceof Xh||x instanceof n_){const R=a.style._getSourceCache(x.layers[0].source);a._terrain&&a._terrain.enabled&&R&&x.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(R.id,this.tileID)}const P=a&&a.style&&a.style.getLayer(_);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(x)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ss.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=ss.now()+r}setTexture(r,a){const h=a.context,f=h.gl;this.texture=this.texture||a.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new Xf(h,r,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(r,a){const h={};for(const f of a)h[f]=!0;this.dependencies[r]=h}hasDependency(r,a){for(const h of r){const f=this.dependencies[h];if(f)for(const _ of a)if(f[_])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const h=Bl(L0,this.tileID.canonical,this.tileTransform)[0],f=new Xe,_=new Do;for(let x=0;x<h.length;x++){const{x:w,y:D}=h[x];f.emplaceBack(w,D),_.emplaceBack(x)}_.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(_),this._tileDebugBuffer=r.createVertexBuffer(f,Vp.members),this._tileDebugSegments=$i.simpleSegment(0,0,f.length,_.length)}_makeTileBoundsBuffers(r,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const h=Bl(L0,this.tileID.canonical,this.tileTransform)[0];let f,_;if(this.isRaster){const x=function(w,D){const S=Au(w,D),P=Math.pow(2,w.z);for(let Z=0;Z<ma;Z++)for(let te=0;te<ma;te++){const ce=Xo((w.x+(te+R0(te))/Us)/P),ne=Or((w.y+(Z+R0(Z))/Us)/P),ae=D.project(ce,ne),pe=Z*ma+te;Za[2*pe+0]=Math.round((ae.x*S.scale-S.x)*St),Za[2*pe+1]=Math.round((ae.y*S.scale-S.y)*St)}Xa.fill(0),bm.fill(0);for(let Z=2045;Z>=0;Z--){const te=4*Z,ce=Pc[te+0],ne=Pc[te+1],ae=Pc[te+2],pe=Pc[te+3],he=ce+ae>>1,Me=ne+pe>>1,Ee=he+Me-ne,Oe=Me+ce-he,Ge=ne*ma+ce,Ae=pe*ma+ae,Be=Me*ma+he,Ve=Math.hypot((Za[2*Ge+0]+Za[2*Ae+0])/2-Za[2*Be+0],(Za[2*Ge+1]+Za[2*Ae+1])/2-Za[2*Be+1])>=16;Xa[Be]=Xa[Be]||(Ve?1:0),Z<1022&&(Xa[Be]=Xa[Be]||Xa[(ne+Oe>>1)*ma+(ce+Ee>>1)]||Xa[(pe+Oe>>1)*ma+(ae+Ee>>1)])}const R=new je,O=new vt;let N=0;function B(Z,te){const ce=te*ma+Z;return 0===bm[ce]&&(R.emplaceBack(Za[2*ce+0],Za[2*ce+1],Z*St/Us,te*St/Us),bm[ce]=++N),bm[ce]-1}function $(Z,te,ce,ne,ae,pe){const he=Z+ce>>1,Me=te+ne>>1;if(Math.abs(Z-ae)+Math.abs(te-pe)>1&&Xa[Me*ma+he])$(ae,pe,Z,te,he,Me),$(ce,ne,ae,pe,he,Me);else{const Ee=B(Z,te),Oe=B(ce,ne),Ge=B(ae,pe);O.emplaceBack(Ee,Oe,Ge)}}return $(0,0,Us,Us,Us,0),$(Us,Us,0,0,0,Us),{vertices:R,indices:O}}(this.tileID.canonical,a);f=x.vertices,_=x.indices}else{f=new je,_=new vt;for(const{x:w,y:D}of h)f.emplaceBack(w,D,0,0);const x=e_(f.int16,void 0,4);for(let w=0;w<x.length;w+=3)_.emplaceBack(x[w],x[w+1],x[w+2])}this._tileBoundsBuffer=r.createVertexBuffer(f,O0.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(_),this._tileBoundsSegments=$i.simpleSegment(0,0,f.length,_.length)}_makeGlobeTileDebugBuffers(r,a){const h=a.projection;if(!h||"globe"!==h.name||a.freezeTileCoverage)return;const f=this.tileID.canonical,_=gf(_1(f,a)),x=Cc(a.zoom);let w;x>0&&(w=kg(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,f,a,_,w,x),this._makeGlobeTileDebugTextBuffer(r,f,a,_,w,x)}_globePoint(r,a,h,f,_,x,w){let D=Bh(r,a,h);if(x){const S=1<<h.z,P=Ci(f.center.lng),R=Zo(f.center.lat),O=(h.x+.5)/S-P;let N=0;O>.5?N=-1:O<-.5&&(N=1);let B=(r/St+h.x)/S+N,$=(a/St+h.y)/S;B=(B-P)*f._pixelsPerMercatorPixel+P,$=($-R)*f._pixelsPerMercatorPixel+R;const Z=[B*f.worldSize,$*f.worldSize,0];yi(Z,Z,x),D=Nh(D,Z,w)}return yi(D,D,_)}_makeGlobeTileDebugBorderBuffer(r,a,h,f,_,x){const w=new Xe,D=new Do,S=new Te,P=(O,N,B,$,Z)=>{const te=(B-O)/(Z-1),ce=($-N)/(Z-1),ne=w.length;for(let ae=0;ae<Z;ae++){const pe=O+ae*te,he=N+ae*ce;w.emplaceBack(pe,he);const Me=this._globePoint(pe,he,a,h,f,_,x);S.emplaceBack(Me[0],Me[1],Me[2]),D.emplaceBack(ne+ae)}},R=St;P(0,0,R,0,16),P(R,0,R,R,16),P(R,R,0,R,16),P(0,R,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(D),this._tileDebugBuffer=r.createVertexBuffer(w,Vp.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(S,fv.members),this._tileDebugSegments=$i.simpleSegment(0,0,w.length,D.length)}_makeGlobeTileDebugTextBuffer(r,a,h,f,_,x){const w=St/4,D=new Xe,S=new vt,P=new Te,R=25;S.reserve(32),D.reserve(R),P.reserve(R);const O=(N,B)=>R*N+B;for(let N=0;N<R;N++){const B=N*w;for(let $=0;$<R;$++){const Z=$*w;D.emplaceBack(Z,B);const te=this._globePoint(Z,B,a,h,f,_,x);P.emplaceBack(te[0],te[1],te[2])}}for(let N=0;N<4;N++)for(let B=0;B<4;B++){const $=O(N,B),Z=O(N,B+1),te=O(N+1,B),ce=O(N+1,B+1);S.emplaceBack($,Z,te),S.emplaceBack(te,Z,ce)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(S),this._tileDebugTextBuffer=r.createVertexBuffer(D,Vp.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(P,fv.members),this._tileDebugTextSegments=$i.simpleSegment(0,0,R,32)}}class Ya{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,h){const f=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][f]=this.stateChanges[r][f]||{},ki(this.stateChanges[r][f],h),null===this.deletedStates[r]){this.deletedStates[r]={};for(const _ in this.state[r])_!==f&&(this.deletedStates[r][_]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][f]){this.deletedStates[r][f]={};for(const _ in this.state[r][f])h[_]||(this.deletedStates[r][f][_]=null)}else for(const _ in h)this.deletedStates[r]&&this.deletedStates[r][f]&&null===this.deletedStates[r][f][_]&&delete this.deletedStates[r][f][_]}removeFeatureState(r,a,h){if(null===this.deletedStates[r])return;const f=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},h&&void 0!==a)null!==this.deletedStates[r][f]&&(this.deletedStates[r][f]=this.deletedStates[r][f]||{},this.deletedStates[r][f][h]=null);else if(void 0!==a)if(this.stateChanges[r]&&this.stateChanges[r][f])for(h in this.deletedStates[r][f]={},this.stateChanges[r][f])this.deletedStates[r][f][h]=null;else this.deletedStates[r][f]=null;else this.deletedStates[r]=null}getState(r,a){const h=String(a),f=ki({},(this.state[r]||{})[h],(this.stateChanges[r]||{})[h]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const _=this.deletedStates[r][a];if(null===_)return{};for(const x in _)delete f[x]}return f}initializeTileState(r,a){r.setFeatureState(this.state,a)}coalesceChanges(r,a){const h={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const _={};for(const x in this.stateChanges[f])this.state[f][x]||(this.state[f][x]={}),ki(this.state[f][x],this.stateChanges[f][x]),_[x]=this.state[f][x];h[f]=_}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const _={};if(null===this.deletedStates[f])for(const x in this.state[f])_[x]={},this.state[f][x]={};else for(const x in this.deletedStates[f]){if(null===this.deletedStates[f][x])this.state[f][x]={};else if(this.state[f][x])for(const w of Object.keys(this.deletedStates[f][x]))delete this.state[f][x][w];_[x]=this.state[f][x]}h[f]=h[f]||{},ki(h[f],_)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(h).length)for(const f in r)r[f].setFeatureState(h,a)}}class wm{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,a){const h=this.toIdx(r,a);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(r,a){return this.leaves[this.toIdx(r,a)]}toIdx(r,a){return a*this.size+r}}function F0(s,r,a,h){let f=0,_=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(h[x])<1e-15){if(a[x]<s[x]||a[x]>r[x])return null}else{const w=1/h[x];let D=(s[x]-a[x])*w,S=(r[x]-a[x])*w;if(D>S){const P=D;D=S,S=P}if(D>f&&(f=D),S<_&&(_=S),f>_)return null}return f}function z0(s,r,a,h,f,_,x,w,D,S,P){const R=h-s,O=f-r,N=_-a,B=x-s,$=w-r,Z=D-a,te=P[1]*Z-P[2]*$,ce=P[2]*B-P[0]*Z,ne=P[0]*$-P[1]*B,ae=R*te+O*ce+N*ne;if(Math.abs(ae)<1e-15)return null;const pe=1/ae,he=S[0]-s,Me=S[1]-r,Ee=S[2]-a,Oe=(he*te+Me*ce+Ee*ne)*pe;if(Oe<0||Oe>1)return null;const Ge=Me*N-Ee*O,Ae=Ee*R-he*N,Be=he*O-Me*R,Ve=(P[0]*Ge+P[1]*Ae+P[2]*Be)*pe;return Ve<0||Oe+Ve>1?null:(B*Ge+$*Ae+Z*Be)*pe}function R_(s,r,a){return(s-r)/(a-r)}function N0(s,r,a,h,f,_,x,w,D){const S=1<<a,P=_-h,R=x-f,O=(s+1)/S*P+h,N=(r+0)/S*R+f,B=(r+1)/S*R+f;w[0]=(s+0)/S*P+h,w[1]=N,D[0]=O,D[1]=B}class B0{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(_){const x=Math.ceil(Math.log2(_.dim/8)),w=[];let D=Math.ceil(Math.pow(2,x));const S=1/D,P=(N,B,$,Z,te)=>{const ce=Z?1:0,ne=(N+1)*$-ce,ae=B*$,pe=(B+1)*$-ce;te[0]=N*$,te[1]=ae,te[2]=ne,te[3]=pe};let R=new wm(D);const O=[];for(let N=0;N<D*D;N++){P(N%D,Math.floor(N/D),S,!1,O);const B=Ka(O[0],O[1],_),$=Ka(O[2],O[1],_),Z=Ka(O[2],O[3],_),te=Ka(O[0],O[3],_);R.minimums.push(Math.min(B,$,Z,te)),R.maximums.push(Math.max(B,$,Z,te)),R.leaves.push(1)}for(w.push(R),D/=2;D>=1;D/=2){const N=w[w.length-1];R=new wm(D);for(let B=0;B<D*D;B++){P(B%D,Math.floor(B/D),2,!0,O);const $=N.getElevation(O[0],O[1]),Z=N.getElevation(O[2],O[1]),te=N.getElevation(O[2],O[3]),ce=N.getElevation(O[0],O[3]),ne=N.isLeaf(O[0],O[1]),ae=N.isLeaf(O[2],O[1]),pe=N.isLeaf(O[2],O[3]),he=N.isLeaf(O[0],O[3]),Me=Math.min($.min,Z.min,te.min,ce.min),Ee=Math.max($.max,Z.max,te.max,ce.max),Oe=ne&&ae&&pe&&he;R.maximums.push(Ee),R.minimums.push(Me),R.leaves.push(Ee-Me<=5&&Oe?1:0)}w.push(R)}return w}(this.dem),h=a.length-1,f=a[h];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(a,0,0,h,0)}raycastRoot(r,a,h,f,_,x,w=1){return F0([r,a,-100],[h,f,this.maximums[0]*w],_,x)}raycast(r,a,h,f,_,x,w=1){if(!this.nodeCount)return null;const D=this.raycastRoot(r,a,h,f,_,x,w);if(null==D)return null;const S=[],P=[],R=[],O=[],N=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:B,t:$,nodex:Z,nodey:te,depth:ce}=N.pop();if(this.leaves[B]){N0(Z,te,ce,r,a,h,f,R,O);const ae=1<<ce,pe=(Z+0)/ae,he=(Z+1)/ae,Me=(te+0)/ae,Ee=(te+1)/ae,Oe=Ka(pe,Me,this.dem)*w,Ge=Ka(he,Me,this.dem)*w,Ae=Ka(he,Ee,this.dem)*w,Be=Ka(pe,Ee,this.dem)*w,Ve=z0(R[0],R[1],Oe,O[0],R[1],Ge,O[0],O[1],Ae,_,x),He=z0(O[0],O[1],Ae,R[0],O[1],Be,R[0],R[1],Oe,_,x),Ke=Math.min(null!==Ve?Ve:Number.MAX_VALUE,null!==He?He:Number.MAX_VALUE);if(Ke!==Number.MAX_VALUE)return Ke;{const Le=df([],_,x,$);if(V0(Oe,Ge,Be,Ae,R_(Le[0],R[0],O[0]),R_(Le[1],R[1],O[1]))>=Le[2])return $}continue}let ne=0;for(let ae=0;ae<this._siblingOffset.length;ae++){N0((Z<<1)+this._siblingOffset[ae][0],(te<<1)+this._siblingOffset[ae][1],ce+1,r,a,h,f,R,O),R[2]=-100,O[2]=this.maximums[this.childOffsets[B]+ae]*w;const pe=F0(R,O,_,x);if(null!=pe){const he=pe;S[ae]=he;let Me=!1;for(let Ee=0;Ee<ne&&!Me;Ee++)he>=S[P[Ee]]&&(P.splice(Ee,0,ae),Me=!0);Me||(P[ne]=ae),ne++}}for(let ae=0;ae<ne;ae++){const pe=P[ae];N.push({idx:this.childOffsets[B]+pe,t:S[pe],nodex:(Z<<1)+this._siblingOffset[pe][0],nodey:(te<<1)+this._siblingOffset[pe][1],depth:ce+1})}}return null}_addNode(r,a,h){return this.minimums.push(r),this.maximums.push(a),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(r,a,h,f,_){if(1===r[f].isLeaf(a,h))return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const x=f-1,w=r[x];let D=0,S=0;for(let P=0;P<this._siblingOffset.length;P++){const R=2*a+this._siblingOffset[P][0],O=2*h+this._siblingOffset[P][1],N=w.getElevation(R,O),B=w.isLeaf(R,O),$=this._addNode(N.min,N.max,B);B&&(D|=1<<P),S||(S=$)}for(let P=0;P<this._siblingOffset.length;P++)D&1<<P||this._construct(r,2*a+this._siblingOffset[P][0],2*h+this._siblingOffset[P][1],x,S+P)}}function V0(s,r,a,h,f,_){return mn(mn(s,a,_),mn(r,h,_),f)}function Ka(s,r,a){const h=a.dim,f=hn(s*h-.5,0,h-1),_=hn(r*h-.5,0,h-1),x=Math.floor(f),w=Math.floor(_),D=Math.min(x+1,h-1),S=Math.min(w+1,h-1);return V0(a.get(x,w),a.get(D,w),a.get(x,S),a.get(D,S),f-x,_-w)}const j0={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function hw(s,r,a){return(256*s*256+256*r+a)/10-1e4}function Cm(s,r,a){return 256*s+r+a/256-32768}class ku{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,a,h,f=!1,_=!1){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(h&&"mapbox"!==h&&"terrarium"!==h)return ui(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const x=this.dim=a.height-2,w=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=h||"mapbox",this.borderReady=f,!f){for(let D=0;D<x;D++)w[this._idx(-1,D)]=w[this._idx(0,D)],w[this._idx(x,D)]=w[this._idx(x-1,D)],w[this._idx(D,-1)]=w[this._idx(D,0)],w[this._idx(D,x)]=w[this._idx(D,x-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(x,-1)]=w[this._idx(x-1,0)],w[this._idx(-1,x)]=w[this._idx(0,x-1)],w[this._idx(x,x)]=w[this._idx(x-1,x-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new B0(this)}get(r,a,h=!1){h&&(r=hn(r,-1,this.dim),a=hn(a,-1,this.dim));const f=4*this._idx(r,a);return("terrarium"===this.encoding?Cm:hw)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(r){return j0[r]}get unpackVector(){return j0[this.encoding]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}static pack(r,a){const h=[0,0,0,0],f=ku.getUnpackVector(a);let _=Math.floor((r+f[3])/f[2]);return h[2]=_%256,_=Math.floor(_/256),h[1]=_%256,_=Math.floor(_/256),h[0]=_,h}getPixels(){return new Io({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,a,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let f=a*this.dim,_=a*this.dim+this.dim,x=h*this.dim,w=h*this.dim+this.dim;switch(a){case-1:f=_-1;break;case 1:_=f+1}switch(h){case-1:x=w-1;break;case 1:w=x+1}const D=-a*this.dim,S=-h*this.dim;for(let P=x;P<w;P++)for(let R=f;R<_;R++){const O=4*this._idx(R,P),N=4*this._idx(R+D,P+S);this.pixels[O+0]=r.pixels[N+0],this.pixels[O+1]=r.pixels[N+1],this.pixels[O+2]=r.pixels[N+2],this.pixels[O+3]=r.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}pt(ku,"DEMData"),pt(B0,"DemMinMaxQuadTree",{omit:["dem"]});class Em{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(const r in this.data)for(const a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,h){const f=r.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const _={value:a,timeout:void 0};if(void 0!==h&&(_.timeout=setTimeout(()=>{this.remove(r,_)},h)),this.data[f].push(_),this.order.push(f),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){const a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;const h=r.wrapped().key,f=void 0===a?0:this.data[h].indexOf(a),_=this.data[h][f];return this.data[h].splice(f,1),_.timeout&&clearTimeout(_.timeout),0===this.data[h].length&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){const a=[];for(const h in this.data)for(const f of this.data[h])r(f.value)||a.push(f);for(const h of a)this.remove(h.value.tileID,h)}}class Yf{constructor(r,a,h){this.func=r,this.mask=a,this.range=h}}Yf.ReadOnly=!1,Yf.ReadWrite=!0,Yf.disabled=new Yf(519,Yf.ReadOnly,[0,1]);class U0{constructor(r,a,h,f,_,x){this.test=r,this.ref=a,this.mask=h,this.fail=f,this.depthFail=_,this.pass=x}}U0.disabled=new U0({func:519,mask:0},0,0,7680,7680,7680);class ga{constructor(r,a,h){this.blendFunction=r,this.blendColor=a,this.mask=h}}ga.Replace=[1,0],ga.disabled=new ga(ga.Replace,Fi.transparent,[!1,!1,!1,!1]),ga.unblended=new ga(ga.Replace,Fi.transparent,[!0,!0,!0,!0]),ga.alphaBlended=new ga([1,771],Fi.transparent,[!0,!0,!0,!0]);class $s{constructor(r,a,h){this.enable=r,this.mode=a,this.frontFace=h}}$s.disabled=new $s(!1,1029,2305),$s.backCCW=new $s(!0,1029,2305),$s.backCW=new $s(!0,1029,2304),$s.frontCW=new $s(!0,1028,2304),$s.frontCCW=new $s(!0,1028,2305);class Ul extends oc{constructor(r,a,h){super(),this.id=r,this._onlySymbols=h,a.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new Em(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ya,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(r){this.map=r,this._minTileCacheSize=void 0===this._minTileCacheSize&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const a=this._tiles[r];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const h=this._tiles[a];h.upload(r),h.prepare(this.map.style.imageManager)}}getIds(){return wa(this._tiles).map(r=>r.tileID).sort(Ja).map(r=>r.key)}getRenderableIds(r){const a=[];for(const h in this._tiles)this._isIdRenderable(+h,r)&&a.push(this._tiles[h]);return r?a.sort((h,f)=>{const _=h.tileID,x=f.tileID,w=new st(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),D=new st(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-x.overscaledZ||D.y-w.y||D.x-w.x}).map(h=>h.tileID.key):a.map(h=>h.tileID).sort(Ja).map(h=>h.key)}hasRenderableParent(r){const a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,a){const h=this._tiles[r];h&&("loading"!==h.state&&(h.state=a),this._loadTile(h,this._tileLoaded.bind(this,h,r,a)))}_tileLoaded(r,a,h,f){if(f)if(r.state="errored",404!==f.status)this._source.fire(new Ms(f,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=ss.now(),"expired"===h&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new pl("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const a=this.getRenderableIds();for(let f=0;f<a.length;f++){const _=a[f];if(r.neighboringTiles&&r.neighboringTiles[_]){const x=this.getTileByID(_);h(r,x),h(x,r)}}function h(f,_){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let x=_.tileID.canonical.x-f.tileID.canonical.x;const w=_.tileID.canonical.y-f.tileID.canonical.y,D=Math.pow(2,f.tileID.canonical.z),S=_.tileID.key;0===x&&0===w||Math.abs(w)>1||(Math.abs(x)>1&&(1===Math.abs(x+D)?x+=D:1===Math.abs(x-D)&&(x-=D)),_.dem&&f.dem&&(f.dem.backfillBorder(_.dem,x,w),f.neighboringTiles&&f.neighboringTiles[S]&&(f.neighboringTiles[S].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,h,f){for(const _ in this._tiles){let x=this._tiles[_];if(f[_]||!x.hasData()||x.tileID.overscaledZ<=a||x.tileID.overscaledZ>h)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>a+1;){const S=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[S.key],x&&x.hasData()&&(w=S)}let D=w;for(;D.overscaledZ>a;)if(D=D.scaledTo(D.overscaledZ-1),r[D.key]){f[w.key]=w;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){const h=this._loadedParentTiles[r.key];return h&&h.tileID.overscaledZ>=a?h:null}for(let h=r.overscaledZ-1;h>=a;h--){const f=r.scaledTo(h),_=this._getLoadedTile(f);if(_)return _}}_getLoadedTile(r){const a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,a){a=a||this._source.tileSize;const h=Math.ceil(r.width/a)+1,f=Math.ceil(r.height/a)+1,_=Math.floor(h*f*5),x="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,_):_,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(w)}handleWrapJump(r){const a=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,a){const h={};for(const f in this._tiles){const _=this._tiles[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+a),h[_.tileID.key]=_}this._tiles=h;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(r,a,h){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let f;this.updateCacheSize(r,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new Kr(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(f=r.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(w=>this._source.hasTile(w)))):f=[];const _=this._updateRetainedTiles(f);if(Jf(this._source.type)&&0!==f.length){const w={},D={},S=Object.keys(_);for(const R of S){const O=_[R],N=this._tiles[R];if(!N||N.fadeEndTime&&N.fadeEndTime<=ss.now())continue;const B=this.findLoadedParent(O,Math.max(O.overscaledZ-Ul.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),w[B.tileID.key]=B.tileID),D[R]=O}const P=f[f.length-1].overscaledZ;for(const R in this._tiles){const O=this._tiles[R];if(_[R]||!O.hasData())continue;let N=O.tileID;for(;N.overscaledZ>P;){N=N.scaledTo(N.overscaledZ-1);const B=this._tiles[N.key];if(B&&B.hasData()&&D[N.key]){_[R]=O.tileID;break}}}for(const R in w)_[R]||(this._coveredTiles[R]=!0,_[R]=w[R])}for(const w in _)this._tiles[w].clearFadeHold();const x=function(w,D){const S=[];for(const P in w)P in D||S.push(P);return S}(this._tiles,_);for(const w of x){const D=this._tiles[w];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const a={};if(0===r.length)return a;const h={},f=r.reduce((S,P)=>Math.min(S,P.overscaledZ),1/0),_=r[0].overscaledZ,x=Math.max(_-Ul.maxOverzooming,this._source.minzoom),w=Math.max(_+Ul.maxUnderzooming,this._source.minzoom),D={};for(const S of r){const P=this._addTile(S);a[S.key]=S,P.hasData()||f<this._source.maxzoom&&(D[S.key]=S)}this._retainLoadedChildren(D,f,w,a);for(const S of r){let P=this._tiles[S.key];if(P.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const O=S.children(this._source.maxzoom)[0],N=this.getTile(O);if(N&&N.hasData()){a[O.key]=O;continue}}else{const O=S.children(this._source.maxzoom);if(a[O[0].key]&&a[O[1].key]&&a[O[2].key]&&a[O[3].key])continue}let R=P.wasRequested();for(let O=S.overscaledZ-1;O>=x;--O){const N=S.scaledTo(O);if(h[N.key]||(h[N.key]=!0,P=this.getTile(N),!P&&R&&(P=this._addTile(N)),P&&(a[N.key]=N,R=P.wasRequested(),P.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const a=[];let h,f=this._tiles[r].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){h=this._loadedParentTiles[f.key];break}a.push(f.key);const _=f.scaledTo(f.overscaledZ-1);if(h=this._getLoadedTile(_),h)break;f=_}for(const _ of a)this._loadedParentTiles[_]=h}}_addTile(r){let a=this._tiles[r.key];if(a)return a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));const h=Boolean(a);if(!h){const f=this.map?this.map.painter:null;a=new k_(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))}return a?(a.uses++,this._tiles[r.key]=a,h||this._source.fire(new pl("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const h=a.getExpiryTimeout();h&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},h))}_removeTile(r){const a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,a,h){const f=[],_=this.transform;if(!_)return f;const x="globe"===_.projection.name,w=Ci(_.center.lng);for(const D in this._tiles){const S=this._tiles[D];if(h&&S.clearQueryDebugViz(),S.holdingForFade())continue;let P;if(x){const R=S.tileID.canonical;if(0===R.z){const O=[Math.abs(hn(w,...kc(R,-1))-w),Math.abs(hn(w,...kc(R,1))-w)];P=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(hn(w,...kc(R,-1))-w),Math.abs(hn(w,...kc(R,0))-w),Math.abs(hn(w,...kc(R,1))-w)];P=[O.indexOf(Math.min(...O))-1]}}else P=[0];for(const R of P){const O=r.containsTile(S,_,a,R);O&&f.push(O)}}return f}getVisibleCoordinates(r){const a=this.getRenderableIds(r).map(h=>this._tiles[h].tileID);for(const h of a)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Jf(this._source.type))for(const r in this._tiles){const a=this._tiles[r];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=ss.now())return!0}return!1}setFeatureState(r,a,h){this._state.updateState(r=r||"_geojsonTileLayer",a,h)}removeFeatureState(r,a,h){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,h)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,h){const f=this._tiles[r];f&&f.setDependencies(a,h)}reloadTilesForDependencies(r,a){for(const h in this._tiles)this._tiles[h].hasDependency(r,a)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(r,a))}_preloadTiles(r,a){if(!this._sourceLoaded){const w=()=>{this._sourceLoaded&&(this._source.off("data",w),this._preloadTiles(r,a))};return void this._source.on("data",w)}const h=new Map,f=Array.isArray(r)?r:[r],_=this.map.painter.terrain,x=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const w of f){const D=w.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of D)h.set(S.key,S);this.usedForTerrain&&w.updateElevation(!1)}Xi(Array.from(h.values()),(w,D)=>{const S=new k_(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,P=>{"raster-dem"===this._source.type&&S.dem&&this._backfillDEM(S),D(P,S)})},a)}}function Ja(s,r){const a=Math.abs(2*s.wrap)-+(s.wrap<0),h=Math.abs(2*r.wrap)-+(r.wrap<0);return s.overscaledZ-r.overscaledZ||h-a||r.canonical.y-s.canonical.y||r.canonical.x-s.canonical.x}function Jf(s){return"raster"===s||"image"===s||"video"===s||"custom"===s}function kc(s,r){const a=1<<s.z;return[s.x/a+r,(s.x+1)/a+r]}Ul.maxOverzooming=10,Ul.maxUnderzooming=3;class Rc{constructor(r,a,h){this._demTile=r,this._dem=this._demTile.dem,this._scale=a,this._offset=h}static create(r,a,h){const f=h||r.findDEMTileFor(a);if(!f||!f.dem)return;const _=f.dem,x=f.tileID,w=1<<a.canonical.z-x.canonical.z;return new Rc(f,f.tileSize/St/w,[(a.canonical.x/w-x.canonical.x)*_.dim,(a.canonical.y/w-x.canonical.y)*_.dim])}tileCoordToPixel(r,a){const h=a*this._scale+this._offset[1],f=Math.floor(r*this._scale+this._offset[0]),_=Math.floor(h);return new st(f,_)}getElevationAt(r,a,h,f){const _=r*this._scale+this._offset[0],x=a*this._scale+this._offset[1],w=Math.floor(_),D=Math.floor(x),S=this._dem;return f=!!f,h?mn(mn(S.get(w,D,f),S.get(w,D+1,f),x-D),mn(S.get(w+1,D,f),S.get(w+1,D+1,f),x-D),_-w):S.get(w,D,f)}getElevationAtPixel(r,a,h){return this._dem.get(r,a,!!h)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Bs(1,r)*this._dem.stride}}class $0{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Il(St,16,0),this.featureIndexArray=new fo,this.promoteId=a}insert(r,a,h,f,_,x=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,f,_,x);const D=this.grid;for(let S=0;S<a.length;S++){const P=a[S],R=[1/0,1/0,-1/0,-1/0];for(let O=0;O<P.length;O++){const N=P[O];R[0]=Math.min(R[0],N.x),R[1]=Math.min(R[1],N.y),R[2]=Math.max(R[2],N.x),R[3]=Math.max(R[3],N.y)}R[0]<St&&R[1]<St&&R[2]>=0&&R[3]>=0&&D.insert(w,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Pf(new mm(this.rawTileData)).layers,this.sourceLayerCoder=new P_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,a,h,f){this.loadVTLayers();const _=r.params||{},x=uu(_.filter),w=r.tileResult,D=r.transform,S=w.bufferedTilespaceBounds,P=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(B,$,Z,te)=>Ev(w.bufferedTilespaceGeometry,B,$,Z,te));P.sort(H0);let R=null;D.elevation&&P.length>0&&(R=Rc.create(D.elevation,this.tileID));const O={};let N;for(let B=0;B<P.length;B++){const $=P[B];if($===N)continue;N=$;const Z=this.featureIndexArray.get($);let te=null;this.loadMatchingFeature(O,Z,x,_.layers,_.availableImages,a,h,f,(ce,ne,ae,pe=0)=>(te||(te=Bl(ce,this.tileID.canonical,r.tileTransform)),ne.queryIntersectsFeature(w,ce,ae,te,this.z,r.transform,r.pixelPosMatrix,R,pe)))}return O}loadMatchingFeature(r,a,h,f,_,x,w,D,S){const{featureIndex:P,bucketIndex:R,sourceLayerIndex:O,layoutVertexArrayOffset:N}=a,B=this.bucketLayerIDs[R];if(f&&!function(ce,ne){for(let ae=0;ae<ce.length;ae++)if(ne.indexOf(ce[ae])>=0)return!0;return!1}(f,B))return;const $=this.sourceLayerCoder.decode(O),Z=this.vtLayers[$].feature(P);if(h.needGeometry){const ce=Cu(Z,!0);if(!h.filter(new k(this.tileID.overscaledZ),ce,this.tileID.canonical))return}else if(!h.filter(new k(this.tileID.overscaledZ),Z))return;const te=this.getId(Z,$);for(let ce=0;ce<B.length;ce++){const ne=B[ce];if(f&&f.indexOf(ne)<0)continue;const ae=x[ne];if(!ae)continue;let pe={};void 0!==te&&D&&(pe=D.getState(ae.sourceLayer||"_geojsonTileLayer",te));const he=ki({},w[ne]);he.paint=O_(he.paint,ae.paint,Z,pe,_),he.layout=O_(he.layout,ae.layout,Z,pe,_);const Me=!S||S(Z,ae,pe,N);if(!Me)continue;const Ee=new k0(Z,this.z,this.x,this.y,te);Ee.layer=he;let Oe=r[ne];void 0===Oe&&(Oe=r[ne]=[]),Oe.push({featureIndex:P,feature:Ee,intersectionZ:Me})}}lookupSymbolFeatures(r,a,h,f,_,x,w,D){const S={};this.loadVTLayers();const P=uu(_);for(const R of r)this.loadMatchingFeature(S,{bucketIndex:h,sourceLayerIndex:f,featureIndex:R,layoutVertexArrayOffset:0},P,x,w,D,a);return S}loadFeature(r){const{featureIndex:a,sourceLayerIndex:h}=r;this.loadVTLayers();const f=this.sourceLayerCoder.decode(h),_=this.vtFeatures[f];if(_[a])return _[a];const x=this.vtLayers[f].feature(a);return _[a]=x,x}hasLayer(r){for(const a of this.bucketLayerIDs)for(const h of a)if(r===h)return!0;return!1}getId(r,a){let h=r.id;if(this.promoteId){const f="string"==typeof this.promoteId?this.promoteId:this.promoteId[a];null!=f&&(h=r.properties[f]),"boolean"==typeof h&&(h=Number(h))}return h}}function O_(s,r,a,h,f){return ht(s,(_,x)=>{const w=r instanceof ee?r.get(x):null;return w&&w.evaluate?w.evaluate(a,h,f):w})}function H0(s,r){return r-s}pt($0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class G0{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.image=new Ua({width:r,height:a}),this.positions={},this.uploaded=!1}getDash(r,a){const h=this.getKey(r,a);return this.positions[h]}trim(){const r=this.width,a=this.height=Ts(this.nextRow);this.image.resize({width:r,height:a})}getKey(r,a){return r.join(",")+a}getDashRanges(r,a,h){const f=[];let _=r.length%2==1?-r[r.length-1]*h:0,x=r[0]*h,w=!0;f.push({left:_,right:x,isDash:w,zeroLength:0===r[0]});let D=r[0];for(let S=1;S<r.length;S++){w=!w;const P=r[S];_=D*h,D+=P,x=D*h,f.push({left:_,right:x,isDash:w,zeroLength:0===P})}return f}addRoundDash(r,a,h){const f=a/2;for(let _=-h;_<=h;_++){const x=this.width*(this.nextRow+h+_);let w=0,D=r[w];for(let S=0;S<this.width;S++){S/D.right>1&&(D=r[++w]);const P=Math.abs(S-D.left),R=Math.abs(S-D.right),O=Math.min(P,R);let N;const B=_/h*(f+1);if(D.isDash){const $=f-Math.abs(B);N=Math.sqrt(O*O+$*$)}else N=f-Math.sqrt(O*O+B*B);this.image.data[x+S]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(r,a){for(let D=r.length-1;D>=0;--D){const S=r[D],P=r[D+1];S.zeroLength?r.splice(D,1):P&&P.isDash===S.isDash&&(P.left=S.left,r.splice(D,1))}const h=r[0],f=r[r.length-1];h.isDash===f.isDash&&(h.left=f.left-this.width,f.right=h.right+this.width);const _=this.width*this.nextRow;let x=0,w=r[x];for(let D=0;D<this.width;D++){D/w.right>1&&(w=r[++x]);const S=Math.abs(D-w.left),P=Math.abs(D-w.right),R=Math.min(S,P);this.image.data[_+D]=Math.max(0,Math.min(255,(w.isDash?R:-R)+a+128))}}addDash(r,a){const h=this.getKey(r,a);if(this.positions[h])return this.positions[h];const f="round"===a,_=f?7:0,x=2*_+1;if(this.nextRow+x>this.height)return ui("LineAtlas out of space"),null;0===r.length&&r.push(1);let w=0;for(let P=0;P<r.length;P++)r[P]<0&&(ui("Negative value is found in line dasharray, replacing values with 0"),r[P]=0),w+=r[P];if(0!==w){const P=this.width/w,R=this.getDashRanges(r,this.width,P);f?this.addRoundDash(R,P,_):this.addRegularDash(R,"square"===a?.5*P:0)}const D=this.nextRow+_;this.nextRow+=x;const S={tl:[D,_],br:[w,0]};return this.positions[h]=S,S}}pt(G0,"LineAtlas");const W0=1*js;class dd{constructor(r){const a={},h=[];for(const w in r){const D=r[w],S=a[w]={};for(const P in D.glyphs){const R=D.glyphs[+P];if(!R||0===R.bitmap.width||0===R.bitmap.height)continue;const O=R.metrics.localGlyph?W0:1,N={x:0,y:0,w:R.bitmap.width+2*O,h:R.bitmap.height+2*O};h.push(N),S[P]=N}}const{w:f,h:_}=h_(h),x=new Ua({width:f||1,height:_||1});for(const w in r){const D=r[w];for(const S in D.glyphs){const P=D.glyphs[+S];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const R=a[w][S],O=P.metrics.localGlyph?W0:1;Ua.copy(P.bitmap,x,{x:0,y:0},{x:R.x+O,y:R.y+O},P.bitmap)}}this.image=x,this.positions=a}}pt(dd,"GlyphAtlas");class dw{constructor(r){this.tileID=new Kr(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=Au(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,a,h,f,_){this.status="parsing",this.data=r,this.collisionBoxArray=new Gn;const x=new P_(Object.keys(r.layers).sort()),w=new $0(this.tileID,this.promoteId);w.bucketLayerIDs=[];const D={},S=new G0(256,256),P={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:h},R=a.familiesBySource[this.source];for(const pe in R){const he=r.layers[pe];if(!he)continue;let Me=!1,Ee=!1;for(const Ae of R[pe])"symbol"===Ae[0].type?Me=!0:Ee=!0;if(!0===this.isSymbolTile&&!Me||!1===this.isSymbolTile&&!Ee)continue;1===he.version&&ui(`Vector tile source "${this.source}" layer "${pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Oe=x.encode(pe),Ge=[];for(let Ae=0;Ae<he.length;Ae++){const Be=he.feature(Ae),Ve=w.getId(Be,pe);Ge.push({feature:Be,id:Ve,index:Ae,sourceLayerIndex:Oe})}for(const Ae of R[pe]){const Be=Ae[0];void 0!==this.isSymbolTile&&"symbol"===Be.type!==this.isSymbolTile||Be.minzoom&&this.zoom<Math.floor(Be.minzoom)||Be.maxzoom&&this.zoom>=Be.maxzoom||"none"!==Be.visibility&&(q0(Ae,this.zoom,h),(D[Be.id]=Be.createBucket({index:w.bucketLayerIDs.length,layers:Ae,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Oe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:h})).populate(Ge,P,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(Ae.map(Ve=>Ve.id)))}}let O,N,B,$;S.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},te=()=>{if(O)return _(O);if(N&&B&&$){const pe=new dd(N),he=new o0(B,$);for(const Me in D){const Ee=D[Me];Ee instanceof qa?(q0(Ee.layers,this.zoom,h),nw(Ee,N,pe.positions,B,he.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection)):Ee.hasPattern&&(Ee instanceof Xh||Ee instanceof n_||Ee instanceof qh)&&(q0(Ee.layers,this.zoom,h),Ee.addFeatures(P,this.tileID.canonical,he.patternPositions,h,this.tileTransform))}this.status="done",_(null,{buckets:wa(D).filter(Me=>!Me.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pe.image,lineAtlas:S,imageAtlas:he,glyphMap:this.returnDependencies?N:null,iconMap:this.returnDependencies?B:null,glyphPositions:this.returnDependencies?pe.positions:null})}},ce=ht(P.glyphDependencies,pe=>Object.keys(pe).map(Number));Object.keys(ce).length?f.send("getGlyphs",{uid:this.uid,stacks:ce},(pe,he)=>{O||(O=pe,N=he,te())},void 0,!1,Z):N={};const ne=Object.keys(P.iconDependencies);ne.length?f.send("getImages",{icons:ne,source:this.source,tileID:this.tileID,type:"icons"},(pe,he)=>{O||(O=pe,B=he,te())},void 0,!1,Z):B={};const ae=Object.keys(P.patternDependencies);ae.length?f.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"patterns"},(pe,he)=>{O||(O=pe,$=he,te())},void 0,!1,Z):$={},te()}}function q0(s,r,a){const h=new k(r);for(const f of s)f.recalculate(h,a)}class Z0{constructor(r){this.entries={},this.scheduler=r}request(r,a,h,f){const _=this.entries[r]=this.entries[r]||{callbacks:[]};if(_.result){const[x,w]=_.result;return this.scheduler?this.scheduler.add(()=>{f(x,w)},a):f(x,w),()=>{}}return _.callbacks.push(f),_.cancel||(_.cancel=h((x,w)=>{_.result=[x,w];for(const D of _.callbacks)this.scheduler?this.scheduler.add(()=>{D(x,w)},a):D(x,w);setTimeout(()=>delete this.entries[r],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(x=>x!==f),_.callbacks.length||(_.cancel(),delete this.entries[r]))}}}function X0(s,r,a){const h=JSON.stringify(s.request);return s.data&&(this.deduped.entries[h]={result:[null,s.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},f=>{const _=ic(s.request,(x,w,D,S)=>{x?f(x):w&&f(null,{vectorTile:a?void 0:new Pf(new mm(w)),rawData:w,cacheControl:D,expires:S})});return()=>{_.cancel(),f()}},r)}const Y0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class L_{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,h]=new Uint8Array(r,0,2);if(219!==a)throw new Error("Data does not appear to be in a KDBush format.");const f=h>>4;if(1!==f)throw new Error(`Got v${f} data when expected v1.`);const _=Y0[15&h];if(!_)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(r,2,1),[w]=new Uint32Array(r,4,1);return new L_(w,x,_,r)}constructor(r,a=64,h=Float64Array,f){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=h,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const _=Y0.indexOf(this.ArrayType),x=2*r*this.ArrayType.BYTES_PER_ELEMENT,w=r*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-w%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${h}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+w+D,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+x+w+D),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+w+D,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=r)}add(r,a){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=r,this.coords[this._pos++]=a,h}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return F_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,a,h,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:x,nodeSize:w}=this,D=[0,_.length-1,0],S=[];for(;D.length;){const P=D.pop()||0,R=D.pop()||0,O=D.pop()||0;if(R-O<=w){for(let Z=O;Z<=R;Z++){const te=x[2*Z],ce=x[2*Z+1];te>=r&&te<=h&&ce>=a&&ce<=f&&S.push(_[Z])}continue}const N=O+R>>1,B=x[2*N],$=x[2*N+1];B>=r&&B<=h&&$>=a&&$<=f&&S.push(_[N]),(0===P?r<=B:a<=$)&&(D.push(O),D.push(N-1),D.push(1-P)),(0===P?h>=B:f>=$)&&(D.push(N+1),D.push(R),D.push(1-P))}return S}within(r,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:_,nodeSize:x}=this,w=[0,f.length-1,0],D=[],S=h*h;for(;w.length;){const P=w.pop()||0,R=w.pop()||0,O=w.pop()||0;if(R-O<=x){for(let Z=O;Z<=R;Z++)ri(_[2*Z],_[2*Z+1],r,a)<=S&&D.push(f[Z]);continue}const N=O+R>>1,B=_[2*N],$=_[2*N+1];ri(B,$,r,a)<=S&&D.push(f[N]),(0===P?r-h<=B:a-h<=$)&&(w.push(O),w.push(N-1),w.push(1-P)),(0===P?r+h>=B:a+h>=$)&&(w.push(N+1),w.push(R),w.push(1-P))}return D}}function F_(s,r,a,h,f,_){if(f-h<=a)return;const x=h+f>>1;K0(s,r,x,h,f,_),F_(s,r,a,h,x-1,1-_),F_(s,r,a,x+1,f,1-_)}function K0(s,r,a,h,f,_){for(;f>h;){if(f-h>600){const S=f-h+1,P=a-h+1,R=Math.log(S),O=.5*Math.exp(2*R/3),N=.5*Math.sqrt(R*O*(S-O)/S)*(P-S/2<0?-1:1);K0(s,r,a,Math.max(h,Math.floor(a-P*O/S+N)),Math.min(f,Math.floor(a+(S-P)*O/S+N)),_)}const x=r[2*a+_];let w=h,D=f;for(Qf(s,r,h,a),r[2*f+_]>x&&Qf(s,r,h,f);w<D;){for(Qf(s,r,w,D),w++,D--;r[2*w+_]<x;)w++;for(;r[2*D+_]>x;)D--}r[2*h+_]===x?Qf(s,r,h,D):(D++,Qf(s,r,D,f)),D<=a&&(h=D+1),a<=D&&(f=D-1)}}function Qf(s,r,a,h){Sm(s,a,h),Sm(r,2*a,2*h),Sm(r,2*a+1,2*h+1)}function Sm(s,r,a){const h=s[r];s[r]=s[a],s[a]=h}function ri(s,r,a,h){const f=s-a,_=r-h;return f*f+_*_}p.ARRAY_TYPE=ps,p.AUTH_ERR_MSG=me,p.Aabb=vr,p.Actor=class{constructor(s,r,a){this.target=s,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Yn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Da()?s:Ue,this.scheduler=new A_}send(s,r,a,h,f=!1,_){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=_,this.callbacks[x]=a);const w=qc(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:s,hasCallback:!!a,targetMapId:h,mustQueue:f,sourceMapId:this.mapId,data:Ze(r,w)},w),{cancel:()=>{a&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(s){const r=s.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const h=this.cancelCallbacks[a];delete this.cancelCallbacks[a],h&&h.cancel()}else if(r.mustQueue||Da()){const h=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,r),h&&h.metadata||{type:"message"})}else this.processTask(a,r)}processTask(s,r){if("<response>"===r.type){const a=this.callbacks[s];delete this.callbacks[s],a&&(r.error?a(yn(r.error)):a(null,yn(r.data)))}else{const a=qc(this.globalScope)?void 0:[],h=r.hasCallback?(_,x)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:_?Ze(_):null,data:Ze(x,a)},a)}:_=>{},f=yn(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,f,h);else if(this.parent.getWorkerSource){const _=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,_[0],f.source)[_[1]](f,h)}else h(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=am,p.Color=Fi,p.ColorMode=ga,p.CullFaceMode=$s,p.DEMData=ku,p.DataConstantProperty=U,p.DedupedRequest=Z0,p.DepthMode=Yf,p.EXTENT=St,p.Elevation=class{isDataAvailableAtPoint(s){const r=this._source();if(this.isUsingMockSource()||!r||s.y<0||s.y>1)return!1;const a=r.getSource().maxzoom,h=1<<a,f=Math.floor(s.x),_=Math.floor((s.x-f)*h),x=Math.floor(s.y*h),w=this.findDEMTileFor(new Kr(a,f,a,_,x));return!(!w||!w.dem)}getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,a=!0){if(this.isUsingMockSource())return null;null==r&&(r=null);const h=this._source();if(!h||s.y<0||s.y>1)return r;const f=h.getSource().maxzoom,_=1<<f,x=Math.floor(s.x),w=s.x-x,D=new Kr(f,x,f,Math.floor(w*_),Math.floor(s.y*_)),S=this.findDEMTileFor(D);if(!S||!S.dem)return r;const P=S.dem,R=1<<S.tileID.canonical.z,O=(w*R-S.tileID.canonical.x)*P.dim,N=(s.y*R-S.tileID.canonical.y)*P.dim,B=Math.floor(O),$=Math.floor(N);return(a?this.exaggeration():1)*mn(mn(P.get(B,$),P.get(B,$+1),N-$),mn(P.get(B+1,$),P.get(B+1,$+1),N-$),O-B)}getAtTileOffset(s,r,a){const h=1<<s.canonical.z;return this.getAtPointOrZero(new Vh(s.wrap+(s.canonical.x+r/St)/h,(s.canonical.y+a/St)/h))}getAtTileOffsetFunc(s,r,a,h){return f=>{const _=this.getAtTileOffset(s,f.x,f.y),x=h.upVector(s.canonical,f.x,f.y);return ms(x,x,_*h.upVectorScale(s.canonical,r,a).metersToTile),x}}getForTilePoints(s,r,a,h){if(this.isUsingMockSource())return!1;const f=Rc.create(this,s,h);return!!f&&(r.forEach(_=>{_[2]=this.exaggeration()*f.getElevationAt(_[0],_[1],a)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const a=r.dem.tree,h=r.tileID,f=1<<s.canonical.z-h.canonical.z;let _=s.canonical.x/f-h.canonical.x,x=s.canonical.y/f-h.canonical.y,w=0;for(let D=0;D<s.canonical.z-h.canonical.z&&!a.leaves[w];D++){_*=2,x*=2;const S=2*Math.floor(x)+Math.floor(_);w=a.childOffsets[w]+S,_%=1,x%=1}return{min:this.exaggeration()*a.minimums[w],max:this.exaggeration()*a.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=Ms,p.EvaluationParameters=k,p.Event=pl,p.Evented=oc,p.FillExtrusionBucket=qh,p.Frustum=Fg,p.FrustumCorners=Lg,p.GLOBE_RADIUS=da,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=pv,p.GLOBE_ZOOM_THRESHOLD_MIN=jp,p.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,r){const a=new Xe,h=new vt,f=[],_=s+1+2,x=r[0]+1,w=r[0]+1+(1+r.length),D=(S,P,R)=>{let O=S===_-1?S-2:0===S?S:S-1;return O+=R?24575:0,[O,P]};for(let S=0;S<_;++S)a.emplaceBack(...D(S,0,!0));for(let S=0;S<x;++S)for(let P=0;P<_;++P)a.emplaceBack(...D(P,S,(0===P||P===_-1)&&!0));for(let S=0;S<r.length;++S){const P=r[S];for(let R=0;R<_;++R)a.emplaceBack(...D(R,P,!0))}for(let S=0;S<r.length;++S){const P=h.length,R=r[S]+1+2,O=new vt;for(let $=0;$<R-1;$++){const Z=$===R-2,te=Z?_*(w-r.length+S-$):_;for(let ce=0;ce<_-1;ce++){const ne=$*_+ce;0===$||Z||0===ce||ce===_-2?(O.emplaceBack(ne+1,ne,ne+te),O.emplaceBack(ne+te,ne+te+1,ne+1)):(h.emplaceBack(ne+1,ne,ne+te),h.emplaceBack(ne+te,ne+te+1,ne+1))}}const N=$i.simpleSegment(0,P,a.length,h.length-P);for(let $=0;$<O.uint16.length;$+=3)h.emplaceBack(O.uint16[$],O.uint16[$+1],O.uint16[$+2]);const B=$i.simpleSegment(0,P,a.length,h.length-P);f.push({withoutSkirts:N,withSkirts:B})}return{vertices:a,indices:h,segments:f}}_createGrid(s){const r=this._fillGridMeshWithLods(64,Up);this._gridSegments=r.segments,this._gridBuffer=s.createVertexBuffer(r.vertices,Vp.members),this._gridIndexBuffer=s.createIndexBuffer(r.indices,!0)}_createPoles(s){const r=new vt;for(let f=0;f<=64;f++)r.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=s.createIndexBuffer(r,!0);const a=new Vn,h=new Vn;this._poleSegments=[];for(let f=0,_=0;f<jp;f++){const x=360/(1<<f);a.emplaceBack(0,-da,0,.5,0),h.emplaceBack(0,-da,0,.5,1);for(let w=0;w<=64;w++){const D=w/64,S=mn(0,x,D),[P,R,O]=bu(vv,x1,S,da);a.emplaceBack(P,R,O,D,0),h.emplaceBack(P,R,O,D,1)}this._poleSegments.push($i.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(a,Rg,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(h,Rg,!1)}getGridBuffers(s,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,r){if(!this._wireframeSegments){const a=new Si,h=64,f=h+1+2,_=1;this._wireframeSegments=[];for(let x=0,w=0;x<Up.length;x++){const D=Up[x];for(let P=_;P<D+_;P++)for(let R=_;R<h+_;R++){const O=P*f+R;a.emplaceBack(O,O+1),a.emplaceBack(O,O+f),a.emplaceBack(O,O+f+1)}const S=D*h*3;this._wireframeSegments.push($i.simpleSegment(0,w,(D+1)*f,S)),w+=S}this._wireframeIndexBuffer=s.createIndexBuffer(a)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},p.GlyphManager=id,p.ImagePosition=d_,p.KDBush=L_,p.LivePerformanceUtils=Js,p.LngLat=jn,p.LngLatBounds=Fs,p.LocalGlyphMode=y_,p.MAX_MERCATOR_LATITUDE=Lr,p.MercatorCoordinate=Vh,p.ONE_EM=er,p.OverscaledTileID=Kr,p.PerformanceMarkers=rc,p.Point=st,p.Properties=re,p.RGBAImage=Io,p.Ray=Og,p.RequestManager=class{constructor(s,r,a){this._transformRequestFn=s,this._customAccessToken=r,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const s=function(){let r="";for(let a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Jl,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,r){return this._transformRequestFn&&this._transformRequestFn(s,r)||{url:s}}normalizeStyleURL(s,r){if(!ye(s))return s;const a=it(s);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeGlyphsURL(s,r){if(!ye(s))return s;const a=it(s);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeSourceURL(s,r,a,h){if(!ye(s))return s;const f=it(s);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),a&&f.params.push(`language=${a}`),h&&f.params.push(`worldview=${h}`),this._makeAPIURL(f,this._customAccessToken||r)}normalizeSpriteURL(s,r,a,h){const f=it(s);return ye(s)?(f.path=`/styles/v1${f.path}/sprite${r}${a}`,this._makeAPIURL(f,this._customAccessToken||h)):(f.path+=`${r}${a}`,Je(f))}normalizeTileURL(s,r,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!ye(s))return s;const h=it(s);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||a&&"raster"!==h.authority&&512===a?"@2x":""}${Zt.supported?".webp":"$1"}`),"raster"===h.authority?h.path=`/${Kt.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${Kt.TILE_URL_VERSION}${h.path}`);const f=this._customAccessToken||function(_){for(const x of _){const w=x.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(h.params)||Kt.ACCESS_TOKEN;return Kt.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,f)}canonicalizeTileURL(s,r){const a=it(s);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return s;let h="mapbox://";a.path.match(/^\/raster\/v1\//)?h+=`raster/${a.path.replace(`/${Kt.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${a.path.replace(`/${Kt.TILE_URL_VERSION}/`,"")}`;let f=a.params;return r&&(f=f.filter(_=>!_.match(/^access_token=/))),f.length&&(h+=`?${f.join("&")}`),h}canonicalizeTileset(s,r){const a=!!r&&ye(r),h=[];for(const f of s.tiles||[])De(f)?h.push(this.canonicalizeTileURL(f,a)):h.push(f);return h}_makeAPIURL(s,r){const a="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",h=it(Kt.API_URL);if(s.protocol=h.protocol,s.authority=h.authority,"http"===s.protocol){const f=s.params.indexOf("secure");f>=0&&s.params.splice(f,1)}if("/"!==h.path&&(s.path=`${h.path}${s.path}`),!Kt.REQUIRE_ACCESS_TOKEN)return Je(s);if(r=r||Kt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return s.params=s.params.filter(f=>-1===f.indexOf("access_token")),s.params.push(`access_token=${r||""}`),Je(s)}},p.ResourceType=Ta,p.SegmentVector=$i,p.SourceCache=Ul,p.StencilMode=U0,p.StructArrayLayout1ui2=Do,p.StructArrayLayout2f1f2i16=Tt,p.StructArrayLayout2i4=Xe,p.StructArrayLayout2ui4=Si,p.StructArrayLayout3f12=sn,p.StructArrayLayout3ui6=vt,p.StructArrayLayout4i8=je,p.StructArrayLayout5f20=Vn,p.Texture=Xf,p.Tile=k_,p.Transitionable=j,p.Uniform1f=cf,p.Uniform1i=class extends Ol{constructor(s){super(s),this.current=0}set(s,r,a){this.fetchUniformLocation(s,r)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},p.Uniform2f=class extends Ol{constructor(s){super(s),this.current=[0,0]}set(s,r,a){this.fetchUniformLocation(s,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}},p.Uniform3f=class extends Ol{constructor(s){super(s),this.current=[0,0,0]}set(s,r,a){this.fetchUniformLocation(s,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}},p.Uniform4f=Mg,p.UniformColor=yu,p.UniformMatrix2f=class extends Ol{constructor(s){super(s),this.current=Ig}set(s,r,a){if(this.fetchUniformLocation(s,r))for(let h=0;h<4;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}},p.UniformMatrix3f=class extends Ol{constructor(s){super(s),this.current=Xr}set(s,r,a){if(this.fetchUniformLocation(s,r))for(let h=0;h<9;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},p.UniformMatrix4f=class extends Ol{constructor(s){super(s),this.current=l1}set(s,r,a){if(this.fetchUniformLocation(s,r)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let h=1;h<16;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}},p.UnwrappedTileID=Wv,p.ValidationError=ut,p.VectorTileFeature=o_,p.VectorTileWorkerSource=class extends oc{constructor(s,r,a,h,f){super(),this.actor=s,this.layerIndex=r,this.availableImages=a,this.loadVectorData=f||X0,this.loading={},this.loaded={},this.deduped=new Z0(s.scheduler),this.isSpriteLoaded=h,this.scheduler=s.scheduler}loadTile(s,r){const a=s.uid,h=s&&s.request,f=h&&h.collectResourceTiming,_=this.loading[a]=new dw(s);_.abort=this.loadVectorData(s,(x,w)=>{const D=!this.loading[a];if(delete this.loading[a],D||x||!w)return _.status="done",D||(this.loaded[a]=_),r(x);const S=w.rawData,P={};w.expires&&(P.expires=w.expires),w.cacheControl&&(P.cacheControl=w.cacheControl),_.vectorTile=w.vectorTile||new Pf(new mm(S));const R=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(O,N)=>{if(O||!N)return r(O);const B={};if(f){const $=Ia(h);$.length>0&&(B.resourceTiming=JSON.parse(JSON.stringify($)))}r(null,ki({rawTileData:S.slice(0)},N,P,B))})};this.isSpriteLoaded?R():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(R,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):R()}),this.loaded=this.loaded||{},this.loaded[a]=_})}reloadTile(s,r){const a=this.loaded,h=s.uid,f=this;if(a&&a[h]){const _=a[h];_.showCollisionBoxes=s.showCollisionBoxes,_.enableTerrain=!!s.enableTerrain,_.projection=s.projection,_.tileTransform=Au(s.tileID.canonical,s.projection);const x=(w,D)=>{const S=_.reloadCallback;S&&(delete _.reloadCallback,_.parse(_.vectorTile,f.layerIndex,this.availableImages,f.actor,S)),r(w,D)};"parsing"===_.status?_.reloadCallback=x:"done"===_.status&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,x):x())}}abortTile(s,r){const a=s.uid,h=this.loading[a];h&&(h.abort&&h.abort(),delete this.loading[a]),r()}removeTile(s,r){const a=this.loaded,h=s.uid;a&&a[h]&&delete a[h],r()}},p.WritingMode=Fr,p.ZoomDependentExpression=gh,p.add=xc,p.addDynamicAttributes=hd,p.adjoint=function(s,r){var a=r[0],h=r[1],f=r[2],_=r[3],x=r[4],w=r[5],D=r[6],S=r[7],P=r[8];return s[0]=x*P-w*S,s[1]=f*S-h*P,s[2]=h*w-f*x,s[3]=w*D-_*P,s[4]=a*P-f*D,s[5]=f*_-a*w,s[6]=_*S-x*D,s[7]=h*D-a*S,s[8]=a*x-h*_,s},p.asyncAll=Xi,p.bezier=ll,p.bindAll=Yn,p.boundsAttributes=O0,p.bufferConvexPolygon=function(s,r){const a=[];for(let h=0;h<s.length;h++){const f=fn(h-1,-1,s.length-1),_=fn(h+1,-1,s.length-1),x=s[h],w=s[_],D=s[f].sub(x).unit(),S=w.sub(x).unit(),P=S.angleWithSep(D.x,D.y),R=D.add(S).unit().mult(-1*r/Math.sin(P/2));a.push(x.add(R))}return a},p.cacheEntryPossiblyAdded=function(s){Bo++,Bo>th&&(s.getActor().send("enforceCacheSizeLimit",tc),Bo=0)},p.calculateGlobeLabelMatrix=function(s,r){const{x:a,y:h}=s.point,f=jg(a,h,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Rr(f,f,Vg(Nl(r)))},p.calculateGlobeMatrix=function(s){const{x:r,y:a}=s.point,{lng:h,lat:f}=s._center;return jg(r,a,s.worldSize,h,f)},p.calculateGlobeMercatorMatrix=function(s){const r=s.pixelsPerMeter,a=r/Bs(1,s.center.lat),h=To(new Float64Array(16));return ua(h,h,[s.point.x,s.point.y,0]),yc(h,h,[a,a,r]),Float32Array.from(h)},p.circumferenceAtLatitude=yf,p.clamp=hn,p.clearTileCache=function(s){if(!Xc())return;const r=Ue.caches.delete(ec);s&&r.catch(s).then(()=>s())},p.clipLine=y0,p.clone=function(s){var r=new ps(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},p.clone$1=vo,p.collisionCircleLayout=U1,p.config=Kt,p.conjugate=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},p.create=function(){var s=new ps(16);return ps!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},p.create$1=ur,p.createExpression=_c,p.createLayout=xe,p.createStyleLayer=function(s){return"custom"===s.type?new aw(s):new cw[s.type](s)},p.cross=Rh,p.degToRad=an,p.distance=function(s,r){return Math.hypot(r[0]-s[0],r[1]-s[1],r[2]-s[2])},p.div=function(s,r,a){return s[0]=r[0]/a[0],s[1]=r[1]/a[1],s[2]=r[2]/a[2],s},p.dot=qo,p.earthRadius=_f,p.ease=rs,p.easeCubicInOut=Ju,p.ecefToLatLng=function([s,r,a]){const h=Math.hypot(s,r,a),f=Math.atan2(s,a),_=.5*Math.PI-Math.acos(-r/h);return new jn(or(f),or(_))},p.emitValidationErrors=rn,p.endsWith=Ql,p.enforceCacheSizeLimit=function(s){hl(),oo&&oo.then(r=>{r.keys().then(a=>{for(let h=0;h<a.length-s;h++)r.delete(a[h])})})},p.evaluateSizeForFeature=Nf,p.evaluateSizeForZoom=Tc,p.evaluateVariableOffset=tw,p.evented=b,p.exactEquals=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},p.exactEquals$1=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]},p.exported=ss,p.exported$1=Zt,p.extend=ki,p.extend$1=Qs,p.fillExtrusionHeightLift=$v,p.filterObject=Ea,p.fromMat4=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},p.fromQuat=function(s,r){var a=r[0],h=r[1],f=r[2],_=r[3],x=a+a,w=h+h,D=f+f,S=a*x,P=h*x,R=h*w,O=f*x,N=f*w,B=f*D,$=_*x,Z=_*w,te=_*D;return s[0]=1-R-B,s[1]=P+te,s[2]=O-Z,s[3]=0,s[4]=P-te,s[5]=1-S-B,s[6]=N+$,s[7]=0,s[8]=O+Z,s[9]=N-$,s[10]=1-S-R,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},p.fromRotation=function(s,r){var a=Math.sin(r),h=Math.cos(r);return s[0]=h,s[1]=a,s[2]=0,s[3]=-a,s[4]=h,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},p.fromScaling=av,p.furthestTileCorner=function(s){const r=Math.round((s+45+360)%360/90)%4;return Wc[r]},p.getAABBPointSquareDist=function(s,r,a){let h=0;for(let f=0;f<2;++f){const _=a?a[f]:0;s[f]>_&&(h+=(s[f]-_)*(s[f]-_)),r[f]<_&&(h+=(_-r[f])*(_-r[f]))}return h},p.getAnchorAlignment=g_,p.getAnchorJustification=_m,p.getBounds=function(s){let r=1/0,a=1/0,h=-1/0,f=-1/0;for(const _ of s)r=Math.min(r,_.x),a=Math.min(a,_.y),h=Math.max(h,_.x),f=Math.max(f,_.y);return{min:new st(r,a),max:new st(h,f)}},p.getColumn=Ys,p.getDefaultExportFromCjs=yo,p.getGridMatrix=function(s,r,a,h){const f=r.getNorth(),_=r.getSouth(),x=r.getWest(),w=r.getEast(),D=1<<s.z,S=w-x,P=f-_,R=S/64,O=-P/Up[a],N=[0,R,0,O,0,0,f,x,0];if(s.z>0){const B=180/h;Np(N,N,[B/S+1,0,0,0,B/P+1,0,-.5*B/R,.5*B/O,1])}return N[2]=D,N[5]=s.x,N[8]=s.y,N},p.getImage=se,p.getJSON=function(s,r){return dl(ki(s,{type:"json"}),r)},p.getLatitudinalLod=function(s){const r=Lr-5;s=hn(s,-r,r)/r*90;const a=Math.pow(Math.abs(Math.sin(an(s))),3);return Math.round(a*(Up.length-1))},p.getMapSessionAPI=Yi,p.getPerformanceMeasurement=Ia,p.getProjection=ym,p.getRTLTextPluginStatus=E,p.getReferrer=Ma,p.getTilePoint=function(s,{x:r,y:a},h=0){return new st(((r-h)*s.scale-s.x)*St,(a*s.scale-s.y)*St)},p.getTileVec3=function(s,r,a=0){return ha(((r.x-a)*s.scale-s.x)*St,(r.y*s.scale-s.y)*St,$g(r.z,r.y))},p.getVideo=function(s,r){const a=Ue.document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let h=0;h<s.length;h++){const f=Ue.document.createElement("source");nh(s[h])||(a.crossOrigin="Anonymous"),f.src=s[h],a.appendChild(f)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(s){const r=[0,0,0],a=To(new Float64Array(16));return Rr(a,s.pixelMatrix,s.globeMatrix),yi(r,r,a),new st(r[0],r[1])},p.globeDenormalizeECEF=Vg,p.globeECEFOrigin=function(s,r){const a=[0,0,0];return yi(a,a,gf(Nl(r.canonical))),yi(a,a,s),a},p.globeMetersToEcef=Ng,p.globeNormalizeECEF=gf,p.globePixelsToTileUnits=function(s,r){return St/(512*Math.pow(2,s))*Yr(Nl(r))},p.globePoleMatrixForTile=function(s,r,a){const h=To(new Float64Array(16)),f=(r/(1<<s)-.5)*Math.PI*2;return vc(h,a.globeMatrix,f),Float32Array.from(h)},p.globeTileBounds=Nl,p.globeTiltAtLngLat=_v,p.globeToMercatorTransition=Cc,p.globeUseCustomAntiAliasing=function(s,r,a){const h=Cc(a.zoom),f=s.style.map._antialias,_=!!r.extStandardDerivatives,x=r.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return 0===h&&!f&&!x&&_},p.identity=To,p.identity$1=dv,p.invert=kg,p.isFullscreen=function(){return!!Ue.document.fullscreenElement||!!Ue.document.webkitFullscreenElement},p.isLngLatBehindGlobe=Ug,p.isMapAuthenticated=function(s){return Ur.has(s)},p.isMapboxURL=ye,p.isSafariWithAntialiasingBug=function(s){const r=s.navigator?s.navigator.userAgent:null;return!!qc(s)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=Or,p.latLngToECEF=wu,p.len=uv,p.length=vu,p.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},p.lngFromMercatorX=Xo,p.loadVectorTile=X0,p.makeRequest=dl,p.mapValue=function(s,r,a,h,f){return hn((s-r)/(a-r)*(f-h)+h,h,f)},p.mercatorScale=Hg,p.mercatorXfromLng=Ci,p.mercatorYfromLat=Zo,p.mercatorZfromAltitude=Bs,p.mul=f1,p.mul$1=p1,p.multiply=Rr,p.multiply$1=Np,p.multiply$2=cv,p.nextPowerOfTwo=Ts,p.normalize=mo,p.normalize$1=m1,p.normalize$2=ff,p.number=mn,p.ortho=function(s,r,a,h,f,_,x){var w=1/(r-a),D=1/(h-f),S=1/(_-x);return s[0]=-2*w,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*D,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*S,s[11]=0,s[12]=(r+a)*w,s[13]=(f+h)*D,s[14]=(x+_)*S,s[15]=1,s},p.pbf=e0,p.perspective=function(s,r,a,h,f){var _,x=1/Math.tan(r/2);return s[0]=x/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=f&&f!==1/0?(s[10]=(f+h)*(_=1/(h-f)),s[14]=2*f*h*_):(s[10]=-1,s[14]=-2*h),s},p.pick=function(s,r){const a={};for(let h=0;h<r.length;h++){const f=r[h];f in s&&(a[f]=s[f])}return a},p.plugin=I,p.pointGeometry=Zs,p.polesInViewport=function(s){const r=To(new Float64Array(16));Rr(r,s.pixelMatrix,s.globeMatrix);const a=[0,zs,0],h=[0,Ns,0];return yi(a,a,r),yi(h,h,r),[a[0]>0&&a[0]<=s.width&&a[1]>0&&a[1]<=s.height&&!Ug(s,new jn(s.center.lat,90)),h[0]>0&&h[0]<=s.width&&h[1]>0&&h[1]<=s.height&&!Ug(s,new jn(s.center.lat,-90))]},p.polygonContainsPoint=Du,p.polygonIntersectsBox=Ev,p.polygonIntersectsPolygon=Eu,p.polygonizeBounds=function(s,r,a=0,h=!0){const f=new st(a,a),_=s.sub(f),x=r.add(f),w=[_,new st(x.x,_.y),x,new st(_.x,x.y)];return h&&w.push(_.clone()),w},p.posAttributes=Vp,p.postMapLoadEvent=Ri,p.postPerformanceEvent=ji,p.postTurnstileEvent=pn,p.potpack=h_,p.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},p.radToDeg=or,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(s){return s({pluginStatus:g,pluginURL:c}),b.on("pluginStateChange",s),s},p.removeAuthState=function(s){Ur.delete(s)},p.renderColorRamp=qp,p.resample=xv,p.rotateX=kh,p.rotateX$1=xu,p.rotateY=vc,p.rotateY$1=zh,p.rotateZ=function(s,r,a){var h=Math.sin(a),f=Math.cos(a),_=r[0],x=r[1],w=r[2],D=r[3],S=r[4],P=r[5],R=r[6],O=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=_*f+S*h,s[1]=x*f+P*h,s[2]=w*f+R*h,s[3]=D*f+O*h,s[4]=S*f-_*h,s[5]=P*f-x*h,s[6]=R*f-w*h,s[7]=O*f-D*h,s},p.rotateZ$1=function(s,r,a){a*=.5;var h=r[0],f=r[1],_=r[2],x=r[3],w=Math.sin(a),D=Math.cos(a);return s[0]=h*D+f*w,s[1]=f*D-h*w,s[2]=_*D+x*w,s[3]=x*D-_*w,s},p.scale=yc,p.scale$1=Fh,p.scale$2=ms,p.scaleAndAdd=df,p.set=function(s,r,a,h){return s[0]=r,s[1]=a,s[2]=h,s},p.setCacheLimits=function(s,r){tc=s,th=r},p.setColumn=function(s,r,a){s[4*r+0]=a[0],s[4*r+1]=a[1],s[4*r+2]=a[2],s[4*r+3]=a[3]},p.setRTLTextPlugin=function(s,r,a=!1){if(g===Fp||g===Mh||g===_r)throw new Error("setRTLTextPlugin cannot be called multiple times.");c=ss.resolveURL(s),g=Fp,ho=r,v(),a||M()},p.smoothstep=cl,p.spec=ze,p.squaredLength=function(s){var r=s[0],a=s[1],h=s[2];return r*r+a*a+h*h},p.storeAuthState=function(s,r){r?Ur.add(s):Ur.delete(s)},p.sub=So,p.subtract=Bp,p.symbolSize=$1,p.tileAABB=function(s,r,a,h,f,_,x,w,D){if("globe"===D.name)return function v1(s,r,a){const h=r/s.worldSize,f=s.globeMatrix;if(a.z<=1){const Ee=Nl(a).getCorners();return y1(Ee,f,h),vr.fromPoints(Ee)}const _=pf(a),x=mf(_);y1(x,f,h);const w=Number.MAX_VALUE,D=[-w,-w,-w],S=[w,w,w];if(_.contains(s.center)){for(const Ge of x)uf(S,S,Ge),hf(D,D,Ge);D[2]=0;const Ee=s.point,Oe=[Ee.x*h,Ee.y*h,0];return uf(S,S,Oe),hf(D,D,Oe),new vr(S,D)}const P=[f[12]*h,f[13]*h,f[14]*h],R=_.getCenter(),O=hn(s.center.lat,-Lr,Lr),N=hn(R.lat,-Lr,Lr),B=Ci(s.center.lng),$=Zo(O);let Z=B-Ci(R.lng);const te=$-Zo(N);Z>.5?Z-=1:Z<-.5&&(Z+=1);let ce=0;Math.abs(Z)>Math.abs(te)?ce=Z>=0?1:3:(ce=te>=0?0:2,df(P,P,[f[4]*h,f[5]*h,f[6]*h],-Math.sin(an(te>=0?_.getSouth():_.getNorth()))*da));const ne=x[ce],ae=x[(ce+1)%4],pe=new Bg(ne,ae,P),he=[mv(pe,0)||ne[0],mv(pe,1)||ne[1],mv(pe,2)||ne[2]],Me=Cc(s.zoom);if(Me>0){const Ee=function({x:Ge,y:Ae,z:Be},Ve,He,Ke,Le){const rt=1/(1<<Be);let dt=Ge*rt,ot=dt+rt,Bt=Ae*rt,et=Bt+rt,Et=0;const Vt=(dt+ot)/2-Ke;return Vt>.5?Et=-1:Vt<-.5&&(Et=1),dt=((dt+Et)*Ve-(Ke*=Ve))*He+Ke,ot=((ot+Et)*Ve-Ke)*He+Ke,Bt=(Bt*Ve-(Le*=Ve))*He+Le,et=(et*Ve-Le)*He+Le,[[dt,et,0],[ot,et,0],[ot,Bt,0],[dt,Bt,0]]}(a,r,s._pixelsPerMercatorPixel,B,$);for(let Ge=0;Ge<x.length;Ge++)Nh(x[Ge],Ee[Ge],Me);const Oe=xc([],Ee[ce],Ee[(ce+1)%4]);ms(Oe,Oe,.5),Nh(he,Oe,Me)}for(const Ee of x)uf(S,S,Ee),hf(D,D,Ee);return S[2]=Math.min(ne[2],ae[2]),uf(S,S,he),hf(D,D,he),new vr(S,D)}(s,r,new am(a,h,f));const S=Au({z:a,x:h,y:f},D);return new vr([(_+S.x/S.scale)*r,r*(S.y/S.scale),x],[(_+S.x2/S.scale)*r,r*(S.y2/S.scale),w])},p.tileCornersToBounds=pf,p.tileTransform=Au,p.transformMat3=function(s,r,a){var h=r[0],f=r[1],_=r[2];return s[0]=h*a[0]+f*a[3]+_*a[6],s[1]=h*a[1]+f*a[4]+_*a[7],s[2]=h*a[2]+f*a[5]+_*a[8],s},p.transformMat4=yi,p.transformMat4$1=bc,p.transformQuat=Oh,p.transitionTileAABBinECEF=_1,p.translate=ua,p.transpose=function(s,r){if(s===r){var a=r[1],h=r[2],f=r[5];s[1]=r[3],s[2]=r[6],s[3]=a,s[5]=r[7],s[6]=h,s[7]=f}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return s},p.triggerPluginCompletionEvent=d,p.uniqueId=ro,p.updateGlobeVertexNormal=function(s,r,a,h,f){const _=5*r+2;s.float32[_+0]=a,s.float32[_+1]=h,s.float32[_+2]=f},p.validateCustomStyleLayer=function(s){const r=[],a=s.id;return void 0===a&&r.push({message:`layers.${a}: missing required property "id"`}),void 0===s.render&&r.push({message:`layers.${a}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},p.validateFilter=s=>uo(fu(s)),p.validateFog=s=>uo(Ml(s)),p.validateLayer=s=>uo(tf(s)),p.validateLight=s=>uo(kp(s)),p.validateSource=s=>uo(pu(s)),p.validateStyle=Rp,p.validateTerrain=s=>uo(Eh(s)),p.values=wa,p.vectorTile=rm,p.version=Ds,p.warnOnce=ui,p.window=Ue,p.wrap=fn}),Od(0,function(p){function Ue(ue){if("number"==typeof ue||"boolean"==typeof ue||"string"==typeof ue||null==ue)return JSON.stringify(ue);if(Array.isArray(ue)){let W="[";for(const se of ue)W+=`${Ue(se)},`;return`${W}]`}let G="{";for(const W of Object.keys(ue).sort())G+=`${W}:${Ue(ue[W])},`;return`${G}}`}function Ds(ue){let G="";for(const W of p.refProperties)G+=`/${Ue(ue[W])}`;return G}class Lo{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,W){for(const me of G)this._layerConfigs[me.id]=me,(this._layers[me.id]=p.createStyleLayer(me)).compileFilter(),this.keyCache[me.id]&&delete this.keyCache[me.id];for(const me of W)delete this.keyCache[me],delete this._layerConfigs[me],delete this._layers[me];this.familiesBySource={};const se=function(me,ye){const De={};for(let _e=0;_e<me.length;_e++){const ke=ye&&ye[me[_e].id]||Ds(me[_e]);ye&&(ye[me[_e].id]=ke);let tt=De[ke];tt||(tt=De[ke]=[]),tt.push(me[_e])}const Ce=[];for(const _e in De)Ce.push(De[_e]);return Ce}(p.values(this._layerConfigs),this.keyCache);for(const me of se){const ye=me.map(it=>this._layers[it.id]),De=ye[0];if("none"===De.visibility)continue;const Ce=De.source||"";let _e=this.familiesBySource[Ce];_e||(_e=this.familiesBySource[Ce]={});const ke=De.sourceLayer||"_geojsonTileLayer";let tt=_e[ke];tt||(tt=_e[ke]=[]),tt.push(ye)}}}class Kt{loadTile(G,W){const{uid:se,encoding:me,rawImageData:ye,padding:De,buildQuadTree:Ce}=G,_e=p.window.ImageBitmap&&ye instanceof p.window.ImageBitmap?this.getImageData(ye,De):ye;W(null,new p.DEMData(se,_e,me,De<1,Ce))}getImageData(G,W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);const se=this.offscreenCanvasContext.getImageData(-W,-W,G.width+2*W,G.height+2*W);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),se}}function Zt(ue,G){if(0!==ue.length){Zi(ue[0],G);for(var W=1;W<ue.length;W++)Zi(ue[W],!G)}}function Zi(ue,G){for(var W=0,se=0,me=0,ye=ue.length,De=ye-1;me<ye;De=me++){var Ce=(ue[me][0]-ue[De][0])*(ue[De][1]+ue[me][1]),_e=W+Ce;se+=Math.abs(W)>=Math.abs(Ce)?W-_e+Ce:Ce-_e+W,W=_e}W+se>=0!=!!G&&ue.reverse()}var jr=p.getDefaultExportFromCjs(function ue(G,W){var se,me=G&&G.type;if("FeatureCollection"===me)for(se=0;se<G.features.length;se++)ue(G.features[se],W);else if("GeometryCollection"===me)for(se=0;se<G.geometries.length;se++)ue(G.geometries[se],W);else if("Feature"===me)ue(G.geometry,W);else if("Polygon"===me)Zt(G.coordinates,W);else if("MultiPolygon"===me)for(se=0;se<G.coordinates.length;se++)Zt(G.coordinates[se],W);return G});const ns=p.VectorTileFeature.prototype.toGeoJSON;var qs={exports:{}},Gc=p.pointGeometry,Jl=p.vectorTile.VectorTileFeature,yo=Fo;function Fo(ue,G){this.options=G||{},this.features=ue,this.length=ue.length}function io(ue,G){this.id="number"==typeof ue.id?ue.id:void 0,this.type=ue.type,this.rawGeometry=1===ue.type?[ue.geometry]:ue.geometry,this.properties=ue.tags,this.extent=G||4096}Fo.prototype.feature=function(ue){return new io(this.features[ue],this.options.extent)},io.prototype.loadGeometry=function(){var ue=this.rawGeometry;this.geometry=[];for(var G=0;G<ue.length;G++){for(var W=ue[G],se=[],me=0;me<W.length;me++)se.push(new Gc(W[me][0],W[me][1]));this.geometry.push(se)}return this.geometry},io.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ue=this.geometry,G=1/0,W=-1/0,se=1/0,me=-1/0,ye=0;ye<ue.length;ye++)for(var De=ue[ye],Ce=0;Ce<De.length;Ce++){var _e=De[Ce];G=Math.min(G,_e.x),W=Math.max(W,_e.x),se=Math.min(se,_e.y),me=Math.max(me,_e.y)}return[G,se,W,me]},io.prototype.toGeoJSON=Jl.prototype.toGeoJSON;var sl=p.pbf,Zs=yo;function is(ue){var G=new sl;return function(W,se){for(var me in W.layers)se.writeMessage(3,st,W.layers[me])}(ue,G),G.finish()}function st(ue,G){var W;G.writeVarintField(15,ue.version||1),G.writeStringField(1,ue.name||""),G.writeVarintField(5,ue.extent||4096);var se={keys:[],values:[],keycache:{},valuecache:{}};for(W=0;W<ue.length;W++)se.feature=ue.feature(W),G.writeMessage(2,Ld,se);var me=se.keys;for(W=0;W<me.length;W++)G.writeStringField(3,me[W]);var ye=se.values;for(W=0;W<ye.length;W++)G.writeMessage(4,Ju,ye[W])}function Ld(ue,G){var W=ue.feature;void 0!==W.id&&G.writeVarintField(1,W.id),G.writeMessage(2,al,ue),G.writeVarintField(3,W.type),G.writeMessage(4,Wc,W)}function al(ue,G){var W=ue.feature,se=ue.keys,me=ue.values,ye=ue.keycache,De=ue.valuecache;for(var Ce in W.properties){var _e=W.properties[Ce],ke=ye[Ce];if(null!==_e){void 0===ke&&(se.push(Ce),ye[Ce]=ke=se.length-1),G.writeVarint(ke);var tt=typeof _e;"string"!==tt&&"boolean"!==tt&&"number"!==tt&&(_e=JSON.stringify(_e));var it=tt+":"+_e,Je=De[it];void 0===Je&&(me.push(_e),De[it]=Je=me.length-1),G.writeVarint(Je)}}}function an(ue,G){return(G<<3)+(7&ue)}function or(ue){return ue<<1^ue>>31}function Wc(ue,G){for(var W=ue.loadGeometry(),se=ue.type,me=0,ye=0,De=W.length,Ce=0;Ce<De;Ce++){var _e=W[Ce],ke=1;1===se&&(ke=_e.length),G.writeVarint(an(1,ke));for(var tt=3===se?_e.length-1:_e.length,it=0;it<tt;it++){1===it&&1!==se&&G.writeVarint(an(2,tt-1));var Je=_e[it].x-me,Gt=_e[it].y-ye;G.writeVarint(or(Je)),G.writeVarint(or(Gt)),me+=Je,ye+=Gt}3===se&&G.writeVarint(an(7,1))}}function Ju(ue,G){var W=typeof ue;"string"===W?G.writeStringField(1,ue):"boolean"===W?G.writeBooleanField(7,ue):"number"===W&&(ue%1!=0?G.writeDoubleField(3,ue):ue<0?G.writeSVarintField(6,ue):G.writeVarintField(5,ue))}qs.exports=is,qs.exports.fromVectorTileJs=is,qs.exports.fromGeojsonVt=function(ue,G){G=G||{};var W={};for(var se in ue)W[se]=new Zs(ue[se].features,G),W[se].name=se,W[se].version=G.version,W[se].extent=G.extent;return is({layers:W})},qs.exports.GeoJSONWrapper=Zs;var ll=p.getDefaultExportFromCjs(qs.exports);const rs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ue=>ue},hn=Math.fround||(cl=new Float32Array(1),ue=>(cl[0]=+ue,cl[0]));var cl;const fn=3,Xi=5,wa=6;class ki{constructor(G){this.options=Object.assign(Object.create(rs),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:W,minZoom:se,maxZoom:me}=this.options;W&&console.time("total time");const ye=`prepare ${G.length} points`;W&&console.time(ye),this.points=G;const De=[];for(let _e=0;_e<G.length;_e++){const ke=G[_e];if(!ke.geometry)continue;const[tt,it]=ke.geometry.coordinates,Je=hn(Xs(tt)),Gt=hn(Ts(it));De.push(Je,Gt,1/0,_e,-1,1),this.options.reduce&&De.push(0)}let Ce=this.trees[me+1]=this._createTree(De);W&&console.timeEnd(ye);for(let _e=me;_e>=se;_e--){const ke=+Date.now();Ce=this.trees[_e]=this._createTree(this._cluster(Ce,_e)),W&&console.log("z%d: %d clusters in %dms",_e,Ce.numItems,+Date.now()-ke)}return W&&console.timeEnd("total time"),this}getClusters(G,W){let se=((G[0]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,G[1]));let ye=180===G[2]?180:((G[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)se=-180,ye=180;else if(se>ye){const it=this.getClusters([se,me,180,De],W),Je=this.getClusters([-180,me,ye,De],W);return it.concat(Je)}const Ce=this.trees[this._limitZoom(W)],_e=Ce.range(Xs(se),Ts(De),Xs(ye),Ts(me)),ke=Ce.data,tt=[];for(const it of _e){const Je=this.stride*it;tt.push(ke[Je+Xi]>1?Ca(ke,Je,this.clusterProps):this.points[ke[Je+fn]])}return tt}getChildren(G){const W=this._getOriginId(G),se=this._getOriginZoom(G),me="No cluster with the specified id.",ye=this.trees[se];if(!ye)throw new Error(me);const De=ye.data;if(W*this.stride>=De.length)throw new Error(me);const Ce=this.options.radius/(this.options.extent*Math.pow(2,se-1)),_e=ye.within(De[W*this.stride],De[W*this.stride+1],Ce),ke=[];for(const tt of _e){const it=tt*this.stride;De[it+4]===G&&ke.push(De[it+Xi]>1?Ca(De,it,this.clusterProps):this.points[De[it+fn]])}if(0===ke.length)throw new Error(me);return ke}getLeaves(G,W,se){const me=[];return this._appendLeaves(me,G,W=W||10,se=se||0,0),me}getTile(G,W,se){const me=this.trees[this._limitZoom(G)],ye=Math.pow(2,G),{extent:De,radius:Ce}=this.options,_e=Ce/De,ke=(se-_e)/ye,tt=(se+1+_e)/ye,it={features:[]};return this._addTileFeatures(me.range((W-_e)/ye,ke,(W+1+_e)/ye,tt),me.data,W,se,ye,it),0===W&&this._addTileFeatures(me.range(1-_e/ye,ke,1,tt),me.data,ye,se,ye,it),W===ye-1&&this._addTileFeatures(me.range(0,ke,_e/ye,tt),me.data,-1,se,ye,it),it.features.length?it:null}getClusterExpansionZoom(G){let W=this._getOriginZoom(G)-1;for(;W<=this.options.maxZoom;){const se=this.getChildren(G);if(W++,1!==se.length)break;G=se[0].properties.cluster_id}return W}_appendLeaves(G,W,se,me,ye){const De=this.getChildren(W);for(const Ce of De){const _e=Ce.properties;if(_e&&_e.cluster?ye+_e.point_count<=me?ye+=_e.point_count:ye=this._appendLeaves(G,_e.cluster_id,se,me,ye):ye<me?ye++:G.push(Ce),G.length===se)break}return ye}_createTree(G){const W=new p.KDBush(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let se=0;se<G.length;se+=this.stride)W.add(G[se],G[se+1]);return W.finish(),W.data=G,W}_addTileFeatures(G,W,se,me,ye,De){for(const Ce of G){const _e=Ce*this.stride,ke=W[_e+Xi]>1;let tt,it,Je;if(ke)tt=ro(W,_e,this.clusterProps),it=W[_e],Je=W[_e+1];else{const Ut=this.points[W[_e+fn]];tt=Ut.properties;const[tn,pn]=Ut.geometry.coordinates;it=Xs(tn),Je=Ts(pn)}const Gt={type:1,geometry:[[Math.round(this.options.extent*(it*ye-se)),Math.round(this.options.extent*(Je*ye-me))]],tags:tt};let en;en=ke||this.options.generateId?W[_e+fn]:this.points[W[_e+fn]].id,void 0!==en&&(Gt.id=en),De.features.push(Gt)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,W){const{radius:se,extent:me,reduce:ye,minPoints:De}=this.options,Ce=se/(me*Math.pow(2,W)),_e=G.data,ke=[],tt=this.stride;for(let it=0;it<_e.length;it+=tt){if(_e[it+2]<=W)continue;_e[it+2]=W;const Je=_e[it],Gt=_e[it+1],en=G.within(_e[it],_e[it+1],Ce),Ut=_e[it+Xi];let tn=Ut;for(const pn of en){const xn=pn*tt;_e[xn+2]>W&&(tn+=_e[xn+Xi])}if(tn>Ut&&tn>=De){let pn,xn=Je*Ut,Ri=Gt*Ut,Dr=-1;const ji=((it/tt|0)<<5)+(W+1)+this.points.length;for(const Ss of en){const Yi=Ss*tt;if(_e[Yi+2]<=W)continue;_e[Yi+2]=W;const Ur=_e[Yi+Xi];xn+=_e[Yi]*Ur,Ri+=_e[Yi+1]*Ur,_e[Yi+4]=ji,ye&&(pn||(pn=this._map(_e,it,!0),Dr=this.clusterProps.length,this.clusterProps.push(pn)),ye(pn,this._map(_e,Yi)))}_e[it+4]=ji,ke.push(xn/tn,Ri/tn,1/0,ji,-1,tn),ye&&ke.push(Dr)}else{for(let pn=0;pn<tt;pn++)ke.push(_e[it+pn]);if(tn>1)for(const pn of en){const xn=pn*tt;if(!(_e[xn+2]<=W)){_e[xn+2]=W;for(let Ri=0;Ri<tt;Ri++)ke.push(_e[xn+Ri])}}}}return ke}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,W,se){if(G[W+Xi]>1){const De=this.clusterProps[G[W+wa]];return se?Object.assign({},De):De}const me=this.points[G[W+fn]].properties,ye=this.options.map(me);return se&&ye===me?Object.assign({},ye):ye}}function Ca(ue,G,W){return{type:"Feature",id:ue[G+fn],properties:ro(ue,G,W),geometry:{type:"Point",coordinates:[(se=ue[G],360*(se-.5)),gi(ue[G+1])]}};var se}function ro(ue,G,W){const se=ue[G+Xi],me=se>=1e4?`${Math.round(se/1e3)}k`:se>=1e3?Math.round(se/100)/10+"k":se,ye=ue[G+wa],De=-1===ye?{}:Object.assign({},W[ye]);return Object.assign(De,{cluster:!0,cluster_id:ue[G+fn],point_count:se,point_count_abbreviated:me})}function Xs(ue){return ue/360+.5}function Ts(ue){const G=Math.sin(ue*Math.PI/180),W=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return W<0?0:W>1?1:W}function gi(ue){const G=(180-360*ue)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function Yn(ue,G,W,se){for(var me,ye=se,De=W-G>>1,Ce=W-G,_e=ue[G],ke=ue[G+1],tt=ue[W],it=ue[W+1],Je=G+3;Je<W;Je+=3){var Gt=Ql(ue[Je],ue[Je+1],_e,ke,tt,it);if(Gt>ye)me=Je,ye=Gt;else if(Gt===ye){var en=Math.abs(Je-De);en<Ce&&(me=Je,Ce=en)}}ye>se&&(me-G>3&&Yn(ue,G,me,se),ue[me+2]=ye,W-me>3&&Yn(ue,me,W,se))}function Ql(ue,G,W,se,me,ye){var De=me-W,Ce=ye-se;if(0!==De||0!==Ce){var _e=((ue-W)*De+(G-se)*Ce)/(De*De+Ce*Ce);_e>1?(W=me,se=ye):_e>0&&(W+=De*_e,se+=Ce*_e)}return(De=ue-W)*De+(Ce=G-se)*Ce}function ht(ue,G,W,se){var me={id:void 0===ue?null:ue,type:G,geometry:W,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ye){var De=ye.geometry,Ce=ye.type;if("Point"===Ce||"MultiPoint"===Ce||"LineString"===Ce)Ea(ye,De);else if("Polygon"===Ce||"MultiLineString"===Ce)for(var _e=0;_e<De.length;_e++)Ea(ye,De[_e]);else if("MultiPolygon"===Ce)for(_e=0;_e<De.length;_e++)for(var ke=0;ke<De[_e].length;ke++)Ea(ye,De[_e][ke])}(me),me}function Ea(ue,G){for(var W=0;W<G.length;W+=3)ue.minX=Math.min(ue.minX,G[W]),ue.minY=Math.min(ue.minY,G[W+1]),ue.maxX=Math.max(ue.maxX,G[W]),ue.maxY=Math.max(ue.maxY,G[W+1])}function vo(ue,G,W,se){if(G.geometry){var me=G.geometry.coordinates,ye=G.geometry.type,De=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2),Ce=[],_e=G.id;if(W.promoteId?_e=G.properties[W.promoteId]:W.generateId&&(_e=se||0),"Point"===ye)ul(me,Ce);else if("MultiPoint"===ye)for(var ke=0;ke<me.length;ke++)ul(me[ke],Ce);else if("LineString"===ye)ui(me,Ce,De,!1);else if("MultiLineString"===ye){if(W.lineMetrics){for(ke=0;ke<me.length;ke++)ui(me[ke],Ce=[],De,!1),ue.push(ht(_e,"LineString",Ce,G.properties));return}zo(me,Ce,De,!1)}else if("Polygon"===ye)zo(me,Ce,De,!0);else{if("MultiPolygon"!==ye){if("GeometryCollection"===ye){for(ke=0;ke<G.geometry.geometries.length;ke++)vo(ue,{id:_e,geometry:G.geometry.geometries[ke],properties:G.properties},W,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ke=0;ke<me.length;ke++){var tt=[];zo(me[ke],tt,De,!0),Ce.push(tt)}}ue.push(ht(_e,ye,Ce,G.properties))}}function ul(ue,G){G.push(Qu(ue[0])),G.push(Da(ue[1])),G.push(0)}function ui(ue,G,W,se){for(var me,ye,De=0,Ce=0;Ce<ue.length;Ce++){var _e=Qu(ue[Ce][0]),ke=Da(ue[Ce][1]);G.push(_e),G.push(ke),G.push(0),Ce>0&&(De+=se?(me*ke-_e*ye)/2:Math.sqrt(Math.pow(_e-me,2)+Math.pow(ke-ye,2))),me=_e,ye=ke}var tt=G.length-3;G[2]=1,Yn(G,0,tt,W),G[tt+2]=1,G.size=Math.abs(De),G.start=0,G.end=G.size}function zo(ue,G,W,se){for(var me=0;me<ue.length;me++){var ye=[];ui(ue[me],ye,W,se),G.push(ye)}}function Qu(ue){return ue/360+.5}function Da(ue){var G=Math.sin(ue*Math.PI/180),W=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return W<0?0:W>1?1:W}function No(ue,G,W,se,me,ye,De,Ce){if(se/=G,ye>=(W/=G)&&De<se)return ue;if(De<W||ye>=se)return null;for(var _e=[],ke=0;ke<ue.length;ke++){var tt=ue[ke],it=tt.geometry,Je=tt.type,Gt=0===me?tt.minX:tt.minY,en=0===me?tt.maxX:tt.maxY;if(Gt>=W&&en<se)_e.push(tt);else if(!(en<W||Gt>=se)){var Ut=[];if("Point"===Je||"MultiPoint"===Je)eh(it,Ut,W,se,me);else if("LineString"===Je)qc(it,Ut,W,se,me,!1,Ce.lineMetrics);else if("MultiLineString"===Je)Ys(it,Ut,W,se,me,!1);else if("Polygon"===Je)Ys(it,Ut,W,se,me,!0);else if("MultiPolygon"===Je)for(var tn=0;tn<it.length;tn++){var pn=[];Ys(it[tn],pn,W,se,me,!0),pn.length&&Ut.push(pn)}if(Ut.length){if(Ce.lineMetrics&&"LineString"===Je){for(tn=0;tn<Ut.length;tn++)_e.push(ht(tt.id,Je,Ut[tn],tt.tags));continue}"LineString"!==Je&&"MultiLineString"!==Je||(1===Ut.length?(Je="LineString",Ut=Ut[0]):Je="MultiLineString"),"Point"!==Je&&"MultiPoint"!==Je||(Je=3===Ut.length?"Point":"MultiPoint"),_e.push(ht(tt.id,Je,Ut,tt.tags))}}}return _e.length?_e:null}function eh(ue,G,W,se,me){for(var ye=0;ye<ue.length;ye+=3){var De=ue[ye+me];De>=W&&De<=se&&(G.push(ue[ye]),G.push(ue[ye+1]),G.push(ue[ye+2]))}}function qc(ue,G,W,se,me,ye,De){for(var Ce,_e,ke=Zc(ue),tt=0===me?tc:th,it=ue.start,Je=0;Je<ue.length-3;Je+=3){var Gt=ue[Je],en=ue[Je+1],Ut=ue[Je+2],tn=ue[Je+3],pn=ue[Je+4],xn=0===me?Gt:en,Ri=0===me?tn:pn,Dr=!1;De&&(Ce=Math.sqrt(Math.pow(Gt-tn,2)+Math.pow(en-pn,2))),xn<W?Ri>W&&(_e=tt(ke,Gt,en,tn,pn,W),De&&(ke.start=it+Ce*_e)):xn>se?Ri<se&&(_e=tt(ke,Gt,en,tn,pn,se),De&&(ke.start=it+Ce*_e)):ec(ke,Gt,en,Ut),Ri<W&&xn>=W&&(_e=tt(ke,Gt,en,tn,pn,W),Dr=!0),Ri>se&&xn<=se&&(_e=tt(ke,Gt,en,tn,pn,se),Dr=!0),!ye&&Dr&&(De&&(ke.end=it+Ce*_e),G.push(ke),ke=Zc(ue)),De&&(it+=Ce)}var ji=ue.length-3;Gt=ue[ji],en=ue[ji+1],Ut=ue[ji+2],(xn=0===me?Gt:en)>=W&&xn<=se&&ec(ke,Gt,en,Ut),ji=ke.length-3,ye&&ji>=3&&(ke[ji]!==ke[0]||ke[ji+1]!==ke[1])&&ec(ke,ke[0],ke[1],ke[2]),ke.length&&G.push(ke)}function Zc(ue){var G=[];return G.size=ue.size,G.start=ue.start,G.end=ue.end,G}function Ys(ue,G,W,se,me,ye){for(var De=0;De<ue.length;De++)qc(ue[De],G,W,se,me,ye,!1)}function ec(ue,G,W,se){ue.push(G),ue.push(W),ue.push(se)}function tc(ue,G,W,se,me,ye){var De=(ye-G)/(se-G);return ue.push(ye),ue.push(W+(me-W)*De),ue.push(1),De}function th(ue,G,W,se,me,ye){var De=(ye-W)/(me-W);return ue.push(G+(se-G)*De),ue.push(ye),ue.push(1),De}function oo(ue,G){for(var W=[],se=0;se<ue.length;se++){var me,ye=ue[se],De=ye.type;if("Point"===De||"MultiPoint"===De||"LineString"===De)me=Ks(ye.geometry,G);else if("MultiLineString"===De||"Polygon"===De){me=[];for(var Ce=0;Ce<ye.geometry.length;Ce++)me.push(Ks(ye.geometry[Ce],G))}else if("MultiPolygon"===De)for(me=[],Ce=0;Ce<ye.geometry.length;Ce++){for(var _e=[],ke=0;ke<ye.geometry[Ce].length;ke++)_e.push(Ks(ye.geometry[Ce][ke],G));me.push(_e)}W.push(ht(ye.id,De,me,ye.tags))}return W}function Ks(ue,G){var W=[];W.size=ue.size,void 0!==ue.start&&(W.start=ue.start,W.end=ue.end);for(var se=0;se<ue.length;se+=3)W.push(ue[se]+G,ue[se+1],ue[se+2]);return W}function Xc(ue,G){if(ue.transformed)return ue;var W,se,me,ye=1<<ue.z,De=ue.x,Ce=ue.y;for(W=0;W<ue.features.length;W++){var _e=ue.features[W],ke=_e.geometry,tt=_e.type;if(_e.geometry=[],1===tt)for(se=0;se<ke.length;se+=2)_e.geometry.push(hl(ke[se],ke[se+1],G,ye,De,Ce));else for(se=0;se<ke.length;se++){var it=[];for(me=0;me<ke[se].length;me+=2)it.push(hl(ke[se][me],ke[se][me+1],G,ye,De,Ce));_e.geometry.push(it)}}return ue.transformed=!0,ue}function hl(ue,G,W,se,me,ye){return[Math.round(W*(ue*se-me)),Math.round(W*(G*se-ye))]}function nc(ue,G,W,se,me){for(var ye=G===me.maxZoom?0:me.tolerance/((1<<G)*me.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:W,y:se,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ce=0;Ce<ue.length;Ce++){De.numFeatures++,Bo(De,ue[Ce],ye,me);var _e=ue[Ce].minX,ke=ue[Ce].minY,tt=ue[Ce].maxX,it=ue[Ce].maxY;_e<De.minX&&(De.minX=_e),ke<De.minY&&(De.minY=ke),tt>De.maxX&&(De.maxX=tt),it>De.maxY&&(De.maxY=it)}return De}function Bo(ue,G,W,se){var me=G.geometry,ye=G.type,De=[];if("Point"===ye||"MultiPoint"===ye)for(var Ce=0;Ce<me.length;Ce+=3)De.push(me[Ce]),De.push(me[Ce+1]),ue.numPoints++,ue.numSimplified++;else if("LineString"===ye)Ta(De,me,ue,W,!1,!1);else if("MultiLineString"===ye||"Polygon"===ye)for(Ce=0;Ce<me.length;Ce++)Ta(De,me[Ce],ue,W,"Polygon"===ye,0===Ce);else if("MultiPolygon"===ye)for(var _e=0;_e<me.length;_e++){var ke=me[_e];for(Ce=0;Ce<ke.length;Ce++)Ta(De,ke[Ce],ue,W,!0,0===Ce)}if(De.length){var tt=G.tags||null;if("LineString"===ye&&se.lineMetrics){for(var it in tt={},G.tags)tt[it]=G.tags[it];tt.mapbox_clip_start=me.start/me.size,tt.mapbox_clip_end=me.end/me.size}var Je={geometry:De,type:"Polygon"===ye||"MultiPolygon"===ye?3:"LineString"===ye||"MultiLineString"===ye?2:1,tags:tt};null!==G.id&&(Je.id=G.id),ue.features.push(Je)}}function Ta(ue,G,W,se,me,ye){var De=se*se;if(se>0&&G.size<(me?De:se))W.numPoints+=G.length/3;else{for(var Ce=[],_e=0;_e<G.length;_e+=3)(0===se||G[_e+2]>De)&&(W.numSimplified++,Ce.push(G[_e]),Ce.push(G[_e+1])),W.numPoints++;me&&function(ke,tt){for(var it=0,Je=0,Gt=ke.length,en=Gt-2;Je<Gt;en=Je,Je+=2)it+=(ke[Je]-ke[en])*(ke[Je+1]+ke[en+1]);if(it>0===tt)for(Je=0,Gt=ke.length;Je<Gt/2;Je+=2){var Ut=ke[Je],tn=ke[Je+1];ke[Je]=ke[Gt-2-Je],ke[Je+1]=ke[Gt-1-Je],ke[Gt-2-Je]=Ut,ke[Gt-1-Je]=tn}}(Ce,ye),ue.push(Ce)}}function Sa(ue,G){var W=(G=this.options=function(me,ye){for(var De in ye)me[De]=ye[De];return me}(Object.create(this.options),G)).debug;if(W&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");var me,ye,De,Ce,_e,ke,se=function(me,ye){var De=[];if("FeatureCollection"===me.type)for(var Ce=0;Ce<me.features.length;Ce++)vo(De,me.features[Ce],ye,Ce);else vo(De,"Feature"===me.type?me:{geometry:me},ye);return De}(ue,G);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ce=me=se,_e=No(me,1,-1-(De=(ye=G).buffer/ye.extent),De,0,-1,2,ye),ke=No(me,1,1-De,2+De,0,-1,2,ye),(_e||ke)&&(Ce=No(me,1,-De,1+De,0,-1,2,ye)||[],_e&&(Ce=oo(_e,1).concat(Ce)),ke&&(Ce=Ce.concat(oo(ke,-1)))),(se=Ce).length&&this.splitTile(se,0,0,0),W&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ma(ue,G,W){return 32*((1<<ue)*W+G)+ue}function dl(ue,G){const W=ue.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);const se=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!se)return G(null,null);const me=new class{constructor(De){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=De.length,this._features=De}feature(De){return new class{constructor(Ce){this._feature=Ce,this.extent=p.EXTENT,this.type=Ce.type,this.properties=Ce.tags,"id"in Ce&&!isNaN(Ce.id)&&(this.id=parseInt(Ce.id,10))}loadGeometry(){if(1===this._feature.type){const Ce=[];for(const _e of this._feature.geometry)Ce.push([new p.Point(_e[0],_e[1])]);return Ce}{const Ce=[];for(const _e of this._feature.geometry){const ke=[];for(const tt of _e)ke.push(new p.Point(tt[0],tt[1]));Ce.push(ke)}return Ce}}toGeoJSON(Ce,_e,ke){return ns.call(this,Ce,_e,ke)}}(this._features[De])}}(se.features);let ye=ll(me);0===ye.byteOffset&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),G(null,{vectorTile:me,rawData:ye.buffer})}Sa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Sa.prototype.splitTile=function(ue,G,W,se,me,ye,De){for(var Ce=[ue,G,W,se],_e=this.options,ke=_e.debug;Ce.length;){se=Ce.pop(),W=Ce.pop(),G=Ce.pop(),ue=Ce.pop();var tt=1<<G,it=Ma(G,W,se),Je=this.tiles[it];if(!Je&&(ke>1&&console.time("creation"),Je=this.tiles[it]=nc(ue,G,W,se,_e),this.tileCoords.push({z:G,x:W,y:se}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,W,se,Je.numFeatures,Je.numPoints,Je.numSimplified),console.timeEnd("creation"));var Gt="z"+G;this.stats[Gt]=(this.stats[Gt]||0)+1,this.total++}if(Je.source=ue,me){if(G===_e.maxZoom||G===me)continue;var en=1<<me-G;if(W!==Math.floor(ye/en)||se!==Math.floor(De/en))continue}else if(G===_e.indexMaxZoom||Je.numPoints<=_e.indexMaxPoints)continue;if(Je.source=null,0!==ue.length){ke>1&&console.time("clipping");var Ut,tn,pn,xn,Ri,Dr,ji=.5*_e.buffer/_e.extent,Ss=.5-ji,Yi=.5+ji,Ur=1+ji;Ut=tn=pn=xn=null,Ri=No(ue,tt,W-ji,W+Yi,0,Je.minX,Je.maxX,_e),Dr=No(ue,tt,W+Ss,W+Ur,0,Je.minX,Je.maxX,_e),ue=null,Ri&&(Ut=No(Ri,tt,se-ji,se+Yi,1,Je.minY,Je.maxY,_e),tn=No(Ri,tt,se+Ss,se+Ur,1,Je.minY,Je.maxY,_e),Ri=null),Dr&&(pn=No(Dr,tt,se-ji,se+Yi,1,Je.minY,Je.maxY,_e),xn=No(Dr,tt,se+Ss,se+Ur,1,Je.minY,Je.maxY,_e),Dr=null),ke>1&&console.timeEnd("clipping"),Ce.push(Ut||[],G+1,2*W,2*se),Ce.push(tn||[],G+1,2*W,2*se+1),Ce.push(pn||[],G+1,2*W+1,2*se),Ce.push(xn||[],G+1,2*W+1,2*se+1)}}},Sa.prototype.getTile=function(ue,G,W){var se=this.options,me=se.extent,ye=se.debug;if(ue<0||ue>24)return null;var De=1<<ue,Ce=Ma(ue,G=(G%De+De)%De,W);if(this.tiles[Ce])return Xc(this.tiles[Ce],me);ye>1&&console.log("drilling down to z%d-%d-%d",ue,G,W);for(var _e,ke=ue,tt=G,it=W;!_e&&ke>0;)ke--,tt=Math.floor(tt/2),it=Math.floor(it/2),_e=this.tiles[Ma(ke,tt,it)];return _e&&_e.source?(ye>1&&console.log("found parent tile z%d-%d-%d",ke,tt,it),ye>1&&console.time("drilling down"),this.splitTile(_e.source,ke,tt,it,ue,G,W),ye>1&&console.timeEnd("drilling down"),this.tiles[Ce]?Xc(this.tiles[Ce],me):null):null};class ic extends p.VectorTileWorkerSource{constructor(G,W,se,me,ye){super(G,W,se,me,dl),ye&&(this.loadGeoJSON=ye)}loadData(G,W){const se=G&&G.request,me=se&&se.collectResourceTiming;this.loadGeoJSON(G,(ye,De)=>{if(ye||!De)return W(ye);if("object"!=typeof De)return W(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{jr(De,!0);try{if(G.filter){const _e=p.createExpression(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===_e.result)throw new Error(_e.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));De={type:"FeatureCollection",features:De.features.filter(tt=>_e.value.evaluate({zoom:0},tt))}}this._geoJSONIndex=G.cluster?new ki(function({superclusterOptions:_e,clusterProperties:ke}){if(!ke||!_e)return _e;const tt={},it={},Je={accumulated:null,zoom:0},Gt={properties:null},en=Object.keys(ke);for(const Ut of en){const[tn,pn]=ke[Ut],xn=p.createExpression(pn),Ri=p.createExpression("string"==typeof tn?[tn,["accumulated"],["get",Ut]]:tn);tt[Ut]=xn.value,it[Ut]=Ri.value}return _e.map=Ut=>{Gt.properties=Ut;const tn={};for(const pn of en)tn[pn]=tt[pn].evaluate(Je,Gt);return tn},_e.reduce=(Ut,tn)=>{Gt.properties=tn;for(const pn of en)Je.accumulated=Ut[pn],Ut[pn]=it[pn].evaluate(Je,Gt)},_e}(G)).load(De.features):new Sa(_e=De,G.geojsonVtOptions)}catch(_e){return W(_e)}this.loaded={};const Ce={};if(me){const _e=p.getPerformanceMeasurement(se);_e&&(Ce.resourceTiming={},Ce.resourceTiming[G.source]=JSON.parse(JSON.stringify(_e)))}W(null,Ce)}var _e})}reloadTile(G,W){const se=this.loaded;return se&&se[G.uid]?super.reloadTile(G,W):this.loadTile(G,W)}loadGeoJSON(G,W){if(G.request)p.getJSON(G.request,W);else{if("string"!=typeof G.data)return W(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return W(null,JSON.parse(G.data))}catch{return W(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(se){W(se)}}getClusterChildren(G,W){try{W(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(se){W(se)}}getClusterLeaves(G,W){try{W(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(se){W(se)}}}class nh{constructor(G){this.self=G,this.actor=new p.Actor(G,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:ic},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(W,se)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=se},this.self.registerRTLTextPlugin=W=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=W.applyArabicShaping,p.plugin.processBidirectionalText=W.processBidirectionalText,p.plugin.processStyledBidirectionalText=W.processStyledBidirectionalText}}clearCaches(G,W,se){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],se()}checkIfReady(G,W,se){se()}setReferrer(G,W){this.referrer=W}spriteLoaded(G,W){this.isSpriteLoaded[G]=W;for(const se in this.workerSources[G]){const me=this.workerSources[G][se];for(const ye in me)me[ye]instanceof p.VectorTileWorkerSource&&(me[ye].isSpriteLoaded=W,me[ye].fire(new p.Event("isSpriteLoaded")))}}setImages(G,W,se){this.availableImages[G]=W;for(const me in this.workerSources[G]){const ye=this.workerSources[G][me];for(const De in ye)ye[De].availableImages=W}se()}enableTerrain(G,W,se){this.terrain=W,se()}setProjection(G,W){this.projections[G]=p.getProjection(W)}setLayers(G,W,se){this.getLayerIndex(G).replace(W),se()}updateLayers(G,W,se){this.getLayerIndex(G).update(W.layers,W.removedIds),se()}loadTile(G,W,se){const me=this.enableTerrain?p.extend({enableTerrain:this.terrain},W):W;me.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,W.type,W.source).loadTile(me,se)}loadDEMTile(G,W,se){const me=this.enableTerrain?p.extend({buildQuadTree:this.terrain},W):W;this.getDEMWorkerSource(G,W.source).loadTile(me,se)}reloadTile(G,W,se){const me=this.enableTerrain?p.extend({enableTerrain:this.terrain},W):W;me.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,W.type,W.source).reloadTile(me,se)}abortTile(G,W,se){this.getWorkerSource(G,W.type,W.source).abortTile(W,se)}removeTile(G,W,se){this.getWorkerSource(G,W.type,W.source).removeTile(W,se)}removeSource(G,W,se){if(!this.workerSources[G]||!this.workerSources[G][W.type]||!this.workerSources[G][W.type][W.source])return;const me=this.workerSources[G][W.type][W.source];delete this.workerSources[G][W.type][W.source],void 0!==me.removeSource?me.removeSource(W,se):se()}loadWorkerSource(G,W,se){try{this.self.importScripts(W.url),se()}catch(me){se(me.toString())}}syncRTLPluginState(G,W,se){try{p.plugin.setState(W);const me=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=me){this.self.importScripts(me);const ye=p.plugin.isParsed();se(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${me}`),ye)}}catch(me){se(me.toString())}}getAvailableImages(G){let W=this.availableImages[G];return W||(W=[]),W}getLayerIndex(G){let W=this.layerIndexes[G];return W||(W=this.layerIndexes[G]=new Lo),W}getWorkerSource(G,W,se){return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][W]||(this.workerSources[G][W]={}),this.workerSources[G][W][se]||(this.workerSources[G][W][se]=new this.workerSourceTypes[W]({send:(ye,De,Ce,_e,ke,tt)=>{this.actor.send(ye,De,Ce,G,ke,tt)},scheduler:this.actor.scheduler},this.getLayerIndex(G),this.getAvailableImages(G),this.isSpriteLoaded[G])),this.workerSources[G][W][se]}getDEMWorkerSource(G,W){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][W]||(this.demWorkerSources[G][W]=new Kt),this.demWorkerSources[G][W]}enforceCacheSizeLimit(G,W){p.enforceCacheSizeLimit(W)}getWorkerPerformanceMetrics(G,W,se){se(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new nh(self)),nh}),Od(0,function(p){function Ue(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let d=0;d<g.length;d++)if(!Ue(g[d],c[d]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==c){if("object"!=typeof c||Object.keys(g).length!==Object.keys(c).length)return!1;for(const d in g)if(!Ue(g[d],c[d]))return!1;return!0}return g===c}var Ds=Lo;function Lo(g){return c=g,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,b,E=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(E);try{b=new Worker(M),v=!0}catch{v=!1}return b&&b.terminate(),URL.revokeObjectURL(M),v}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var v=document.createElement("canvas");v.width=v.height=1;var b=v.getContext("2d");if(!b)return!1;var E=b.getImageData(0,0,1,1);return E&&E.width===v.width}()||(void 0===Kt[d=c&&c.failIfMajorPerformanceCaveat]&&(Kt[d]=function(v){var b,M,I,k,E=(M=v,I=document.createElement("canvas"),(k=Object.create(Lo.webGLContextAttributes)).failIfMajorPerformanceCaveat=M,I.getContext("webgl",k)||I.getContext("experimental-webgl",k));if(!E)return!1;try{b=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!b||E.isContextLost())&&(E.shaderSource(b,"void main() {}"),E.compileShader(b),!0===E.getShaderParameter(b,E.COMPILE_STATUS))}(d)),!Kt[d]||document.documentMode));var c,d}var Kt={};function Zt(g,c,d){const v=p.window.document.createElement(g);return void 0!==c&&(v.className=c),d&&d.appendChild(v),v}function Zi(g,c,d){const v=p.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const b of Object.keys(c))v.setAttributeNS(null,b,c[b]);return d&&d.appendChild(v),v}Lo.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const jr=p.window.document&&p.window.document.documentElement.style,ns=jr&&void 0!==jr.userSelect?"userSelect":"WebkitUserSelect";let qs;function Gc(){jr&&ns&&(qs=jr[ns],jr[ns]="none")}function Jl(){jr&&ns&&(jr[ns]=qs)}function yo(g){g.preventDefault(),g.stopPropagation(),p.window.removeEventListener("click",yo,!0)}function Fo(){p.window.addEventListener("click",yo,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",yo,!0)},0)}function io(g,c){const d=g.getBoundingClientRect();return is(g,d,c)}function sl(g,c){const d=g.getBoundingClientRect(),v=[];for(let b=0;b<c.length;b++)v.push(is(g,d,c[b]));return v}function Zs(g){return void 0!==p.window.InstallTrigger&&2===g.button&&g.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function is(g,c,d){const v=g.offsetWidth===c.width?1:g.offsetWidth/c.width;return new p.Point((d.clientX-c.left)*v,(d.clientY-c.top)*v)}function st(g,c){var d=c[0],v=c[1],b=c[2],E=c[3],M=d*E-b*v;return M?(g[0]=E*(M=1/M),g[1]=-v*M,g[2]=-b*M,g[3]=d*M,g):null}function Ld(g){const{userImage:c}=g;return!!(c&&c.render&&c.render())&&(g.data.replace(new Uint8Array(c.data.buffer)),!0)}class al extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:d,callback:v}of this.requestors)this._notify(d,v);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,d){this._validate(c,d)&&(this.images[c]=d)}_validate(c,d){let v=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),v=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),v=!1),this._validateContent(d.content,d)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),v=!1),v}_validateStretch(c,d){if(!c)return!0;let v=0;for(const b of c){if(b[0]<v||b[1]<b[0]||d<b[1])return!1;v=b[1]}return!0}_validateContent(c,d){return!(c&&(4!==c.length||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0}removeImage(c){const d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,d){let v=!0;if(!this.isLoaded())for(const b of c)this.images[b]||(v=!1);this.isLoaded()||v?this._notify(c,d):this.requestors.push({ids:c,callback:d})}_notify(c,d){const v={};for(const b of c){this.images[b]||this.fire(new p.Event("styleimagemissing",{id:b}));const E=this.images[b];E?v[b]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:Boolean(E.userImage&&E.userImage.render)}:p.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,v)}getPixelSize(){const{width:c,height:d}=this.atlasImage;return{width:c,height:d}}getPattern(c){const d=this.patterns[c],v=this.getImage(c);if(!v)return null;if(d&&d.position.version===v.version)return d.position;if(d)d.position.version=v.version;else{const b={w:v.data.width+2,h:v.data.height+2,x:0,y:0},E=new p.ImagePosition(b,v);this.patterns[c]={bin:b,position:E}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture&&this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const E in this.patterns)c.push(this.patterns[E].bin);const{w:d,h:v}=p.potpack(c),b=this.atlasImage;b.resize({width:d||1,height:v||1});for(const E in this.patterns){const{bin:M}=this.patterns[E],I=M.x+1,k=M.y+1,F=this.images[E].data,L=F.width,j=F.height;p.RGBAImage.copy(F,b,{x:0,y:0},{x:I,y:k},{width:L,height:j}),p.RGBAImage.copy(F,b,{x:0,y:j-1},{x:I,y:k-1},{width:L,height:1}),p.RGBAImage.copy(F,b,{x:0,y:0},{x:I,y:k+j},{width:L,height:1}),p.RGBAImage.copy(F,b,{x:L-1,y:0},{x:I-1,y:k},{width:1,height:j}),p.RGBAImage.copy(F,b,{x:0,y:0},{x:I+L,y:k},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const d of c){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const v=this.images[d];Ld(v)&&this.updateImage(d,v)}}}const an=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(g,c){return function([d,v,b]){const E=p.degToRad(v+90),M=p.degToRad(b);return{x:d*Math.cos(E)*Math.sin(M),y:d*Math.sin(E)*Math.sin(M),z:d*Math.cos(M),azimuthal:v,polar:b}}(g.expression.evaluate(c))}interpolate(g,c,d){return{x:p.number(g.x,c.x,d),y:p.number(g.y,c.y,d),z:p.number(g.z,c.z,d),azimuthal:p.number(g.azimuthal,c.azimuthal,d),polar:p.number(g.polar,c.polar,d)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class or extends p.Evented{constructor(c){super(),this._transitionable=new p.Transitionable(an),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,d={}){if(!this._validate(p.validateLight,c,d))for(const v in c){const b=c[v];p.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),b):this._transitionable.setValue(v,b)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,d,v){return(!v||!1!==v.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const Wc=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let Ju=class extends p.Evented{constructor(g,c){super(),this._transitionable=new p.Transitionable(Wc),this.set(g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(g){for(const c in g){const d=g[c];p.endsWith(c,"-transition")?this._transitionable.setTransition(c.slice(0,-11),d):this._transitionable.setValue(c,d)}}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}};function ll(g,c,d,v){const b=p.smoothstep(45,65,d),[E,M]=rs(g,v),I=p.length(c);let k=1-Math.min(1,Math.exp((I-E)/(M-E)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*b*g.alpha}function rs(g,c){const d=.5/Math.tan(.5*c);return[g.range[0]+d,g.range[1]+d]}const hn=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class cl extends p.Evented{constructor(c,d){super(),this._transitionable=new p.Transitionable(hn),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){const c=this._transform,d="globe"===c.projection.name,v=p.globeToMercatorTransition(c.zoom),b=this.properties.get("range"),E=[.5,3];return{range:d?[p.number(E[0],b[0],v),p.number(E[1],b[1],v)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,d={}){if(!this._validate(p.validateFog,c,d)){for(const v of Object.keys(p.spec.fog))c&&void 0===c[v]&&(c[v]=p.spec.fog[v].default);for(const v in c){const b=c[v];p.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),b):this._transitionable.setValue(v,b)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,c))*d.a}getOpacityAtLatLng(c,d){return this._transform.projection.supportsFog?function(v,b,E){const M=p.MercatorCoordinate.fromLngLat(b),I=E.elevation?E.elevation.getAtPointOrZero(M):0,k=[M.x,M.y,I];return p.transformMat4(k,k,E.mercatorFogMatrix),ll(v,k,E.pitch,E._fov)}(this.state,c,d):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?rs(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,d,v){return(!v||!1!==v.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class fn{constructor(c,d){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const v=this.workerPool.acquire(this.id);for(let b=0;b<v.length;b++){const E=new fn.Actor(v[b],d,this.id);E.name=`Worker ${b}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,d,v){p.asyncAll(this.actors,(b,E)=>{b.send(c,d,E)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Xi(g,c,d){return c*(p.EXTENT/(g.tileSize*Math.pow(2,d-g.tileID.overscaledZ)))}fn.Actor=p.Actor;class wa{constructor(c,d,v,b){this.screenBounds=c,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(c,d){let v,b;if(c instanceof p.Point||"number"==typeof c[0]){const E=p.Point.convert(c);v=[E],b=d.isPointAboveHorizon(E)}else{const E=p.Point.convert(c[0]),M=p.Point.convert(c[1]);v=[E,M],b=p.polygonizeBounds(E,M).every(I=>d.isPointAboveHorizon(I))}return new wa(v,d.getCameraPoint(),b,d)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const d=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],b=p.polygonizeBounds(d,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<v.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),p.bufferConvexPolygon(b,c)}bufferedCameraGeometryGlobe(c){const d=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],b=p.polygonizeBounds(d,v,c),E=this.cameraPoint.clone();switch(3*((E.y>d.y)+(E.y>v.y))+((E.x>d.x)+(E.x>v.x))){case 0:b[0]=E,b[4]=E.clone();break;case 1:b.splice(1,0,E);break;case 2:b[1]=E;break;case 3:b.splice(4,0,E);break;case 5:b.splice(2,0,E);break;case 6:b[3]=E;break;case 7:b.splice(3,0,E);break;case 8:b[2]=E}return b}containsTile(c,d,v,b=0){const E=c.queryPadding/d._pixelsPerMercatorPixel+1,M=v?this._bufferedCameraMercator(E,d):this._bufferedScreenMercator(E,d);let I=c.tileID.wrap+(M.unwrapped?b:0);const k=M.polygon.map(ee=>p.getTilePoint(c.tileTransform,ee,I));if(!p.polygonIntersectsBox(k,0,0,p.EXTENT,p.EXTENT))return;I=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const F=this.screenGeometryMercator.polygon.map(ee=>p.getTileVec3(c.tileTransform,ee,I)),L=F.map(ee=>new p.Point(ee[0],ee[1])),j=d.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),q=p.getTileVec3(c.tileTransform,j,I),K=F.map(ee=>{const U=p.sub(ee,ee,q);return p.normalize(U,U),new p.Ray(q,U)}),Q=Xi(c,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:K,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(J=p.getBounds(k),J.min.x=p.clamp(J.min.x,0,p.EXTENT),J.min.y=p.clamp(J.min.y,0,p.EXTENT),J.max.x=p.clamp(J.max.x,0,p.EXTENT),J.max.y=p.clamp(J.max.y,0,p.EXTENT),J),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:Q};var J}_bufferedScreenMercator(c,d){const v=ro(c);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let b;return b="globe"===d.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),d):{polygon:this.bufferedScreenGeometry(c).map(E=>d.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[v]=b,b}}_bufferedCameraMercator(c,d){const v=ro(c);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let b;return b="globe"===d.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),d):{polygon:this.bufferedCameraGeometry(c).map(E=>d.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[v]=b,b}}_projectAndResample(c,d){const v=function(E,M){const I=p.multiply([],M.pixelMatrix,M.globeMatrix),k=[0,-p.GLOBE_RADIUS,0,1],F=[0,p.GLOBE_RADIUS,0,1],L=[0,0,0,1];p.transformMat4$1(k,k,I),p.transformMat4$1(F,F,I),p.transformMat4$1(L,L,I);const j=new p.Point(k[0]/k[3],k[1]/k[3]),q=new p.Point(F[0]/F[3],F[1]/F[3]),K=p.polygonContainsPoint(E,j)&&k[3]<L[3],Q=p.polygonContainsPoint(E,q)&&F[3]<L[3];if(!K&&!Q)return null;const J=function(de,be,xe){for(let Ie=1;Ie<de.length;Ie++){const Xe=Ca(be.pointCoordinate3D(de[Ie-1]).x),Te=Ca(be.pointCoordinate3D(de[Ie]).x);if(xe<0){if(Xe<Te)return{idx:Ie,t:-Xe/(Te-1-Xe)}}else if(Te<Xe)return{idx:Ie,t:(1-Xe)/(Te+1-Xe)}}return null}(E,M,K?-1:1);if(!J)return null;const{idx:ee,t:U}=J;let Y=ee>1?ki(E.slice(0,ee),M):[],ie=ee<E.length?ki(E.slice(ee),M):[];Y=Y.map(de=>new p.Point(Ca(de.x),de.y)),ie=ie.map(de=>new p.Point(Ca(de.x),de.y));const re=[...Y];0===re.length&&re.push(ie[ie.length-1]);const fe=p.number(re[re.length-1].y,(0===ie.length?Y[0]:ie[0]).y,U);let ge;return ge=K?[new p.Point(0,fe),new p.Point(0,0),new p.Point(1,0),new p.Point(1,fe)]:[new p.Point(1,fe),new p.Point(1,1),new p.Point(0,1),new p.Point(0,fe)],re.push(...ge),0===ie.length?re.push(Y[0]):re.push(...ie),{polygon:re.map(de=>new p.MercatorCoordinate(de.x,de.y)),unwrapped:!1}}(c,d);if(v)return v;const b=function(E,M){let I=!1,k=-1/0,F=0;for(let j=0;j<E.length-1;j++)E[j].x>k&&(k=E[j].x,F=j);for(let j=0;j<E.length-1;j++){const q=(F+j)%(E.length-1),K=E[q],Q=E[q+1];Math.abs(K.x-Q.x)>.5&&(K.x<Q.x?(K.x+=1,0===q&&(E[E.length-1].x+=1)):(Q.x+=1,q+1===E.length-1&&(E[0].x+=1)),I=!0)}const L=p.mercatorXfromLng(M.center.lng);return I&&L<Math.abs(L-1)&&E.forEach(j=>{j.x-=1}),{polygon:E,unwrapped:I}}(ki(c,d).map(E=>new p.Point(Ca(E.x),E.y)),d);return{polygon:b.polygon.map(E=>new p.MercatorCoordinate(E.x,E.y)),unwrapped:b.unwrapped}}}function ki(g,c){return p.resample(g,d=>{const v=c.pointCoordinate3D(d);d.x=v.x,d.y=v.y},1/256)}function Ca(g){return g<0?1+g%1:g%1}function ro(g){return 100*g|0}function Xs(g,c,d,v,b){const E=function(M,I){if(M)return b(M);if(I){g.url&&I.tiles&&g.tiles&&delete g.tiles;const k=p.pick(p.extend(I,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(k.vectorLayers=I.vector_layers,k.vectorLayerIds=k.vectorLayers.map(F=>F.id)),k.tiles=c.canonicalizeTileset(k,g.url),b(null,k)}};return g.url?p.getJSON(c.transformRequest(c.normalizeSourceURL(g.url,null,d,v),p.ResourceType.Source),E):p.exported.frame(()=>E(null,g))}class Ts{constructor(c,d,v){this.bounds=p.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=d||0,this.maxzoom=v||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const d=Math.pow(2,c.z),v=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*d),b=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*d),E=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*d),M=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*d);return c.x>=v&&c.x<E&&c.y>=b&&c.y<M}}class gi{constructor(c,d,v){this.context=c;const b=c.gl;this.buffer=b.createBuffer(),this.dynamicDraw=Boolean(v),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ql{constructor(c,d,v,b){this.length=d.length,this.attributes=v,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.context=c;const E=c.gl;this.buffer=E.createBuffer(),c.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,d){for(let v=0;v<this.attributes.length;v++){const b=d.attributes[this.attributes[v].name];void 0!==b&&c.enableVertexAttribArray(b)}}setVertexAttribPointers(c,d,v){for(let b=0;b<this.attributes.length;b++){const E=this.attributes[b],M=d.attributes[E.name];void 0!==M&&c.vertexAttribPointer(M,E.components,c[Yn[E.type]],!1,this.itemSize,E.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ht{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ea extends ht{getDefault(){return p.Color.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class vo extends ht{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class ul extends ht{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class ui extends ht{getDefault(){return[!0,!0,!0,!0]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class zo extends ht{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Qu extends ht{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Da extends ht{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class No extends ht{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class eh extends ht{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}}class qc extends ht{getDefault(){return[0,1]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class Zc extends ht{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}}class Ys extends ht{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class ec extends ht{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}}class tc extends ht{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class th extends ht{getDefault(){return p.Color.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class oo extends ht{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class Ks extends ht{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}}class Xc extends ht{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class hl extends ht{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let nc,Bo=class extends ht{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class Ta extends ht{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Sa extends ht{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Ma extends ht{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class dl extends ht{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class ic extends ht{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class nh extends ht{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class ue extends ht{getDefault(){return null}set(c){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class G extends ht{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class W extends ht{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class se extends ht{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class me extends ht{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class ye extends ht{constructor(c,d){super(c),this.context=c,this.parent=d}getDefault(){return null}}class De extends ye{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Ce extends ye{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class _e extends Ce{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ke{constructor(c,d,v,b){this.context=c,this.width=d,this.height=v;const E=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new De(c,E),b&&(this.depthAttachment=new Ce(c,E))}destroy(){const c=this.context.gl,d=this.colorAttachment.get();if(d&&c.deleteTexture(d),this.depthAttachment){const v=this.depthAttachment.get();v&&c.deleteRenderbuffer(v)}c.deleteFramebuffer(this.framebuffer)}}class tt{constructor(c,d=!1){if(this.gl=c,this.isWebGL2=d,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),d){const v=c;this.extVertexArrayObject={createVertexArrayOES:v.createVertexArray.bind(c),deleteVertexArrayOES:v.deleteVertexArray.bind(c),bindVertexArrayOES:v.bindVertexArray.bind(c)}}this.clearColor=new Ea(this),this.clearDepth=new vo(this),this.clearStencil=new ul(this),this.colorMask=new ui(this),this.depthMask=new zo(this),this.stencilMask=new Qu(this),this.stencilFunc=new Da(this),this.stencilOp=new No(this),this.stencilTest=new eh(this),this.depthRange=new qc(this),this.depthTest=new Zc(this),this.depthFunc=new Ys(this),this.blend=new ec(this),this.blendFunc=new tc(this),this.blendColor=new th(this),this.blendEquation=new oo(this),this.cullFace=new Ks(this),this.cullFaceSide=new Xc(this),this.frontFace=new hl(this),this.program=new Bo(this),this.activeTexture=new Ta(this),this.viewport=new Sa(this),this.bindFramebuffer=new Ma(this),this.bindRenderbuffer=new dl(this),this.bindTexture=new ic(this),this.bindVertexBuffer=new nh(this),this.bindElementBuffer=new ue(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new G(this),this.pixelStoreUnpack=new W(this),this.pixelStoreUnpackPremultiplyAlpha=new se(this),this.pixelStoreUnpackFlipY=new me(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),d||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(d||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=d||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,d){return new gi(this,c,d)}createVertexBuffer(c,d,v){return new Ql(this,c,d,v)}createRenderbuffer(c,d,v){const b=this.gl,E=b.createRenderbuffer();return this.bindRenderbuffer.set(E),b.renderbufferStorage(b.RENDERBUFFER,c,d,v),this.bindRenderbuffer.set(null),E}createFramebuffer(c,d,v){return new ke(this,c,d,v)}clear({color:c,depth:d,stencil:v}){const b=this.gl;let E=0;c&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),void 0!==v&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),b.clear(E)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){Ue(c.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class it extends p.Evented{constructor(c,d,v,b){if(super(),this.id=c,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(d,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=Xs(this._options,this.map._requestManager,d,v,(b,E)=>{this._tileJSONRequest=null,this._loaded=!0,b?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),v&&2!==v.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new p.ErrorEvent(b))):E&&(p.extend(this,E),E.bounds&&(this.tileBounds=new Ts(E.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(E.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(b)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(c,d){const v=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(v,p.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(b.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=d:c.request=c.actor.send("reloadTile",b,E.bind(this));else if(c.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",b,E.bind(this),void 0,!0);else{const M=p.loadVectorTile.call({deduped:this._deduped},b,(I,k)=>{I||!k?E.call(this,I):(b.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},c.actor&&c.actor.send("loadTile",b,E.bind(this),void 0,!0))},!0);c.request={cancel:M}}function E(M,I){return delete c.request,c.aborted?d(null):M&&404!==M.status?d(M):(I&&I.resourceTiming&&(c.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&c.setExpiryData(I),c.loadVectorData(I,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Je extends p.Evented{constructor(c,d,v,b){super(),this.id=c,this.dispatcher=v,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},d),p.extend(this,p.pick(d,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Xs(this._options,this.map._requestManager,null,null,(d,v)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new p.ErrorEvent(d)):v&&(p.extend(this,v),v.bounds&&(this.tileBounds=new Ts(v.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(v.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(d)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,d){const v=p.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);c.request=p.getImage(this.map._requestManager.transformRequest(b,p.ResourceType.Tile),(E,M,I,k)=>(delete c.request,c.aborted?(c.state="unloaded",d(null)):E?(c.state="errored",d(E)):M?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:I,expires:k}),c.setTexture(M,this.map.painter),c.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(c,d,v){c.setTexture(d,v)}static unloadTileData(c,d){c.texture&&d.saveTileTexture(c.texture)}abortTile(c,d){c.request&&(c.request.cancel(),delete c.request),d()}unloadTile(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Gt(g,c,d,v,b,E,M,I){const k=[g,d,b,c,v,E,1,1,1],F=[M,I,1],L=p.adjoint([],k),[j,q,K]=p.transformMat3(F,F,p.transpose(L,L));return p.multiply$1(k,[j,0,0,0,q,0,0,0,K],k)}class en extends p.Evented{constructor(c,d,v,b){super(),this.id=c,this.dispatcher=v,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=d,this._dirty=!1}load(c,d){this._loaded=d||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(v,b)=>{if(this._imageRequest=null,this._loaded=!0,v)this.fire(new p.ErrorEvent(v));else if(b){const{HTMLImageElement:E}=p.window;this.image=b instanceof E?p.exported.getImageData(b):b,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const d=c.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(v){let b=1/0,E=1/0,M=-1/0,I=-1/0;for(const j of v)b=Math.min(b,j.x),E=Math.min(E,j.y),M=Math.max(M,j.x),I=Math.max(I,j.y);const k=Math.max(M-b,I-E),F=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),L=Math.pow(2,F);return new p.CanonicalTileID(F,Math.floor((b+M)/2*L),Math.floor((E+I)/2*L))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const k in this.tiles){const F=this.tiles[k];"loaded"!==F.state&&(F.state="loaded",F.texture=this.texture)}if(this._boundsArray)return;const d=p.tileTransform(this.tileID,this.map.transform.projection),[v,b,E,M]=this.coordinates.map(k=>{const F=d.projection.project(k[0],k[1]);return p.getTilePoint(d,F)._round()});this.perspectiveTransform=function(k,F,L,j,q,K,Q,J,ee,U){const Y=Gt(0,0,k,0,0,F,k,F),ie=Gt(L,j,q,K,Q,J,ee,U);return p.multiply$1(ie,p.adjoint(Y,Y),ie),[ie[6]/ie[8]*k/p.EXTENT,ie[7]/ie[8]*F/p.EXTENT]}(this.width,this.height,v.x,v.y,b.x,b.y,M.x,M.y,E.x,E.y);const I=this._boundsArray=new p.StructArrayLayout4i8;I.emplaceBack(v.x,v.y,0,0),I.emplaceBack(b.x,b.y,p.EXTENT,0),I.emplaceBack(M.x,M.y,0,p.EXTENT),I.emplaceBack(E.x,E.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(I,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,d=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ut={vector:it,raster:Je,"raster-dem":class extends Je{constructor(g,c,d,v){super(g,c,d,v),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(g,c){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(b,E){b&&(g.state="errored",c(b)),E&&(g.dem=E,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",c(null))}g.request=p.getImage(this.map._requestManager.transformRequest(d,p.ResourceType.Tile),function(b,E,M,I){if(delete g.request,g.aborted)g.state="unloaded",c(null);else if(b)g.state="errored",c(b);else if(E){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:M,expires:I});const k=p.window.ImageBitmap&&E instanceof p.window.ImageBitmap&&(null==nc&&(nc=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),nc),F=1-(E.width-p.prevPowerOfTwo(E.width))/2;F<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const L=k?E:p.exported.getImageData(E,F),j={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:F};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",j,v.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const c=g.canonical,d=Math.pow(2,c.z),v=(c.x-1+d)%d,b=0===c.x?g.wrap-1:g.wrap,E=(c.x+1+d)%d,M=c.x+1===d?g.wrap+1:g.wrap,I={};return I[new p.OverscaledTileID(g.overscaledZ,b,c.z,v,c.y).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,M,c.z,E,c.y).key]={backfilled:!1},c.y>0&&(I[new p.OverscaledTileID(g.overscaledZ,b,c.z,v,c.y-1).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,M,c.z,E,c.y-1).key]={backfilled:!1}),c.y+1<d&&(I[new p.OverscaledTileID(g.overscaledZ,b,c.z,v,c.y+1).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,M,c.z,E,c.y+1).key]={backfilled:!1}),I}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends p.Evented{constructor(g,c,d,v){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(v),this._data=c.data,this._options=p.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const b=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*b,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*b,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*b,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},c),this}getClusterChildren(g,c){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},c),this}getClusterLeaves(g,c,d,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:c,offset:d},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=p.extend({},this.workerOptions),c=this._data;"string"==typeof c?(g.request=this.map._requestManager.transformRequest(p.exported.resolveURL(c),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(d,v)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new p.ErrorEvent(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(b.resourceTiming=v.resourceTiming[this.id]),this.fire(new p.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,c){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(d,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(v,b)=>(delete g.request,g.unloadVectorData(),g.aborted?c(null):v?c(v):(g.loadVectorData(b,this.map.painter,"reloadTile"===d),c(null))),void 0,"loadTile"===d)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends en{constructor(g,c,d,v){super(g,c,d,v),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const c of g.urls)this.urls.push(this.map._requestManager.transformRequest(c,p.ResourceType.Source).url);p.getVideo(this.urls,(c,d)=>{this._loaded=!0,c?this.fire(new p.ErrorEvent(c)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const c=this.video.seekable;g<c.start(0)||g>c.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,c=g.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(g,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:en,canvas:class extends en{constructor(g,c,d,v){super(g,c,d,v),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(E=>"number"!=typeof E))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends p.Evented{constructor(g,c,d,v){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=c,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ts(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:c,y:d,z:v}=g.canonical;return this._implementation.hasTile({x:c,y:d,z:v})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,c){const{x:d,y:v,z:b}=g.tileID.canonical,E=new p.window.AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:d,y:v,z:b},{signal:E.signal})).then(function(M){return delete g.request,g.aborted?(g.state="unloaded",c(null)):void 0===M?(g.state="errored",c(null)):null===M?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",c(null)):(I=M)instanceof p.window.ImageData||I instanceof p.window.HTMLCanvasElement||I instanceof p.window.ImageBitmap||I instanceof p.window.HTMLImageElement?(this.loadTileData(g,M),g.state="loaded",void c(null)):(g.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var I}.bind(this)).catch(M=>{20!==M.code&&(g.state="errored",c(M))}),g.request.cancel=()=>E.abort()}loadTileData(g,c){Je.loadTileData(g,c,this._map.painter)}unloadTileData(g){Je.unloadTileData(g,this._map.painter)}unloadTile(g,c){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:d,y:v,z:b}=g.tileID.canonical;this._implementation.unloadTile({x:d,y:v,z:b})}c()}abortTile(g,c){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},tn=function(g,c,d,v){const b=new Ut[c.type](g,c,d,v);if(b.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${b.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],b),b};function pn(g,c){const d=p.identity([]);return p.scale(d,d,[.5*g.width,.5*-g.height,1]),p.translate(d,d,[1,-1,0]),p.multiply(d,d,g.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(d)}function xn(g,c,d,v,b,E,M,I=!1){const k=g.tilesIn(v,M,I);k.sort(Dr);const F=[];for(const j of k)F.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(c,d,g._state,j,b,E,pn(g.transform,j.tile.tileID),I)});const L=function(j){const q={},K={};for(const Q of j){const J=Q.queryResults,ee=Q.wrappedTileID,U=K[ee]=K[ee]||{};for(const Y in J){const ie=J[Y],re=U[Y]=U[Y]||{},fe=q[Y]=q[Y]||[];for(const ge of ie)re[ge.featureIndex]||(re[ge.featureIndex]=!0,fe.push(ge))}}return q}(F);for(const j in L)L[j].forEach(q=>{const K=q.feature,Q=K.layer;Q&&"background"!==Q.type&&"sky"!==Q.type&&(K.source=Q.source,Q["source-layer"]&&(K.sourceLayer=Q["source-layer"]),K.state=void 0!==K.id?g.getFeatureState(Q["source-layer"],K.id):{})});return L}function Ri(g,c){const d=g.getRenderableIds().map(E=>g.getTileByID(E)),v=[],b={};for(let E=0;E<d.length;E++){const M=d[E],I=M.tileID.canonical.key;b[I]||(b[I]=!0,M.querySourceFeatures(v,c))}return v}function Dr(g,c){const d=g.tileID,v=c.tileID;return d.overscaledZ-v.overscaledZ||d.canonical.y-v.canonical.y||d.wrap-v.wrap||d.canonical.x-v.canonical.x}function ji(){return null!=ho.workerClass?new ho.workerClass:new p.window.Worker(ho.workerUrl)}const Ss="mapboxgl_preloaded_worker_pool";class Yi{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<Yi.workerCount;)this.workers.push(new ji);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ss]}numActive(){return Object.keys(this.active).length}}let Ur;function rc(){return Ur||(Ur=new Yi),Ur}function Js(g,c){const d={};for(const v in g)"ref"!==v&&(d[v]=g[v]);return p.refProperties.forEach(v=>{v in c&&(d[v]=c[v])}),d}function wp(g){g=g.slice();const c=Object.create(null);for(let d=0;d<g.length;d++)c[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=Js(g[d],c[g[d].ref]));return g}Yi.workerCount=2;const Lt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ia(g,c,d){d.push({command:Lt.addSource,args:[g,c[g]]})}function so(g,c,d){c.push({command:Lt.removeSource,args:[g]}),d[g]=!0}function Cp(g,c,d,v){so(g,d,v),Ia(g,c,d)}function ih(g,c,d){let v;for(v in g[d])if(g[d].hasOwnProperty(v)&&"data"!==v&&!Ue(g[d][v],c[d][v]))return!1;for(v in c[d])if(c[d].hasOwnProperty(v)&&"data"!==v&&!Ue(g[d][v],c[d][v]))return!1;return!0}function os(g,c,d,v,b,E){let M;for(M in c=c||{},g=g||{})g.hasOwnProperty(M)&&(Ue(g[M],c[M])||d.push({command:E,args:[v,M,c[M],b]}));for(M in c)c.hasOwnProperty(M)&&!g.hasOwnProperty(M)&&(Ue(g[M],c[M])||d.push({command:E,args:[v,M,c[M],b]}))}function ss(g){return g.id}function rh(g,c){return g[c.id]=c,g}class fl{constructor(c,d){this.reset(c,d)}reset(c,d){this.points=c||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=p.clamp(c,0,1);let d=1,v=this._distances[d];const b=c*this.paddedLength+this.padding;for(;v<b&&d<this._distances.length;)v=this._distances[++d];const E=d-1,M=this._distances[E],I=v-M,k=I>0?(b-M)/I:0;return this.points[E].mult(1-k).add(this.points[d].mult(k))}}class pl{constructor(c,d,v){const b=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(c/v),this.yCellCount=Math.ceil(d/v);for(let M=0;M<this.xCellCount*this.yCellCount;M++)b.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=d,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,d,v,b,E){this._forEachCell(d,v,b,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(d),this.bboxes.push(v),this.bboxes.push(b),this.bboxes.push(E)}insertCircle(c,d,v,b){this._forEachCell(d-b,v-b,d+b,v+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(d),this.circles.push(v),this.circles.push(b)}_insertBoxCell(c,d,v,b,E,M){this.boxCells[E].push(M)}_insertCircleCell(c,d,v,b,E,M){this.circleCells[E].push(M)}_query(c,d,v,b,E,M){if(v<0||c>this.width||b<0||d>this.height)return!E&&[];const I=[];if(c<=0&&d<=0&&this.width<=v&&this.height<=b){if(E)return!0;for(let k=0;k<this.boxKeys.length;k++)I.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const F=this.circles[3*k],L=this.circles[3*k+1],j=this.circles[3*k+2];I.push({key:this.circleKeys[k],x1:F-j,y1:L-j,x2:F+j,y2:L+j})}return M?I.filter(M):I}return this._forEachCell(c,d,v,b,this._queryCell,I,{hitTest:E,seenUids:{box:{},circle:{}}},M),E?I.length>0:I}_queryCircle(c,d,v,b,E){const M=c-v,I=c+v,k=d-v,F=d+v;if(I<0||M>this.width||F<0||k>this.height)return!b&&[];const L=[];return this._forEachCell(M,k,I,F,this._queryCellCircle,L,{hitTest:b,circle:{x:c,y:d,radius:v},seenUids:{box:{},circle:{}}},E),b?L.length>0:L}query(c,d,v,b,E){return this._query(c,d,v,b,!1,E)}hitTest(c,d,v,b,E){return this._query(c,d,v,b,!0,E)}hitTestCircle(c,d,v,b){return this._queryCircle(c,d,v,!0,b)}_queryCell(c,d,v,b,E,M,I,k){const F=I.seenUids,L=this.boxCells[E];if(null!==L){const q=this.bboxes;for(const K of L)if(!F.box[K]){F.box[K]=!0;const Q=4*K;if(c<=q[Q+2]&&d<=q[Q+3]&&v>=q[Q+0]&&b>=q[Q+1]&&(!k||k(this.boxKeys[K]))){if(I.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[K],x1:q[Q],y1:q[Q+1],x2:q[Q+2],y2:q[Q+3]})}}}const j=this.circleCells[E];if(null!==j){const q=this.circles;for(const K of j)if(!F.circle[K]){F.circle[K]=!0;const Q=3*K;if(this._circleAndRectCollide(q[Q],q[Q+1],q[Q+2],c,d,v,b)&&(!k||k(this.circleKeys[K]))){if(I.hitTest)return M.push(!0),!0;{const J=q[Q],ee=q[Q+1],U=q[Q+2];M.push({key:this.circleKeys[K],x1:J-U,y1:ee-U,x2:J+U,y2:ee+U})}}}}}_queryCellCircle(c,d,v,b,E,M,I,k){const F=I.circle,L=I.seenUids,j=this.boxCells[E];if(null!==j){const K=this.bboxes;for(const Q of j)if(!L.box[Q]){L.box[Q]=!0;const J=4*Q;if(this._circleAndRectCollide(F.x,F.y,F.radius,K[J+0],K[J+1],K[J+2],K[J+3])&&(!k||k(this.boxKeys[Q])))return M.push(!0),!0}}const q=this.circleCells[E];if(null!==q){const K=this.circles;for(const Q of q)if(!L.circle[Q]){L.circle[Q]=!0;const J=3*Q;if(this._circlesCollide(K[J],K[J+1],K[J+2],F.x,F.y,F.radius)&&(!k||k(this.circleKeys[Q])))return M.push(!0),!0}}}_forEachCell(c,d,v,b,E,M,I,k){const F=this._convertToXCellCoord(c),L=this._convertToYCellCoord(d),j=this._convertToXCellCoord(v),q=this._convertToYCellCoord(b);for(let K=F;K<=j;K++)for(let Q=L;Q<=q;Q++)if(E.call(this,c,d,v,b,this.xCellCount*Q+K,M,I,k))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,d,v,b,E,M){const I=b-c,k=E-d,F=v+M;return F*F>I*I+k*k}_circleAndRectCollide(c,d,v,b,E,M,I){const k=(M-b)/2,F=Math.abs(c-(b+k));if(F>k+v)return!1;const L=(I-E)/2,j=Math.abs(d-(E+L));if(j>L+v)return!1;if(F<=k||j<=L)return!0;const q=F-k,K=j-L;return q*q+K*K<=v*v}}const Ms={unknown:0,flipRequired:1,flipNotRequired:2},oc=Math.tan(85*Math.PI/180);function ze(g,c,d,v,b,E,M){const I=p.create();if(d)if("globe"===E.name){const k=p.calculateGlobeLabelMatrix(b,c);p.multiply(I,I,k)}else{const k=st([],M);I[0]=k[0],I[1]=k[1],I[4]=k[2],I[5]=k[3],v||p.rotateZ(I,I,b.angle)}else p.multiply(I,b.labelPlaneMatrix,g);return I}function Qs(g,c,d,v,b,E,M){const I=ze(g,c,d,v,b,E,M);return"globe"===E.name&&d||(I[2]=I[6]=I[10]=I[14]=0),I}function Oi(g,c,d,v,b,E,M){if(d){if("globe"===E.name){const I=ze(g,c,d,v,b,E,M);return p.invert(I,I),p.multiply(I,g,I),I}{const I=p.clone(g),k=p.identity([]);return k[0]=M[0],k[1]=M[1],k[4]=M[2],k[5]=M[3],p.multiply(I,I,k),v||p.rotateZ(I,I,-b.angle),I}}return b.glCoordMatrix}function sr(g,c,d,v){const b=[g,c,d,1];d?p.transformMat4$1(b,b,v):nn(b,b,v);const E=b[3];return b[0]/=E,b[1]/=E,b[2]/=E,b}function Fd(g,c){return Math.min(.5+g/c*.5,1.5)}function Is(g,c){const d=g[0]/g[3],v=g[1]/g[3];return d>=-c[0]&&d<=c[0]&&v>=-c[1]&&v<=c[1]}function zd(g,c,d,v,b,E,M,I,k,F){const L=d.transform,j=v?g.textSizeData:g.iconSizeData,q=p.evaluateSizeForZoom(j,d.transform.zoom),K="globe"===L.projection.name,Q=[256/d.width*2+1,256/d.height*2+1],J=v?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;J.clear();let ee=null;K&&(ee=v?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const U=g.lineVertexArray,Y=v?g.text.placedSymbolArray:g.icon.placedSymbolArray,ie=d.transform.width/d.transform.height;let re,fe=!1;for(let ge=0;ge<Y.length;ge++){const de=Y.get(ge),{numGlyphs:be,writingMode:xe}=de;if(xe!==p.WritingMode.vertical||fe||re===p.WritingMode.horizontal||(fe=!0),re=xe,(de.hidden||xe===p.WritingMode.vertical)&&!fe){Tn(be,J);continue}fe=!1;const Ie=new p.Point(de.tileAnchorX,de.tileAnchorY);let{x:Xe,y:Te,z:je}=L.projection.projectTilePoint(Ie.x,Ie.y,F.canonical);if(k){const[zt,mt,Tt]=k(Ie);Xe+=zt,Te+=mt,je+=Tt}const Pe=[Xe,Te,je,1];if(p.transformMat4$1(Pe,Pe,c),!Is(Pe,Q)){Tn(be,J);continue}const We=Fd(d.transform.cameraToCenterDistance,Pe[3]),Se=p.evaluateSizeForFeature(j,q,de),Ne=M?Se/We:Se*We,Ye=sr(Xe,Te,je,b);if(Ye[3]<=0){Tn(be,J);continue}let $e={};const qe=M?null:k,_t=ct(de,Ne,!1,I,c,b,E,g.glyphOffsetArray,U,J,ee,Ye,Ie,$e,ie,qe,L.projection,F,M);fe=_t.useVertical,qe&&_t.needsFlipping&&($e={}),(_t.notEnoughRoom||fe||_t.needsFlipping&&ct(de,Ne,!0,I,c,b,E,g.glyphOffsetArray,U,J,ee,Ye,Ie,$e,ie,qe,L.projection,F,M).notEnoughRoom)&&Tn(be,J)}v?(g.text.dynamicLayoutVertexBuffer.updateData(J),ee&&g.text.globeExtVertexBuffer.updateData(ee)):(g.icon.dynamicLayoutVertexBuffer.updateData(J),ee&&g.icon.globeExtVertexBuffer.updateData(ee))}function Li(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J){const{lineStartIndex:ee,glyphStartIndex:U,segment:Y}=I,ie=U+I.numGlyphs,re=ee+I.lineLength,fe=c.getoffsetX(U),ge=c.getoffsetX(ie-1),de=$r(g*fe,d,v,b,E,M,Y,ee,re,k,F,L,j,q,!0,K,Q,J);if(!de)return null;const be=$r(g*ge,d,v,b,E,M,Y,ee,re,k,F,L,j,q,!0,K,Q,J);return be?{first:de,last:be}:null}function sc(g,c,d,v){return g===p.WritingMode.horizontal&&Math.abs(v)>Math.abs(d)?{useVertical:!0}:g===p.WritingMode.vertical?v>0?{needsFlipping:!0}:null:c!==Ms.unknown&&(0===(b=d)||Math.abs(v/b)>oc)?c===Ms.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null;var b}function ct(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J,ee,U,Y){const ie=c/24,re=g.lineOffsetX*ie,fe=g.lineOffsetY*ie,{lineStartIndex:ge,glyphStartIndex:de,numGlyphs:be,segment:xe,writingMode:Ie,flipState:Xe}=g,Te=ge+g.lineLength,je=Pe=>{if(L){const[Ye,$e,qe]=Pe.up,_t=F.length;p.updateGlobeVertexNormal(L,_t+0,Ye,$e,qe),p.updateGlobeVertexNormal(L,_t+1,Ye,$e,qe),p.updateGlobeVertexNormal(L,_t+2,Ye,$e,qe),p.updateGlobeVertexNormal(L,_t+3,Ye,$e,qe)}const[We,Se,Ne]=Pe.point;p.addDynamicAttributes(F,We,Se,Ne,Pe.angle)};if(be>1){const Pe=Li(ie,I,re,fe,d,j,q,g,k,E,K,J,!1,ee,U,Y);if(!Pe)return{notEnoughRoom:!0};if(v&&!d){let[We,Se,Ne]=Pe.first.point,[Ye,$e,qe]=Pe.last.point;[We,Se]=sr(We,Se,Ne,M),[Ye,$e]=sr(Ye,$e,qe,M);const _t=sc(Ie,Xe,(Ye-We)*Q,$e-Se);if(g.flipState=_t&&_t.needsFlipping?Ms.flipRequired:Ms.flipNotRequired,_t)return _t}je(Pe.first);for(let We=de+1;We<de+be-1;We++){const Se=$r(ie*I.getoffsetX(We),re,fe,d,j,q,xe,ge,Te,k,E,K,J,!1,!1,ee,U,Y);if(!Se)return F.length-=4*(We-de),{notEnoughRoom:!0};je(Se)}je(Pe.last)}else{if(v&&!d){const We=sr(q.x,q.y,0,b),Se=ge+xe+1,Ne=new p.Point(k.getx(Se),k.gety(Se)),Ye=sr(Ne.x,Ne.y,0,b),$e=Ye[3]>0?Ye:yt(q,Ne,We,1,b,void 0,ee,U.canonical),qe=sc(Ie,Xe,($e[0]-We[0])*Q,$e[1]-We[1]);if(g.flipState=qe&&qe.needsFlipping?Ms.flipRequired:Ms.flipNotRequired,qe)return qe}const Pe=$r(ie*I.getoffsetX(de),re,fe,d,j,q,xe,ge,Te,k,E,K,J,!1,!1,ee,U,Y);if(!Pe)return{notEnoughRoom:!0};je(Pe)}return{}}function ln(g,c,d,v,b){const{x:E,y:M,z:I}=v.projectTilePoint(g.x,g.y,c);if(!b)return sr(E,M,I,d);const[k,F,L]=b(g);return sr(E+k,M+F,I+L,d)}function yt(g,c,d,v,b,E,M,I){const k=ln(g.sub(c)._unit()._add(g),I,b,M,E);return p.sub(k,d,k),p.normalize(k,k),p.scaleAndAdd(k,d,k,v)}function $r(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J,ee,U){const Y=v?g-c:g+c;let ie=Y>0?1:-1,re=0;v&&(ie*=-1,re=Math.PI),ie<0&&(re+=Math.PI);let fe=I+M+(ie>0?0:1)|0,ge=b,de=b,be=0,xe=0;const Ie=Math.abs(Y),Xe=[],Te=[];let je=E,Pe=je;const We=()=>yt(Pe,je,de,Ie-be+1,L,q,J,ee.canonical);for(;be+xe<=Ie;){if(fe+=ie,fe<I||fe>=k)return null;if(de=ge,Pe=je,Xe.push(de),K&&Te.push(Pe),je=new p.Point(F.getx(fe),F.gety(fe)),ge=j[fe],!ge){const Tt=ln(je,ee.canonical,L,J,q);ge=Tt[3]>0?j[fe]=Tt:We()}be+=xe,xe=p.distance(de,ge)}Q&&q&&(j[fe]&&(ge=We(),xe=p.distance(de,ge)),j[fe]=ge);const Se=(Ie-be)/xe,Ne=je.sub(Pe)._mult(Se)._add(Pe),Ye=p.sub([],ge,de),$e=p.scaleAndAdd([],de,Ye,Se);let qe=[0,0,1],_t=Ye[0],zt=Ye[1];if(U&&(qe=J.upVector(ee.canonical,Ne.x,Ne.y),0!==qe[0]||0!==qe[1]||1!==qe[2])){const Tt=[qe[2],0,-qe[0]],dn=p.cross([],qe,Tt);p.normalize(Tt,Tt),p.normalize(dn,dn),_t=p.dot(Ye,Tt),zt=p.dot(Ye,dn)}if(d){const Tt=p.cross([],qe,Ye);p.normalize(Tt,Tt),p.scaleAndAdd($e,$e,Tt,d*ie)}const mt=re+Math.atan2(zt,_t);return Xe.push($e),K&&Te.push(Ne),{point:$e,angle:mt,path:Xe,tilePath:Te,up:qe}}function Tn(g,c){const d=c.length,v=d+4*g;c.resize(v),c.float32.fill(-1/0,4*d,4*v)}function nn(g,c,d){const v=c[0],b=c[1];return g[0]=d[0]*v+d[4]*b+d[12],g[1]=d[1]*v+d[5]*b+d[13],g[3]=d[3]*v+d[7]*b+d[15],g}const xo=100;class Hn{constructor(c,d,v=new pl(c.width+200,c.height+200,25),b=new pl(c.width+200,c.height+200,25)){this.transform=c,this.grid=v,this.ignoredGrid=b,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+xo,this.screenBottomBoundary=c.height+xo,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=d}placeCollisionBox(c,d,v,b,E,M,I,k){let F=v.projectedAnchorX,L=v.projectedAnchorY,j=v.projectedAnchorZ;const q=v.elevation,K=v.tileID,Q=c.getProjection();if(q&&K){const[ge,de,be]=Q.upVector(K.canonical,v.tileAnchorX,v.tileAnchorY),xe=Q.upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=ge*q*xe,L+=de*q*xe,j+=be*q*xe}const J=this.projectAndGetPerspectiveRatio(I,F,L,j,v.tileID,"globe"===Q.name||!!q||this.transform.pitch>0,Q),ee=M*J.perspectiveRatio,U=(v.x1*d+b.x-v.padding)*ee+J.point.x,Y=(v.y1*d+b.y-v.padding)*ee+J.point.y,ie=(v.x2*d+b.x+v.padding)*ee+J.point.x,re=(v.y2*d+b.y+v.padding)*ee+J.point.y,fe=J.perspectiveRatio<=.55||J.occluded;return!this.isInsideGrid(U,Y,ie,re)||!E&&this.grid.hitTest(U,Y,ie,re,k)||fe?{box:[],offscreen:!1,occluded:J.occluded}:{box:[U,Y,ie,re],offscreen:this.isOffscreen(U,Y,ie,re),occluded:!1}}placeCollisionCircles(c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J){const ee=[],U=this.transform.elevation,Y=c.getProjection(),ie=U?U.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,Y):null,re=new p.Point(v.tileAnchorX,v.tileAnchorY);let{x:fe,y:ge,z:de}=Y.projectTilePoint(re.x,re.y,J.canonical);if(ie){const[Ne,Ye,$e]=ie(re);fe+=Ne,ge+=Ye,de+=$e}const be="globe"===Y.name,xe=this.projectAndGetPerspectiveRatio(I,fe,ge,de,J,be||!!U||this.transform.pitch>0,Y),{perspectiveRatio:Ie}=xe,Xe=(j?M/Ie:M*Ie)/p.ONE_EM,Te=sr(fe,ge,de,k),je=xe.signedDistanceFromCamera>0?Li(Xe,E,v.lineOffsetX*Xe,v.lineOffsetY*Xe,!1,Te,re,v,b,k,{},U&&!j?ie:null,j&&!!U,Y,J,j):null;let Pe=!1,We=!1,Se=!0;if(je&&!xe.occluded){const Ne=.5*K*Ie+Q,Ye=new p.Point(-100,-100),$e=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),qe=new fl,{first:_t,last:zt}=je,mt=_t.path.length;let Tt=[];for(let vt=mt-1;vt>=1;vt--)Tt.push(_t.path[vt]);for(let vt=1;vt<zt.path.length;vt++)Tt.push(zt.path[vt]);const dn=2.5*Ne;F&&(Tt=Tt.map(([vt,On,Jn],Ln)=>(ie&&!be&&(Jn=ie(Ln<mt-1?_t.tilePath[mt-1-Ln]:zt.tilePath[Ln-mt+2])[2]),sr(vt,On,Jn,F))),Tt.some(vt=>vt[3]<=0)&&(Tt=[]));let sn=[];if(Tt.length>0){let vt=1/0,On=-1/0,Jn=1/0,Ln=-1/0;for(const Vn of Tt)vt=Math.min(vt,Vn[0]),Jn=Math.min(Jn,Vn[1]),On=Math.max(On,Vn[0]),Ln=Math.max(Ln,Vn[1]);On>=Ye.x&&vt<=$e.x&&Ln>=Ye.y&&Jn<=$e.y&&(sn=[Tt.map(Vn=>new p.Point(Vn[0],Vn[1]))],(vt<Ye.x||On>$e.x||Jn<Ye.y||Ln>$e.y)&&(sn=p.clipLine(sn,Ye.x,Ye.y,$e.x,$e.y)))}for(const vt of sn){qe.reset(vt,.25*Ne);let On=0;On=qe.length<=.5*Ne?1:Math.ceil(qe.paddedLength/dn)+1;for(let Jn=0;Jn<On;Jn++){const Ln=Jn/Math.max(On-1,1),Vn=qe.lerp(Ln),yr=Vn.x+xo,Si=Vn.y+xo;ee.push(yr,Si,Ne,0);const Do=yr-Ne,hs=Si-Ne,Qn=yr+Ne,Gn=Si+Ne;if(Se=Se&&this.isOffscreen(Do,hs,Qn,Gn),We=We||this.isInsideGrid(Do,hs,Qn,Gn),!d&&this.grid.hitTestCircle(yr,Si,Ne,q)&&(Pe=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Pe,occluded:!1}}}}return{circles:!L&&Pe||!We?[]:ee,offscreen:Se,collisionDetected:Pe,occluded:xe.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let v=1/0,b=1/0,E=-1/0,M=-1/0;for(const L of c){const j=new p.Point(L.x+xo,L.y+xo);v=Math.min(v,j.x),b=Math.min(b,j.y),E=Math.max(E,j.x),M=Math.max(M,j.y),d.push(j)}const I=this.grid.query(v,b,E,M).concat(this.ignoredGrid.query(v,b,E,M)),k={},F={};for(const L of I){const j=L.key;if(void 0===k[j.bucketInstanceId]&&(k[j.bucketInstanceId]={}),k[j.bucketInstanceId][j.featureIndex])continue;const q=[new p.Point(L.x1,L.y1),new p.Point(L.x2,L.y1),new p.Point(L.x2,L.y2),new p.Point(L.x1,L.y2)];p.polygonIntersectsPolygon(d,q)&&(k[j.bucketInstanceId][j.featureIndex]=!0,void 0===F[j.bucketInstanceId]&&(F[j.bucketInstanceId]=[]),F[j.bucketInstanceId].push(j.featureIndex))}return F}insertCollisionBox(c,d,v,b,E){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:b,collisionGroupID:E},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,d,v,b,E){const M=d?this.ignoredGrid:this.grid,I={bucketInstanceId:v,featureIndex:b,collisionGroupID:E};for(let k=0;k<c.length;k+=4)M.insertCircle(I,c[k],c[k+1],c[k+2])}projectAndGetPerspectiveRatio(c,d,v,b,E,M,I){const k=[d,v,b,1];let F=!1;b||this.transform.pitch>0?(p.transformMat4$1(k,k,c),this.fogState&&E&&"globe"!==I.name&&(F=function(q,K,Q,J,ee,U){const Y=U.calculateFogTileMatrix(ee),ie=[K,Q,J];return p.transformMat4(ie,ie,Y),ll(q,ie,U.pitch,U._fov)}(this.fogState,d,v,b,E.toUnwrapped(),this.transform)>.9)):nn(k,k,c);const L=k[3];return{point:new p.Point((k[0]/L+1)/2*this.transform.width+xo,(-k[1]/L+1)/2*this.transform.height+xo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/L*.5,1.5),signedDistanceFromCamera:L,occluded:M&&k[2]>L||F}}isOffscreen(c,d,v,b){return v<xo||c>=this.screenRightBoundary||b<xo||d>this.screenBottomBoundary}isInsideGrid(c,d,v,b){return v>=0&&c<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const c=p.identity([]);return p.translate(c,c,[-100,-100,0]),c}}function Pt(g,c,d){const v=c.createTileMatrix(g,g.worldSize,d.toUnwrapped());return p.multiply(new Float32Array(16),g.projMatrix,v)}function ao(g,c,d){if(c.projection.name===d.projection.name)return g.projMatrix;const v=d.clone();return v.setProjection(c.projection),Pt(v,c.getProjection(),g)}function ii(g,c,d){return c.name===d.projection.name?g.projMatrix:Pt(d,c,g)}class yg{constructor(c,d,v,b){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?d:-d))):b&&v?1:0,this.placed=v}isHidden(){return 0===this.opacity&&!this.placed}}class As{constructor(c,d,v,b,E,M=!1){this.text=new yg(c?c.text:null,d,v,E),this.icon=new yg(c?c.icon:null,d,b,E),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class nt{constructor(c,d,v,b=!1){this.text=c,this.icon=d,this.skipFade=v,this.clipped=b}}class Aa{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Jt{constructor(c,d,v,b,E){this.bucketInstanceId=c,this.featureIndex=d,this.sourceLayerIndex=v,this.bucketIndex=b,this.tileID=E}}class Nn{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const d=++this.maxGroupID;this.collisionGroups[c]={ID:d,predicate:v=>v.collisionGroupID===d}}return this.collisionGroups[c]}}function Yc(g,c,d,v,b){const{horizontalAlign:E,verticalAlign:M}=p.getAnchorAlignment(g),I=-(E-.5)*c,k=-(M-.5)*d,F=p.evaluateVariableOffset(g,v);return new p.Point(I+F[0]*b,k+F[1]*b)}function oh(g,c,d,v,b){const E=new p.Point(g,c);return d&&E._rotate(v?b:-b),E}class sh{constructor(c,d,v,b,E){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new Hn(this.transform,E),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Nn(v),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,d,v,b){const E=v.getBucket(d),M=v.latestFeatureIndex;if(!E||!M||d.id!==E.layerIds[0])return;const I=E.layers[0].layout,k=v.collisionBoxArray,F=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),L=v.tileSize/p.EXTENT,j=v.tileID.toUnwrapped();this.transform.setProjection(E.projection);const q=(K=v.tileID,Q=E.getProjection(),J=this.transform,Q.name===this.projection?J.calculateProjMatrix(K.toUnwrapped()):Pt(J,Q,K));var K,Q,J;const ee="map"===I.get("text-pitch-alignment"),U="map"===I.get("text-rotation-alignment");d.compileFilter();const Y=d.dynamicFilter(),ie=d.dynamicFilterNeedsFeature(),re=this.transform.calculatePixelsToTileUnitsMatrix(v),fe=Qs(q,v.tileID.canonical,ee,U,this.transform,E.getProjection(),re);let ge=null;if(ee){const xe=Oi(q,v.tileID.canonical,ee,U,this.transform,E.getProjection(),re);ge=p.multiply([],this.transform.labelPlaneMatrix,xe)}let de=null;Y&&v.latestFeatureIndex&&(de={unwrappedTileID:j,dynamicFilter:Y,dynamicFilterNeedsFeature:ie,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[E.bucketInstanceId]=new Jt(E.bucketInstanceId,M,E.sourceLayerIndex,E.index,v.tileID);const be={bucket:E,layout:I,posMatrix:q,textLabelPlaneMatrix:fe,labelToScreenMatrix:ge,clippingData:de,scale:F,textPixelRatio:L,holdingForFade:v.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(E.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(b)for(const xe of E.sortKeyRanges){const{sortKey:Ie,symbolInstanceStart:Xe,symbolInstanceEnd:Te}=xe;c.push({sortKey:Ie,symbolInstanceStart:Xe,symbolInstanceEnd:Te,parameters:be})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:be})}attemptAnchorPlacement(c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J,ee,U,Y){const{textOffset0:ie,textOffset1:re,crossTileID:fe}=q,ge=[ie,re],de=Yc(c,v,b,ge,E),be=this.collisionIndex.placeCollisionBox(Q,E,d,oh(de.x,de.y,M,I,this.transform.angle),j,k,F,L.predicate);if(ee){const xe=Q.getSymbolInstanceIconSize(Y,this.transform.zoom,q.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Q,xe,ee,oh(de.x,de.y,M,I,this.transform.angle),j,k,F,L.predicate).box.length)return}if(be.box.length>0){let xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[fe]&&this.prevPlacement.placements[fe]&&this.prevPlacement.placements[fe].text&&(xe=this.prevPlacement.variableOffsets[fe].anchor),this.variableOffsets[fe]={textOffset:ge,width:v,height:b,anchor:c,textScale:E,prevAnchor:xe},this.markUsedJustification(Q,c,q,J),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,J,q),this.placedOrientations[fe]=J),{shift:de,placedGlyphBoxes:be}}}placeLayerBucketPart(c,d,v,b){const{bucket:E,layout:M,posMatrix:I,textLabelPlaneMatrix:k,labelToScreenMatrix:F,clippingData:L,textPixelRatio:j,holdingForFade:q,collisionBoxArray:K,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:J,collisionGroup:ee}=c.parameters,U=M.get("text-optional"),Y=M.get("icon-optional"),ie=M.get("text-allow-overlap"),re=M.get("icon-allow-overlap"),fe="map"===M.get("text-rotation-alignment"),ge="map"===M.get("text-pitch-alignment"),de="none"!==M.get("icon-text-fit"),be="viewport-y"===M.get("symbol-z-order");this.transform.setProjection(E.projection);let xe=ie&&(re||!E.hasIconData()||Y),Ie=re&&(ie||!E.hasTextData()||U);!E.collisionArrays&&K&&E.deserializeCollisionBoxes(K),v&&b&&E.updateCollisionDebugBuffers(this.transform.zoom,K);const Xe=(Te,je,Pe)=>{const{crossTileID:We,numVerticalGlyphVertices:Se}=Te;if(L){const Qn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Gn=null;if(L.dynamicFilterNeedsFeature){const bn=this.retainedQueryData[E.bucketInstanceId];Gn=L.featureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:bn.bucketIndex,sourceLayerIndex:bn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Qn,Gn,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new p.Point(Te.tileAnchorX,Te.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[We]=new nt(!1,!1,!1,!0),void d.add(We)}if(d.has(We))return;if(q)return void(this.placements[We]=new nt(!1,!1,!1));let Ne=!1,Ye=!1,$e=!0,qe=!1,_t=!1,zt=null,mt={box:null,offscreen:null,occluded:null},Tt={box:null,offscreen:null,occluded:null},dn=null,sn=null,vt=null,On=0,Jn=0,Ln=0;Pe.textFeatureIndex?On=Pe.textFeatureIndex:Te.useRuntimeCollisionCircles&&(On=Te.featureIndex),Pe.verticalTextFeatureIndex&&(Jn=Pe.verticalTextFeatureIndex);const Vn=Qn=>{Qn.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Gn=this.transform.elevation;(Gn||Qn.elevation)&&(Qn.elevation=Gn?Gn.getAtTileOffset(Qn.tileID,Qn.tileAnchorX,Qn.tileAnchorY):0)},yr=Pe.textBox;if(yr){Vn(yr);const Qn=bn=>{let wi=p.WritingMode.horizontal;if(E.allowVerticalPlacement&&!bn&&this.prevPlacement){const cr=this.prevPlacement.placedOrientations[We];cr&&(this.placedOrientations[We]=cr,wi=cr,this.markUsedOrientation(E,wi,Te))}return wi},Gn=(bn,wi)=>{if(E.allowVerticalPlacement&&Se>0&&Pe.verticalTextBox){for(const cr of E.writingModes)if(cr===p.WritingMode.vertical?(mt=wi(),Tt=mt):mt=bn(),mt&&mt.box&&mt.box.length)break}else mt=bn()};if(M.get("text-variable-anchor")){let bn=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[We]){const ci=this.prevPlacement.variableOffsets[We];bn.indexOf(ci.anchor)>0&&(bn=bn.filter(Zr=>Zr!==ci.anchor),bn.unshift(ci.anchor))}const wi=(ci,Zr,mu)=>{const kl=E.getSymbolInstanceTextSize(Q,Te,this.transform.zoom,je),fo=(ci.x2-ci.x1)*kl+2*ci.padding,la=(ci.y2-ci.y1)*kl+2*ci.padding,ds=de&&!re?Zr:null;ds&&Vn(ds);let ca={box:[],offscreen:!1,occluded:!1};const gu=ie?2*bn.length:bn.length;for(let Rl=0;Rl<gu;++Rl){const _u=this.attemptAnchorPlacement(bn[Rl%bn.length],ci,fo,la,kl,fe,ge,j,I,ee,Rl>=bn.length,Te,je,E,mu,ds,Q,J);if(_u&&(ca=_u.placedGlyphBoxes,ca&&ca.box&&ca.box.length)){Ne=!0,zt=_u.shift;break}}return ca};Gn(()=>wi(yr,Pe.iconBox,p.WritingMode.horizontal),()=>{const ci=Pe.verticalTextBox;return ci&&Vn(ci),E.allowVerticalPlacement&&!(mt&&mt.box&&mt.box.length)&&Se>0&&ci?wi(ci,Pe.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),mt&&(Ne=mt.box,$e=mt.offscreen,qe=mt.occluded);const cr=Qn(!(!mt||!mt.box));if(!Ne&&this.prevPlacement){const ci=this.prevPlacement.variableOffsets[We];ci&&(this.variableOffsets[We]=ci,this.markUsedJustification(E,ci.anchor,Te,cr))}}else{const bn=(wi,cr)=>{const ci=E.getSymbolInstanceTextSize(Q,Te,this.transform.zoom,je),Zr=this.collisionIndex.placeCollisionBox(E,ci,wi,new p.Point(0,0),ie,j,I,ee.predicate);return Zr&&Zr.box&&Zr.box.length&&(this.markUsedOrientation(E,cr,Te),this.placedOrientations[We]=cr),Zr};Gn(()=>bn(yr,p.WritingMode.horizontal),()=>{const wi=Pe.verticalTextBox;return E.allowVerticalPlacement&&Se>0&&wi?(Vn(wi),bn(wi,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Qn(!!(mt&&mt.box&&mt.box.length))}}if(dn=mt,Ne=dn&&dn.box&&dn.box.length>0,$e=dn&&dn.offscreen,qe=dn&&dn.occluded,Te.useRuntimeCollisionCircles){const Qn=E.text.placedSymbolArray.get(Te.centerJustifiedTextSymbolIndex>=0?Te.centerJustifiedTextSymbolIndex:Te.verticalPlacedTextSymbolIndex),Gn=p.evaluateSizeForFeature(E.textSizeData,Q,Qn),bn=M.get("text-padding");sn=this.collisionIndex.placeCollisionCircles(E,ie,Qn,E.lineVertexArray,E.glyphOffsetArray,Gn,I,k,F,v,ge,ee.predicate,Te.collisionCircleDiameter*Gn/p.ONE_EM,bn,this.retainedQueryData[E.bucketInstanceId].tileID),Ne=ie||sn.circles.length>0&&!sn.collisionDetected,$e=$e&&sn.offscreen,qe=sn.occluded}if(Pe.iconFeatureIndex&&(Ln=Pe.iconFeatureIndex),Pe.iconBox){const Qn=Gn=>{Vn(Gn);const bn=de&&zt?oh(zt.x,zt.y,fe,ge,this.transform.angle):new p.Point(0,0),wi=E.getSymbolInstanceIconSize(J,this.transform.zoom,Te.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,wi,Gn,bn,re,j,I,ee.predicate)};Tt&&Tt.box&&Tt.box.length&&Pe.verticalIconBox?(vt=Qn(Pe.verticalIconBox),Ye=vt.box.length>0):(vt=Qn(Pe.iconBox),Ye=vt.box.length>0),$e=$e&&vt.offscreen,_t=vt.occluded}const Si=U||0===Te.numHorizontalGlyphVertices&&0===Se,Do=Y||0===Te.numIconVertices;if(Si||Do?Do?Si||(Ye=Ye&&Ne):Ne=Ye&&Ne:Ye=Ne=Ye&&Ne,Ne&&dn&&dn.box&&this.collisionIndex.insertCollisionBox(dn.box,M.get("text-ignore-placement"),E.bucketInstanceId,Tt&&Tt.box&&Jn?Jn:On,ee.ID),Ye&&vt&&this.collisionIndex.insertCollisionBox(vt.box,M.get("icon-ignore-placement"),E.bucketInstanceId,Ln,ee.ID),sn&&(Ne&&this.collisionIndex.insertCollisionCircles(sn.circles,M.get("text-ignore-placement"),E.bucketInstanceId,On,ee.ID),v)){const Qn=E.bucketInstanceId;let Gn=this.collisionCircleArrays[Qn];void 0===Gn&&(Gn=this.collisionCircleArrays[Qn]=new Aa);for(let bn=0;bn<sn.circles.length;bn+=4)Gn.circles.push(sn.circles[bn+0]),Gn.circles.push(sn.circles[bn+1]),Gn.circles.push(sn.circles[bn+2]),Gn.circles.push(sn.collisionDetected?1:0)}const hs="globe"!==E.projection.name;xe=xe&&(hs||!qe),Ie=Ie&&(hs||!_t),this.placements[We]=new nt(Ne||xe,Ye||Ie,$e||E.justReloaded),d.add(We)};if(be){const Te=E.getSortedSymbolIndexes(this.transform.angle);for(let je=Te.length-1;je>=0;--je){const Pe=Te[je];Xe(E.symbolInstances.get(Pe),Pe,E.collisionArrays[Pe])}}else for(let Te=c.symbolInstanceStart;Te<c.symbolInstanceEnd;Te++)Xe(E.symbolInstances.get(Te),Te,E.collisionArrays[Te]);if(v&&E.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[E.bucketInstanceId];p.invert(Te.invProjMatrix,I),Te.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(c,d,v,b){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:k,crossTileID:F}=v,L=p.getAnchorJustification(d),j=b===p.WritingMode.vertical?k:"left"===L?E:"center"===L?M:"right"===L?I:-1;E>=0&&(c.text.placedSymbolArray.get(E).crossTileID=j>=0&&E!==j?0:F),M>=0&&(c.text.placedSymbolArray.get(M).crossTileID=j>=0&&M!==j?0:F),I>=0&&(c.text.placedSymbolArray.get(I).crossTileID=j>=0&&I!==j?0:F),k>=0&&(c.text.placedSymbolArray.get(k).crossTileID=j>=0&&k!==j?0:F)}markUsedOrientation(c,d,v){const b=d===p.WritingMode.horizontal||d===p.WritingMode.horizontalOnly?d:0,E=d===p.WritingMode.vertical?d:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:F}=v,L=c.text.placedSymbolArray;M>=0&&(L.get(M).placedOrientation=b),I>=0&&(L.get(I).placedOrientation=b),k>=0&&(L.get(k).placedOrientation=b),F>=0&&(L.get(F).placedOrientation=E)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let v=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(c):1,E=d?d.opacities:{},M=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(const k in this.placements){const F=this.placements[k],L=E[k];L?(this.opacities[k]=new As(L,b,F.text,F.icon,null,F.clipped),v=v||F.text!==L.text.placed||F.icon!==L.icon.placed):(this.opacities[k]=new As(null,b,F.text,F.icon,F.skipFade,F.clipped),v=v||F.text||F.icon)}for(const k in E){const F=E[k];if(!this.opacities[k]){const L=new As(F,b,!1,!1);L.isHidden()||(this.opacities[k]=L,v=v||F.text.placed||F.icon.placed)}}for(const k in M)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=M[k]);for(const k in I)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=I[k]);v?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:c)}updateLayerOpacities(c,d){const v=new Set;for(const b of d){const E=b.getBucket(c);E&&b.latestFeatureIndex&&c.id===E.layerIds[0]&&this.updateBucketOpacities(E,v,b.collisionBoxArray)}}updateBucketOpacities(c,d,v){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const b=c.layers[0].layout,E=!!c.layers[0].dynamicFilter(),M=new As(null,0,!1,!1,!0),I=b.get("text-allow-overlap"),k=b.get("icon-allow-overlap"),F=b.get("text-variable-anchor"),L="map"===b.get("text-rotation-alignment"),j="map"===b.get("text-pitch-alignment"),q="none"!==b.get("icon-text-fit"),K=new As(null,0,I&&(k||!c.hasIconData()||b.get("icon-optional")),k&&(I||!c.hasTextData()||b.get("text-optional")),!0);!c.collisionArrays&&v&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(v);const Q=(ee,U,Y)=>{for(let ie=0;ie<U/4;ie++)ee.opacityVertexArray.emplaceBack(Y)};let J=0;for(let ee=0;ee<c.symbolInstances.length;ee++){const U=c.symbolInstances.get(ee),{numHorizontalGlyphVertices:Y,numVerticalGlyphVertices:ie,crossTileID:re,numIconVertices:fe}=U,ge=d.has(re);let de=this.opacities[re];ge?de=M:de||(de=K,this.opacities[re]=de),d.add(re);const be=Y>0||ie>0,xe=fe>0,Ie=this.placedOrientations[re],Xe=Ie===p.WritingMode.vertical,Te=Ie===p.WritingMode.horizontal||Ie===p.WritingMode.horizontalOnly;if(!be&&!xe||de.isHidden()||J++,be){const je=ah(de.text);Q(c.text,Y,Xe?Ti:je),Q(c.text,ie,Te?Ti:je);const Pe=de.text.isHidden(),{leftJustifiedTextSymbolIndex:We,centerJustifiedTextSymbolIndex:Se,rightJustifiedTextSymbolIndex:Ne,verticalPlacedTextSymbolIndex:Ye}=U,$e=c.text.placedSymbolArray,qe=Pe||Xe?1:0;We>=0&&($e.get(We).hidden=qe),Se>=0&&($e.get(Se).hidden=qe),Ne>=0&&($e.get(Ne).hidden=qe),Ye>=0&&($e.get(Ye).hidden=Pe||Te?1:0);const _t=this.variableOffsets[re];_t&&this.markUsedJustification(c,_t.anchor,U,Ie);const zt=this.placedOrientations[re];zt&&(this.markUsedJustification(c,"left",U,zt),this.markUsedOrientation(c,zt,U))}if(xe){const je=ah(de.icon),{placedIconSymbolIndex:Pe,verticalPlacedIconSymbolIndex:We}=U,Se=c.icon.placedSymbolArray,Ne=de.icon.isHidden()?1:0;Pe>=0&&(Q(c.icon,fe,Xe?Ti:je),Se.get(Pe).hidden=Ne),We>=0&&(Q(c.icon,U.numVerticalIconVertices,Te?Ti:je),Se.get(We).hidden=Ne)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const je=c.collisionArrays[ee];if(je){let Pe=new p.Point(0,0),We=!0;if(je.textBox||je.verticalTextBox){if(F){const Ne=this.variableOffsets[re];Ne?(Pe=Yc(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textScale),L&&Pe._rotate(j?this.transform.angle:-this.transform.angle)):We=!1}E&&(We=!de.clipped),je.textBox&&ea(c.textCollisionBox.collisionVertexArray,de.text.placed,!We||Xe,Pe.x,Pe.y),je.verticalTextBox&&ea(c.textCollisionBox.collisionVertexArray,de.text.placed,!We||Te,Pe.x,Pe.y)}const Se=We&&Boolean(!Te&&je.verticalIconBox);je.iconBox&&ea(c.iconCollisionBox.collisionVertexArray,de.icon.placed,Se,q?Pe.x:0,q?Pe.y:0),je.verticalIconBox&&ea(c.iconCollisionBox.collisionVertexArray,de.icon.placed,!Se,q?Pe.x:0,q?Pe.y:0)}}}if(c.fullyClipped=0===J,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const ee=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=ee.invProjMatrix,c.placementViewportMatrix=ee.viewportMatrix,c.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,d){const v=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*v>c}setStale(){this.stale=!0}}function ea(g,c,d,v,b){g.emplaceBack(c?1:0,d?1:0,v||0,b||0),g.emplaceBack(c?1:0,d?1:0,v||0,b||0),g.emplaceBack(c?1:0,d?1:0,v||0,b||0),g.emplaceBack(c?1:0,d?1:0,v||0,b||0)}const ai=Math.pow(2,25),Fi=Math.pow(2,24),Nd=Math.pow(2,17),Ep=Math.pow(2,16),zi=Math.pow(2,9),as=Math.pow(2,8),vg=Math.pow(2,1);function ah(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const c=g.placed?1:0,d=Math.floor(127*g.opacity);return d*ai+c*Fi+d*Nd+c*Ep+d*zi+c*as+d*vg+c}const Ti=0;class Kc{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,d,v,b,E){const M=this._bucketParts;for(;this._currentTileIndex<c.length;)if(d.getBucketParts(M,b,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((I,k)=>I.sortKey-k.sortKey));this._currentPartIndex<M.length;){const I=M[this._currentPartIndex];if(d.placeLayerBucketPart(I,this._seenCrossTileIDs,v,0===I.symbolInstanceStart),this._currentPartIndex++,E())return!0}return!1}}class Dp{constructor(c,d,v,b,E,M,I,k){this.placement=new sh(c,E,M,I,k),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(c,d,v){const b=p.exported.now(),E=()=>{const M=p.exported.now()-b;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=d[c[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if("symbol"===M.type&&(!M.minzoom||M.minzoom<=I)&&(!M.maxzoom||M.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Kc(M)),this._inProgressLayer.continuePlacement(v[M.source],this.placement,this._showCollisionBoxes,M,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const ml=512/p.EXTENT/2;class Tr{constructor(c,d,v){this.tileID=c,this.bucketInstanceId=v,this.index=new p.KDBush(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=c.canonical.x*p.EXTENT,E=c.canonical.y*p.EXTENT;for(let M=0;M<d.length;M++){const{key:I,crossTileID:k,tileAnchorX:F,tileAnchorY:L}=d.get(M),j=Math.floor((b+F)*ml),q=Math.floor((E+L)*ml);this.index.add(j,q),this.keys.push(I),this.crossTileIDs.push(k)}this.index.finish()}findMatches(c,d,v){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),E=ml/Math.pow(2,d.canonical.z-this.tileID.canonical.z),M=d.canonical.x*p.EXTENT,I=d.canonical.y*p.EXTENT;for(let k=0;k<c.length;k++){const F=c.get(k);if(F.crossTileID)continue;const{key:L,tileAnchorX:j,tileAnchorY:q}=F,K=Math.floor((M+j)*E),Q=Math.floor((I+q)*E),J=this.index.range(K-b,Q-b,K+b,Q+b);for(const ee of J){const U=this.crossTileIDs[ee];if(this.keys[ee]===L&&!v.has(U)){v.add(U),F.crossTileID=U;break}}}}}class lo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Rn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const d=Math.round((c-this.lng)/360);if(0!==d)for(const v in this.indexes){const b=this.indexes[v],E={};for(const M in b){const I=b[M];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),E[I.tileID.key]=I}this.indexes[v]=E}this.lng=c}addBucket(c,d,v){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let E=0;E<d.symbolInstances.length;E++)d.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const b=this.usedCrossTileIDs[c.overscaledZ];for(const E in this.indexes){const M=this.indexes[E];if(Number(E)>c.overscaledZ)for(const I in M){const k=M[I];k.tileID.isChildOf(c)&&k.findMatches(d.symbolInstances,c,b)}else{const I=M[c.scaledTo(Number(E)).key];I&&I.findMatches(d.symbolInstances,c,b)}}for(let E=0;E<d.symbolInstances.length;E++){const M=d.symbolInstances.get(E);M.crossTileID||(M.crossTileID=v.generate(),b.add(M.crossTileID))}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Tr(c,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(c,d){for(const v of d.crossTileIDs)this.usedCrossTileIDs[c].delete(v)}removeStaleBuckets(c){let d=!1;for(const v in this.indexes){const b=this.indexes[v];for(const E in b)c[b[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,b[E]),delete b[E],d=!0)}return d}}class Pa{constructor(){this.layerIndexes={},this.crossTileIDs=new lo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,d,v,b){let E=this.layerIndexes[c.id];void 0===E&&(E=this.layerIndexes[c.id]=new Rn);let M=!1;const I={};"globe"!==b.name&&E.handleWrapJump(v);for(const k of d){const F=k.getBucket(c);F&&c.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(k.tileID,F,this.crossTileIDs)&&(M=!0),I[F.bucketInstanceId]=!0)}return E.removeStaleBuckets(I)&&(M=!0),M}pruneUnusedLayers(c){const d={};c.forEach(v=>{d[v]=!0});for(const v in this.layerIndexes)d[v]||delete this.layerIndexes[v]}}const gl=(g,c)=>p.emitValidationErrors(g,c&&c.filter(d=>"source.canvas"!==d.identifier)),Bd=p.pick(Lt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),At=p.pick(Lt,["setCenter","setZoom","setBearing","setPitch"]),Tp={version:8,layers:[],sources:{}},Ui={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class bo extends p.Evented{constructor(c,d={}){super(),this.map=c,this.dispatcher=new fn(rc(),this),this.imageManager=new al,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(c._requestManager,d.localFontFamily?p.LocalGlyphMode.all:d.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.crossTileSymbolIndex=new Pa,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const v=this;this._rtlTextPluginCallback=bo.registerForPluginStateChange(b=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(E,M)=>{if(p.triggerPluginCompletionEvent(E),M&&M.every(I=>I))for(const I in v._sourceCaches){const k=v._sourceCaches[I],F=k.getSource().type;"vector"!==F&&"geojson"!==F||k.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const E=this.getSource(b.sourceId);if(E&&E.vectorLayerIds)for(const M in this._layers){const I=this._layers[M];I.source===E.id&&this._validateLayer(I)}})}loadURL(c,d={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const v="boolean"==typeof d.validate?d.validate:!p.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);const b=this.map._requestManager.transformRequest(c,p.ResourceType.Style);this._request=p.getJSON(b,(E,M)=>{this._request=null,E?this.fire(new p.ErrorEvent(E)):M&&this._load(M,v)})}loadJSON(c,d={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(c,!1!==d.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Tp,!1)}_updateLayerCount(c,d){const v=d?1:-1;c.is3D()&&(this._num3DLayers+=v),"circle"===c.type&&(this._numCircleLayers+=v),"symbol"===c.type&&(this._numSymbolLayers+=v)}_load(c,d){if(d&&gl(this,p.validateStyle(c)))return;this._loaded=!0,this.stylesheet=p.clone$1(c),this._updateMapProjection();for(const b in c.sources)this.addSource(b,c.sources[b],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const v=wp(this.stylesheet.layers);this._order=v.map(b=>b.id),this._layers={},this._serializedLayers={};for(const b of v){const E=p.createStyleLayer(b);E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new or(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(d,v,b){let E,M,I;const k=p.exported.devicePixelRatio>1?"@2x":"";let F=p.getJSON(v.transformRequest(v.normalizeSpriteURL(d,k,".json"),p.ResourceType.SpriteJSON),(q,K)=>{F=null,I||(I=q,E=K,j())}),L=p.getImage(v.transformRequest(v.normalizeSpriteURL(d,k,".png"),p.ResourceType.SpriteImage),(q,K)=>{L=null,I||(I=q,M=K,j())});function j(){if(I)b(I);else if(E&&M){const q=p.exported.getImageData(M),K={};for(const Q in E){const{width:J,height:ee,x:U,y:Y,sdf:ie,pixelRatio:re,stretchX:fe,stretchY:ge,content:de}=E[Q],be=new p.RGBAImage({width:J,height:ee});p.RGBAImage.copy(q,be,{x:U,y:Y},{x:0,y:0},{width:J,height:ee}),K[Q]={data:be,pixelRatio:re,sdf:ie,stretchX:fe,stretchY:ge,content:de}}b(null,K)}}return{cancel(){F&&(F.cancel(),F=null),L&&(L.cancel(),L=null)}}}(c,this.map._requestManager,(d,v)=>{if(this._spriteRequest=null,d)this.fire(new p.ErrorEvent(d));else if(v)for(const b in v)this.imageManager.addImage(b,v[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(c){const d=this.getSource(c.source);if(!d)return;const v=c.sourceLayer;v&&("geojson"===d.type||d.vectorLayerIds&&-1===d.vectorLayerIds.indexOf(v))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${d.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const d=[];for(const v of c){const b=this._layers[v];"custom"!==b.type&&d.push(b.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&("function"==typeof c.isLayerDraped?c.isLayerDraped():Ui[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const d=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(b.length||E.length)&&this._updateWorkerLayers(b,E);for(const M in this._updatedSources){const I=this._updatedSources[M];"reload"===I?this._reloadSource(M):"clear"===I&&this._clearSource(M)}this._updateTilesForChangedImages();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const v={};for(const b in this._sourceCaches){const E=this._sourceCaches[b];v[b]=E.used,E.used=!1}for(const b of this._order){const E=this._layers[b];if(E.recalculate(c,this._availableImages),!E.isHidden(c.zoom)){const I=this._getLayerSourceCache(E);I&&(I.used=!0)}const M=this.map.painter;if(M){const I=E.getProgramIds();if(!I)continue;const k=E.getProgramConfiguration(c.zoom);for(const F of I)M.useProgram(F,k)}}for(const b in v){const E=this._sourceCaches[b];v[b]!==E.used&&E.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),gl(this,p.validateStyle(c)))return!1;(c=p.clone$1(c)).layers=wp(c.layers);const d=function(b,E){if(!b)return[{command:Lt.setStyle,args:[E]}];let M=[];try{if(!Ue(b.version,E.version))return[{command:Lt.setStyle,args:[E]}];Ue(b.center,E.center)||M.push({command:Lt.setCenter,args:[E.center]}),Ue(b.zoom,E.zoom)||M.push({command:Lt.setZoom,args:[E.zoom]}),Ue(b.bearing,E.bearing)||M.push({command:Lt.setBearing,args:[E.bearing]}),Ue(b.pitch,E.pitch)||M.push({command:Lt.setPitch,args:[E.pitch]}),Ue(b.sprite,E.sprite)||M.push({command:Lt.setSprite,args:[E.sprite]}),Ue(b.glyphs,E.glyphs)||M.push({command:Lt.setGlyphs,args:[E.glyphs]}),Ue(b.transition,E.transition)||M.push({command:Lt.setTransition,args:[E.transition]}),Ue(b.light,E.light)||M.push({command:Lt.setLight,args:[E.light]}),Ue(b.fog,E.fog)||M.push({command:Lt.setFog,args:[E.fog]}),Ue(b.projection,E.projection)||M.push({command:Lt.setProjection,args:[E.projection]});const I={},k=[];!function(j,q,K,Q){let J;for(J in q=q||{},j=j||{})j.hasOwnProperty(J)&&(q.hasOwnProperty(J)||so(J,K,Q));for(J in q){if(!q.hasOwnProperty(J))continue;const ee=q[J];j.hasOwnProperty(J)?Ue(j[J],ee)||("geojson"===j[J].type&&"geojson"===ee.type&&ih(j,q,J)?K.push({command:Lt.setGeoJSONSourceData,args:[J,ee.data]}):Cp(J,q,K,Q)):Ia(J,q,K)}}(b.sources,E.sources,k,I);const F=[];b.layers&&b.layers.forEach(j=>{j.source&&I[j.source]?M.push({command:Lt.removeLayer,args:[j.id]}):F.push(j)});let L=b.terrain;L&&I[L.source]&&(M.push({command:Lt.setTerrain,args:[void 0]}),L=void 0),M=M.concat(k),Ue(L,E.terrain)||M.push({command:Lt.setTerrain,args:[E.terrain]}),function(j,q,K){q=q||[];const Q=(j=j||[]).map(ss),J=q.map(ss),ee=j.reduce(rh,{}),U=q.reduce(rh,{}),Y=Q.slice(),ie=Object.create(null);let re,fe,ge,de,be,xe,Ie;for(re=0,fe=0;re<Q.length;re++)ge=Q[re],U.hasOwnProperty(ge)?fe++:(K.push({command:Lt.removeLayer,args:[ge]}),Y.splice(Y.indexOf(ge,fe),1));for(re=0,fe=0;re<J.length;re++)ge=J[J.length-1-re],Y[Y.length-1-re]!==ge&&(ee.hasOwnProperty(ge)?(K.push({command:Lt.removeLayer,args:[ge]}),Y.splice(Y.lastIndexOf(ge,Y.length-fe),1)):fe++,xe=Y[Y.length-re],K.push({command:Lt.addLayer,args:[U[ge],xe]}),Y.splice(Y.length-re,0,ge),ie[ge]=!0);for(re=0;re<J.length;re++)if(ge=J[re],de=ee[ge],be=U[ge],!ie[ge]&&!Ue(de,be))if(Ue(de.source,be.source)&&Ue(de["source-layer"],be["source-layer"])&&Ue(de.type,be.type)){for(Ie in os(de.layout,be.layout,K,ge,null,Lt.setLayoutProperty),os(de.paint,be.paint,K,ge,null,Lt.setPaintProperty),Ue(de.filter,be.filter)||K.push({command:Lt.setFilter,args:[ge,be.filter]}),Ue(de.minzoom,be.minzoom)&&Ue(de.maxzoom,be.maxzoom)||K.push({command:Lt.setLayerZoomRange,args:[ge,be.minzoom,be.maxzoom]}),de)de.hasOwnProperty(Ie)&&"layout"!==Ie&&"paint"!==Ie&&"filter"!==Ie&&"metadata"!==Ie&&"minzoom"!==Ie&&"maxzoom"!==Ie&&(0===Ie.indexOf("paint.")?os(de[Ie],be[Ie],K,ge,Ie.slice(6),Lt.setPaintProperty):Ue(de[Ie],be[Ie])||K.push({command:Lt.setLayerProperty,args:[ge,Ie,be[Ie]]}));for(Ie in be)be.hasOwnProperty(Ie)&&!de.hasOwnProperty(Ie)&&"layout"!==Ie&&"paint"!==Ie&&"filter"!==Ie&&"metadata"!==Ie&&"minzoom"!==Ie&&"maxzoom"!==Ie&&(0===Ie.indexOf("paint.")?os(de[Ie],be[Ie],K,ge,Ie.slice(6),Lt.setPaintProperty):Ue(de[Ie],be[Ie])||K.push({command:Lt.setLayerProperty,args:[ge,Ie,be[Ie]]}))}else K.push({command:Lt.removeLayer,args:[ge]}),xe=Y[Y.lastIndexOf(ge)+1],K.push({command:Lt.addLayer,args:[be,xe]})}(F,E.layers,M)}catch(I){console.warn("Unable to compute style diff:",I),M=[{command:Lt.setStyle,args:[E]}]}return M}(this.serialize(),c).filter(b=>!(b.command in At));if(0===d.length)return!1;const v=d.filter(b=>!(b.command in Bd));if(v.length>0)throw new Error(`Unimplemented: ${v.map(b=>b.command).join(", ")}.`);return d.forEach(b=>{"setTransition"!==b.command&&"setProjection"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,d){return this.getImage(c)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,d),this._afterImageUpdated(c),this)}updateImage(c,d){this.imageManager.updateImage(c,d)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,d,v={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(p.validateSource,`sources.${c}`,d,null,v))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=tn(c,d,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:b.serialize(),sourceId:c}));const E=M=>{const I=(M?"symbol:":"other:")+c,k=this._sourceCaches[I]=new p.SourceCache(I,b,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[c]=k,k.style=this,k.onAdd(this.map)};E(!1),"vector"!==d.type&&"geojson"!==d.type||E(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const d=this.getSource(c);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(c);for(const b of v)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,d){this._checkLoaded(),this.getSource(c).setData(d),this._changed=!0}getSource(c){const d=this._getSourceCache(c);return d&&d.getSource()}_getSources(){const c=[];for(const d in this._otherSourceCaches){const v=this._getSourceCache(d);v&&c.push(v.getSource())}return c}addLayer(c,d,v={}){this._checkLoaded();const b=c.id;if(this.getLayer(b))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let E;if("custom"===c.type){if(gl(this,p.validateCustomStyleLayer(c)))return;E=p.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(b,c.source),c=p.clone$1(c),c=p.extend(c,{source:b})),this._validate(p.validateLayer,`layers.${b}`,c,{arrayIndex:-1},v))return;E=p.createStyleLayer(c),this._validateLayer(E),E.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}const M=d?this._order.indexOf(d):this._order.length;if(d&&-1===M)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(M,0,b),this._layerOrderChanged=!0,this._layers[b]=E;const I=this._getLayerSourceCache(E);if(this._removedLayers[b]&&E.source&&I&&"custom"!==E.type){const k=this._removedLayers[b];delete this._removedLayers[b],k.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",I.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,d){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===d)return;const v=this._order.indexOf(c);this._order.splice(v,1);const b=d?this._order.indexOf(d):this._order.length;d&&-1===b?this.fire(new p.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(b,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const d=this._layers[c];if(!d)return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const v=this._order.indexOf(c);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const d in this._layers)if(this._layers[d].type===c)return!0;return!1}setLayerZoomRange(c,d,v){this._checkLoaded();const b=this.getLayer(c);b?b.minzoom===d&&b.maxzoom===v||(null!=d&&(b.minzoom=d),null!=v&&(b.maxzoom=v),this._updateLayer(b)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,d,v={}){this._checkLoaded();const b=this.getLayer(c);if(b){if(!Ue(b.filter,d))return null==d?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(p.validateFilter,`layers.${b.id}.filter`,d,{layerType:b.type},v)||(b.filter=p.clone$1(d),this._updateLayer(b)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const d=this.getLayer(c);return d&&p.clone$1(d.filter)}setLayoutProperty(c,d,v,b={}){this._checkLoaded();const E=this.getLayer(c);E?Ue(E.getLayoutProperty(d),v)||(E.setLayoutProperty(d,v,b),this._updateLayer(E)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,d){const v=this.getLayer(c);if(v)return v.getLayoutProperty(d);this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,d,v,b={}){this._checkLoaded();const E=this.getLayer(c);E?Ue(E.getPaintProperty(d),v)||(E.setPaintProperty(d,v,b)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,d){const v=this.getLayer(c);return v&&v.getPaintProperty(d)}setFeatureState(c,d){this._checkLoaded();const v=c.source,b=c.sourceLayer,E=this.getSource(v);if(!E)return void this.fire(new p.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const M=E.type;if("geojson"===M&&b)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===M&&!b)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const I=this._getSourceCaches(v);for(const k of I)k.setFeatureState(b,c.id,d)}removeFeatureState(c,d){this._checkLoaded();const v=c.source,b=this.getSource(v);if(!b)return void this.fire(new p.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const E=b.type,M="vector"===E?c.sourceLayer:void 0;if("vector"===E&&!M)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const I=this._getSourceCaches(v);for(const k of I)k.removeFeatureState(M,c.id,d)}getFeatureState(c){this._checkLoaded();const d=c.source,v=c.sourceLayer,b=this.getSource(d);if(b){if("vector"!==b.type||v)return void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(v,c.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const d in this._sourceCaches){const v=this._sourceCaches[d].getSource();c[v.id]||(c[v.id]=v.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(c){this._updatedLayers[c.id]=!0;const d=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&d&&"raster"!==d.getSource().type&&(this._updatedSources[c.source]="reload",d.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const d=M=>"fill-extrusion"===this._layers[M].type,v={},b=[];for(let M=this._order.length-1;M>=0;M--){const I=this._order[M];if(d(I)){v[I]=M;for(const k of c){const F=k[I];if(F)for(const L of F)b.push(L)}}}b.sort((M,I)=>I.intersectionZ-M.intersectionZ);const E=[];for(let M=this._order.length-1;M>=0;M--){const I=this._order[M];if(d(I))for(let k=b.length-1;k>=0;k--){const F=b[k].feature;if(v[F.layer.id]<M)break;E.push(F),b.pop()}else for(const k of c){const F=k[I];if(F)for(const L of F)E.push(L.feature)}}return E}queryRenderedFeatures(c,d,v){d&&d.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of d.layers){const F=this._layers[k];if(!F)return this.fire(new p.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];b[F.source]=!0}}const E=[];d.availableImages=this._availableImages;const M=d&&d.layers?d.layers.some(k=>{const F=this.getLayer(k);return F&&F.is3D()}):this.has3DLayers(),I=wa.createFromScreenPoints(c,v);for(const k in this._sourceCaches){const F=this._sourceCaches[k].getSource().id;d.layers&&!b[F]||E.push(xn(this._sourceCaches[k],this._layers,this._serializedLayers,I,d,v,M,!!this.map._showQueryGeometry))}return this.placement&&E.push(function(k,F,L,j,q,K,Q){const J={},ee=K.queryRenderedSymbols(j),U=[];for(const Y of Object.keys(ee).map(Number))U.push(Q[Y]);U.sort(Dr);for(const Y of U){const ie=Y.featureIndex.lookupSymbolFeatures(ee[Y.bucketInstanceId],F,Y.bucketIndex,Y.sourceLayerIndex,q.filter,q.layers,q.availableImages,k);for(const re in ie){const fe=J[re]=J[re]||[],ge=ie[re];ge.sort((de,be)=>{const xe=Y.featureSortOrder;if(xe){const Ie=xe.indexOf(de.featureIndex);return xe.indexOf(be.featureIndex)-Ie}return be.featureIndex-de.featureIndex});for(const de of ge)fe.push(de)}}for(const Y in J)J[Y].forEach(ie=>{const re=ie.feature,fe=L(k[Y]);if(!fe)return;const ge=fe.getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=ge});return J}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),I.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(c,d){d&&d.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",d.filter,null,d);const v=this._getSourceCaches(c);let b=[];for(const E of v)b=b.concat(Ri(E,d));return b}addSourceType(c,d,v){return bo.getSourceType(c)?v(new Error(`A source type called "${c}" already exists.`)):(bo.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(c,d={}){this._checkLoaded();const v=this.light.getLight();let b=!1;for(const M in c)if(!Ue(c[M],v[M])){b=!0;break}if(!b)return;const E=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,d),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,d=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=c;if(1===d){if("object"==typeof v.source){const b="terrain-dem-src";this.addSource(b,v.source),v=p.clone$1(v),v=p.extend(v,{source:b})}if(this._validate(p.validateTerrain,"terrain",v))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,d)}else{const b=this.terrain,E=b.get();for(const M of Object.keys(p.spec.terrain))!v.hasOwnProperty(M)&&p.spec.terrain[M].default&&(v[M]=p.spec.terrain[M].default);for(const M in v)if(!Ue(v[M],E[M])){b.set(v),this.stylesheet.terrain=v;const I=this._setTransitionParameters({duration:0});b.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const d=this.fog=new cl(c,this.map.transform);this.stylesheet.fog=c;const v=this._setTransitionParameters({duration:0});d.updateTransitions(v)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,v=d.get();0===Object.keys(c).length&&d.set(c);for(const b in c)if(!Ue(c[b],v[b])){d.set(c),this.stylesheet.fog=c;const E=this._setTransitionParameters({duration:0});d.updateTransitions(E);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:p.exported.now(),transition:p.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(v=>this.isLayerDraped(this._layers[v])),d=this._order.filter(v=>!this.isLayerDraped(this._layers[v]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...d)}_createTerrain(c,d){const v=this.terrain=new Ju(c,d);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b=this._setTransitionParameters({duration:0});v.updateTransitions(b)}_force3DLayerUpdate(){for(const c in this._layers){const d=this._layers[c];"fill-extrusion"===d.type&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const d=this._layers[c];"symbol"===d.type&&this._updateLayer(d)}}_validate(c,d,v,b,E={}){return(!E||!1!==E.validate)&&gl(this,c.call(p.validateStyle,p.extend({key:d,style:this.serialize(),value:v,styleSpec:p.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const d=this._getSourceCaches(c);for(const v of d)v.clearTiles()}_reloadSource(c){const d=this._getSourceCaches(c);for(const v of d)v.resume(),v.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const d in this._sourceCaches)this._sourceCaches[d].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const d=this._sourceCaches[c];d.resume(),d.reload()}}_updatePlacement(c,d,v,b,E=!1){let M=!1,I=!1;const k={};for(const F of this._order){const L=this._layers[F];if("symbol"!==L.type)continue;if(!k[L.source]){const q=this._getLayerSourceCache(L);if(!q)continue;k[L.source]=q.getRenderableIds(!0).map(K=>q.getTileByID(K)).sort((K,Q)=>Q.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(Q.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(L,k[L.source],c.center.lng,c.projection);M=M||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),E=E||this._layerOrderChanged||0===v,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),c.zoom))&&(this.pauseablePlacement=new Dp(c,this._order,E,d,v,b,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),I=!0),M&&this.pauseablePlacement.placement.setStale()),I||M)for(const F of this._order){const L=this._layers[F];"symbol"===L.type&&this.placement.updateLayerOpacities(L,k[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,d,v){this.imageManager.getImages(d.icons,v),this._updateTilesForChangedImages();const b=E=>{E&&E.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(c,d,v){this.glyphManager.getGlyphs(d.stacks,v)}getResource(c,d,v){return p.makeRequest(d,v)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const d=[];return this._otherSourceCaches[c]&&d.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&d.push(this._symbolSourceCaches[c]),d}_isSourceCacheLoaded(c){const d=this._getSourceCaches(c);return 0===d.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):d.every(v=>v.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}bo.getSourceType=function(g){return Ut[g]},bo.setSourceType=function(g,c){Ut[g]=c},bo.registerForPluginStateChange=p.registerForPluginStateChange;var Vd="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",ka="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ta="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ac="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Vo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let lc={},_l={};const Jc=[];yl(Vd,Jc),yl(ta,Jc),yl(ac,Jc),yl(Vo,Jc),lc=Mn("",ta),_l=Mn(Vo,ac);const Nt=Mn("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),cc=Vd,jd="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var co={background:Mn("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Mn("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Mn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Mn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Mn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Mn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Mn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Mn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Mn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Mn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Mn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Mn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Mn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Mn("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Mn("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Mn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Mn("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Mn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Mn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Mn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Mn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Mn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Mn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Mn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Mn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ka),skyboxGradient:Mn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ka),skyboxCapture:Mn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Mn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Mn("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function yl(g,c){const d=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let v of d)if(v=v.trim(),"#"===v[0]&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=v.split(" ");for(const E of b)c.includes(E)||c.push(E)}}function Mn(g,c){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b={},E=[...Jc];return yl(g,E),yl(c,E),{fragmentSource:g=g.replace(d,(M,I,k,F,L)=>(b[L]=!0,"define"===I?`\n#ifndef HAS_UNIFORM_u_${L}\nvarying ${k} ${F} ${L};\n#else\nuniform ${k} ${F} u_${L};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${L}\n    ${k} ${F} ${L} = u_${L};\n#endif\n`)),vertexSource:c=c.replace(d,(M,I,k,F,L)=>{const j="float"===F?"vec2":"vec4",q=L.match(/color/)?"color":j;return b[L]?"define"===I?`\n#ifndef HAS_UNIFORM_u_${L}\nuniform lowp float u_${L}_t;\nattribute ${k} ${j} a_${L};\nvarying ${k} ${F} ${L};\n#else\nuniform ${k} ${F} u_${L};\n#endif\n`:"vec4"===q?`\n#ifndef HAS_UNIFORM_u_${L}\n    ${L} = a_${L};\n#else\n    ${k} ${F} ${L} = u_${L};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${L}\n    ${L} = unpack_mix_${q}(a_${L}, u_${L}_t);\n#else\n    ${k} ${F} ${L} = u_${L};\n#endif\n`:"define"===I?`\n#ifndef HAS_UNIFORM_u_${L}\nuniform lowp float u_${L}_t;\nattribute ${k} ${j} a_${L};\n#else\nuniform ${k} ${F} u_${L};\n#endif\n`:"vec4"===q?`\n#ifndef HAS_UNIFORM_u_${L}\n    ${k} ${F} ${L} = a_${L};\n#else\n    ${k} ${F} ${L} = u_${L};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${L}\n    ${k} ${F} ${L} = unpack_mix_${q}(a_${L}, u_${L}_t);\n#else\n    ${k} ${F} ${L} = u_${L};\n#endif\n`}),staticAttributes:v,usedDefines:E}}class hi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,d,v,b,E,M,I){this.context=c;let k=this.boundPaintVertexBuffers.length!==b.length;for(let L=0;!k&&L<b.length;L++)this.boundPaintVertexBuffers[L]!==b[L]&&(k=!0);let F=this.boundDynamicVertexBuffers.length!==I.length;for(let L=0;!F&&L<I.length;L++)this.boundDynamicVertexBuffers[L]!==I[L]&&(F=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==v||k||F||this.boundIndexBuffer!==E||this.boundVertexOffset!==M)this.freshBind(d,v,b,E,M,I);else{c.bindVertexArrayOES.set(this.vao);for(const L of I)L&&L.bind();E&&E.dynamicDraw&&E.bind()}}freshBind(c,d,v,b,E,M){let I;const k=c.numAttributes,F=this.context,L=F.gl;if(F.extVertexArrayObject)this.vao&&this.destroy(),this.vao=F.extVertexArrayObject.createVertexArrayOES(),F.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=c,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=b,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=M;else{I=F.currentNumAttributes||0;for(let j=k;j<I;j++)L.disableVertexAttribArray(j)}d.enableAttributes(L,c),d.bind(),d.setVertexAttribPointers(L,c,E);for(const j of v)j.enableAttributes(L,c),j.bind(),j.setVertexAttribPointers(L,c,E);for(const j of M)j&&(j.enableAttributes(L,c),j.bind(),j.setVertexAttribPointers(L,c,E));b&&b.bind(),F.currentNumAttributes=k}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Sp(g,c){const d=Math.pow(2,c.canonical.z),v=c.canonical.y;return[new p.MercatorCoordinate(0,v/d).toLngLat().lat,new p.MercatorCoordinate(0,(v+1)/d).toLngLat().lat]}function xg(g,c,d,v,b,E,M){const I=g.context,k=I.gl,F=d.fbo;if(!F)return;g.prepareDrawTile();const L=g.useProgram("hillshade");I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,F.colorAttachment.get());const j=((J,ee,U,Y)=>{const ie=U.paint.get("hillshade-shadow-color"),re=U.paint.get("hillshade-highlight-color"),fe=U.paint.get("hillshade-accent-color");let ge=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===U.paint.get("hillshade-illumination-anchor")&&(ge-=J.transform.angle);const de=!J.options.moving;return{u_matrix:Y||J.transform.calculateProjMatrix(ee.tileID.toUnwrapped(),de),u_image:0,u_latrange:Sp(0,ee.tileID),u_light:[U.paint.get("hillshade-exaggeration"),ge],u_shadow:ie,u_highlight:re,u_accent:fe}})(g,d,v,g.terrain?c.projMatrix:null);g.prepareDrawProgram(I,L,c.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:K,tileBoundsSegments:Q}=g.getTileBoundsBuffers(d);L.draw(I,k.TRIANGLES,b,E,M,p.CullFaceMode.disabled,j,v.id,q,K,Q)}function Mp(g,c,d){if(!c.needsDEMTextureUpload)return;const v=g.context,b=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||g.getTileTexture(d.stride);const E=d.getPixels();c.demTexture?c.demTexture.update(E,{premultiply:!1}):c.demTexture=new p.Texture(v,E,b.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function uc(g,c,d,v,b,E){const M=g.context,I=M.gl;if(!c.dem)return;const k=c.dem;if(M.activeTexture.set(I.TEXTURE1),Mp(g,c,k),!c.demTexture)return;c.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);const F=k.dim;M.activeTexture.set(I.TEXTURE0);let L=c.fbo;if(!L){const Q=new p.Texture(M,{width:F,height:F,data:null},I.RGBA);Q.bind(I.LINEAR,I.CLAMP_TO_EDGE),L=c.fbo=M.createFramebuffer(F,F,!0),L.colorAttachment.set(Q.texture)}M.bindFramebuffer.set(L.framebuffer),M.viewport.set([0,0,F,F]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:q,tileBoundsSegments:K}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(M,I.TRIANGLES,v,b,E,p.CullFaceMode.disabled,((Q,J)=>{const ee=J.stride,U=p.create();return p.ortho(U,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(U,U,[0,-p.EXTENT,0]),{u_matrix:U,u_image:1,u_dimension:[ee,ee],u_zoom:Q.overscaledZ,u_unpack:J.unpackVector}})(c.tileID,k),d.id,j,q,K),c.needsHillshadePrepare=!1}const Qc=g=>({u_matrix:new p.UniformMatrix4f(g),u_image0:new p.Uniform1i(g),u_skirt_height:new p.Uniform1f(g)}),na=(g,c)=>({u_matrix:g,u_image0:0,u_skirt_height:c}),lh=(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:d,u_zoom_transition:b,u_merc_center:E,u_image0:0,u_frustum_tl:M,u_frustum_tr:I,u_frustum_br:k,u_frustum_bl:F,u_globe_pos:L,u_globe_radius:j,u_viewport:q,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:K});function hc(g,c){return null!=g&&null!=c&&!(!g.hasData()||!c.hasData())&&null!=g.demTexture&&null!=c.demTexture&&g.tileID.key!==c.tileID.key}const ia=new class{constructor(){this.operations={}}newMorphing(g,c,d,v,b){if(g in this.operations){const E=this.operations[g];E.to.tileID.key!==d.tileID.key&&(E.queued=d)}else this.operations[g]={startTime:v,phase:0,duration:b,from:c,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const c=this.operations[g];return{from:c.from,to:c.to,phase:c.phase}}update(g){for(const c in this.operations){const d=this.operations[c];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[c];break}}}_nextOp(g,c){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=c,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Ra={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Oa(g){return 6*Math.pow(1.5,22-g)}function vl(g,c){const d=1<<g.z;return!c&&(0===g.x||g.x===d-1)||0===g.y||g.y===d-1}const eu=g=>({u_matrix:g});function Dt(g,c,d,v,b){if(b>0){const E=p.exported.now(),M=(E-g.timeAdded)/b,I=c?(E-c.timeAdded)/b:-1,k=d.getSource(),F=v.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),L=!c||Math.abs(c.tileID.overscaledZ-F)>Math.abs(g.tileID.overscaledZ-F),j=L&&g.refreshedUponExpiration?1:p.clamp(L?M:1-I,0,1);return g.refreshedUponExpiration&&M>=1&&(g.refreshedUponExpiration=!1),c?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class ch extends p.SourceCache{constructor(c){const d={type:"raster-dem",maxzoom:c.transform.maxZoom},v=new fn(rc(),null),b=tn("mock-dem",d,v,c.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,d){c.state="loaded",d(null)}}class cn extends p.SourceCache{constructor(c){const d=tn("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new fn(rc(),null),c.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,d,v){if(c.freezeTileCoverage)return;this.transform=c;const b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,M)=>{if(E[M.key]="",!this._tiles[M.key]){const I=new p.Tile(M,this._source.tileSize*M.overscaleFactor(),c.tileZoom);I.state="loaded",this._tiles[M.key]=I}return E},{});for(const E in this._tiles)E in b||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(c){const d=this.proxyCachedFBO[c];if(void 0!==d){const v=Object.values(d);this.renderCachePool.push(...v),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class xl extends p.OverscaledTileID{constructor(c,d,v){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=d,this.projMatrix=v}}class tu extends p.Elevation{constructor(c,d){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,b,E]=function(k){const F=new p.StructArrayLayout2i4,L=new p.StructArrayLayout3ui6,j=131;F.reserve(17161),L.reserve(33800);const q=p.EXTENT/128,K=p.EXTENT+q/2,Q=K+q;for(let ee=-q;ee<Q;ee+=q)for(let U=-q;U<Q;U+=q){const Y=U<0||U>K||ee<0||ee>K?24575:0,ie=p.clamp(Math.round(U),0,p.EXTENT),re=p.clamp(Math.round(ee),0,p.EXTENT);F.emplaceBack(ie+Y,re)}const J=(ee,U)=>{const Y=U*j+ee;L.emplaceBack(Y+1,Y,Y+j),L.emplaceBack(Y+j,Y+j+1,Y+1)};for(let ee=1;ee<129;ee++)for(let U=1;U<129;U++)J(U,ee);return[0,129].forEach(ee=>{for(let U=0;U<130;U++)J(U,ee),J(ee,U)}),[F,L,32768]}(),M=c.context;this.gridBuffer=M.createVertexBuffer(v,p.posAttributes.members),this.gridIndexBuffer=M.createIndexBuffer(b),this.gridSegments=p.SegmentVector.simpleSegment(0,0,v.length,b.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,v.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new cn(d.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const I=M.gl;this._overlapStencilMode=new p.StencilMode({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ch(d.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,d,v){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const b=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const E=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const M=this.getScaledDemTileSize();this.sourceCache.update(d,M,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,E(),this._initializing=!0),E(),d.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=0===v._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(v.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(k=>{const F=d.getTileByID(k).tileID;return F.projMatrix=v.calculateProjMatrix(F.toUnwrapped()),F});(function(k,F){const L=F.transform.pointCoordinate(F.transform.getCameraPoint()),j=new p.Point(L.x,L.y);k.sort((q,K)=>{if(K.overscaledZ-q.overscaledZ)return K.overscaledZ-q.overscaledZ;const Q=new p.Point(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),J=new p.Point(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ee=j.mult(1<<q.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(Q)-ee.distSqr(J)})})(b,this.painter),this._previousZoom=v.zoom;const E=this.proxyToSource||{};this.proxyToSource={},b.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const M=this._style._sourceCaches;for(const k in M){const F=M[k];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,c[k],E),F.usedForTerrain))continue;const L=c[k];F.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[d.id]=b.map(k=>new xl(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const I={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const F=this.terrainTileForTile[k.key];if(!F)continue;const L=F.tileID.key;L in I||(this._visibleDemTiles.push(F),I[L]=L)}}_assignTerrainTiles(c){this._initializing||c.forEach(d=>{if(this.terrainTileForTile[d.key])return;const v=this._findTileCoveringTileID(d,this.sourceCache);v&&(this.terrainTileForTile[d.key]=v)})}_prepareDEMTextures(){const c=this.painter.context,d=c.gl;for(const v in this.terrainTileForTile){const b=this.terrainTileForTile[v],E=b.dem;!E||b.demTexture&&!b.needsDEMTextureUpload||(c.activeTexture.set(d.TEXTURE1),Mp(this.painter,b,E))}}_prepareDemTileUniforms(c,d,v,b){if(!d||null==d.demTexture)return!1;const E=c.tileID.canonical,M=Math.pow(2,d.tileID.canonical.z-E.z),I=b||"";return v[`u_dem_tl${I}`]=[E.x*M%1,E.y*M%1],v[`u_dem_scale${I}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,d=c.gl;if(!this._emptyDepthBufferTexture){const v=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(c,v,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const d=this._visibleDemTiles.reduce((v,b)=>{if(!b.dem)return v;const E=b.dem.tree.minimums[0];return E>0&&c++,v+E},0);return c?d/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,d=c.gl;c.activeTexture.set(d.TEXTURE2);const v=this._getLoadedAreaMinimum(),b=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(v,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(b,{premultiply:!1}):E=this._emptyDEMTexture=new p.Texture(c,b,d.RGBA,{premultiply:!1}),E}setupElevationDraw(c,d,v){const b=this.painter.context,E=b.gl,M=(I=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(I),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var I;M.u_dem_size=this.sourceCache.getSource().tileSize,M.u_exaggeration=this.exaggeration();let k=null,F=null,L=1;if(v&&v.morphing&&this._useVertexMorphing){const j=v.morphing.srcDemTile,q=v.morphing.dstDemTile;L=v.morphing.phase,j&&q&&(this._prepareDemTileUniforms(c,j,M,"_prev")&&(F=j),this._prepareDemTileUniforms(c,q,M)&&(k=q))}if(F&&k?(b.activeTexture.set(E.TEXTURE2),k.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),b.activeTexture.set(E.TEXTURE4),F.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),M.u_dem_lerp=L):(k=this.terrainTileForTile[c.tileID.key],b.activeTexture.set(E.TEXTURE2),(this._prepareDemTileUniforms(c,k,M)?k.demTexture:this.emptyDEMTexture).bind(E.NEAREST,E.CLAMP_TO_EDGE)),b.activeTexture.set(E.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),this._depthFBO&&(M.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),M.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&k){const j=(1<<k.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=j}if(v&&v.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),d.setTerrainUniformValues(b,M),"globe"===this.painter.transform.projection.name){const j=this.globeUniformValues(this.painter.transform,c.tileID.canonical,v&&v.useDenormalizedUpVectorScale);d.setGlobeUniformValues(b,j)}}globeUniformValues(c,d,v){const b=c.projection;return{u_tile_tl_up:b.upVector(d,0,0),u_tile_tr_up:b.upVector(d,p.EXTENT,0),u_tile_br_up:b.upVector(d,p.EXTENT,p.EXTENT),u_tile_bl_up:b.upVector(d,0,p.EXTENT),u_tile_up_scale:v?p.globeMetersToEcef(1):b.upVectorScale(d,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const d=this.painter,v=this.painter.context;0!==c.length&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,E,M,I,k){if("globe"===b.transform.projection.name)!function(F,L,j,q,K){const Q=F.context,J=Q.gl;let ee,U;const Y=F.options.showTerrainWireframe?2:0,ie=F.transform,re=p.globeUseCustomAntiAliasing(F,Q,ie),fe=(We,Se)=>{if(U===We)return;const Ne=[Ra[We],"PROJECTION_GLOBE_VIEW"];re&&Ne.push("CUSTOM_ANTIALIASING"),Se&&Ne.push(Ra[Y]),ee=F.useProgram("globeRaster",null,Ne),U=We},ge=F.colorModeForRenderPass(),de=new p.DepthMode(J.LEQUAL,p.DepthMode.ReadWrite,F.depthRangeFor3D);ia.update(K);const be=p.calculateGlobeMercatorMatrix(ie),xe=[p.mercatorXfromLng(ie.center.lng),p.mercatorYfromLat(ie.center.lat)],Ie=Y?[!1,!0]:[!1],Xe=F.globeSharedBuffers,Te=[ie.width*p.exported.devicePixelRatio,ie.height*p.exported.devicePixelRatio],je=Float32Array.from(ie.globeMatrix),Pe={useDenormalizedUpVectorScale:!0};if(Ie.forEach(We=>{const Se=F.transform,Ne=Oa(Se.zoom)*L.exaggeration();U=-1;const Ye=We?J.LINES:J.TRIANGLES;for(const $e of q){const qe=j.getTile($e),_t=p.StencilMode.disabled,zt=L.prevTerrainTileForTile[$e.key],mt=L.terrainTileForTile[$e.key];hc(zt,mt)&&ia.newMorphing($e.key,zt,mt,K,250),Q.activeTexture.set(J.TEXTURE0),qe.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Tt=ia.getMorphValuesForProxy($e.key),dn=Tt?1:0;Tt&&p.extend$1(Pe,{morphing:{srcDemTile:Tt.from,dstDemTile:Tt.to,phase:p.easeCubicInOut(Tt.phase)}});const sn=p.tileCornersToBounds($e.canonical),vt=p.getLatitudinalLod(sn.getCenter().lat),On=p.getGridMatrix($e.canonical,sn,vt,Se.worldSize/Se._pixelsPerMercatorPixel),Jn=p.globeNormalizeECEF(p.globeTileBounds($e.canonical)),Ln=lh(Se.projMatrix,je,be,Jn,p.globeToMercatorTransition(Se.zoom),xe,Se.frustumCorners.TL,Se.frustumCorners.TR,Se.frustumCorners.BR,Se.frustumCorners.BL,Se.globeCenterInViewSpace,Se.globeRadius,Te,Ne,On);if(fe(dn,We),L.setupElevationDraw(qe,ee,Pe),F.prepareDrawProgram(Q,ee,$e.toUnwrapped()),Xe){const[Vn,yr,Si]=We?Xe.getWirefameBuffers(F.context,vt):Xe.getGridBuffers(vt,0!==Ne);ee.draw(Q,Ye,de,_t,ge,p.CullFaceMode.backCCW,Ln,"globe_raster",Vn,yr,Si)}}}),Xe){const We=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&We.push("CUSTOM_ANTIALIASING"),ee=F.useProgram("globeRaster",null,We);for(const Se of q){const{x:Ne,y:Ye,z:$e}=Se.canonical,qe=0===Ye,_t=Ye===(1<<$e)-1,[zt,mt,Tt,dn]=Xe.getPoleBuffers($e);if(dn&&(qe||_t)){const sn=j.getTile(Se);Q.activeTexture.set(J.TEXTURE0),sn.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let vt=p.globePoleMatrixForTile($e,Ne,ie);const On=p.globeNormalizeECEF(p.globeTileBounds(Se.canonical)),Jn=(Ln,Vn)=>Ln.draw(Q,J.TRIANGLES,de,p.StencilMode.disabled,ge,p.CullFaceMode.disabled,lh(ie.projMatrix,vt,vt,On,0,xe,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Te,0),"globe_pole_raster",Vn,Tt,dn);L.setupElevationDraw(sn,ee,Pe),F.prepareDrawProgram(Q,ee,Se.toUnwrapped()),qe&&Jn(ee,zt),_t&&(vt=p.scale(p.create(),vt,[1,-1,1]),Jn(ee,mt))}}}}(b,E,M,I,k);else{const F=b.context,L=F.gl;let j,q;const K=b.options.showTerrainWireframe?2:0,Q=(ie,re)=>{if(q===ie)return;const fe=[Ra[ie]];re&&fe.push(Ra[K]),j=b.useProgram("terrainRaster",null,fe),q=ie},J=b.colorModeForRenderPass(),ee=new p.DepthMode(L.LEQUAL,p.DepthMode.ReadWrite,b.depthRangeFor3D);ia.update(k);const U=b.transform,Y=Oa(U.zoom)*E.exaggeration();(K?[!1,!0]:[!1]).forEach(ie=>{q=-1;const re=ie?L.LINES:L.TRIANGLES,[fe,ge]=ie?E.getWirefameBuffer():[E.gridIndexBuffer,E.gridSegments];for(const de of I){const be=M.getTile(de),xe=p.StencilMode.disabled,Ie=E.prevTerrainTileForTile[de.key],Xe=E.terrainTileForTile[de.key];hc(Ie,Xe)&&ia.newMorphing(de.key,Ie,Xe,k,250),F.activeTexture.set(L.TEXTURE0),be.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const Te=ia.getMorphValuesForProxy(de.key),je=Te?1:0;let Pe;Te&&(Pe={morphing:{srcDemTile:Te.from,dstDemTile:Te.to,phase:p.easeCubicInOut(Te.phase)}});const We=na(de.projMatrix,vl(de.canonical,U.renderWorldCopies)?Y/10:Y);Q(je,ie),E.setupElevationDraw(be,j,Pe),b.prepareDrawProgram(F,j,de.toUnwrapped()),j.draw(F,re,ee,xe,J,p.CullFaceMode.backCCW,We,"terrain_raster",E.gridBuffer,fe,ge)}})}}(d,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const d=this.painter,v=this.painter.context,b=this.proxySourceCache,E=this.proxiedCoords[b.id],M=this._drapedRenderBatches.shift(),I=[],k=d.style.order;let F=0;for(const L of E){const j=b.getTileByID(L.proxyTileKey),q=b.proxyCachedFBO[L.key]?b.proxyCachedFBO[L.key][c]:void 0,K=void 0!==q?b.renderCache[q]:this.pool[F++],Q=void 0!==q;if(j.texture=K.tex,Q&&!K.dirty){I.push(j.tileID);continue}let J;v.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(v.clear({color:p.Color.transparent,stencil:0}),K.dirty=!1);for(let ee=M.start;ee<=M.end;++ee){const U=d.style._layers[k[ee]];if(U.isHidden(d.transform.zoom))continue;const Y=d.style._getLayerSourceCache(U),ie=Y?this.proxyToSource[L.key][Y.id]:[L];if(!ie)continue;const re=ie;v.viewport.set([0,0,K.fb.width,K.fb.height]),J!==(Y?Y.id:null)&&(this._setupStencil(K,ie,U,Y),J=Y?Y.id:null),d.renderLayer(d,Y,U,re)}this.renderedToTile?(K.dirty=!0,I.push(j.tileID)):Q||--F,5===F&&(F=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,d.width,d.height]),M.end+1}postRender(){}renderCacheEfficiency(c){const d=c.order.length;if(0===d)return{efficiency:100};let v,b=0,E=0,M=!1;for(let I=0;I<d;++I){const k=c._layers[c.order[I]];this._style.isLayerDraped(k)?(M&&++b,++E):M||(M=!0,v=k.id)}return 0===E?{efficiency:100}:{efficiency:100*(1-b/E),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{c=Math.min(c,d.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,d,v){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const M=E.tileID,I=1<<M.overscaledZ,{x:k,y:F}=M.canonical,L=k/I,j=(k+1)/I,q=F/I,K=(F+1)/I;return{minx:L,miny:q,maxx:j,maxy:K,t:E.dem.tree.raycastRoot(L,q,j,K,c,d,v),tile:E}});b.sort((E,M)=>(null!==E.t?E.t:Number.MAX_VALUE)-(null!==M.t?M.t:Number.MAX_VALUE));for(const E of b){if(null==E.t)return null;const M=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,c,d,v);if(null!=M)return M}return null}_createFBO(){const c=this.painter.context,d=c.gl,v=this.drapeBufferSize;c.activeTexture.set(d.TEXTURE0);const b=new p.Texture(c,{width:v[0],height:v[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const E=c.createFramebuffer(v[0],v[1],!1);return E.colorAttachment.set(b.texture),E.depthAttachment=new _e(c,E.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:E,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const d=this._style._layers[c],v=d.isHidden(this.painter.transform.zoom);return"custom"===d.type?!v&&d.shouldRedrape():!v&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const v of this._style._getSources())if(v instanceof it){c=!0;break}if(!c)return;const d={};for(let v=0;v<this._style.order.length;++v){const b=this._style._layers[this._style.order[v]],E=this._style._getLayerSourceCache(b);if(E&&!d[E.id]&&!b.isHidden(this.painter.transform.zoom)&&"line"===b.type&&b.widthExpression()instanceof p.ZoomDependentExpression){d[E.id]=!0;for(const M of this.proxyCoords){const I=this.proxyToSource[M.key][E.id];if(I)for(const k of I)this._clearRenderCacheForTile(E.id,k)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const v in this._style._sourceCaches)if(this._style._sourceCaches[v]._source instanceof Je){c=!0;break}if(!c)return;const d={};for(let v=0;v<this._style.order.length;++v){const b=this._style._layers[this._style.order[v]],E=this._style._getLayerSourceCache(b);if(!E||d[E.id]||b.isHidden(this.painter.transform.zoom)||"raster"!==b.type)continue;const M=b.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const k=this.proxyToSource[I.key][E.id];if(k)for(const F of k){const L=Dt(E.getTile(F),E.findLoadedParent(F,0),E,this.painter.transform,M);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(E.id,F)}}}}_setupDrapedRenderBatches(){const c=this._style.order,d=c.length;if(0===d)return;const v=[];let b,E=0,M=this._style._layers[c[E]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++E<d;)M=this._style._layers[c[E]];for(;E<d;++E){const I=this._style._layers[c[E]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?void 0===b&&(b=E):void 0!==b&&(v.push({start:b,end:E-1}),b=void 0))}void 0!==b&&v.push({start:b,end:E-1}),this._drapedRenderBatches=v}_setupRenderCache(c){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const M=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let I=0;I<M.length;++I){const k=Object.values(M[I]);d.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,b=this._tilesDirty;for(let M=v.length-1;M>=0;M--){const I=v[M];if(d.getTileByID(I.key),void 0!==d.proxyCachedFBO[I.key]){const k=c[I.key],F=this.proxyToSource[I.key];let L=0;for(const j in F){const q=F[j],K=k[j];if(!K||K.length!==q.length||q.some((Q,J)=>Q!==K[J]||b[j]&&b[j].hasOwnProperty(Q.key))){L=-1;break}++L}for(const j in d.proxyCachedFBO[I.key])d.renderCache[d.proxyCachedFBO[I.key][j]].dirty=L<0||L!==Object.values(k).length}}const E=[...this._drapedRenderBatches];E.sort((M,I)=>I.end-I.start-(M.end-M.start));for(const M of E)for(const I of v){if(d.proxyCachedFBO[I.key])continue;let k=d.renderCachePool.pop();void 0===k&&d.renderCache.length<50&&(k=d.renderCache.length,d.renderCache.push(this._createFBO())),void 0!==k&&(d.proxyCachedFBO[I.key]={},d.proxyCachedFBO[I.key][M.start]=k,d.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(c,d,v,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,M=E.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let I;if(v.isTileClipped())I=d.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(c,d){const v=this.painter,b=this.painter.context,E=b.gl;v._tileClippingMaskIDs={},b.setColorMode(p.ColorMode.disabled),b.setDepthMode(p.DepthMode.disabled);const M=v.useProgram("clippingMask");for(const I of c){const k=v._tileClippingMaskIDs[I.key]=--d;M.draw(b,E.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:E.ALWAYS,mask:0},k,255,E.KEEP,E.KEEP,E.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,eu(I.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(c){const d=this.painter.transform;if(c.x<0||c.x>d.width||c.y<0||c.y>d.height)return null;const v=[c.x,c.y,1,1];p.transformMat4$1(v,v,d.pixelMatrixInverse),p.scale$1(v,v,1/v[3]),v[0]/=d.worldSize,v[1]/=d.worldSize;const b=d._camera.position,E=p.mercatorZfromAltitude(1,d.center.lat),M=[b[0],b[1],b[2]/E,0],I=p.subtract([],v.slice(0,3),M);p.normalize(I,I);const k=this.raycast(M,I,this._exaggeration);return null!==k&&k?(p.scaleAndAdd(M,M,I,k),M[3]=M[2],M[2]*=E,M):null}drawDepth(){const c=this.painter,d=c.context,v=this.proxySourceCache,b=Math.ceil(c.width),E=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===E||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const M=d.gl,I=d.createFramebuffer(b,E,!0);d.activeTexture.set(M.TEXTURE0);const k=new p.Texture(d,{width:b,height:E,data:null},M.RGBA);k.bind(M.NEAREST,M.CLAMP_TO_EDGE),I.colorAttachment.set(k.texture);const F=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,b,E);I.depthAttachment.set(F),this._depthFBO=I,this._depthTexture=k}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,b,E]),function(M,I,k,F){if("globe"===M.transform.projection.name)return;const L=M.context,j=L.gl;L.clear({depth:1});const q=M.useProgram("terrainDepth"),K=new p.DepthMode(j.LESS,p.DepthMode.ReadWrite,M.depthRangeFor3D);for(const Q of F){const J=k.getTile(Q),ee=na(Q.projMatrix,0);I.setupElevationDraw(J,q),q.draw(L,j.TRIANGLES,K,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,ee,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(c,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,d,v){if(c.getSource()instanceof en)return this._setupProxiedCoordsForImageSource(c,d,v);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const b=this.proxiedCoords[c.id]=[],E=this.proxyCoords;for(let I=0;I<E.length;I++){const k=E[I],F=this._findTileCoveringTileID(k,c);if(F){const L=this._createProxiedId(k,F,v[k.key]&&v[k.key][c.id]);b.push(L),this.proxyToSource[k.key][c.id]=[L]}}let M=!1;for(let I=0;I<d.length;I++){const k=c.getTile(d[I]);if(!k||!k.hasData())continue;const F=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==k.tileID.canonical.z){const L=this.proxyToSource[F.tileID.key][c.id],j=this._createProxiedId(F.tileID,k,v[F.tileID.key]&&v[F.tileID.key][c.id]);L?L.splice(L.length-1,0,j):this.proxyToSource[F.tileID.key][c.id]=[j],b.push(j),M=!0}}this._sourceTilesOverlap[c.id]=M}_setupProxiedCoordsForImageSource(c,d,v){if(!c.getSource().loaded())return;const b=this.proxiedCoords[c.id]=[],E=this.proxyCoords,M=c.getSource(),I=new p.Point(M.tileID.x,M.tileID.y)._div(1<<M.tileID.z),k=M.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((L,j)=>(L.min.x=Math.min(L.min.x,j.x-I.x),L.min.y=Math.min(L.min.y,j.y-I.y),L.max.x=Math.max(L.max.x,j.x-I.x),L.max.y=Math.max(L.max.y,j.y-I.y),L),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(L,j)=>{const q=L.wrap+L.canonical.x/(1<<L.canonical.z),K=L.canonical.y/(1<<L.canonical.z),Q=p.EXTENT/(1<<L.canonical.z),J=j.wrap+j.canonical.x/(1<<j.canonical.z),ee=j.canonical.y/(1<<j.canonical.z);return q+Q<J+k.min.x||q>J+k.max.x||K+Q<ee+k.min.y||K>ee+k.max.y};for(let L=0;L<E.length;L++){const j=E[L];for(let q=0;q<d.length;q++){const K=c.getTile(d[q]);if(!K||!K.hasData()||F(j,K.tileID))continue;const Q=this._createProxiedId(j,K,v[j.key]&&v[j.key][c.id]),J=this.proxyToSource[j.key][c.id];J?J.push(Q):this.proxyToSource[j.key][c.id]=[Q],b.push(Q)}}}_createProxiedId(c,d,v){let b=this.orthoMatrix;if(v){const E=v.find(M=>M.key===d.tileID.key);if(E)return E}if(d.tileID.key!==c.key){const E=c.canonical.z-d.tileID.canonical.z;let M,I,k;b=p.create();const F=d.tileID.wrap-c.wrap<<c.overscaledZ;E>0?(M=p.EXTENT>>E,I=M*((d.tileID.canonical.x<<E)-c.canonical.x+F),k=M*((d.tileID.canonical.y<<E)-c.canonical.y)):(M=p.EXTENT<<-E,I=p.EXTENT*(d.tileID.canonical.x-(c.canonical.x+F<<-E)),k=p.EXTENT*(d.tileID.canonical.y-(c.canonical.y<<-E))),p.ortho(b,0,M,0,M,0,1),p.translate(b,b,[I,k,0])}return new xl(d.tileID,c.key,b)}_findTileCoveringTileID(c,d){let v=d.getTile(c);if(v&&v.hasData())return v;const b=this._findCoveringTileCache[d.id],E=b[c.key];if(v=E?d.getTileByID(E):null,v&&v.hasData()||null===E)return v;let M=v?v.tileID:c,I=M.overscaledZ;const k=d.getSource().minzoom,F=[];if(!E){const j=d.getSource().maxzoom;if(c.canonical.z>=j){const q=c.canonical.z-j;d.getSource().reparseOverscaled?(I=Math.max(c.canonical.z+2,d.transform.tileZoom),M=new p.OverscaledTileID(I,c.wrap,j,c.canonical.x>>q,c.canonical.y>>q)):0!==q&&(I=j,M=new p.OverscaledTileID(I,c.wrap,j,c.canonical.x>>q,c.canonical.y>>q))}M.key!==c.key&&(F.push(M.key),v=d.getTile(M))}const L=j=>{F.forEach(q=>{b[q]=j}),F.length=0};for(I-=1;I>=k&&(!v||!v.hasData());I--){v&&L(v.tileID.key);const j=M.calculateScaledKey(I);if(v=d.getTileByID(j),v&&v.hasData())break;const q=b[j];if(null===q)break;void 0===q?F.push(j):v=d.getTileByID(q)}return L(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,d){let v=this._tilesDirty[c];v||(v=this._tilesDirty[c]={}),v[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(d){let v=0;const b=new p.StructArrayLayout2ui4,E=131;for(let M=1;M<129;M++){for(let I=1;I<129;I++)v=M*E+I,b.emplaceBack(v,v+1),b.emplaceBack(v,v+E),b.emplaceBack(v+1,v+E),128===M&&b.emplaceBack(v+E,v+E+1);b.emplaceBack(v+1,v+1+E)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class mn{static cacheKey(c,d,v,b){let E=`${d}${b?b.cacheKey:""}`;for(const M of v)c.usedDefines.includes(M)&&(E+=`/${M}`);return E}constructor(c,d,v,b,E,M){const I=c.gl;this.program=I.createProgram();const k=function(U){const Y=[];for(let ie=0;ie<U.length;ie++){if(null===U[ie])continue;const re=U[ie].split(" ");Y.push(re.pop())}return Y}(v.staticAttributes),F=b?b.getBinderAttributes():[],L=k.concat(F);let j=b?b.defines():[];j=j.concat(M.map(U=>`#define ${U}`));const q=c.isWebGL2?"#version 300 es\n":"",K=q+j.concat(c.extStandardDerivatives&&0===q.length?"#extension GL_OES_standard_derivatives : enable\n".concat(jd):jd,jd,cc,Nt.fragmentSource,_l.fragmentSource,v.fragmentSource).join("\n"),Q=q+j.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",cc,Nt.vertexSource,_l.vertexSource,lc.vertexSource,v.vertexSource).join("\n"),J=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(J,K),I.compileShader(J),I.attachShader(this.program,J);const ee=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(ee,Q),I.compileShader(ee),I.attachShader(this.program,ee),this.attributes={},this.numAttributes=L.length;for(let U=0;U<this.numAttributes;U++)L[U]&&(I.bindAttribLocation(this.program,U,L[U]),this.attributes[L[U]]=U);I.linkProgram(this.program),I.deleteShader(ee),I.deleteShader(J),this.fixedUniforms=E(c),this.binderUniforms=b?b.getUniforms(c):[],M.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(U=c),u_dem_prev:new p.Uniform1i(U),u_dem_unpack:new p.Uniform4f(U),u_dem_tl:new p.Uniform2f(U),u_dem_scale:new p.Uniform1f(U),u_dem_tl_prev:new p.Uniform2f(U),u_dem_scale_prev:new p.Uniform1f(U),u_dem_size:new p.Uniform1f(U),u_dem_lerp:new p.Uniform1f(U),u_exaggeration:new p.Uniform1f(U),u_depth:new p.Uniform1i(U),u_depth_size_inv:new p.Uniform2f(U),u_meter_to_dem:new p.Uniform1f(U),u_label_plane_matrix_inv:new p.UniformMatrix4f(U)}),M.includes("GLOBE")&&(this.globeUniforms=(U=>({u_tile_tl_up:new p.Uniform3f(U),u_tile_tr_up:new p.Uniform3f(U),u_tile_br_up:new p.Uniform3f(U),u_tile_bl_up:new p.Uniform3f(U),u_tile_up_scale:new p.Uniform1f(U)}))(c)),M.includes("FOG")&&(this.fogUniforms=(U=>({u_fog_matrix:new p.UniformMatrix4f(U),u_fog_range:new p.Uniform2f(U),u_fog_color:new p.Uniform4f(U),u_fog_horizon_blend:new p.Uniform1f(U),u_fog_temporal_offset:new p.Uniform1f(U),u_frustum_tl:new p.Uniform3f(U),u_frustum_tr:new p.Uniform3f(U),u_frustum_br:new p.Uniform3f(U),u_frustum_bl:new p.Uniform3f(U),u_globe_pos:new p.Uniform3f(U),u_globe_radius:new p.Uniform1f(U),u_globe_transition:new p.Uniform1f(U),u_is_globe:new p.Uniform1i(U),u_viewport:new p.Uniform2f(U)}))(c))}var U}setTerrainUniformValues(c,d){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)v[b]&&v[b].set(this.program,b,d[b])}}setGlobeUniformValues(c,d){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)v[b]&&v[b].set(this.program,b,d[b])}}setFogUniformValues(c,d){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)v[b].set(this.program,b,d[b])}}draw(c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J){const ee=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(v),c.setStencilMode(b),c.setColorMode(E),c.setCullFace(M);for(const Y of Object.keys(this.fixedUniforms))this.fixedUniforms[Y].set(this.program,Y,I[Y]);Q&&Q.setUniforms(this.program,c,this.binderUniforms,q,{zoom:K});const U={[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[d];for(const Y of j.get()){const ie=Y.vaos||(Y.vaos={});(ie[k]||(ie[k]=new hi)).bind(c,this,F,Q?Q.getPaintVertexBuffers():[],L,Y.vertexOffset,J||[]),ee.drawElements(d,Y.primitiveLength*U,ee.UNSIGNED_SHORT,Y.primitiveOffset*U*2)}}}function nu(g,c){const d=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,g.transform.tileZoom)/d,b=v*(c.tileID.canonical.x+c.tileID.wrap*d),E=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/Xi(c,1,g.transform.tileZoom),u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}const Ip=p.create(),Ud=(g,c,d,v,b,E,M,I,k,F,L)=>{const j=c.style.light,q=j.properties.get("position"),K=[q.x,q.y,q.z],Q=p.create$1();"viewport"===j.properties.get("anchor")&&(p.fromRotation(Q,-c.transform.angle),p.transformMat3(K,K,Q));const J=j.properties.get("color"),ee=c.transform,U={u_matrix:g,u_lightpos:K,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+d,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ip,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:E};return"globe"===ee.projection.name&&(U.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],U.u_zoom_transition=k,U.u_inv_rot_matrix=L,U.u_merc_center=F,U.u_up_dir=ee.projection.upVector(new p.CanonicalTileID(0,0,0),F[0]*p.EXTENT,F[1]*p.EXTENT),U.u_height_lift=I),U},Ps=(g,c,d,v,b,E,M,I,k,F,L,j)=>{const q=Ud(g,c,d,v,b,E,M,k,F,L,j),K={u_height_factor:-Math.pow(2,M.overscaledZ)/I.tileSize/8};return p.extend(q,nu(c,I),K)},Sr=g=>({u_matrix:g}),jo=(g,c,d)=>p.extend(Sr(g),nu(c,d)),ra=(g,c)=>({u_matrix:g,u_world:c}),Bn=(g,c,d,v)=>p.extend(jo(g,c,d),{u_world:v}),uh=p.create(),iu=(g,c,d,v,b,E)=>{const M=g.transform,I="globe"===M.projection.name;let k;if("map"===E.paint.get("circle-pitch-alignment"))if(I){const L=p.globePixelsToTileUnits(M.zoom,c.canonical)*M._pixelsPerMercatorPixel;k=Float32Array.from([L,0,0,L])}else k=M.calculatePixelsToTileUnitsMatrix(d);else k=new Float32Array([M.pixelsToGLUnits[0],0,0,M.pixelsToGLUnits[1]]);const F={u_camera_to_center_distance:M.cameraToCenterDistance,u_matrix:g.translatePosMatrix(c.projMatrix,d,E.paint.get("circle-translate"),E.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:k,u_inv_rot_matrix:uh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){F.u_inv_rot_matrix=v,F.u_merc_center=b,F.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],F.u_zoom_transition=p.globeToMercatorTransition(M.zoom);const L=b[0]*p.EXTENT,j=b[1]*p.EXTENT;F.u_up_dir=M.projection.upVector(new p.CanonicalTileID(0,0,0),L,j)}return F},ru=g=>{const c=[];return"map"===g.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},hh=(g,c,d,v)=>{const b=p.EXTENT/d.tileSize;return{u_matrix:g,u_camera_to_center_distance:c.getCameraToCenterDistance(v),u_extrude_scale:[c.pixelsToGLUnits[0]/b,c.pixelsToGLUnits[1]/b]}},Uo=(g,c,d=1)=>({u_matrix:g,u_color:c,u_overlay:0,u_overlay_scale:d}),dc=p.create(),Ap=(g,c,d,v,b,E,M)=>{const I=g.transform,k="globe"===I.projection.name,F=k?p.globePixelsToTileUnits(I.zoom,c.canonical)*I._pixelsPerMercatorPixel:Xi(d,1,E),L={u_matrix:c.projMatrix,u_extrude_scale:F,u_intensity:M,u_inv_rot_matrix:dc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){L.u_inv_rot_matrix=v,L.u_merc_center=b,L.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],L.u_zoom_transition=p.globeToMercatorTransition(I.zoom);const j=b[0]*p.EXTENT,q=b[1]*p.EXTENT;L.u_up_dir=I.projection.upVector(new p.CanonicalTileID(0,0,0),j,q)}return L},ks=(g,c,d,v,b,E,M)=>{const I=g.transform,k=I.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:$d(g,c,d,v),u_pixels_to_tile_units:k,u_device_pixel_ratio:E,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:ar(d)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:fc(c,g.transform),u_alpha_discard_threshold:0,u_trim_offset:M}},ou=(g,c,d,v,b)=>{const E=g.transform;return{u_matrix:$d(g,c,d,v),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:b,u_image:0,u_tile_units_to_pixels:fc(c,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function fc(g,c){return 1/Xi(g,1,c.tileZoom)}function $d(g,c,d,v){return g.translatePosMatrix(v||c.tileID.projMatrix,c,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function ar(g){const c=g.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const Hd=(g,c,d,v,b,E)=>{return{u_matrix:g,u_tl_parent:c,u_scale_parent:d,u_fade_t:v.mix,u_opacity:v.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(I=b.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(M=b.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:ls(b.paint.get("raster-hue-rotate")),u_perspective_transform:E};var M,I};function ls(g){g*=Math.PI/180;const c=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*c-d+1)/3,(Math.sqrt(3)*c-d+1)/3]}const Ft=p.create(),Mr=(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J)=>{const ee=b.transform,U={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:ee.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:ee.width/ee.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:M,u_coord_matrix:I,u_is_text:+k,u_pitch_with_map:+v,u_texsize:F,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ft,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ft,u_up_vector:[0,-1,0]};return"globe"===J.name&&(U.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],U.u_zoom_transition=j,U.u_inv_rot_matrix=K,U.u_merc_center=q,U.u_camera_forward=ee._camera.forward(),U.u_ecef_origin=p.globeECEFOrigin(ee.globeMatrix,L.toUnwrapped()),U.u_tile_matrix=Float32Array.from(ee.globeMatrix),U.u_up_vector=Q),U},In=(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J,ee)=>p.extend(Mr(g,c,d,v,b,E,M,I,k,F,j,q,K,Q,J,ee),{u_gamma_scale:v?b.transform.cameraToCenterDistance*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+L}),pr=(g,c,d,v,b,E,M,I,k,F,L,j,q,K,Q,J)=>p.extend(In(g,c,d,v,b,E,M,I,!0,k,!0,L,j,q,K,Q,J),{u_texsize_icon:F,u_texture_icon:1}),Ir=(g,c,d)=>({u_matrix:g,u_opacity:c,u_color:d}),pc=(g,c,d,v,b)=>p.extend(function(E,M,I){const k=M.imageManager.getPattern(E.toString()),{width:F,height:L}=M.imageManager.getPixelSize(),j=Math.pow(2,I.tileID.overscaledZ),q=I.tileSize*Math.pow(2,M.transform.tileZoom)/j,K=q*(I.tileID.canonical.x+I.tileID.wrap*j),Q=q*I.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[F,L],u_pattern_size:k.displaySize,u_tile_units_to_pixels:1/Xi(I,1,M.transform.tileZoom),u_pixel_coord_upper:[K>>16,Q>>16],u_pixel_coord_lower:[65535&K,65535&Q]}}(v,d,b),{u_matrix:g,u_opacity:c}),Hr={fillExtrusion:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g)}),fillExtrusionPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_height_factor:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g)}),fill:g=>({u_matrix:new p.UniformMatrix4f(g)}),fillPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),fillOutline:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g)}),fillOutlinePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),circle:g=>({u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),collisionBox:g=>({u_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.Uniform2f(g)}),collisionCircle:g=>({u_matrix:new p.UniformMatrix4f(g),u_inv_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_viewport_size:new p.Uniform2f(g)}),debug:g=>({u_color:new p.UniformColor(g),u_matrix:new p.UniformMatrix4f(g),u_overlay:new p.Uniform1i(g),u_overlay_scale:new p.Uniform1f(g)}),clippingMask:g=>({u_matrix:new p.UniformMatrix4f(g)}),heatmap:g=>({u_extrude_scale:new p.Uniform1f(g),u_intensity:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),heatmapTexture:g=>({u_image:new p.Uniform1i(g),u_color_ramp:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g)}),hillshade:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_latrange:new p.Uniform2f(g),u_light:new p.Uniform2f(g),u_shadow:new p.UniformColor(g),u_highlight:new p.UniformColor(g),u_accent:new p.UniformColor(g)}),hillshadePrepare:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_dimension:new p.Uniform2f(g),u_zoom:new p.Uniform1f(g),u_unpack:new p.Uniform4f(g)}),line:g=>({u_matrix:new p.UniformMatrix4f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_units_to_pixels:new p.Uniform2f(g),u_dash_image:new p.Uniform1i(g),u_gradient_image:new p.Uniform1i(g),u_image_height:new p.Uniform1f(g),u_texsize:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g),u_trim_offset:new p.Uniform2f(g)}),linePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_texsize:new p.Uniform2f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_units_to_pixels:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g)}),raster:g=>({u_matrix:new p.UniformMatrix4f(g),u_tl_parent:new p.Uniform2f(g),u_scale_parent:new p.Uniform1f(g),u_fade_t:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_image0:new p.Uniform1i(g),u_image1:new p.Uniform1i(g),u_brightness_low:new p.Uniform1f(g),u_brightness_high:new p.Uniform1f(g),u_saturation_factor:new p.Uniform1f(g),u_contrast_factor:new p.Uniform1f(g),u_spin_weights:new p.Uniform3f(g),u_perspective_transform:new p.Uniform2f(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_texture:new p.Uniform1i(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_is_halo:new p.Uniform1i(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texsize_icon:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_texture_icon:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_is_halo:new p.Uniform1i(g)}),background:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_color:new p.UniformColor(g)}),backgroundPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_pattern_tl:new p.Uniform2f(g),u_pattern_br:new p.Uniform2f(g),u_texsize:new p.Uniform2f(g),u_pattern_size:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),terrainRaster:Qc,terrainDepth:Qc,skybox:g=>({u_matrix:new p.UniformMatrix4f(g),u_sun_direction:new p.Uniform3f(g),u_cubemap:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxGradient:g=>({u_matrix:new p.UniformMatrix4f(g),u_color_ramp:new p.Uniform1i(g),u_center_direction:new p.Uniform3f(g),u_radius:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxCapture:g=>({u_matrix_3f:new p.UniformMatrix3f(g),u_sun_direction:new p.Uniform3f(g),u_sun_intensity:new p.Uniform1f(g),u_color_tint_r:new p.Uniform4f(g),u_color_tint_m:new p.Uniform4f(g),u_luminance:new p.Uniform1f(g)}),globeRaster:g=>({u_proj_matrix:new p.UniformMatrix4f(g),u_globe_matrix:new p.UniformMatrix4f(g),u_normalize_matrix:new p.UniformMatrix4f(g),u_merc_matrix:new p.UniformMatrix4f(g),u_zoom_transition:new p.Uniform1f(g),u_merc_center:new p.Uniform2f(g),u_image0:new p.Uniform1i(g),u_grid_matrix:new p.UniformMatrix3f(g),u_skirt_height:new p.Uniform1f(g),u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_globe_pos:new p.Uniform3f(g),u_globe_radius:new p.Uniform1f(g),u_viewport:new p.Uniform2f(g)}),globeAtmosphere:g=>({u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_horizon:new p.Uniform1f(g),u_transition:new p.Uniform1f(g),u_fadeout_range:new p.Uniform1f(g),u_color:new p.Uniform4f(g),u_high_color:new p.Uniform4f(g),u_space_color:new p.Uniform4f(g),u_star_intensity:new p.Uniform1f(g),u_star_density:new p.Uniform1f(g),u_star_size:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g),u_horizon_angle:new p.Uniform1f(g),u_rotation_matrix:new p.UniformMatrix4f(g)})};let su;function mc(g,c,d,v,b,E,M){const I=g.context,k=I.gl,F=g.transform,L=g.useProgram("collisionBox"),j=[];let q=0,K=0;for(let re=0;re<v.length;re++){const fe=v[re],ge=c.getTile(fe),de=ge.getBucket(d);if(!de)continue;const be=ao(fe,de,F);let xe=be;0===b[0]&&0===b[1]||(xe=g.translatePosMatrix(be,ge,b,E));const Ie=M?de.textCollisionBox:de.iconCollisionBox,Xe=de.collisionCircleArray;if(Xe.length>0){const Te=p.create(),je=xe;p.mul(Te,de.placementInvProjMatrix,F.glCoordMatrix),p.mul(Te,Te,de.placementViewportMatrix),j.push({circleArray:Xe,circleOffset:K,transform:je,invTransform:Te,projection:de.getProjection()}),q+=Xe.length/4,K=q}Ie&&(g.terrain&&g.terrain.setupElevationDraw(ge,L),L.draw(I,k.LINES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,hh(xe,F,ge,de.getProjection()),d.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,null,F.zoom,null,[Ie.collisionVertexBuffer,Ie.collisionVertexBufferExt]))}if(!M||!j.length)return;const Q=g.useProgram("collisionCircle"),J=new p.StructArrayLayout2f1f2i16;J.resize(4*q),J._trim();let ee=0;for(const re of j)for(let fe=0;fe<re.circleArray.length/4;fe++){const ge=4*fe,de=re.circleArray[ge+0],be=re.circleArray[ge+1],xe=re.circleArray[ge+2],Ie=re.circleArray[ge+3];J.emplace(ee++,de,be,xe,Ie,0),J.emplace(ee++,de,be,xe,Ie,1),J.emplace(ee++,de,be,xe,Ie,2),J.emplace(ee++,de,be,xe,Ie,3)}(!su||su.length<2*q)&&(su=function(re){const fe=2*re,ge=new p.StructArrayLayout3ui6;ge.resize(fe),ge._trim();for(let de=0;de<fe;de++){const be=6*de;ge.uint16[be+0]=4*de+0,ge.uint16[be+1]=4*de+1,ge.uint16[be+2]=4*de+2,ge.uint16[be+3]=4*de+2,ge.uint16[be+4]=4*de+3,ge.uint16[be+5]=4*de+0}return ge}(q));const U=I.createIndexBuffer(su,!0),Y=I.createVertexBuffer(J,p.collisionCircleLayout.members,!0);for(const re of j){const fe={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(ie=F).getCameraToCenterDistance(re.projection),u_viewport_size:[ie.width,ie.height]};Q.draw(I,k.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,fe,d.id,Y,U,p.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,F.zoom)}var ie;Y.destroy(),U.destroy()}const au=p.create();function cs({width:g,height:c,anchor:d,textOffset:v,textScale:b},E){const{horizontalAlign:M,verticalAlign:I}=p.getAnchorAlignment(d),k=-(M-.5)*g,F=-(I-.5)*c,L=p.evaluateVariableOffset(d,v);return new p.Point((k/b+L[0])*E,(F/b+L[1])*E)}function wt(g,c,d,v,b,E,M,I,k,F,L){const j=g.text.placedSymbolArray,q=g.text.dynamicLayoutVertexArray,K=g.icon.dynamicLayoutVertexArray,Q={},J=g.getProjection(),ee=ii(I,J,E),U=E.elevation,Y=J.upVectorScale(I.canonical,E.center.lat,E.worldSize).metersToTile;q.clear();for(let ie=0;ie<j.length;ie++){const re=j.get(ie),{tileAnchorX:fe,tileAnchorY:ge,numGlyphs:de}=re,be=re.hidden||!re.crossTileID||g.allowVerticalPlacement&&!re.placedOrientation?null:v[re.crossTileID];if(be){let xe=0,Ie=0,Xe=0;if(U){const qe=U?U.getAtTileOffset(I,fe,ge):0,[_t,zt,mt]=J.upVector(I.canonical,fe,ge);xe=qe*_t*Y,Ie=qe*zt*Y,Xe=qe*mt*Y}let[Te,je,Pe,We]=sr(re.projectedAnchorX+xe,re.projectedAnchorY+Ie,re.projectedAnchorZ+Xe,d?ee:M);const Se=Fd(E.getCameraToCenterDistance(J),We);let Ne=b.evaluateSizeForFeature(g.textSizeData,F,re)*Se/p.ONE_EM;d&&(Ne*=g.tilePixelRatio/k);const Ye=cs(be,Ne);d?(({x:Te,y:je,z:Pe}=J.projectTilePoint(fe+Ye.x,ge+Ye.y,I.canonical)),[Te,je,Pe]=sr(Te+xe,je+Ie,Pe+Xe,M)):(c&&Ye._rotate(-E.angle),Te+=Ye.x,je+=Ye.y,Pe=0);const $e=g.allowVerticalPlacement&&re.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let qe=0;qe<de;qe++)p.addDynamicAttributes(q,Te,je,Pe,$e);L&&re.associatedIconIndex>=0&&(Q[re.associatedIconIndex]={x:Te,y:je,z:Pe,angle:$e})}else Tn(de,q)}if(L){K.clear();const ie=g.icon.placedSymbolArray;for(let re=0;re<ie.length;re++){const fe=ie.get(re),{numGlyphs:ge}=fe,de=Q[re];if(fe.hidden||!de)Tn(ge,K);else{const{x:be,y:xe,z:Ie,angle:Xe}=de;for(let Te=0;Te<ge;Te++)p.addDynamicAttributes(K,be,xe,Ie,Xe)}}g.icon.dynamicLayoutVertexBuffer.updateData(K)}g.text.dynamicLayoutVertexBuffer.updateData(q)}function un(g,c,d){return d.iconsInText&&c?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function bi(g,c,d,v,b,E,M,I,k,F,L,j){const q=g.context,K=q.gl,Q=g.transform,J="map"===I,ee="map"===k,U=J&&"point"!==d.layout.get("symbol-placement"),Y=J&&!ee&&!U,ie=void 0!==d.layout.get("symbol-sort-key").constantOr(1);let re=!1;const fe=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),ge=[p.mercatorXfromLng(Q.center.lng),p.mercatorYfromLat(Q.center.lat)],de=d.layout.get("text-variable-anchor"),be="globe"===Q.projection.name,xe=[],Ie=[0,-1,0];let Xe=Ie;!be&&!Q.mercatorFromTransition||J||(Xe=function(Te){const je=Te._camera.getWorldToCamera(Te.worldSize,1),Pe=p.multiply([],je,Te.globeMatrix);p.invert(Pe,Pe);const We=[0,0,0],Se=[0,1,0,0];return p.transformMat4$1(Se,Se,Pe),We[0]=Se[0],We[1]=Se[1],We[2]=Se[2],p.normalize(We,We),We}(Q));for(const Te of v){const je=c.getTile(Te),Pe=je.getBucket(d);if(!Pe||"mercator"===Pe.projection.name&&be)continue;const We=b?Pe.text:Pe.icon;if(!We||Pe.fullyClipped||!We.segments.get().length)continue;const Se=We.programConfigurations.get(d.id),Ne=b||Pe.sdfIcons,Ye=b?Pe.textSizeData:Pe.iconSizeData,$e=ee||0!==Q.pitch,qe=p.evaluateSizeForZoom(Ye,Q.zoom);let _t,zt,mt,Tt,dn=[0,0],sn=null;if(b)zt=je.glyphAtlasTexture,mt=K.LINEAR,_t=je.glyphAtlasTexture.size,Pe.iconsInText&&(dn=je.imageAtlasTexture.size,sn=je.imageAtlasTexture,Tt=$e||g.options.rotating||g.options.zooming||"composite"===Ye.kind||"camera"===Ye.kind?K.LINEAR:K.NEAREST);else{const la=1!==d.layout.get("icon-size").constantOr(0)||Pe.iconsNeedLinear;zt=je.imageAtlasTexture,mt=Ne||g.options.rotating||g.options.zooming||la||$e?K.LINEAR:K.NEAREST,_t=je.imageAtlasTexture.size}const vt="globe"===Pe.projection.name,On=vt?Xe:Ie,Jn=vt?p.globeToMercatorTransition(Q.zoom):0,Ln=ii(Te,Pe.getProjection(),Q),Vn=Q.calculatePixelsToTileUnitsMatrix(je),yr=ze(Ln,je.tileID.canonical,ee,J,Q,Pe.getProjection(),Vn),Si=g.terrain&&ee&&U?p.invert(p.create(),yr):au,Do=Oi(Ln,je.tileID.canonical,ee,J,Q,Pe.getProjection(),Vn),hs=de&&Pe.hasTextData(),Qn="none"!==d.layout.get("icon-text-fit")&&hs&&Pe.hasIconData();if(U){const la=Q.elevation,ds=la?la.getAtTileOffsetFunc(Te,Q.center.lat,Q.worldSize,Pe.getProjection()):null,ca=Qs(Ln,je.tileID.canonical,ee,J,Q,Pe.getProjection(),Vn);zd(Pe,Ln,g,b,ca,Do,ee,F,ds,Te)}const Gn=U||b&&de||Qn,bn=g.translatePosMatrix(Ln,je,E,M),wi=Gn?au:yr,cr=g.translatePosMatrix(Do,je,E,M,!0),ci=Pe.getProjection().createInversionMatrix(Q,Te.canonical),Zr=[];g.terrainRenderModeElevated()&&ee&&Zr.push("PITCH_WITH_MAP_TERRAIN"),vt&&Zr.push("PROJECTION_GLOBE_VIEW"),Gn&&Zr.push("PROJECTED_POS_ON_VIEWPORT");const mu=Ne&&0!==d.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let kl;kl=Ne?Pe.iconsInText?pr(Ye.kind,qe,Y,ee,g,bn,wi,cr,_t,dn,Te,Jn,ge,ci,On,Pe.getProjection()):In(Ye.kind,qe,Y,ee,g,bn,wi,cr,b,_t,!0,Te,Jn,ge,ci,On,Pe.getProjection()):Mr(Ye.kind,qe,Y,ee,g,bn,wi,cr,b,_t,Te,Jn,ge,ci,On,Pe.getProjection());const fo={program:g.useProgram(un(Ne,b,Pe),Se,Zr),buffers:We,uniformValues:kl,atlasTexture:zt,atlasTextureIcon:sn,atlasInterpolation:mt,atlasInterpolationIcon:Tt,isSDF:Ne,hasHalo:mu,tile:je,labelPlaneMatrixInv:Si};if(ie&&Pe.canOverlap){re=!0;const la=We.segments.get();for(const ds of la)xe.push({segments:new p.SegmentVector([ds]),sortKey:ds.sortKey,state:fo})}else xe.push({segments:We.segments,sortKey:0,state:fo})}re&&xe.sort((Te,je)=>Te.sortKey-je.sortKey);for(const Te of xe){const je=Te.state;if(g.terrain&&g.terrain.setupElevationDraw(je.tile,je.program,{useDepthForOcclusion:!be,labelPlaneMatrixInv:je.labelPlaneMatrixInv}),q.activeTexture.set(K.TEXTURE0),je.atlasTexture.bind(je.atlasInterpolation,K.CLAMP_TO_EDGE),je.atlasTextureIcon&&(q.activeTexture.set(K.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),je.isSDF){const Pe=je.uniformValues;je.hasHalo&&(Pe.u_is_halo=1,Gr(je.buffers,Te.segments,d,g,je.program,fe,L,j,Pe)),Pe.u_is_halo=0}Gr(je.buffers,Te.segments,d,g,je.program,fe,L,j,je.uniformValues)}}function Gr(g,c,d,v,b,E,M,I,k){const F=v.context,L=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer];b.draw(F,F.gl.TRIANGLES,E,M,I,p.CullFaceMode.disabled,k,d.id,g.layoutVertexBuffer,g.indexBuffer,c,d.paint,v.transform.zoom,g.programConfigurations.get(d.id),L)}function La(g,c,d,v,b,E,M){const I=g.context.gl,k=d.paint.get("fill-pattern"),F=k&&k.constantOr(1);let L,j,q,K,Q;M?(j=F&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=I.LINES):(j=F?"fillPattern":"fill",L=I.TRIANGLES);for(const J of v){const ee=c.getTile(J);if(F&&!ee.patternsLoaded())continue;const U=ee.getBucket(d);if(!U)continue;g.prepareDrawTile();const Y=U.programConfigurations.get(d.id),ie=g.useProgram(j,Y);F&&(g.context.activeTexture.set(I.TEXTURE0),ee.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Y.updatePaintBuffers());const re=k.constantOr(null);if(re&&ee.imageAtlas){const ge=ee.imageAtlas.patternPositions[re.toString()];ge&&Y.setConstantPatternPositions(ge)}const fe=g.translatePosMatrix(J.projMatrix,ee,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(M){K=U.indexBuffer2,Q=U.segments2;const ge=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];q="fillOutlinePattern"===j&&F?Bn(fe,g,ee,ge):ra(fe,ge)}else K=U.indexBuffer,Q=U.segments,q=F?jo(fe,g,ee):Sr(fe);g.prepareDrawProgram(g.context,ie,J.toUnwrapped()),ie.draw(g.context,L,b,g.stencilModeForClipping(J),E,p.CullFaceMode.disabled,q,d.id,U.layoutVertexBuffer,K,Q,d.paint,g.transform.zoom,Y)}}function Ki(g,c,d,v,b,E,M){const I=g.context,k=I.gl,F=g.transform,L=d.paint.get("fill-extrusion-pattern"),j=L.constantOr(1),q=d.paint.get("fill-extrusion-opacity"),K=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),d.paint.get("fill-extrusion-ambient-occlusion-radius")],Q=d.layout.get("fill-extrusion-edge-radius"),J=Q>0&&!d.paint.get("fill-extrusion-rounded-roof"),ee=J?0:Q,U="globe"===F.projection.name?p.fillExtrusionHeightLift():0,Y="globe"===F.projection.name,ie=Y?p.globeToMercatorTransition(F.zoom):0,re=[p.mercatorXfromLng(F.center.lng),p.mercatorYfromLat(F.center.lat)],fe=[];Y&&fe.push("PROJECTION_GLOBE_VIEW"),K[0]>0&&fe.push("FAUX_AO"),J&&fe.push("ZERO_ROOF_RADIUS");for(const ge of v){const de=c.getTile(ge),be=de.getBucket(d);if(!be||be.projection.name!==F.projection.name)continue;const xe=be.programConfigurations.get(d.id),Ie=g.useProgram(j?"fillExtrusionPattern":"fillExtrusion",xe,fe);if(g.terrain){const Ne=g.terrain;if(g.style.terrainSetForDrapingOnly())Ne.setupElevationDraw(de,Ie,{useMeterToDem:!0});else{if(!be.enableTerrain)continue;if(Ne.setupElevationDraw(de,Ie,{useMeterToDem:!0}),bl(I,c,ge,be,d,Ne),!be.centroidVertexBuffer){const Ye=Ie.attributes.a_centroid_pos;void 0!==Ye&&k.vertexAttrib2f(Ye,0,0)}}}j&&(g.context.activeTexture.set(k.TEXTURE0),de.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),xe.updatePaintBuffers());const Xe=L.constantOr(null);if(Xe&&de.imageAtlas){const Ne=de.imageAtlas.patternPositions[Xe.toString()];Ne&&xe.setConstantPatternPositions(Ne)}const Te=g.translatePosMatrix(ge.projMatrix,de,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),je=F.projection.createInversionMatrix(F,ge.canonical),Pe=d.paint.get("fill-extrusion-vertical-gradient"),We=j?Ps(Te,g,Pe,q,K,ee,ge,de,U,ie,re,je):Ud(Te,g,Pe,q,K,ee,ge,U,ie,re,je);g.prepareDrawProgram(I,Ie,ge.toUnwrapped());const Se=[];g.terrain&&Se.push(be.centroidVertexBuffer),Y&&Se.push(be.layoutVertexExtBuffer),Ie.draw(I,I.gl.TRIANGLES,b,E,M,p.CullFaceMode.backCCW,We,d.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,d.paint,g.transform.zoom,xe,Se)}}function bl(g,c,d,v,b,E){const M=[U=>{let Y=U.canonical.x-1,ie=U.wrap;return Y<0&&(Y=(1<<U.canonical.z)-1,ie--),new p.OverscaledTileID(U.overscaledZ,ie,U.canonical.z,Y,U.canonical.y)},U=>{let Y=U.canonical.x+1,ie=U.wrap;return Y===1<<U.canonical.z&&(Y=0,ie++),new p.OverscaledTileID(U.overscaledZ,ie,U.canonical.z,Y,U.canonical.y)},U=>new p.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,(0===U.canonical.y?1<<U.canonical.z:U.canonical.y)-1),U=>new p.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y===(1<<U.canonical.z)-1?0:U.canonical.y+1)],I=U=>{const Y=c.getSource().minzoom,ie=fe=>{const ge=c.getTileByID(fe);if(ge&&ge.hasData())return ge.getBucket(b)},re=[0,-1,1];for(const fe of re){if(U.overscaledZ+fe<Y)continue;const ge=ie(U.calculateScaledKey(U.overscaledZ+fe));if(ge)return ge}},k=[0,0,0],F=(U,Y)=>(k[0]=Math.min(U.min.y,Y.min.y),k[1]=Math.max(U.max.y,Y.max.y),k[2]=p.EXTENT-Y.min.x>U.max.x?Y.min.x-p.EXTENT:U.max.x,k),L=(U,Y)=>(k[0]=Math.min(U.min.x,Y.min.x),k[1]=Math.max(U.max.x,Y.max.x),k[2]=p.EXTENT-Y.min.y>U.max.y?Y.min.y-p.EXTENT:U.max.y,k),j=[(U,Y)=>F(U,Y),(U,Y)=>F(Y,U),(U,Y)=>L(U,Y),(U,Y)=>L(Y,U)],q=new p.Point(0,0);let K,Q,J;const ee=(U,Y,ie,re,fe)=>{const ge=[[re?ie:U,re?U:ie,0],[re?ie:Y,re?Y:ie,0]],de=fe<0?p.EXTENT+fe:fe,be=[re?de:(U+Y)/2,re?(U+Y)/2:de,0];return 0===ie&&fe<0||0!==ie&&fe>0?E.getForTilePoints(J,[be],!0,Q):ge.push(be),E.getForTilePoints(d,ge,!0,K),Math.max(ge[0][2],ge[1][2],be[2])/E.exaggeration()};for(let U=0;U<4;U++){const Y=(U<2?1:5)-U,ie=v.borders[U];if(0===ie.length)continue;const re=J=M[U](d),fe=I(re);if(!(fe&&fe instanceof p.FillExtrusionBucket&&fe.enableTerrain)||v.borderDoneWithNeighborZ[U]===fe.canonical.z&&fe.borderDoneWithNeighborZ[Y]===v.canonical.z||(Q=E.findDEMTileFor(re),!Q||!Q.dem))continue;if(!K){const xe=E.findDEMTileFor(d);if(!xe||!xe.dem)return;K=xe}const ge=fe.borders[Y];let de=0;const be=fe.borderDoneWithNeighborZ[Y]!==v.canonical.z;if(v.canonical.z===fe.canonical.z){for(let xe=0;xe<ie.length;xe++){const Ie=v.featuresOnBorder[ie[xe]],Xe=Ie.borders[U];let Te;for(;de<ge.length&&(Te=fe.featuresOnBorder[ge[de]],!(Te.borders[Y][1]>Xe[0]+3));)be&&fe.encodeCentroid(void 0,Te,!1),de++;if(Te&&de<ge.length){const je=de;let Pe=0;for(;!(Te.borders[Y][0]>Xe[1]-3)&&(Pe++,++de!==ge.length);)Te=fe.featuresOnBorder[ge[de]];if(Te=fe.featuresOnBorder[ge[je]],Ie.intersectsCount()>1||Te.intersectsCount()>1||1!==Pe){1!==Pe&&(de=je),v.encodeCentroid(void 0,Ie,!1),be&&fe.encodeCentroid(void 0,Te,!1);continue}const We=j[U](Ie,Te),Se=U%2?p.EXTENT-1:0;q.x=ee(We[0],Math.min(p.EXTENT-1,We[1]),Se,U<2,We[2]),q.y=0,v.encodeCentroid(q,Ie,!1),be&&fe.encodeCentroid(q,Te,!1)}else v.encodeCentroid(void 0,Ie,!1)}v.borderDoneWithNeighborZ[U]=fe.canonical.z,v.needsCentroidUpdate=!0,be&&(fe.borderDoneWithNeighborZ[Y]=v.canonical.z,fe.needsCentroidUpdate=!0)}else{for(const xe of ie)v.encodeCentroid(void 0,v.featuresOnBorder[xe],!1);if(be){for(const xe of ge)fe.encodeCentroid(void 0,fe.featuresOnBorder[xe],!1);fe.borderDoneWithNeighborZ[Y]=v.canonical.z,fe.needsCentroidUpdate=!0}v.borderDoneWithNeighborZ[U]=fe.canonical.z,v.needsCentroidUpdate=!0}}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&0!==v.centroidVertexArray.length)&&v.uploadCentroid(g)}const li=new p.Color(1,0,0,1),dh=new p.Color(0,1,0,1),fh=new p.Color(0,0,1,1),_n=new p.Color(1,0,1,1),Gd=new p.Color(0,1,1,1);function lu(g,c,d){const v=g.context,b=g.transform,E=v.gl,M="globe"===b.projection.name,I=M?["PROJECTION_GLOBE_VIEW"]:null;let k=d.projMatrix;if(M&&p.globeToMercatorTransition(b.zoom)>0){const Ie=p.transitionTileAABBinECEF(d.canonical,b),Xe=p.globeDenormalizeECEF(Ie);k=p.multiply(new Float32Array(16),b.globeMatrix,Xe),p.multiply(k,b.projMatrix,k)}const F=g.useProgram("debug",null,I),L=c.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(L,F);const j=p.DepthMode.disabled,q=p.StencilMode.disabled,K=g.colorModeForRenderPass(),Q="$debug";v.activeTexture.set(E.TEXTURE0),g.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),M?L._makeGlobeTileDebugBuffers(g.context,b):L._makeDebugTileBoundsBuffers(g.context,b.projection);const J=L._tileDebugBuffer||g.debugBuffer,ee=L._tileDebugIndexBuffer||g.debugIndexBuffer,U=L._tileDebugSegments||g.debugSegments;F.draw(v,E.LINE_STRIP,j,q,K,p.CullFaceMode.disabled,Uo(k,p.Color.red),Q,J,ee,U,null,null,null,[L._globeTileDebugBorderBuffer]);const Y=L.latestRawTileData,ie=Math.floor((Y&&Y.byteLength||0)/1024),re=c.getTile(d).tileSize,fe=512/Math.min(re,512)*(d.overscaledZ/b.zoom)*.5;let ge=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ge+=` => ${d.overscaledZ}`),ge+=` ${ie}kb`,function(Ie,Xe){Ie.initDebugOverlayCanvas();const Te=Ie.debugOverlayCanvas,je=Ie.context.gl,Pe=Ie.debugOverlayCanvas.getContext("2d");Pe.clearRect(0,0,Te.width,Te.height),Pe.shadowColor="white",Pe.shadowBlur=2,Pe.lineWidth=1.5,Pe.strokeStyle="white",Pe.textBaseline="top",Pe.font="bold 36px Open Sans, sans-serif",Pe.fillText(Xe,5,5),Pe.strokeText(Xe,5,5),Ie.debugOverlayTexture.update(Te),Ie.debugOverlayTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE)}(g,ge);const de=L._tileDebugTextBuffer||g.debugBuffer,be=L._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,xe=L._tileDebugTextSegments||g.debugSegments;F.draw(v,E.TRIANGLES,j,q,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,Uo(k,p.Color.transparent,fe),Q,de,be,xe,null,null,null,[L._globeTileDebugTextBuffer])}function Wd(g,c,d,v){Ni(g,0,c+d/2,g.transform.width,d,v)}function oa(g,c,d,v){Ni(g,c-d/2,0,d,g.transform.height,v)}function Ni(g,c,d,v,b,E){const M=g.context,I=M.gl;I.enable(I.SCISSOR_TEST),I.scissor(c*p.exported.devicePixelRatio,d*p.exported.devicePixelRatio,v*p.exported.devicePixelRatio,b*p.exported.devicePixelRatio),M.clear({color:E}),I.disable(I.SCISSOR_TEST)}const gc=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:wl}=gc;function lr(g,c,d,v){g.emplaceBack(c,d,v)}class Fa{constructor(c){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,lr(this.vertexArray,-1,-1,1),lr(this.vertexArray,1,-1,1),lr(this.vertexArray,-1,1,1),lr(this.vertexArray,1,1,1),lr(this.vertexArray,-1,-1,-1),lr(this.vertexArray,1,-1,-1),lr(this.vertexArray,-1,1,-1),lr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,wl),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function wo(g,c,d,v,b,E){const M=g.gl,I=c.paint.get("sky-atmosphere-color"),k=c.paint.get("sky-atmosphere-halo-color"),F=c.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:p.fromMat4(p.create$1(),v),u_sun_direction:b,u_sun_intensity:F,u_color_tint_r:[(Q=I).r,Q.g,Q.b,Q.a],u_color_tint_m:[(J=k).r,J.g,J.b,J.a],u_luminance:5e-5};var Q,J;M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+E,c.skyboxTexture,0),d.draw(g,M.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,L,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Kn=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class bg{constructor(c){const d=new p.StructArrayLayout5f20;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const v=new p.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(d,Kn.members),this.indexBuffer=c.createIndexBuffer(v),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const sa={symbol:function(g,c,d,v,b){if("translucent"!==g.renderPass)return;const E=p.StencilMode.disabled,M=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(I,k,F,L,j,q,K){const Q=k.transform,J="map"===j,ee="map"===q;for(const U of I){const Y=L.getTile(U),ie=Y.getBucket(F);if(!ie||!ie.text||!ie.text.segments.get().length)continue;const re=p.evaluateSizeForZoom(ie.textSizeData,Q.zoom),fe=ii(U,ie.getProjection(),Q),ge=Q.calculatePixelsToTileUnitsMatrix(Y),de=ze(fe,Y.tileID.canonical,ee,J,Q,ie.getProjection(),ge),be="none"!==F.layout.get("icon-text-fit")&&ie.hasIconData();if(re){const xe=Math.pow(2,Q.zoom-Y.tileID.overscaledZ);wt(ie,J,ee,K,p.symbolSize,Q,de,U,xe,re,be)}}}(v,g,d,c,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b),0!==d.paint.get("icon-opacity").constantOr(1)&&bi(g,c,d,v,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),E,M),0!==d.paint.get("text-opacity").constantOr(1)&&bi(g,c,d,v,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),E,M),c.map.showCollisionBoxes&&(mc(g,c,d,v,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),mc(g,c,d,v,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,c,d,v){if("translucent"!==g.renderPass)return;const b=d.paint.get("circle-opacity"),E=d.paint.get("circle-stroke-width"),M=d.paint.get("circle-stroke-opacity"),I=void 0!==d.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===E.constantOr(1)||0===M.constantOr(1)))return;const k=g.context,F=k.gl,L=g.transform,j=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),q=p.StencilMode.disabled,K=g.colorModeForRenderPass(),Q="globe"===L.projection.name,J=[p.mercatorXfromLng(L.center.lng),p.mercatorYfromLat(L.center.lat)],ee=[];for(let Y=0;Y<v.length;Y++){const ie=v[Y],re=c.getTile(ie),fe=re.getBucket(d);if(!fe||fe.projection.name!==L.projection.name)continue;const ge=fe.programConfigurations.get(d.id),de=ru(d);Q&&de.push("PROJECTION_GLOBE_VIEW");const be=g.useProgram("circle",ge,de),xe=fe.layoutVertexBuffer,Ie=fe.globeExtVertexBuffer,Xe=fe.indexBuffer,Te=L.projection.createInversionMatrix(L,ie.canonical),je={programConfiguration:ge,program:be,layoutVertexBuffer:xe,globeExtVertexBuffer:Ie,indexBuffer:Xe,uniformValues:iu(g,ie,re,Te,J,d),tile:re};if(I){const Pe=fe.segments.get();for(const We of Pe)ee.push({segments:new p.SegmentVector([We]),sortKey:We.sortKey,state:je})}else ee.push({segments:fe.segments,sortKey:0,state:je})}I&&ee.sort((Y,ie)=>Y.sortKey-ie.sortKey);const U={useDepthForOcclusion:!Q};for(const Y of ee){const{programConfiguration:ie,program:re,layoutVertexBuffer:fe,globeExtVertexBuffer:ge,indexBuffer:de,uniformValues:be,tile:xe}=Y.state,Ie=Y.segments;g.terrain&&g.terrain.setupElevationDraw(xe,re,U),g.prepareDrawProgram(k,re,xe.tileID.toUnwrapped()),re.draw(k,F.TRIANGLES,j,q,K,p.CullFaceMode.disabled,be,d.id,fe,de,Ie,d.paint,L.zoom,ie,[ge])}},heatmap:function(g,c,d,v){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const b=g.context,E=b.gl,M=p.StencilMode.disabled,I=new p.ColorMode([E.ONE,E.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(K,Q,J,ee){const U=K.gl,Y=Q.width*ee,ie=Q.height*ee;K.activeTexture.set(U.TEXTURE1),K.viewport.set([0,0,Y,ie]);let re=J.heatmapFbo;if(!re||re&&(re.width!==Y||re.height!==ie)){re&&re.destroy();const fe=U.createTexture();U.bindTexture(U.TEXTURE_2D,fe),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),re=J.heatmapFbo=K.createFramebuffer(Y,ie,!1),function(ge,de,be,xe,Ie,Xe){const Te=ge.gl;Te.texImage2D(Te.TEXTURE_2D,0,ge.isWebGL2&&ge.extRenderToTextureHalfFloat?Te.RGBA16F:Te.RGBA,Ie,Xe,0,Te.RGBA,ge.extRenderToTextureHalfFloat?ge.isWebGL2?Te.HALF_FLOAT:ge.extTextureHalfFloat.HALF_FLOAT_OES:Te.UNSIGNED_BYTE,null),xe.colorAttachment.set(be)}(K,0,fe,re,Y,ie)}else U.bindTexture(U.TEXTURE_2D,re.colorAttachment.get()),K.bindFramebuffer.set(re.framebuffer)})(b,g,d,"globe"===g.transform.projection.name?.5:.25),b.clear({color:p.Color.transparent});const k=g.transform,F="globe"===k.projection.name,L=F?["PROJECTION_GLOBE_VIEW"]:null,j=F?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,q=[p.mercatorXfromLng(k.center.lng),p.mercatorYfromLat(k.center.lat)];for(let K=0;K<v.length;K++){const Q=v[K];if(c.hasRenderableParent(Q))continue;const J=c.getTile(Q),ee=J.getBucket(d);if(!ee||ee.projection.name!==k.projection.name)continue;const U=ee.programConfigurations.get(d.id),Y=g.useProgram("heatmap",U,L),{zoom:ie}=g.transform;g.terrain&&g.terrain.setupElevationDraw(J,Y),g.prepareDrawProgram(b,Y,Q.toUnwrapped());const re=k.projection.createInversionMatrix(k,Q.canonical);Y.draw(b,E.TRIANGLES,p.DepthMode.disabled,M,I,j,Ap(g,Q,J,re,q,ie,d.paint.get("heatmap-intensity")),d.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,d.paint,g.transform.zoom,U,F?[ee.globeExtVertexBuffer]:null)}b.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(b,E){const M=b.context,I=M.gl,k=E.heatmapFbo;if(!k)return;M.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,k.colorAttachment.get()),M.activeTexture.set(I.TEXTURE1);let F=E.colorRampTexture;F||(F=E.colorRampTexture=new p.Texture(M,E.colorRamp,I.RGBA)),F.bind(I.LINEAR,I.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(M,I.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,b.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:E.paint.get("heatmap-opacity")},E.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,E.paint,b.transform.zoom)}(g,d))},line:function(g,c,d,v){if("translucent"!==g.renderPass)return;const b=d.paint.get("line-opacity"),E=d.paint.get("line-width");if(0===b.constantOr(1)||0===E.constantOr(1))return;const M=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),I=g.colorModeForRenderPass(),k=g.terrain&&g.terrain.renderingToTexture?1:p.exported.devicePixelRatio,F=d.paint.get("line-dasharray"),L=F.constantOr(1),j=d.layout.get("line-cap"),q=d.paint.get("line-pattern"),K=q.constantOr(1),Q=d.paint.get("line-gradient"),J=K?"linePattern":"line",ee=g.context,U=ee.gl,Y=(re=>{const fe=[];ar(re)&&fe.push("RENDER_LINE_DASH"),re.paint.get("line-gradient")&&fe.push("RENDER_LINE_GRADIENT");const ge=re.paint.get("line-trim-offset");0===ge[0]&&0===ge[1]||fe.push("RENDER_LINE_TRIM_OFFSET");const de=re.paint.get("line-pattern").constantOr(1),be=1!==re.paint.get("line-opacity").constantOr(1);return!de&&be&&fe.push("RENDER_LINE_ALPHA_DISCARD"),fe})(d);let ie=Y.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(ie=!1);for(const re of v){const fe=c.getTile(re);if(K&&!fe.patternsLoaded())continue;const ge=fe.getBucket(d);if(!ge)continue;g.prepareDrawTile();const de=ge.programConfigurations.get(d.id),be=g.useProgram(J,de,Y),xe=q.constantOr(null);if(xe&&fe.imageAtlas){const Ne=fe.imageAtlas.patternPositions[xe.toString()];Ne&&de.setConstantPatternPositions(Ne)}const Ie=F.constantOr(null),Xe=j.constantOr(null);if(!K&&Ie&&Xe&&fe.lineAtlas){const Ne=fe.lineAtlas.getDash(Ie,Xe);Ne&&de.setConstantPatternPositions(Ne)}let[Te,je]=d.paint.get("line-trim-offset");("round"===Xe||"square"===Xe)&&Te!==je&&(0===Te&&(Te-=1),1===je&&(je+=1));const Pe=g.terrain?re.projMatrix:null,We=K?ou(g,fe,d,Pe,k):ks(g,fe,d,Pe,ge.lineClipsArray.length,k,[Te,je]);if(Q){const Ne=ge.gradients[d.id];let Ye=Ne.texture;if(d.gradientVersion!==Ne.version){let $e=256;if(d.stepInterpolant){const qe=c.getSource().maxzoom,_t=re.canonical.z===qe?Math.ceil(1<<g.transform.maxZoom-re.canonical.z):1;$e=p.clamp(p.nextPowerOfTwo(ge.maxLineLength/p.EXTENT*1024*_t),256,ee.maxTextureSize)}Ne.gradient=p.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:$e,image:Ne.gradient||void 0,clips:ge.lineClipsArray}),Ne.texture?Ne.texture.update(Ne.gradient):Ne.texture=new p.Texture(ee,Ne.gradient,U.RGBA),Ne.version=d.gradientVersion,Ye=Ne.texture}ee.activeTexture.set(U.TEXTURE1),Ye.bind(d.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}L&&(ee.activeTexture.set(U.TEXTURE0),fe.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),de.updatePaintBuffers()),K&&(ee.activeTexture.set(U.TEXTURE0),fe.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),de.updatePaintBuffers()),g.prepareDrawProgram(ee,be,re.toUnwrapped());const Se=Ne=>{be.draw(ee,U.TRIANGLES,M,Ne,I,p.CullFaceMode.disabled,We,d.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,d.paint,g.transform.zoom,de,[ge.layoutVertexBuffer2])};if(ie){const Ne=g.stencilModeForClipping(re).ref;0===Ne&&g.terrain&&ee.clear({stencil:0});const Ye={func:U.EQUAL,mask:255};We.u_alpha_discard_threshold=.8,Se(new p.StencilMode(Ye,Ne,255,U.KEEP,U.KEEP,U.INVERT)),We.u_alpha_discard_threshold=0,Se(new p.StencilMode(Ye,Ne,255,U.KEEP,U.KEEP,U.KEEP))}else Se(g.stencilModeForClipping(re))}ie&&(g.resetStencilClippingMasks(),g.terrain&&ee.clear({stencil:0}))},fill:function(g,c,d,v){const b=d.paint.get("fill-color"),E=d.paint.get("fill-opacity");if(0===E.constantOr(1))return;const M=g.colorModeForRenderPass(),I=d.paint.get("fill-pattern"),k=g.opaquePassEnabledForLayer()&&!I.constantOr(1)&&1===b.constantOr(p.Color.transparent).a&&1===E.constantOr(0)?"opaque":"translucent";if(g.renderPass===k){const F=g.depthModeForSublayer(1,"opaque"===g.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);La(g,c,d,v,F,M,!1)}if("translucent"===g.renderPass&&d.paint.get("fill-antialias")){const F=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);La(g,c,d,v,F,M,!0)}},"fill-extrusion":function(g,c,d,v){const b=d.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===g.renderPass){const E=new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==b||d.paint.get("fill-extrusion-pattern").constantOr(1))Ki(g,c,d,v,E,p.StencilMode.disabled,p.ColorMode.disabled),Ki(g,c,d,v,E,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const M=g.colorModeForRenderPass();Ki(g,c,d,v,E,p.StencilMode.disabled,M)}}},hillshade:function(g,c,d,v){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const b=g.context,E=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),M=g.colorModeForRenderPass(),I=g.terrain&&g.terrain.renderingToTexture,[k,F]="translucent"!==g.renderPass||I?[{},v]:g.stencilConfigForOverlap(v);for(const L of F){const j=c.getTile(L);if(j.needsHillshadePrepare&&"offscreen"===g.renderPass)uc(g,j,d,E,p.StencilMode.disabled,M);else if("translucent"===g.renderPass){const q=I&&g.terrain?g.terrain.stencilModeForRTTOverlap(L):k[L.overscaledZ];xg(g,L,j,d,E,q,M)}}b.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,c,d,v,b,E){if("translucent"!==g.renderPass||0===d.paint.get("raster-opacity")||!v.length)return;const M=g.context,I=M.gl,k=c.getSource(),F=g.useProgram("raster"),L=g.colorModeForRenderPass(),j=g.terrain&&g.terrain.renderingToTexture,[q,K]=k instanceof en||j?[{},v]:g.stencilConfigForOverlap(v),Q=K[K.length-1].overscaledZ,J=!g.options.moving;for(const ee of K){const U=j?p.DepthMode.disabled:g.depthModeForSublayer(ee.overscaledZ-Q,1===d.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,I.LESS),Y=ee.toUnwrapped(),ie=c.getTile(ee);if(j&&(!ie||!ie.hasData()))continue;const re=j?ee.projMatrix:g.transform.calculateProjMatrix(Y,J),fe=g.terrain&&j?g.terrain.stencilModeForRTTOverlap(ee):q[ee.overscaledZ],ge=E?0:d.paint.get("raster-fade-duration");ie.registerFadeDuration(ge);const de=c.findLoadedParent(ee,0),be=Dt(ie,de,c,g.transform,ge);let xe,Ie;g.terrain&&g.terrain.prepareDrawTile();const Xe="nearest"===d.paint.get("raster-resampling")?I.NEAREST:I.LINEAR;M.activeTexture.set(I.TEXTURE0),ie.texture.bind(Xe,I.CLAMP_TO_EDGE),M.activeTexture.set(I.TEXTURE1),de?(de.texture.bind(Xe,I.CLAMP_TO_EDGE),xe=Math.pow(2,de.tileID.overscaledZ-ie.tileID.overscaledZ),Ie=[ie.tileID.canonical.x*xe%1,ie.tileID.canonical.y*xe%1]):ie.texture.bind(Xe,I.CLAMP_TO_EDGE),ie.texture.useMipmap&&M.extTextureFilterAnisotropic&&g.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const Te=Hd(re,Ie||[0,0],xe||1,be,d,k instanceof en?k.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(M,F,Y),k instanceof en)k.boundsBuffer&&k.boundsSegments&&F.draw(M,I.TRIANGLES,U,p.StencilMode.disabled,L,p.CullFaceMode.disabled,Te,d.id,k.boundsBuffer,g.quadTriangleIndexBuffer,k.boundsSegments);else{const{tileBoundsBuffer:je,tileBoundsIndexBuffer:Pe,tileBoundsSegments:We}=g.getTileBoundsBuffers(ie);F.draw(M,I.TRIANGLES,U,fe,L,p.CullFaceMode.disabled,Te,d.id,je,Pe,We)}}g.resetStencilClippingMasks()},background:function(g,c,d,v){const b=d.paint.get("background-color"),E=d.paint.get("background-opacity");if(0===E)return;const M=g.context,I=M.gl,k=g.transform,F=k.tileSize,L=d.paint.get("background-pattern");if(g.isPatternMissing(L))return;const j=!L&&1===b.a&&1===E&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==j)return;const q=p.StencilMode.disabled,K=g.depthModeForSublayer(0,"opaque"===j?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),Q=g.colorModeForRenderPass(),J=g.useProgram(L?"backgroundPattern":"background");let ee,U=v;U||(ee=g.getBackgroundTiles(),U=Object.values(ee).map(Y=>Y.tileID)),L&&(M.activeTexture.set(I.TEXTURE0),g.imageManager.bind(g.context));for(const Y of U){const ie=Y.toUnwrapped(),re=v?Y.projMatrix:g.transform.calculateProjMatrix(ie);g.prepareDrawTile();const fe=c?c.getTile(Y):ee?ee[Y.key]:new p.Tile(Y,F,k.zoom,g),ge=L?pc(re,E,g,L,{tileID:Y,tileSize:F}):Ir(re,E,b);g.prepareDrawProgram(M,J,ie);const{tileBoundsBuffer:de,tileBoundsIndexBuffer:be,tileBoundsSegments:xe}=g.getTileBoundsBuffers(fe);J.draw(M,I.TRIANGLES,K,q,Q,p.CullFaceMode.disabled,ge,d.id,de,be,xe)}},sky:function(g,c,d){const v=g.transform,b="mercator"===v.projection.name||"globe"===v.projection.name?1:p.smoothstep(7,8,v.zoom),E=d.paint.get("sky-opacity")*b;if(0===E)return;const M=g.context,I=d.paint.get("sky-type"),k=new p.DepthMode(M.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),F=g.frameCounter/1e3%1;"atmosphere"===I?"offscreen"===g.renderPass?d.needsSkyboxCapture(g)&&(function(L,j,q,K){const Q=L.context,J=Q.gl;let ee=j.skyboxFbo;if(!ee){ee=j.skyboxFbo=Q.createFramebuffer(32,32,!1),j.skyboxGeometry=new Fa(Q),j.skyboxTexture=Q.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,j.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let re=0;re<6;++re)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(ee.framebuffer),Q.viewport.set([0,0,32,32]);const U=j.getCenter(L,!0),Y=L.useProgram("skyboxCapture"),ie=new Float64Array(16);p.identity(ie),p.rotateY(ie,ie,.5*-Math.PI),wo(Q,j,Y,ie,U,0),p.identity(ie),p.rotateY(ie,ie,.5*Math.PI),wo(Q,j,Y,ie,U,1),p.identity(ie),p.rotateX(ie,ie,.5*-Math.PI),wo(Q,j,Y,ie,U,2),p.identity(ie),p.rotateX(ie,ie,.5*Math.PI),wo(Q,j,Y,ie,U,3),p.identity(ie),wo(Q,j,Y,ie,U,4),p.identity(ie),p.rotateY(ie,ie,Math.PI),wo(Q,j,Y,ie,U,5),Q.viewport.set([0,0,L.width,L.height])}(g,d),d.markSkyboxValid(g)):"sky"===g.renderPass&&function(L,j,q,K,Q){const J=L.context,ee=J.gl,U=L.transform,Y=L.useProgram("skybox");J.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_CUBE_MAP,j.skyboxTexture);const ie={u_matrix:U.skyboxMatrix,u_sun_direction:j.getCenter(L,!1),u_cubemap:0,u_opacity:K,u_temporal_offset:Q};L.prepareDrawProgram(J,Y),Y.draw(J,ee.TRIANGLES,q,p.StencilMode.disabled,L.colorModeForRenderPass(),p.CullFaceMode.backCW,ie,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(g,d,k,E,F):"gradient"===I&&"sky"===g.renderPass&&function(L,j,q,K,Q){const J=L.context,ee=J.gl,U=L.transform,Y=L.useProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new Fa(J)),J.activeTexture.set(ee.TEXTURE0);let ie=j.colorRampTexture;ie||(ie=j.colorRampTexture=new p.Texture(J,j.colorRamp,ee.RGBA)),ie.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const re=(fe=U.skyboxMatrix,ge=j.getCenter(L,!1),de=j.paint.get("sky-gradient-radius"),be=K,xe=Q,{u_matrix:fe,u_color_ramp:0,u_center_direction:ge,u_radius:p.degToRad(de),u_opacity:be,u_temporal_offset:xe});var fe,ge,de,be,xe;L.prepareDrawProgram(J,Y),Y.draw(J,ee.TRIANGLES,q,p.StencilMode.disabled,L.colorModeForRenderPass(),p.CullFaceMode.backCW,re,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(g,d,k,E,F)},debug:function(g,c,d){for(let v=0;v<d.length;v++)lu(g,c,d[v])},custom:function(g,c,d,v){const b=g.context,E=d.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||"offscreen"===g.renderPass)&&d.isLayerDraped()){if("offscreen"===g.renderPass){const M=E.prerender;if(M){if(g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),"globe"===g.transform.projection.name){const I=g.transform.pointMerc;M.call(E,b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[I.x,I.y],g.transform.pixelsPerMeterRatio)}else M.call(E,b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState()}}else if("translucent"===g.renderPass){if(g.terrain&&g.terrain.renderingToTexture){const I=E.renderToTile;if(I){const k=v[0].canonical,F=new p.MercatorCoordinate(k.x+v[0].wrap*(1<<k.z),k.y,k.z);b.setDepthMode(p.DepthMode.disabled),b.setStencilMode(p.StencilMode.disabled),b.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),I.call(E,b.gl,F),b.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),b.setStencilMode(p.StencilMode.disabled);const M="3d"===E.renderingMode?new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(b.setDepthMode(M),"globe"===g.transform.projection.name){const I=g.transform.pointMerc;E.render(b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[I.x,I.y],g.transform.pixelsPerMeterRatio)}else E.render(b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState(),b.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Cl{constructor(c,d,v=!1){this.context=new tt(c,v),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,d){const v=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new tu(this,c));const b=this._terrain;this.transform.elevation=v?b:null,b.update(c,this.transform,d)}_updateFog(c){const d=c.fog;if(!d||"globe"===this.transform.projection.name||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,b]=d.getFovAdjustedRange(this.transform._fov);if(v>b)return void(this.transform.fogCullDistSq=null);const E=v+.78*(b-v);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,d){if(this.width=c*p.exported.devicePixelRatio,this.height=d*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const c=this.context,d=new p.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(p.EXTENT,0),d.emplaceBack(0,p.EXTENT),d.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(d,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const v=new p.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(p.EXTENT,0),v.emplaceBack(0,p.EXTENT),v.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=c.createVertexBuffer(v,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const b=new p.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(b,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const E=new p.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(p.EXTENT,0,p.EXTENT,0),E.emplaceBack(0,p.EXTENT,0,p.EXTENT),E.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(E,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const M=new p.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(M);const I=new p.StructArrayLayout1ui2;for(const F of[0,1,3,2,0])I.emplaceBack(F);this.debugIndexBuffer=c.createIndexBuffer(I),this.emptyTexture=new p.Texture(c,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=p.create();const k=this.context.gl;this.stencilClearMode=new p.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new bg(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,d=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,d.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,eu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,d,v){if(!d||this.currentStencilSource===d.id||!c.isTileClipped()||!v||0===v.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const k of v)if(void 0===this._tileClippingMaskIDs[k.key]){I=!0;break}if(!I)return}this.currentStencilSource=d.id;const b=this.context,E=b.gl;this.nextStencilID+v.length>256&&this.clearStencil(),b.setColorMode(p.ColorMode.disabled),b.setDepthMode(p.DepthMode.disabled);const M=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of v){const k=d.getTile(I),F=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:j,tileBoundsSegments:q}=this.getTileBoundsBuffers(k);M.draw(b,E.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:E.ALWAYS,mask:0},F,255,E.KEEP,E.KEEP,E.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,eu(I.projMatrix),"$clipping",L,j,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,d=this.context.gl;return new p.StencilMode({func:d.NOTEQUAL,mask:255},c,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const d=this.context.gl;return new p.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(c){const d=this.context.gl,v=c.sort((M,I)=>I.overscaledZ-M.overscaledZ),b=v[v.length-1].overscaledZ,E=v[0].overscaledZ-b+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const M={};for(let I=0;I<E;I++)M[I+b]=new p.StencilMode({func:d.GEQUAL,mask:255},I+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=E,[M,v]}return[{[b]:p.StencilMode.disabled},v]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([c.CONSTANT_COLOR,c.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(c,d,v){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new p.DepthMode(v||this.context.gl.LEQUAL,d,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,d){this.style=c,this.options=d,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const v=this.style.order,b=this.style._sourceCaches;for(const F in b){const L=b[F];L.used&&L.prepare(this.context)}const E={},M={},I={};for(const F in b){const L=b[F];E[F]=L.getVisibleCoordinates(),M[F]=E[F].slice().reverse(),I[F]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<v.length;F++)if(this.style._layers[v[F]].is3D()){this.opaquePassCutoff=F;break}if(this.terrain&&(this.terrain.updateTileBinding(I),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const F of v){const L=this.style._layers[F],j=c._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const q=j?M[j.id]:void 0;("custom"===L.type||L.isSky()||q&&q.length)&&this.renderLayer(this,j,L,q)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const k=this.terrain;if(k&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&k.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:d.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[v[this.currentLayer]],L=c._getLayerSourceCache(F);if(F.isSky())continue;const j=L?M[L.id]:void 0;this._renderTileClippingMasks(F,L,j),this.renderLayer(this,L,F,j)}if(this.style.fog&&this.transform.projection.supportsFog&&function(F,L){const j=F.context,q=j.gl,K=F.transform,Q=new p.DepthMode(q.LEQUAL,p.DepthMode.ReadOnly,[0,1]),J=F.useProgram("globeAtmosphere",null,"globe"===K.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ee=p.globeToMercatorTransition(K.zoom),U=L.properties.get("color").toArray01(),Y=L.properties.get("high-color").toArray01(),ie=L.properties.get("space-color").toArray01PremultipliedAlpha(),re=p.identity$1([]);p.rotateY$1(re,re,-p.degToRad(K._center.lng)),p.rotateX$1(re,re,p.degToRad(K._center.lat)),p.rotateZ$1(re,re,K.angle),p.rotateX$1(re,re,-K._pitch);const fe=p.fromQuat(new Float32Array(16),re),ge=p.mapValue(L.properties.get("star-intensity"),0,1,0,.25),be=p.mapValue(L.properties.get("horizon-blend"),0,1,5e-4,.25),xe=p.globeUseCustomAntiAliasing(F,j,K)&&5e-4===be?K.worldSize/(2*Math.PI*1.025)-1:K.globeRadius,Ie=F.frameCounter/1e3%1,Xe=p.length(K.globeCenterInViewSpace),Te=Math.sqrt(Math.pow(Xe,2)-Math.pow(xe,2)),je=Math.acos(Te/Xe),Pe={u_frustum_tl:K.frustumCorners.TL,u_frustum_tr:K.frustumCorners.TR,u_frustum_br:K.frustumCorners.BR,u_frustum_bl:K.frustumCorners.BL,u_horizon:K.frustumCorners.horizon,u_transition:ee,u_fadeout_range:be,u_color:U,u_high_color:Y,u_space_color:ie,u_star_intensity:ge,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ie,u_horizon_angle:je,u_rotation_matrix:fe};F.prepareDrawProgram(j,J);const We=F.atmosphereBuffer;We&&J.draw(j,q.TRIANGLES,Q,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,Pe,"skybox",We.vertexBuffer,We.indexBuffer,We.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const F=this.style._layers[v[this.currentLayer]],L=c._getLayerSourceCache(F);F.isSky()&&this.renderLayer(this,L,F,L?M[L.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const F=this.style._layers[v[this.currentLayer]],L=c._getLayerSourceCache(F);if(F.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(F)){if(F.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const j=L?("symbol"===F.type?I:M)[L.id]:void 0;this._renderTileClippingMasks(F,L,L?E[L.id]:void 0),this.renderLayer(this,L,F,j),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let F=null;p.values(this.style._layers).forEach(L=>{const j=c._getLayerSourceCache(L);j&&!L.isHidden(this.transform.zoom)&&(!F||F.getSource().maxzoom<j.getSource().maxzoom)&&(F=j)}),F&&this.options.showTileBoundaries&&sa.debug(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const L=F.transform.padding;Wd(F,F.transform.height-(L.top||0),3,li),Wd(F,L.bottom||0,3,dh),oa(F,L.left||0,3,fh),oa(F,F.transform.width-(L.right||0),3,_n);const j=F.transform.centerPoint;var q,K,Q,J;Ni(q=F,(K=j.x)-1,(Q=F.transform.height-j.y)-10,2,20,J=Gd),Ni(q,K-10,Q-1,20,2,J)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,d,v,b){v.isHidden(this.transform.zoom)||("background"===v.type||"sky"===v.type||"custom"===v.type||b&&b.length)&&(this.id=v.id,this.gpuTimingStart(v),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(v.type)||c.terrain&&"custom"===v.type)&&sa[v.type](c,d,v,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let v=this.gpuTimers[c.id];v||(v=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),v.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,d=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(d),c.beginQueryEXT(c.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const d={};for(const v in c){const b=c[v],E=this.context.extTimerQuery,M=E.getQueryObjectEXT(b.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(b.query),d[v]=M}return d}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery;let v=0;for(const b of c)v+=d.getQueryObjectEXT(b,d.QUERY_RESULT_EXT)/1e6,d.deleteQueryEXT(b);return v}translatePosMatrix(c,d,v,b,E){if(!v[0]&&!v[1])return c;const M=E?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(M){const F=Math.sin(M),L=Math.cos(M);v=[v[0]*L-v[1]*F,v[0]*F+v[1]*L]}const I=[E?v[0]:Xi(d,v[0],this.transform.zoom),E?v[1]:Xi(d,v[1],this.transform.zoom),0],k=new Float32Array(16);return p.translate(k,c,I),k}saveTileTexture(c){const d=this._tileTextures[c.size[0]];d?d.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const d=this._tileTextures[c];return d&&d.length>0?d.pop():null}isPatternMissing(c){return null===c||void 0!==c&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,d=this.terrain&&0===this.terrain.exaggeration(),v=this.style&&this.style.fog,b=[];return this.terrainRenderModeElevated()&&b.push("TERRAIN"),"globe"===this.transform.projection.name&&b.push("GLOBE"),d&&b.push("ZERO_EXAGGERATION"),v&&!c&&0!==v.getOpacity(this.transform.pitch)&&b.push("FOG"),c&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}useProgram(c,d,v){this.cache=this.cache||{};const b=v||[],E=this.currentGlobalDefines().concat(b),M=mn.cacheKey(co[c],c,E,d);return this.cache[M]||(this.cache[M]=new mn(this.context,c,co[c],d,Hr[c],E)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,d,v){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const E=b.getOpacity(this.transform.pitch),M=((I,k,F,L,j,q,K,Q,J,ee,U)=>{const Y=I.transform,ie=k.properties.get("color").toArray01();ie[3]=L;const re=I.frameCounter/1e3%1;return{u_fog_matrix:F?Y.calculateFogTileMatrix(F):I.identityMat,u_fog_range:k.getFovAdjustedRange(Y._fov),u_fog_color:ie,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_temporal_offset:re,u_frustum_tl:j,u_frustum_tr:q,u_frustum_br:K,u_frustum_bl:Q,u_globe_pos:J,u_globe_radius:ee,u_viewport:U,u_globe_transition:p.globeToMercatorTransition(Y.zoom),u_is_globe:+("globe"===Y.projection.name)}})(this,b,v,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);d.setFogUniformValues(c,M)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,d=c.createTexture();return c.bindTexture(c.TEXTURE_2D,d),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,d=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const b of v)d[b.key]=c[b.key]||new p.Tile(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class El{constructor(c=0,d=0,v=0,b=0){if(isNaN(c)||c<0||isNaN(d)||d<0||isNaN(v)||v<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=d,this.left=v,this.right=b}interpolate(c,d,v){return null!=d.top&&null!=c.top&&(this.top=p.number(c.top,d.top,v)),null!=d.bottom&&null!=c.bottom&&(this.bottom=p.number(c.bottom,d.bottom,v)),null!=d.left&&null!=c.left&&(this.left=p.number(c.left,d.left,v)),null!=d.right&&null!=c.right&&(this.right=p.number(c.right,d.right,v)),this}getCenter(c,d){const v=p.clamp((this.left+c-this.right)/2,0,c),b=p.clamp((this.top+d-this.bottom)/2,0,d);return new p.Point(v,b)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new El(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Dl(g,c){const d=p.getColumn(g,3);p.fromQuat(g,c),p.setColumn(g,3,d)}function gn(g,c){const d=p.identity$1([]);return p.rotateZ$1(d,d,-c),p.rotateX$1(d,d,-g),d}function Ji(g,c){const d=[g[0],g[1],0],v=[c[0],c[1],0];if(p.length(d)>=1e-15){const M=p.normalize([],d);p.scale$2(v,M,p.dot(v,M)),c[0]=v[0],c[1]=v[1]}const b=p.cross([],c,g);if(p.len(b)<1e-15)return null;const E=Math.atan2(-b[1],b[0]);return gn(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),E)}class wg{constructor(c,d){this.position=c,this.orientation=d}get position(){return this._position}set position(c){if(c){const d=c instanceof p.MercatorCoordinate?c:new p.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(d.x=p.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(c,d){if(this.orientation=null,!this.position)return;const v=this.position,b=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(c)):0,E=p.MercatorCoordinate.fromLngLat(c,b),M=[E.x-v.x,E.y-v.y,E.z-v.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Ji(M,d)}setPitchBearing(c,d){this.orientation=gn(p.degToRad(c),p.degToRad(-d))}}class Ar{constructor(c,d){this._transform=p.identity([]),this.orientation=d,this.position=c}get mercatorPosition(){const c=this.position;return new p.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=p.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var d;c&&p.setColumn(this._transform,3,[(d=c)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||p.identity$1([]),c&&Dl(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,d){this._orientation=gn(c,d),Dl(this._transform,this._orientation)}forward(){const c=p.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=p.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=p.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,d){const v=new Float64Array(16);return p.invert(v,this.getWorldToCamera(c,d)),v}getWorldToCameraPosition(c,d,v){const b=this.position;p.scale$2(b,b,-c);const E=new Float64Array(16);return p.fromScaling(E,[v,v,v]),p.translate(E,E,b),E[10]*=d,E}getWorldToCamera(c,d){const v=new Float64Array(16),b=new Float64Array(4),E=this.position;return p.conjugate(b,this._orientation),p.scale$2(E,E,-c),p.fromQuat(v,b),p.translate(v,v,E),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=d,v[9]*=d,v[10]*=d,v[11]*=d,v}getCameraToClipPerspective(c,d,v,b){const E=new Float64Array(16);return p.perspective(E,c,d,v,b),E}getDistanceToElevation(c,d=!1){const v=0===c?0:p.mercatorZfromAltitude(c,d?p.latFromMercatorY(this.position[1]):this.position[1]),b=this.forward();return(v-this.position[2])/b[2]}clone(){return new Ar([...this.position],[...this.orientation])}}function Pr(g,c){const d=za(g.projection,g.zoom,g.width,g.height),v=function(E,M,I,k,F){const L=new p.LngLat(I.lng-180*$o,I.lat),j=new p.LngLat(I.lng+180*$o,I.lat),q=E.project(L.lng,L.lat),K=E.project(j.lng,j.lat),Q=-Math.atan2(K.y-q.y,K.x-q.x),J=p.MercatorCoordinate.fromLngLat(I);J.y=p.clamp(J.y,-1+$o,1-$o);const ee=J.toLngLat(),U=E.project(ee.lng,ee.lat),Y=p.MercatorCoordinate.fromLngLat(ee);Y.x+=$o;const ie=Y.toLngLat(),re=E.project(ie.lng,ie.lat),fe=mh(re.x-U.x,re.y-U.y,Q),ge=p.MercatorCoordinate.fromLngLat(ee);ge.y+=$o;const de=ge.toLngLat(),be=E.project(de.lng,de.lat),xe=mh(be.x-U.x,be.y-U.y,Q),Ie=Math.abs(fe.x)/Math.abs(xe.y),Xe=p.identity([]);p.rotateZ(Xe,Xe,-Q*(1-(F?0:k)));const Te=p.identity([]);return p.scale(Te,Te,[1,1-(1-Ie)*k,1]),Te[4]=-xe.x/xe.y*k,p.rotateZ(Te,Te,Q),p.multiply(Te,Xe,Te),Te}(g.projection,0,g.center,d,c),b=ph(g);return p.scale(v,v,[b,b,1]),v}function ph(g){const c=g.projection,d=za(g.projection,g.zoom,g.width,g.height),v=Ho(c,g.center),b=Ho(c,p.LngLat.convert(c.center));return Math.pow(2,v*d+(1-d)*b)}function za(g,c,d,v,b=1/0){const E=g.range;if(!E)return 0;const M=Math.min(b,Math.max(d,v)),I=Math.log(M/1024)/Math.LN2;return p.smoothstep(E[0]+I,E[1]+I,c)}const $o=1/4e4;function Ho(g,c){const d=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),v=new p.LngLat(c.lng-180*$o,d),b=new p.LngLat(c.lng+180*$o,d),E=g.project(v.lng,d),M=g.project(b.lng,d),I=p.MercatorCoordinate.fromLngLat(v),k=p.MercatorCoordinate.fromLngLat(b),F=M.x-E.x,L=M.y-E.y,j=k.x-I.x,q=k.y-I.y,K=Math.sqrt((j*j+q*q)/(F*F+L*L));return Math.log(K)/Math.LN2}function mh(g,c,d){const v=Math.cos(d),b=Math.sin(d);return{x:g*v-c*b,y:g*b+c*v}}class cu{constructor(c,d,v,b,E,M,I){this.tileSize=512,this._renderWorldCopies=void 0===E||E,this._minZoom=c||0,this._maxZoom=d||22,this._minPitch=v??0,this._maxPitch=b??60,this.setProjection(M),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new El,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ar,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new cu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,d=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||v)&&this._updateCameraOnTerrain(),(c||v)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const v=!Ue(d,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const d=c!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const d=-c*Math.PI/180;var v,b,E,M,I,k,F,L,j,q;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(v=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),b=this.rotationMatrix,M=this.angle,I=(E=this.rotationMatrix)[0],k=E[1],F=E[2],L=E[3],j=Math.sin(M),q=Math.cos(M),b[0]=I*q+F*j,b[1]=k*q+L*j,b[2]=I*-j+F*q,b[3]=k*-j+L*q)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const d=p.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=p.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const d=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let b=0,E=0;for(let M=0;M<d.length;M++){const I=new p.Point(d[M][0]*this.width,v+d[M][1]*(this.height-v)),k=c.pointCoordinate(I);if(!k)continue;const F=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);b+=k[3]*F,E+=F}return 0===E?NaN:b/E}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(c),E=this._mercatorZfromZoom(this._maxZoom),M=Math.max(b-v,E);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let v;v=c.z<this._camera.position[2]?[d.x,d.y,d.z]:[c.x,c.y,c.z];const b=p.length(p.sub([],this._camera.position,v));return p.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let d=!1;if(c.orientation&&!p.exactEquals(c.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(c.orientation)),c.position){const v=[c.position.x,c.position.y,c.position.z];p.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,d=new wg;return d.position=new p.MercatorCoordinate(c[0],c[1],c[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(c){if(!p.length$1(c))return!1;p.normalize$1(c,c);const d=p.transformQuat([],[0,0,-1],c),v=p.transformQuat([],[0,-1,0],c);if(v[2]<0)return!1;const b=Ji(d,v);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(c){const d=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;c[2]=p.clamp(c[2],b/v,b/d),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,d,v){this._unmodified=!1,this._edgeInsets.interpolate(c,d,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const d=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(c){const d=[new p.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const v=this.pointCoordinate(new p.Point(0,0)),b=this.pointCoordinate(new p.Point(this.width,0)),E=this.pointCoordinate(new p.Point(this.width,this.height)),M=this.pointCoordinate(new p.Point(0,this.height)),I=Math.floor(Math.min(v.x,b.x,E.x,M.x)),k=Math.floor(Math.max(v.x,b.x,E.x,M.x)),F=1;for(let L=I-F;L<=k+F;L++)0!==L&&d.push(new p.UnwrappedTileID(L,c))}return d}coveringTiles(c){let d=this.coveringZoomLevel(c);const v=d,b=this.elevation&&!c.isTerrainDEM,E="mercator"===this.projection.name;if(void 0!==c.minzoom&&d<c.minzoom)return[];void 0!==c.maxzoom&&d>c.maxzoom&&(d=c.maxzoom);const M=this.locationCoordinate(this.center),I=this.center.lat,k=1<<d,F=[k*M.x,k*M.y,0],L="globe"===this.projection.name,j=!L,q=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,j),K=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=k*p.mercatorZfromAltitude(1,this.center.lat),J=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),ee=[k*K.x,k*K.y,J*(j?1:Q)],U=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),Y=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,ie=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,re=c.isTerrainDEM?-ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?ph(this):1,ge=Se=>{const Ye=new p.MercatorCoordinate(Se.x+25e-6,Se.y,Se.z),$e=new p.MercatorCoordinate(Se.x,Se.y+25e-6,Se.z),qe=Se.toLngLat(),_t=Ye.toLngLat(),zt=$e.toLngLat(),mt=this.locationCoordinate(qe),Tt=this.locationCoordinate(_t),dn=this.locationCoordinate(zt),sn=Math.hypot(Tt.x-mt.x,Tt.y-mt.y),vt=Math.hypot(dn.x-mt.x,dn.y-mt.y);return Math.sqrt(sn*vt)*fe/25e-6},de=Se=>{const Ne=ie,Ye=re;return{aabb:p.tileAABB(this,k,0,0,0,Se,Ye,Ne,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:Ne,wrap:Se,fullyVisible:!1}},be=[];let xe=[];const Ie=d,Xe=c.reparseOverscaled?v:d,Te=Se=>Se*Se,je=Te((J-this._centerAltitude)*Q),Pe=Se=>{if(!this._elevation||!Se.tileID||!E)return;const Ne=this._elevation.getMinMaxForTile(Se.tileID),Ye=Se.aabb;Ne?(Ye.min[2]=Ne.min,Ye.max[2]=Ne.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(Se.shouldSplit=We(Se),Se.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},We=Se=>{if(Se.zoom<Y)return!0;if(Se.zoom===Ie)return!1;if(null!=Se.shouldSplit)return Se.shouldSplit;const Ne=Se.aabb.distanceX(ee),Ye=Se.aabb.distanceY(ee);let $e=je,qe=1;if(L){$e=Te(Se.aabb.distanceZ(ee));const mt=Math.pow(2,Se.zoom),Tt=p.latFromMercatorY((Se.y+1)/mt),dn=p.latFromMercatorY(Se.y/mt),sn=Math.min(Math.max(I,Tt),dn),vt=p.circumferenceAtLatitude(sn)/p.circumferenceAtLatitude(I);if(qe=sn===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,vt/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&Se.zoom===Ie-1&&vt>=.9)return!0}else if(b&&($e=Te(Se.aabb.distanceZ(ee)*Q)),this.projection.isReprojectedInTileSpace&&v<=5){const mt=Math.pow(2,Se.zoom),Tt=ge(new p.MercatorCoordinate((Se.x+.5)/mt,(Se.y+.5)/mt));qe=Tt>.85?1:Tt}const _t=Ne*Ne+Ye*Ye+$e;return _t<Te((1<<Ie-Se.zoom)*U*qe*((mt,Tt)=>{if(Tt*Te(.707)<mt)return 1;const dn=Math.sqrt(Tt/mt);return dn/(1.4144271570014144+(Math.pow(1.1,dn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max($e,je),_t))};if(this.renderWorldCopies)for(let Se=1;Se<=3;Se++)be.push(de(-Se)),be.push(de(Se));for(be.push(de(0));be.length>0;){const Se=be.pop(),Ne=Se.x,Ye=Se.y;let $e=Se.fullyVisible;if(!$e){const qe=Se.aabb.intersects(q);if(0===qe)continue;$e=2===qe}if(Se.zoom!==Ie&&We(Se))for(let qe=0;qe<4;qe++){const _t=(Ne<<1)+qe%2,zt=(Ye<<1)+(qe>>1),mt={aabb:E?Se.aabb.quadrant(qe):p.tileAABB(this,k,Se.zoom+1,_t,zt,Se.wrap,Se.minZ,Se.maxZ,this.projection),zoom:Se.zoom+1,x:_t,y:zt,wrap:Se.wrap,fullyVisible:$e,tileID:void 0,shouldSplit:void 0,minZ:Se.minZ,maxZ:Se.maxZ};b&&!L&&(mt.tileID=new p.OverscaledTileID(Se.zoom+1===Ie?Xe:Se.zoom+1,Se.wrap,Se.zoom+1,_t,zt),Pe(mt)),be.push(mt)}else{const qe=Se.zoom===Ie?Xe:Se.zoom;if(c.minzoom&&c.minzoom>qe)continue;const _t=F[0]-(.5+Ne+(Se.wrap<<Se.zoom))*(1<<d-Se.zoom),zt=F[1]-.5-Ye,mt=Se.tileID?Se.tileID:new p.OverscaledTileID(qe,Se.wrap,Se.zoom,Ne,Ye);xe.push({tileID:mt,distanceSq:_t*_t+zt*zt})}}if(this.fogCullDistSq){const Se=this.fogCullDistSq,Ne=this.horizonLineFromTop();xe=xe.filter(Ye=>{const $e=[0,0,0,1],qe=[p.EXTENT,p.EXTENT,0,1],_t=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());p.transformMat4$1($e,$e,_t),p.transformMat4$1(qe,qe,_t);const zt=p.getAABBPointSquareDist($e,qe);if(0===zt)return!0;let mt=!1;const Tt=this._elevation;if(Tt&&zt>Se&&0!==Ne){const dn=this.calculateProjMatrix(Ye.tileID.toUnwrapped());let sn;c.isTerrainDEM||(sn=Tt.getMinMaxForTile(Ye.tileID)),sn||(sn={min:re,max:ie});const vt=p.furthestTileCorner(this.rotation),On=[vt[0]*p.EXTENT,vt[1]*p.EXTENT,sn.max];p.transformMat4(On,On,dn),mt=(1-On[1])*this.height*.5<Ne}return zt<Se||mt})}return xe.sort((Se,Ne)=>Se.distanceSq-Ne.distanceSq).map(Se=>Se.tileID)}resize(c,d){this.width=c,this.height=d,this.pixelsToGLUnits=[2/c,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const d=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),v=this.projection.project(c.lng,d);return new p.Point(v.x*this.worldSize,v.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,d){let v,b;const E=this.centerPoint;if("globe"===this.projection.name){const I=this.worldSize;v=(d.x-E.x)/I,b=(d.y-E.y)/I}else{const I=this.pointCoordinate(d),k=this.pointCoordinate(E);v=I.x-k.x,b=I.y-k.y}const M=this.locationCoordinate(c);this.setLocation(new p.MercatorCoordinate(M.x-v,M.y-b))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,d){const v=d?p.mercatorZfromAltitude(d,c.lat):void 0,b=this.projection.project(c.lng,c.lat);return new p.MercatorCoordinate(b.x,b.y,v)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,d){const v=d??this._centerAltitude,b=[c.x,c.y,0,1],E=[c.x,c.y,1,1];p.transformMat4$1(b,b,this.pixelMatrixInverse),p.transformMat4$1(E,E,this.pixelMatrixInverse);const M=E[3];p.scale$1(b,b,1/b[3]),p.scale$1(E,E,1/M);const I=b[2],k=E[2];return{p0:b,p1:E,t:I===k?0:(v-I)/(k-I)}}screenPointToMercatorRay(c){const d=[c.x,c.y,0,1],v=[c.x,c.y,1,1];return p.transformMat4$1(d,d,this.pixelMatrixInverse),p.transformMat4$1(v,v,this.pixelMatrixInverse),p.scale$1(d,d,1/d[3]),p.scale$1(v,v,1/v[3]),d[2]=p.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,v[2]=p.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,p.scale$1(d,d,1/this.worldSize),p.scale$1(v,v,1/this.worldSize),new p.Ray([d[0],d[1],d[2]],p.normalize([],p.sub([],v,d)))}rayIntersectionCoordinate(c){const{p0:d,p1:v,t:b}=c,E=p.mercatorZfromAltitude(d[2],this._center.lat),M=p.mercatorZfromAltitude(v[2],this._center.lat);return new p.MercatorCoordinate(p.number(d[0],v[0],b)/this.worldSize,p.number(d[1],v[1],b)/this.worldSize,p.number(E,M,b))}pointCoordinate(c,d=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,d)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let d=this.projection.pointCoordinate3D(this,c.x,c.y);if(d)return new p.MercatorCoordinate(d[0],d[1],d[2]);let v=0,b=this.horizonLineFromTop();if(c.y>b)return this.pointCoordinate(c);const E=.02*b,M=c.clone();for(let I=0;I<10&&b-v>E;I++){M.y=p.number(v,b,.66);const k=this.projection.pointCoordinate3D(this,M.x,M.y);k?(b=M.y,d=k):v=M.y}return d?new p.MercatorCoordinate(d[0],d[1],d[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(c);const d=this.pointCoordinate(c);return d.y>=0&&d.y<=1}_coordinatePoint(c,d){const v=d&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,b=[c.x*this.worldSize,c.y*this.worldSize,v+c.toAltitude(),1];return p.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new p.Point(b[0]/b[3],b[1]/b[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:d}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,E=this.pointLocation3D(new p.Point(d,c)),M=this.pointLocation3D(new p.Point(b,c)),I=this.pointLocation3D(new p.Point(b,v)),k=this.pointLocation3D(new p.Point(d,v));let F=Math.min(E.lng,M.lng,I.lng,k.lng),L=Math.max(E.lng,M.lng,I.lng,k.lng),j=Math.min(E.lat,M.lat,I.lat,k.lat),q=Math.max(E.lat,M.lat,I.lat,k.lat);const K=Math.pow(2,-this.zoom)/16*270,Q="globe"===this.projection.name?1:4,J=(ee,U,Y,ie,re)=>{const fe=(ee+Y)/2,ge=(U+ie)/2,de=new p.Point(fe,ge),{lng:be,lat:xe}=this.pointLocation3D(de),Ie=Math.max(0,F-be,j-xe,be-L,xe-q);F=Math.min(F,be),L=Math.max(L,be),j=Math.min(j,xe),q=Math.max(q,xe),(re<Q||Ie>K)&&(J(ee,U,fe,ge,re+1),J(fe,ge,Y,ie,re+1))};if(J(d,c,b,c,1),J(b,c,b,v,1),J(b,v,d,v,1),J(d,v,d,c,1),"globe"===this.projection.name){const[ee,U]=p.polesInViewport(this);ee?(q=90,L=180,F=-180):U&&(j=-90,L=180,F=-180)}return new p.LngLatBounds(new p.LngLat(F,j),new p.LngLat(L,q))}_getBoundsRectangular(c,d){const{top:v,left:b}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,I=new p.Point(b,v),k=new p.Point(M,v),F=new p.Point(M,E),L=new p.Point(b,E);let j=this.pointCoordinate(I,c),q=this.pointCoordinate(k,c);const K=this.pointCoordinate(F,d),Q=this.pointCoordinate(L,d),J=(ee,U)=>(U.y-ee.y)/(U.x-ee.x);return j.y>1&&q.y>=0?j=new p.MercatorCoordinate((1-Q.y)/J(Q,j)+Q.x,1):j.y<0&&q.y<=1&&(j=new p.MercatorCoordinate(-Q.y/J(Q,j)+Q.x,0)),q.y>1&&j.y>=0?q=new p.MercatorCoordinate((1-K.y)/J(K,q)+K.x,1):q.y<0&&j.y<=1&&(q=new p.MercatorCoordinate(-K.y/J(K,q)+K.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(K))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=c.visibleDemTiles.reduce((v,b)=>{if(b.dem){const E=b.dem.tree;v.min=Math.min(v.min,E.minimums[0]),v.max=Math.max(v.max,E.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*c.exaggeration(),d.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-d*(1-this._horizonShift);return c?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,d){return this.projection.createTileMatrix(this,d,c)}calculateDistanceTileData(c){const d=c.key,v=this._distanceTileDataCache;if(v[d])return v[d];const b=c.canonical,E=1/this.height,M=this.cameraWorldSize,I=M/this.zoomScale(b.z),k=(b.x+Math.pow(2,b.z)*c.wrap)*I,F=b.y*I,L=this.point;L.x*=M/this.worldSize,L.y*=M/this.worldSize;const j=this.angle,q=Math.sin(-j),K=-Math.cos(-j);return v[d]={bearing:[q,K],center:[(L.x-k)*E,(L.y-F)*E],scale:I/p.EXTENT*E},v[d]}calculateFogTileMatrix(c){const d=c.key,v=this._fogTileMatrixCache;if(v[d])return v[d];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return p.multiply(b,this.worldToFogMatrix,b),v[d]=new Float32Array(b),v[d]}calculateProjMatrix(c,d=!1){const v=c.key,b=d?this._alignedProjMatrixCache:this._projMatrixCache;if(b[v])return b[v];const E=this.calculatePosMatrix(c,this.worldSize);return p.multiply(E,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,E),b[v]=new Float32Array(E),b[v]}calculatePixelsToTileUnitsMatrix(c){const d=c.tileID.key,v=this._pixelsToTileUnitsCache;if(v[d])return v[d];const b=function(E,M){const{scale:I}=E.tileTransform,k=I*p.EXTENT/(E.tileSize*Math.pow(2,M.zoom-E.tileID.overscaledZ+E.tileID.canonical.z));return F=new Float32Array(4),q=(L=M.inverseAdjustmentMatrix)[1],K=L[2],Q=L[3],ee=(j=[k,k])[1],F[0]=L[0]*(J=j[0]),F[1]=q*J,F[2]=K*ee,F[3]=Q*ee,F;var F,L,j,q,K,Q,J,ee}(c,this);return v[d]=b,v[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,d=p.fromScaling([],[c,c,c]);return p.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const d=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(d),b=this._camera.forward(),E=p.mercatorZfromAltitude(1,this._center.lat);v[2]/=E,b[2]/=E,p.normalize(b,b);const M=c.raycast(v,b,c.exaggeration());if(M){const I=p.scaleAndAdd([],v,b,M),k=new p.MercatorCoordinate(I[0],I[1],p.mercatorZfromAltitude(I[2],p.latFromMercatorY(I[1]))),F=(k.z+p.length([k.x-v[0],k.y-v[1],k.z-v[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const d=this._elevation,v=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(v),E=d.getAtPointOrZero(new p.MercatorCoordinate(...b)),M=this.pixelsPerMeter/this.worldSize*E,I=this._minimumHeightOverTerrain(),k=b[2]-M;if(k<=I)if(k<0||c){const F=this.locationCoordinate(this._center,this._centerAltitude),L=[b[0],b[1],F.z-b[2]],j=p.length(L);L[2]-=(I-k)/this._pixelsPerMercatorPixel;const q=p.length(L);if(0===q)return;p.scale$2(L,L,j/q*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],F.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const q=this.center;return q.lat=p.clamp(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(q.lng=p.clamp(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const d=this._unmodified,{x:v,y:b}=this.point;let E=0,M=v,I=b;const k=this.width/2,F=this.height/2,L=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(b-F<L&&(I=L+F),b+F>j&&(I=j-F),j-L<this.height&&(E=Math.max(E,this.height/(j-L)),I=(j+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,Q=this.worldSize/2-(q+K)/2;M=(v+Q+this.worldSize)%this.worldSize-Q,M-k<q&&(M=q+k),M+k>K&&(M=K-k),K-q<this.width&&(E=Math.max(E,this.width/(K-q)),M=(K+q)/2)}M===v&&I===b||(this.center=this.unproject(new p.Point(M,I))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,d=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const v=za(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b="meters"===this.projection.zAxisUnit?d:1,E=this._camera.getWorldToCamera(this.worldSize,b),M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);M[8]=2*-c.x/this.width,M[9]=2*c.y/this.height;let I=p.mul([],M,E);if(this.projection.isReprojectedInTileSpace){const ge=this.locationCoordinate(this.center),de=p.identity([]);p.translate(de,de,[ge.x*this.worldSize,ge.y*this.worldSize,0]),p.multiply(de,de,Pr(this)),p.translate(de,de,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),p.multiply(I,I,de),this.inverseAdjustmentMatrix=function(be){const xe=Pr(be,!0);return st([],[xe[0],xe[1],xe[4],xe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],I,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=I,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const k=p.invert([],M);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height);const F=new Float32Array(16);p.identity(F),p.scale(F,F,[1,-1,1]),p.rotateX(F,F,this._pitch),p.rotateZ(F,F,this.angle);const L=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;L[8]=2*-c.x/this.width,L[9]=2*(c.y+j)/this.height,this.skyboxMatrix=p.multiply(F,L,F);const q=this.point,K=q.x,Q=q.y,J=this.width%2/2,ee=this.height%2/2,U=Math.cos(this.angle),Y=Math.sin(this.angle),ie=K-Math.round(K)+U*J+Y*ee,re=Q-Math.round(Q)+U*ee+Y*J,fe=new Float64Array(I);if(p.translate(fe,fe,[ie>.5?ie-1:ie,re>.5?re-1:re,0]),this.alignedProjMatrix=fe,I=p.create(),p.scale(I,I,[this.width/2,-this.height/2,1]),p.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=p.create(),p.scale(I,I,[1,-1,1]),p.translate(I,I,[-1,-1,0]),p.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=p.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(ge,ge,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,v=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,E=[c,c,d];p.scale$2(E,E,b),p.scale$2(v,v,-1),p.multiply$2(v,v,E);const M=p.create();p.translate(M,M,v),p.scale(M,M,E),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,d,b)}_computeCameraPosition(c){const d=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),b=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-c/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-v[0]*E,b.y/this.worldSize-v[1]*E,c/this.worldSize*this._centerAltitude-v[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],b=c[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(E=Math.min((d-v)/b,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,c,E),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,d=this._camera.forward(),{pitch:v,bearing:b}=this._camera.getPitchBearing(),E=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),I=Math.max((c[2]-E)/Math.cos(v),M),k=this._zoomFromMercatorZ(I);p.scaleAndAdd(c,c,d,I),this._pitch=p.clamp(v,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(b,-Math.PI,Math.PI),this._setZoom(p.clamp(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let d=0,v=p.GLOBE_ZOOM_THRESHOLD_MAX,b=0,E=1/0;for(;v-d>1e-6&&v>d;){const M=d+.5*(v-d),I=this.tileSize*Math.pow(2,M),k=this.getCameraToCenterDistance(this.projection,M,I),F=this.scaleZoom(k/(c*this.tileSize)),L=Math.abs(M-F);L<E&&(E=L,b=M),M<F?d=M:v=M}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,d){const v=Math.min(c.x,d.x),b=Math.max(c.x,d.x),E=Math.min(c.y,d.y),M=Math.max(c.y,d.y);if(E<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const I=[new p.Point(v,E),new p.Point(b,M),new p.Point(v,M),new p.Point(b,E)],k=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const L of I){const j=this.pointRayIntersection(L);if(j.t<0)return!0;const q=this.rayIntersectionCoordinate(j);if(q.x<k||q.y<0||q.x>F||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(c,d){const v=p.length(p.sub([],this._camera.position,c)),b=this._zoomFromMercatorZ(v)+d;return v-this._mercatorZfromZoom(b)}getCameraPoint(){if("globe"===this.projection.name){const c=function([d,v,b],E){const M=[d,v,b,1];p.transformMat4$1(M,M,E);const I=M[3]=Math.max(M[3],1e-6);return M[0]/=I,M[1]/=I,M[2]/=I,M}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,c))}}getCameraToCenterDistance(c,d=this.zoom,v=this.worldSize){const b=za(c,d,this.width,this.height,1024),E=c.pixelSpaceConversion(this.center.lat,v,b);return.5/Math.tan(.5*this._fov)*this.height*E}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(c,c,this.globeMatrix),c}}function _c(g,c){let d=!1,v=null;const b=()=>{v=null,d&&(g(),v=setTimeout(b,c),d=!1)};return()=>(d=!0,v||b(),v)}class qd{constructor(c){this._hashName=c&&encodeURIComponent(c),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=_c(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,p.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const d=gh(c);if(this._hashName){const v=this._hashName;let b=!1;const E=p.window.location.hash.slice(1).split("&").map(M=>{const I=M.split("=")[0];return I===v?(b=!0,`${I}=${d}`):M}).filter(M=>M);return b||E.push(`${v}=${d}`),`#${E.join("&")}`}return`#${d}`}_getCurrentHash(){const c=p.window.location.hash.replace("#","");if(this._hashName){let d;return c.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(d=v)}),(d&&d[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(v=>isNaN(v))){const v=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(d[3]||0):c.getBearing();return c.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:v,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,c)}}function gh(g,c){const d=g.getCenter(),v=Math.round(100*g.getZoom())/100,b=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,b),M=Math.round(d.lng*E)/E,I=Math.round(d.lat*E)/E,k=g.getBearing(),F=g.getPitch();let L=c?`/${M}/${I}/${v}`:`${v}/${I}/${M}`;return(k||F)&&(L+="/"+Math.round(10*k)/10),F&&(L+=`/${Math.round(F)}`),L}const _h={linearity:.3,easing:p.bezier(0,0,.3,1)},Zd=p.extend({deceleration:2500,maxSpeed:1400},_h),Xd=p.extend({deceleration:20,maxSpeed:1400},_h),ut=p.extend({deceleration:1e3,maxSpeed:360},_h),Rs=p.extend({deceleration:1e3,maxSpeed:90},_h);class Cg{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,d=p.exported.now();for(;c.length>0&&d-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const E=vh(d.pan.mag(),v,p.extend({},Zd,c||{}));b.offset=d.pan.mult(E.amount/d.pan.mag()),b.center=this._map.transform.center,yh(b,E)}if(d.zoom){const E=vh(d.zoom,v,Xd);b.zoom=this._map.transform.zoom+E.amount,yh(b,E)}if(d.bearing){const E=vh(d.bearing,v,ut);b.bearing=this._map.transform.bearing+p.clamp(E.amount,-179,179),yh(b,E)}if(d.pitch){const E=vh(d.pitch,v,Rs);b.pitch=this._map.transform.pitch+E.amount,yh(b,E)}if(b.zoom||b.bearing){const E=void 0===d.pinchAround?d.around:d.pinchAround;b.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function yh(g,c){(!g.duration||g.duration<c.duration)&&(g.duration=c.duration,g.easing=c.easing)}function vh(g,c,d){const{maxSpeed:v,linearity:b,deceleration:E}=d,M=p.clamp(g*b/(c/1e3),-v,v),I=Math.abs(M)/(E*b);return{easing:d.easing,duration:1e3*I,amount:M*(I/2)}}class mr extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,v,b={}){const E=io(d.getCanvasContainer(),v),M=d.unproject(E);super(c,p.extend({point:E,lngLat:M,originalEvent:v},b)),this._defaultPrevented=!1,this.target=d}}class xh extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,v){const b="touchend"===c?v.changedTouches:v.touches,E=sl(d.getCanvasContainer(),b),M=E.map(k=>d.unproject(k)),I=E.reduce((k,F,L,j)=>k.add(F.div(j.length)),new p.Point(0,0));super(c,{points:E,point:I,lngLats:M,lngLat:d.unproject(I),originalEvent:v}),this._defaultPrevented=!1}}class Yd extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,v){super(c,{originalEvent:v}),this._defaultPrevented=!1}}class bh{constructor(c,d){this._map=c,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new Yd(c.type,this._map,c))}mousedown(c,d){return this._mousedownPos=d,this._firePreventable(new mr(c.type,this._map,c))}mouseup(c){this._map.fire(new mr(c.type,this._map,c))}preclick(c){const d=p.extend({},c);d.type="preclick",this._map.fire(new mr(d.type,this._map,d))}click(c,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(c),this._map.fire(new mr(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new mr(c.type,this._map,c))}mouseover(c){this._map.fire(new mr(c.type,this._map,c))}mouseout(c){this._map.fire(new mr(c.type,this._map,c))}touchstart(c){return this._firePreventable(new xh(c.type,this._map,c))}touchmove(c){this._map.fire(new xh(c.type,this._map,c))}touchend(c){this._map.fire(new xh(c.type,this._map,c))}touchcancel(c){this._map.fire(new xh(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uu{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new mr(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new mr(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eg{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,d){this.isEnabled()&&c.shiftKey&&0===c.button&&(Gc(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(c,d){if(!this._active)return;const v=d,b=this._startPos,E=this._lastPos;if(!b||!E||E.equals(v)||!this._box&&v.dist(b)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=Zt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const M=Math.min(b.x,v.x),I=Math.max(b.x,v.x),k=Math.min(b.y,v.y),F=Math.max(b.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${k}px)`,this._box.style.width=I-M+"px",this._box.style.height=F-k+"px")})}mouseupWindow(c,d){if(!this._active)return;const v=this._startPos,b=d;if(v&&0===c.button){if(this.reset(),Fo(),v.x!==b.x||v.y!==b.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:E=>E.fitScreenCoordinates(v,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Jl(),delete this._startPos,delete this._lastPos}_fireEvent(c,d){return this._map.fire(new p.Event(c,{originalEvent:d}))}}function Kd(g,c){const d={};for(let v=0;v<g.length;v++)d[g[v].identifier]=c[v];return d}class hu{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,d,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),v.length===this.numTouches&&(this.centroid=function(b){const E=new p.Point(0,0);for(const M of b)E._add(M);return E.div(b.length)}(d),this.touches=Kd(v,d)))}touchmove(c,d,v){if(this.aborted||!this.centroid)return;const b=Kd(v,d);for(const E in this.touches){const M=b[E];(!M||M.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(c,d,v){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===v.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class aa{constructor(c){this.singleTap=new hu(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,d,v){this.singleTap.touchstart(c,d,v)}touchmove(c,d,v){this.singleTap.touchmove(c,d,v)}touchend(c,d,v){const b=this.singleTap.touchend(c,d,v);if(b){const E=c.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(b)<30;if(E&&M||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Dg{constructor(){this._zoomIn=new aa({numTouches:1,numTaps:2}),this._zoomOut=new aa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,d,v){this._zoomIn.touchstart(c,d,v),this._zoomOut.touchstart(c,d,v)}touchmove(c,d,v){this._zoomIn.touchmove(c,d,v),this._zoomOut.touchmove(c,d,v)}touchend(c,d,v){const b=this._zoomIn.touchend(c,d,v),E=this._zoomOut.touchend(c,d,v);return b?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(b)},{originalEvent:c})}):E?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(E)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Wr={0:1,2:2};class Tl{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,d){return!1}_move(c,d){return{}}mousedown(c,d){if(this._lastPoint)return;const v=Zs(c);this._correctButton(c,v)&&(this._lastPoint=d,this._eventButton=v)}mousemoveWindow(c,d){const v=this._lastPoint;if(v)if(c.preventDefault(),null!=this._eventButton&&function(b,E){const M=Wr[E];return void 0===b.buttons||(b.buttons&M)!==M}(c,this._eventButton))this.reset();else if(this._moved||!(d.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(v,d)}mouseupWindow(c){this._lastPoint&&Zs(c)===this._eventButton&&(this._moved&&Fo(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jd extends Tl{mousedown(c,d){super.mousedown(c,d),this._lastPoint&&(this._active=!0)}_correctButton(c,d){return 0===d&&!c.ctrlKey}_move(c,d){return{around:d,panDelta:d.sub(c)}}}class Qd extends Tl{_correctButton(c,d){return 0===d&&c.ctrlKey||2===d}_move(c,d){const v=.8*(d.x-c.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(c){c.preventDefault()}}class wh extends Tl{_correctButton(c,d){return 0===d&&c.ctrlKey||2===d}_move(c,d){const v=-.5*(d.y-c.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(c){c.preventDefault()}}class du{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(c,d,v){return this._calculateTransform(c,d,v)}touchmove(c,d,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===v.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,d,v)}}touchend(c,d,v){this._calculateTransform(c,d,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,d,v){v.length>0&&(this._active=!0);const b=Kd(v,d),E=new p.Point(0,0),M=new p.Point(0,0);let I=0;for(const F in b){const L=b[F],j=this._touches[F];j&&(E._add(L),M._add(L.sub(j)),I++,b[F]=L)}if(this._touches=b,I<this._minTouches||!M.mag())return;const k=M.div(I);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(I),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Zt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class fu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,d,v){return{}}touchstart(c,d,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([d[0],d[1]]))}touchmove(c,d,v){const b=this._firstTwoTouches;if(!b)return;c.preventDefault();const[E,M]=b,I=Sl(v,d,E),k=Sl(v,d,M);if(!I||!k)return;const F=this._aroundCenter?null:I.add(k).div(2);return this._move([I,k],F,c)}touchend(c,d,v){if(!this._firstTwoTouches)return;const[b,E]=this._firstTwoTouches,M=Sl(v,d,b),I=Sl(v,d,E);M&&I||(this._active&&Fo(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Sl(g,c,d){for(let v=0;v<g.length;v++)if(g[v].identifier===d)return c[v]}function ef(g,c){return Math.log(g/c)/Math.LN2}class Co extends fu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,d){const v=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(ef(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ef(this._distance,v),pinchAround:d}}}function Ch(g,c){return 180*g.angleWith(c)/Math.PI}class tf extends fu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,d){const v=this._vector;if(this._vector=c[0].sub(c[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ch(this._vector,v),pinchAround:d}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const d=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const b=Ch(c,v);return Math.abs(b)<d}}function _i(g){return Math.abs(g.y)>Math.abs(g.x)}class Pp extends fu{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,_i(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,d,v){const b=this._lastPoints;if(!b)return;const E=c[0].sub(b[0]),M=c[1].sub(b[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(E,M,v.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(E.y+M.y)/2*-.5})}gestureBeginsVertically(c,d,v){if(void 0!==this._valid)return this._valid;const b=c.mag()>=2,E=d.mag()>=2;if(!b&&!E)return;if(!b||!E)return null==this._firstMove&&(this._firstMove=v),v-this._firstMove<100&&void 0;const M=c.y>0==d.y>0;return _i(c)&&_i(d)&&M}}const pu={panStep:100,bearingStep:15,pitchStep:10};class Eo{constructor(){const c=pu;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let d=0,v=0,b=0,E=0,M=0;switch(c.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:c.shiftKey?v=-1:(c.preventDefault(),E=-1);break;case 39:c.shiftKey?v=1:(c.preventDefault(),E=1);break;case 38:c.shiftKey?b=1:(c.preventDefault(),M=-1);break;case 40:c.shiftKey?b=-1:(c.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(v=0,b=0),{cameraAnimation:I=>{const k=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:kp,zoom:d?Math.round(k)+d*(c.shiftKey?2:1):k,bearing:I.getBearing()+v*this._bearingStep,pitch:I.getPitch()+b*this._pitchStep,offset:[-E*this._panStep,-M*this._panStep],center:I.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kp(g){return g*(2-g)}const Eh=4.000244140625;class Ml{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=c.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const v=p.exported.now(),b=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,0!==d&&d%Eh==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),c.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=c,this._delta-=d,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=io(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const k="wheel"===this._type&&Math.abs(this._delta)>Eh?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&0!==F&&(F=1/F);const L=d(),j=Math.pow(2,L),q="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(q*F))),"wheel"===this._type&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._delta=0}const v="number"==typeof this._targetZoom?this._targetZoom:d(),b=this._startZoom,E=this._easing;let M,I=!1;if("wheel"===this._type&&b&&E){const k=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),F=E(k);M=p.number(b,v,F),k<1?this._frameId||(this._frameId=!0):I=!0}else M=v,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:M-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let d=p.ease;if(this._prevEase){const v=this._prevEase,b=(p.exported.now()-v.start)/v.duration,E=v.easing(b+.01)-v.easing(b),M=.27/Math.sqrt(E*E+1e-4)*.01,I=Math.sqrt(.0729-M*M);d=p.bezier(M,I,.25,1)}return this._prevEase={start:p.exported.now(),duration:c,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Zt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class qr{constructor(c,d){this._clickZoom=c,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class kr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,d){return c.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(c.shiftKey?-1:1),around:v.unproject(d)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dh{constructor(){this._tap=new aa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,d,v){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=d[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(c,d,v))}touchmove(c,d,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const b=d[0],E=b.y-this._swipePoint.y;return this._swipePoint=b,c.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(c,d,v)}touchend(c,d,v){this._tapTime?this._swipePoint&&0===v.length&&this.reset():this._tap.touchend(c,d,v)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rp{constructor(c,d,v){this._el=c,this._mousePan=d,this._touchPan=v}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Na{constructor(c,d,v){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=d,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Op{constructor(c,d,v,b){this._el=c,this._touchZoom=d,this._touchRotate=v,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const uo=g=>g.zoom||g.drag||g.pitch||g.rotate;class rn extends p.Event{}class Lp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,d){const v=p.sub([],d,c);this.radius=p.length(v[2]<0?p.div([],v,this.constants):[v[0],v[1],0])}projectRay(c){p.div(c,c,this.constants),p.normalize(c,c),p.mul$1(c,c,this.constants);const d=p.scale$2([],c,this.radius);if(d[2]>0){const v=p.scale$2([],[0,0,1],p.dot(d,[0,0,1])),b=p.scale$2([],p.normalize([],[d[0],d[1],0]),this.radius),E=p.add([],d,p.scale$2([],p.sub([],p.add([],b,v),d),2));d[0]=E[0],d[1]=E[1]}return d}}function Os(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Ls{constructor(c,d){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cg(c),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Lp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),p.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[b,E,M]of this._listeners)b.addEventListener(E,b===p.window.document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[c,d,v]of this._listeners)c.removeEventListener(d,c===p.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(c){const d=this._map,v=d.getCanvasContainer();this._add("mapEvent",new bh(d,c));const b=d.boxZoom=new Eg(d,c);this._add("boxZoom",b);const E=new Dg,M=new kr;d.doubleClickZoom=new qr(M,E),this._add("tapZoom",E),this._add("clickZoom",M);const I=new Dh;this._add("tapDragZoom",I);const k=d.touchPitch=new Pp(d);this._add("touchPitch",k);const F=new Qd(c),L=new wh(c);d.dragRotate=new Na(c,F,L),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const j=new Jd(c),q=new du(d,c);d.dragPan=new Rp(v,j,q),this._add("mousePan",j),this._add("touchPan",q,["touchZoom","touchRotate"]);const K=new tf,Q=new Co;d.touchZoomRotate=new Op(v,Q,K,I),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new uu(d));const J=d.scrollZoom=new Ml(d,this);this._add("scrollZoom",J,["mousePan"]);const ee=d.keyboard=new Eo;this._add("keyboard",ee);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[U]&&d[U].enable(c[U])}_add(c,d,v){this._handlers.push({handlerName:c,handler:d,allowed:v}),this._handlersById[c]=d}stop(c){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!uo(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,d,v){for(const b in c)if(b!==v&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const d=[];for(const v of c)this._el.contains(v.target)&&d.push(v);return d}handleEvent(c,d){this._updatingCamera=!0;const v="renderFrame"===c.type,b=v?void 0:c,E={needsRenderFrame:!1},M={},I={},k=c.touches?this._getMapTouches(c.touches):void 0,F=k?sl(this._el,k):v?void 0:io(this._el,c);for(const{handlerName:q,handler:K,allowed:Q}of this._handlers){if(!K.isEnabled())continue;let J;this._blockedByActive(I,Q,q)?K.reset():K[d||c.type]&&(J=K[d||c.type](c,F,k),this.mergeHandlerResult(E,M,J,q,b),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||K.isActive())&&(I[q]=K)}const L={};for(const q in this._previousActiveHandlers)I[q]||(L[q]=b);this._previousActiveHandlers=I,(Object.keys(L).length||Os(E))&&(this._changes.push([E,M,L]),this._triggerRenderFrame()),(Object.keys(I).length||Os(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=E;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(c,d,v,b,E){if(!v)return;p.extend(c,v);const M={handlerName:b,originalEvent:v.originalEvent||E};void 0!==v.zoomDelta&&(d.zoom=M),void 0!==v.panDelta&&(d.drag=M),void 0!==v.pitchDelta&&(d.pitch=M),void 0!==v.bearingDelta&&(d.rotate=M)}_applyChanges(){const c={},d={},v={};for(const[b,E,M]of this._changes)b.panDelta&&(c.panDelta=(c.panDelta||new p.Point(0,0))._add(b.panDelta)),b.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(c.around=b.around),void 0!==b.aroundCoord&&(c.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(c.pinchAround=b.pinchAround),b.noInertia&&(c.noInertia=b.noInertia),p.extend(d,E),p.extend(v,M);this._updateMapTransform(c,d,v),this._changes=[]}_updateMapTransform(c,d,v){const b=this._map,E=b.transform,M=Y=>[Y.x,Y.y,Y.z];if((Y=>{const ie=this._eventsInProgress.drag;return ie&&!this._handlersById[ie.handlerName].isActive()})()&&!Os(c)){const Y=E.zoom;E.cameraElevationReference="sea",E.recenterOnTerrain(),E.cameraElevationReference="ground",Y!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&b._stop(!0),!Os(c))return void this._fireEvents(d,v,!0);let{panDelta:I,zoomDelta:k,bearingDelta:F,pitchDelta:L,around:j,aroundCoord:q,pinchAround:K}=c;E._isCameraConstrained&&(k>0&&(k=0),E._isCameraConstrained=!1),void 0!==K&&(j=K),(k||(Y=>d[Y]&&!this._eventsInProgress[Y])("drag"))&&j&&(this._dragOrigin=M(E.pointCoordinate3D(j)),this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",b._stop(!0),j=j||b.transform.centerPoint,F&&(E.bearing+=F),L&&(E.pitch+=L),E._updateCameraState();const Q=[0,0,0];if(I)if("mercator"===E.projection.name){const Y=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(j).dir),ie=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(j.sub(I)).dir);Q[0]=ie[0]-Y[0],Q[1]=ie[1]-Y[1]}else{const Y=E.pointCoordinate(j);if("globe"===E.projection.name){I=I.rotate(-E.angle);const ie=E._pixelsPerMercatorPixel/E.worldSize;Q[0]=-I.x*p.mercatorScale(p.latFromMercatorY(Y.y))*ie,Q[1]=-I.y*p.mercatorScale(E.center.lat)*ie}else{const ie=E.pointCoordinate(j.sub(I));Y&&ie&&(Q[0]=ie.x-Y.x,Q[1]=ie.y-Y.y)}}const J=E.zoom,ee=[0,0,0];if(k){const Y=M(q||E.pointCoordinate3D(j)),ie={dir:p.normalize([],p.sub([],Y,E._camera.position))};if(ie.dir[2]<0){const re=E.zoomDeltaToMovement(Y,k);p.scale$2(ee,ie.dir,re)}}const U=p.add(Q,Q,ee);E._translateCameraConstrained(U),k&&Math.abs(E.zoom-J)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(d,v,!0)}_fireEvents(c,d,v){const b=uo(this._eventsInProgress),E=uo(c),M={};for(const L in c){const{originalEvent:j}=c[L];this._eventsInProgress[L]||(M[`${L}start`]=j),this._eventsInProgress[L]=c[L]}!b&&E&&this._fireEvent("movestart",E.originalEvent);for(const L in M)this._fireEvent(L,M[L]);E&&this._fireEvent("move",E.originalEvent);for(const L in c){const{originalEvent:j}=c[L];this._fireEvent(L,j)}const I={};let k;for(const L in this._eventsInProgress){const{handlerName:j,originalEvent:q}=this._eventsInProgress[L];this._handlersById[j].isActive()||(delete this._eventsInProgress[L],k=d[j]||q,I[`${L}end`]=k)}for(const L in I)this._fireEvent(L,I[L]);const F=uo(this._eventsInProgress);if(v&&(b||E)&&!F){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=q=>0!==q&&-this._bearingSnap<q&&q<this._bearingSnap;L?(j(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:k})):(this._map.fire(new p.Event("moveend",{originalEvent:k})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,d){this._map.fire(new p.Event(c,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new rn("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Il="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Th extends p.Evented{constructor(c,d){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=!1!==d.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,d){return this.jumpTo({center:c},d)}panBy(c,d,v){return c=p.Point.convert(c).mult(-1),this.panTo(this.transform.center,p.extend({offset:c},d),v)}panTo(c,d,v){return this.easeTo(p.extend({center:c},d),v)}getZoom(){return this.transform.zoom}setZoom(c,d){return this.jumpTo({zoom:c},d),this}zoomTo(c,d,v){return this.easeTo(p.extend({zoom:c},d),v)}zoomIn(c,d){return this.zoomTo(this.getZoom()+1,c,d),this}zoomOut(c,d){return this.zoomTo(this.getZoom()-1,c,d),this}getBearing(){return this.transform.bearing}setBearing(c,d){return this.jumpTo({bearing:c},d),this}getPadding(){return this.transform.padding}setPadding(c,d){return this.jumpTo({padding:c},d),this}rotateTo(c,d,v){return this.easeTo(p.extend({bearing:c},d),v)}resetNorth(c,d){return this.rotateTo(0,p.extend({duration:1e3},c),d),this}resetNorthPitch(c,d){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},c),d),this}snapToNorth(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this}getPitch(){return this.transform.pitch}setPitch(c,d){return this.jumpTo({pitch:c},d),this}cameraForBounds(c,d){c=p.LngLatBounds.convert(c);const v=d&&d.bearing||0,b=d&&d.pitch||0,E=c.getNorthWest(),M=c.getSouthEast();return this._cameraForBounds(this.transform,E,M,v,b,d)}_extendCameraOptions(c){const d={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=p.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const v=c.padding;c.padding={top:v,bottom:v,right:v,left:v}}return c.padding=p.extend(d,c.padding),c}_minimumAABBFrustumDistance(c,d){const v=d.max[0]-d.min[0],b=d.max[1]-d.min[1];return v/b>c.aspect?v/(2*Math.tan(.5*c.fovX)*c.aspect):b/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,d,v,b,E,M){const I=c.clone(),k=this._extendCameraOptions(M);I.bearing=b,I.pitch=E;const F=p.LngLat.convert(d),L=p.LngLat.convert(v),j=.5*(F.lat+L.lat),q=.5*(F.lng+L.lng),K=p.latLngToECEF(j,q),Q=p.normalize([],K),J=p.normalize([],p.cross([],Q,[0,1,0])),ee=p.cross([],J,Q),U=[J[0],J[1],J[2],0,ee[0],ee[1],ee[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],Y=[K,p.latLngToECEF(F.lat,F.lng),p.latLngToECEF(L.lat,F.lng),p.latLngToECEF(L.lat,L.lng),p.latLngToECEF(F.lat,L.lng),p.latLngToECEF(j,F.lng),p.latLngToECEF(j,L.lng),p.latLngToECEF(F.lat,q),p.latLngToECEF(L.lat,q)];let ie=p.Aabb.fromPoints(Y.map($e=>[p.dot(J,$e),p.dot(ee,$e),p.dot(Q,$e)]));const re=p.transformMat4([],ie.center,U);0===p.squaredLength(re)&&p.set(re,0,0,1),p.normalize(re,re),p.scale$2(re,re,p.GLOBE_RADIUS),I.center=p.ecefToLatLng(re);const fe=I.getWorldToCameraMatrix(),ge=p.invert(new Float64Array(16),fe);ie=p.Aabb.applyTransform(ie,p.multiply([],fe,U)),p.transformMat4(re,re,fe);const de=.5*(ie.max[2]-ie.min[2]),be=this._minimumAABBFrustumDistance(I,ie),xe=p.scale$2([],[0,0,1],de),Ie=p.add(xe,re,xe),Xe=be+(0===I.pitch?0:p.distance(re,Ie)),Te=I.globeCenterInViewSpace,je=p.sub([],re,[Te[0],Te[1],Te[2]]);p.normalize(je,je),p.scale$2(je,je,Xe);const Pe=p.add([],re,je);p.transformMat4(Pe,Pe,ge);const We=p.earthRadius/p.GLOBE_RADIUS,Se=p.length(Pe),Ne=p.mercatorZfromAltitude(Math.max(Se*We-p.earthRadius,Number.EPSILON),0),Ye=Math.min(I.zoomFromMercatorZAdjusted(Ne),k.maxZoom);return Ye>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"mercator"}),I.zoom=Ye,this._cameraForBounds(I,d,v,b,E,M)):{center:I.center,zoom:Ye,bearing:b,pitch:E}}queryTerrainElevation(c,d){const v=this.transform.elevation;return v?(d=p.extend({},{exaggerated:!0},d),v.getAtPoint(p.MercatorCoordinate.fromLngLat(c),null,d.exaggerated)):null}_cameraForBounds(c,d,v,b,E,M){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,d,v,b,E,M);const I=c.clone(),k=this._extendCameraOptions(M),F=I.padding;I.bearing=b,I.pitch=E;const L=p.LngLat.convert(d),j=p.LngLat.convert(v),q=new p.LngLat(L.lng,j.lat),K=new p.LngLat(j.lng,L.lat),Q=I.project(L),J=I.project(j),ee=this.queryTerrainElevation(L),U=this.queryTerrainElevation(j),Y=this.queryTerrainElevation(q),ie=this.queryTerrainElevation(K),re=[[Q.x,Q.y,Math.min(ee||0,U||0,Y||0,ie||0)],[J.x,J.y,Math.max(ee||0,U||0,Y||0,ie||0)]];let fe=p.Aabb.fromPoints(re);const ge=I.getWorldToCameraMatrix(),de=p.invert(new Float64Array(16),ge);fe=p.Aabb.applyTransform(fe,ge);const be=p.sub([],fe.max,fe.min),xe=F.left||0,Ie=F.right||0,Xe=F.bottom||0,Te=F.top||0,{left:je,right:Pe,top:We,bottom:Se}=k.padding,Ne=.5*(xe+Ie),Ye=.5*(Te+Xe),$e=Math.min(I.scaleZoom(I.scale*Math.min((I.width-(xe+Ie+je+Pe))/be[0],(I.height-(Xe+Te+Se+We))/be[1])),k.maxZoom),qe=I.scale/I.zoomScale($e);fe=new p.Aabb([fe.min[0]-(je+Ne)*qe,fe.min[1]-(Se+Ye)*qe,fe.min[2]],[fe.max[0]+(Pe+Ne)*qe,fe.max[1]+(We+Ye)*qe,fe.max[2]]);const _t=.5*be[2],zt=this._minimumAABBFrustumDistance(I,fe),mt=[0,0,1,0];p.transformMat4$1(mt,mt,ge),p.normalize$2(mt,mt);const Tt=p.scale$2([],mt,zt+_t),dn=p.add([],fe.center,Tt),sn=("number"==typeof k.offset.x&&"number"==typeof k.offset.y?new p.Point(k.offset.x,k.offset.y):p.Point.convert(k.offset)).rotate(-p.degToRad(b));fe.center[0]-=sn.x*qe,fe.center[1]+=sn.y*qe,p.transformMat4(fe.center,fe.center,de),p.transformMat4(dn,dn,de);const vt=[fe.center[0],fe.center[1],dn[2]*I.pixelsPerMeter];p.scale$2(vt,vt,1/I.worldSize);const On=p.lngFromMercatorX(vt[0]),Jn=p.latFromMercatorY(vt[1]),Ln=Math.min(I._zoomFromMercatorZ(vt[2]),k.maxZoom),Vn=new p.LngLat(On,Jn);return I.mercatorFromTransition&&Ln<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"globe"}),I.zoom=Ln,this._cameraForBounds(I,d,v,b,E,M)):{center:Vn,zoom:Ln,bearing:b,pitch:E}}fitBounds(c,d,v){const b=this.cameraForBounds(c,d);return this._fitInternal(b,d,v)}fitScreenCoordinates(c,d,v,b,E){const M=p.Point.convert(c),I=p.Point.convert(d),k=new p.Point(Math.min(M.x,I.x),Math.min(M.y,I.y)),F=new p.Point(Math.max(M.x,I.x),Math.max(M.y,I.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(M,I))return this;const L=this.transform.pointLocation3D(k),j=this.transform.pointLocation3D(F),q=this.transform.pointLocation3D(new p.Point(k.x,F.y)),K=this.transform.pointLocation3D(new p.Point(F.x,k.y)),Q=[Math.min(L.lng,j.lng,q.lng,K.lng),Math.min(L.lat,j.lat,q.lat,K.lat)],J=[Math.max(L.lng,j.lng,q.lng,K.lng),Math.max(L.lat,j.lat,q.lat,K.lat)],ee=b&&b.pitch?b.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,Q,J,v,ee,b);return this._fitInternal(U,b,E)}_fitInternal(c,d,v){return c?(delete(d=p.extend(c,d)).padding,d.linear?this.easeTo(d,v):this.flyTo(d,v)):this}jumpTo(c,d){this.stop();const v=c.preloadOnly?this.transform.clone():this.transform;let b=!1,E=!1,M=!1;return"zoom"in c&&v.zoom!==+c.zoom&&(b=!0,v.zoom=+c.zoom),void 0!==c.center&&(v.center=p.LngLat.convert(c.center)),"bearing"in c&&v.bearing!==+c.bearing&&(E=!0,v.bearing=+c.bearing),"pitch"in c&&v.pitch!==+c.pitch&&(M=!0,v.pitch=+c.pitch),null==c.padding||v.isPaddingEqual(c.padding)||(v.padding=c.padding),c.preloadOnly?(this._preloadTiles(v),this):(this.fire(new p.Event("movestart",d)).fire(new p.Event("move",d)),b&&this.fire(new p.Event("zoomstart",d)).fire(new p.Event("zoom",d)).fire(new p.Event("zoomend",d)),E&&this.fire(new p.Event("rotatestart",d)).fire(new p.Event("rotate",d)).fire(new p.Event("rotateend",d)),M&&this.fire(new p.Event("pitchstart",d)).fire(new p.Event("pitch",d)).fire(new p.Event("pitchend",d)),this.fire(new p.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Il),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,d){const v=this.transform;if(!v.projection.supportsFreeCamera)return p.warnOnce(Il),this;this.stop();const b=v.zoom,E=v.pitch,M=v.bearing;v.setFreeCameraOptions(c);const I=b!==v.zoom,k=E!==v.pitch,F=M!==v.bearing;return this.fire(new p.Event("movestart",d)).fire(new p.Event("move",d)),I&&this.fire(new p.Event("zoomstart",d)).fire(new p.Event("zoom",d)).fire(new p.Event("zoomend",d)),F&&this.fire(new p.Event("rotatestart",d)).fire(new p.Event("rotate",d)).fire(new p.Event("rotateend",d)),k&&this.fire(new p.Event("pitchstart",d)).fire(new p.Event("pitch",d)).fire(new p.Event("pitchend",d)),this.fire(new p.Event("moveend",d)),this}easeTo(c,d){this._stop(!1,c.easeId),(!1===(c=p.extend({offset:[0,0],duration:500,easing:p.ease},c)).animate||this._prefersReducedMotion(c))&&(c.duration=0);const v=this.transform,b=this.getZoom(),E=this.getBearing(),M=this.getPitch(),I=this.getPadding(),k="zoom"in c?+c.zoom:b,F="bearing"in c?this._normalizeBearing(c.bearing,E):E,L="pitch"in c?+c.pitch:M,j="padding"in c?c.padding:v.padding,q=p.Point.convert(c.offset);let K,Q,J;if("globe"===v.projection.name){const xe=p.MercatorCoordinate.fromLngLat(v.center),Ie=q.rotate(-v.angle);xe.x+=Ie.x/v.worldSize,xe.y+=Ie.y/v.worldSize;const Xe=xe.toLngLat(),Te=p.LngLat.convert(c.center||Xe);this._normalizeCenter(Te),K=v.centerPoint.add(Ie),Q=new p.Point(xe.x,xe.y).mult(v.worldSize),J=new p.Point(p.mercatorXfromLng(Te.lng),p.mercatorYfromLat(Te.lat)).mult(v.worldSize).sub(Q)}else{K=v.centerPoint.add(q);const xe=v.pointLocation(K),Ie=p.LngLat.convert(c.center||xe);this._normalizeCenter(Ie),Q=v.project(xe),J=v.project(Ie).sub(Q)}const ee=v.zoomScale(k-b);let U,Y;c.around&&(U=p.LngLat.convert(c.around),Y=v.locationPoint(U));const ie=this._zooming||k!==b,re=this._rotating||E!==F,fe=this._pitching||L!==M,ge=!v.isPaddingEqual(j),de=xe=>Ie=>{if(ie&&(xe.zoom=p.number(b,k,Ie)),re&&(xe.bearing=p.number(E,F,Ie)),fe&&(xe.pitch=p.number(M,L,Ie)),ge&&(xe.interpolatePadding(I,j,Ie),K=xe.centerPoint.add(q)),U)xe.setLocationAtPoint(U,Y);else{const Xe=xe.zoomScale(xe.zoom-b),Te=k>b?Math.min(2,ee):Math.max(.5,ee),je=Math.pow(Te,1-Ie),Pe=xe.unproject(Q.add(J.mult(Ie*je)).mult(Xe));xe.setLocationAtPoint(xe.renderWorldCopies?Pe.wrap():Pe,K)}return c.preloadOnly||this._fireMoveEvents(d),xe};if(c.preloadOnly){const xe=this._emulate(de,c.duration,v);return this._preloadTiles(xe),this}const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=re,this._pitching=fe,this._padding=ge,this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,be),this._ease(de(v),xe=>{v.recenterOnTerrain(),this._afterEase(d,xe)},c),this}_prepareEase(c,d,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||v.moving||this.fire(new p.Event("movestart",c)),this._zooming&&!v.zooming&&this.fire(new p.Event("zoomstart",c)),this._rotating&&!v.rotating&&this.fire(new p.Event("rotatestart",c)),this._pitching&&!v.pitching&&this.fire(new p.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new p.Event("move",c)),this._zooming&&this.fire(new p.Event("zoom",c)),this._rotating&&this.fire(new p.Event("rotate",c)),this._pitching&&this.fire(new p.Event("pitch",c))}_afterEase(c,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,b=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new p.Event("zoomend",c)),b&&this.fire(new p.Event("rotateend",c)),E&&this.fire(new p.Event("pitchend",c)),this.fire(new p.Event("moveend",c))}flyTo(c,d){if(this._prefersReducedMotion(c)){const $e=p.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo($e,d)}this.stop(),c=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},c);const v=this.transform,b=this.getZoom(),E=this.getBearing(),M=this.getPitch(),I=this.getPadding(),k="zoom"in c?p.clamp(+c.zoom,v.minZoom,v.maxZoom):b,F="bearing"in c?this._normalizeBearing(c.bearing,E):E,L="pitch"in c?+c.pitch:M,j="padding"in c?c.padding:v.padding,q=v.zoomScale(k-b),K=p.Point.convert(c.offset);let Q=v.centerPoint.add(K);const J=v.pointLocation(Q),ee=p.LngLat.convert(c.center||J);this._normalizeCenter(ee);const U=v.project(J),Y=v.project(ee).sub(U);let ie=c.curve;const re=Math.max(v.width,v.height),fe=re/q,ge=Y.mag();if("minZoom"in c){const $e=p.clamp(Math.min(c.minZoom,b,k),v.minZoom,v.maxZoom),qe=re/v.zoomScale($e-b);ie=Math.sqrt(qe/ge*2)}const de=ie*ie;function be($e){const qe=(fe*fe-re*re+($e?-1:1)*de*de*ge*ge)/(2*($e?fe:re)*de*ge);return Math.log(Math.sqrt(qe*qe+1)-qe)}function xe($e){return(Math.exp($e)-Math.exp(-$e))/2}function Ie($e){return(Math.exp($e)+Math.exp(-$e))/2}const Xe=be(0);let Te=function($e){return Ie(Xe)/Ie(Xe+ie*$e)},je=function($e){return re*((Ie(Xe)*(xe(qe=Xe+ie*$e)/Ie(qe))-xe(Xe))/de)/ge;var qe},Pe=(be(1)-Xe)/ie;if(Math.abs(ge)<1e-6||!isFinite(Pe)){if(Math.abs(re-fe)<1e-6)return this.easeTo(c,d);const $e=fe<re?-1:1;Pe=Math.abs(Math.log(fe/re))/ie,je=function(){return 0},Te=function(qe){return Math.exp($e*ie*qe)}}c.duration="duration"in c?+c.duration:1e3*Pe/("screenSpeed"in c?+c.screenSpeed/ie:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const We=E!==F,Se=L!==M,Ne=!v.isPaddingEqual(j),Ye=$e=>qe=>{const _t=qe*Pe,zt=1/Te(_t);$e.zoom=1===qe?k:b+$e.scaleZoom(zt),We&&($e.bearing=p.number(E,F,qe)),Se&&($e.pitch=p.number(M,L,qe)),Ne&&($e.interpolatePadding(I,j,qe),Q=$e.centerPoint.add(K));const mt=1===qe?ee:$e.unproject(U.add(Y.mult(je(_t))).mult(zt));return $e.setLocationAtPoint($e.renderWorldCopies?mt.wrap():mt,Q),$e._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(d),$e};if(c.preloadOnly){const $e=this._emulate(Ye,c.duration,v);return this._preloadTiles($e),this}return this._zooming=!0,this._rotating=We,this._pitching=Se,this._padding=Ne,this._prepareEase(d,!1),this._ease(Ye(v),()=>this._afterEase(d),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,d)}if(!c){const v=this.handlers;v&&v.stop(!1)}return this}_ease(c,d,v){!1===v.animate||0===v.duration?(c(1),d()):(this._easeStart=p.exported.now(),this._easeOptions=v,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,d){c=p.wrap(c,-180,180);const v=Math.abs(c-d);return Math.abs(c-360-d)<v&&(c-=360),Math.abs(c+360-d)<v&&(c+=360),c}_normalizeCenter(c){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const v=c.lng-d.center.lng;c.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,d,v){const b=Math.ceil(15*d/1e3),E=[],M=c(v.clone());for(let I=0;I<=b;I++){const k=M(I/b);E.push(k.clone())}return E}}class pt{constructor(c={}){this.options=c,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const d=this.options&&this.options.compact;return this._map=c,this._container=Zt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Zt("button","mapboxgl-ctrl-attrib-button",this._container),Zt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Zt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===d&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,d){const v=this._map._getUIString(`AttributionControl.${d}`);c.setAttribute("aria-label",v),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(c){const v=d.reduce((b,E,M)=>(E.value&&(b+=`${E.key}=${E.value}${M<d.length-1?"&":""}`),b),"?");c.href=`${p.config.FEEDBACK_URL}/${v}#${gh(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._sourceCaches;for(const b in d){const E=d[b];if(E.used){const M=E.getSource();M.attribution&&c.indexOf(M.attribution)<0&&c.push(M.attribution)}}c.sort((b,E)=>b.length-E.length),c=c.filter((b,E)=>{for(let M=E+1;M<c.length;M++)if(c[M].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const v=c.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,c.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class nf{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Zt("div","mapboxgl-ctrl");const d=Zt("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const d in c){const v=c[d].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const d=c[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class rf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const d=++this._id;return this._queue.push({callback:c,id:d,cancelled:!1}),d}remove(c){const d=this._currentlyRunning,v=d?this._queue.concat(d):this._queue;for(const b of v)if(b.id===c)return void(b.cancelled=!0)}run(c=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const v of d)if(!v.cancelled&&(v.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ze(g,c,d){if(g=new p.LngLat(g.lng,g.lat),c){const v=new p.LngLat(g.lng-360,g.lat),b=new p.LngLat(g.lng+360,g.lat),E=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),M=d.locationPoint(g).distSqr(c),I=c.x<0||c.y<0||c.x>d.width||c.y>d.height;d.locationPoint(v).distSqr(c)<M&&(I||Math.abs(v.lng-d.center.lng)<E)?g=v:d.locationPoint(b).distSqr(c)<M&&(I||Math.abs(b.lng-d.center.lng)<E)&&(g=b)}for(;Math.abs(g.lng-d.center.lng)>180;){const v=d.locationPoint(g);if(v.x>=0&&v.y>=0&&v.x<=d.width&&v.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const yn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class at extends p.Evented{constructor(c,d){if(super(),(c instanceof p.window.HTMLElement||d)&&(c=p.extend({element:c},d)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=p.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Zt("div");const b=41,E=27,M=Zi("svg",{display:"block",height:b*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${b}`},this._element),I=Zi("radialGradient",{id:"shadowGradient"},Zi("defs",{},M));Zi("stop",{offset:"10%","stop-opacity":.4},I),Zi("stop",{offset:"100%","stop-opacity":.05},I),Zi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),Zi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),Zi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),Zi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=p.Point.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const v=this._element.classList;for(const b in yn)v.remove(`mapboxgl-marker-anchor-${b}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=p.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const d=c.code,v=c.charCode||c.keyCode;"Space"!==d&&"Enter"!==d&&32!==v&&13!==v||this.togglePopup()}_onMapClick(c){const d=c.originalEvent.target,v=this._element;this._popup&&(d===v||v.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,d=this._pos;if(!c||!d)return!1;const v=c.unproject(d),b=c.getFreeCameraOptions();if(!b.position)return!1;const E=b.position.toLngLat();return E.distanceTo(v)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const d=this._pos;if(!d||d.x<0||d.x>c.transform.width||d.y<0||d.y>c.transform.height)return void this._clearFadeTimer();const v=c.unproject(d);let b;c._showingGlobe()&&p.isLngLatBehindGlobe(c.transform,this._lngLat)?b=0:(b=1-c._queryFogOpacity(v),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${yn[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${d.x}px,${d.y}px)\n        `}_calculateXYTransform(){const c=this._pos,d=this._map,v=this.getPitchAlignment();if(!d||!c||"map"!==v)return"";if(!d._showingGlobe()){const k=d.getPitch();return k?`rotateX(${k}deg)`:""}const b=p.radToDeg(p.globeTiltAtLngLat(d.transform,this._lngLat)),E=c.sub(p.globeCenterToScreenPoint(d.transform)),M=Math.abs(E.x)+Math.abs(E.y);if(0===M)return"";const I=b/M;return`rotateX(${-E.y*I}deg) rotateY(${E.x*I}deg)`}_calculateZTransform(){const c=this._pos,d=this._map;if(!d||!c)return"";let v=0;const b=this.getRotationAlignment();if("map"===b)if(d._showingGlobe()){const E=d.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),M=d.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(E);v=p.radToDeg(Math.atan2(M.y,M.x))-90}else v=-d.getBearing();else if("horizon"===b){const E=p.smoothstep(4,6,d.getZoom()),M=p.globeCenterToScreenPoint(d.transform);M.y+=E*d.transform.height;const I=c.sub(M),k=p.radToDeg(Math.atan2(I.y,I.x));v=(k>90?k-270:k+90)*(1-E)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(c){p.window.cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Ze(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),!0===c?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=p.Point.convert(c),this._update(),this}_onMove(c){const d=this._map;if(!d)return;const v=this._pointerdownPos,b=this._positionDelta;if(v&&b){if(!this._isDragging){const E=this._clickTolerance||d._clickTolerance;if(c.point.dist(v)<E)return;this._isDragging=!0}this._pos=c.point.sub(b),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(c){const d=this._map,v=this._pos;d&&v&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(v),this._pointerdownPos=c.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const d=this._map;return d&&(c?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Al={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},gr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function sf(g=new p.Point(0,0),c="bottom"){if("number"==typeof g){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(c){case"top":return new p.Point(0,g);case"top-left":return new p.Point(d,d);case"top-right":return new p.Point(-d,d);case"bottom":return new p.Point(0,-g);case"bottom-left":return new p.Point(d,-d);case"bottom-right":return new p.Point(-d,-d);case"left":return new p.Point(g,0);case"right":return new p.Point(-g,0)}return new p.Point(0,0)}return g instanceof p.Point||Array.isArray(g)?p.Point.convert(g):p.Point.convert(g[c]||[0,0])}class Pl{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const d=p.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,d,v){this._start=this.getValue(d),this._end=c,this._startTime=d,this._endTime=d+v}}const us={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Sh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},af={showCompass:!0,showZoom:!0,visualizePitch:!1};class Tg{constructor(c,d,v=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Qd({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,v&&(this.mousePitch=new wh({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(c,d){this.mouseRotate.mousedown(c,d),this.mousePitch&&this.mousePitch.mousedown(c,d),Gc()}move(c,d){const v=this.map,b=this.mouseRotate.mousemoveWindow(c,d),E=b&&b.bearingDelta;if(E&&v.setBearing(v.getBearing()+E),this.mousePitch){const M=this.mousePitch.mousemoveWindow(c,d),I=M&&M.pitchDelta;I&&v.setPitch(v.getPitch()+I)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Jl(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(p.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),io(this.element,c)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,io(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=sl(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=sl(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Fp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Mh={maxWidth:100,unit:"metric"},_r={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ho={version:p.version,supported:Ds,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends Th{constructor(g){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(g=p.extend({},Sh,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(g.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new cu(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._useWebGL2=g.useWebGL2,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new rf,this._domRenderTaskQueue=new rf,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},us,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Pl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=p.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Ls(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new qd("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,p.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new pt({customAttribution:g.customAttribution})),this._logoControl=new nf,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new p.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new p.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(g,c){if(void 0===c&&(c=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const v=this._controlPositions[c];return-1!==c.indexOf("bottom")?v.insertBefore(d,v.firstChild):v.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(g);return c>-1&&this._controls.splice(c,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),this.fire(new p.Event("resize",g)),c&&this.fire(new p.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(p.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?p.window.navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(c=>"auto"===c?p.window.navigator.language:c):g}setLanguage(g){const c=this._parseLanguage(g);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,c=g.projection.name;let d;"globe"===c&&g.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(g.setMercatorFromTransition(),d=!0):"mercator"===c&&g.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(g.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,c){return this._updateProjection(g||c||{name:"mercator"})}_updateProjection(g){let c;if(c="globe"===g.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const d in this.style._sourceCaches)this.style._sourceCaches[d].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(g){return this.transform.locationPoint3D(p.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(p.Point.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,c,d){if("mouseenter"===g||"mouseover"===g){let v=!1;const b=M=>{const I=c.filter(F=>this.getLayer(F)),k=I.length?this.queryRenderedFeatures(M.point,{layers:I}):[];k.length?v||(v=!0,d.call(this,new mr(g,this,M.originalEvent,{features:k}))):v=!1},E=()=>{v=!1};return{layers:new Set(c),listener:d,delegates:{mousemove:b,mouseout:E}}}if("mouseleave"===g||"mouseout"===g){let v=!1;const b=M=>{const I=c.filter(k=>this.getLayer(k));(I.length?this.queryRenderedFeatures(M.point,{layers:I}):[]).length?v=!0:v&&(v=!1,d.call(this,new mr(g,this,M.originalEvent)))},E=M=>{v&&(v=!1,d.call(this,new mr(g,this,M.originalEvent)))};return{layers:new Set(c),listener:d,delegates:{mousemove:b,mouseout:E}}}{const v=b=>{const E=c.filter(I=>this.getLayer(I)),M=E.length?this.queryRenderedFeatures(b.point,{layers:E}):[];M.length&&(b.features=M,d.call(this,b),delete b.features)};return{layers:new Set(c),listener:d,delegates:{[g]:v}}}}on(g,c,d){if(void 0===d)return super.on(g,c);Array.isArray(c)||(c=[c]);const v=this._createDelegatedListener(g,c,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(v);for(const b in v.delegates)this.on(b,v.delegates[b]);return this}once(g,c,d){if(void 0===d)return super.once(g,c);Array.isArray(c)||(c=[c]);const v=this._createDelegatedListener(g,c,d);for(const b in v.delegates)this.once(b,v.delegates[b]);return this}off(g,c,d){if(void 0===d)return super.off(g,c);c=new Set(Array.isArray(c)?c:[c]);const v=(E,M)=>{if(E.size!==M.size)return!1;for(const I of E)if(!M.has(I))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[g]:void 0;return b&&(E=>{for(let M=0;M<E.length;M++){const I=E[M];if(I.listener===d&&v(I.layers,c)){for(const k in I.delegates)this.off(k,I.delegates[k]);return E.splice(M,1),this}}})(b),this}queryRenderedFeatures(g,c){return this.style?(void 0!==c||void 0===g||g instanceof p.Point||Array.isArray(g)||(c=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(g,c){return this.style.querySourceFeatures(g,c)}isPointOnSurface(g){const{name:c}=this.transform.projection;return"globe"!==c&&"mercator"!==c&&p.warnOnce(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(g))}setStyle(g,c){return!1!==(c=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(g,c))}_getUIString(g){const c=this._locale[g];if(null==c)throw new Error(`Missing UI string '${g}'`);return c}_updateStyle(g,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new bo(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new bo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,c){if("string"==typeof g){const d=this._requestManager.normalizeStyleURL(g),v=this._requestManager.transformRequest(d,p.ResourceType.Style);p.getJSON(v,(b,E)=>{b?this.fire(new p.ErrorEvent(b)):E&&this._updateDiff(E,c)})}else"object"==typeof g&&this._updateDiff(g,c)}_updateDiff(g,c){try{this.style.setState(g)&&this._update(!0)}catch(d){p.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(g,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(g,c){return this._lazyInitEmptyStyle(),this.style.addSource(g,c),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const c in g){const d=g[c]._tiles;for(const v in d){const b=d[v];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(g,c,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,c,d)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,c,{pixelRatio:d=1,sdf:v=!1,stretchX:b,stretchY:E,content:M}={}){if(this._lazyInitEmptyStyle(),c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap){const{width:I,height:k,data:F}=p.exported.getImageData(c);this.style.addImage(g,{data:new p.RGBAImage({width:I,height:k},F),pixelRatio:d,stretchX:b,stretchY:E,content:M,sdf:v,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:k}=c,F=c;this.style.addImage(g,{data:new p.RGBAImage({width:I,height:k},new Uint8Array(F.data)),pixelRatio:d,stretchX:b,stretchY:E,content:M,sdf:v,version:0,userImage:F}),F.onAdd&&F.onAdd(this,g)}}updateImage(g,c){const d=this.style.getImage(g);if(!d)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap?p.exported.getImageData(c):c,{width:b,height:E}=v;void 0!==b&&void 0!==E?b===d.data.width&&E===d.data.height?(d.data.replace(v.data,!(c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap)),this.style.updateImage(g,d)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${b}, ${E})\n                must be that same as the previous version of the image\n                (${d.data.width}, ${d.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,c){p.getImage(this._requestManager.transformRequest(g,p.ResourceType.Image),(d,v)=>{c(d,v instanceof p.window.HTMLImageElement?p.exported.getImageData(v):v)})}listImages(){return this.style.listImages()}addLayer(g,c){return this._lazyInitEmptyStyle(),this.style.addLayer(g,c),this._update(!0)}moveLayer(g,c){return this.style.moveLayer(g,c),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,c,d){return this.style.setLayerZoomRange(g,c,d),this._update(!0)}setFilter(g,c,d={}){return this.style.setFilter(g,c,d),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,c,d,v={}){return this.style.setPaintProperty(g,c,d,v),this._update(!0)}getPaintProperty(g,c){return this.style.getPaintProperty(g,c)}setLayoutProperty(g,c,d,v={}){return this.style.setLayoutProperty(g,c,d,v),this._update(!0)}getLayoutProperty(g,c){return this.style.getLayoutProperty(g,c)}setLight(g,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(g),this.transform):0}setFeatureState(g,c){return this.style.setFeatureState(g,c),this._update()}removeFeatureState(g,c){return this.style.removeFeatureState(g,c),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let d,v,b,E=this._container;for(;E&&(!v||!b);){const M=p.window.getComputedStyle(E).transform;M&&"none"!==M&&(d=M.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&"0"!==d[0]&&"1"!==d[0]&&(v=d[0]),d[3]&&"0"!==d[3]&&"1"!==d[3]&&(b=d[3])),E=E.parentElement}this._containerWidth=v?Math.abs(g/v):g,this._containerHeight=b?Math.abs(c/b):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Zt("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Zt("div","mapboxgl-canvas-container",g);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=Zt("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=Zt("div","mapboxgl-control-container",g),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{v[b]=Zt("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,c){const d=p.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(c),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${c}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const c=this._markers.indexOf(g);-1!==c&&this._markers.splice(c,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const c=this._popups.indexOf(g);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const g=p.extend({},Ds.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",g),d=c||this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);d?(this._useWebGL2&&!c&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(d,!0),this.painter=new Cl(d,this.transform,!!c),this.on("data",v=>{"source"===v.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(d)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let c;const d=this.painter.context.extTimerQuery,v=p.exported.now();if(this.listens("gpu-timing-frame")&&(c=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,k=this.transform.pitch,F=p.exported.now(),L=new p.EvaluationParameters(I,{now:F,fadeDuration:b,pitch:k,transition:this.style.getTransition()});this.style.update(L)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(v),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const I=p.exported.now()-v;d.endQueryEXT(d.TIME_ELAPSED_EXT,c),setTimeout(()=>{const k=d.getQueryObjectEXT(c,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(c),this.fire(new p.Event("gpu-timing-frame",{cpuTime:I,gpuTime:k})),p.window.performance.mark("frame-gpu",{startTime:v,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(I);this.fire(new p.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(I);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(M||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(E=this._updateAverageElevation(v,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const c of this._markers)g&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!g||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(g,c=!1){const d=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&d(0);if((c||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const v=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),E=!1;this.transform.elevation&&(E=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=g;const M=Math.abs(v-b);if(M>1){if(this._isInitialLoad||E)return this._averageElevation.jumpTo(b),d(b);this._averageElevation.easeTo(b,g,300)}else if(M>1e-4)return this._averageElevation.jumpTo(b),d(b)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===p.AUTH_ERR_MSG||401===g.status)){const c=this.painter.context.gl;p.storeAuthState(c,!1),this._logoControl instanceof nf&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const d=this.painter.context.gl,v=d.createFramebuffer();function b(E){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,E,0);const M=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,M),M}return d.bindFramebuffer(d.FRAMEBUFFER,v),this._canvasPixelComparison(b(g),c.canvasCopies.map(b),c.timeStamps)}_canvasPixelComparison(g,c,d){let v=d[1]-d[0];const b=g.length/4;for(let E=0;E<c.length;E++){const M=c[E];let I=0;for(let k=0;k<M.length;k+=4)M[k]===g[k]&&M[k+1]===g[k+1]&&M[k+2]===g[k+2]&&M[k+3]===g[k+3]&&(I+=1);v+=(d[E+2]-d[E+1])*(1-I/b)}return v}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=p.exported.frame(c=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(c)}))}_preloadTiles(g){const c=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(c,(d,v)=>d._preloadTiles(g,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,c){p.setCacheLimits(g,c)}get version(){return p.version}},NavigationControl:class{constructor(g){this.options=p.extend({},af,g),this._container=Zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Zt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Zt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:c}):d.resetNorth({},{originalEvent:c}))}),this._compassIcon=Zt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const c=g.getZoom(),d=c===g.getMaxZoom(),v=c===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Tg(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,c){const d=Zt("button",g,this._container);return d.type="button",d.addEventListener("click",c),d}_setButtonTitle(g,c){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${c}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends p.Evented{constructor(g){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},Fp,g),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=_c(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const c=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,g(d)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(d=>c("denied"!==d.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(g){const c=this._map.getMaxBounds(),d=g.coords;return!!c&&(d.longitude<c.getWest()||d.longitude>c.getEast()||d.latitude<c.getSouth()||d.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",g)),this._finish()}}_updateCamera(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,v=this._map.getBearing(),b=p.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(d),b,{geolocateSource:!0})}_updateMarker(g){if(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,c=p.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,d=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Zt("button","mapboxgl-ctrl-geolocate",this._container),Zt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Zt("div","mapboxgl-user-location"),this._dotElement.appendChild(Zt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Zt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new at({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Zt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new at({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:pt,ScaleControl:class{constructor(g){this.options=p.extend({},Mh,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,c=this._map,d=c._containerHeight/2,v=c._containerWidth/2-g/2,b=c.unproject([v,d]),E=c.unproject([v+g,d]),M=b.distanceTo(E);if("imperial"===this.options.unit){const I=3.2808*M;I>5280?this._setScale(g,I/5280,"mile"):this._setScale(g,I,"foot")}else"nautical"===this.options.unit?this._setScale(g,M/1852,"nautical-mile"):M>=1e3?this._setScale(g,M/1e3,"kilometer"):this._setScale(g,M,"meter")}_setScale(g,c,d){this._map._requestDomTask(()=>{const v=function(E){const M=Math.pow(10,`${Math.floor(E)}`.length-1);let I=E/M;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(k){const F=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*F)/F}(I),M*I}(c),b=v/c;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==d?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(v):`${v}&nbsp;${_r[d]}`,this._container.style.width=g*b+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Zt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof p.window.HTMLElement?this._container=g.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Zt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Zt("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(g){super(),this.options=p.extend(Object.create(Al),g),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=p.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(p.window.document.createTextNode(g))}setHTML(g){const c=p.window.document.createDocumentFragment(),d=p.window.document.createElement("body");let v;for(d.innerHTML=g;v=d.firstChild,v;)c.appendChild(v);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Zt("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(g),this.options.closeButton){const d=this._closeButton=Zt("button","mapboxgl-popup-close-button",c);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let c;return this._classList.delete(g)?c=!1:(this._classList.add(g),c=!0),this._updateClassList(),c}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const c=this._map,d=this._container,v=this._pos;if(!c||!d||!v)return"bottom";const b=d.offsetWidth,E=d.offsetHeight,M=v.x<b/2,I=v.x>c.transform.width-b/2;if(v.y+g<E)return M?"top-left":I?"top-right":"top";if(v.y>c.transform.height-E){if(M)return"bottom-left";if(I)return"bottom-right"}return M?"left":I?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),g.className=c.join(" ")}_update(g){const c=this._map,d=this._content;if(!c||!this._lngLat&&!this._trackPointer||!d)return;let v=this._container;if(v||(v=this._container=Zt("div","mapboxgl-popup",c.getContainer()),this._tip=Zt("div","mapboxgl-popup-tip",v),v.appendChild(d)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ze(this._lngLat,this._pos,c.transform)),!this._trackPointer||g){const b=this._pos=this._trackPointer&&g?g:c.project(this._lngLat),E=sf(this.options.offset),M=this._anchor=this._getAnchor(E.y),I=sf(this.options.offset,M),k=b.add(I).round();c._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${yn[M]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&c._showingGlobe()){const b=p.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(gr);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:at,Style:bo,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:wg,Evented:p.Evented,config:p.config,prewarm:function(){rc().acquire(Ss)},clearPrewarmedResources:function(){const g=Ur;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(Ss),Ur=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(g){p.config.ACCESS_TOKEN=g},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(g){p.config.API_URL=g},get workerCount(){return Yi.workerCount},set workerCount(g){Yi.workerCount=g},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){p.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){p.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return ho}),kn}()}},gg=>{gg(gg.s=460)}]);